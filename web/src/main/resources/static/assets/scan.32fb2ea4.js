var T=Object.defineProperty;var h=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var _=(n,s,e)=>s in n?T(n,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[s]=e,I=(n,s)=>{for(var e in s||(s={}))R.call(s,e)&&_(n,e,s[e]);if(h)for(var e of h(s))C.call(s,e)&&_(n,e,s[e]);return n};import{_ as k,L as r,b as y,c as x,d as B}from"./index.39c34feb.js";import{a as w,b as U}from"./index.2ddcde8c.js";import{Q as $}from"./qrcode.7e9b309c.js";import{i as j,j as L,o as b,t as E,m as F,p as S,b as c,D as Q,G as D}from"./vendor.07d41a1e.js";const M=j({name:"login11",props:{domain:{type:String,default:()=>""}},setup(n){const{proxy:s}=D(),e=L({sceneId:null,qrcodeUrl:null}),d=()=>{s.$refs.qrcodeRef.innerHTML="",new $(s.$refs.qrcodeRef,{text:e.qrcodeUrl,width:260,height:260,colorDark:"#000000",colorLight:"#ffffff"})},u=async o=>{if(o.data.userType!=1&&o.data.userType!=2){c.error("\u672A\u77E5\u7528\u6237\u7C7B\u578B");return}o.data.userType===1&&o.data.hasRole==!1?c.error("\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458\u6388\u6743"):i(o)},i=async o=>{var l,f,p,g;const a={username:o.data.username,photo:o.data.headImg===null?"/header.jpg":o.data.headImg,time:new Date().getTime(),hasRole:o.data.hasRole,version:o.data.version,userType:o.data.userType};r.set("token",o.data.token),r.set("tokenTtl",o.data.tokenTtl),r.set("userInfo",a),store.dispatch("userInfos/setUserInfos",a),store.state.themeConfig.themeConfig.isRequestRoutes?o.data.userType===1?await x():o.data.userType===2&&await y():await y();let q=currentTime.value;if((l=route.query)==null?void 0:l.redirect)console.log(route.query),router.push({path:(f=route.query)==null?void 0:f.redirect,query:Object.keys((p=route.query)==null?void 0:p.params).length>0?JSON.parse((g=route.query)==null?void 0:g.params):""});else{const v=B[0].children[0].path||"/";router.push(v)}setTimeout(()=>{e.loading.signIn=!0;const m=t("message.signInText");c.success(`${q}\uFF0C${m}`),s.mittBus.emit("onSignInClick")},300)};return b(()=>{w().then(o=>{e.qrcodeUrl=o.data.qrcodeUrl||null,e.sceneId=o.data.sceneId||null,console.log("sceneId:"+e.sceneId),console.log("qrcodeUrl:"+e.qrcodeUrl),d(),setInterval(()=>{U(e.sceneId).then(a=>{clearInterval(),u(a)}).catch(()=>{console.log("=====no login user find=====")})},1e3)})}),I({},E(e))}}),A={class:"login-scan-container"},N={class:"login-scan-qrcode",ref:"qrcodeRef"};function O(n,s,e,d,u,i){return Q(),F("div",A,[S("div",N,null,512)])}var z=k(M,[["render",O],["__scopeId","data-v-3d75dc62"]]);export{z as default};
