var $=Object.defineProperty;var I=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var k=(e,o,t)=>o in e?$(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,S=(e,o)=>{for(var t in o||(o={}))v.call(o,t)&&k(e,t,o[t]);if(I)for(var t of I(o))V.call(o,t)&&k(e,t,o[t]);return e};import{i as q,H as P,M as R,a0 as T,j,J as D,o as E,t as U,l as c,Q as A,A as a,b,D as K,z as n,p as f,q as M,y as N,G as x}from"./vendor.a9aef9fe.js";import{_ as z,u as G,f as H,S as g,b as J,c as L}from"./index.5eb239a7.js";import{g as O,s as Q}from"./index.7d04d2a7.js";import{l as W}from"./index.0c9e5e2c.js";const X=q({name:"login",setup(){const{t:e}=P(),{proxy:o}=x(),t=G(),m=R(),y=T(),r=j({isShowPassword:!1,captcha:"",captchaKey:"",myForm:{username:"",password:"",code:""},rules:{username:{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"},password:{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"blur"},code:{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",trigger:"blur"}},loading:{signIn:!1}}),i=D(()=>H(new Date)),l=async()=>{O().then(s=>{r.captcha=s.data.image,r.captchaKey=s.data.codeUuid,g.set("ClientId",r.captchaKey)}).catch(()=>{})};E(()=>{l()});const d=async()=>{new Promise(s=>{o.$refs.myRefForm.validate(u=>{u&&(s(u),h())})})},h=async()=>{Q(W.stringify(r.myForm)).then(s=>{w(s)}).catch(s=>{l(),b({showClose:!0,message:s.message?s.message:"\u7CFB\u7EDF\u9519\u8BEF",type:"error"})})},w=async s=>{r.loading.signIn=!0;const u={username:s.data.username,photo:r.myForm.username==="admin"?"/header.jpg":"https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=317673774,2961727727&fm=26&gp=0.jpg",time:new Date().getTime()};g.set("token",s.data.token),g.set("tokenTtl",s.data.tokenTtl),g.set("userInfo",u),t.dispatch("userInfos/setUserInfos",u),t.state.themeConfig.themeConfig.isRequestRoutes?(await L(),p()):(await J(),p())},p=()=>{var u,F,_,C;let s=i.value;((u=m.query)==null?void 0:u.redirect)?y.push({path:(F=m.query)==null?void 0:F.redirect,query:Object.keys((_=m.query)==null?void 0:_.params).length>0?JSON.parse((C=m.query)==null?void 0:C.params):""}):y.push("/"),setTimeout(()=>{r.loading.signIn=!0;const B=e("message.signInText");b.success(`${s}\uFF0C${B}`),o.mittBus.emit("onSignInClick")},300)};return S({currentTime:i,onSignIn:d,refreshCode:l},U(r))}}),Y={class:"login-content-code"},Z=["src"];function ee(e,o,t,m,y,r){const i=c("el-input"),l=c("el-form-item"),d=c("el-col"),h=c("el-row"),w=c("el-button"),p=c("el-form");return K(),A(p,{class:"login-content-form",model:e.myForm,rules:e.rules,ref:"myRefForm"},{default:a(()=>[n(l,{prop:"username"},{default:a(()=>[n(i,{type:"text",placeholder:e.$t("message.account.accountPlaceholder1"),"prefix-icon":"el-icon-user",modelValue:e.myForm.username,"onUpdate:modelValue":o[0]||(o[0]=s=>e.myForm.username=s),clearable:"",autocomplete:"off"},null,8,["placeholder","modelValue"])]),_:1}),n(l,{prop:"password"},{default:a(()=>[n(i,{type:e.isShowPassword?"text":"password",placeholder:e.$t("message.account.accountPlaceholder2"),"prefix-icon":"el-icon-lock",modelValue:e.myForm.password,"onUpdate:modelValue":o[2]||(o[2]=s=>e.myForm.password=s),autocomplete:"off"},{suffix:a(()=>[f("i",{class:M(["iconfont el-input__icon login-content-password",e.isShowPassword?"icon-yincangmima":"icon-xianshimima"]),onClick:o[1]||(o[1]=s=>e.isShowPassword=!e.isShowPassword)},null,2)]),_:1},8,["type","placeholder","modelValue"])]),_:1}),n(l,{prop:"code"},{default:a(()=>[n(h,{gutter:15},{default:a(()=>[n(d,{span:14},{default:a(()=>[n(i,{type:"text",maxlength:"5",placeholder:e.$t("message.account.accountPlaceholder3"),"prefix-icon":"el-icon-position",modelValue:e.myForm.code,"onUpdate:modelValue":o[3]||(o[3]=s=>e.myForm.code=s),clearable:"",autocomplete:"off"},null,8,["placeholder","modelValue"])]),_:1}),n(d,{span:10},{default:a(()=>[f("div",Y,[f("img",{class:"login-content-code-img",alt:"fastcms",onClick:o[4]||(o[4]=(...s)=>e.refreshCode&&e.refreshCode(...s)),src:e.captcha},null,8,Z)])]),_:1})]),_:1})]),_:1}),n(l,null,{default:a(()=>[n(w,{type:"primary",class:"login-content-submit",round:"",onClick:e.onSignIn,loading:e.loading.signIn},{default:a(()=>[f("span",null,N(e.$t("message.account.accountBtnText")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules"])}var re=z(X,[["render",ee],["__scopeId","data-v-642041e1"]]);export{re as default};
