import{P as w,B as J,C as X,W as Y,f as Z,S as ee,E as te,a as ae,A as oe,b as le,c as ne,I as se,d as ie,e as ce,g as re,h as de,H as me,i as ue,j as ge,k as pe,l as _e,m as he,n as fe,o as be,p as Ce,q as ye,L as xe,r as De,M as ke,s as Se,T as ve,t as Ee,u as Ie,D as we}from"./@ckeditor-2ec0d23b.js";import{A as Ae}from"./index-a37b0464.js";import{C as ze}from"./client-dfa4cb81.js";import{L as Te}from"./index-d6580e65.js";import{a as z}from"./element-plus-91d6d961.js";import{H as k,_ as E,i as O,ah as i,o as _,O as C,P as n,a as p,V as c,T as y,c as I,a8 as Ve,F as Oe,S as Me,U as Be,e as T,f as Ne}from"./@vue-6dabbe94.js";import{_ as Le}from"./_plugin-vue_export-helper-c27b6911.js";const x={editorObj:null,dialogObj:null},Re='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6.91 10.54c.26-.23.64-.21.88.03l3.36 3.14 2.23-2.06a.64.64 0 0 1 .87 0l2.52 2.97V4.5H3.2v10.12l3.71-4.08zm10.27-7.51c.6 0 1.09.47 1.09 1.05v11.84c0 .59-.49 1.06-1.09 1.06H2.79c-.6 0-1.09-.47-1.09-1.06V4.08c0-.58.49-1.05 1.1-1.05h14.38zm-5.22 5.56a1.96 1.96 0 1 1 3.4-1.96 1.96 1.96 0 0 1-3.4 1.96z"/></svg>',D="imgPlugin",je="图片",M="image";class He extends w{init(){this.createToolbarButton()}createToolbarButton(){const t=this.editor;console.log(Array.from(t.ui.componentFactory.names()));const o=t.commands.get(D);x.editorObj=t,window.dd=t.model,t.ui.componentFactory.add(D,u=>{const s=new J(u);return s.set({label:je,tooltip:!0,icon:Re,class:"toolbar_button_img_extend"}),s.bind("isOn","isEnabled").to(o,"value","isEnabled"),this.listenTo(s,"execute",()=>{console.log("======execute image view click"),x.dialogObj.openDialog(5)}),s})}}class Ke extends X{constructor(t){super(t),this.attributeKey=M}refresh(){const t=this.editor.model,o=t.document.selection;this.isEnabled=t.schema.checkAttributeInSelection(o,this.attributeKey)}}class Ue extends w{static get requires(){return[Y]}static get pluginName(){return"ImgEditing"}init(){const t=this.editor;this.defineSchema(),t.commands.add(D,new Ke(t))}defineSchema(){this.editor.model.schema.extend("$text",{allowAttributes:M})}}class V extends w{static get requires(){return[Ue,He]}static get pluginName(){return D}}function Pe(l,t={}){console.log(l),!(!t||!t.src)&&l.change(o=>{const u=o.createElement("imageInline",t),s=Z(l.document.selection,l);l.insertContent(u,s)})}const Fe={style:{width:"100%"}},qe=["onClick"],We=["src","fit"],$e={style:{padding:"14px"}},Ge={class:"filename"},Qe={class:"dialog-footer"},Je=k({name:"ckeditorAttachDialog"}),Xe=k({...Je,props:{fileType:String,isClient:{type:Boolean,default:!1}},setup(l,{expose:t}){const o=l,u=Ae(),s=ze();let h="fastcms/api/admin/attachment/upload";o.isClient&&o.isClient==!0&&(h="fastcms/api/client/attachment/upload");const e=E({fit:"fill",isShowDialog:!1,queryParams:{},showSearch:!0,max:1,limit:3,uploadUrl:h,headers:{Authorization:Te.get("token")},checkedObjs:[],tableData:{data:[],total:99,loading:!1,param:{pageNum:1,pageSize:10}}}),S=a=>{e.isShowDialog=!0,e.max=a},b=()=>{e.isShowDialog=!1,e.max=1},r=()=>{o.isClient&&o.isClient==!0?s.getAttachList(e.tableData.param).then(a=>{e.tableData.data=a.data.records,e.tableData.total=a.data.total}):u.getAttachList(e.tableData.param).then(a=>{e.tableData.data=a.data.records,e.tableData.total=a.data.total})},d=()=>{r()},f=()=>{z.error("上传文件数量不能超过 "+e.limit+" 个!")},B=()=>{z.error("上传失败")};O(()=>{r()});const N=a=>{console.log(a)},L=a=>{e.tableData.param.pageSize=a,r()},R=a=>{e.tableData.param.pageNum=a,r()},j=()=>{let a=[];e.checkedObjs.forEach(g=>a.push({src:g.path})),a.forEach(g=>Pe(x.editorObj.model,g)),b()};return t({openDialog:S}),(a,g)=>{const H=i("ele-Plus"),K=i("el-icon"),v=i("el-button"),U=i("el-upload"),P=i("el-tooltip"),F=i("el-checkbox"),A=i("el-card"),q=i("el-checkbox-group"),W=i("el-empty"),$=i("el-pagination"),G=i("el-dialog");return _(),C(G,{title:"选择附件",fullscreen:"",modelValue:e.isShowDialog,"onUpdate:modelValue":g[1]||(g[1]=m=>e.isShowDialog=m),"append-to-body":!0},{footer:n(()=>[p("span",Qe,[c(v,{onClick:b,size:"default"},{default:n(()=>[y("取 消")]),_:1}),c(v,{type:"primary",size:"default",onClick:j},{default:n(()=>[y("确 定")]),_:1})])]),default:n(()=>[p("div",Fe,[c(U,{class:"upload-btn",action:e.uploadUrl,name:"files",multiple:"",headers:e.headers,"show-file-list":!1,"on-success":d,"on-exceed":f,"on-error":B,limit:e.limit},{default:n(()=>[c(v,{type:"primary"},{default:n(()=>[c(K,null,{default:n(()=>[c(H)]),_:1}),y("上传附件")]),_:1})]),_:1},8,["action","headers","limit"]),c(A,{shadow:"hover"},{default:n(()=>[e.tableData.data.length>0?(_(),C(q,{key:0,max:e.max,modelValue:e.checkedObjs,"onUpdate:modelValue":g[0]||(g[0]=m=>e.checkedObjs=m),class:"imgWrap"},{default:n(()=>[(_(!0),I(Oe,null,Ve(e.tableData.data,(m,Q)=>(_(),I("div",{class:"mb10",key:Q,onClick:tt=>N(m)},[c(A,{"body-style":{padding:"6px"}},{default:n(()=>[p("img",{src:m.path,fit:e.fit,class:"image"},null,8,We),p("div",$e,[c(F,{label:m,style:{width:"100%"}},{default:n(()=>[c(P,{class:"item",effect:"dark",content:m.fileName,placement:"top-start"},{default:n(()=>[p("div",Ge,Be(m.fileName),1)]),_:2},1032,["content"])]),_:2},1032,["label"])])]),_:2},1024),y("/ ")],8,qe))),128))]),_:1},8,["max","modelValue"])):(_(),C(W,{key:1,description:"暂无数据"})),e.tableData.data.length>0?(_(),C($,{key:2,style:{"text-align":"right"},background:"",onSizeChange:L,onCurrentChange:R,"page-sizes":[10,20,30],"current-page":e.tableData.param.pageNum,"page-size":e.tableData.param.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.tableData.total},null,8,["current-page","page-size","total"])):Me("",!0)]),_:1})])]),_:1},8,["modelValue"])}}});const Ye=Le(Xe,[["__scopeId","data-v-e3870e70"]]),Ze=p("div",{class:"CKEditorBox"},[p("div",{class:"CKEditorToolbar"}),p("div",{class:"CKEditorContent"})],-1),et=k({name:"fastcmsCkeditor"}),rt=k({...et,props:{isClient:{type:Boolean,default:!1},modelValue:{type:String}},emits:["update:modelValue"],setup(l,{emit:t}){const o=l;let u=T(),s=T(),h=null,e=!1;const S=E({isClient:o.isClient||!1}),b=E({language:{ui:"zh-cn"},plugins:[ee,te,ae,oe,le,ne,se,ie,ce,re,de,me,ue,ge,pe,_e,he,fe,be,Ce,ye,xe,De,ke,Se,ve,Ee,Ie,V],toolbar:["sourceEditing","|","heading","|","bold","italic","link","bulletedList","numberedList","|","outdent","indent","|",V.pluginName,"blockQuote","insertTable","mediaEmbed","undo","redo"],image:{styles:["alignLeft","alignCenter","alignRight"],resizeOptions:[{name:"imageResize:original",label:"Original",value:null},{name:"imageResize:25",label:"25%",value:"25"},{name:"imageResize:50",label:"50%",value:"50"},{name:"imageResize:75",label:"75%",value:"75"}],toolbar:["imageStyle:inline","imageStyle:block","imageStyle:side","|","imageStyle:alignLeft","imageStyle:alignCenter","imageStyle:alignRight","|","imageResize","imageTextAlternative","toggleImageCaption"]},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]}});return O(()=>{x.dialogObj=u.value;const r=s.value;we.create(r.querySelector(".CKEditorContent"),b).then(d=>{const f=r.querySelector(".CKEditorToolbar");f&&(f.innerHTML=""),setTimeout(()=>f.appendChild(d.ui.view.toolbar.element),0),h=d,d.setData(o.modelValue),d.model.document.on("change",function(){e=!0,t("update:modelValue",d.getData())})}).catch(d=>{console.log(d)})}),Ne(()=>o.modelValue,r=>{if(e)return e=!1;h&&h.setData(r)}),(r,d)=>(_(),I("div",{class:"CKEditor",ref_key:"ckeditorDom",ref:s},[Ze,c(Ye,{ref_key:"attachDialog",ref:u,isClient:S.isClient},null,8,["isClient"])],512))}});export{rt as _};
