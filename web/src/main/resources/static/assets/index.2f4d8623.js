var Kh=Object.defineProperty,Gh=Object.defineProperties;var Jh=Object.getOwnPropertyDescriptors;var lr=Object.getOwnPropertySymbols;var Qh=Object.prototype.hasOwnProperty,Yh=Object.prototype.propertyIsEnumerable;var cr=(i,e,t)=>e in i?Kh(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,x=(i,e)=>{for(var t in e||(e={}))Qh.call(e,t)&&cr(i,t,e[t]);if(lr)for(var t of lr(e))Yh.call(e,t)&&cr(i,t,e[t]);return i},ur=(i,e)=>Gh(i,Jh(e));import{g as Xh}from"./index.a0252aff.js";import{g as Zh}from"./client.899f0948.js";import{_ as dr,L as ef}from"./index.b56fc134.js";import{j as hr,o as fr,t as tf,l as xe,D as wt,Q as Bn,A as ye,p as rt,z as De,m as Fi,Y as nf,X as sf,y as of,L as rf,b as mr,x as Li,i as af,r as gr,P as lf}from"./vendor.07d41a1e.js";var Fn={editorObj:null,dialogObj:null};/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function pr(){return function i(){i.called=!0}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class at{constructor(e,t){this.source=e,this.name=t,this.path=[],this.stop=pr(),this.off=pr()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const ue=new Array(256).fill().map((i,e)=>("0"+e.toString(16)).slice(-2));function Be(){const i=Math.random()*4294967296>>>0,e=Math.random()*4294967296>>>0,t=Math.random()*4294967296>>>0,n=Math.random()*4294967296>>>0;return"e"+ue[i>>0&255]+ue[i>>8&255]+ue[i>>16&255]+ue[i>>24&255]+ue[e>>0&255]+ue[e>>8&255]+ue[e>>16&255]+ue[e>>24&255]+ue[t>>0&255]+ue[t>>8&255]+ue[t>>16&255]+ue[t>>24&255]+ue[n>>0&255]+ue[n>>8&255]+ue[n>>16&255]+ue[n>>24&255]}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const mn={get(i){return typeof i!="number"?this[i]||this.normal:i},highest:1e5,high:1e3,normal:0,low:-1e3,lowest:-1e5};/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const cf="https://ckeditor.com/docs/ckeditor5/latest/framework/guides/support/error-codes.html";class f extends Error{constructor(e,t,n){super(uf(e,n));this.name="CKEditorError",this.context=t,this.data=n}is(e){return e==="CKEditorError"}static rethrowUnexpectedError(e,t){if(e.is&&e.is("CKEditorError"))throw e;const n=new f(e.message,t);throw n.stack=e.stack,n}}function de(i,e){console.warn(...df(i,e))}function wr(i){return`
Read more: ${cf}#error-${i}`}function uf(i,e){const t=new WeakSet,n=(r,a)=>{if(typeof a=="object"&&a!==null){if(t.has(a))return`[object ${a.constructor.name}]`;t.add(a)}return a},s=e?` ${JSON.stringify(e,n)}`:"",o=wr(i);return i+s+o}function df(i,e){const t=wr(i);return e?[i,e,t]:[i,t]}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const hf="31.1.0",br=typeof window=="object"?window:global;if(br.CKEDITOR_VERSION)throw new f("ckeditor-duplicated-modules",null);br.CKEDITOR_VERSION=hf;/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const lt=Symbol("listeningTo"),zi=Symbol("emitterId"),H={on(i,e,t={}){this.listenTo(this,i,e,t)},once(i,e,t){let n=!1;const s=function(o,...r){n||(n=!0,o.off(),e.call(this,o,...r))};this.listenTo(this,i,s,t)},off(i,e){this.stopListening(this,i,e)},listenTo(i,e,t,n={}){let s,o;this[lt]||(this[lt]={});const r=this[lt];Hi(i)||_r(i);const a=Hi(i);(s=r[a])||(s=r[a]={emitter:i,callbacks:{}}),(o=s.callbacks[e])||(o=s.callbacks[e]=[]),o.push(t),pf(this,i,e,t,n)},stopListening(i,e,t){const n=this[lt];let s=i&&Hi(i);const o=n&&s&&n[s],r=o&&e&&o.callbacks[e];if(!(!n||i&&!o||e&&!r))if(t)Wi(this,i,e,t),r.indexOf(t)!==-1&&(r.length===1?delete o.callbacks[e]:Wi(this,i,e,t));else if(r){for(;t=r.pop();)Wi(this,i,e,t);delete o.callbacks[e]}else if(o){for(e in o.callbacks)this.stopListening(i,e);delete n[s]}else{for(s in n)this.stopListening(n[s].emitter);delete this[lt]}},fire(i,...e){try{const t=i instanceof at?i:new at(this,i),n=t.name;let s=yr(this,n);if(t.path.push(this),s){const o=[t,...e];s=Array.from(s);for(let r=0;r<s.length&&(s[r].callback.apply(this,o),t.off.called&&(delete t.off.called,this._removeEventListener(n,s[r].callback)),!t.stop.called);r++);}if(this._delegations){const o=this._delegations.get(n),r=this._delegations.get("*");o&&Cr(o,t,e),r&&Cr(r,t,e)}return t.return}catch(t){f.rethrowUnexpectedError(t,this)}},delegate(...i){return{to:(e,t)=>{this._delegations||(this._delegations=new Map),i.forEach(n=>{const s=this._delegations.get(n);s?s.set(e,t):this._delegations.set(n,new Map([[e,t]]))})}}},stopDelegating(i,e){if(!!this._delegations)if(!i)this._delegations.clear();else if(!e)this._delegations.delete(i);else{const t=this._delegations.get(i);t&&t.delete(e)}},_addEventListener(i,e,t){gf(this,i);const n=$i(this,i),s=mn.get(t.priority),o={callback:e,priority:s};for(const r of n){let a=!1;for(let l=0;l<r.length;l++)if(r[l].priority<s){r.splice(l,0,o),a=!0;break}a||r.push(o)}},_removeEventListener(i,e){const t=$i(this,i);for(const n of t)for(let s=0;s<n.length;s++)n[s].callback==e&&(n.splice(s,1),s--)}};function ff(i,e){return i[lt]&&i[lt][e]?i[lt][e].emitter:null}function _r(i,e){i[zi]||(i[zi]=e||Be())}function Hi(i){return i[zi]}function vr(i){return i._events||Object.defineProperty(i,"_events",{value:{}}),i._events}function mf(){return{callbacks:[],childEvents:[]}}function gf(i,e){const t=vr(i);if(t[e])return;let n=e,s=null;const o=[];for(;n!==""&&!t[n];)t[n]=mf(),o.push(t[n]),s&&t[n].childEvents.push(s),s=n,n=n.substr(0,n.lastIndexOf(":"));if(n!==""){for(const r of o)r.callbacks=t[n].callbacks.slice();t[n].childEvents.push(s)}}function $i(i,e){const t=vr(i)[e];if(!t)return[];let n=[t.callbacks];for(let s=0;s<t.childEvents.length;s++){const o=$i(i,t.childEvents[s]);n=n.concat(o)}return n}function yr(i,e){let t;return!i._events||!(t=i._events[e])||!t.callbacks.length?e.indexOf(":")>-1?yr(i,e.substr(0,e.lastIndexOf(":"))):null:t.callbacks}function Cr(i,e,t){for(let[n,s]of i){s?typeof s=="function"&&(s=s(e.name)):s=e.name;const o=new at(e.source,s);o.path=[...e.path],n.fire(o,...t)}}function pf(i,e,t,n,s){e._addEventListener?e._addEventListener(t,n,s):i._addEventListener.call(e,t,n,s)}function Wi(i,e,t,n){e._removeEventListener?e._removeEventListener(t,n):i._removeEventListener.call(e,t,n)}var wf=typeof global=="object"&&global&&global.Object===Object&&global,Er=wf,bf=typeof self=="object"&&self&&self.Object===Object&&self,_f=Er||bf||Function("return this")(),Ie=_f,vf=Ie.Symbol,Fe=vf,Tr=Object.prototype,yf=Tr.hasOwnProperty,Cf=Tr.toString,gn=Fe?Fe.toStringTag:void 0;function Ef(i){var e=yf.call(i,gn),t=i[gn];try{i[gn]=void 0;var n=!0}catch{}var s=Cf.call(i);return n&&(e?i[gn]=t:delete i[gn]),s}var Tf=Object.prototype,kf=Tf.toString;function Af(i){return kf.call(i)}var Sf="[object Null]",Pf="[object Undefined]",kr=Fe?Fe.toStringTag:void 0;function ct(i){return i==null?i===void 0?Pf:Sf:kr&&kr in Object(i)?Ef(i):Af(i)}function Ce(i){return i!=null&&typeof i=="object"}var xf="[object Symbol]";function Ln(i){return typeof i=="symbol"||Ce(i)&&ct(i)==xf}function If(i,e){for(var t=-1,n=i==null?0:i.length,s=Array(n);++t<n;)s[t]=e(i[t],t,i);return s}var Rf=Array.isArray,me=Rf,Mf=1/0,Ar=Fe?Fe.prototype:void 0,Sr=Ar?Ar.toString:void 0;function Pr(i){if(typeof i=="string")return i;if(me(i))return If(i,Pr)+"";if(Ln(i))return Sr?Sr.call(i):"";var e=i+"";return e=="0"&&1/i==-Mf?"-0":e}var Vf=/\s/;function Of(i){for(var e=i.length;e--&&Vf.test(i.charAt(e)););return e}var Nf=/^\s+/;function Df(i){return i&&i.slice(0,Of(i)+1).replace(Nf,"")}function Z(i){var e=typeof i;return i!=null&&(e=="object"||e=="function")}var xr=0/0,Bf=/^[-+]0x[0-9a-f]+$/i,Ff=/^0b[01]+$/i,Lf=/^0o[0-7]+$/i,zf=parseInt;function Ir(i){if(typeof i=="number")return i;if(Ln(i))return xr;if(Z(i)){var e=typeof i.valueOf=="function"?i.valueOf():i;i=Z(e)?e+"":e}if(typeof i!="string")return i===0?i:+i;i=Df(i);var t=Ff.test(i);return t||Lf.test(i)?zf(i.slice(2),t?2:8):Bf.test(i)?xr:+i}function bt(i){return i}var Hf="[object AsyncFunction]",$f="[object Function]",Wf="[object GeneratorFunction]",Uf="[object Proxy]";function pn(i){if(!Z(i))return!1;var e=ct(i);return e==$f||e==Wf||e==Hf||e==Uf}var qf=Ie["__core-js_shared__"],Ui=qf,Rr=function(){var i=/[^.]+$/.exec(Ui&&Ui.keys&&Ui.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}();function jf(i){return!!Rr&&Rr in i}var Kf=Function.prototype,Gf=Kf.toString;function _t(i){if(i!=null){try{return Gf.call(i)}catch{}try{return i+""}catch{}}return""}var Jf=/[\\^$.*+?()[\]{}|]/g,Qf=/^\[object .+?Constructor\]$/,Yf=Function.prototype,Xf=Object.prototype,Zf=Yf.toString,em=Xf.hasOwnProperty,tm=RegExp("^"+Zf.call(em).replace(Jf,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function nm(i){if(!Z(i)||jf(i))return!1;var e=pn(i)?tm:Qf;return e.test(_t(i))}function im(i,e){return i==null?void 0:i[e]}function vt(i,e){var t=im(i,e);return nm(t)?t:void 0}var sm=vt(Ie,"WeakMap"),qi=sm,Mr=Object.create,om=function(){function i(){}return function(e){if(!Z(e))return{};if(Mr)return Mr(e);i.prototype=e;var t=new i;return i.prototype=void 0,t}}(),rm=om;function am(i,e,t){switch(t.length){case 0:return i.call(e);case 1:return i.call(e,t[0]);case 2:return i.call(e,t[0],t[1]);case 3:return i.call(e,t[0],t[1],t[2])}return i.apply(e,t)}function Vr(i,e){var t=-1,n=i.length;for(e||(e=Array(n));++t<n;)e[t]=i[t];return e}var lm=800,cm=16,um=Date.now;function dm(i){var e=0,t=0;return function(){var n=um(),s=cm-(n-t);if(t=n,s>0){if(++e>=lm)return arguments[0]}else e=0;return i.apply(void 0,arguments)}}function hm(i){return function(){return i}}var fm=function(){try{var i=vt(Object,"defineProperty");return i({},"",{}),i}catch{}}(),zn=fm,mm=zn?function(i,e){return zn(i,"toString",{configurable:!0,enumerable:!1,value:hm(e),writable:!0})}:bt,gm=mm,pm=dm(gm),wm=pm;function bm(i,e){for(var t=-1,n=i==null?0:i.length;++t<n&&e(i[t],t,i)!==!1;);return i}var _m=9007199254740991,vm=/^(?:0|[1-9]\d*)$/;function ji(i,e){var t=typeof i;return e=e==null?_m:e,!!e&&(t=="number"||t!="symbol"&&vm.test(i))&&i>-1&&i%1==0&&i<e}function Ki(i,e,t){e=="__proto__"&&zn?zn(i,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):i[e]=t}function wn(i,e){return i===e||i!==i&&e!==e}var ym=Object.prototype,Cm=ym.hasOwnProperty;function Gi(i,e,t){var n=i[e];(!(Cm.call(i,e)&&wn(n,t))||t===void 0&&!(e in i))&&Ki(i,e,t)}function Ft(i,e,t,n){var s=!t;t||(t={});for(var o=-1,r=e.length;++o<r;){var a=e[o],l=n?n(t[a],i[a],a,t,i):void 0;l===void 0&&(l=i[a]),s?Ki(t,a,l):Gi(t,a,l)}return t}var Or=Math.max;function Em(i,e,t){return e=Or(e===void 0?i.length-1:e,0),function(){for(var n=arguments,s=-1,o=Or(n.length-e,0),r=Array(o);++s<o;)r[s]=n[e+s];s=-1;for(var a=Array(e+1);++s<e;)a[s]=n[s];return a[e]=t(r),am(i,this,a)}}function Tm(i,e){return wm(Em(i,e,bt),i+"")}var km=9007199254740991;function Nr(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=km}function Hn(i){return i!=null&&Nr(i.length)&&!pn(i)}function Am(i,e,t){if(!Z(t))return!1;var n=typeof e;return(n=="number"?Hn(t)&&ji(e,t.length):n=="string"&&e in t)?wn(t[e],i):!1}function Dr(i){return Tm(function(e,t){var n=-1,s=t.length,o=s>1?t[s-1]:void 0,r=s>2?t[2]:void 0;for(o=i.length>3&&typeof o=="function"?(s--,o):void 0,r&&Am(t[0],t[1],r)&&(o=s<3?void 0:o,s=1),e=Object(e);++n<s;){var a=t[n];a&&i(e,a,n,o)}return e})}var Sm=Object.prototype;function Ji(i){var e=i&&i.constructor,t=typeof e=="function"&&e.prototype||Sm;return i===t}function Pm(i,e){for(var t=-1,n=Array(i);++t<i;)n[t]=e(t);return n}var xm="[object Arguments]";function Br(i){return Ce(i)&&ct(i)==xm}var Fr=Object.prototype,Im=Fr.hasOwnProperty,Rm=Fr.propertyIsEnumerable,Mm=Br(function(){return arguments}())?Br:function(i){return Ce(i)&&Im.call(i,"callee")&&!Rm.call(i,"callee")},Qi=Mm;function Vm(){return!1}var Lr=typeof exports=="object"&&exports&&!exports.nodeType&&exports,zr=Lr&&typeof module=="object"&&module&&!module.nodeType&&module,Om=zr&&zr.exports===Lr,Hr=Om?Ie.Buffer:void 0,Nm=Hr?Hr.isBuffer:void 0,Dm=Nm||Vm,bn=Dm,Bm="[object Arguments]",Fm="[object Array]",Lm="[object Boolean]",zm="[object Date]",Hm="[object Error]",$m="[object Function]",Wm="[object Map]",Um="[object Number]",qm="[object Object]",jm="[object RegExp]",Km="[object Set]",Gm="[object String]",Jm="[object WeakMap]",Qm="[object ArrayBuffer]",Ym="[object DataView]",Xm="[object Float32Array]",Zm="[object Float64Array]",eg="[object Int8Array]",tg="[object Int16Array]",ng="[object Int32Array]",ig="[object Uint8Array]",sg="[object Uint8ClampedArray]",og="[object Uint16Array]",rg="[object Uint32Array]",Q={};Q[Xm]=Q[Zm]=Q[eg]=Q[tg]=Q[ng]=Q[ig]=Q[sg]=Q[og]=Q[rg]=!0;Q[Bm]=Q[Fm]=Q[Qm]=Q[Lm]=Q[Ym]=Q[zm]=Q[Hm]=Q[$m]=Q[Wm]=Q[Um]=Q[qm]=Q[jm]=Q[Km]=Q[Gm]=Q[Jm]=!1;function ag(i){return Ce(i)&&Nr(i.length)&&!!Q[ct(i)]}function Yi(i){return function(e){return i(e)}}var $r=typeof exports=="object"&&exports&&!exports.nodeType&&exports,_n=$r&&typeof module=="object"&&module&&!module.nodeType&&module,lg=_n&&_n.exports===$r,Xi=lg&&Er.process,cg=function(){try{var i=_n&&_n.require&&_n.require("util").types;return i||Xi&&Xi.binding&&Xi.binding("util")}catch{}}(),Lt=cg,Wr=Lt&&Lt.isTypedArray,ug=Wr?Yi(Wr):ag,Zi=ug,dg=Object.prototype,hg=dg.hasOwnProperty;function Ur(i,e){var t=me(i),n=!t&&Qi(i),s=!t&&!n&&bn(i),o=!t&&!n&&!s&&Zi(i),r=t||n||s||o,a=r?Pm(i.length,String):[],l=a.length;for(var c in i)(e||hg.call(i,c))&&!(r&&(c=="length"||s&&(c=="offset"||c=="parent")||o&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||ji(c,l)))&&a.push(c);return a}function qr(i,e){return function(t){return i(e(t))}}var fg=qr(Object.keys,Object),mg=fg,gg=Object.prototype,pg=gg.hasOwnProperty;function wg(i){if(!Ji(i))return mg(i);var e=[];for(var t in Object(i))pg.call(i,t)&&t!="constructor"&&e.push(t);return e}function es(i){return Hn(i)?Ur(i):wg(i)}function bg(i){var e=[];if(i!=null)for(var t in Object(i))e.push(t);return e}var _g=Object.prototype,vg=_g.hasOwnProperty;function yg(i){if(!Z(i))return bg(i);var e=Ji(i),t=[];for(var n in i)n=="constructor"&&(e||!vg.call(i,n))||t.push(n);return t}function zt(i){return Hn(i)?Ur(i,!0):yg(i)}var Cg=Dr(function(i,e){Ft(e,zt(e),i)}),vn=Cg,Eg=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Tg=/^\w*$/;function kg(i,e){if(me(i))return!1;var t=typeof i;return t=="number"||t=="symbol"||t=="boolean"||i==null||Ln(i)?!0:Tg.test(i)||!Eg.test(i)||e!=null&&i in Object(e)}var Ag=vt(Object,"create"),yn=Ag;function Sg(){this.__data__=yn?yn(null):{},this.size=0}function Pg(i){var e=this.has(i)&&delete this.__data__[i];return this.size-=e?1:0,e}var xg="__lodash_hash_undefined__",Ig=Object.prototype,Rg=Ig.hasOwnProperty;function Mg(i){var e=this.__data__;if(yn){var t=e[i];return t===xg?void 0:t}return Rg.call(e,i)?e[i]:void 0}var Vg=Object.prototype,Og=Vg.hasOwnProperty;function Ng(i){var e=this.__data__;return yn?e[i]!==void 0:Og.call(e,i)}var Dg="__lodash_hash_undefined__";function Bg(i,e){var t=this.__data__;return this.size+=this.has(i)?0:1,t[i]=yn&&e===void 0?Dg:e,this}function yt(i){var e=-1,t=i==null?0:i.length;for(this.clear();++e<t;){var n=i[e];this.set(n[0],n[1])}}yt.prototype.clear=Sg;yt.prototype.delete=Pg;yt.prototype.get=Mg;yt.prototype.has=Ng;yt.prototype.set=Bg;function Fg(){this.__data__=[],this.size=0}function $n(i,e){for(var t=i.length;t--;)if(wn(i[t][0],e))return t;return-1}var Lg=Array.prototype,zg=Lg.splice;function Hg(i){var e=this.__data__,t=$n(e,i);if(t<0)return!1;var n=e.length-1;return t==n?e.pop():zg.call(e,t,1),--this.size,!0}function $g(i){var e=this.__data__,t=$n(e,i);return t<0?void 0:e[t][1]}function Wg(i){return $n(this.__data__,i)>-1}function Ug(i,e){var t=this.__data__,n=$n(t,i);return n<0?(++this.size,t.push([i,e])):t[n][1]=e,this}function Je(i){var e=-1,t=i==null?0:i.length;for(this.clear();++e<t;){var n=i[e];this.set(n[0],n[1])}}Je.prototype.clear=Fg;Je.prototype.delete=Hg;Je.prototype.get=$g;Je.prototype.has=Wg;Je.prototype.set=Ug;var qg=vt(Ie,"Map"),Cn=qg;function jg(){this.size=0,this.__data__={hash:new yt,map:new(Cn||Je),string:new yt}}function Kg(i){var e=typeof i;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?i!=="__proto__":i===null}function Wn(i,e){var t=i.__data__;return Kg(e)?t[typeof e=="string"?"string":"hash"]:t.map}function Gg(i){var e=Wn(this,i).delete(i);return this.size-=e?1:0,e}function Jg(i){return Wn(this,i).get(i)}function Qg(i){return Wn(this,i).has(i)}function Yg(i,e){var t=Wn(this,i),n=t.size;return t.set(i,e),this.size+=t.size==n?0:1,this}function Qe(i){var e=-1,t=i==null?0:i.length;for(this.clear();++e<t;){var n=i[e];this.set(n[0],n[1])}}Qe.prototype.clear=jg;Qe.prototype.delete=Gg;Qe.prototype.get=Jg;Qe.prototype.has=Qg;Qe.prototype.set=Yg;var Xg="Expected a function";function ts(i,e){if(typeof i!="function"||e!=null&&typeof e!="function")throw new TypeError(Xg);var t=function(){var n=arguments,s=e?e.apply(this,n):n[0],o=t.cache;if(o.has(s))return o.get(s);var r=i.apply(this,n);return t.cache=o.set(s,r)||o,r};return t.cache=new(ts.Cache||Qe),t}ts.Cache=Qe;var Zg=500;function ep(i){var e=ts(i,function(n){return t.size===Zg&&t.clear(),n}),t=e.cache;return e}var tp=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,np=/\\(\\)?/g,ip=ep(function(i){var e=[];return i.charCodeAt(0)===46&&e.push(""),i.replace(tp,function(t,n,s,o){e.push(s?o.replace(np,"$1"):n||t)}),e}),sp=ip;function ns(i){return i==null?"":Pr(i)}function is(i,e){return me(i)?i:kg(i,e)?[i]:sp(ns(i))}var op=1/0;function ss(i){if(typeof i=="string"||Ln(i))return i;var e=i+"";return e=="0"&&1/i==-op?"-0":e}function jr(i,e){e=is(e,i);for(var t=0,n=e.length;i!=null&&t<n;)i=i[ss(e[t++])];return t&&t==n?i:void 0}function Un(i,e,t){var n=i==null?void 0:jr(i,e);return n===void 0?t:n}function Kr(i,e){for(var t=-1,n=e.length,s=i.length;++t<n;)i[s+t]=e[t];return i}var rp=qr(Object.getPrototypeOf,Object),os=rp,ap="[object Object]",lp=Function.prototype,cp=Object.prototype,Gr=lp.toString,up=cp.hasOwnProperty,dp=Gr.call(Object);function Ee(i){if(!Ce(i)||ct(i)!=ap)return!1;var e=os(i);if(e===null)return!0;var t=up.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&Gr.call(t)==dp}function Jr(i,e,t){var n=-1,s=i.length;e<0&&(e=-e>s?0:s+e),t=t>s?s:t,t<0&&(t+=s),s=e>t?0:t-e>>>0,e>>>=0;for(var o=Array(s);++n<s;)o[n]=i[n+e];return o}function hp(i,e,t){var n=i.length;return t=t===void 0?n:t,!e&&t>=n?i:Jr(i,e,t)}var fp="\\ud800-\\udfff",mp="\\u0300-\\u036f",gp="\\ufe20-\\ufe2f",pp="\\u20d0-\\u20ff",wp=mp+gp+pp,bp="\\ufe0e\\ufe0f",_p="\\u200d",vp=RegExp("["+_p+fp+wp+bp+"]");function Qr(i){return vp.test(i)}function yp(i){return i.split("")}var Yr="\\ud800-\\udfff",Cp="\\u0300-\\u036f",Ep="\\ufe20-\\ufe2f",Tp="\\u20d0-\\u20ff",kp=Cp+Ep+Tp,Ap="\\ufe0e\\ufe0f",Sp="["+Yr+"]",rs="["+kp+"]",as="\\ud83c[\\udffb-\\udfff]",Pp="(?:"+rs+"|"+as+")",Xr="[^"+Yr+"]",Zr="(?:\\ud83c[\\udde6-\\uddff]){2}",ea="[\\ud800-\\udbff][\\udc00-\\udfff]",xp="\\u200d",ta=Pp+"?",na="["+Ap+"]?",Ip="(?:"+xp+"(?:"+[Xr,Zr,ea].join("|")+")"+na+ta+")*",Rp=na+ta+Ip,Mp="(?:"+[Xr+rs+"?",rs,Zr,ea,Sp].join("|")+")",Vp=RegExp(as+"(?="+as+")|"+Mp+Rp,"g");function Op(i){return i.match(Vp)||[]}function Np(i){return Qr(i)?Op(i):yp(i)}function Dp(i){return function(e){e=ns(e);var t=Qr(e)?Np(e):void 0,n=t?t[0]:e.charAt(0),s=t?hp(t,1).join(""):e.slice(1);return n[i]()+s}}var Bp=Dp("toUpperCase"),Fp=Bp;function Lp(){this.__data__=new Je,this.size=0}function zp(i){var e=this.__data__,t=e.delete(i);return this.size=e.size,t}function Hp(i){return this.__data__.get(i)}function $p(i){return this.__data__.has(i)}var Wp=200;function Up(i,e){var t=this.__data__;if(t instanceof Je){var n=t.__data__;if(!Cn||n.length<Wp-1)return n.push([i,e]),this.size=++t.size,this;t=this.__data__=new Qe(n)}return t.set(i,e),this.size=t.size,this}function Le(i){var e=this.__data__=new Je(i);this.size=e.size}Le.prototype.clear=Lp;Le.prototype.delete=zp;Le.prototype.get=Hp;Le.prototype.has=$p;Le.prototype.set=Up;function qp(i,e){return i&&Ft(e,es(e),i)}function jp(i,e){return i&&Ft(e,zt(e),i)}var ia=typeof exports=="object"&&exports&&!exports.nodeType&&exports,sa=ia&&typeof module=="object"&&module&&!module.nodeType&&module,Kp=sa&&sa.exports===ia,oa=Kp?Ie.Buffer:void 0,ra=oa?oa.allocUnsafe:void 0;function aa(i,e){if(e)return i.slice();var t=i.length,n=ra?ra(t):new i.constructor(t);return i.copy(n),n}function Gp(i,e){for(var t=-1,n=i==null?0:i.length,s=0,o=[];++t<n;){var r=i[t];e(r,t,i)&&(o[s++]=r)}return o}function la(){return[]}var Jp=Object.prototype,Qp=Jp.propertyIsEnumerable,ca=Object.getOwnPropertySymbols,Yp=ca?function(i){return i==null?[]:(i=Object(i),Gp(ca(i),function(e){return Qp.call(i,e)}))}:la,ls=Yp;function Xp(i,e){return Ft(i,ls(i),e)}var Zp=Object.getOwnPropertySymbols,ew=Zp?function(i){for(var e=[];i;)Kr(e,ls(i)),i=os(i);return e}:la,ua=ew;function tw(i,e){return Ft(i,ua(i),e)}function da(i,e,t){var n=e(i);return me(i)?n:Kr(n,t(i))}function cs(i){return da(i,es,ls)}function nw(i){return da(i,zt,ua)}var iw=vt(Ie,"DataView"),us=iw,sw=vt(Ie,"Promise"),ds=sw,ow=vt(Ie,"Set"),hs=ow,ha="[object Map]",rw="[object Object]",fa="[object Promise]",ma="[object Set]",ga="[object WeakMap]",pa="[object DataView]",aw=_t(us),lw=_t(Cn),cw=_t(ds),uw=_t(hs),dw=_t(qi),Ct=ct;(us&&Ct(new us(new ArrayBuffer(1)))!=pa||Cn&&Ct(new Cn)!=ha||ds&&Ct(ds.resolve())!=fa||hs&&Ct(new hs)!=ma||qi&&Ct(new qi)!=ga)&&(Ct=function(i){var e=ct(i),t=e==rw?i.constructor:void 0,n=t?_t(t):"";if(n)switch(n){case aw:return pa;case lw:return ha;case cw:return fa;case uw:return ma;case dw:return ga}return e});var En=Ct,hw=Object.prototype,fw=hw.hasOwnProperty;function mw(i){var e=i.length,t=new i.constructor(e);return e&&typeof i[0]=="string"&&fw.call(i,"index")&&(t.index=i.index,t.input=i.input),t}var gw=Ie.Uint8Array,qn=gw;function fs(i){var e=new i.constructor(i.byteLength);return new qn(e).set(new qn(i)),e}function pw(i,e){var t=e?fs(i.buffer):i.buffer;return new i.constructor(t,i.byteOffset,i.byteLength)}var ww=/\w*$/;function bw(i){var e=new i.constructor(i.source,ww.exec(i));return e.lastIndex=i.lastIndex,e}var wa=Fe?Fe.prototype:void 0,ba=wa?wa.valueOf:void 0;function _w(i){return ba?Object(ba.call(i)):{}}function _a(i,e){var t=e?fs(i.buffer):i.buffer;return new i.constructor(t,i.byteOffset,i.length)}var vw="[object Boolean]",yw="[object Date]",Cw="[object Map]",Ew="[object Number]",Tw="[object RegExp]",kw="[object Set]",Aw="[object String]",Sw="[object Symbol]",Pw="[object ArrayBuffer]",xw="[object DataView]",Iw="[object Float32Array]",Rw="[object Float64Array]",Mw="[object Int8Array]",Vw="[object Int16Array]",Ow="[object Int32Array]",Nw="[object Uint8Array]",Dw="[object Uint8ClampedArray]",Bw="[object Uint16Array]",Fw="[object Uint32Array]";function Lw(i,e,t){var n=i.constructor;switch(e){case Pw:return fs(i);case vw:case yw:return new n(+i);case xw:return pw(i,t);case Iw:case Rw:case Mw:case Vw:case Ow:case Nw:case Dw:case Bw:case Fw:return _a(i,t);case Cw:return new n;case Ew:case Aw:return new n(i);case Tw:return bw(i);case kw:return new n;case Sw:return _w(i)}}function va(i){return typeof i.constructor=="function"&&!Ji(i)?rm(os(i)):{}}var zw="[object Map]";function Hw(i){return Ce(i)&&En(i)==zw}var ya=Lt&&Lt.isMap,$w=ya?Yi(ya):Hw,Ww=$w,Uw="[object Set]";function qw(i){return Ce(i)&&En(i)==Uw}var Ca=Lt&&Lt.isSet,jw=Ca?Yi(Ca):qw,Kw=jw,Gw=1,Jw=2,Qw=4,Ea="[object Arguments]",Yw="[object Array]",Xw="[object Boolean]",Zw="[object Date]",eb="[object Error]",Ta="[object Function]",tb="[object GeneratorFunction]",nb="[object Map]",ib="[object Number]",ka="[object Object]",sb="[object RegExp]",ob="[object Set]",rb="[object String]",ab="[object Symbol]",lb="[object WeakMap]",cb="[object ArrayBuffer]",ub="[object DataView]",db="[object Float32Array]",hb="[object Float64Array]",fb="[object Int8Array]",mb="[object Int16Array]",gb="[object Int32Array]",pb="[object Uint8Array]",wb="[object Uint8ClampedArray]",bb="[object Uint16Array]",_b="[object Uint32Array]",G={};G[Ea]=G[Yw]=G[cb]=G[ub]=G[Xw]=G[Zw]=G[db]=G[hb]=G[fb]=G[mb]=G[gb]=G[nb]=G[ib]=G[ka]=G[sb]=G[ob]=G[rb]=G[ab]=G[pb]=G[wb]=G[bb]=G[_b]=!0;G[eb]=G[Ta]=G[lb]=!1;function Ht(i,e,t,n,s,o){var r,a=e&Gw,l=e&Jw,c=e&Qw;if(t&&(r=s?t(i,n,s,o):t(i)),r!==void 0)return r;if(!Z(i))return i;var u=me(i);if(u){if(r=mw(i),!a)return Vr(i,r)}else{var d=En(i),h=d==Ta||d==tb;if(bn(i))return aa(i,a);if(d==ka||d==Ea||h&&!s){if(r=l||h?{}:va(i),!a)return l?tw(i,jp(r,i)):Xp(i,qp(r,i))}else{if(!G[d])return s?i:{};r=Lw(i,d,a)}}o||(o=new Le);var m=o.get(i);if(m)return m;o.set(i,r),Kw(i)?i.forEach(function(b){r.add(Ht(b,e,t,b,i,o))}):Ww(i)&&i.forEach(function(b,C){r.set(C,Ht(b,e,t,C,i,o))});var g=c?l?nw:cs:l?zt:es,p=u?void 0:g(i);return bm(p||i,function(b,C){p&&(C=b,b=i[C]),Gi(r,C,Ht(b,e,t,C,i,o))}),r}var vb=4;function Aa(i){return Ht(i,vb)}var yb=1,Cb=4;function ze(i){return Ht(i,yb|Cb)}var Eb=1,Tb=4;function Sa(i,e){return e=typeof e=="function"?e:void 0,Ht(i,Eb|Tb,e)}var kb="__lodash_hash_undefined__";function Ab(i){return this.__data__.set(i,kb),this}function Sb(i){return this.__data__.has(i)}function jn(i){var e=-1,t=i==null?0:i.length;for(this.__data__=new Qe;++e<t;)this.add(i[e])}jn.prototype.add=jn.prototype.push=Ab;jn.prototype.has=Sb;function Pb(i,e){for(var t=-1,n=i==null?0:i.length;++t<n;)if(e(i[t],t,i))return!0;return!1}function xb(i,e){return i.has(e)}var Ib=1,Rb=2;function Pa(i,e,t,n,s,o){var r=t&Ib,a=i.length,l=e.length;if(a!=l&&!(r&&l>a))return!1;var c=o.get(i),u=o.get(e);if(c&&u)return c==e&&u==i;var d=-1,h=!0,m=t&Rb?new jn:void 0;for(o.set(i,e),o.set(e,i);++d<a;){var g=i[d],p=e[d];if(n)var b=r?n(p,g,d,e,i,o):n(g,p,d,i,e,o);if(b!==void 0){if(b)continue;h=!1;break}if(m){if(!Pb(e,function(C,E){if(!xb(m,E)&&(g===C||s(g,C,t,n,o)))return m.push(E)})){h=!1;break}}else if(!(g===p||s(g,p,t,n,o))){h=!1;break}}return o.delete(i),o.delete(e),h}function Mb(i){var e=-1,t=Array(i.size);return i.forEach(function(n,s){t[++e]=[s,n]}),t}function Vb(i){var e=-1,t=Array(i.size);return i.forEach(function(n){t[++e]=n}),t}var Ob=1,Nb=2,Db="[object Boolean]",Bb="[object Date]",Fb="[object Error]",Lb="[object Map]",zb="[object Number]",Hb="[object RegExp]",$b="[object Set]",Wb="[object String]",Ub="[object Symbol]",qb="[object ArrayBuffer]",jb="[object DataView]",xa=Fe?Fe.prototype:void 0,ms=xa?xa.valueOf:void 0;function Kb(i,e,t,n,s,o,r){switch(t){case jb:if(i.byteLength!=e.byteLength||i.byteOffset!=e.byteOffset)return!1;i=i.buffer,e=e.buffer;case qb:return!(i.byteLength!=e.byteLength||!o(new qn(i),new qn(e)));case Db:case Bb:case zb:return wn(+i,+e);case Fb:return i.name==e.name&&i.message==e.message;case Hb:case Wb:return i==e+"";case Lb:var a=Mb;case $b:var l=n&Ob;if(a||(a=Vb),i.size!=e.size&&!l)return!1;var c=r.get(i);if(c)return c==e;n|=Nb,r.set(i,e);var u=Pa(a(i),a(e),n,s,o,r);return r.delete(i),u;case Ub:if(ms)return ms.call(i)==ms.call(e)}return!1}var Gb=1,Jb=Object.prototype,Qb=Jb.hasOwnProperty;function Yb(i,e,t,n,s,o){var r=t&Gb,a=cs(i),l=a.length,c=cs(e),u=c.length;if(l!=u&&!r)return!1;for(var d=l;d--;){var h=a[d];if(!(r?h in e:Qb.call(e,h)))return!1}var m=o.get(i),g=o.get(e);if(m&&g)return m==e&&g==i;var p=!0;o.set(i,e),o.set(e,i);for(var b=r;++d<l;){h=a[d];var C=i[h],E=e[h];if(n)var I=r?n(E,C,h,e,i,o):n(C,E,h,i,e,o);if(!(I===void 0?C===E||s(C,E,t,n,o):I)){p=!1;break}b||(b=h=="constructor")}if(p&&!b){var N=i.constructor,K=e.constructor;N!=K&&"constructor"in i&&"constructor"in e&&!(typeof N=="function"&&N instanceof N&&typeof K=="function"&&K instanceof K)&&(p=!1)}return o.delete(i),o.delete(e),p}var Xb=1,Ia="[object Arguments]",Ra="[object Array]",Kn="[object Object]",Zb=Object.prototype,Ma=Zb.hasOwnProperty;function e_(i,e,t,n,s,o){var r=me(i),a=me(e),l=r?Ra:En(i),c=a?Ra:En(e);l=l==Ia?Kn:l,c=c==Ia?Kn:c;var u=l==Kn,d=c==Kn,h=l==c;if(h&&bn(i)){if(!bn(e))return!1;r=!0,u=!1}if(h&&!u)return o||(o=new Le),r||Zi(i)?Pa(i,e,t,n,s,o):Kb(i,e,l,t,n,s,o);if(!(t&Xb)){var m=u&&Ma.call(i,"__wrapped__"),g=d&&Ma.call(e,"__wrapped__");if(m||g){var p=m?i.value():i,b=g?e.value():e;return o||(o=new Le),s(p,b,t,n,o)}}return h?(o||(o=new Le),Yb(i,e,t,n,s,o)):!1}function gs(i,e,t,n,s){return i===e?!0:i==null||e==null||!Ce(i)&&!Ce(e)?i!==i&&e!==e:e_(i,e,t,n,gs,s)}function t_(i){return function(e,t,n){for(var s=-1,o=Object(e),r=n(e),a=r.length;a--;){var l=r[i?a:++s];if(t(o[l],l,o)===!1)break}return e}}var n_=t_(),i_=n_,s_=function(){return Ie.Date.now()},ps=s_,o_="Expected a function",r_=Math.max,a_=Math.min;function Gn(i,e,t){var n,s,o,r,a,l,c=0,u=!1,d=!1,h=!0;if(typeof i!="function")throw new TypeError(o_);e=Ir(e)||0,Z(t)&&(u=!!t.leading,d="maxWait"in t,o=d?r_(Ir(t.maxWait)||0,e):o,h="trailing"in t?!!t.trailing:h);function m(T){var S=n,k=s;return n=s=void 0,c=T,r=i.apply(k,S),r}function g(T){return c=T,a=setTimeout(C,e),u?m(T):r}function p(T){var S=T-l,k=T-c,B=e-S;return d?a_(B,o-k):B}function b(T){var S=T-l,k=T-c;return l===void 0||S>=e||S<0||d&&k>=o}function C(){var T=ps();if(b(T))return E(T);a=setTimeout(C,p(T))}function E(T){return a=void 0,h&&n?m(T):(n=s=void 0,r)}function I(){a!==void 0&&clearTimeout(a),c=0,n=l=s=a=void 0}function N(){return a===void 0?r:E(ps())}function K(){var T=ps(),S=b(T);if(n=arguments,s=this,l=T,S){if(a===void 0)return g(l);if(d)return clearTimeout(a),a=setTimeout(C,e),m(l)}return a===void 0&&(a=setTimeout(C,e)),r}return K.cancel=I,K.flush=N,K}function ws(i,e,t){(t!==void 0&&!wn(i[e],t)||t===void 0&&!(e in i))&&Ki(i,e,t)}function l_(i){return Ce(i)&&Hn(i)}function bs(i,e){if(!(e==="constructor"&&typeof i[e]=="function")&&e!="__proto__")return i[e]}function c_(i){return Ft(i,zt(i))}function u_(i,e,t,n,s,o,r){var a=bs(i,t),l=bs(e,t),c=r.get(l);if(c){ws(i,t,c);return}var u=o?o(a,l,t+"",i,e,r):void 0,d=u===void 0;if(d){var h=me(l),m=!h&&bn(l),g=!h&&!m&&Zi(l);u=l,h||m||g?me(a)?u=a:l_(a)?u=Vr(a):m?(d=!1,u=aa(l,!0)):g?(d=!1,u=_a(l,!0)):u=[]:Ee(l)||Qi(l)?(u=a,Qi(a)?u=c_(a):(!Z(a)||pn(a))&&(u=va(l))):d=!1}d&&(r.set(l,u),s(u,l,n,o,r),r.delete(l)),ws(i,t,u)}function Va(i,e,t,n,s){i!==e&&i_(e,function(o,r){if(s||(s=new Le),Z(o))u_(i,e,r,t,Va,n,s);else{var a=n?n(bs(i,r),o,r+"",i,e,s):void 0;a===void 0&&(a=o),ws(i,r,a)}},zt)}function d_(i){var e=i==null?0:i.length;return e?i[e-1]:void 0}var Oa=/[\\^$.*+?()[\]{}|]/g,h_=RegExp(Oa.source);function f_(i){return i=ns(i),i&&h_.test(i)?i.replace(Oa,"\\$&"):i}var m_="[object String]";function Na(i){return typeof i=="string"||!me(i)&&Ce(i)&&ct(i)==m_}function g_(i,e){return e.length<2?i:jr(i,Jr(e,0,-1))}function Et(i){return Ce(i)&&i.nodeType===1&&!Ee(i)}function Da(i,e){return gs(i,e)}function p_(i,e,t){t=typeof t=="function"?t:void 0;var n=t?t(i,e):void 0;return n===void 0?gs(i,e,void 0,t):!!n}var w_=Dr(function(i,e,t){Va(i,e,t)}),Ba=w_;function b_(i,e){return e=is(e,i),i=g_(i,e),i==null||delete i[ss(d_(e))]}function __(i,e,t,n){if(!Z(i))return i;e=is(e,i);for(var s=-1,o=e.length,r=o-1,a=i;a!=null&&++s<o;){var l=ss(e[s]),c=t;if(l==="__proto__"||l==="constructor"||l==="prototype")return i;if(s!=r){var u=a[l];c=n?n(u,l,a):void 0,c===void 0&&(c=Z(u)?u:ji(e[s+1])?[]:{})}Gi(a,l,c),a=a[l]}return i}function v_(i,e,t){return i==null?i:__(i,e,t)}var y_="Expected a function";function Fa(i,e,t){var n=!0,s=!0;if(typeof i!="function")throw new TypeError(y_);return Z(t)&&(n="leading"in t?!!t.leading:n,s="trailing"in t?!!t.trailing:s),Gn(i,e,{leading:n,maxWait:e,trailing:s})}function C_(i,e){return i==null?!0:b_(i,e)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Jn=Symbol("observableProperties"),Qn=Symbol("boundObservables"),Yn=Symbol("boundProperties"),$t=Symbol("decoratedMethods"),La=Symbol("decoratedOriginal"),$={set(i,e){if(Z(i)){Object.keys(i).forEach(n=>{this.set(n,i[n])},this);return}za(this);const t=this[Jn];if(i in this&&!t.has(i))throw new f("observable-set-cannot-override",this);Object.defineProperty(this,i,{enumerable:!0,configurable:!0,get(){return t.get(i)},set(n){const s=t.get(i);let o=this.fire("set:"+i,i,n,s);o===void 0&&(o=n),(s!==o||!t.has(i))&&(t.set(i,o),this.fire("change:"+i,i,o,s))}}),this[i]=e},bind(...i){if(!i.length||!Ha(i))throw new f("observable-bind-wrong-properties",this);if(new Set(i).size!==i.length)throw new f("observable-bind-duplicate-properties",this);za(this);const e=this[Yn];i.forEach(n=>{if(e.has(n))throw new f("observable-bind-rebind",this)});const t=new Map;return i.forEach(n=>{const s={property:n,to:[]};e.set(n,s),t.set(n,s)}),{to:E_,toMany:T_,_observable:this,_bindProperties:i,_to:[],_bindings:t}},unbind(...i){if(!this[Jn])return;const e=this[Yn],t=this[Qn];if(i.length){if(!Ha(i))throw new f("observable-unbind-wrong-properties",this);i.forEach(n=>{const s=e.get(n);if(!s)return;let o,r,a,l;s.to.forEach(c=>{o=c[0],r=c[1],a=t.get(o),l=a[r],l.delete(s),l.size||delete a[r],Object.keys(a).length||(t.delete(o),this.stopListening(o,"change"))}),e.delete(n)})}else t.forEach((n,s)=>{this.stopListening(s,"change")}),t.clear(),e.clear()},decorate(i){const e=this[i];if(!e)throw new f("observablemixin-cannot-decorate-undefined",this,{object:this,methodName:i});this.on(i,(t,n)=>{t.return=e.apply(this,n)}),this[i]=function(...t){return this.fire(i,t)},this[i][La]=e,this[$t]||(this[$t]=[]),this[$t].push(i)}};vn($,H);$.stopListening=function(i,e,t){if(!i&&this[$t]){for(const n of this[$t])this[n]=this[n][La];delete this[$t]}H.stopListening.call(this,i,e,t)};function za(i){i[Jn]||(Object.defineProperty(i,Jn,{value:new Map}),Object.defineProperty(i,Qn,{value:new Map}),Object.defineProperty(i,Yn,{value:new Map}))}function E_(...i){const e=A_(...i),t=Array.from(this._bindings.keys()),n=t.length;if(!e.callback&&e.to.length>1)throw new f("observable-bind-to-no-callback",this);if(n>1&&e.callback)throw new f("observable-bind-to-extra-callback",this);e.to.forEach(s=>{if(s.properties.length&&s.properties.length!==n)throw new f("observable-bind-to-properties-length",this);s.properties.length||(s.properties=this._bindProperties)}),this._to=e.to,e.callback&&(this._bindings.get(t[0]).callback=e.callback),x_(this._observable,this._to),P_(this),this._bindProperties.forEach(s=>{$a(this._observable,s)})}function T_(i,e,t){if(this._bindings.size>1)throw new f("observable-bind-to-many-not-one-binding",this);this.to(...k_(i,e),t)}function k_(i,e){const t=i.map(n=>[n,e]);return Array.prototype.concat.apply([],t)}function Ha(i){return i.every(e=>typeof e=="string")}function A_(...i){if(!i.length)throw new f("observable-bind-to-parse-error",null);const e={to:[]};let t;return typeof i[i.length-1]=="function"&&(e.callback=i.pop()),i.forEach(n=>{if(typeof n=="string")t.properties.push(n);else if(typeof n=="object")t={observable:n,properties:[]},e.to.push(t);else throw new f("observable-bind-to-parse-error",null)}),e}function S_(i,e,t,n){const s=i[Qn],o=s.get(t),r=o||{};r[n]||(r[n]=new Set),r[n].add(e),o||s.set(t,r)}function P_(i){let e;i._bindings.forEach((t,n)=>{i._to.forEach(s=>{e=s.properties[t.callback?0:i._bindProperties.indexOf(n)],t.to.push([s.observable,e]),S_(i._observable,t,s.observable,e)})})}function $a(i,e){const n=i[Yn].get(e);let s;n.callback?s=n.callback.apply(i,n.to.map(o=>o[0][o[1]])):(s=n.to[0],s=s[0][s[1]]),Object.prototype.hasOwnProperty.call(i,e)?i[e]=s:i.set(e,s)}function x_(i,e){e.forEach(t=>{const n=i[Qn];let s;n.get(t.observable)||i.listenTo(t.observable,"change",(o,r)=>{s=n.get(t.observable)[r],s&&s.forEach(a=>{$a(i,a.property)})})})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function A(i,...e){e.forEach(t=>{Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t)).forEach(n=>{if(n in i.prototype)return;const s=Object.getOwnPropertyDescriptor(t,n);s.enumerable=!1,Object.defineProperty(i.prototype,n,s)})})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class v{constructor(e){this.editor=e,this.set("isEnabled",!0),this._disableStack=new Set}forceDisabled(e){this._disableStack.add(e),this._disableStack.size==1&&(this.on("set:isEnabled",Wa,{priority:"highest"}),this.isEnabled=!1)}clearForceDisabled(e){this._disableStack.delete(e),this._disableStack.size==0&&(this.off("set:isEnabled",Wa),this.isEnabled=!0)}destroy(){this.stopListening()}static get isContextPlugin(){return!1}}A(v,$);function Wa(i){i.return=!1,i.stop()}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class R{constructor(e){this.editor=e,this.set("value",void 0),this.set("isEnabled",!1),this.affectsData=!0,this._disableStack=new Set,this.decorate("execute"),this.listenTo(this.editor.model.document,"change",()=>{this.refresh()}),this.on("execute",t=>{this.isEnabled||t.stop()},{priority:"high"}),this.listenTo(e,"change:isReadOnly",(t,n,s)=>{s&&this.affectsData?this.forceDisabled("readOnlyMode"):this.clearForceDisabled("readOnlyMode")})}refresh(){this.isEnabled=!0}forceDisabled(e){this._disableStack.add(e),this._disableStack.size==1&&(this.on("set:isEnabled",Ua,{priority:"highest"}),this.isEnabled=!1)}clearForceDisabled(e){this._disableStack.delete(e),this._disableStack.size==0&&(this.off("set:isEnabled",Ua),this.refresh())}execute(){}destroy(){this.stopListening()}}A(R,$);function Ua(i){i.return=!1,i.stop()}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class qa extends R{constructor(e){super(e);this._childCommands=[]}refresh(){}execute(...e){const t=this._getFirstEnabledCommand();return t!=null&&t.execute(e)}registerChildCommand(e){this._childCommands.push(e),e.on("change:isEnabled",()=>this._checkEnabled()),this._checkEnabled()}_checkEnabled(){this.isEnabled=!!this._getFirstEnabledCommand()}_getFirstEnabledCommand(){return this._childCommands.find(e=>e.isEnabled)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ja{constructor(e,t){this._config={},t&&this.define(Ka(t)),e&&this._setObjectToTarget(this._config,e)}set(e,t){this._setToTarget(this._config,e,t)}define(e,t){const n=!0;this._setToTarget(this._config,e,t,n)}get(e){return this._getFromSource(this._config,e)}*names(){for(const e of Object.keys(this._config))yield e}_setToTarget(e,t,n,s=!1){if(Ee(t)){this._setObjectToTarget(e,t,s);return}const o=t.split(".");t=o.pop();for(const r of o)Ee(e[r])||(e[r]={}),e=e[r];if(Ee(n)){Ee(e[t])||(e[t]={}),e=e[t],this._setObjectToTarget(e,n,s);return}s&&typeof e[t]!="undefined"||(e[t]=n)}_getFromSource(e,t){const n=t.split(".");t=n.pop();for(const s of n){if(!Ee(e[s])){e=null;break}e=e[s]}return e?Ka(e[t]):void 0}_setObjectToTarget(e,t,n){Object.keys(t).forEach(s=>{this._setToTarget(e,s,t[s],n)})}}function Ka(i){return Sa(i,I_)}function I_(i){return Et(i)?i:void 0}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Te(i){return!!(i&&i[Symbol.iterator])}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class _e{constructor(e={},t={}){const n=Te(e);if(n||(t=e),this._items=[],this._itemMap=new Map,this._idProperty=t.idProperty||"id",this._bindToExternalToInternalMap=new WeakMap,this._bindToInternalToExternalMap=new WeakMap,this._skippedIndexesFromExternal=[],n)for(const s of e)this._items.push(s),this._itemMap.set(this._getItemIdBeforeAdding(s),s)}get length(){return this._items.length}get first(){return this._items[0]||null}get last(){return this._items[this.length-1]||null}add(e,t){return this.addMany([e],t)}addMany(e,t){if(t===void 0)t=this._items.length;else if(t>this._items.length||t<0)throw new f("collection-add-item-invalid-index",this);for(let n=0;n<e.length;n++){const s=e[n],o=this._getItemIdBeforeAdding(s),r=t+n;this._items.splice(r,0,s),this._itemMap.set(o,s),this.fire("add",s,r)}return this.fire("change",{added:e,removed:[],index:t}),this}get(e){let t;if(typeof e=="string")t=this._itemMap.get(e);else if(typeof e=="number")t=this._items[e];else throw new f("collection-get-invalid-arg",this);return t||null}has(e){if(typeof e=="string")return this._itemMap.has(e);{const t=this._idProperty,n=e[t];return this._itemMap.has(n)}}getIndex(e){let t;return typeof e=="string"?t=this._itemMap.get(e):t=e,this._items.indexOf(t)}remove(e){const[t,n]=this._remove(e);return this.fire("change",{added:[],removed:[t],index:n}),t}map(e,t){return this._items.map(e,t)}find(e,t){return this._items.find(e,t)}filter(e,t){return this._items.filter(e,t)}clear(){this._bindToCollection&&(this.stopListening(this._bindToCollection),this._bindToCollection=null);const e=Array.from(this._items);for(;this.length;)this._remove(0);this.fire("change",{added:[],removed:e,index:0})}bindTo(e){if(this._bindToCollection)throw new f("collection-bind-to-rebind",this);return this._bindToCollection=e,{as:t=>{this._setUpBindToBinding(n=>new t(n))},using:t=>{typeof t=="function"?this._setUpBindToBinding(n=>t(n)):this._setUpBindToBinding(n=>n[t])}}}_setUpBindToBinding(e){const t=this._bindToCollection,n=(s,o,r)=>{const a=t._bindToCollection==this,l=t._bindToInternalToExternalMap.get(o);if(a&&l)this._bindToExternalToInternalMap.set(o,l),this._bindToInternalToExternalMap.set(l,o);else{const c=e(o);if(!c){this._skippedIndexesFromExternal.push(r);return}let u=r;for(const d of this._skippedIndexesFromExternal)r>d&&u--;for(const d of t._skippedIndexesFromExternal)u>=d&&u++;this._bindToExternalToInternalMap.set(o,c),this._bindToInternalToExternalMap.set(c,o),this.add(c,u);for(let d=0;d<t._skippedIndexesFromExternal.length;d++)u<=t._skippedIndexesFromExternal[d]&&t._skippedIndexesFromExternal[d]++}};for(const s of t)n(null,s,t.getIndex(s));this.listenTo(t,"add",n),this.listenTo(t,"remove",(s,o,r)=>{const a=this._bindToExternalToInternalMap.get(o);a&&this.remove(a),this._skippedIndexesFromExternal=this._skippedIndexesFromExternal.reduce((l,c)=>(r<c&&l.push(c-1),r>c&&l.push(c),l),[])})}_getItemIdBeforeAdding(e){const t=this._idProperty;let n;if(t in e){if(n=e[t],typeof n!="string")throw new f("collection-add-invalid-id",this);if(this.get(n))throw new f("collection-add-item-already-exists",this)}else e[t]=n=Be();return n}_remove(e){let t,n,s,o=!1;const r=this._idProperty;if(typeof e=="string"?(n=e,s=this._itemMap.get(n),o=!s,s&&(t=this._items.indexOf(s))):typeof e=="number"?(t=e,s=this._items[t],o=!s,s&&(n=s[r])):(s=e,n=s[r],t=this._items.indexOf(s),o=t==-1||!this._itemMap.get(n)),o)throw new f("collection-remove-404",this);this._items.splice(t,1),this._itemMap.delete(n);const a=this._bindToInternalToExternalMap.get(s);return this._bindToInternalToExternalMap.delete(s),this._bindToExternalToInternalMap.delete(a),this.fire("remove",s,t),[s,t]}[Symbol.iterator](){return this._items[Symbol.iterator]()}}A(_e,H);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class _s{constructor(e,t=[],n=[]){this._context=e,this._plugins=new Map,this._availablePlugins=new Map;for(const s of t)s.pluginName&&this._availablePlugins.set(s.pluginName,s);this._contextPlugins=new Map;for(const[s,o]of n)this._contextPlugins.set(s,o),this._contextPlugins.set(o,s),s.pluginName&&this._availablePlugins.set(s.pluginName,s)}*[Symbol.iterator](){for(const e of this._plugins)typeof e[0]=="function"&&(yield e)}get(e){const t=this._plugins.get(e);if(!t){let n=e;throw typeof e=="function"&&(n=e.pluginName||e.name),new f("plugincollection-plugin-not-loaded",this._context,{plugin:n})}return t}has(e){return this._plugins.has(e)}init(e,t=[],n=[]){const s=this,o=this._context;m(e),p(e);const r=e.filter(T=>!d(T,t)),a=[...g(r)];K(a,n);const l=I(a);return N(l,"init").then(()=>N(l,"afterInit")).then(()=>l);function c(T){return typeof T=="function"}function u(T){return c(T)&&T.isContextPlugin}function d(T,S){return S.some(k=>k===T||h(T)===k||h(k)===T)}function h(T){return c(T)?T.pluginName||T.name:T}function m(T,S=new Set){T.forEach(k=>{!c(k)||S.has(k)||(S.add(k),k.pluginName&&!s._availablePlugins.has(k.pluginName)&&s._availablePlugins.set(k.pluginName,k),k.requires&&m(k.requires,S))})}function g(T,S=new Set){return T.map(k=>c(k)?k:s._availablePlugins.get(k)).reduce((k,B)=>S.has(B)?k:(S.add(B),B.requires&&(p(B.requires,B),g(B.requires,S).forEach(pt=>k.add(pt))),k.add(B)),new Set)}function p(T,S=null){T.map(k=>c(k)?k:s._availablePlugins.get(k)||k).forEach(k=>{b(k,S),C(k,S),E(k,S)})}function b(T,S){if(!c(T))throw S?new f("plugincollection-soft-required",o,{missingPlugin:T,requiredBy:h(S)}):new f("plugincollection-plugin-not-found",o,{plugin:T})}function C(T,S){if(!!u(S)&&!u(T))throw new f("plugincollection-context-required",o,{plugin:h(T),requiredBy:h(S)})}function E(T,S){if(!!S&&!!d(T,t))throw new f("plugincollection-required",o,{plugin:h(T),requiredBy:h(S)})}function I(T){return T.map(S=>{const k=s._contextPlugins.get(S)||new S(o);return s._add(S,k),k})}function N(T,S){return T.reduce((k,B)=>!B[S]||s._contextPlugins.has(B)?k:k.then(B[S].bind(B)),Promise.resolve())}function K(T,S){for(const k of S){if(typeof k!="function")throw new f("plugincollection-replace-plugin-invalid-type",null,{pluginItem:k});const B=k.pluginName;if(!B)throw new f("plugincollection-replace-plugin-missing-name",null,{pluginItem:k});if(k.requires&&k.requires.length)throw new f("plugincollection-plugin-for-replacing-cannot-have-dependencies",null,{pluginName:B});const pt=s._availablePlugins.get(B);if(!pt)throw new f("plugincollection-plugin-for-replacing-not-exist",null,{pluginName:B});const ar=T.indexOf(pt);if(ar===-1){if(s._contextPlugins.has(pt))return;throw new f("plugincollection-plugin-for-replacing-not-loaded",null,{pluginName:B})}if(pt.requires&&pt.requires.length)throw new f("plugincollection-replaced-plugin-cannot-have-dependencies",null,{pluginName:B});T.splice(ar,1,k),s._availablePlugins.set(B,k)}}}destroy(){const e=[];for(const[,t]of this)typeof t.destroy=="function"&&!this._contextPlugins.has(t)&&e.push(t.destroy());return Promise.all(e)}_add(e,t){this._plugins.set(e,t);const n=e.pluginName;if(!!n){if(this._plugins.has(n))throw new f("plugincollection-plugin-name-conflict",null,{pluginName:n,plugin1:this._plugins.get(n).constructor,plugin2:e});this._plugins.set(n,t)}}}A(_s,H);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function oe(i){return Array.isArray(i)?i:[i]}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */window.CKEDITOR_TRANSLATIONS||(window.CKEDITOR_TRANSLATIONS={});function R_(i,e,t=1){if(typeof t!="number")throw new f("translation-service-quantity-not-a-number",null,{quantity:t});const n=V_();n===1&&(i=Object.keys(window.CKEDITOR_TRANSLATIONS)[0]);const s=e.id||e.string;if(n===0||!M_(i,s))return t!==1?e.plural:e.string;const o=window.CKEDITOR_TRANSLATIONS[i].dictionary,r=window.CKEDITOR_TRANSLATIONS[i].getPluralForm||(l=>l===1?0:1);if(typeof o[s]=="string")return o[s];const a=Number(r(t));return o[s][a]}function M_(i,e){return!!window.CKEDITOR_TRANSLATIONS[i]&&!!window.CKEDITOR_TRANSLATIONS[i].dictionary[e]}function V_(){return Object.keys(window.CKEDITOR_TRANSLATIONS).length}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const O_=["ar","ara","fa","per","fas","he","heb","ku","kur","ug","uig"];function Ga(i){return O_.includes(i)?"rtl":"ltr"}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class N_{constructor(e={}){this.uiLanguage=e.uiLanguage||"en",this.contentLanguage=e.contentLanguage||this.uiLanguage,this.uiLanguageDirection=Ga(this.uiLanguage),this.contentLanguageDirection=Ga(this.contentLanguage),this.t=(t,n)=>this._t(t,n)}get language(){return console.warn("locale-deprecated-language-property: The Locale#language property has been deprecated and will be removed in the near future. Please use #uiLanguage and #contentLanguage properties instead."),this.uiLanguage}_t(e,t=[]){t=oe(t),typeof e=="string"&&(e={string:e});const s=!!e.plural?t[0]:1,o=R_(this.uiLanguage,e,s);return D_(o,t)}}function D_(i,e){return i.replace(/%(\d+)/g,(t,n)=>n<e.length?e[n]:t)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class B_{constructor(e){this.config=new ja(e,this.constructor.defaultConfig);const t=this.constructor.builtinPlugins;this.config.define("plugins",t),this.plugins=new _s(this,t);const n=this.config.get("language")||{};this.locale=new N_({uiLanguage:typeof n=="string"?n:n.ui,contentLanguage:this.config.get("language.content")}),this.t=this.locale.t,this.editors=new _e,this._contextOwner=null}initPlugins(){const e=this.config.get("plugins")||[],t=this.config.get("substitutePlugins")||[];for(const n of e.concat(t)){if(typeof n!="function")throw new f("context-initplugins-constructor-only",null,{Plugin:n});if(n.isContextPlugin!==!0)throw new f("context-initplugins-invalid-plugin",null,{Plugin:n})}return this.plugins.init(e,[],t)}destroy(){return Promise.all(Array.from(this.editors,e=>e.destroy())).then(()=>this.plugins.destroy())}_addEditor(e,t){if(this._contextOwner)throw new f("context-addeditor-private-context");this.editors.add(e),t&&(this._contextOwner=e)}_removeEditor(e){return this.editors.has(e)&&this.editors.remove(e),this._contextOwner===e?this.destroy():Promise.resolve()}_getEditorConfig(){const e={};for(const t of this.config.names())["plugins","removePlugins","extraPlugins"].includes(t)||(e[t]=this.config.get(t));return e}static create(e){return new Promise(t=>{const n=new this(e);t(n.initPlugins().then(()=>n))})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Tn{constructor(e){this.context=e}destroy(){this.stopListening()}static get isContextPlugin(){return!0}}A(Tn,$);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function he(i,e){const t=Math.min(i.length,e.length);for(let n=0;n<t;n++)if(i[n]!=e[n])return n;return i.length==e.length?"same":i.length<e.length?"prefix":"extension"}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Tt{constructor(e){this.document=e,this.parent=null}get index(){let e;if(!this.parent)return null;if((e=this.parent.getChildIndex(this))==-1)throw new f("view-node-not-found-in-parent",this);return e}get nextSibling(){const e=this.index;return e!==null&&this.parent.getChild(e+1)||null}get previousSibling(){const e=this.index;return e!==null&&this.parent.getChild(e-1)||null}get root(){let e=this;for(;e.parent;)e=e.parent;return e}isAttached(){return this.root.is("rootElement")}getPath(){const e=[];let t=this;for(;t.parent;)e.unshift(t.index),t=t.parent;return e}getAncestors(e={includeSelf:!1,parentFirst:!1}){const t=[];let n=e.includeSelf?this:this.parent;for(;n;)t[e.parentFirst?"push":"unshift"](n),n=n.parent;return t}getCommonAncestor(e,t={}){const n=this.getAncestors(t),s=e.getAncestors(t);let o=0;for(;n[o]==s[o]&&n[o];)o++;return o===0?null:n[o-1]}isBefore(e){if(this==e||this.root!==e.root)return!1;const t=this.getPath(),n=e.getPath(),s=he(t,n);switch(s){case"prefix":return!0;case"extension":return!1;default:return t[s]<n[s]}}isAfter(e){return this==e||this.root!==e.root?!1:!this.isBefore(e)}_remove(){this.parent._removeChildren(this.index)}_fireChange(e,t){this.fire("change:"+e,t),this.parent&&this.parent._fireChange(e,t)}toJSON(){const e=Aa(this);return delete e.parent,e}is(e){return e==="node"||e==="view:node"}}A(Tt,H);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class q extends Tt{constructor(e,t){super(e);this._textData=t}is(e){return e==="$text"||e==="view:$text"||e==="text"||e==="view:text"||e==="node"||e==="view:node"}get data(){return this._textData}get _data(){return this.data}set _data(e){this._fireChange("text",this),this._textData=e}isSimilar(e){return e instanceof q?this===e||this.data===e.data:!1}_clone(){return new q(this.document,this.data)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ye{constructor(e,t,n){if(this.textNode=e,t<0||t>e.data.length)throw new f("view-textproxy-wrong-offsetintext",this);if(n<0||t+n>e.data.length)throw new f("view-textproxy-wrong-length",this);this.data=e.data.substring(t,t+n),this.offsetInText=t}get offsetSize(){return this.data.length}get isPartial(){return this.data.length!==this.textNode.data.length}get parent(){return this.textNode.parent}get root(){return this.textNode.root}get document(){return this.textNode.document}is(e){return e==="$textProxy"||e==="view:$textProxy"||e==="textProxy"||e==="view:textProxy"}getAncestors(e={includeSelf:!1,parentFirst:!1}){const t=[];let n=e.includeSelf?this.textNode:this.parent;for(;n!==null;)t[e.parentFirst?"push":"unshift"](n),n=n.parent;return t}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function F_(i){const e=new Map;for(const t in i)e.set(t,i[t]);return e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Xe(i){return Te(i)?new Map(i):F_(i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class He{constructor(...e){this._patterns=[],this.add(...e)}add(...e){for(let t of e)(typeof t=="string"||t instanceof RegExp)&&(t={name:t}),this._patterns.push(t)}match(...e){for(const t of e)for(const n of this._patterns){const s=Ja(t,n);if(s)return{element:t,pattern:n,match:s}}return null}matchAll(...e){const t=[];for(const n of e)for(const s of this._patterns){const o=Ja(n,s);o&&t.push({element:n,pattern:s,match:o})}return t.length>0?t:null}getElementName(){if(this._patterns.length!==1)return null;const e=this._patterns[0],t=e.name;return typeof e!="function"&&t&&!(t instanceof RegExp)?t:null}}function Ja(i,e){if(typeof e=="function")return e(i);const t={};return e.name&&(t.name=L_(e.name,i.name),!t.name)||e.attributes&&(t.attributes=W_(e.attributes,i),!t.attributes)?null:e.classes&&(t.classes=U_(e.classes,i),!t.classes)||e.styles&&(t.styles=q_(e.styles,i),!t.styles)?!1:t}function L_(i,e){return i instanceof RegExp?!!e.match(i):i===e}function vs(i,e,t){const n=z_(i),s=Array.from(e),o=[];return n.forEach(([r,a])=>{s.forEach(l=>{H_(r,l)&&$_(a,l,t)&&o.push(l)})}),!n.length||o.length<n.length?null:o}function z_(i){return Array.isArray(i)?i.map(e=>Ee(e)?((e.key===void 0||e.value===void 0)&&de("matcher-pattern-missing-key-or-value",e),[e.key,e.value]):[e,!0]):Ee(i)?Object.entries(i):[[i,!0]]}function H_(i,e){return i===!0||i===e||i instanceof RegExp&&e.match(i)}function $_(i,e,t){if(i===!0)return!0;const n=t(e);return i===n||i instanceof RegExp&&!!String(n).match(i)}function W_(i,e){const t=new Set(e.getAttributeKeys());return Ee(i)?(i.style!==void 0&&de("matcher-pattern-deprecated-attributes-style-key",i),i.class!==void 0&&de("matcher-pattern-deprecated-attributes-class-key",i)):(t.delete("style"),t.delete("class")),vs(i,t,n=>e.getAttribute(n))}function U_(i,e){return vs(i,e.getClassNames())}function q_(i,e){return vs(i,e.getStyleNames(!0),t=>e.getStyle(t))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class j_{constructor(e){this._styles={},this._styleProcessor=e}get isEmpty(){const e=Object.entries(this._styles);return!Array.from(e).length}get size(){return this.isEmpty?0:this.getStyleNames().length}setTo(e){this.clear();const t=Array.from(G_(e).entries());for(const[n,s]of t)this._styleProcessor.toNormalizedForm(n,s,this._styles)}has(e){if(this.isEmpty)return!1;const n=this._styleProcessor.getReducedForm(e,this._styles).find(([s])=>s===e);return Array.isArray(n)}set(e,t){if(Z(e))for(const[n,s]of Object.entries(e))this._styleProcessor.toNormalizedForm(n,s,this._styles);else this._styleProcessor.toNormalizedForm(e,t,this._styles)}remove(e){const t=ys(e);C_(this._styles,t),delete this._styles[e],this._cleanEmptyObjectsOnPath(t)}getNormalized(e){return this._styleProcessor.getNormalized(e,this._styles)}toString(){return this.isEmpty?"":this._getStylesEntries().map(e=>e.join(":")).sort().join(";")+";"}getAsString(e){if(this.isEmpty)return;if(this._styles[e]&&!Z(this._styles[e]))return this._styles[e];const n=this._styleProcessor.getReducedForm(e,this._styles).find(([s])=>s===e);if(Array.isArray(n))return n[1]}getStyleNames(e=!1){return this.isEmpty?[]:e?this._styleProcessor.getStyleNames(this._styles):this._getStylesEntries().map(([n])=>n)}clear(){this._styles={}}_getStylesEntries(){const e=[],t=Object.keys(this._styles);for(const n of t)e.push(...this._styleProcessor.getReducedForm(n,this._styles));return e}_cleanEmptyObjectsOnPath(e){const t=e.split(".");if(!(t.length>1))return;const s=t.splice(0,t.length-1).join("."),o=Un(this._styles,s);if(!o)return;!Array.from(Object.keys(o)).length&&this.remove(s)}}class K_{constructor(){this._normalizers=new Map,this._extractors=new Map,this._reducers=new Map,this._consumables=new Map}toNormalizedForm(e,t,n){if(Z(t)){Cs(n,ys(e),t);return}if(this._normalizers.has(e)){const s=this._normalizers.get(e),{path:o,value:r}=s(t);Cs(n,o,r)}else Cs(n,e,t)}getNormalized(e,t){if(!e)return Ba({},t);if(t[e]!==void 0)return t[e];if(this._extractors.has(e)){const n=this._extractors.get(e);if(typeof n=="string")return Un(t,n);const s=n(e,t);if(s)return s}return Un(t,ys(e))}getReducedForm(e,t){const n=this.getNormalized(e,t);return n===void 0?[]:this._reducers.has(e)?this._reducers.get(e)(n):[[e,n]]}getStyleNames(e){const t=Array.from(this._consumables.keys()).filter(s=>{const o=this.getNormalized(s,e);return o&&typeof o=="object"?Object.keys(o).length:o}),n=new Set([...t,...Object.keys(e)]);return Array.from(n.values())}getRelatedStyles(e){return this._consumables.get(e)||[]}setNormalizer(e,t){this._normalizers.set(e,t)}setExtractor(e,t){this._extractors.set(e,t)}setReducer(e,t){this._reducers.set(e,t)}setStyleRelation(e,t){this._mapStyleNames(e,t);for(const n of t)this._mapStyleNames(n,[e])}_mapStyleNames(e,t){this._consumables.has(e)||this._consumables.set(e,[]),this._consumables.get(e).push(...t)}}function G_(i){let e=null,t=0,n=0,s=null;const o=new Map;if(i==="")return o;i.charAt(i.length-1)!=";"&&(i=i+";");for(let r=0;r<i.length;r++){const a=i.charAt(r);if(e===null)switch(a){case":":s||(s=i.substr(t,r-t),n=r+1);break;case'"':case"'":e=a;break;case";":{const l=i.substr(n,r-n);s&&o.set(s.trim(),l.trim()),s=null,t=r+1;break}}else a===e&&(e=null)}return o}function ys(i){return i.replace("-",".")}function Cs(i,e,t){let n=t;Z(t)&&(n=Ba({},Un(i,e),t)),v_(i,e,n)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ke extends Tt{constructor(e,t,n,s){super(e);if(this.name=t,this._attrs=J_(n),this._children=[],s&&this._insertChild(0,s),this._classes=new Set,this._attrs.has("class")){const o=this._attrs.get("class");Qa(this._classes,o),this._attrs.delete("class")}this._styles=new j_(this.document.stylesProcessor),this._attrs.has("style")&&(this._styles.setTo(this._attrs.get("style")),this._attrs.delete("style")),this._customProperties=new Map,this._isAllowedInsideAttributeElement=!1,this._unsafeAttributesToRender=[]}get childCount(){return this._children.length}get isEmpty(){return this._children.length===0}get isAllowedInsideAttributeElement(){return this._isAllowedInsideAttributeElement}is(e,t=null){return t?t===this.name&&(e==="element"||e==="view:element"):e==="element"||e==="view:element"||e==="node"||e==="view:node"}getChild(e){return this._children[e]}getChildIndex(e){return this._children.indexOf(e)}getChildren(){return this._children[Symbol.iterator]()}*getAttributeKeys(){this._classes.size>0&&(yield"class"),this._styles.isEmpty||(yield"style"),yield*this._attrs.keys()}*getAttributes(){yield*this._attrs.entries(),this._classes.size>0&&(yield["class",this.getAttribute("class")]),this._styles.isEmpty||(yield["style",this.getAttribute("style")])}getAttribute(e){if(e=="class")return this._classes.size>0?[...this._classes].join(" "):void 0;if(e=="style"){const t=this._styles.toString();return t==""?void 0:t}return this._attrs.get(e)}hasAttribute(e){return e=="class"?this._classes.size>0:e=="style"?!this._styles.isEmpty:this._attrs.has(e)}isSimilar(e){if(!(e instanceof ke))return!1;if(this===e)return!0;if(this.name!=e.name||this.isAllowedInsideAttributeElement!=e.isAllowedInsideAttributeElement||this._attrs.size!==e._attrs.size||this._classes.size!==e._classes.size||this._styles.size!==e._styles.size)return!1;for(const[t,n]of this._attrs)if(!e._attrs.has(t)||e._attrs.get(t)!==n)return!1;for(const t of this._classes)if(!e._classes.has(t))return!1;for(const t of this._styles.getStyleNames())if(!e._styles.has(t)||e._styles.getAsString(t)!==this._styles.getAsString(t))return!1;return!0}hasClass(...e){for(const t of e)if(!this._classes.has(t))return!1;return!0}getClassNames(){return this._classes.keys()}getStyle(e){return this._styles.getAsString(e)}getNormalizedStyle(e){return this._styles.getNormalized(e)}getStyleNames(e=!1){return this._styles.getStyleNames(e)}hasStyle(...e){for(const t of e)if(!this._styles.has(t))return!1;return!0}findAncestor(...e){const t=new He(...e);let n=this.parent;for(;n;){if(t.match(n))return n;n=n.parent}return null}getCustomProperty(e){return this._customProperties.get(e)}*getCustomProperties(){yield*this._customProperties.entries()}getIdentity(){const e=Array.from(this._classes).sort().join(","),t=this._styles.toString(),n=Array.from(this._attrs).map(s=>`${s[0]}="${s[1]}"`).sort().join(" ");return this.name+(e==""?"":` class="${e}"`)+(t?` style="${t}"`:"")+(n==""?"":` ${n}`)}shouldRenderUnsafeAttribute(e){return this._unsafeAttributesToRender.includes(e)}_clone(e=!1){const t=[];if(e)for(const s of this.getChildren())t.push(s._clone(e));const n=new this.constructor(this.document,this.name,this._attrs,t);return n._classes=new Set(this._classes),n._styles.set(this._styles.getNormalized()),n._customProperties=new Map(this._customProperties),n.getFillerOffset=this.getFillerOffset,n._isAllowedInsideAttributeElement=this.isAllowedInsideAttributeElement,n}_appendChild(e){return this._insertChild(this.childCount,e)}_insertChild(e,t){this._fireChange("children",this);let n=0;const s=Q_(this.document,t);for(const o of s)o.parent!==null&&o._remove(),o.parent=this,o.document=this.document,this._children.splice(e,0,o),e++,n++;return n}_removeChildren(e,t=1){this._fireChange("children",this);for(let n=e;n<e+t;n++)this._children[n].parent=null;return this._children.splice(e,t)}_setAttribute(e,t){t=String(t),this._fireChange("attributes",this),e=="class"?Qa(this._classes,t):e=="style"?this._styles.setTo(t):this._attrs.set(e,t)}_removeAttribute(e){return this._fireChange("attributes",this),e=="class"?this._classes.size>0?(this._classes.clear(),!0):!1:e=="style"?this._styles.isEmpty?!1:(this._styles.clear(),!0):this._attrs.delete(e)}_addClass(e){this._fireChange("attributes",this);for(const t of oe(e))this._classes.add(t)}_removeClass(e){this._fireChange("attributes",this);for(const t of oe(e))this._classes.delete(t)}_setStyle(e,t){this._fireChange("attributes",this),this._styles.set(e,t)}_removeStyle(e){this._fireChange("attributes",this);for(const t of oe(e))this._styles.remove(t)}_setCustomProperty(e,t){this._customProperties.set(e,t)}_removeCustomProperty(e){return this._customProperties.delete(e)}}function J_(i){i=Xe(i);for(const[e,t]of i)t===null?i.delete(e):typeof t!="string"&&i.set(e,String(t));return i}function Qa(i,e){const t=e.split(/\s+/);i.clear(),t.forEach(n=>i.add(n))}function Q_(i,e){return typeof e=="string"?[new q(i,e)]:(Te(e)||(e=[e]),Array.from(e).map(t=>typeof t=="string"?new q(i,t):t instanceof Ye?new q(i,t.data):t))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Xn extends ke{constructor(e,t,n,s){super(e,t,n,s);this.getFillerOffset=Ya}is(e,t=null){return t?t===this.name&&(e==="containerElement"||e==="view:containerElement"||e==="element"||e==="view:element"):e==="containerElement"||e==="view:containerElement"||e==="element"||e==="view:element"||e==="node"||e==="view:node"}}function Ya(){const i=[...this.getChildren()],e=i[this.childCount-1];if(e&&e.is("element","br"))return this.childCount;for(const t of i)if(!t.is("uiElement"))return null;return this.childCount}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Zn extends Xn{constructor(e,t,n,s){super(e,t,n,s);this.set("isReadOnly",!1),this.set("isFocused",!1),this.bind("isReadOnly").to(e),this.bind("isFocused").to(e,"isFocused",o=>o&&e.selection.editableElement==this),this.listenTo(e.selection,"change",()=>{this.isFocused=e.isFocused&&e.selection.editableElement==this})}is(e,t=null){return t?t===this.name&&(e==="editableElement"||e==="view:editableElement"||e==="containerElement"||e==="view:containerElement"||e==="element"||e==="view:element"):e==="editableElement"||e==="view:editableElement"||e==="containerElement"||e==="view:containerElement"||e==="element"||e==="view:element"||e==="node"||e==="view:node"}destroy(){this.stopListening()}}A(Zn,$);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Xa=Symbol("rootName");class Y_ extends Zn{constructor(e,t){super(e,t);this.rootName="main"}is(e,t=null){return t?t===this.name&&(e==="rootElement"||e==="view:rootElement"||e==="editableElement"||e==="view:editableElement"||e==="containerElement"||e==="view:containerElement"||e==="element"||e==="view:element"):e==="rootElement"||e==="view:rootElement"||e==="editableElement"||e==="view:editableElement"||e==="containerElement"||e==="view:containerElement"||e==="element"||e==="view:element"||e==="node"||e==="view:node"}get rootName(){return this.getCustomProperty(Xa)}set rootName(e){this._setCustomProperty(Xa,e)}set _name(e){this.name=e}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class kt{constructor(e={}){if(!e.boundaries&&!e.startPosition)throw new f("view-tree-walker-no-start-position",null);if(e.direction&&e.direction!="forward"&&e.direction!="backward")throw new f("view-tree-walker-unknown-direction",e.startPosition,{direction:e.direction});this.boundaries=e.boundaries||null,e.startPosition?this.position=y._createAt(e.startPosition):this.position=y._createAt(e.boundaries[e.direction=="backward"?"end":"start"]),this.direction=e.direction||"forward",this.singleCharacters=!!e.singleCharacters,this.shallow=!!e.shallow,this.ignoreElementEnd=!!e.ignoreElementEnd,this._boundaryStartParent=this.boundaries?this.boundaries.start.parent:null,this._boundaryEndParent=this.boundaries?this.boundaries.end.parent:null}[Symbol.iterator](){return this}skip(e){let t,n,s;do s=this.position,{done:t,value:n}=this.next();while(!t&&e(n));t||(this.position=s)}next(){return this.direction=="forward"?this._next():this._previous()}_next(){let e=this.position.clone();const t=this.position,n=e.parent;if(n.parent===null&&e.offset===n.childCount)return{done:!0};if(n===this._boundaryEndParent&&e.offset==this.boundaries.end.offset)return{done:!0};let s;if(n instanceof q){if(e.isAtEnd)return this.position=y._createAfter(n),this._next();s=n.data[e.offset]}else s=n.getChild(e.offset);if(s instanceof ke)return this.shallow?e.offset++:e=new y(s,0),this.position=e,this._formatReturnValue("elementStart",s,t,e,1);if(s instanceof q){if(this.singleCharacters)return e=new y(s,0),this.position=e,this._next();{let o=s.data.length,r;return s==this._boundaryEndParent?(o=this.boundaries.end.offset,r=new Ye(s,0,o),e=y._createAfter(r)):(r=new Ye(s,0,s.data.length),e.offset++),this.position=e,this._formatReturnValue("text",r,t,e,o)}}else if(typeof s=="string"){let o;this.singleCharacters?o=1:o=(n===this._boundaryEndParent?this.boundaries.end.offset:n.data.length)-e.offset;const r=new Ye(n,e.offset,o);return e.offset+=o,this.position=e,this._formatReturnValue("text",r,t,e,o)}else return e=y._createAfter(n),this.position=e,this.ignoreElementEnd?this._next():this._formatReturnValue("elementEnd",n,t,e)}_previous(){let e=this.position.clone();const t=this.position,n=e.parent;if(n.parent===null&&e.offset===0)return{done:!0};if(n==this._boundaryStartParent&&e.offset==this.boundaries.start.offset)return{done:!0};let s;if(n instanceof q){if(e.isAtStart)return this.position=y._createBefore(n),this._previous();s=n.data[e.offset-1]}else s=n.getChild(e.offset-1);if(s instanceof ke)return this.shallow?(e.offset--,this.position=e,this._formatReturnValue("elementStart",s,t,e,1)):(e=new y(s,s.childCount),this.position=e,this.ignoreElementEnd?this._previous():this._formatReturnValue("elementEnd",s,t,e));if(s instanceof q){if(this.singleCharacters)return e=new y(s,s.data.length),this.position=e,this._previous();{let o=s.data.length,r;if(s==this._boundaryStartParent){const a=this.boundaries.start.offset;r=new Ye(s,a,s.data.length-a),o=r.data.length,e=y._createBefore(r)}else r=new Ye(s,0,s.data.length),e.offset--;return this.position=e,this._formatReturnValue("text",r,t,e,o)}}else if(typeof s=="string"){let o;if(this.singleCharacters)o=1;else{const a=n===this._boundaryStartParent?this.boundaries.start.offset:0;o=e.offset-a}e.offset-=o;const r=new Ye(n,e.offset,o);return this.position=e,this._formatReturnValue("text",r,t,e,o)}else return e=y._createBefore(n),this.position=e,this._formatReturnValue("elementStart",n,t,e,1)}_formatReturnValue(e,t,n,s,o){return t instanceof Ye&&(t.offsetInText+t.data.length==t.textNode.data.length&&(this.direction=="forward"&&!(this.boundaries&&this.boundaries.end.isEqual(this.position))?(s=y._createAfter(t.textNode),this.position=s):n=y._createAfter(t.textNode)),t.offsetInText===0&&(this.direction=="backward"&&!(this.boundaries&&this.boundaries.start.isEqual(this.position))?(s=y._createBefore(t.textNode),this.position=s):n=y._createBefore(t.textNode))),{done:!1,value:{type:e,item:t,previousPosition:n,nextPosition:s,length:o}}}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class y{constructor(e,t){this.parent=e,this.offset=t}get nodeAfter(){return this.parent.is("$text")?null:this.parent.getChild(this.offset)||null}get nodeBefore(){return this.parent.is("$text")?null:this.parent.getChild(this.offset-1)||null}get isAtStart(){return this.offset===0}get isAtEnd(){const e=this.parent.is("$text")?this.parent.data.length:this.parent.childCount;return this.offset===e}get root(){return this.parent.root}get editableElement(){let e=this.parent;for(;!(e instanceof Zn);)if(e.parent)e=e.parent;else return null;return e}getShiftedBy(e){const t=y._createAt(this),n=t.offset+e;return t.offset=n<0?0:n,t}getLastMatchingPosition(e,t={}){t.startPosition=this;const n=new kt(t);return n.skip(e),n.position}getAncestors(){return this.parent.is("documentFragment")?[this.parent]:this.parent.getAncestors({includeSelf:!0})}getCommonAncestor(e){const t=this.getAncestors(),n=e.getAncestors();let s=0;for(;t[s]==n[s]&&t[s];)s++;return s===0?null:t[s-1]}is(e){return e==="position"||e==="view:position"}isEqual(e){return this.parent==e.parent&&this.offset==e.offset}isBefore(e){return this.compareWith(e)=="before"}isAfter(e){return this.compareWith(e)=="after"}compareWith(e){if(this.root!==e.root)return"different";if(this.isEqual(e))return"same";const t=this.parent.is("node")?this.parent.getPath():[],n=e.parent.is("node")?e.parent.getPath():[];t.push(this.offset),n.push(e.offset);const s=he(t,n);switch(s){case"prefix":return"before";case"extension":return"after";default:return t[s]<n[s]?"before":"after"}}getWalker(e={}){return e.startPosition=this,new kt(e)}clone(){return new y(this.parent,this.offset)}static _createAt(e,t){if(e instanceof y)return new this(e.parent,e.offset);{const n=e;if(t=="end")t=n.is("$text")?n.data.length:n.childCount;else{if(t=="before")return this._createBefore(n);if(t=="after")return this._createAfter(n);if(t!==0&&!t)throw new f("view-createpositionat-offset-required",n)}return new y(n,t)}}static _createAfter(e){if(e.is("$textProxy"))return new y(e.textNode,e.offsetInText+e.data.length);if(!e.parent)throw new f("view-position-after-root",e,{root:e});return new y(e.parent,e.index+1)}static _createBefore(e){if(e.is("$textProxy"))return new y(e.textNode,e.offsetInText);if(!e.parent)throw new f("view-position-before-root",e,{root:e});return new y(e.parent,e.index)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class P{constructor(e,t=null){this.start=e.clone(),this.end=t?t.clone():e.clone()}*[Symbol.iterator](){yield*new kt({boundaries:this,ignoreElementEnd:!0})}get isCollapsed(){return this.start.isEqual(this.end)}get isFlat(){return this.start.parent===this.end.parent}get root(){return this.start.root}getEnlarged(){let e=this.start.getLastMatchingPosition(ei,{direction:"backward"}),t=this.end.getLastMatchingPosition(ei);return e.parent.is("$text")&&e.isAtStart&&(e=y._createBefore(e.parent)),t.parent.is("$text")&&t.isAtEnd&&(t=y._createAfter(t.parent)),new P(e,t)}getTrimmed(){let e=this.start.getLastMatchingPosition(ei);if(e.isAfter(this.end)||e.isEqual(this.end))return new P(e,e);let t=this.end.getLastMatchingPosition(ei,{direction:"backward"});const n=e.nodeAfter,s=t.nodeBefore;return n&&n.is("$text")&&(e=new y(n,0)),s&&s.is("$text")&&(t=new y(s,s.data.length)),new P(e,t)}isEqual(e){return this==e||this.start.isEqual(e.start)&&this.end.isEqual(e.end)}containsPosition(e){return e.isAfter(this.start)&&e.isBefore(this.end)}containsRange(e,t=!1){e.isCollapsed&&(t=!1);const n=this.containsPosition(e.start)||t&&this.start.isEqual(e.start),s=this.containsPosition(e.end)||t&&this.end.isEqual(e.end);return n&&s}getDifference(e){const t=[];return this.isIntersecting(e)?(this.containsPosition(e.start)&&t.push(new P(this.start,e.start)),this.containsPosition(e.end)&&t.push(new P(e.end,this.end))):t.push(this.clone()),t}getIntersection(e){if(this.isIntersecting(e)){let t=this.start,n=this.end;return this.containsPosition(e.start)&&(t=e.start),this.containsPosition(e.end)&&(n=e.end),new P(t,n)}return null}getWalker(e={}){return e.boundaries=this,new kt(e)}getCommonAncestor(){return this.start.getCommonAncestor(this.end)}getContainedElement(){if(this.isCollapsed)return null;let e=this.start.nodeAfter,t=this.end.nodeBefore;return this.start.parent.is("$text")&&this.start.isAtEnd&&this.start.parent.nextSibling&&(e=this.start.parent.nextSibling),this.end.parent.is("$text")&&this.end.isAtStart&&this.end.parent.previousSibling&&(t=this.end.parent.previousSibling),e&&e.is("element")&&e===t?e:null}clone(){return new P(this.start,this.end)}*getItems(e={}){e.boundaries=this,e.ignoreElementEnd=!0;const t=new kt(e);for(const n of t)yield n.item}*getPositions(e={}){e.boundaries=this;const t=new kt(e);yield t.position;for(const n of t)yield n.nextPosition}is(e){return e==="range"||e==="view:range"}isIntersecting(e){return this.start.isBefore(e.end)&&this.end.isAfter(e.start)}static _createFromParentsAndOffsets(e,t,n,s){return new this(new y(e,t),new y(n,s))}static _createFromPositionAndShift(e,t){const n=e,s=e.getShiftedBy(t);return t>0?new this(n,s):new this(s,n)}static _createIn(e){return this._createFromParentsAndOffsets(e,0,e,e.childCount)}static _createOn(e){const t=e.is("$textProxy")?e.offsetSize:1;return this._createFromPositionAndShift(y._createBefore(e),t)}}function ei(i){return!!(i.item.is("attributeElement")||i.item.is("uiElement"))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Es(i){let e=0;for(const t of i)e++;return e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Re{constructor(e=null,t,n){this._ranges=[],this._lastRangeBackward=!1,this._isFake=!1,this._fakeSelectionLabel="",this.setTo(e,t,n)}get isFake(){return this._isFake}get fakeSelectionLabel(){return this._fakeSelectionLabel}get anchor(){if(!this._ranges.length)return null;const e=this._ranges[this._ranges.length-1];return(this._lastRangeBackward?e.end:e.start).clone()}get focus(){if(!this._ranges.length)return null;const e=this._ranges[this._ranges.length-1];return(this._lastRangeBackward?e.start:e.end).clone()}get isCollapsed(){return this.rangeCount===1&&this._ranges[0].isCollapsed}get rangeCount(){return this._ranges.length}get isBackward(){return!this.isCollapsed&&this._lastRangeBackward}get editableElement(){return this.anchor?this.anchor.editableElement:null}*getRanges(){for(const e of this._ranges)yield e.clone()}getFirstRange(){let e=null;for(const t of this._ranges)(!e||t.start.isBefore(e.start))&&(e=t);return e?e.clone():null}getLastRange(){let e=null;for(const t of this._ranges)(!e||t.end.isAfter(e.end))&&(e=t);return e?e.clone():null}getFirstPosition(){const e=this.getFirstRange();return e?e.start.clone():null}getLastPosition(){const e=this.getLastRange();return e?e.end.clone():null}isEqual(e){if(this.isFake!=e.isFake||this.isFake&&this.fakeSelectionLabel!=e.fakeSelectionLabel||this.rangeCount!=e.rangeCount)return!1;if(this.rangeCount===0)return!0;if(!this.anchor.isEqual(e.anchor)||!this.focus.isEqual(e.focus))return!1;for(const t of this._ranges){let n=!1;for(const s of e._ranges)if(t.isEqual(s)){n=!0;break}if(!n)return!1}return!0}isSimilar(e){if(this.isBackward!=e.isBackward)return!1;const t=Es(this.getRanges()),n=Es(e.getRanges());if(t!=n)return!1;if(t==0)return!0;for(let s of this.getRanges()){s=s.getTrimmed();let o=!1;for(let r of e.getRanges())if(r=r.getTrimmed(),s.start.isEqual(r.start)&&s.end.isEqual(r.end)){o=!0;break}if(!o)return!1}return!0}getSelectedElement(){return this.rangeCount!==1?null:this.getFirstRange().getContainedElement()}setTo(e,t,n){if(e===null)this._setRanges([]),this._setFakeOptions(t);else if(e instanceof Re||e instanceof Ts)this._setRanges(e.getRanges(),e.isBackward),this._setFakeOptions({fake:e.isFake,label:e.fakeSelectionLabel});else if(e instanceof P)this._setRanges([e],t&&t.backward),this._setFakeOptions(t);else if(e instanceof y)this._setRanges([new P(e)]),this._setFakeOptions(t);else if(e instanceof Tt){const s=!!n&&!!n.backward;let o;if(t===void 0)throw new f("view-selection-setto-required-second-parameter",this);t=="in"?o=P._createIn(e):t=="on"?o=P._createOn(e):o=new P(y._createAt(e,t)),this._setRanges([o],s),this._setFakeOptions(n)}else if(Te(e))this._setRanges(e,t&&t.backward),this._setFakeOptions(t);else throw new f("view-selection-setto-not-selectable",this);this.fire("change")}setFocus(e,t){if(this.anchor===null)throw new f("view-selection-setfocus-no-ranges",this);const n=y._createAt(e,t);if(n.compareWith(this.focus)=="same")return;const s=this.anchor;this._ranges.pop(),n.compareWith(s)=="before"?this._addRange(new P(n,s),!0):this._addRange(new P(s,n)),this.fire("change")}is(e){return e==="selection"||e==="view:selection"}_setRanges(e,t=!1){e=Array.from(e),this._ranges=[];for(const n of e)this._addRange(n);this._lastRangeBackward=!!t}_setFakeOptions(e={}){this._isFake=!!e.fake,this._fakeSelectionLabel=e.fake&&e.label||""}_addRange(e,t=!1){if(!(e instanceof P))throw new f("view-selection-add-range-not-range",this);this._pushRange(e),this._lastRangeBackward=!!t}_pushRange(e){for(const t of this._ranges)if(e.isIntersecting(t))throw new f("view-selection-range-intersects",this,{addedRange:e,intersectingRange:t});this._ranges.push(new P(e.start,e.end))}}A(Re,H);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ts{constructor(e=null,t,n){this._selection=new Re,this._selection.delegate("change").to(this),this._selection.setTo(e,t,n)}get isFake(){return this._selection.isFake}get fakeSelectionLabel(){return this._selection.fakeSelectionLabel}get anchor(){return this._selection.anchor}get focus(){return this._selection.focus}get isCollapsed(){return this._selection.isCollapsed}get rangeCount(){return this._selection.rangeCount}get isBackward(){return this._selection.isBackward}get editableElement(){return this._selection.editableElement}get _ranges(){return this._selection._ranges}*getRanges(){yield*this._selection.getRanges()}getFirstRange(){return this._selection.getFirstRange()}getLastRange(){return this._selection.getLastRange()}getFirstPosition(){return this._selection.getFirstPosition()}getLastPosition(){return this._selection.getLastPosition()}getSelectedElement(){return this._selection.getSelectedElement()}isEqual(e){return this._selection.isEqual(e)}isSimilar(e){return this._selection.isSimilar(e)}is(e){return e==="selection"||e=="documentSelection"||e=="view:selection"||e=="view:documentSelection"}_setTo(e,t,n){this._selection.setTo(e,t,n)}_setFocus(e,t){this._selection.setFocus(e,t)}}A(Ts,H);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ti extends at{constructor(e,t,n){super(e,t);this.startRange=n,this._eventPhase="none",this._currentTarget=null}get eventPhase(){return this._eventPhase}get currentTarget(){return this._currentTarget}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const ks=Symbol("bubbling contexts"),X_={fire(i,...e){try{const t=i instanceof at?i:new at(this,i),n=As(this);if(!n.size)return;if(kn(t,"capturing",this),Wt(n,"$capture",t,...e))return t.return;const s=t.startRange||this.selection.getFirstRange(),o=s?s.getContainedElement():null,r=o?Boolean(Za(n,o)):!1;let a=o||Z_(s);if(kn(t,"atTarget",a),!r){if(Wt(n,"$text",t,...e))return t.return;kn(t,"bubbling",a)}for(;a;){if(a.is("rootElement")){if(Wt(n,"$root",t,...e))return t.return}else if(a.is("element")&&Wt(n,a.name,t,...e))return t.return;if(Wt(n,a,t,...e))return t.return;a=a.parent,kn(t,"bubbling",a)}return kn(t,"bubbling",this),Wt(n,"$document",t,...e),t.return}catch(t){f.rethrowUnexpectedError(t,this)}},_addEventListener(i,e,t){const n=oe(t.context||"$document"),s=As(this);for(const o of n){let r=s.get(o);r||(r=Object.create(H),s.set(o,r)),this.listenTo(r,i,e,t)}},_removeEventListener(i,e){const t=As(this);for(const n of t.values())this.stopListening(n,i,e)}};function kn(i,e,t){i instanceof ti&&(i._eventPhase=e,i._currentTarget=t)}function Wt(i,e,t,...n){const s=typeof e=="string"?i.get(e):Za(i,e);return s?(s.fire(t,...n),t.stop.called):!1}function Za(i,e){for(const[t,n]of i)if(typeof t=="function"&&t(e))return n;return null}function As(i){return i[ks]||(i[ks]=new Map),i[ks]}function Z_(i){if(!i)return null;const e=i.start.parent,t=i.end.parent,n=e.getPath(),s=t.getPath();return n.length>s.length?e:t}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class An{constructor(e){this.selection=new Ts,this.roots=new _e({idProperty:"rootName"}),this.stylesProcessor=e,this.set("isReadOnly",!1),this.set("isFocused",!1),this.set("isSelecting",!1),this.set("isComposing",!1),this._postFixers=new Set}getRoot(e="main"){return this.roots.get(e)}registerPostFixer(e){this._postFixers.add(e)}destroy(){this.roots.map(e=>e.destroy()),this.stopListening()}_callPostFixers(e){let t=!1;do for(const n of this._postFixers)if(t=n(e),t)break;while(t)}}A(An,X_);A(An,$);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const el=10;class Ut extends ke{constructor(e,t,n,s){super(e,t,n,s);this.getFillerOffset=ev,this._priority=el,this._id=null,this._clonesGroup=null}get priority(){return this._priority}get id(){return this._id}getElementsWithSameId(){if(this.id===null)throw new f("attribute-element-get-elements-with-same-id-no-id",this);return new Set(this._clonesGroup)}is(e,t=null){return t?t===this.name&&(e==="attributeElement"||e==="view:attributeElement"||e==="element"||e==="view:element"):e==="attributeElement"||e==="view:attributeElement"||e==="element"||e==="view:element"||e==="node"||e==="view:node"}isSimilar(e){return this.id!==null||e.id!==null?this.id===e.id:super.isSimilar(e)&&this.priority==e.priority}_clone(e){const t=super._clone(e);return t._priority=this._priority,t._id=this._id,t}}Ut.DEFAULT_PRIORITY=el;function ev(){if(Ss(this))return null;let i=this.parent;for(;i&&i.is("attributeElement");){if(Ss(i)>1)return null;i=i.parent}return!i||Ss(i)>1?null:this.childCount}function Ss(i){return Array.from(i.getChildren()).filter(e=>!e.is("uiElement")).length}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class tl extends ke{constructor(e,t,n,s){super(e,t,n,s);this._isAllowedInsideAttributeElement=!0,this.getFillerOffset=tv}is(e,t=null){return t?t===this.name&&(e==="emptyElement"||e==="view:emptyElement"||e==="element"||e==="view:element"):e==="emptyElement"||e==="view:emptyElement"||e==="element"||e==="view:element"||e==="node"||e==="view:node"}_insertChild(e,t){if(t&&(t instanceof Tt||Array.from(t).length>0))throw new f("view-emptyelement-cannot-add",[this,t])}}function tv(){return null}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const At=navigator.userAgent.toLowerCase(),W={isMac:nl(At),isWindows:nv(At),isGecko:iv(At),isSafari:sv(At),isiOS:ov(At),isAndroid:rv(At),isBlink:av(At),features:{isRegExpUnicodePropertySupported:lv()}};function nl(i){return i.indexOf("macintosh")>-1}function nv(i){return i.indexOf("windows")>-1}function iv(i){return!!i.match(/gecko\/\d+/)}function sv(i){return i.indexOf(" applewebkit/")>-1&&i.indexOf("chrome")===-1}function ov(i){return!!i.match(/iphone|ipad/i)||nl(i)&&navigator.maxTouchPoints>0}function rv(i){return i.indexOf("android")>-1}function av(i){return i.indexOf("chrome/")>-1&&i.indexOf("edge/")<0}function lv(){let i=!1;try{i="\u0107".search(new RegExp("[\\p{L}]","u"))===0}catch{}return i}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const cv={ctrl:"\u2303",cmd:"\u2318",alt:"\u2325",shift:"\u21E7"},uv={ctrl:"Ctrl+",alt:"Alt+",shift:"Shift+"},V=gv(),dv=Object.fromEntries(Object.entries(V).map(([i,e])=>[e,i.charAt(0).toUpperCase()+i.slice(1)]));function $e(i){let e;if(typeof i=="string"){if(e=V[i.toLowerCase()],!e)throw new f("keyboard-unknown-key",null,{key:i})}else e=i.keyCode+(i.altKey?V.alt:0)+(i.ctrlKey?V.ctrl:0)+(i.shiftKey?V.shift:0)+(i.metaKey?V.cmd:0);return e}function Ps(i){return typeof i=="string"&&(i=pv(i)),i.map(e=>typeof e=="string"?fv(e):e).reduce((e,t)=>t+e,0)}function il(i){let e=Ps(i);return Object.entries(W.isMac?cv:uv).reduce((s,[o,r])=>((e&V[o])!=0&&(e&=~V[o],s+=r),s),"")+(e?dv[e]:"")}function hv(i){return i==V.arrowright||i==V.arrowleft||i==V.arrowup||i==V.arrowdown}function xs(i,e){const t=e==="ltr";switch(i){case V.arrowleft:return t?"left":"right";case V.arrowright:return t?"right":"left";case V.arrowup:return"up";case V.arrowdown:return"down"}}function fv(i){if(i.endsWith("!"))return $e(i.slice(0,-1));const e=$e(i);return W.isMac&&e==V.ctrl?V.cmd:e}function mv(i,e){const t=xs(i,e);return t==="down"||t==="right"}function gv(){const i={arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,backspace:8,delete:46,enter:13,space:32,esc:27,tab:9,ctrl:1114112,shift:2228224,alt:4456448,cmd:8912896};for(let e=65;e<=90;e++){const t=String.fromCharCode(e);i[t.toLowerCase()]=e}for(let e=48;e<=57;e++)i[e-48]=e;for(let e=112;e<=123;e++)i["f"+(e-111)]=e;for(const e of"`-=[];',./\\")i[e]=e.charCodeAt(0);return i}function pv(i){return i.split("+").map(e=>e.trim())}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Is extends ke{constructor(e,t,n,s){super(e,t,n,s);this._isAllowedInsideAttributeElement=!0,this.getFillerOffset=bv}is(e,t=null){return t?t===this.name&&(e==="uiElement"||e==="view:uiElement"||e==="element"||e==="view:element"):e==="uiElement"||e==="view:uiElement"||e==="element"||e==="view:element"||e==="node"||e==="view:node"}_insertChild(e,t){if(t&&(t instanceof Tt||Array.from(t).length>0))throw new f("view-uielement-cannot-add",this)}render(e){return this.toDomElement(e)}toDomElement(e){const t=e.createElement(this.name);for(const n of this.getAttributeKeys())t.setAttribute(n,this.getAttribute(n));return t}}function wv(i){i.document.on("arrowKey",(e,t)=>_v(e,t,i.domConverter),{priority:"low"})}function bv(){return null}function _v(i,e,t){if(e.keyCode==V.arrowright){const n=e.domTarget.ownerDocument.defaultView.getSelection(),s=n.rangeCount==1&&n.getRangeAt(0).collapsed;if(s||e.shiftKey){const o=n.focusNode,r=n.focusOffset,a=t.domPositionToView(o,r);if(a===null)return;let l=!1;const c=a.getLastMatchingPosition(u=>(u.item.is("uiElement")&&(l=!0),!!(u.item.is("uiElement")||u.item.is("attributeElement"))));if(l){const u=t.viewPositionToDom(c);s?n.collapse(u.parent,u.offset):n.extend(u.parent,u.offset)}}}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class sl extends ke{constructor(e,t,n,s){super(e,t,n,s);this._isAllowedInsideAttributeElement=!0,this.getFillerOffset=vv}is(e,t=null){return t?t===this.name&&(e==="rawElement"||e==="view:rawElement"||e==="element"||e==="view:element"):e==="rawElement"||e==="view:rawElement"||e===this.name||e==="view:"+this.name||e==="element"||e==="view:element"||e==="node"||e==="view:node"}_insertChild(e,t){if(t&&(t instanceof Tt||Array.from(t).length>0))throw new f("view-rawelement-cannot-add",[this,t])}}function vv(){return null}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class St{constructor(e,t){this.document=e,this._children=[],t&&this._insertChild(0,t)}[Symbol.iterator](){return this._children[Symbol.iterator]()}get childCount(){return this._children.length}get isEmpty(){return this.childCount===0}get root(){return this}get parent(){return null}is(e){return e==="documentFragment"||e==="view:documentFragment"}_appendChild(e){return this._insertChild(this.childCount,e)}getChild(e){return this._children[e]}getChildIndex(e){return this._children.indexOf(e)}getChildren(){return this._children[Symbol.iterator]()}_insertChild(e,t){this._fireChange("children",this);let n=0;const s=yv(this.document,t);for(const o of s)o.parent!==null&&o._remove(),o.parent=this,this._children.splice(e,0,o),e++,n++;return n}_removeChildren(e,t=1){this._fireChange("children",this);for(let n=e;n<e+t;n++)this._children[n].parent=null;return this._children.splice(e,t)}_fireChange(e,t){this.fire("change:"+e,t)}}A(St,H);function yv(i,e){return typeof e=="string"?[new q(i,e)]:(Te(e)||(e=[e]),Array.from(e).map(t=>typeof t=="string"?new q(i,t):t instanceof Ye?new q(i,t.data):t))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ol{constructor(e){this.document=e,this._cloneGroups=new Map}setSelection(e,t,n){this.document.selection._setTo(e,t,n)}setSelectionFocus(e,t){this.document.selection._setFocus(e,t)}createDocumentFragment(e){return new St(this.document,e)}createText(e){return new q(this.document,e)}createAttributeElement(e,t,n={}){const s=new Ut(this.document,e,t);return typeof n.priority=="number"&&(s._priority=n.priority),n.id&&(s._id=n.id),n.renderUnsafeAttributes&&s._unsafeAttributesToRender.push(...n.renderUnsafeAttributes),s}createContainerElement(e,t,n={}){const s=new Xn(this.document,e,t);return n.isAllowedInsideAttributeElement!==void 0&&(s._isAllowedInsideAttributeElement=n.isAllowedInsideAttributeElement),n.renderUnsafeAttributes&&s._unsafeAttributesToRender.push(...n.renderUnsafeAttributes),s}createEditableElement(e,t,n={}){const s=new Zn(this.document,e,t);return s._document=this.document,n.renderUnsafeAttributes&&s._unsafeAttributesToRender.push(...n.renderUnsafeAttributes),s}createEmptyElement(e,t,n={}){const s=new tl(this.document,e,t);return n.isAllowedInsideAttributeElement!==void 0&&(s._isAllowedInsideAttributeElement=n.isAllowedInsideAttributeElement),n.renderUnsafeAttributes&&s._unsafeAttributesToRender.push(...n.renderUnsafeAttributes),s}createUIElement(e,t,n,s={}){const o=new Is(this.document,e,t);return n&&(o.render=n),s.isAllowedInsideAttributeElement!==void 0&&(o._isAllowedInsideAttributeElement=s.isAllowedInsideAttributeElement),o}createRawElement(e,t,n,s={}){const o=new sl(this.document,e,t);return o.render=n||(()=>{}),s.isAllowedInsideAttributeElement!==void 0&&(o._isAllowedInsideAttributeElement=s.isAllowedInsideAttributeElement),s.renderUnsafeAttributes&&o._unsafeAttributesToRender.push(...s.renderUnsafeAttributes),o}setAttribute(e,t,n){n._setAttribute(e,t)}removeAttribute(e,t){t._removeAttribute(e)}addClass(e,t){t._addClass(e)}removeClass(e,t){t._removeClass(e)}setStyle(e,t,n){Ee(e)&&n===void 0&&(n=t),n._setStyle(e,t)}removeStyle(e,t){t._removeStyle(e)}setCustomProperty(e,t,n){n._setCustomProperty(e,t)}removeCustomProperty(e,t){return t._removeCustomProperty(e)}breakAttributes(e){return e instanceof y?this._breakAttributes(e):this._breakAttributesRange(e)}breakContainer(e){const t=e.parent;if(!t.is("containerElement"))throw new f("view-writer-break-non-container-element",this.document);if(!t.parent)throw new f("view-writer-break-root",this.document);if(e.isAtStart)return y._createBefore(t);if(!e.isAtEnd){const n=t._clone(!1);this.insert(y._createAfter(t),n);const s=new P(e,y._createAt(t,"end")),o=new y(n,0);this.move(s,o)}return y._createAfter(t)}mergeAttributes(e){const t=e.offset,n=e.parent;if(n.is("$text"))return e;if(n.is("attributeElement")&&n.childCount===0){const r=n.parent,a=n.index;return n._remove(),this._removeFromClonedElementsGroup(n),this.mergeAttributes(new y(r,a))}const s=n.getChild(t-1),o=n.getChild(t);if(!s||!o)return e;if(s.is("$text")&&o.is("$text"))return al(s,o);if(s.is("attributeElement")&&o.is("attributeElement")&&s.isSimilar(o)){const r=s.childCount;return s._appendChild(o.getChildren()),o._remove(),this._removeFromClonedElementsGroup(o),this.mergeAttributes(new y(s,r))}return e}mergeContainers(e){const t=e.nodeBefore,n=e.nodeAfter;if(!t||!n||!t.is("containerElement")||!n.is("containerElement"))throw new f("view-writer-merge-containers-invalid-position",this.document);const s=t.getChild(t.childCount-1),o=s instanceof q?y._createAt(s,"end"):y._createAt(t,"end");return this.move(P._createIn(n),y._createAt(t,"end")),this.remove(P._createOn(n)),o}insert(e,t){t=Te(t)?[...t]:[t],ll(t,this.document);const n=t.reduce((r,a)=>{const l=r[r.length-1],c=!(a.is("uiElement")&&a.isAllowedInsideAttributeElement);return!l||l.breakAttributes!=c?r.push({breakAttributes:c,nodes:[a]}):l.nodes.push(a),r},[]);let s=null,o=e;for(const{nodes:r,breakAttributes:a}of n){const l=this._insertNodes(o,r,a);s||(s=l.start),o=l.end}return s?new P(s,o):new P(e)}remove(e){const t=e instanceof P?e:P._createOn(e);if(Sn(t,this.document),t.isCollapsed)return new St(this.document);const{start:n,end:s}=this._breakAttributesRange(t,!0),o=n.parent,r=s.offset-n.offset,a=o._removeChildren(n.offset,r);for(const c of a)this._removeFromClonedElementsGroup(c);const l=this.mergeAttributes(n);return t.start=l,t.end=l.clone(),new St(this.document,a)}clear(e,t){Sn(e,this.document);const n=e.getWalker({direction:"backward",ignoreElementEnd:!0});for(const s of n){const o=s.item;let r;if(o.is("element")&&t.isSimilar(o))r=P._createOn(o);else if(!s.nextPosition.isAfter(e.start)&&o.is("$textProxy")){const a=o.getAncestors().find(l=>l.is("element")&&t.isSimilar(l));a&&(r=P._createIn(a))}r&&(r.end.isAfter(e.end)&&(r.end=e.end),r.start.isBefore(e.start)&&(r.start=e.start),this.remove(r))}}move(e,t){let n;if(t.isAfter(e.end)){t=this._breakAttributes(t,!0);const s=t.parent,o=s.childCount;e=this._breakAttributesRange(e,!0),n=this.remove(e),t.offset+=s.childCount-o}else n=this.remove(e);return this.insert(t,n)}wrap(e,t){if(!(t instanceof Ut))throw new f("view-writer-wrap-invalid-attribute",this.document);if(Sn(e,this.document),e.isCollapsed){let n=e.start;n.parent.is("element")&&!Cv(n.parent)&&(n=n.getLastMatchingPosition(o=>o.item.is("uiElement"))),n=this._wrapPosition(n,t);const s=this.document.selection;return s.isCollapsed&&s.getFirstPosition().isEqual(e.start)&&this.setSelection(n),new P(n)}else return this._wrapRange(e,t)}unwrap(e,t){if(!(t instanceof Ut))throw new f("view-writer-unwrap-invalid-attribute",this.document);if(Sn(e,this.document),e.isCollapsed)return e;const{start:n,end:s}=this._breakAttributesRange(e,!0),o=n.parent,r=this._unwrapChildren(o,n.offset,s.offset,t),a=this.mergeAttributes(r.start);a.isEqual(r.start)||r.end.offset--;const l=this.mergeAttributes(r.end);return new P(a,l)}rename(e,t){const n=new Xn(this.document,e,t.getAttributes());return this.insert(y._createAfter(t),n),this.move(P._createIn(t),y._createAt(n,0)),this.remove(P._createOn(t)),n}clearClonedElementsGroup(e){this._cloneGroups.delete(e)}createPositionAt(e,t){return y._createAt(e,t)}createPositionAfter(e){return y._createAfter(e)}createPositionBefore(e){return y._createBefore(e)}createRange(e,t){return new P(e,t)}createRangeOn(e){return P._createOn(e)}createRangeIn(e){return P._createIn(e)}createSelection(e,t,n){return new Re(e,t,n)}_insertNodes(e,t,n){let s;if(n?s=Rs(e):s=e.parent.is("$text")?e.parent.parent:e.parent,!s)throw new f("view-writer-invalid-position-container",this.document);let o;n?o=this._breakAttributes(e,!0):o=e.parent.is("$text")?Ms(e):e;const r=s._insertChild(o.offset,t);for(const u of t)this._addToClonedElementsGroup(u);const a=o.getShiftedBy(r),l=this.mergeAttributes(o);l.isEqual(o)||a.offset--;const c=this.mergeAttributes(a);return new P(l,c)}_wrapChildren(e,t,n,s){let o=t;const r=[];for(;o<n;){const l=e.getChild(o),c=l.is("$text"),u=l.is("attributeElement"),d=l.isAllowedInsideAttributeElement;if(u&&this._wrapAttributeElement(s,l))r.push(new y(e,o));else if(c||d||u&&Ev(s,l)){const h=s._clone();l._remove(),h._appendChild(l),e._insertChild(o,h),this._addToClonedElementsGroup(h),r.push(new y(e,o))}else u&&this._wrapChildren(l,0,l.childCount,s);o++}let a=0;for(const l of r){if(l.offset-=a,l.offset==t)continue;this.mergeAttributes(l).isEqual(l)||(a++,n--)}return P._createFromParentsAndOffsets(e,t,e,n)}_unwrapChildren(e,t,n,s){let o=t;const r=[];for(;o<n;){const l=e.getChild(o);if(!l.is("attributeElement")){o++;continue}if(l.isSimilar(s)){const c=l.getChildren(),u=l.childCount;l._remove(),e._insertChild(o,c),this._removeFromClonedElementsGroup(l),r.push(new y(e,o),new y(e,o+u)),o+=u,n+=u-1;continue}if(this._unwrapAttributeElement(s,l)){r.push(new y(e,o),new y(e,o+1)),o++;continue}this._unwrapChildren(l,0,l.childCount,s),o++}let a=0;for(const l of r){if(l.offset-=a,l.offset==t||l.offset==n)continue;this.mergeAttributes(l).isEqual(l)||(a++,n--)}return P._createFromParentsAndOffsets(e,t,e,n)}_wrapRange(e,t){const{start:n,end:s}=this._breakAttributesRange(e,!0),o=n.parent,r=this._wrapChildren(o,n.offset,s.offset,t),a=this.mergeAttributes(r.start);a.isEqual(r.start)||r.end.offset--;const l=this.mergeAttributes(r.end);return new P(a,l)}_wrapPosition(e,t){if(t.isSimilar(e.parent))return rl(e.clone());e.parent.is("$text")&&(e=Ms(e));const n=this.createAttributeElement();n._priority=Number.POSITIVE_INFINITY,n.isSimilar=()=>!1,e.parent._insertChild(e.offset,n);const s=new P(e,e.getShiftedBy(1));this.wrap(s,t);const o=new y(n.parent,n.index);n._remove();const r=o.nodeBefore,a=o.nodeAfter;return r instanceof q&&a instanceof q?al(r,a):rl(o)}_wrapAttributeElement(e,t){if(!cl(e,t)||e.name!==t.name||e.priority!==t.priority)return!1;for(const n of e.getAttributeKeys())if(!(n==="class"||n==="style")&&t.hasAttribute(n)&&t.getAttribute(n)!==e.getAttribute(n))return!1;for(const n of e.getStyleNames())if(t.hasStyle(n)&&t.getStyle(n)!==e.getStyle(n))return!1;for(const n of e.getAttributeKeys())n==="class"||n==="style"||t.hasAttribute(n)||this.setAttribute(n,e.getAttribute(n),t);for(const n of e.getStyleNames())t.hasStyle(n)||this.setStyle(n,e.getStyle(n),t);for(const n of e.getClassNames())t.hasClass(n)||this.addClass(n,t);return!0}_unwrapAttributeElement(e,t){if(!cl(e,t)||e.name!==t.name||e.priority!==t.priority)return!1;for(const n of e.getAttributeKeys())if(!(n==="class"||n==="style")&&(!t.hasAttribute(n)||t.getAttribute(n)!==e.getAttribute(n)))return!1;if(!t.hasClass(...e.getClassNames()))return!1;for(const n of e.getStyleNames())if(!t.hasStyle(n)||t.getStyle(n)!==e.getStyle(n))return!1;for(const n of e.getAttributeKeys())n==="class"||n==="style"||this.removeAttribute(n,t);return this.removeClass(Array.from(e.getClassNames()),t),this.removeStyle(Array.from(e.getStyleNames()),t),!0}_breakAttributesRange(e,t=!1){const n=e.start,s=e.end;if(Sn(e,this.document),e.isCollapsed){const l=this._breakAttributes(e.start,t);return new P(l,l)}const o=this._breakAttributes(s,t),r=o.parent.childCount,a=this._breakAttributes(n,t);return o.offset+=o.parent.childCount-r,new P(a,o)}_breakAttributes(e,t=!1){const n=e.offset,s=e.parent;if(e.parent.is("emptyElement"))throw new f("view-writer-cannot-break-empty-element",this.document);if(e.parent.is("uiElement"))throw new f("view-writer-cannot-break-ui-element",this.document);if(e.parent.is("rawElement"))throw new f("view-writer-cannot-break-raw-element",this.document);if(!t&&s.is("$text")&&Vs(s.parent)||Vs(s))return e.clone();if(s.is("$text"))return this._breakAttributes(Ms(e),t);const o=s.childCount;if(n==o){const r=new y(s.parent,s.index+1);return this._breakAttributes(r,t)}else if(n===0){const r=new y(s.parent,s.index);return this._breakAttributes(r,t)}else{const r=s.index+1,a=s._clone();s.parent._insertChild(r,a),this._addToClonedElementsGroup(a);const l=s.childCount-n,c=s._removeChildren(n,l);a._appendChild(c);const u=new y(s.parent,r);return this._breakAttributes(u,t)}}_addToClonedElementsGroup(e){if(!e.root.is("rootElement"))return;if(e.is("element"))for(const s of e.getChildren())this._addToClonedElementsGroup(s);const t=e.id;if(!t)return;let n=this._cloneGroups.get(t);n||(n=new Set,this._cloneGroups.set(t,n)),n.add(e),e._clonesGroup=n}_removeFromClonedElementsGroup(e){if(e.is("element"))for(const s of e.getChildren())this._removeFromClonedElementsGroup(s);const t=e.id;if(!t)return;const n=this._cloneGroups.get(t);!n||n.delete(e)}}function Cv(i){return Array.from(i.getChildren()).some(e=>!e.is("uiElement"))}function Rs(i){let e=i.parent;for(;!Vs(e);){if(!e)return;e=e.parent}return e}function Ev(i,e){return i.priority<e.priority?!0:i.priority>e.priority?!1:i.getIdentity()<e.getIdentity()}function rl(i){const e=i.nodeBefore;if(e&&e.is("$text"))return new y(e,e.data.length);const t=i.nodeAfter;return t&&t.is("$text")?new y(t,0):i}function Ms(i){if(i.offset==i.parent.data.length)return new y(i.parent.parent,i.parent.index+1);if(i.offset===0)return new y(i.parent.parent,i.parent.index);const e=i.parent.data.slice(i.offset);return i.parent._data=i.parent.data.slice(0,i.offset),i.parent.parent._insertChild(i.parent.index+1,new q(i.root.document,e)),new y(i.parent.parent,i.parent.index+1)}function al(i,e){const t=i.data.length;return i._data+=e.data,e._remove(),new y(i,t)}function ll(i,e){for(const t of i){if(!Tv.some(n=>t instanceof n))throw new f("view-writer-insert-invalid-node-type",e);t.is("$text")||ll(t.getChildren(),e)}}const Tv=[q,Ut,Xn,tl,sl,Is];function Vs(i){return i&&(i.is("containerElement")||i.is("documentFragment"))}function Sn(i,e){const t=Rs(i.start),n=Rs(i.end);if(!t||!n||t!==n)throw new f("view-writer-invalid-range-container",e)}function cl(i,e){return i.id===null&&e.id===null}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function le(i){return Object.prototype.toString.call(i)=="[object Text]"}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const ul=i=>i.createTextNode("\xA0"),dl=i=>{const e=i.createElement("span");return e.dataset.ckeFiller=!0,e.innerHTML="\xA0",e},hl=i=>{const e=i.createElement("br");return e.dataset.ckeFiller=!0,e},We=7,ni="\u2060".repeat(We);function ve(i){return le(i)&&i.data.substr(0,We)===ni}function ii(i){return i.data.length==We&&ve(i)}function Os(i){return ve(i)?i.data.slice(We):i.data}function kv(i){i.document.on("arrowKey",Av,{priority:"low"})}function Av(i,e){if(e.keyCode==V.arrowleft){const t=e.domTarget.ownerDocument.defaultView.getSelection();if(t.rangeCount==1&&t.getRangeAt(0).collapsed){const n=t.getRangeAt(0).startContainer,s=t.getRangeAt(0).startOffset;ve(n)&&s<=We&&t.collapse(n,0)}}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function fl(i,e,t,n=!1){t=t||function(o,r){return o===r},Array.isArray(i)||(i=Array.prototype.slice.call(i)),Array.isArray(e)||(e=Array.prototype.slice.call(e));const s=Sv(i,e,t);return n?xv(s,e.length):Pv(e,s)}function Sv(i,e,t){const n=ml(i,e,t);if(n===-1)return{firstIndex:-1,lastIndexOld:-1,lastIndexNew:-1};const s=gl(i,n),o=gl(e,n),r=ml(s,o,t),a=i.length-r,l=e.length-r;return{firstIndex:n,lastIndexOld:a,lastIndexNew:l}}function ml(i,e,t){for(let n=0;n<Math.max(i.length,e.length);n++)if(i[n]===void 0||e[n]===void 0||!t(i[n],e[n]))return n;return-1}function gl(i,e){return i.slice(e).reverse()}function Pv(i,e){const t=[],{firstIndex:n,lastIndexOld:s,lastIndexNew:o}=e;return o-n>0&&t.push({index:n,type:"insert",values:i.slice(n,o)}),s-n>0&&t.push({index:n+(o-n),type:"delete",howMany:s-n}),t}function xv(i,e){const{firstIndex:t,lastIndexOld:n,lastIndexNew:s}=i;if(t===-1)return Array(e).fill("equal");let o=[];return t>0&&(o=o.concat(Array(t).fill("equal"))),s-t>0&&(o=o.concat(Array(s-t).fill("insert"))),n-t>0&&(o=o.concat(Array(n-t).fill("delete"))),s<e&&(o=o.concat(Array(e-s).fill("equal"))),o}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function ut(i,e,t){t=t||function(p,b){return p===b};const n=i.length,s=e.length;if(n>200||s>200||n+s>300)return ut.fastDiff(i,e,t,!0);let o,r;if(s<n){const p=i;i=e,e=p,o="delete",r="insert"}else o="insert",r="delete";const a=i.length,l=e.length,c=l-a,u={},d={};function h(p){const b=(d[p-1]!==void 0?d[p-1]:-1)+1,C=d[p+1]!==void 0?d[p+1]:-1,E=b>C?-1:1;u[p+E]&&(u[p]=u[p+E].slice(0)),u[p]||(u[p]=[]),u[p].push(b>C?o:r);let I=Math.max(b,C),N=I-p;for(;N<a&&I<l&&t(i[N],e[I]);)N++,I++,u[p].push("equal");return I}let m=0,g;do{for(g=-m;g<c;g++)d[g]=h(g);for(g=c+m;g>c;g--)d[g]=h(g);d[c]=h(c),m++}while(d[c]!==l);return u[c].slice(1)}ut.fastDiff=fl;/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function pl(i,e,t){i.insertBefore(t,i.childNodes[e]||null)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function wl(i){const e=i.parentNode;e&&e.removeChild(i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function qt(i){if(i){if(i.defaultView)return i instanceof i.defaultView.Document;if(i.ownerDocument&&i.ownerDocument.defaultView)return i instanceof i.ownerDocument.defaultView.Node}return!1}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class bl{constructor(e,t){this.domDocuments=new Set,this.domConverter=e,this.markedAttributes=new Set,this.markedChildren=new Set,this.markedTexts=new Set,this.selection=t,this.set("isFocused",!1),this.set("isSelecting",!1),W.isBlink&&!W.isAndroid&&this.on("change:isSelecting",()=>{this.isSelecting||this.render()}),this._inlineFiller=null,this._fakeSelectionContainer=null}markToSync(e,t){if(e==="text")this.domConverter.mapViewToDom(t.parent)&&this.markedTexts.add(t);else{if(!this.domConverter.mapViewToDom(t))return;if(e==="attributes")this.markedAttributes.add(t);else if(e==="children")this.markedChildren.add(t);else throw new f("view-renderer-unknown-type",this)}}render(){let e;const t=W.isBlink&&!W.isAndroid?!this.isSelecting:!0;for(const n of this.markedChildren)this._updateChildrenMappings(n);t?(this._inlineFiller&&!this._isSelectionInInlineFiller()&&this._removeInlineFiller(),this._inlineFiller?e=this._getInlineFillerPosition():this._needsInlineFillerAtSelection()&&(e=this.selection.getFirstPosition(),this.markedChildren.add(e.parent))):this._inlineFiller&&this._inlineFiller.parentNode&&(e=this.domConverter.domPositionToView(this._inlineFiller));for(const n of this.markedAttributes)this._updateAttrs(n);for(const n of this.markedChildren)this._updateChildren(n,{inlineFillerPosition:e});for(const n of this.markedTexts)!this.markedChildren.has(n.parent)&&this.domConverter.mapViewToDom(n.parent)&&this._updateText(n,{inlineFillerPosition:e});if(t)if(e){const n=this.domConverter.viewPositionToDom(e),s=n.parent.ownerDocument;ve(n.parent)?this._inlineFiller=n.parent:this._inlineFiller=_l(s,n.parent,n.offset)}else this._inlineFiller=null;this._updateFocus(),this._updateSelection(),this.markedTexts.clear(),this.markedAttributes.clear(),this.markedChildren.clear()}_updateChildrenMappings(e){const t=this.domConverter.mapViewToDom(e);if(!t)return;const n=Array.from(this.domConverter.mapViewToDom(e).childNodes),s=Array.from(this.domConverter.viewChildrenToDom(e,t.ownerDocument,{withChildren:!1})),o=this._diffNodeLists(n,s),r=this._findReplaceActions(o,n,s);if(r.indexOf("replace")!==-1){const a={equal:0,insert:0,delete:0};for(const l of r)if(l==="replace"){const c=a.equal+a.insert,u=a.equal+a.delete,d=e.getChild(c);d&&!(d.is("uiElement")||d.is("rawElement"))&&this._updateElementMappings(d,n[u]),wl(s[c]),a.equal++}else a[l]++}}_updateElementMappings(e,t){this.domConverter.unbindDomElement(t),this.domConverter.bindElements(t,e),this.markedChildren.add(e),this.markedAttributes.add(e)}_getInlineFillerPosition(){const e=this.selection.getFirstPosition();return e.parent.is("$text")?y._createBefore(this.selection.getFirstPosition().parent):e}_isSelectionInInlineFiller(){if(this.selection.rangeCount!=1||!this.selection.isCollapsed)return!1;const e=this.selection.getFirstPosition(),t=this.domConverter.viewPositionToDom(e);return!!(t&&le(t.parent)&&ve(t.parent))}_removeInlineFiller(){const e=this._inlineFiller;if(!ve(e))throw new f("view-renderer-filler-was-lost",this);ii(e)?e.remove():e.data=e.data.substr(We),this._inlineFiller=null}_needsInlineFillerAtSelection(){if(this.selection.rangeCount!=1||!this.selection.isCollapsed)return!1;const e=this.selection.getFirstPosition(),t=e.parent,n=e.offset;if(!this.domConverter.mapViewToDom(t.root)||!t.is("element")||!Iv(t)||n===t.getFillerOffset())return!1;const s=e.nodeBefore,o=e.nodeAfter;return!(s instanceof q||o instanceof q)}_updateText(e,t){const n=this.domConverter.findCorrespondingDomText(e),s=this.domConverter.viewToDom(e,n.ownerDocument),o=n.data;let r=s.data;const a=t.inlineFillerPosition;if(a&&a.parent==e.parent&&a.offset==e.index&&(r=ni+r),o!=r){const l=fl(o,r);for(const c of l)c.type==="insert"?n.insertData(c.index,c.values.join("")):n.deleteData(c.index,c.howMany)}}_updateAttrs(e){const t=this.domConverter.mapViewToDom(e);if(!t)return;const n=Array.from(t.attributes).map(o=>o.name),s=e.getAttributeKeys();for(const o of s)this.domConverter.setDomElementAttribute(t,o,e.getAttribute(o),e);for(const o of n)e.hasAttribute(o)||this.domConverter.removeDomElementAttribute(t,o)}_updateChildren(e,t){const n=this.domConverter.mapViewToDom(e);if(!n)return;const s=t.inlineFillerPosition,o=this.domConverter.mapViewToDom(e).childNodes,r=Array.from(this.domConverter.viewChildrenToDom(e,n.ownerDocument,{bind:!0}));s&&s.parent===e&&_l(n.ownerDocument,r,s.offset);const a=this._diffNodeLists(o,r);let l=0;const c=new Set;for(const u of a)u==="delete"?(c.add(o[l]),wl(o[l])):u==="equal"&&l++;l=0;for(const u of a)u==="insert"?(pl(n,l,r[l]),l++):u==="equal"&&(this._markDescendantTextToSync(this.domConverter.domToView(r[l])),l++);for(const u of c)u.parentNode||this.domConverter.unbindDomElement(u)}_diffNodeLists(e,t){return e=Vv(e,this._fakeSelectionContainer),ut(e,t,Rv.bind(null,this.domConverter))}_findReplaceActions(e,t,n){if(e.indexOf("insert")===-1||e.indexOf("delete")===-1)return e;let s=[],o=[],r=[];const a={equal:0,insert:0,delete:0};for(const l of e)l==="insert"?r.push(n[a.equal+a.insert]):l==="delete"?o.push(t[a.equal+a.delete]):(s=s.concat(ut(o,r,vl).map(c=>c==="equal"?"replace":c)),s.push("equal"),o=[],r=[]),a[l]++;return s.concat(ut(o,r,vl).map(l=>l==="equal"?"replace":l))}_markDescendantTextToSync(e){if(!!e){if(e.is("$text"))this.markedTexts.add(e);else if(e.is("element"))for(const t of e.getChildren())this._markDescendantTextToSync(t)}}_updateSelection(){if(W.isBlink&&!W.isAndroid&&this.isSelecting&&!this.markedChildren.size)return;if(this.selection.rangeCount===0){this._removeDomSelection(),this._removeFakeSelection();return}const e=this.domConverter.mapViewToDom(this.selection.editableElement);!this.isFocused||!e||(this.selection.isFake?this._updateFakeSelection(e):(this._removeFakeSelection(),this._updateDomSelection(e)))}_updateFakeSelection(e){const t=e.ownerDocument;this._fakeSelectionContainer||(this._fakeSelectionContainer=Ov(t));const n=this._fakeSelectionContainer;if(this.domConverter.bindFakeSelection(n,this.selection),!this._fakeSelectionNeedsUpdate(e))return;(!n.parentElement||n.parentElement!=e)&&e.appendChild(n),n.textContent=this.selection.fakeSelectionLabel||"\xA0";const s=t.getSelection(),o=t.createRange();s.removeAllRanges(),o.selectNodeContents(n),s.addRange(o)}_updateDomSelection(e){const t=e.ownerDocument.defaultView.getSelection();if(!this._domSelectionNeedsUpdate(t))return;const n=this.domConverter.viewPositionToDom(this.selection.anchor),s=this.domConverter.viewPositionToDom(this.selection.focus);t.collapse(n.parent,n.offset),t.extend(s.parent,s.offset),W.isGecko&&Mv(s,t)}_domSelectionNeedsUpdate(e){if(!this.domConverter.isDomSelectionCorrect(e))return!0;const t=e&&this.domConverter.domSelectionToView(e);return!(t&&this.selection.isEqual(t)||!this.selection.isCollapsed&&this.selection.isSimilar(t))}_fakeSelectionNeedsUpdate(e){const t=this._fakeSelectionContainer,n=e.ownerDocument.getSelection();return!t||t.parentElement!==e||n.anchorNode!==t&&!t.contains(n.anchorNode)?!0:t.textContent!==this.selection.fakeSelectionLabel}_removeDomSelection(){for(const e of this.domDocuments)if(e.getSelection().rangeCount){const n=e.activeElement,s=this.domConverter.mapDomToView(n);n&&s&&e.getSelection().removeAllRanges()}}_removeFakeSelection(){const e=this._fakeSelectionContainer;e&&e.remove()}_updateFocus(){if(this.isFocused){const e=this.selection.editableElement;e&&this.domConverter.focus(e)}}}A(bl,$);function Iv(i){if(i.getAttribute("contenteditable")=="false")return!1;const e=i.findAncestor(t=>t.hasAttribute("contenteditable"));return!e||e.getAttribute("contenteditable")=="true"}function _l(i,e,t){const n=e instanceof Array?e:e.childNodes,s=n[t];if(le(s))return s.data=ni+s.data,s;{const o=i.createTextNode(ni);return Array.isArray(e)?n.splice(t,0,o):pl(e,t,o),o}}function vl(i,e){return qt(i)&&qt(e)&&!le(i)&&!le(e)&&i.nodeType!==Node.COMMENT_NODE&&e.nodeType!==Node.COMMENT_NODE&&i.tagName.toLowerCase()===e.tagName.toLowerCase()}function Rv(i,e,t){return e===t?!0:le(e)&&le(t)?e.data===t.data:!!(i.isBlockFiller(e)&&i.isBlockFiller(t))}function Mv(i,e){const t=i.parent;if(t.nodeType!=Node.ELEMENT_NODE||i.offset!=t.childNodes.length-1)return;const n=t.childNodes[i.offset];n&&n.tagName=="BR"&&e.addRange(e.getRangeAt(0))}function Vv(i,e){const t=Array.from(i);return t.length==0||!e||t[t.length-1]==e&&t.pop(),t}function Ov(i){const e=i.createElement("div");return e.className="ck-fake-selection-container",Object.assign(e.style,{position:"fixed",top:0,left:"-9999px",width:"42px"}),e.textContent="\xA0",e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */var ee={window,document};/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Ns(i){let e=0;for(;i.previousSibling;)i=i.previousSibling,e++;return e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function yl(i){const e=[];for(;i&&i.nodeType!=Node.DOCUMENT_NODE;)e.unshift(i),i=i.parentNode;return e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Nv=hl(document),Dv=ul(document),Bv=dl(document),si="data-ck-unsafe-attribute-",Cl="data-ck-unsafe-element";class oi{constructor(e,t={}){this.document=e,this.renderingMode=t.renderingMode||"editing",this.blockFillerMode=t.blockFillerMode||(this.renderingMode==="editing"?"br":"nbsp"),this.preElements=["pre"],this.blockElements=["address","article","aside","blockquote","caption","center","dd","details","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","legend","li","main","menu","nav","ol","p","pre","section","summary","table","tbody","td","tfoot","th","thead","tr","ul"],this.inlineObjectElements=["object","iframe","input","button","textarea","select","option","video","embed","audio","img","canvas"],this._domToViewMapping=new WeakMap,this._viewToDomMapping=new WeakMap,this._fakeSelectionMapping=new WeakMap,this._rawContentElementMatcher=new He,this._encounteredRawContentDomNodes=new WeakSet}bindFakeSelection(e,t){this._fakeSelectionMapping.set(e,new Re(t))}fakeSelectionToView(e){return this._fakeSelectionMapping.get(e)}bindElements(e,t){this._domToViewMapping.set(e,t),this._viewToDomMapping.set(t,e)}unbindDomElement(e){const t=this._domToViewMapping.get(e);if(t){this._domToViewMapping.delete(e),this._viewToDomMapping.delete(t);for(const n of e.childNodes)this.unbindDomElement(n)}}bindDocumentFragments(e,t){this._domToViewMapping.set(e,t),this._viewToDomMapping.set(t,e)}shouldRenderAttribute(e,t,n){return this.renderingMode==="data"?!0:(e=e.toLowerCase(),e.startsWith("on")||e==="srcdoc"&&t.match(/\bon\S+\s*=|javascript:|<\s*\/*script/i)?!1:n==="img"&&(e==="src"||e==="srcset")||n==="source"&&e==="srcset"?!0:!t.match(/^\s*(javascript:|data:(image\/svg|text\/x?html))/i))}setContentOf(e,t){if(this.renderingMode==="data"){e.innerHTML=t;return}const n=new DOMParser().parseFromString(t,"text/html"),s=n.createDocumentFragment(),o=n.body.childNodes;for(;o.length>0;)s.appendChild(o[0]);const r=n.createTreeWalker(s,NodeFilter.SHOW_ELEMENT),a=[];let l;for(;l=r.nextNode();)a.push(l);for(const c of a){for(const d of c.getAttributeNames())this.setDomElementAttribute(c,d,c.getAttribute(d));const u=c.tagName.toLowerCase();this._shouldRenameElement(u)&&(de("domconverter-unsafe-element-detected",{unsafeElement:c}),c.replaceWith(this._createReplacementDomElement(u,c)))}for(;e.firstChild;)e.firstChild.remove();e.append(s)}viewToDom(e,t,n={}){if(e.is("$text")){const s=this._processDataFromViewText(e);return t.createTextNode(s)}else{if(this.mapViewToDom(e))return this.mapViewToDom(e);let s;if(e.is("documentFragment"))s=t.createDocumentFragment(),n.bind&&this.bindDocumentFragments(s,e);else{if(e.is("uiElement"))return e.name==="$comment"?s=t.createComment(e.getCustomProperty("$rawContent")):s=e.render(t,this),n.bind&&this.bindElements(s,e),s;this._shouldRenameElement(e.name)?(de("domconverter-unsafe-element-detected",{unsafeElement:e}),s=this._createReplacementDomElement(e.name)):e.hasAttribute("xmlns")?s=t.createElementNS(e.getAttribute("xmlns"),e.name):s=t.createElement(e.name),e.is("rawElement")&&e.render(s,this),n.bind&&this.bindElements(s,e);for(const o of e.getAttributeKeys())this.setDomElementAttribute(s,o,e.getAttribute(o),e)}if(n.withChildren!==!1)for(const o of this.viewChildrenToDom(e,t,n))s.appendChild(o);return s}}setDomElementAttribute(e,t,n,s=null){const o=this.shouldRenderAttribute(t,n,e.tagName.toLowerCase())||s&&s.shouldRenderUnsafeAttribute(t);o||de("domconverter-unsafe-attribute-detected",{domElement:e,key:t,value:n}),e.hasAttribute(t)&&!o?e.removeAttribute(t):e.hasAttribute(si+t)&&o&&e.removeAttribute(si+t),e.setAttribute(o?t:si+t,n)}removeDomElementAttribute(e,t){t!=Cl&&(e.removeAttribute(t),e.removeAttribute(si+t))}*viewChildrenToDom(e,t,n={}){const s=e.getFillerOffset&&e.getFillerOffset();let o=0;for(const r of e.getChildren())s===o&&(yield this._getBlockFiller(t)),yield this.viewToDom(r,t,n),o++;s===o&&(yield this._getBlockFiller(t))}viewRangeToDom(e){const t=this.viewPositionToDom(e.start),n=this.viewPositionToDom(e.end),s=document.createRange();return s.setStart(t.parent,t.offset),s.setEnd(n.parent,n.offset),s}viewPositionToDom(e){const t=e.parent;if(t.is("$text")){const n=this.findCorrespondingDomText(t);if(!n)return null;let s=e.offset;return ve(n)&&(s+=We),{parent:n,offset:s}}else{let n,s,o;if(e.offset===0){if(n=this.mapViewToDom(t),!n)return null;o=n.childNodes[0]}else{const a=e.nodeBefore;if(s=a.is("$text")?this.findCorrespondingDomText(a):this.mapViewToDom(e.nodeBefore),!s)return null;n=s.parentNode,o=s.nextSibling}if(le(o)&&ve(o))return{parent:o,offset:We};const r=s?Ns(s)+1:0;return{parent:n,offset:r}}}domToView(e,t={}){if(this.isBlockFiller(e))return null;const n=this.getHostViewElement(e);if(n)return n;if(this.isComment(e)&&t.skipComments)return null;if(le(e)){if(ii(e))return null;{const s=this._processDataFromDomText(e);return s===""?null:new q(this.document,s)}}else{if(this.mapDomToView(e))return this.mapDomToView(e);let s;if(this.isDocumentFragment(e))s=new St(this.document),t.bind&&this.bindDocumentFragments(e,s);else{s=this._createViewElement(e,t),t.bind&&this.bindElements(e,s);const o=e.attributes;if(o)for(let r=o.length-1;r>=0;r--)s._setAttribute(o[r].name,o[r].value);if(this._isViewElementWithRawContent(s,t)||this.isComment(e)){const r=this.isComment(e)?e.data:e.innerHTML;return s._setCustomProperty("$rawContent",r),this._encounteredRawContentDomNodes.add(e),s}}if(t.withChildren!==!1)for(const o of this.domChildrenToView(e,t))s._appendChild(o);return s}}*domChildrenToView(e,t={}){for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n],o=this.domToView(s,t);o!==null&&(yield o)}}domSelectionToView(e){if(e.rangeCount===1){let s=e.getRangeAt(0).startContainer;le(s)&&(s=s.parentNode);const o=this.fakeSelectionToView(s);if(o)return o}const t=this.isDomSelectionBackward(e),n=[];for(let s=0;s<e.rangeCount;s++){const o=e.getRangeAt(s),r=this.domRangeToView(o);r&&n.push(r)}return new Re(n,{backward:t})}domRangeToView(e){const t=this.domPositionToView(e.startContainer,e.startOffset),n=this.domPositionToView(e.endContainer,e.endOffset);return t&&n?new P(t,n):null}domPositionToView(e,t=0){if(this.isBlockFiller(e))return this.domPositionToView(e.parentNode,Ns(e));const n=this.mapDomToView(e);if(n&&(n.is("uiElement")||n.is("rawElement")))return y._createBefore(n);if(le(e)){if(ii(e))return this.domPositionToView(e.parentNode,Ns(e));const s=this.findCorrespondingViewText(e);let o=t;return s?(ve(e)&&(o-=We,o=o<0?0:o),new y(s,o)):null}else{if(t===0){const s=this.mapDomToView(e);if(s)return new y(s,0)}else{const s=e.childNodes[t-1],o=le(s)?this.findCorrespondingViewText(s):this.mapDomToView(s);if(o&&o.parent)return new y(o.parent,o.index+1)}return null}}mapDomToView(e){return this.getHostViewElement(e)||this._domToViewMapping.get(e)}findCorrespondingViewText(e){if(ii(e))return null;const t=this.getHostViewElement(e);if(t)return t;const n=e.previousSibling;if(n){if(!this.isElement(n))return null;const s=this.mapDomToView(n);if(s)return s.nextSibling instanceof q?s.nextSibling:null}else{const s=this.mapDomToView(e.parentNode);if(s){const o=s.getChild(0);return o instanceof q?o:null}}return null}mapViewToDom(e){return this._viewToDomMapping.get(e)}findCorrespondingDomText(e){const t=e.previousSibling;return t&&this.mapViewToDom(t)?this.mapViewToDom(t).nextSibling:!t&&e.parent&&this.mapViewToDom(e.parent)?this.mapViewToDom(e.parent).childNodes[0]:null}focus(e){const t=this.mapViewToDom(e);if(t&&t.ownerDocument.activeElement!==t){const{scrollX:n,scrollY:s}=ee.window,o=[];El(t,r=>{const{scrollLeft:a,scrollTop:l}=r;o.push([a,l])}),t.focus(),El(t,r=>{const[a,l]=o.shift();r.scrollLeft=a,r.scrollTop=l}),ee.window.scrollTo(n,s)}}isElement(e){return e&&e.nodeType==Node.ELEMENT_NODE}isDocumentFragment(e){return e&&e.nodeType==Node.DOCUMENT_FRAGMENT_NODE}isComment(e){return e&&e.nodeType==Node.COMMENT_NODE}isBlockFiller(e){return this.blockFillerMode=="br"?e.isEqualNode(Nv):e.tagName==="BR"&&Tl(e,this.blockElements)&&e.parentNode.childNodes.length===1?!0:e.isEqualNode(Bv)||Lv(e,this.blockElements)}isDomSelectionBackward(e){if(e.isCollapsed)return!1;const t=document.createRange();t.setStart(e.anchorNode,e.anchorOffset),t.setEnd(e.focusNode,e.focusOffset);const n=t.collapsed;return t.detach(),n}getHostViewElement(e){const t=yl(e);for(t.pop();t.length;){const n=t.pop(),s=this._domToViewMapping.get(n);if(s&&(s.is("uiElement")||s.is("rawElement")))return s}return null}isDomSelectionCorrect(e){return this._isDomSelectionPositionCorrect(e.anchorNode,e.anchorOffset)&&this._isDomSelectionPositionCorrect(e.focusNode,e.focusOffset)}registerRawContentMatcher(e){this._rawContentElementMatcher.add(e)}_getBlockFiller(e){switch(this.blockFillerMode){case"nbsp":return ul(e);case"markedNbsp":return dl(e);case"br":return hl(e)}}_isDomSelectionPositionCorrect(e,t){if(le(e)&&ve(e)&&t<We||this.isElement(e)&&ve(e.childNodes[t]))return!1;const n=this.mapDomToView(e);return!(n&&(n.is("uiElement")||n.is("rawElement")))}_processDataFromViewText(e){let t=e.data;if(e.getAncestors().some(n=>this.preElements.includes(n.name)))return t;if(t.charAt(0)==" "){const n=this._getTouchingInlineViewNode(e,!1);(n&&n.is("$textProxy")&&this._nodeEndsWithSpace(n)||!n)&&(t="\xA0"+t.substr(1))}if(t.charAt(t.length-1)==" "){const n=this._getTouchingInlineViewNode(e,!0),s=n&&n.is("$textProxy")&&n.data.charAt(0)==" ";(t.charAt(t.length-2)==" "||!n||s)&&(t=t.substr(0,t.length-1)+"\xA0")}return t.replace(/ {2}/g," \xA0")}_nodeEndsWithSpace(e){if(e.getAncestors().some(n=>this.preElements.includes(n.name)))return!1;const t=this._processDataFromViewText(e);return t.charAt(t.length-1)==" "}_processDataFromDomText(e){let t=e.data;if(Fv(e,this.preElements))return Os(e);t=t.replace(/[ \n\t\r]{1,}/g," ");const n=this._getTouchingInlineDomNode(e,!1),s=this._getTouchingInlineDomNode(e,!0),o=this._checkShouldLeftTrimDomText(e,n),r=this._checkShouldRightTrimDomText(e,s);o&&(t=t.replace(/^ /,"")),r&&(t=t.replace(/ $/,"")),t=Os(new Text(t)),t=t.replace(/ \u00A0/g,"  ");const a=s&&this.isElement(s)&&s.tagName!="BR",l=s&&le(s)&&s.data.charAt(0)==" ";return(/( |\u00A0)\u00A0$/.test(t)||!s||a||l)&&(t=t.replace(/\u00A0$/," ")),(o||n&&this.isElement(n)&&n.tagName!="BR")&&(t=t.replace(/^\u00A0/," ")),t}_checkShouldLeftTrimDomText(e,t){return t?this.isElement(t)?t.tagName==="BR":this._encounteredRawContentDomNodes.has(e.previousSibling)?!1:/[^\S\u00A0]/.test(t.data.charAt(t.data.length-1)):!0}_checkShouldRightTrimDomText(e,t){return t?!1:!ve(e)}_getTouchingInlineViewNode(e,t){const n=new kt({startPosition:t?y._createAfter(e):y._createBefore(e),direction:t?"forward":"backward"});for(const s of n){if(s.item.is("element")&&this.inlineObjectElements.includes(s.item.name))return s.item;if(s.item.is("containerElement"))return null;if(s.item.is("element","br"))return null;if(s.item.is("$textProxy"))return s.item}return null}_getTouchingInlineDomNode(e,t){if(!e.parentNode)return null;const n=t?"firstChild":"lastChild",s=t?"nextSibling":"previousSibling";let o=!0;do if(!o&&e[n]?e=e[n]:e[s]?(e=e[s],o=!1):(e=e.parentNode,o=!0),!e||this._isBlockElement(e))return null;while(!(le(e)||e.tagName=="BR"||this._isInlineObjectElement(e)));return e}_isBlockElement(e){return this.isElement(e)&&this.blockElements.includes(e.tagName.toLowerCase())}_isInlineObjectElement(e){return this.isElement(e)&&this.inlineObjectElements.includes(e.tagName.toLowerCase())}_createViewElement(e,t){if(this.isComment(e))return new Is(this.document,"$comment");const n=t.keepOriginalCase?e.tagName:e.tagName.toLowerCase();return new ke(this.document,n)}_isViewElementWithRawContent(e,t){return t.withChildren!==!1&&this._rawContentElementMatcher.match(e)}_shouldRenameElement(e){return this.renderingMode=="editing"&&e.toLowerCase()=="script"}_createReplacementDomElement(e,t=null){const n=document.createElement("span");if(n.setAttribute(Cl,e),t){for(;t.firstChild;)n.appendChild(t.firstChild);for(const s of t.getAttributeNames())n.setAttribute(s,t.getAttribute(s))}return n}}function Fv(i,e){return yl(i).some(n=>n.tagName&&e.includes(n.tagName.toLowerCase()))}function El(i,e){for(;i&&i!=ee.document;)e(i),i=i.parentNode}function Lv(i,e){return i.isEqualNode(Dv)&&Tl(i,e)&&i.parentNode.childNodes.length===1}function Tl(i,e){const t=i.parentNode;return t&&t.tagName&&e.includes(t.tagName.toLowerCase())}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function ri(i){const e=Object.prototype.toString.apply(i);return e=="[object Window]"||e=="[object global]"}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const jt=vn({},H,{listenTo(i,e,t,n={}){if(qt(i)||ri(i)){const s={capture:!!n.useCapture,passive:!!n.usePassive},o=this._getProxyEmitter(i,s)||new kl(i,s);this.listenTo(o,e,t,n)}else H.listenTo.call(this,i,e,t,n)},stopListening(i,e,t){if(qt(i)||ri(i)){const n=this._getAllProxyEmitters(i);for(const s of n)this.stopListening(s,e,t)}else H.stopListening.call(this,i,e,t)},_getProxyEmitter(i,e){return ff(this,Al(i,e))},_getAllProxyEmitters(i){return[{capture:!1,passive:!1},{capture:!1,passive:!0},{capture:!0,passive:!1},{capture:!0,passive:!0}].map(e=>this._getProxyEmitter(i,e)).filter(e=>!!e)}});class kl{constructor(e,t){_r(this,Al(e,t)),this._domNode=e,this._options=t}}vn(kl.prototype,H,{attach(i){if(this._domListeners&&this._domListeners[i])return;const e=this._createDomListener(i);this._domNode.addEventListener(i,e,this._options),this._domListeners||(this._domListeners={}),this._domListeners[i]=e},detach(i){let e;this._domListeners[i]&&(!(e=this._events[i])||!e.callbacks.length)&&this._domListeners[i].removeListener()},_addEventListener(i,e,t){this.attach(i),H._addEventListener.call(this,i,e,t)},_removeEventListener(i,e){H._removeEventListener.call(this,i,e),this.detach(i)},_createDomListener(i){const e=t=>{this.fire(i,t)};return e.removeListener=()=>{this._domNode.removeEventListener(i,e,this._options),delete this._domListeners[i]},e}});function zv(i){return i["data-ck-expando"]||(i["data-ck-expando"]=Be())}function Al(i,e){let t=zv(i);for(const n of Object.keys(e).sort())e[n]&&(t+="-"+n);return t}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ze{constructor(e){this.view=e,this.document=e.document,this.isEnabled=!1}enable(){this.isEnabled=!0}disable(){this.isEnabled=!1}destroy(){this.disable(),this.stopListening()}checkShouldIgnoreEventFromTarget(e){return e&&e.nodeType===3&&(e=e.parentNode),!e||e.nodeType!==1?!1:e.matches("[data-cke-ignore-events], [data-cke-ignore-events] *")}}A(Ze,jt);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Sl extends Ze{constructor(e){super(e);this._config={childList:!0,characterData:!0,characterDataOldValue:!0,subtree:!0},this.domConverter=e.domConverter,this.renderer=e._renderer,this._domElements=[],this._mutationObserver=new window.MutationObserver(this._onMutations.bind(this))}flush(){this._onMutations(this._mutationObserver.takeRecords())}observe(e){this._domElements.push(e),this.isEnabled&&this._mutationObserver.observe(e,this._config)}enable(){super.enable();for(const e of this._domElements)this._mutationObserver.observe(e,this._config)}disable(){super.disable(),this._mutationObserver.disconnect()}destroy(){super.destroy(),this._mutationObserver.disconnect()}_onMutations(e){if(e.length===0)return;const t=this.domConverter,n=new Map,s=new Set;for(const c of e)if(c.type==="childList"){const u=t.mapDomToView(c.target);if(u&&(u.is("uiElement")||u.is("rawElement")))continue;u&&!this._isBogusBrMutation(c)&&s.add(u)}for(const c of e){const u=t.mapDomToView(c.target);if(!(u&&(u.is("uiElement")||u.is("rawElement")))&&c.type==="characterData"){const d=t.findCorrespondingViewText(c.target);d&&!s.has(d.parent)?n.set(d,{type:"text",oldText:d.data,newText:Os(c.target),node:d}):!d&&ve(c.target)&&s.add(t.mapDomToView(c.target.parentNode))}}const o=[];for(const c of n.values())this.renderer.markToSync("text",c.node),o.push(c);for(const c of s){const u=t.mapViewToDom(c),d=Array.from(c.getChildren()),h=Array.from(t.domChildrenToView(u,{withChildren:!1}));p_(d,h,l)||(this.renderer.markToSync("children",c),o.push({type:"children",oldChildren:d,newChildren:h,node:c}))}const r=e[0].target.ownerDocument.getSelection();let a=null;if(r&&r.anchorNode){const c=t.domPositionToView(r.anchorNode,r.anchorOffset),u=t.domPositionToView(r.focusNode,r.focusOffset);c&&u&&(a=new Re(c),a.setFocus(u))}o.length&&(this.document.fire("mutations",o,a),this.view.forceRender());function l(c,u){if(!Array.isArray(c))return c===u?!0:c.is("$text")&&u.is("$text")?c.data===u.data:!1}}_isBogusBrMutation(e){let t=null;return e.nextSibling===null&&e.removedNodes.length===0&&e.addedNodes.length==1&&(t=this.domConverter.domToView(e.addedNodes[0],{withChildren:!1})),t&&t.is("element","br")}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ds{constructor(e,t,n){this.view=e,this.document=e.document,this.domEvent=t,this.domTarget=t.target,vn(this,n)}get target(){return this.view.domConverter.mapDomToView(this.domTarget)}preventDefault(){this.domEvent.preventDefault()}stopPropagation(){this.domEvent.stopPropagation()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class dt extends Ze{constructor(e){super(e);this.useCapture=!1}observe(e){(typeof this.domEventType=="string"?[this.domEventType]:this.domEventType).forEach(n=>{this.listenTo(e,n,(s,o)=>{this.isEnabled&&!this.checkShouldIgnoreEventFromTarget(o.target)&&this.onDomEvent(o)},{useCapture:this.useCapture})})}fire(e,t,n){this.isEnabled&&this.document.fire(e,new Ds(this.view,t,n))}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Hv extends dt{constructor(e){super(e);this.domEventType=["keydown","keyup"]}onDomEvent(e){this.fire(e.type,e,{keyCode:e.keyCode,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,get keystroke(){return $e(this)}})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class $v extends Ze{constructor(e){super(e);this._fireSelectionChangeDoneDebounced=Gn(t=>this.document.fire("selectionChangeDone",t),200)}observe(){const e=this.document;e.on("arrowKey",(t,n)=>{e.selection.isFake&&this.isEnabled&&n.preventDefault()},{context:"$capture"}),e.on("arrowKey",(t,n)=>{e.selection.isFake&&this.isEnabled&&this._handleSelectionMove(n.keyCode)},{priority:"lowest"})}destroy(){super.destroy(),this._fireSelectionChangeDoneDebounced.cancel()}_handleSelectionMove(e){const t=this.document.selection,n=new Re(t.getRanges(),{backward:t.isBackward,fake:!1});(e==V.arrowleft||e==V.arrowup)&&n.setTo(n.getFirstPosition()),(e==V.arrowright||e==V.arrowdown)&&n.setTo(n.getLastPosition());const s={oldSelection:t,newSelection:n,domSelection:null};this.document.fire("selectionChange",s),this._fireSelectionChangeDoneDebounced(s)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Wv extends Ze{constructor(e){super(e);this.mutationObserver=e.getObserver(Sl),this.selection=this.document.selection,this.domConverter=e.domConverter,this._documents=new WeakSet,this._fireSelectionChangeDoneDebounced=Gn(t=>this.document.fire("selectionChangeDone",t),200),this._clearInfiniteLoopInterval=setInterval(()=>this._clearInfiniteLoop(),1e3),this._documentIsSelectingInactivityTimeoutDebounced=Gn(()=>this.document.isSelecting=!1,5e3),this._loopbackCounter=0}observe(e){const t=e.ownerDocument,n=()=>{this.document.isSelecting=!0,this._documentIsSelectingInactivityTimeoutDebounced()},s=()=>{this.document.isSelecting=!1,this._documentIsSelectingInactivityTimeoutDebounced.cancel()};this.listenTo(e,"selectstart",n,{priority:"highest"}),this.listenTo(e,"keydown",s,{priority:"highest"}),this.listenTo(e,"keyup",s,{priority:"highest"}),!this._documents.has(t)&&(this.listenTo(t,"mouseup",s,{priority:"highest"}),this.listenTo(t,"selectionchange",(o,r)=>{this._handleSelectionChange(r,t),this._documentIsSelectingInactivityTimeoutDebounced()}),this._documents.add(t))}destroy(){super.destroy(),clearInterval(this._clearInfiniteLoopInterval),this._fireSelectionChangeDoneDebounced.cancel(),this._documentIsSelectingInactivityTimeoutDebounced.cancel()}_handleSelectionChange(e,t){if(!this.isEnabled)return;const n=t.defaultView.getSelection();if(this.checkShouldIgnoreEventFromTarget(n.anchorNode))return;this.mutationObserver.flush();const s=this.domConverter.domSelectionToView(n);if(s.rangeCount==0){this.view.hasDomSelection=!1;return}if(this.view.hasDomSelection=!0,!(this.selection.isEqual(s)&&this.domConverter.isDomSelectionCorrect(n))&&!(++this._loopbackCounter>60))if(this.selection.isSimilar(s))this.view.forceRender();else{const o={oldSelection:this.selection,newSelection:s,domSelection:n};this.document.fire("selectionChange",o),this._fireSelectionChangeDoneDebounced(o)}}_clearInfiniteLoop(){this._loopbackCounter=0}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Uv extends dt{constructor(e){super(e);this.domEventType=["focus","blur"],this.useCapture=!0;const t=this.document;t.on("focus",()=>{t.isFocused=!0,this._renderTimeoutId=setTimeout(()=>e.change(()=>{}),50)}),t.on("blur",(n,s)=>{const o=t.selection.editableElement;(o===null||o===s.target)&&(t.isFocused=!1,e.change(()=>{}))})}onDomEvent(e){this.fire(e.type,e)}destroy(){this._renderTimeoutId&&clearTimeout(this._renderTimeoutId),super.destroy()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class qv extends dt{constructor(e){super(e);this.domEventType=["compositionstart","compositionupdate","compositionend"];const t=this.document;t.on("compositionstart",()=>{t.isComposing=!0}),t.on("compositionend",()=>{t.isComposing=!1})}onDomEvent(e){this.fire(e.type,e)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md.
 */class jv extends dt{constructor(e){super(e);this.domEventType=["beforeinput"]}onDomEvent(e){this.fire(e.type,e)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Kv{constructor(){this._replacedElements=[]}replace(e,t){this._replacedElements.push({element:e,newElement:t}),e.style.display="none",t&&e.parentNode.insertBefore(t,e.nextSibling)}restore(){this._replacedElements.forEach(({element:e,newElement:t})=>{e.style.display="",t&&t.remove()}),this._replacedElements=[]}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Bs(i,e,t={},n=[]){const s=t&&t.xmlns,o=s?i.createElementNS(s,e):i.createElement(e);for(const r in t)o.setAttribute(r,t[r]);(Na(n)||!Te(n))&&(n=[n]);for(let r of n)Na(r)&&(r=i.createTextNode(r)),o.appendChild(r);return o}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Gv(i){return i instanceof HTMLTextAreaElement?i.value:i.innerHTML}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function ai(i){return Object.prototype.toString.apply(i)=="[object Range]"}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Pl(i){const e=i.ownerDocument.defaultView.getComputedStyle(i);return{top:parseInt(e.borderTopWidth,10),right:parseInt(e.borderRightWidth,10),bottom:parseInt(e.borderBottomWidth,10),left:parseInt(e.borderLeftWidth,10)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const xl=["top","right","bottom","left","width","height"];class F{constructor(e){const t=ai(e);if(Object.defineProperty(this,"_source",{value:e._source||e,writable:!0,enumerable:!1}),Et(e)||t)if(t){const n=F.getDomRangeRects(e);li(this,F.getBoundingRect(n))}else li(this,e.getBoundingClientRect());else if(ri(e)){const{innerWidth:n,innerHeight:s}=e;li(this,{top:0,right:n,bottom:s,left:0,width:n,height:s})}else li(this,e)}clone(){return new F(this)}moveTo(e,t){return this.top=t,this.right=e+this.width,this.bottom=t+this.height,this.left=e,this}moveBy(e,t){return this.top+=t,this.right+=e,this.left+=e,this.bottom+=t,this}getIntersection(e){const t={top:Math.max(this.top,e.top),right:Math.min(this.right,e.right),bottom:Math.min(this.bottom,e.bottom),left:Math.max(this.left,e.left)};return t.width=t.right-t.left,t.height=t.bottom-t.top,t.width<0||t.height<0?null:new F(t)}getIntersectionArea(e){const t=this.getIntersection(e);return t?t.getArea():0}getArea(){return this.width*this.height}getVisible(){const e=this._source;let t=this.clone();if(!Il(e)){let n=e.parentNode||e.commonAncestorContainer;for(;n&&!Il(n);){const s=new F(n),o=t.getIntersection(s);if(o)o.getArea()<t.getArea()&&(t=o);else return null;n=n.parentNode}}return t}isEqual(e){for(const t of xl)if(this[t]!==e[t])return!1;return!0}contains(e){const t=this.getIntersection(e);return!!(t&&t.isEqual(e))}excludeScrollbarsAndBorders(){const e=this._source;let t,n,s;if(ri(e))t=e.innerWidth-e.document.documentElement.clientWidth,n=e.innerHeight-e.document.documentElement.clientHeight,s=e.getComputedStyle(e.document.documentElement).direction;else{const o=Pl(this._source);t=e.offsetWidth-e.clientWidth-o.left-o.right,n=e.offsetHeight-e.clientHeight-o.top-o.bottom,s=e.ownerDocument.defaultView.getComputedStyle(e).direction,this.left+=o.left,this.top+=o.top,this.right-=o.right,this.bottom-=o.bottom,this.width=this.right-this.left,this.height=this.bottom-this.top}return this.width-=t,s==="ltr"?this.right-=t:this.left+=t,this.height-=n,this.bottom-=n,this}static getDomRangeRects(e){const t=[],n=Array.from(e.getClientRects());if(n.length)for(const s of n)t.push(new F(s));else{let s=e.startContainer;le(s)&&(s=s.parentNode);const o=new F(s.getBoundingClientRect());o.right=o.left,o.width=0,t.push(o)}return t}static getBoundingRect(e){const t={left:Number.POSITIVE_INFINITY,top:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY,bottom:Number.NEGATIVE_INFINITY};let n=0;for(const s of e)n++,t.left=Math.min(t.left,s.left),t.top=Math.min(t.top,s.top),t.right=Math.max(t.right,s.right),t.bottom=Math.max(t.bottom,s.bottom);return n==0?null:(t.width=t.right-t.left,t.height=t.bottom-t.top,new F(t))}}function li(i,e){for(const t of xl)i[t]=e[t]}function Il(i){return Et(i)?i===i.ownerDocument.body:!1}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Rl=100;class Y{constructor(e,t){Y._observerInstance||Y._createObserver(),this._element=e,this._callback=t,Y._addElementCallback(e,t),Y._observerInstance.observe(e)}destroy(){Y._deleteElementCallback(this._element,this._callback)}static _addElementCallback(e,t){Y._elementCallbacks||(Y._elementCallbacks=new Map);let n=Y._elementCallbacks.get(e);n||(n=new Set,Y._elementCallbacks.set(e,n)),n.add(t)}static _deleteElementCallback(e,t){const n=Y._getElementCallbacks(e);n&&(n.delete(t),n.size||(Y._elementCallbacks.delete(e),Y._observerInstance.unobserve(e))),Y._elementCallbacks&&!Y._elementCallbacks.size&&(Y._observerInstance=null,Y._elementCallbacks=null)}static _getElementCallbacks(e){return Y._elementCallbacks?Y._elementCallbacks.get(e):null}static _createObserver(){let e;typeof ee.window.ResizeObserver=="function"?e=ee.window.ResizeObserver:e=Ml,Y._observerInstance=new e(t=>{for(const n of t){const s=Y._getElementCallbacks(n.target);if(s)for(const o of s)o(n)}})}}Y._observerInstance=null;Y._elementCallbacks=null;class Ml{constructor(e){this._callback=e,this._elements=new Set,this._previousRects=new Map,this._periodicCheckTimeout=null}observe(e){this._elements.add(e),this._checkElementRectsAndExecuteCallback(),this._elements.size===1&&this._startPeriodicCheck()}unobserve(e){this._elements.delete(e),this._previousRects.delete(e),this._elements.size||this._stopPeriodicCheck()}_startPeriodicCheck(){const e=()=>{this._checkElementRectsAndExecuteCallback(),this._periodicCheckTimeout=setTimeout(e,Rl)};this.listenTo(ee.window,"resize",()=>{this._checkElementRectsAndExecuteCallback()}),this._periodicCheckTimeout=setTimeout(e,Rl)}_stopPeriodicCheck(){clearTimeout(this._periodicCheckTimeout),this.stopListening(),this._previousRects.clear()}_checkElementRectsAndExecuteCallback(){const e=[];for(const t of this._elements)this._hasRectChanged(t)&&e.push({target:t,contentRect:this._previousRects.get(t)});e.length&&this._callback(e)}_hasRectChanged(e){if(!e.ownerDocument.body.contains(e))return!1;const t=new F(e),n=this._previousRects.get(e),s=!n||!n.isEqual(t);return this._previousRects.set(e,t),s}}A(Ml,jt);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Jv(i,e){i instanceof HTMLTextAreaElement&&(i.value=e),i.innerHTML=e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Vl(i){return e=>e+i}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function ge(i){const e=i.next();return e.done?null:e.value}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ae{constructor(){this.set("isFocused",!1),this.set("focusedElement",null),this._elements=new Set,this._nextEventLoopTimeout=null}add(e){if(this._elements.has(e))throw new f("focustracker-add-element-already-exist",this);this.listenTo(e,"focus",()=>this._focus(e),{useCapture:!0}),this.listenTo(e,"blur",()=>this._blur(),{useCapture:!0}),this._elements.add(e)}remove(e){e===this.focusedElement&&this._blur(e),this._elements.has(e)&&(this.stopListening(e),this._elements.delete(e))}destroy(){this.stopListening()}_focus(e){clearTimeout(this._nextEventLoopTimeout),this.focusedElement=e,this.isFocused=!0}_blur(){clearTimeout(this._nextEventLoopTimeout),this._nextEventLoopTimeout=setTimeout(()=>{this.focusedElement=null,this.isFocused=!1},0)}}A(Ae,jt);A(Ae,$);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class et{constructor(){this._listener=Object.create(jt)}listenTo(e){this._listener.listenTo(e,"keydown",(t,n)=>{this._listener.fire("_keydown:"+$e(n),n)})}set(e,t,n={}){const s=Ps(e),o=n.priority;this._listener.listenTo(this._listener,"_keydown:"+s,(r,a)=>{t(a,()=>{a.preventDefault(),a.stopPropagation(),r.stop()}),r.return=!0},{priority:o})}press(e){return!!this._listener.fire("_keydown:"+$e(e),e)}destroy(){this._listener.stopListening()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Qv extends Ze{constructor(e){super(e);this.document.on("keydown",(t,n)=>{if(this.isEnabled&&hv(n.keyCode)){const s=new ti(this.document,"arrowKey",this.document.selection.getFirstRange());this.document.fire(s,n),s.stop.called&&t.stop()}})}observe(){}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Yv={};function Ol({target:i,viewportOffset:e=0}){const t=Fs(i);let n=t,s=null;for(;n;){let o;n==t?o=Ls(i):o=Ls(s),Nl(o,()=>zl(i,n));const r=zl(i,n);if(Zv(n,r,e),n.parent!=n){if(s=n.frameElement,n=n.parent,!s)return}else n=null}}function Xv(i){const e=Ls(i);Nl(e,()=>new F(i))}Object.assign(Yv,{scrollViewportToShowTarget:Ol,scrollAncestorsToShowTarget:Xv});function Zv(i,e,t){const n=e.clone().moveBy(0,t),s=e.clone().moveBy(0,-t),o=new F(i).excludeScrollbarsAndBorders();if(![s,n].every(a=>o.contains(a))){let{scrollX:a,scrollY:l}=i;Bl(s,o)?l-=o.top-e.top+t:Dl(n,o)&&(l+=e.bottom-o.bottom+t),Fl(e,o)?a-=o.left-e.left+t:Ll(e,o)&&(a+=e.right-o.right+t),i.scrollTo(a,l)}}function Nl(i,e){const t=Fs(i);let n,s;for(;i!=t.document.body;)s=e(),n=new F(i).excludeScrollbarsAndBorders(),n.contains(s)||(Bl(s,n)?i.scrollTop-=n.top-s.top:Dl(s,n)&&(i.scrollTop+=s.bottom-n.bottom),Fl(s,n)?i.scrollLeft-=n.left-s.left:Ll(s,n)&&(i.scrollLeft+=s.right-n.right)),i=i.parentNode}function Dl(i,e){return i.bottom>e.bottom}function Bl(i,e){return i.top<e.top}function Fl(i,e){return i.left<e.left}function Ll(i,e){return i.right>e.right}function Fs(i){return ai(i)?i.startContainer.ownerDocument.defaultView:i.ownerDocument.defaultView}function Ls(i){if(ai(i)){let e=i.commonAncestorContainer;return le(e)&&(e=e.parentNode),e}else return i.parentNode}function zl(i,e){const t=Fs(i),n=new F(i);if(t===e)return n;{let s=t;for(;s!=e;){const o=s.frameElement,r=new F(o).excludeScrollbarsAndBorders();n.moveBy(r.left,r.top),s=s.parent}}return n}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Hl{constructor(e){this.document=new An(e),this.domConverter=new oi(this.document),this.domRoots=new Map,this.set("isRenderingInProgress",!1),this.set("hasDomSelection",!1),this._renderer=new bl(this.domConverter,this.document.selection),this._renderer.bind("isFocused","isSelecting").to(this.document),this._initialDomRootAttributes=new WeakMap,this._observers=new Map,this._ongoingChange=!1,this._postFixersInProgress=!1,this._renderingDisabled=!1,this._hasChangedSinceTheLastRendering=!1,this._writer=new ol(this.document),this.addObserver(Sl),this.addObserver(Wv),this.addObserver(Uv),this.addObserver(Hv),this.addObserver($v),this.addObserver(qv),this.addObserver(Qv),W.isAndroid&&this.addObserver(jv),kv(this),wv(this),this.on("render",()=>{this._render(),this.document.fire("layoutChanged"),this._hasChangedSinceTheLastRendering=!1}),this.listenTo(this.document.selection,"change",()=>{this._hasChangedSinceTheLastRendering=!0}),this.listenTo(this.document,"change:isFocused",()=>{this._hasChangedSinceTheLastRendering=!0})}attachDomRoot(e,t="main"){const n=this.document.getRoot(t);n._name=e.tagName.toLowerCase();const s={};for(const{name:r,value:a}of Array.from(e.attributes))s[r]=a,r==="class"?this._writer.addClass(a.split(" "),n):this._writer.setAttribute(r,a,n);this._initialDomRootAttributes.set(e,s);const o=()=>{this._writer.setAttribute("contenteditable",!n.isReadOnly,n),n.isReadOnly?this._writer.addClass("ck-read-only",n):this._writer.removeClass("ck-read-only",n)};o(),this.domRoots.set(t,e),this.domConverter.bindElements(e,n),this._renderer.markToSync("children",n),this._renderer.markToSync("attributes",n),this._renderer.domDocuments.add(e.ownerDocument),n.on("change:children",(r,a)=>this._renderer.markToSync("children",a)),n.on("change:attributes",(r,a)=>this._renderer.markToSync("attributes",a)),n.on("change:text",(r,a)=>this._renderer.markToSync("text",a)),n.on("change:isReadOnly",()=>this.change(o)),n.on("change",()=>{this._hasChangedSinceTheLastRendering=!0});for(const r of this._observers.values())r.observe(e,t)}detachDomRoot(e){const t=this.domRoots.get(e);Array.from(t.attributes).forEach(({name:s})=>t.removeAttribute(s));const n=this._initialDomRootAttributes.get(t);for(const s in n)t.setAttribute(s,n[s]);this.domRoots.delete(e),this.domConverter.unbindDomElement(t)}getDomRoot(e="main"){return this.domRoots.get(e)}addObserver(e){let t=this._observers.get(e);if(t)return t;t=new e(this),this._observers.set(e,t);for(const[n,s]of this.domRoots)t.observe(s,n);return t.enable(),t}getObserver(e){return this._observers.get(e)}disableObservers(){for(const e of this._observers.values())e.disable()}enableObservers(){for(const e of this._observers.values())e.enable()}scrollToTheSelection(){const e=this.document.selection.getFirstRange();e&&Ol({target:this.domConverter.viewRangeToDom(e),viewportOffset:20})}focus(){if(!this.document.isFocused){const e=this.document.selection.editableElement;e&&(this.domConverter.focus(e),this.forceRender())}}change(e){if(this.isRenderingInProgress||this._postFixersInProgress)throw new f("cannot-change-view-tree",this);try{if(this._ongoingChange)return e(this._writer);this._ongoingChange=!0;const t=e(this._writer);return this._ongoingChange=!1,!this._renderingDisabled&&this._hasChangedSinceTheLastRendering&&(this._postFixersInProgress=!0,this.document._callPostFixers(this._writer),this._postFixersInProgress=!1,this.fire("render")),t}catch(t){f.rethrowUnexpectedError(t,this)}}forceRender(){this._hasChangedSinceTheLastRendering=!0,this.change(()=>{})}destroy(){for(const e of this._observers.values())e.destroy();this.document.destroy(),this.stopListening()}createPositionAt(e,t){return y._createAt(e,t)}createPositionAfter(e){return y._createAfter(e)}createPositionBefore(e){return y._createBefore(e)}createRange(e,t){return new P(e,t)}createRangeOn(e){return P._createOn(e)}createRangeIn(e){return P._createIn(e)}createSelection(e,t,n){return new Re(e,t,n)}_disableRendering(e){this._renderingDisabled=e,e==!1&&this.change(()=>{})}_render(){this.isRenderingInProgress=!0,this.disableObservers(),this._renderer.render(),this.enableObservers(),this.isRenderingInProgress=!1}}A(Hl,$);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Pt{constructor(e){this.parent=null,this._attrs=Xe(e)}get index(){let e;if(!this.parent)return null;if((e=this.parent.getChildIndex(this))===null)throw new f("model-node-not-found-in-parent",this);return e}get startOffset(){let e;if(!this.parent)return null;if((e=this.parent.getChildStartOffset(this))===null)throw new f("model-node-not-found-in-parent",this);return e}get offsetSize(){return 1}get endOffset(){return this.parent?this.startOffset+this.offsetSize:null}get nextSibling(){const e=this.index;return e!==null&&this.parent.getChild(e+1)||null}get previousSibling(){const e=this.index;return e!==null&&this.parent.getChild(e-1)||null}get root(){let e=this;for(;e.parent;)e=e.parent;return e}isAttached(){return this.root.is("rootElement")}getPath(){const e=[];let t=this;for(;t.parent;)e.unshift(t.startOffset),t=t.parent;return e}getAncestors(e={includeSelf:!1,parentFirst:!1}){const t=[];let n=e.includeSelf?this:this.parent;for(;n;)t[e.parentFirst?"push":"unshift"](n),n=n.parent;return t}getCommonAncestor(e,t={}){const n=this.getAncestors(t),s=e.getAncestors(t);let o=0;for(;n[o]==s[o]&&n[o];)o++;return o===0?null:n[o-1]}isBefore(e){if(this==e||this.root!==e.root)return!1;const t=this.getPath(),n=e.getPath(),s=he(t,n);switch(s){case"prefix":return!0;case"extension":return!1;default:return t[s]<n[s]}}isAfter(e){return this==e||this.root!==e.root?!1:!this.isBefore(e)}hasAttribute(e){return this._attrs.has(e)}getAttribute(e){return this._attrs.get(e)}getAttributes(){return this._attrs.entries()}getAttributeKeys(){return this._attrs.keys()}toJSON(){const e={};return this._attrs.size&&(e.attributes=Array.from(this._attrs).reduce((t,n)=>(t[n[0]]=n[1],t),{})),e}is(e){return e==="node"||e==="model:node"}_clone(){return new Pt(this._attrs)}_remove(){this.parent._removeChildren(this.index)}_setAttribute(e,t){this._attrs.set(e,t)}_setAttributesTo(e){this._attrs=Xe(e)}_removeAttribute(e){return this._attrs.delete(e)}_clearAttributes(){this._attrs.clear()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class j extends Pt{constructor(e,t){super(t);this._data=e||""}get offsetSize(){return this.data.length}get data(){return this._data}is(e){return e==="$text"||e==="model:$text"||e==="text"||e==="model:text"||e==="node"||e==="model:node"}toJSON(){const e=super.toJSON();return e.data=this.data,e}_clone(){return new j(this.data,this.getAttributes())}static fromJSON(e){return new j(e.data,e.attributes)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ue{constructor(e,t,n){if(this.textNode=e,t<0||t>e.offsetSize)throw new f("model-textproxy-wrong-offsetintext",this);if(n<0||t+n>e.offsetSize)throw new f("model-textproxy-wrong-length",this);this.data=e.data.substring(t,t+n),this.offsetInText=t}get startOffset(){return this.textNode.startOffset!==null?this.textNode.startOffset+this.offsetInText:null}get offsetSize(){return this.data.length}get endOffset(){return this.startOffset!==null?this.startOffset+this.offsetSize:null}get isPartial(){return this.offsetSize!==this.textNode.offsetSize}get parent(){return this.textNode.parent}get root(){return this.textNode.root}is(e){return e==="$textProxy"||e==="model:$textProxy"||e==="textProxy"||e==="model:textProxy"}getPath(){const e=this.textNode.getPath();return e.length>0&&(e[e.length-1]+=this.offsetInText),e}getAncestors(e={includeSelf:!1,parentFirst:!1}){const t=[];let n=e.includeSelf?this:this.parent;for(;n;)t[e.parentFirst?"push":"unshift"](n),n=n.parent;return t}hasAttribute(e){return this.textNode.hasAttribute(e)}getAttribute(e){return this.textNode.getAttribute(e)}getAttributes(){return this.textNode.getAttributes()}getAttributeKeys(){return this.textNode.getAttributeKeys()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Kt{constructor(e){this._nodes=[],e&&this._insertNodes(0,e)}[Symbol.iterator](){return this._nodes[Symbol.iterator]()}get length(){return this._nodes.length}get maxOffset(){return this._nodes.reduce((e,t)=>e+t.offsetSize,0)}getNode(e){return this._nodes[e]||null}getNodeIndex(e){const t=this._nodes.indexOf(e);return t==-1?null:t}getNodeStartOffset(e){const t=this.getNodeIndex(e);return t===null?null:this._nodes.slice(0,t).reduce((n,s)=>n+s.offsetSize,0)}indexToOffset(e){if(e==this._nodes.length)return this.maxOffset;const t=this._nodes[e];if(!t)throw new f("model-nodelist-index-out-of-bounds",this);return this.getNodeStartOffset(t)}offsetToIndex(e){let t=0;for(const n of this._nodes){if(e>=t&&e<t+n.offsetSize)return this.getNodeIndex(n);t+=n.offsetSize}if(t!=e)throw new f("model-nodelist-offset-out-of-bounds",this,{offset:e,nodeList:this});return this.length}_insertNodes(e,t){for(const n of t)if(!(n instanceof Pt))throw new f("model-nodelist-insertnodes-not-node",this);this._nodes.splice(e,0,...t)}_removeNodes(e,t=1){return this._nodes.splice(e,t)}toJSON(){return this._nodes.map(e=>e.toJSON())}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class L extends Pt{constructor(e,t,n){super(t);this.name=e,this._children=new Kt,n&&this._insertChild(0,n)}get childCount(){return this._children.length}get maxOffset(){return this._children.maxOffset}get isEmpty(){return this.childCount===0}is(e,t=null){return t?t===this.name&&(e==="element"||e==="model:element"):e==="element"||e==="model:element"||e==="node"||e==="model:node"}getChild(e){return this._children.getNode(e)}getChildren(){return this._children[Symbol.iterator]()}getChildIndex(e){return this._children.getNodeIndex(e)}getChildStartOffset(e){return this._children.getNodeStartOffset(e)}offsetToIndex(e){return this._children.offsetToIndex(e)}getNodeByPath(e){let t=this;for(const n of e)t=t.getChild(t.offsetToIndex(n));return t}findAncestor(e,t={includeSelf:!1}){let n=t.includeSelf?this:this.parent;for(;n;){if(n.name===e)return n;n=n.parent}return null}toJSON(){const e=super.toJSON();if(e.name=this.name,this._children.length>0){e.children=[];for(const t of this._children)e.children.push(t.toJSON())}return e}_clone(e=!1){const t=e?Array.from(this._children).map(n=>n._clone(!0)):null;return new L(this.name,this.getAttributes(),t)}_appendChild(e){this._insertChild(this.childCount,e)}_insertChild(e,t){const n=e1(t);for(const s of n)s.parent!==null&&s._remove(),s.parent=this;this._children._insertNodes(e,n)}_removeChildren(e,t=1){const n=this._children._removeNodes(e,t);for(const s of n)s.parent=null;return n}static fromJSON(e){let t=null;if(e.children){t=[];for(const n of e.children)n.name?t.push(L.fromJSON(n)):t.push(j.fromJSON(n))}return new L(e.name,e.attributes,t)}}function e1(i){return typeof i=="string"?[new j(i)]:(Te(i)||(i=[i]),Array.from(i).map(e=>typeof e=="string"?new j(e):e instanceof Ue?new j(e.data,e.getAttributes()):e))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class tt{constructor(e={}){if(!e.boundaries&&!e.startPosition)throw new f("model-tree-walker-no-start-position",null);const t=e.direction||"forward";if(t!="forward"&&t!="backward")throw new f("model-tree-walker-unknown-direction",e,{direction:t});this.direction=t,this.boundaries=e.boundaries||null,e.startPosition?this.position=e.startPosition.clone():this.position=_._createAt(this.boundaries[this.direction=="backward"?"end":"start"]),this.position.stickiness="toNone",this.singleCharacters=!!e.singleCharacters,this.shallow=!!e.shallow,this.ignoreElementEnd=!!e.ignoreElementEnd,this._boundaryStartParent=this.boundaries?this.boundaries.start.parent:null,this._boundaryEndParent=this.boundaries?this.boundaries.end.parent:null,this._visitedParent=this.position.parent}[Symbol.iterator](){return this}skip(e){let t,n,s,o;do s=this.position,o=this._visitedParent,{done:t,value:n}=this.next();while(!t&&e(n));t||(this.position=s,this._visitedParent=o)}next(){return this.direction=="forward"?this._next():this._previous()}_next(){const e=this.position,t=this.position.clone(),n=this._visitedParent;if(n.parent===null&&t.offset===n.maxOffset)return{done:!0};if(n===this._boundaryEndParent&&t.offset==this.boundaries.end.offset)return{done:!0};const s=t.parent,o=Gt(t,s),r=o||zs(t,s,o);if(r instanceof L)return this.shallow?t.offset++:(t.path.push(0),this._visitedParent=r),this.position=t,xt("elementStart",r,e,t,1);if(r instanceof j){let a;if(this.singleCharacters)a=1;else{let u=r.endOffset;this._boundaryEndParent==n&&this.boundaries.end.offset<u&&(u=this.boundaries.end.offset),a=u-t.offset}const l=t.offset-r.startOffset,c=new Ue(r,l,a);return t.offset+=a,this.position=t,xt("text",c,e,t,a)}else return t.path.pop(),t.offset++,this.position=t,this._visitedParent=n.parent,this.ignoreElementEnd?this._next():xt("elementEnd",n,e,t)}_previous(){const e=this.position,t=this.position.clone(),n=this._visitedParent;if(n.parent===null&&t.offset===0)return{done:!0};if(n==this._boundaryStartParent&&t.offset==this.boundaries.start.offset)return{done:!0};const s=t.parent,o=Gt(t,s),r=o||$l(t,s,o);if(r instanceof L)return t.offset--,this.shallow?(this.position=t,xt("elementStart",r,e,t,1)):(t.path.push(r.maxOffset),this.position=t,this._visitedParent=r,this.ignoreElementEnd?this._previous():xt("elementEnd",r,e,t));if(r instanceof j){let a;if(this.singleCharacters)a=1;else{let u=r.startOffset;this._boundaryStartParent==n&&this.boundaries.start.offset>u&&(u=this.boundaries.start.offset),a=t.offset-u}const l=t.offset-r.startOffset,c=new Ue(r,l-a,a);return t.offset-=a,this.position=t,xt("text",c,e,t,a)}else return t.path.pop(),this.position=t,this._visitedParent=n.parent,xt("elementStart",n,e,t,1)}}function xt(i,e,t,n,s){return{done:!1,value:{type:i,item:e,previousPosition:t,nextPosition:n,length:s}}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class _{constructor(e,t,n="toNone"){if(!e.is("element")&&!e.is("documentFragment"))throw new f("model-position-root-invalid",e);if(!(t instanceof Array)||t.length===0)throw new f("model-position-path-incorrect-format",e,{path:t});e.is("rootElement")?t=t.slice():(t=[...e.getPath(),...t],e=e.root),this.root=e,this.path=t,this.stickiness=n}get offset(){return this.path[this.path.length-1]}set offset(e){this.path[this.path.length-1]=e}get parent(){let e=this.root;for(let t=0;t<this.path.length-1;t++)if(e=e.getChild(e.offsetToIndex(this.path[t])),!e)throw new f("model-position-path-incorrect",this,{position:this});if(e.is("$text"))throw new f("model-position-path-incorrect",this,{position:this});return e}get index(){return this.parent.offsetToIndex(this.offset)}get textNode(){return Gt(this,this.parent)}get nodeAfter(){const e=this.parent;return zs(this,e,Gt(this,e))}get nodeBefore(){const e=this.parent;return $l(this,e,Gt(this,e))}get isAtStart(){return this.offset===0}get isAtEnd(){return this.offset==this.parent.maxOffset}compareWith(e){if(this.root!=e.root)return"different";const t=he(this.path,e.path);switch(t){case"same":return"same";case"prefix":return"before";case"extension":return"after";default:return this.path[t]<e.path[t]?"before":"after"}}getLastMatchingPosition(e,t={}){t.startPosition=this;const n=new tt(t);return n.skip(e),n.position}getParentPath(){return this.path.slice(0,-1)}getAncestors(){const e=this.parent;return e.is("documentFragment")?[e]:e.getAncestors({includeSelf:!0})}findAncestor(e){const t=this.parent;return t.is("element")?t.findAncestor(e,{includeSelf:!0}):null}getCommonPath(e){if(this.root!=e.root)return[];const t=he(this.path,e.path),n=typeof t=="string"?Math.min(this.path.length,e.path.length):t;return this.path.slice(0,n)}getCommonAncestor(e){const t=this.getAncestors(),n=e.getAncestors();let s=0;for(;t[s]==n[s]&&t[s];)s++;return s===0?null:t[s-1]}getShiftedBy(e){const t=this.clone(),n=t.offset+e;return t.offset=n<0?0:n,t}isAfter(e){return this.compareWith(e)=="after"}isBefore(e){return this.compareWith(e)=="before"}isEqual(e){return this.compareWith(e)=="same"}isTouching(e){let t=null,n=null;switch(this.compareWith(e)){case"same":return!0;case"before":t=_._createAt(this),n=_._createAt(e);break;case"after":t=_._createAt(e),n=_._createAt(this);break;default:return!1}let o=t.parent;for(;t.path.length+n.path.length;){if(t.isEqual(n))return!0;if(t.path.length>n.path.length){if(t.offset!==o.maxOffset)return!1;t.path=t.path.slice(0,-1),o=o.parent,t.offset++}else{if(n.offset!==0)return!1;n.path=n.path.slice(0,-1)}}}is(e){return e==="position"||e==="model:position"}hasSameParentAs(e){if(this.root!==e.root)return!1;const t=this.getParentPath(),n=e.getParentPath();return he(t,n)=="same"}getTransformedByOperation(e){let t;switch(e.type){case"insert":t=this._getTransformedByInsertOperation(e);break;case"move":case"remove":case"reinsert":t=this._getTransformedByMoveOperation(e);break;case"split":t=this._getTransformedBySplitOperation(e);break;case"merge":t=this._getTransformedByMergeOperation(e);break;default:t=_._createAt(this);break}return t}_getTransformedByInsertOperation(e){return this._getTransformedByInsertion(e.position,e.howMany)}_getTransformedByMoveOperation(e){return this._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany)}_getTransformedBySplitOperation(e){const t=e.movedRange;return t.containsPosition(this)||t.start.isEqual(this)&&this.stickiness=="toNext"?this._getCombined(e.splitPosition,e.moveTargetPosition):e.graveyardPosition?this._getTransformedByMove(e.graveyardPosition,e.insertionPosition,1):this._getTransformedByInsertion(e.insertionPosition,1)}_getTransformedByMergeOperation(e){const t=e.movedRange,n=t.containsPosition(this)||t.start.isEqual(this);let s;return n?(s=this._getCombined(e.sourcePosition,e.targetPosition),e.sourcePosition.isBefore(e.targetPosition)&&(s=s._getTransformedByDeletion(e.deletionPosition,1))):this.isEqual(e.deletionPosition)?s=_._createAt(e.deletionPosition):s=this._getTransformedByMove(e.deletionPosition,e.graveyardPosition,1),s}_getTransformedByDeletion(e,t){const n=_._createAt(this);if(this.root!=e.root)return n;if(he(e.getParentPath(),this.getParentPath())=="same"){if(e.offset<this.offset){if(e.offset+t>this.offset)return null;n.offset-=t}}else if(he(e.getParentPath(),this.getParentPath())=="prefix"){const s=e.path.length-1;if(e.offset<=this.path[s]){if(e.offset+t>this.path[s])return null;n.path[s]-=t}}return n}_getTransformedByInsertion(e,t){const n=_._createAt(this);if(this.root!=e.root)return n;if(he(e.getParentPath(),this.getParentPath())=="same")(e.offset<this.offset||e.offset==this.offset&&this.stickiness!="toPrevious")&&(n.offset+=t);else if(he(e.getParentPath(),this.getParentPath())=="prefix"){const s=e.path.length-1;e.offset<=this.path[s]&&(n.path[s]+=t)}return n}_getTransformedByMove(e,t,n){if(t=t._getTransformedByDeletion(e,n),e.isEqual(t))return _._createAt(this);const s=this._getTransformedByDeletion(e,n);return s===null||e.isEqual(this)&&this.stickiness=="toNext"||e.getShiftedBy(n).isEqual(this)&&this.stickiness=="toPrevious"?this._getCombined(e,t):s._getTransformedByInsertion(t,n)}_getCombined(e,t){const n=e.path.length-1,s=_._createAt(t);return s.stickiness=this.stickiness,s.offset=s.offset+this.path[n]-e.offset,s.path=[...s.path,...this.path.slice(n+1)],s}toJSON(){return{root:this.root.toJSON(),path:Array.from(this.path),stickiness:this.stickiness}}clone(){return new this.constructor(this.root,this.path,this.stickiness)}static _createAt(e,t,n="toNone"){if(e instanceof _)return new _(e.root,e.path,e.stickiness);{const s=e;if(t=="end")t=s.maxOffset;else{if(t=="before")return this._createBefore(s,n);if(t=="after")return this._createAfter(s,n);if(t!==0&&!t)throw new f("model-createpositionat-offset-required",[this,e])}if(!s.is("element")&&!s.is("documentFragment"))throw new f("model-position-parent-incorrect",[this,e]);const o=s.getPath();return o.push(t),new this(s.root,o,n)}}static _createAfter(e,t){if(!e.parent)throw new f("model-position-after-root",[this,e],{root:e});return this._createAt(e.parent,e.endOffset,t)}static _createBefore(e,t){if(!e.parent)throw new f("model-position-before-root",e,{root:e});return this._createAt(e.parent,e.startOffset,t)}static fromJSON(e,t){if(e.root==="$graveyard"){const n=new _(t.graveyard,e.path);return n.stickiness=e.stickiness,n}if(!t.getRoot(e.root))throw new f("model-position-fromjson-no-root",t,{rootName:e.root});return new _(t.getRoot(e.root),e.path,e.stickiness)}}function Gt(i,e){const t=e.getChild(e.offsetToIndex(i.offset));return t&&t.is("$text")&&t.startOffset<i.offset?t:null}function zs(i,e,t){return t!==null?null:e.getChild(e.offsetToIndex(i.offset))}function $l(i,e,t){return t!==null?null:e.getChild(e.offsetToIndex(i.offset)-1)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class w{constructor(e,t=null){this.start=_._createAt(e),this.end=t?_._createAt(t):_._createAt(e),this.start.stickiness=this.isCollapsed?"toNone":"toNext",this.end.stickiness=this.isCollapsed?"toNone":"toPrevious"}*[Symbol.iterator](){yield*new tt({boundaries:this,ignoreElementEnd:!0})}get isCollapsed(){return this.start.isEqual(this.end)}get isFlat(){const e=this.start.getParentPath(),t=this.end.getParentPath();return he(e,t)=="same"}get root(){return this.start.root}containsPosition(e){return e.isAfter(this.start)&&e.isBefore(this.end)}containsRange(e,t=!1){e.isCollapsed&&(t=!1);const n=this.containsPosition(e.start)||t&&this.start.isEqual(e.start),s=this.containsPosition(e.end)||t&&this.end.isEqual(e.end);return n&&s}containsItem(e){const t=_._createBefore(e);return this.containsPosition(t)||this.start.isEqual(t)}is(e){return e==="range"||e==="model:range"}isEqual(e){return this.start.isEqual(e.start)&&this.end.isEqual(e.end)}isIntersecting(e){return this.start.isBefore(e.end)&&this.end.isAfter(e.start)}getDifference(e){const t=[];return this.isIntersecting(e)?(this.containsPosition(e.start)&&t.push(new w(this.start,e.start)),this.containsPosition(e.end)&&t.push(new w(e.end,this.end))):t.push(new w(this.start,this.end)),t}getIntersection(e){if(this.isIntersecting(e)){let t=this.start,n=this.end;return this.containsPosition(e.start)&&(t=e.start),this.containsPosition(e.end)&&(n=e.end),new w(t,n)}return null}getJoined(e,t=!1){let n=this.isIntersecting(e);if(n||(this.start.isBefore(e.start)?n=t?this.end.isTouching(e.start):this.end.isEqual(e.start):n=t?e.end.isTouching(this.start):e.end.isEqual(this.start)),!n)return null;let s=this.start,o=this.end;return e.start.isBefore(s)&&(s=e.start),e.end.isAfter(o)&&(o=e.end),new w(s,o)}getMinimalFlatRanges(){const e=[],t=this.start.getCommonPath(this.end).length,n=_._createAt(this.start);let s=n.parent;for(;n.path.length>t+1;){const o=s.maxOffset-n.offset;o!==0&&e.push(new w(n,n.getShiftedBy(o))),n.path=n.path.slice(0,-1),n.offset++,s=s.parent}for(;n.path.length<=this.end.path.length;){const o=this.end.path[n.path.length-1],r=o-n.offset;r!==0&&e.push(new w(n,n.getShiftedBy(r))),n.offset=o,n.path.push(0)}return e}getWalker(e={}){return e.boundaries=this,new tt(e)}*getItems(e={}){e.boundaries=this,e.ignoreElementEnd=!0;const t=new tt(e);for(const n of t)yield n.item}*getPositions(e={}){e.boundaries=this;const t=new tt(e);yield t.position;for(const n of t)yield n.nextPosition}getTransformedByOperation(e){switch(e.type){case"insert":return this._getTransformedByInsertOperation(e);case"move":case"remove":case"reinsert":return this._getTransformedByMoveOperation(e);case"split":return[this._getTransformedBySplitOperation(e)];case"merge":return[this._getTransformedByMergeOperation(e)]}return[new w(this.start,this.end)]}getTransformedByOperations(e){const t=[new w(this.start,this.end)];for(const n of e)for(let s=0;s<t.length;s++){const o=t[s].getTransformedByOperation(n);t.splice(s,1,...o),s+=o.length-1}for(let n=0;n<t.length;n++){const s=t[n];for(let o=n+1;o<t.length;o++){const r=t[o];(s.containsRange(r)||r.containsRange(s)||s.isEqual(r))&&t.splice(o,1)}}return t}getCommonAncestor(){return this.start.getCommonAncestor(this.end)}getContainedElement(){if(this.isCollapsed)return null;const e=this.start.nodeAfter,t=this.end.nodeBefore;return e&&e.is("element")&&e===t?e:null}toJSON(){return{start:this.start.toJSON(),end:this.end.toJSON()}}clone(){return new this.constructor(this.start,this.end)}_getTransformedByInsertOperation(e,t=!1){return this._getTransformedByInsertion(e.position,e.howMany,t)}_getTransformedByMoveOperation(e,t=!1){const n=e.sourcePosition,s=e.howMany,o=e.targetPosition;return this._getTransformedByMove(n,o,s,t)}_getTransformedBySplitOperation(e){const t=this.start._getTransformedBySplitOperation(e);let n=this.end._getTransformedBySplitOperation(e);return this.end.isEqual(e.insertionPosition)&&(n=this.end.getShiftedBy(1)),t.root!=n.root&&(n=this.end.getShiftedBy(-1)),new w(t,n)}_getTransformedByMergeOperation(e){if(this.start.isEqual(e.targetPosition)&&this.end.isEqual(e.deletionPosition))return new w(this.start);let t=this.start._getTransformedByMergeOperation(e),n=this.end._getTransformedByMergeOperation(e);return t.root!=n.root&&(n=this.end.getShiftedBy(-1)),t.isAfter(n)?(e.sourcePosition.isBefore(e.targetPosition)?(t=_._createAt(n),t.offset=0):(e.deletionPosition.isEqual(t)||(n=e.deletionPosition),t=e.targetPosition),new w(t,n)):new w(t,n)}_getTransformedByInsertion(e,t,n=!1){if(n&&this.containsPosition(e))return[new w(this.start,e),new w(e.getShiftedBy(t),this.end._getTransformedByInsertion(e,t))];{const s=new w(this.start,this.end);return s.start=s.start._getTransformedByInsertion(e,t),s.end=s.end._getTransformedByInsertion(e,t),[s]}}_getTransformedByMove(e,t,n,s=!1){if(this.isCollapsed){const d=this.start._getTransformedByMove(e,t,n);return[new w(d)]}const o=w._createFromPositionAndShift(e,n),r=t._getTransformedByDeletion(e,n);if(this.containsPosition(t)&&!s&&(o.containsPosition(this.start)||o.containsPosition(this.end))){const d=this.start._getTransformedByMove(e,t,n),h=this.end._getTransformedByMove(e,t,n);return[new w(d,h)]}let a;const l=this.getDifference(o);let c=null;const u=this.getIntersection(o);if(l.length==1?c=new w(l[0].start._getTransformedByDeletion(e,n),l[0].end._getTransformedByDeletion(e,n)):l.length==2&&(c=new w(this.start,this.end._getTransformedByDeletion(e,n))),c?a=c._getTransformedByInsertion(r,n,u!==null||s):a=[],u){const d=new w(u.start._getCombined(o.start,r),u.end._getCombined(o.start,r));a.length==2?a.splice(1,0,d):a.push(d)}return a}_getTransformedByDeletion(e,t){let n=this.start._getTransformedByDeletion(e,t),s=this.end._getTransformedByDeletion(e,t);return n==null&&s==null?null:(n==null&&(n=e),s==null&&(s=e),new w(n,s))}static _createFromPositionAndShift(e,t){const n=e,s=e.getShiftedBy(t);return t>0?new this(n,s):new this(s,n)}static _createIn(e){return new this(_._createAt(e,0),_._createAt(e,e.maxOffset))}static _createOn(e){return this._createFromPositionAndShift(_._createBefore(e),e.offsetSize)}static _createFromRanges(e){if(e.length===0)throw new f("range-create-from-ranges-empty-array",null);if(e.length==1)return e[0].clone();const t=e[0];e.sort((o,r)=>o.start.isAfter(r.start)?1:-1);const n=e.indexOf(t),s=new this(t.start,t.end);if(n>0)for(let o=n-1;e[o].end.isEqual(s.start);o++)s.start=_._createAt(e[o].start);for(let o=n+1;o<e.length&&e[o].start.isEqual(s.end);o++)s.end=_._createAt(e[o].end);return s}static fromJSON(e,t){return new this(_.fromJSON(e.start,t),_.fromJSON(e.end,t))}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Hs{constructor(){this._modelToViewMapping=new WeakMap,this._viewToModelMapping=new WeakMap,this._viewToModelLengthCallbacks=new Map,this._markerNameToElements=new Map,this._elementToMarkerNames=new Map,this._unboundMarkerNames=new Set,this.on("modelToViewPosition",(e,t)=>{if(t.viewPosition)return;const n=this._modelToViewMapping.get(t.modelPosition.parent);t.viewPosition=this.findPositionIn(n,t.modelPosition.offset)},{priority:"low"}),this.on("viewToModelPosition",(e,t)=>{if(t.modelPosition)return;const n=this.findMappedViewAncestor(t.viewPosition),s=this._viewToModelMapping.get(n),o=this._toModelOffset(t.viewPosition.parent,t.viewPosition.offset,n);t.modelPosition=_._createAt(s,o)},{priority:"low"})}bindElements(e,t){this._modelToViewMapping.set(e,t),this._viewToModelMapping.set(t,e)}unbindViewElement(e){const t=this.toModelElement(e);if(this._viewToModelMapping.delete(e),this._elementToMarkerNames.has(e))for(const n of this._elementToMarkerNames.get(e))this._unboundMarkerNames.add(n);this._modelToViewMapping.get(t)==e&&this._modelToViewMapping.delete(t)}unbindModelElement(e){const t=this.toViewElement(e);this._modelToViewMapping.delete(e),this._viewToModelMapping.get(t)==e&&this._viewToModelMapping.delete(t)}bindElementToMarker(e,t){const n=this._markerNameToElements.get(t)||new Set;n.add(e);const s=this._elementToMarkerNames.get(e)||new Set;s.add(t),this._markerNameToElements.set(t,n),this._elementToMarkerNames.set(e,s)}unbindElementFromMarkerName(e,t){const n=this._markerNameToElements.get(t);n&&(n.delete(e),n.size==0&&this._markerNameToElements.delete(t));const s=this._elementToMarkerNames.get(e);s&&(s.delete(t),s.size==0&&this._elementToMarkerNames.delete(e))}flushUnboundMarkerNames(){const e=Array.from(this._unboundMarkerNames);return this._unboundMarkerNames.clear(),e}clearBindings(){this._modelToViewMapping=new WeakMap,this._viewToModelMapping=new WeakMap,this._markerNameToElements=new Map,this._elementToMarkerNames=new Map,this._unboundMarkerNames=new Set}toModelElement(e){return this._viewToModelMapping.get(e)}toViewElement(e){return this._modelToViewMapping.get(e)}toModelRange(e){return new w(this.toModelPosition(e.start),this.toModelPosition(e.end))}toViewRange(e){return new P(this.toViewPosition(e.start),this.toViewPosition(e.end))}toModelPosition(e){const t={viewPosition:e,mapper:this};return this.fire("viewToModelPosition",t),t.modelPosition}toViewPosition(e,t={isPhantom:!1}){const n={modelPosition:e,mapper:this,isPhantom:t.isPhantom};return this.fire("modelToViewPosition",n),n.viewPosition}markerNameToElements(e){const t=this._markerNameToElements.get(e);if(!t)return null;const n=new Set;for(const s of t)if(s.is("attributeElement"))for(const o of s.getElementsWithSameId())n.add(o);else n.add(s);return n}registerViewToModelLength(e,t){this._viewToModelLengthCallbacks.set(e,t)}findMappedViewAncestor(e){let t=e.parent;for(;!this._viewToModelMapping.has(t);)t=t.parent;return t}_toModelOffset(e,t,n){if(n!=e){const o=this._toModelOffset(e.parent,e.index,n),r=this._toModelOffset(e,t,e);return o+r}if(e.is("$text"))return t;let s=0;for(let o=0;o<t;o++)s+=this.getModelLength(e.getChild(o));return s}getModelLength(e){if(this._viewToModelLengthCallbacks.get(e.name))return this._viewToModelLengthCallbacks.get(e.name)(e);if(this._viewToModelMapping.has(e))return 1;if(e.is("$text"))return e.data.length;if(e.is("uiElement"))return 0;{let t=0;for(const n of e.getChildren())t+=this.getModelLength(n);return t}}findPositionIn(e,t){let n,s=0,o=0,r=0;if(e.is("$text"))return new y(e,t);for(;o<t;)n=e.getChild(r),s=this.getModelLength(n),o+=s,r++;return o==t?this._moveViewPositionToTextNode(new y(e,r)):this.findPositionIn(n,t-(o-s))}_moveViewPositionToTextNode(e){const t=e.nodeBefore,n=e.nodeAfter;return t instanceof q?new y(t,t.data.length):n instanceof q?new y(n,0):e}}A(Hs,H);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ci{constructor(){this._consumable=new Map,this._textProxyRegistry=new Map}add(e,t){t=ui(t),e instanceof Ue&&(e=this._getSymbolForTextProxy(e)),this._consumable.has(e)||this._consumable.set(e,new Map),this._consumable.get(e).set(t,!0)}consume(e,t){return t=ui(t),e instanceof Ue&&(e=this._getSymbolForTextProxy(e)),this.test(e,t)?(this._consumable.get(e).set(t,!1),!0):!1}test(e,t){t=ui(t),e instanceof Ue&&(e=this._getSymbolForTextProxy(e));const n=this._consumable.get(e);if(n===void 0)return null;const s=n.get(t);return s===void 0?null:s}revert(e,t){t=ui(t),e instanceof Ue&&(e=this._getSymbolForTextProxy(e));const n=this.test(e,t);return n===!1?(this._consumable.get(e).set(t,!0),!0):n===!0?!1:null}_getSymbolForTextProxy(e){let t=null;const n=this._textProxyRegistry.get(e.startOffset);if(n){const s=n.get(e.endOffset);s&&(t=s.get(e.parent))}return t||(t=this._addSymbolForTextProxy(e.startOffset,e.endOffset,e.parent)),t}_addSymbolForTextProxy(e,t,n){const s=Symbol("textProxySymbol");let o,r;return o=this._textProxyRegistry.get(e),o||(o=new Map,this._textProxyRegistry.set(e,o)),r=o.get(t),r||(r=new Map,o.set(t,r)),r.set(n,s),s}}function ui(i){const e=i.split(":");return e[0]=="addMarker"||e[0]=="removeMarker"?i:e.length>1?e[0]+":"+e[1]:e[0]}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class $s{constructor(e){this.conversionApi=Object.assign({dispatcher:this},e),this._reconversionEventsMapping=new Map}convertChanges(e,t,n){for(const o of e.getMarkersToRemove())this.convertMarkerRemove(o.name,o.range,n);const s=this._mapChangesWithAutomaticReconversion(e);for(const o of s)o.type==="insert"?this.convertInsert(w._createFromPositionAndShift(o.position,o.length),n):o.type==="remove"?this.convertRemove(o.position,o.length,o.name,n):o.type==="reconvert"?this.reconvertElement(o.element,n):this.convertAttribute(o.range,o.attributeKey,o.attributeOldValue,o.attributeNewValue,n);for(const o of this.conversionApi.mapper.flushUnboundMarkerNames()){const r=t.get(o).getRange();this.convertMarkerRemove(o,r,n),this.convertMarkerAdd(o,r,n)}for(const o of e.getMarkersToAdd())this.convertMarkerAdd(o.name,o.range,n)}convertInsert(e,t){this.conversionApi.writer=t,this.conversionApi.consumable=this._createInsertConsumable(e);for(const n of Array.from(e).map(Wl))this._convertInsertWithAttributes(n);this._clearConversionApi()}convertRemove(e,t,n,s){this.conversionApi.writer=s,this.fire("remove:"+n,{position:e,length:t},this.conversionApi),this._clearConversionApi()}convertAttribute(e,t,n,s,o){this.conversionApi.writer=o,this.conversionApi.consumable=this._createConsumableForRange(e,`attribute:${t}`);for(const r of e){const a=r.item,l=w._createFromPositionAndShift(r.previousPosition,r.length),c={item:a,range:l,attributeKey:t,attributeOldValue:n,attributeNewValue:s};this._testAndFire(`attribute:${t}`,c)}this._clearConversionApi()}reconvertElement(e,t){const n=w._createOn(e);this.conversionApi.writer=t,this.conversionApi.consumable=this._createInsertConsumable(n);const s=this.conversionApi.mapper,o=s.toViewElement(e);t.remove(o),this._convertInsertWithAttributes({item:e,range:n});const r=s.toViewElement(e);for(const a of w._createIn(e)){const{item:l}=a,c=i1(l,s);c?c.root!==r.root&&t.move(t.createRangeOn(c),s.toViewPosition(_._createBefore(l))):this._convertInsertWithAttributes(Wl(a))}s.unbindViewElement(o),this._clearConversionApi()}convertSelection(e,t,n){const s=Array.from(t.getMarkersAtPosition(e.getFirstPosition()));if(this.conversionApi.writer=n,this.conversionApi.consumable=this._createSelectionConsumable(e,s),this.fire("selection",{selection:e},this.conversionApi),!e.isCollapsed){this._clearConversionApi();return}for(const o of s){const r=o.getRange();if(!t1(e.getFirstPosition(),o,this.conversionApi.mapper))continue;const a={item:e,markerName:o.name,markerRange:r};this.conversionApi.consumable.test(e,"addMarker:"+o.name)&&this.fire("addMarker:"+o.name,a,this.conversionApi)}for(const o of e.getAttributeKeys()){const r={item:e,range:e.getFirstRange(),attributeKey:o,attributeOldValue:null,attributeNewValue:e.getAttribute(o)};this.conversionApi.consumable.test(e,"attribute:"+r.attributeKey)&&this.fire("attribute:"+r.attributeKey+":$text",r,this.conversionApi)}this._clearConversionApi()}convertMarkerAdd(e,t,n){if(t.root.rootName=="$graveyard")return;this.conversionApi.writer=n;const s="addMarker:"+e,o=new ci;if(o.add(t,s),this.conversionApi.consumable=o,this.fire(s,{markerName:e,markerRange:t},this.conversionApi),!o.test(t,s)){this._clearConversionApi();return}this.conversionApi.consumable=this._createConsumableForRange(t,s);for(const r of t.getItems()){if(!this.conversionApi.consumable.test(r,s))continue;const a={item:r,range:w._createOn(r),markerName:e,markerRange:t};this.fire(s,a,this.conversionApi)}this._clearConversionApi()}convertMarkerRemove(e,t,n){t.root.rootName!="$graveyard"&&(this.conversionApi.writer=n,this.fire("removeMarker:"+e,{markerName:e,markerRange:t},this.conversionApi),this._clearConversionApi())}_mapReconversionTriggerEvent(e,t){this._reconversionEventsMapping.set(t,e)}_createInsertConsumable(e){const t=new ci;for(const n of e){const s=n.item;t.add(s,"insert");for(const o of s.getAttributeKeys())t.add(s,"attribute:"+o)}return t}_createConsumableForRange(e,t){const n=new ci;for(const s of e.getItems())n.add(s,t);return n}_createSelectionConsumable(e,t){const n=new ci;n.add(e,"selection");for(const s of t)n.add(e,"addMarker:"+s.name);for(const s of e.getAttributeKeys())n.add(e,"attribute:"+s);return n}_testAndFire(e,t){!this.conversionApi.consumable.test(t.item,e)||this.fire(n1(e,t),t,this.conversionApi)}_clearConversionApi(){delete this.conversionApi.writer,delete this.conversionApi.consumable}_convertInsertWithAttributes(e){this._testAndFire("insert",e);for(const t of e.item.getAttributeKeys())e.attributeKey=t,e.attributeOldValue=null,e.attributeNewValue=e.item.getAttribute(t),this._testAndFire(`attribute:${t}`,e)}_mapChangesWithAutomaticReconversion(e){const t=new Set,n=[];for(const s of e.getChanges()){const o=s.position||s.range.start,r=o.parent;if(Gt(o,r)){n.push(s);continue}const l=s.type==="attribute"?zs(o,r,null):r;if(l.is("$text")){n.push(s);continue}let c;if(s.type==="attribute"?c=`attribute:${s.attributeKey}:${l.name}`:c=`${s.type}:${s.name}`,this._isReconvertTriggerEvent(c,l.name)){if(t.has(l))continue;t.add(l),n.push({type:"reconvert",element:l})}else n.push(s)}return n}_isReconvertTriggerEvent(e,t){return this._reconversionEventsMapping.get(e)===t}}A($s,H);function t1(i,e,t){const n=e.getRange(),s=Array.from(i.getAncestors());return s.shift(),s.reverse(),!s.some(r=>{if(n.containsItem(r))return!!t.toViewElement(r).getCustomProperty("addHighlight")})}function n1(i,e){const t=e.item.name||"$text";return`${i}:${t}`}function Wl(i){const e=i.item,t=w._createFromPositionAndShift(i.previousPosition,i.length);return{item:e,range:t}}function i1(i,e){if(i.is("textProxy")){const n=e.toViewPosition(_._createBefore(i)).parent;return n.is("$text")?n:null}return e.toViewElement(i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class nt{constructor(e,t,n){this._lastRangeBackward=!1,this._ranges=[],this._attrs=new Map,e&&this.setTo(e,t,n)}get anchor(){if(this._ranges.length>0){const e=this._ranges[this._ranges.length-1];return this._lastRangeBackward?e.end:e.start}return null}get focus(){if(this._ranges.length>0){const e=this._ranges[this._ranges.length-1];return this._lastRangeBackward?e.start:e.end}return null}get isCollapsed(){return this._ranges.length===1?this._ranges[0].isCollapsed:!1}get rangeCount(){return this._ranges.length}get isBackward(){return!this.isCollapsed&&this._lastRangeBackward}isEqual(e){if(this.rangeCount!=e.rangeCount)return!1;if(this.rangeCount===0)return!0;if(!this.anchor.isEqual(e.anchor)||!this.focus.isEqual(e.focus))return!1;for(const t of this._ranges){let n=!1;for(const s of e._ranges)if(t.isEqual(s)){n=!0;break}if(!n)return!1}return!0}*getRanges(){for(const e of this._ranges)yield new w(e.start,e.end)}getFirstRange(){let e=null;for(const t of this._ranges)(!e||t.start.isBefore(e.start))&&(e=t);return e?new w(e.start,e.end):null}getLastRange(){let e=null;for(const t of this._ranges)(!e||t.end.isAfter(e.end))&&(e=t);return e?new w(e.start,e.end):null}getFirstPosition(){const e=this.getFirstRange();return e?e.start.clone():null}getLastPosition(){const e=this.getLastRange();return e?e.end.clone():null}setTo(e,t,n){if(e===null)this._setRanges([]);else if(e instanceof nt)this._setRanges(e.getRanges(),e.isBackward);else if(e&&typeof e.getRanges=="function")this._setRanges(e.getRanges(),e.isBackward);else if(e instanceof w)this._setRanges([e],!!t&&!!t.backward);else if(e instanceof _)this._setRanges([new w(e)]);else if(e instanceof Pt){const s=!!n&&!!n.backward;let o;if(t=="in")o=w._createIn(e);else if(t=="on")o=w._createOn(e);else if(t!==void 0)o=new w(_._createAt(e,t));else throw new f("model-selection-setto-required-second-parameter",[this,e]);this._setRanges([o],s)}else if(Te(e))this._setRanges(e,t&&!!t.backward);else throw new f("model-selection-setto-not-selectable",[this,e])}_setRanges(e,t=!1){e=Array.from(e);const n=e.some(s=>{if(!(s instanceof w))throw new f("model-selection-set-ranges-not-range",[this,e]);return this._ranges.every(o=>!o.isEqual(s))});if(!(e.length===this._ranges.length&&!n)){this._removeAllRanges();for(const s of e)this._pushRange(s);this._lastRangeBackward=!!t,this.fire("change:range",{directChange:!0})}}setFocus(e,t){if(this.anchor===null)throw new f("model-selection-setfocus-no-ranges",[this,e]);const n=_._createAt(e,t);if(n.compareWith(this.focus)=="same")return;const s=this.anchor;this._ranges.length&&this._popRange(),n.compareWith(s)=="before"?(this._pushRange(new w(n,s)),this._lastRangeBackward=!0):(this._pushRange(new w(s,n)),this._lastRangeBackward=!1),this.fire("change:range",{directChange:!0})}getAttribute(e){return this._attrs.get(e)}getAttributes(){return this._attrs.entries()}getAttributeKeys(){return this._attrs.keys()}hasAttribute(e){return this._attrs.has(e)}removeAttribute(e){this.hasAttribute(e)&&(this._attrs.delete(e),this.fire("change:attribute",{attributeKeys:[e],directChange:!0}))}setAttribute(e,t){this.getAttribute(e)!==t&&(this._attrs.set(e,t),this.fire("change:attribute",{attributeKeys:[e],directChange:!0}))}getSelectedElement(){return this.rangeCount!==1?null:this.getFirstRange().getContainedElement()}is(e){return e==="selection"||e==="model:selection"}*getSelectedBlocks(){const e=new WeakSet;for(const t of this.getRanges()){const n=ql(t.start,e);n&&Ws(n,t)&&(yield n);for(const o of t.getWalker()){const r=o.item;o.type=="elementEnd"&&s1(r,e,t)&&(yield r)}const s=ql(t.end,e);s&&!t.end.isTouching(_._createAt(s,0))&&Ws(s,t)&&(yield s)}}containsEntireContent(e=this.anchor.root){const t=_._createAt(e,0),n=_._createAt(e,"end");return t.isTouching(this.getFirstPosition())&&n.isTouching(this.getLastPosition())}_pushRange(e){this._checkRange(e),this._ranges.push(new w(e.start,e.end))}_checkRange(e){for(let t=0;t<this._ranges.length;t++)if(e.isIntersecting(this._ranges[t]))throw new f("model-selection-range-intersects",[this,e],{addedRange:e,intersectingRange:this._ranges[t]})}_removeAllRanges(){for(;this._ranges.length>0;)this._popRange()}_popRange(){this._ranges.pop()}}A(nt,H);function Ul(i,e){return e.has(i)?!1:(e.add(i),i.root.document.model.schema.isBlock(i)&&i.parent)}function s1(i,e,t){return Ul(i,e)&&Ws(i,t)}function ql(i,e){const n=i.parent.root.document.model.schema,s=i.parent.getAncestors({parentFirst:!0,includeSelf:!0});let o=!1;const r=s.find(a=>o?!1:(o=n.isLimit(a),!o&&Ul(a,e)));return s.forEach(a=>e.add(a)),r}function Ws(i,e){const t=o1(i);return t?!e.containsRange(w._createOn(t),!0):!0}function o1(i){const e=i.root.document.model.schema;let t=i.parent;for(;t;){if(e.isBlock(t))return t;t=t.parent}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class qe extends w{constructor(e,t){super(e,t);r1.call(this)}detach(){this.stopListening()}is(e){return e==="liveRange"||e==="model:liveRange"||e=="range"||e==="model:range"}toRange(){return new w(this.start,this.end)}static fromRange(e){return new qe(e.start,e.end)}}function r1(){this.listenTo(this.root.document.model,"applyOperation",(i,e)=>{const t=e[0];!t.isDocumentOperation||a1.call(this,t)},{priority:"low"})}function a1(i){const e=this.getTransformedByOperation(i),t=w._createFromRanges(e),n=!t.isEqual(this),s=l1(this,i);let o=null;if(n){t.root.rootName=="$graveyard"&&(i.type=="remove"?o=i.sourcePosition:o=i.deletionPosition);const r=this.toRange();this.start=t.start,this.end=t.end,this.fire("change:range",r,{deletionPosition:o})}else s&&this.fire("change:content",this.toRange(),{deletionPosition:o})}function l1(i,e){switch(e.type){case"insert":return i.containsPosition(e.position);case"move":case"remove":case"reinsert":case"merge":return i.containsPosition(e.sourcePosition)||i.start.isEqual(e.sourcePosition)||i.containsPosition(e.targetPosition);case"split":return i.containsPosition(e.splitPosition)||i.containsPosition(e.insertionPosition)}return!1}A(qe,H);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Pn="selection:";class Me{constructor(e){this._selection=new c1(e),this._selection.delegate("change:range").to(this),this._selection.delegate("change:attribute").to(this),this._selection.delegate("change:marker").to(this)}get isCollapsed(){return this._selection.isCollapsed}get anchor(){return this._selection.anchor}get focus(){return this._selection.focus}get rangeCount(){return this._selection.rangeCount}get hasOwnRange(){return this._selection.hasOwnRange}get isBackward(){return this._selection.isBackward}get isGravityOverridden(){return this._selection.isGravityOverridden}get markers(){return this._selection.markers}get _ranges(){return this._selection._ranges}getRanges(){return this._selection.getRanges()}getFirstPosition(){return this._selection.getFirstPosition()}getLastPosition(){return this._selection.getLastPosition()}getFirstRange(){return this._selection.getFirstRange()}getLastRange(){return this._selection.getLastRange()}getSelectedBlocks(){return this._selection.getSelectedBlocks()}getSelectedElement(){return this._selection.getSelectedElement()}containsEntireContent(e){return this._selection.containsEntireContent(e)}destroy(){this._selection.destroy()}getAttributeKeys(){return this._selection.getAttributeKeys()}getAttributes(){return this._selection.getAttributes()}getAttribute(e){return this._selection.getAttribute(e)}hasAttribute(e){return this._selection.hasAttribute(e)}refresh(){this._selection._updateMarkers(),this._selection._updateAttributes(!1)}observeMarkers(e){this._selection.observeMarkers(e)}is(e){return e==="selection"||e=="model:selection"||e=="documentSelection"||e=="model:documentSelection"}_setFocus(e,t){this._selection.setFocus(e,t)}_setTo(e,t,n){this._selection.setTo(e,t,n)}_setAttribute(e,t){this._selection.setAttribute(e,t)}_removeAttribute(e){this._selection.removeAttribute(e)}_getStoredAttributes(){return this._selection._getStoredAttributes()}_overrideGravity(){return this._selection.overrideGravity()}_restoreGravity(e){this._selection.restoreGravity(e)}static _getStoreAttributeKey(e){return Pn+e}static _isStoreAttributeKey(e){return e.startsWith(Pn)}}A(Me,H);class c1 extends nt{constructor(e){super();this.markers=new _e({idProperty:"name"}),this._model=e.model,this._document=e,this._attributePriority=new Map,this._selectionRestorePosition=null,this._hasChangedRange=!1,this._overriddenGravityRegister=new Set,this._observedMarkers=new Set,this.listenTo(this._model,"applyOperation",(t,n)=>{const s=n[0];!s.isDocumentOperation||s.type=="marker"||s.type=="rename"||s.type=="noop"||(this._ranges.length==0&&this._selectionRestorePosition&&this._fixGraveyardSelection(this._selectionRestorePosition),this._selectionRestorePosition=null,this._hasChangedRange&&(this._hasChangedRange=!1,this.fire("change:range",{directChange:!1})))},{priority:"lowest"}),this.on("change:range",()=>{for(const t of this.getRanges())if(!this._document._validateSelectionRange(t))throw new f("document-selection-wrong-position",this,{range:t})}),this.listenTo(this._model.markers,"update",(t,n,s,o)=>{this._updateMarker(n,o)}),this.listenTo(this._document,"change",(t,n)=>{u1(this._model,n)})}get isCollapsed(){return this._ranges.length===0?this._document._getDefaultRange().isCollapsed:super.isCollapsed}get anchor(){return super.anchor||this._document._getDefaultRange().start}get focus(){return super.focus||this._document._getDefaultRange().end}get rangeCount(){return this._ranges.length?this._ranges.length:1}get hasOwnRange(){return this._ranges.length>0}get isGravityOverridden(){return!!this._overriddenGravityRegister.size}destroy(){for(let e=0;e<this._ranges.length;e++)this._ranges[e].detach();this.stopListening()}*getRanges(){this._ranges.length?yield*super.getRanges():yield this._document._getDefaultRange()}getFirstRange(){return super.getFirstRange()||this._document._getDefaultRange()}getLastRange(){return super.getLastRange()||this._document._getDefaultRange()}setTo(e,t,n){super.setTo(e,t,n),this._updateAttributes(!0),this._updateMarkers()}setFocus(e,t){super.setFocus(e,t),this._updateAttributes(!0),this._updateMarkers()}setAttribute(e,t){if(this._setAttribute(e,t)){const n=[e];this.fire("change:attribute",{attributeKeys:n,directChange:!0})}}removeAttribute(e){if(this._removeAttribute(e)){const t=[e];this.fire("change:attribute",{attributeKeys:t,directChange:!0})}}overrideGravity(){const e=Be();return this._overriddenGravityRegister.add(e),this._overriddenGravityRegister.size===1&&this._updateAttributes(!0),e}restoreGravity(e){if(!this._overriddenGravityRegister.has(e))throw new f("document-selection-gravity-wrong-restore",this,{uid:e});this._overriddenGravityRegister.delete(e),this.isGravityOverridden||this._updateAttributes(!0)}observeMarkers(e){this._observedMarkers.add(e),this._updateMarkers()}_popRange(){this._ranges.pop().detach()}_pushRange(e){const t=this._prepareRange(e);t&&this._ranges.push(t)}_prepareRange(e){if(this._checkRange(e),e.root==this._document.graveyard)return;const t=qe.fromRange(e);return t.on("change:range",(n,s,o)=>{if(this._hasChangedRange=!0,t.root==this._document.graveyard){this._selectionRestorePosition=o.deletionPosition;const r=this._ranges.indexOf(t);this._ranges.splice(r,1),t.detach()}}),t}_updateMarkers(){if(!this._observedMarkers.size)return;const e=[];let t=!1;for(const s of this._model.markers){const o=s.name.split(":",1)[0];if(!this._observedMarkers.has(o))continue;const r=s.getRange();for(const a of this.getRanges())r.containsRange(a,!a.isCollapsed)&&e.push(s)}const n=Array.from(this.markers);for(const s of e)this.markers.has(s)||(this.markers.add(s),t=!0);for(const s of Array.from(this.markers))e.includes(s)||(this.markers.remove(s),t=!0);t&&this.fire("change:marker",{oldMarkers:n,directChange:!1})}_updateMarker(e,t){const n=e.name.split(":",1)[0];if(!this._observedMarkers.has(n))return;let s=!1;const o=Array.from(this.markers),r=this.markers.has(e);if(!t)r&&(this.markers.remove(e),s=!0);else{let a=!1;for(const l of this.getRanges())if(t.containsRange(l,!l.isCollapsed)){a=!0;break}a&&!r?(this.markers.add(e),s=!0):!a&&r&&(this.markers.remove(e),s=!0)}s&&this.fire("change:marker",{oldMarkers:o,directChange:!1})}_updateAttributes(e){const t=Xe(this._getSurroundingAttributes()),n=Xe(this.getAttributes());if(e)this._attributePriority=new Map,this._attrs=new Map;else for(const[o,r]of this._attributePriority)r=="low"&&(this._attrs.delete(o),this._attributePriority.delete(o));this._setAttributesTo(t);const s=[];for(const[o,r]of this.getAttributes())(!n.has(o)||n.get(o)!==r)&&s.push(o);for(const[o]of n)this.hasAttribute(o)||s.push(o);s.length>0&&this.fire("change:attribute",{attributeKeys:s,directChange:!1})}_setAttribute(e,t,n=!0){const s=n?"normal":"low";return s=="low"&&this._attributePriority.get(e)=="normal"||super.getAttribute(e)===t?!1:(this._attrs.set(e,t),this._attributePriority.set(e,s),!0)}_removeAttribute(e,t=!0){const n=t?"normal":"low";return n=="low"&&this._attributePriority.get(e)=="normal"||(this._attributePriority.set(e,n),!super.hasAttribute(e))?!1:(this._attrs.delete(e),!0)}_setAttributesTo(e){const t=new Set;for(const[n,s]of this.getAttributes())e.get(n)!==s&&this._removeAttribute(n,!1);for(const[n,s]of e)this._setAttribute(n,s,!1)&&t.add(n);return t}*_getStoredAttributes(){const e=this.getFirstPosition().parent;if(this.isCollapsed&&e.isEmpty)for(const t of e.getAttributeKeys())t.startsWith(Pn)&&(yield[t.substr(Pn.length),e.getAttribute(t)])}_getSurroundingAttributes(){const e=this.getFirstPosition(),t=this._model.schema;let n=null;if(this.isCollapsed){const s=e.textNode?e.textNode:e.nodeBefore,o=e.textNode?e.textNode:e.nodeAfter;if(this.isGravityOverridden||(n=di(s)),n||(n=di(o)),!this.isGravityOverridden&&!n){let r=s;for(;r&&!t.isInline(r)&&!n;)r=r.previousSibling,n=di(r)}if(!n){let r=o;for(;r&&!t.isInline(r)&&!n;)r=r.nextSibling,n=di(r)}n||(n=this._getStoredAttributes())}else{const s=this.getFirstRange();for(const o of s){if(o.item.is("element")&&t.isObject(o.item))break;if(o.type=="text"){n=o.item.getAttributes();break}}}return n}_fixGraveyardSelection(e){const t=this._model.schema.getNearestSelectionRange(e);t&&this._pushRange(t)}}function di(i){return i instanceof Ue||i instanceof j?i.getAttributes():null}function u1(i,e){const t=i.document.differ;for(const n of t.getChanges()){if(n.type!="insert")continue;const s=n.position.parent;n.length===s.maxOffset&&i.enqueueChange(e,r=>{const a=Array.from(s.getAttributeKeys()).filter(l=>l.startsWith(Pn));for(const l of a)r.removeAttribute(l,s)})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class jl{constructor(e){this._dispatchers=e}add(e){for(const t of this._dispatchers)e(t);return this}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class d1 extends jl{elementToElement(e){return this.add(P1(e))}attributeToElement(e){return this.add(x1(e))}attributeToAttribute(e){return this.add(I1(e))}markerToElement(e){return this.add(R1(e))}markerToHighlight(e){return this.add(V1(e))}markerToData(e){return this.add(M1(e))}}function Kl(){return(i,e,t)=>{if(!t.consumable.consume(e.item,"insert"))return;const n=t.writer,s=t.mapper.toViewPosition(e.range.start),o=n.createText(e.item.data);n.insert(s,o)}}function h1(){return(i,e,t)=>{const n=t.mapper.toViewPosition(e.position),s=e.position.getShiftedBy(e.length),o=t.mapper.toViewPosition(s,{isPhantom:!0}),r=t.writer.createRange(n,o),a=t.writer.remove(r.getTrimmed());for(const l of t.writer.createRangeIn(a).getItems())t.mapper.unbindViewElement(l)}}function Gl(i,e){const t=i.createAttributeElement("span",e.attributes);return e.classes&&t._addClass(e.classes),typeof e.priority=="number"&&(t._priority=e.priority),t._id=e.id,t}function f1(){return(i,e,t)=>{const n=e.selection;if(n.isCollapsed||!t.consumable.consume(n,"selection"))return;const s=[];for(const o of n.getRanges()){const r=t.mapper.toViewRange(o);s.push(r)}t.writer.setSelection(s,{backward:n.isBackward})}}function m1(){return(i,e,t)=>{const n=e.selection;if(!n.isCollapsed||!t.consumable.consume(n,"selection"))return;const s=t.writer,o=n.getFirstPosition(),r=t.mapper.toViewPosition(o),a=s.breakAttributes(r);s.setSelection(a)}}function g1(){return(i,e,t)=>{const n=t.writer,s=n.document.selection;for(const o of s.getRanges())o.isCollapsed&&o.end.parent.isAttached()&&t.writer.mergeAttributes(o.start);n.setSelection(null)}}function p1(i){return(e,t,n)=>{const s=i(t.attributeOldValue,n),o=i(t.attributeNewValue,n);if(!s&&!o||!n.consumable.consume(t.item,e.name))return;const r=n.writer,a=r.document.selection;if(t.item instanceof nt||t.item instanceof Me)r.wrap(a.getFirstRange(),o);else{let l=n.mapper.toViewRange(t.range);t.attributeOldValue!==null&&s&&(l=r.unwrap(l,s)),t.attributeNewValue!==null&&o&&r.wrap(l,o)}}}function w1(i){return(e,t,n)=>{const s=i(t.item,n);if(!s||!n.consumable.consume(t.item,"insert"))return;const o=n.mapper.toViewPosition(t.range.start);n.mapper.bindElements(t.item,s),n.writer.insert(o,s)}}function b1(i){return(e,t,n)=>{t.isOpening=!0;const s=i(t,n);t.isOpening=!1;const o=i(t,n);if(!s||!o)return;const r=t.markerRange;if(r.isCollapsed&&!n.consumable.consume(r,e.name))return;for(const c of r)if(!n.consumable.consume(c.item,e.name))return;const a=n.mapper,l=n.writer;l.insert(a.toViewPosition(r.start),s),n.mapper.bindElementToMarker(s,t.markerName),r.isCollapsed||(l.insert(a.toViewPosition(r.end),o),n.mapper.bindElementToMarker(o,t.markerName)),e.stop()}}function _1(){return(i,e,t)=>{const n=t.mapper.markerNameToElements(e.markerName);if(!!n){for(const s of n)t.mapper.unbindElementFromMarkerName(s,e.markerName),t.writer.clear(t.writer.createRangeOn(s),s);t.writer.clearClonedElementsGroup(e.markerName),i.stop()}}}function v1(i){return(e,t,n)=>{const s=i(t.markerName,n);if(!s)return;const o=t.markerRange;!n.consumable.consume(o,e.name)||(Jl(o,!1,n,t,s),Jl(o,!0,n,t,s),e.stop())}}function Jl(i,e,t,n,s){const o=e?i.start:i.end,r=o.nodeAfter&&o.nodeAfter.is("element")?o.nodeAfter:null,a=o.nodeBefore&&o.nodeBefore.is("element")?o.nodeBefore:null;if(r||a){let c,u;e&&r||!e&&!a?(c=r,u=!0):(c=a,u=!1);const d=t.mapper.toViewElement(c);if(d){y1(d,e,u,t,n,s);return}}const l=t.mapper.toViewPosition(o);C1(l,e,t,n,s)}function y1(i,e,t,n,s,o){const r=`data-${o.group}-${e?"start":"end"}-${t?"before":"after"}`,a=i.hasAttribute(r)?i.getAttribute(r).split(","):[];a.unshift(o.name),n.writer.setAttribute(r,a.join(","),i),n.mapper.bindElementToMarker(i,s.markerName)}function C1(i,e,t,n,s){const o=`${s.group}-${e?"start":"end"}`,r=s.name?{name:s.name}:null,a=t.writer.createUIElement(o,r);t.writer.insert(i,a),t.mapper.bindElementToMarker(a,n.markerName)}function E1(i){return(e,t,n)=>{const s=i(t.markerName,n);if(!s)return;const o=n.mapper.markerNameToElements(t.markerName);if(!o)return;for(const a of o)n.mapper.unbindElementFromMarkerName(a,t.markerName),a.is("containerElement")?(r(`data-${s.group}-start-before`,a),r(`data-${s.group}-start-after`,a),r(`data-${s.group}-end-before`,a),r(`data-${s.group}-end-after`,a)):n.writer.clear(n.writer.createRangeOn(a),a);n.writer.clearClonedElementsGroup(t.markerName),e.stop();function r(a,l){if(l.hasAttribute(a)){const c=new Set(l.getAttribute(a).split(","));c.delete(s.name),c.size==0?n.writer.removeAttribute(a,l):n.writer.setAttribute(a,Array.from(c).join(","),l)}}}}function T1(i){return(e,t,n)=>{const s=i(t.attributeOldValue,n),o=i(t.attributeNewValue,n);if(!s&&!o||!n.consumable.consume(t.item,e.name))return;const r=n.mapper.toViewElement(t.item),a=n.writer;if(!r)throw new f("conversion-attribute-to-attribute-on-text",[t,n]);if(t.attributeOldValue!==null&&s)if(s.key=="class"){const l=oe(s.value);for(const c of l)a.removeClass(c,r)}else if(s.key=="style"){const l=Object.keys(s.value);for(const c of l)a.removeStyle(c,r)}else a.removeAttribute(s.key,r);if(t.attributeNewValue!==null&&o)if(o.key=="class"){const l=oe(o.value);for(const c of l)a.addClass(c,r)}else if(o.key=="style"){const l=Object.keys(o.value);for(const c of l)a.setStyle(c,o.value[c],r)}else a.setAttribute(o.key,o.value,r)}}function k1(i){return(e,t,n)=>{if(!t.item||!(t.item instanceof nt||t.item instanceof Me)&&!t.item.is("$textProxy"))return;const s=Us(i,t,n);if(!s||!n.consumable.consume(t.item,e.name))return;const o=n.writer,r=Gl(o,s),a=o.document.selection;if(t.item instanceof nt||t.item instanceof Me)o.wrap(a.getFirstRange(),r,a);else{const l=n.mapper.toViewRange(t.range),c=o.wrap(l,r);for(const u of c.getItems())if(u.is("attributeElement")&&u.isSimilar(r)){n.mapper.bindElementToMarker(u,t.markerName);break}}}}function A1(i){return(e,t,n)=>{if(!t.item||!(t.item instanceof L))return;const s=Us(i,t,n);if(!s||!n.consumable.test(t.item,e.name))return;const o=n.mapper.toViewElement(t.item);if(o&&o.getCustomProperty("addHighlight")){n.consumable.consume(t.item,e.name);for(const r of w._createIn(t.item))n.consumable.consume(r.item,e.name);o.getCustomProperty("addHighlight")(o,s,n.writer),n.mapper.bindElementToMarker(o,t.markerName)}}}function S1(i){return(e,t,n)=>{if(t.markerRange.isCollapsed)return;const s=Us(i,t,n);if(!s)return;const o=Gl(n.writer,s),r=n.mapper.markerNameToElements(t.markerName);if(!!r){for(const a of r)n.mapper.unbindElementFromMarkerName(a,t.markerName),a.is("attributeElement")?n.writer.unwrap(n.writer.createRangeOn(a),o):a.getCustomProperty("removeHighlight")(a,s.id,n.writer);n.writer.clearClonedElementsGroup(t.markerName),e.stop()}}}function P1(i){return i=ze(i),i.view=hi(i.view,"container"),e=>{if(e.on("insert:"+i.model,w1(i.view),{priority:i.converterPriority||"normal"}),i.triggerBy){if(i.triggerBy.attributes)for(const t of i.triggerBy.attributes)e._mapReconversionTriggerEvent(i.model,`attribute:${t}:${i.model}`);if(i.triggerBy.children)for(const t of i.triggerBy.children)e._mapReconversionTriggerEvent(i.model,`insert:${t}`),e._mapReconversionTriggerEvent(i.model,`remove:${t}`)}}}function x1(i){i=ze(i);const e=i.model.key?i.model.key:i.model;let t="attribute:"+e;if(i.model.name&&(t+=":"+i.model.name),i.model.values)for(const s of i.model.values)i.view[s]=hi(i.view[s],"attribute");else i.view=hi(i.view,"attribute");const n=Ql(i);return s=>{s.on(t,p1(n),{priority:i.converterPriority||"normal"})}}function I1(i){i=ze(i);const e=i.model.key?i.model.key:i.model;let t="attribute:"+e;if(i.model.name&&(t+=":"+i.model.name),i.model.values)for(const s of i.model.values)i.view[s]=Yl(i.view[s]);else i.view=Yl(i.view);const n=Ql(i);return s=>{s.on(t,T1(n),{priority:i.converterPriority||"normal"})}}function R1(i){return i=ze(i),i.view=hi(i.view,"ui"),e=>{e.on("addMarker:"+i.model,b1(i.view),{priority:i.converterPriority||"normal"}),e.on("removeMarker:"+i.model,_1(i.view),{priority:i.converterPriority||"normal"})}}function M1(i){i=ze(i);const e=i.model;return i.view||(i.view=t=>({group:e,name:t.substr(i.model.length+1)})),t=>{t.on("addMarker:"+e,v1(i.view),{priority:i.converterPriority||"normal"}),t.on("removeMarker:"+e,E1(i.view),{priority:i.converterPriority||"normal"})}}function V1(i){return e=>{e.on("addMarker:"+i.model,k1(i.view),{priority:i.converterPriority||"normal"}),e.on("addMarker:"+i.model,A1(i.view),{priority:i.converterPriority||"normal"}),e.on("removeMarker:"+i.model,S1(i.view),{priority:i.converterPriority||"normal"})}}function hi(i,e){return typeof i=="function"?i:(t,n)=>O1(i,n,e)}function O1(i,e,t){typeof i=="string"&&(i={name:i});let n;const s=e.writer,o=Object.assign({},i.attributes);if(t=="container")n=s.createContainerElement(i.name,o);else if(t=="attribute"){const r={priority:i.priority||Ut.DEFAULT_PRIORITY};n=s.createAttributeElement(i.name,o,r)}else n=s.createUIElement(i.name,o);if(i.styles){const r=Object.keys(i.styles);for(const a of r)s.setStyle(a,i.styles[a],n)}if(i.classes){const r=i.classes;if(typeof r=="string")s.addClass(r,n);else for(const a of r)s.addClass(a,n)}return n}function Ql(i){return i.model.values?(e,t)=>{const n=i.view[e];return n?n(e,t):null}:i.view}function Yl(i){return typeof i=="string"?e=>({key:i,value:e}):typeof i=="object"?i.value?()=>i:e=>({key:i.key,value:e}):i}function Us(i,e,t){const n=typeof i=="function"?i(e,t):i;return n?(n.priority||(n.priority=10),n.id||(n.id=e.markerName),n):null}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Xl(i){const{schema:e,document:t}=i.model;for(const n of t.getRootNames()){const s=t.getRoot(n);if(s.isEmpty&&!e.checkChild(s,"$text")&&e.checkChild(s,"paragraph"))return i.insertElement("paragraph",s),!0}return!1}function Zl(i,e,t){const n=t.createContext(i);return!(!t.checkChild(n,"paragraph")||!t.checkChild(n.push("paragraph"),e))}function ec(i,e){const t=e.createElement("paragraph");return e.insert(t,i),e.createPositionAt(t,0)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class N1 extends jl{elementToElement(e){return this.add(nc(e))}elementToAttribute(e){return this.add(F1(e))}attributeToAttribute(e){return this.add(L1(e))}elementToMarker(e){return this.add(z1(e))}dataToMarker(e){return this.add(H1(e))}}function tc(){return(i,e,t)=>{if(!e.modelRange&&t.consumable.consume(e.viewItem,{name:!0})){const{modelRange:n,modelCursor:s}=t.convertChildren(e.viewItem,e.modelCursor);e.modelRange=n,e.modelCursor=s}}}function D1(){return(i,e,{schema:t,consumable:n,writer:s})=>{let o=e.modelCursor;if(!n.test(e.viewItem))return;if(!t.checkChild(o,"$text")){if(!Zl(o,"$text",t))return;o=ec(o,s)}n.consume(e.viewItem);const r=s.createText(e.viewItem.data);s.insert(r,o),e.modelRange=s.createRange(o,o.getShiftedBy(r.offsetSize)),e.modelCursor=e.modelRange.end}}function B1(i,e){return(t,n)=>{const s=n.newSelection,o=[];for(const a of s.getRanges())o.push(e.toModelRange(a));const r=i.createSelection(o,{backward:s.isBackward});r.isEqual(i.document.selection)||i.change(a=>{a.setSelection(r)})}}function nc(i){i=ze(i);const e=js(i),t=qs(i.view),n=t?"element:"+t:"element";return s=>{s.on(n,e,{priority:i.converterPriority||"normal"})}}function F1(i){i=ze(i),ic(i);const e=sc(i,!1),t=qs(i.view),n=t?"element:"+t:"element";return s=>{s.on(n,e,{priority:i.converterPriority||"low"})}}function L1(i){i=ze(i);let e=null;(typeof i.view=="string"||i.view.key)&&(e=U1(i)),ic(i,e);const t=sc(i,!0);return n=>{n.on("element",t,{priority:i.converterPriority||"low"})}}function z1(i){return i=ze(i),K1(i),nc(i)}function H1(i){i=ze(i),i.model||(i.model=n=>n?i.view+":"+n:i.view);const e=js(oc(i,"start")),t=js(oc(i,"end"));return n=>{n.on("element:"+i.view+"-start",e,{priority:i.converterPriority||"normal"}),n.on("element:"+i.view+"-end",t,{priority:i.converterPriority||"normal"});const s=mn.get("low"),o=mn.get("highest"),r=mn.get(i.converterPriority)/o;n.on("element",$1(i),{priority:s+r})}}function $1(i){return(e,t,n)=>{const s=`data-${i.view}`;if(!n.consumable.test(t.viewItem,{attributes:s+"-end-after"})&&!n.consumable.test(t.viewItem,{attributes:s+"-start-after"})&&!n.consumable.test(t.viewItem,{attributes:s+"-end-before"})&&!n.consumable.test(t.viewItem,{attributes:s+"-start-before"}))return;t.modelRange||Object.assign(t,n.convertChildren(t.viewItem,t.modelCursor)),n.consumable.consume(t.viewItem,{attributes:s+"-end-after"})&&o(t.modelRange.end,t.viewItem.getAttribute(s+"-end-after").split(",")),n.consumable.consume(t.viewItem,{attributes:s+"-start-after"})&&o(t.modelRange.end,t.viewItem.getAttribute(s+"-start-after").split(",")),n.consumable.consume(t.viewItem,{attributes:s+"-end-before"})&&o(t.modelRange.start,t.viewItem.getAttribute(s+"-end-before").split(",")),n.consumable.consume(t.viewItem,{attributes:s+"-start-before"})&&o(t.modelRange.start,t.viewItem.getAttribute(s+"-start-before").split(","));function o(r,a){for(const l of a){const c=i.model(l,n),u=n.writer.createElement("$marker",{"data-name":c});n.writer.insert(u,r),t.modelCursor.isEqual(r)?t.modelCursor=t.modelCursor.getShiftedBy(1):t.modelCursor=t.modelCursor._getTransformedByInsertion(r,1),t.modelRange=t.modelRange._getTransformedByInsertion(r,1)[0]}}}}function qs(i){return typeof i=="string"?i:typeof i=="object"&&typeof i.name=="string"?i.name:null}function js(i){const e=new He(i.view);return(t,n,s)=>{const o=e.match(n.viewItem);if(!o)return;const r=o.match;if(r.name=!0,!s.consumable.test(n.viewItem,r))return;const a=W1(i.model,n.viewItem,s);!a||!s.safeInsert(a,n.modelCursor)||(s.consumable.consume(n.viewItem,r),s.convertChildren(n.viewItem,a),s.updateConversionResult(a,n))}}function W1(i,e,t){return i instanceof Function?i(e,t):t.writer.createElement(i)}function U1(i){typeof i.view=="string"&&(i.view={key:i.view});const e=i.view.key;let t;if(e=="class"||e=="style")t={[e=="class"?"classes":"styles"]:i.view.value};else{const n=typeof i.view.value=="undefined"?/[\s\S]*/:i.view.value;t={attributes:{[e]:n}}}return i.view.name&&(t.name=i.view.name),i.view=t,e}function ic(i,e=null){const t=e===null?!0:o=>o.getAttribute(e),n=typeof i.model!="object"?i.model:i.model.key,s=typeof i.model!="object"||typeof i.model.value=="undefined"?t:i.model.value;i.model={key:n,value:s}}function sc(i,e){const t=new He(i.view);return(n,s,o)=>{const r=t.match(s.viewItem);if(!r||(q1(i.view,s.viewItem)?r.match.name=!0:delete r.match.name,!o.consumable.test(s.viewItem,r.match)))return;const a=i.model.key,l=typeof i.model.value=="function"?i.model.value(s.viewItem,o):i.model.value;if(l===null)return;s.modelRange||Object.assign(s,o.convertChildren(s.viewItem,s.modelCursor)),j1(s.modelRange,{key:a,value:l},e,o)&&o.consumable.consume(s.viewItem,r.match)}}function q1(i,e){const t=typeof i=="function"?i(e):i;return typeof t=="object"&&!qs(t)?!1:!t.classes&&!t.attributes&&!t.styles}function j1(i,e,t,n){let s=!1;for(const o of Array.from(i.getItems({shallow:t})))!n.schema.checkAttribute(o,e.key)||(s=!0,!o.hasAttribute(e.key)&&n.writer.setAttribute(e.key,e.value,o));return s}function K1(i){const e=i.model;i.model=(t,n)=>{const s=typeof e=="string"?e:e(t,n);return n.writer.createElement("$marker",{"data-name":s})}}function oc(i,e){const t={};return t.view=i.view+"-"+e,t.model=(n,s)=>{const o=n.getAttribute("name"),r=i.model(o,s);return s.writer.createElement("$marker",{"data-name":r})},t}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class rc{constructor(e,t){this.model=e,this.view=new Hl(t),this.mapper=new Hs,this.downcastDispatcher=new $s({mapper:this.mapper,schema:e.schema});const n=this.model.document,s=n.selection,o=this.model.markers;this.listenTo(this.model,"_beforeChanges",()=>{this.view._disableRendering(!0)},{priority:"highest"}),this.listenTo(this.model,"_afterChanges",()=>{this.view._disableRendering(!1)},{priority:"lowest"}),this.listenTo(n,"change",()=>{this.view.change(r=>{this.downcastDispatcher.convertChanges(n.differ,o,r),this.downcastDispatcher.convertSelection(s,o,r)})},{priority:"low"}),this.listenTo(this.view.document,"selectionChange",B1(this.model,this.mapper)),this.downcastDispatcher.on("insert:$text",Kl(),{priority:"lowest"}),this.downcastDispatcher.on("remove",h1(),{priority:"low"}),this.downcastDispatcher.on("selection",g1(),{priority:"high"}),this.downcastDispatcher.on("selection",f1(),{priority:"low"}),this.downcastDispatcher.on("selection",m1(),{priority:"low"}),this.view.document.roots.bindTo(this.model.document.roots).using(r=>{if(r.rootName=="$graveyard")return null;const a=new Y_(this.view.document,r.name);return a.rootName=r.rootName,this.mapper.bindElements(r,a),a})}destroy(){this.view.destroy(),this.stopListening()}}A(rc,$);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class G1{constructor(){this._commands=new Map}add(e,t){this._commands.set(e,t)}get(e){return this._commands.get(e)}execute(e,...t){const n=this.get(e);if(!n)throw new f("commandcollection-command-not-found",this,{commandName:e});return n.execute(...t)}*names(){yield*this._commands.keys()}*commands(){yield*this._commands.values()}[Symbol.iterator](){return this._commands[Symbol.iterator]()}destroy(){for(const e of this.commands())e.destroy()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class xn{constructor(){this._consumables=new Map}add(e,t){let n;if(e.is("$text")||e.is("documentFragment")){this._consumables.set(e,!0);return}this._consumables.has(e)?n=this._consumables.get(e):(n=new J1(e),this._consumables.set(e,n)),n.add(t)}test(e,t){const n=this._consumables.get(e);return n===void 0?null:e.is("$text")||e.is("documentFragment")?n:n.test(t)}consume(e,t){return this.test(e,t)?(e.is("$text")||e.is("documentFragment")?this._consumables.set(e,!1):this._consumables.get(e).consume(t),!0):!1}revert(e,t){const n=this._consumables.get(e);n!==void 0&&(e.is("$text")||e.is("documentFragment")?this._consumables.set(e,!0):n.revert(t))}static consumablesFromElement(e){const t={element:e,name:!0,attributes:[],classes:[],styles:[]},n=e.getAttributeKeys();for(const r of n)r=="style"||r=="class"||t.attributes.push(r);const s=e.getClassNames();for(const r of s)t.classes.push(r);const o=e.getStyleNames();for(const r of o)t.styles.push(r);return t}static createFrom(e,t){if(t||(t=new xn(e)),e.is("$text"))return t.add(e),t;e.is("element")&&t.add(e,xn.consumablesFromElement(e)),e.is("documentFragment")&&t.add(e);for(const n of e.getChildren())t=xn.createFrom(n,t);return t}}class J1{constructor(e){this.element=e,this._canConsumeName=null,this._consumables={attributes:new Map,styles:new Map,classes:new Map}}add(e){e.name&&(this._canConsumeName=!0);for(const t in this._consumables)t in e&&this._add(t,e[t])}test(e){if(e.name&&!this._canConsumeName)return this._canConsumeName;for(const t in this._consumables)if(t in e){const n=this._test(t,e[t]);if(n!==!0)return n}return!0}consume(e){e.name&&(this._canConsumeName=!1);for(const t in this._consumables)t in e&&this._consume(t,e[t])}revert(e){e.name&&(this._canConsumeName=!0);for(const t in this._consumables)t in e&&this._revert(t,e[t])}_add(e,t){const n=me(t)?t:[t],s=this._consumables[e];for(const o of n){if(e==="attributes"&&(o==="class"||o==="style"))throw new f("viewconsumable-invalid-attribute",this);if(s.set(o,!0),e==="styles")for(const r of this.element.document.stylesProcessor.getRelatedStyles(o))s.set(r,!0)}}_test(e,t){const n=me(t)?t:[t],s=this._consumables[e];for(const o of n)if(e==="attributes"&&(o==="class"||o==="style")){const r=o=="class"?"classes":"styles",a=this._test(r,[...this._consumables[r].keys()]);if(a!==!0)return a}else{const r=s.get(o);if(r===void 0)return null;if(!r)return!1}return!0}_consume(e,t){const n=me(t)?t:[t],s=this._consumables[e];for(const o of n)if(e==="attributes"&&(o==="class"||o==="style")){const r=o=="class"?"classes":"styles";this._consume(r,[...this._consumables[r].keys()])}else if(s.set(o,!1),e=="styles")for(const r of this.element.document.stylesProcessor.getRelatedStyles(o))s.set(r,!1)}_revert(e,t){const n=me(t)?t:[t],s=this._consumables[e];for(const o of n)if(e==="attributes"&&(o==="class"||o==="style")){const r=o=="class"?"classes":"styles";this._revert(r,[...this._consumables[r].keys()])}else s.get(o)===!1&&s.set(o,!0)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ac{constructor(){this._sourceDefinitions={},this._attributeProperties={},this.decorate("checkChild"),this.decorate("checkAttribute"),this.on("checkAttribute",(e,t)=>{t[0]=new It(t[0])},{priority:"highest"}),this.on("checkChild",(e,t)=>{t[0]=new It(t[0]),t[1]=this.getDefinition(t[1])},{priority:"highest"})}register(e,t){if(this._sourceDefinitions[e])throw new f("schema-cannot-register-item-twice",this,{itemName:e});this._sourceDefinitions[e]=[Object.assign({},t)],this._clearCache()}extend(e,t){if(!this._sourceDefinitions[e])throw new f("schema-cannot-extend-missing-item",this,{itemName:e});this._sourceDefinitions[e].push(Object.assign({},t)),this._clearCache()}getDefinitions(){return this._compiledDefinitions||this._compile(),this._compiledDefinitions}getDefinition(e){let t;return typeof e=="string"?t=e:e.is&&(e.is("$text")||e.is("$textProxy"))?t="$text":t=e.name,this.getDefinitions()[t]}isRegistered(e){return!!this.getDefinition(e)}isBlock(e){const t=this.getDefinition(e);return!!(t&&t.isBlock)}isLimit(e){const t=this.getDefinition(e);return t?!!(t.isLimit||t.isObject):!1}isObject(e){const t=this.getDefinition(e);return t?!!(t.isObject||t.isLimit&&t.isSelectable&&t.isContent):!1}isInline(e){const t=this.getDefinition(e);return!!(t&&t.isInline)}isSelectable(e){const t=this.getDefinition(e);return t?!!(t.isSelectable||t.isObject):!1}isContent(e){const t=this.getDefinition(e);return t?!!(t.isContent||t.isObject):!1}checkChild(e,t){return t?this._checkContextMatch(t,e):!1}checkAttribute(e,t){const n=this.getDefinition(e.last);return n?n.allowAttributes.includes(t):!1}checkMerge(e,t=null){if(e instanceof _){const n=e.nodeBefore,s=e.nodeAfter;if(!(n instanceof L))throw new f("schema-check-merge-no-element-before",this);if(!(s instanceof L))throw new f("schema-check-merge-no-element-after",this);return this.checkMerge(n,s)}for(const n of t.getChildren())if(!this.checkChild(e,n))return!1;return!0}addChildCheck(e){this.on("checkChild",(t,[n,s])=>{if(!s)return;const o=e(n,s);typeof o=="boolean"&&(t.stop(),t.return=o)},{priority:"high"})}addAttributeCheck(e){this.on("checkAttribute",(t,[n,s])=>{const o=e(n,s);typeof o=="boolean"&&(t.stop(),t.return=o)},{priority:"high"})}setAttributeProperties(e,t){this._attributeProperties[e]=Object.assign(this.getAttributeProperties(e),t)}getAttributeProperties(e){return this._attributeProperties[e]||{}}getLimitElement(e){let t;for(e instanceof _?t=e.parent:t=(e instanceof w?[e]:Array.from(e.getRanges())).reduce((s,o)=>{const r=o.getCommonAncestor();return s?s.getCommonAncestor(r,{includeSelf:!0}):r},null);!this.isLimit(t)&&t.parent;)t=t.parent;return t}checkAttributeInSelection(e,t){if(e.isCollapsed){const s=[...e.getFirstPosition().getAncestors(),new j("",e.getAttributes())];return this.checkAttribute(s,t)}else{const n=e.getRanges();for(const s of n)for(const o of s)if(this.checkAttribute(o.item,t))return!0}return!1}*getValidRanges(e,t){e=dy(e);for(const n of e)yield*this._getValidRangesForRange(n,t)}getNearestSelectionRange(e,t="both"){if(this.checkChild(e,"$text"))return new w(e);let n,s;const o=e.getAncestors().reverse().find(r=>this.isLimit(r))||e.root;(t=="both"||t=="backward")&&(n=new tt({boundaries:w._createIn(o),startPosition:e,direction:"backward"})),(t=="both"||t=="forward")&&(s=new tt({boundaries:w._createIn(o),startPosition:e}));for(const r of uy(n,s)){const a=r.walker==n?"elementEnd":"elementStart",l=r.value;if(l.type==a&&this.isObject(l.item))return w._createOn(l.item);if(this.checkChild(l.nextPosition,"$text"))return new w(l.nextPosition)}return null}findAllowedParent(e,t){let n=e.parent;for(;n;){if(this.checkChild(n,t))return n;if(this.isLimit(n))return null;n=n.parent}return null}removeDisallowedAttributes(e,t){for(const n of e)if(n.is("$text"))lc(this,n,t);else{const o=w._createIn(n).getPositions();for(const r of o){const a=r.nodeBefore||r.parent;lc(this,a,t)}}}createContext(e){return new It(e)}_clearCache(){this._compiledDefinitions=null}_compile(){const e={},t=this._sourceDefinitions,n=Object.keys(t);for(const s of n)e[s]=Q1(t[s],s);for(const s of n)Y1(e,s);for(const s of n)X1(e,s);for(const s of n)Z1(e,s);for(const s of n)ey(e,s),ty(e,s);for(const s of n)ny(e,s),iy(e,s),sy(e,s);this._compiledDefinitions=e}_checkContextMatch(e,t,n=t.length-1){const s=t.getItem(n);if(e.allowIn.includes(s.name)){if(n==0)return!0;{const o=this.getDefinition(s);return this._checkContextMatch(o,t,n-1)}}else return!1}*_getValidRangesForRange(e,t){let n=e.start,s=e.start;for(const o of e.getItems({shallow:!0}))o.is("element")&&(yield*this._getValidRangesForRange(w._createIn(o),t)),this.checkAttribute(o,t)||(n.isEqual(s)||(yield new w(n,s)),n=_._createAfter(o)),s=_._createAfter(o);n.isEqual(s)||(yield new w(n,s))}}A(ac,$);class It{constructor(e){if(e instanceof It)return e;typeof e=="string"?e=[e]:Array.isArray(e)||(e=e.getAncestors({includeSelf:!0})),this._items=e.map(cy)}get length(){return this._items.length}get last(){return this._items[this._items.length-1]}[Symbol.iterator](){return this._items[Symbol.iterator]()}push(e){const t=new It([e]);return t._items=[...this._items,...t._items],t}getItem(e){return this._items[e]}*getNames(){yield*this._items.map(e=>e.name)}endsWith(e){return Array.from(this.getNames()).join(" ").endsWith(e)}startsWith(e){return Array.from(this.getNames()).join(" ").startsWith(e)}}function Q1(i,e){const t={name:e,allowIn:[],allowContentOf:[],allowWhere:[],allowAttributes:[],allowAttributesOf:[],allowChildren:[],inheritTypesFrom:[]};return oy(i,t),Rt(i,t,"allowIn"),Rt(i,t,"allowContentOf"),Rt(i,t,"allowWhere"),Rt(i,t,"allowAttributes"),Rt(i,t,"allowAttributesOf"),Rt(i,t,"allowChildren"),Rt(i,t,"inheritTypesFrom"),ry(i,t),t}function Y1(i,e){const t=i[e];for(const n of t.allowChildren){const s=i[n];!s||s.allowIn.push(e)}t.allowChildren.length=0}function X1(i,e){for(const t of i[e].allowContentOf)i[t]&&ay(i,t).forEach(s=>{s.allowIn.push(e)});delete i[e].allowContentOf}function Z1(i,e){for(const t of i[e].allowWhere){const n=i[t];if(n){const s=n.allowIn;i[e].allowIn.push(...s)}}delete i[e].allowWhere}function ey(i,e){for(const t of i[e].allowAttributesOf){const n=i[t];if(n){const s=n.allowAttributes;i[e].allowAttributes.push(...s)}}delete i[e].allowAttributesOf}function ty(i,e){const t=i[e];for(const n of t.inheritTypesFrom){const s=i[n];if(s){const o=Object.keys(s).filter(r=>r.startsWith("is"));for(const r of o)r in t||(t[r]=s[r])}}delete t.inheritTypesFrom}function ny(i,e){const t=i[e],n=t.allowIn.filter(s=>i[s]);t.allowIn=Array.from(new Set(n))}function iy(i,e){const t=i[e];for(const n of t.allowIn)i[n].allowChildren.push(e)}function sy(i,e){const t=i[e];t.allowAttributes=Array.from(new Set(t.allowAttributes))}function oy(i,e){for(const t of i){const n=Object.keys(t).filter(s=>s.startsWith("is"));for(const s of n)e[s]=t[s]}}function Rt(i,e,t){for(const n of i)typeof n[t]=="string"?e[t].push(n[t]):Array.isArray(n[t])&&e[t].push(...n[t])}function ry(i,e){for(const t of i){const n=t.inheritAllFrom;n&&(e.allowContentOf.push(n),e.allowWhere.push(n),e.allowAttributesOf.push(n),e.inheritTypesFrom.push(n))}}function ay(i,e){const t=i[e];return ly(i).filter(n=>n.allowIn.includes(t.name))}function ly(i){return Object.keys(i).map(e=>i[e])}function cy(i){return typeof i=="string"||i.is("documentFragment")?{name:typeof i=="string"?i:"$documentFragment",*getAttributeKeys(){},getAttribute(){}}:{name:i.is("element")?i.name:"$text",*getAttributeKeys(){yield*i.getAttributeKeys()},getAttribute(e){return i.getAttribute(e)}}}function*uy(i,e){let t=!1;for(;!t;){if(t=!0,i){const n=i.next();n.done||(t=!1,yield{walker:i,value:n.value})}if(e){const n=e.next();n.done||(t=!1,yield{walker:e,value:n.value})}}}function*dy(i){for(const e of i)yield*e.getMinimalFlatRanges()}function lc(i,e,t){for(const n of e.getAttributeKeys())i.checkAttribute(e,n)||t.removeAttribute(n,e)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class cc{constructor(e={}){this._splitParts=new Map,this._cursorParents=new Map,this._modelCursor=null,this.conversionApi=Object.assign({},e),this.conversionApi.convertItem=this._convertItem.bind(this),this.conversionApi.convertChildren=this._convertChildren.bind(this),this.conversionApi.safeInsert=this._safeInsert.bind(this),this.conversionApi.updateConversionResult=this._updateConversionResult.bind(this),this.conversionApi.splitToAllowedParent=this._splitToAllowedParent.bind(this),this.conversionApi.getSplitParts=this._getSplitParts.bind(this)}convert(e,t,n=["$root"]){this.fire("viewCleanup",e),this._modelCursor=fy(n,t),this.conversionApi.writer=t,this.conversionApi.consumable=xn.createFrom(e),this.conversionApi.store={};const{modelRange:s}=this._convertItem(e,this._modelCursor),o=t.createDocumentFragment();if(s){this._removeEmptyElements();for(const r of Array.from(this._modelCursor.parent.getChildren()))t.append(r,o);o.markers=hy(o,t)}return this._modelCursor=null,this._splitParts.clear(),this._cursorParents.clear(),this.conversionApi.writer=null,this.conversionApi.store=null,o}_convertItem(e,t){const n=Object.assign({viewItem:e,modelCursor:t,modelRange:null});if(e.is("element")?this.fire("element:"+e.name,n,this.conversionApi):e.is("$text")?this.fire("text",n,this.conversionApi):this.fire("documentFragment",n,this.conversionApi),n.modelRange&&!(n.modelRange instanceof w))throw new f("view-conversion-dispatcher-incorrect-result",this);return{modelRange:n.modelRange,modelCursor:n.modelCursor}}_convertChildren(e,t){let n=t.is("position")?t:_._createAt(t,0);const s=new w(n);for(const o of Array.from(e.getChildren())){const r=this._convertItem(o,n);r.modelRange instanceof w&&(s.end=r.modelRange.end,n=r.modelCursor)}return{modelRange:s,modelCursor:n}}_safeInsert(e,t){const n=this._splitToAllowedParent(e,t);return n?(this.conversionApi.writer.insert(e,n.position),!0):!1}_updateConversionResult(e,t){const n=this._getSplitParts(e),s=this.conversionApi.writer;t.modelRange||(t.modelRange=s.createRange(s.createPositionBefore(e),s.createPositionAfter(n[n.length-1])));const o=this._cursorParents.get(e);o?t.modelCursor=s.createPositionAt(o,0):t.modelCursor=t.modelRange.end}_splitToAllowedParent(e,t){const{schema:n,writer:s}=this.conversionApi;let o=n.findAllowedParent(t,e);if(o){if(o===t.parent)return{position:t};this._modelCursor.parent.getAncestors().includes(o)&&(o=null)}if(!o)return Zl(t,e,n)?{position:ec(t,s)}:null;const r=this.conversionApi.writer.split(t,o),a=[];for(const c of r.range.getWalker())if(c.type=="elementEnd")a.push(c.item);else{const u=a.pop(),d=c.item;this._registerSplitPair(u,d)}const l=r.range.end.parent;return this._cursorParents.set(e,l),{position:r.position,cursorParent:l}}_registerSplitPair(e,t){this._splitParts.has(e)||this._splitParts.set(e,[e]);const n=this._splitParts.get(e);this._splitParts.set(t,n),n.push(t)}_getSplitParts(e){let t;return this._splitParts.has(e)?t=this._splitParts.get(e):t=[e],t}_removeEmptyElements(){let e=!1;for(const t of this._splitParts.keys())t.isEmpty&&(this.conversionApi.writer.remove(t),this._splitParts.delete(t),e=!0);e&&this._removeEmptyElements()}}A(cc,H);function hy(i,e){const t=new Set,n=new Map,s=w._createIn(i).getItems();for(const o of s)o.name=="$marker"&&t.add(o);for(const o of t){const r=o.getAttribute("data-name"),a=e.createPositionBefore(o);n.has(r)?n.get(r).end=a.clone():n.set(r,new w(a.clone())),e.remove(o)}return n}function fy(i,e){let t;for(const n of new It(i)){const s={};for(const r of n.getAttributeKeys())s[r]=n.getAttribute(r);const o=e.createElement(n.name,s);t&&e.append(o,t),t=_._createAt(o,0)}return t}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class my{getHtml(e){const n=document.implementation.createHTMLDocument("").createElement("div");return n.appendChild(e),n.innerHTML}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class gy{constructor(e){this.domParser=new DOMParser,this.domConverter=new oi(e,{renderingMode:"data"}),this.htmlWriter=new my}toData(e){const t=this.domConverter.viewToDom(e,document);return this.htmlWriter.getHtml(t)}toView(e){const t=this._toDom(e);return this.domConverter.domToView(t)}registerRawContentMatcher(e){this.domConverter.registerRawContentMatcher(e)}useFillerType(e){this.domConverter.blockFillerMode=e=="marked"?"markedNbsp":"nbsp"}_toDom(e){const t=this.domParser.parseFromString(e,"text/html"),n=t.createDocumentFragment();let s=t.firstChild;for(;!s.isSameNode(t.documentElement);){const r=s;s=s.nextSibling,r.nodeType==Node.COMMENT_NODE&&n.appendChild(r)}const o=t.body.childNodes;for(;o.length>0;)n.appendChild(o[0]);return n}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class uc{constructor(e,t){this.model=e,this.mapper=new Hs,this.downcastDispatcher=new $s({mapper:this.mapper,schema:e.schema}),this.downcastDispatcher.on("insert:$text",Kl(),{priority:"lowest"}),this.upcastDispatcher=new cc({schema:e.schema}),this.viewDocument=new An(t),this.stylesProcessor=t,this.htmlProcessor=new gy(this.viewDocument),this.processor=this.htmlProcessor,this._viewWriter=new ol(this.viewDocument),this.upcastDispatcher.on("text",D1(),{priority:"lowest"}),this.upcastDispatcher.on("element",tc(),{priority:"lowest"}),this.upcastDispatcher.on("documentFragment",tc(),{priority:"lowest"}),this.decorate("init"),this.decorate("set"),this.decorate("get"),this.on("init",()=>{this.fire("ready")},{priority:"lowest"}),this.on("ready",()=>{this.model.enqueueChange("transparent",Xl)},{priority:"lowest"})}get(e={}){const{rootName:t="main",trim:n="empty"}=e;if(!this._checkIfRootsExists([t]))throw new f("datacontroller-get-non-existent-root",this);const s=this.model.document.getRoot(t);return n==="empty"&&!this.model.hasContent(s,{ignoreWhitespaces:!0})?"":this.stringify(s,e)}stringify(e,t={}){const n=this.toView(e,t);return this.processor.toData(n)}toView(e,t={}){const n=this.viewDocument,s=this._viewWriter;this.mapper.clearBindings();const o=w._createIn(e),r=new St(n);this.mapper.bindElements(e,r),this.downcastDispatcher.conversionApi.options=t,this.downcastDispatcher.convertInsert(o,s);const a=e.is("documentFragment")?Array.from(e.markers):py(e);for(const[l,c]of a)this.downcastDispatcher.convertMarkerAdd(l,c,s);return delete this.downcastDispatcher.conversionApi.options,r}init(e){if(this.model.document.version)throw new f("datacontroller-init-document-not-empty",this);let t={};if(typeof e=="string"?t.main=e:t=e,!this._checkIfRootsExists(Object.keys(t)))throw new f("datacontroller-init-non-existent-root",this);return this.model.enqueueChange("transparent",n=>{for(const s of Object.keys(t)){const o=this.model.document.getRoot(s);n.insert(this.parse(t[s],o),o,0)}}),Promise.resolve()}set(e,t={}){let n={};if(typeof e=="string"?n.main=e:n=e,!this._checkIfRootsExists(Object.keys(n)))throw new f("datacontroller-set-non-existent-root",this);const s=t.batchType||"default";this.model.enqueueChange(s,o=>{o.setSelection(null),o.removeSelectionAttribute(this.model.document.selection.getAttributeKeys());for(const r of Object.keys(n)){const a=this.model.document.getRoot(r);o.remove(o.createRangeIn(a)),o.insert(this.parse(n[r],a),a,0)}})}parse(e,t="$root"){const n=this.processor.toView(e);return this.toModel(n,t)}toModel(e,t="$root"){return this.model.change(n=>this.upcastDispatcher.convert(e,n,t))}addStyleProcessorRules(e){e(this.stylesProcessor)}registerRawContentMatcher(e){this.processor&&this.processor!==this.htmlProcessor&&this.processor.registerRawContentMatcher(e),this.htmlProcessor.registerRawContentMatcher(e)}destroy(){this.stopListening()}_checkIfRootsExists(e){for(const t of e)if(!this.model.document.getRootNames().includes(t))return!1;return!0}}A(uc,$);function py(i){const e=[],t=i.root.document;if(!t)return[];const n=w._createIn(i);for(const s of t.model.markers){const o=s.getRange(),r=o.isCollapsed,a=o.start.isEqual(n.start)||o.end.isEqual(n.end);if(r&&a)e.push([s.name,o]);else{const l=n.getIntersection(o);l&&e.push([s.name,l])}}return e.sort(([s,o],[r,a])=>{if(o.end.compareWith(a.start)!=="after")return 1;if(o.start.compareWith(a.end)!=="before")return-1;switch(o.start.compareWith(a.start)){case"before":return 1;case"after":return-1;default:switch(o.end.compareWith(a.end)){case"before":return 1;case"after":return-1;default:return r.localeCompare(s)}}})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class wy{constructor(e,t){this._helpers=new Map,this._downcast=oe(e),this._createConversionHelpers({name:"downcast",dispatchers:this._downcast,isDowncast:!0}),this._upcast=oe(t),this._createConversionHelpers({name:"upcast",dispatchers:this._upcast,isDowncast:!1})}addAlias(e,t){const n=this._downcast.includes(t);if(!this._upcast.includes(t)&&!n)throw new f("conversion-add-alias-dispatcher-not-registered",this);this._createConversionHelpers({name:e,dispatchers:[t],isDowncast:n})}for(e){if(!this._helpers.has(e))throw new f("conversion-for-unknown-group",this);return this._helpers.get(e)}elementToElement(e){this.for("downcast").elementToElement(e);for(const{model:t,view:n}of Ks(e))this.for("upcast").elementToElement({model:t,view:n,converterPriority:e.converterPriority})}attributeToElement(e){this.for("downcast").attributeToElement(e);for(const{model:t,view:n}of Ks(e))this.for("upcast").elementToAttribute({view:n,model:t,converterPriority:e.converterPriority})}attributeToAttribute(e){this.for("downcast").attributeToAttribute(e);for(const{model:t,view:n}of Ks(e))this.for("upcast").attributeToAttribute({view:n,model:t})}_createConversionHelpers({name:e,dispatchers:t,isDowncast:n}){if(this._helpers.has(e))throw new f("conversion-group-exists",this);const s=n?new d1(t):new N1(t);this._helpers.set(e,s)}}function*Ks(i){if(i.model.values)for(const e of i.model.values){const t={key:i.model.key,value:e},n=i.view[e],s=i.upcastAlso?i.upcastAlso[e]:void 0;yield*dc(t,n,s)}else yield*dc(i.model,i.view,i.upcastAlso)}function*dc(i,e,t){if(yield{model:i,view:e},t)for(const n of oe(t))yield{model:i,view:n}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class fi{constructor(e="default"){this.operations=[],this.type=e}get baseVersion(){for(const e of this.operations)if(e.baseVersion!==null)return e.baseVersion;return null}addOperation(e){return e.batch=this,this.operations.push(e),e}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Se{constructor(e){this.baseVersion=e,this.isDocumentOperation=this.baseVersion!==null,this.batch=null}_validate(){}toJSON(){const e=Object.assign({},this);return e.__className=this.constructor.className,delete e.batch,delete e.isDocumentOperation,e}static get className(){return"Operation"}static fromJSON(e){return new this(e.baseVersion)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class it{constructor(e){this.markers=new Map,this._children=new Kt,e&&this._insertChild(0,e)}[Symbol.iterator](){return this.getChildren()}get childCount(){return this._children.length}get maxOffset(){return this._children.maxOffset}get isEmpty(){return this.childCount===0}get root(){return this}get parent(){return null}is(e){return e==="documentFragment"||e==="model:documentFragment"}getChild(e){return this._children.getNode(e)}getChildren(){return this._children[Symbol.iterator]()}getChildIndex(e){return this._children.getNodeIndex(e)}getChildStartOffset(e){return this._children.getNodeStartOffset(e)}getPath(){return[]}getNodeByPath(e){let t=this;for(const n of e)t=t.getChild(t.offsetToIndex(n));return t}offsetToIndex(e){return this._children.offsetToIndex(e)}toJSON(){const e=[];for(const t of this._children)e.push(t.toJSON());return e}static fromJSON(e){const t=[];for(const n of e)n.name?t.push(L.fromJSON(n)):t.push(j.fromJSON(n));return new it(t)}_appendChild(e){this._insertChild(this.childCount,e)}_insertChild(e,t){const n=by(t);for(const s of n)s.parent!==null&&s._remove(),s.parent=this;this._children._insertNodes(e,n)}_removeChildren(e,t=1){const n=this._children._removeNodes(e,t);for(const s of n)s.parent=null;return n}}function by(i){return typeof i=="string"?[new j(i)]:(Te(i)||(i=[i]),Array.from(i).map(e=>typeof e=="string"?new j(e):e instanceof Ue?new j(e.data,e.getAttributes()):e))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Gs(i,e){e=fc(e);const t=e.reduce((o,r)=>o+r.offsetSize,0),n=i.parent;Mn(i);const s=i.index;return n._insertChild(s,e),Rn(n,s+e.length),Rn(n,s),new w(i,i.getShiftedBy(t))}function hc(i){if(!i.isFlat)throw new f("operation-utils-remove-range-not-flat",this);const e=i.start.parent;Mn(i.start),Mn(i.end);const t=e._removeChildren(i.start.index,i.end.index-i.start.index);return Rn(e,i.start.index),t}function In(i,e){if(!i.isFlat)throw new f("operation-utils-move-range-not-flat",this);const t=hc(i);return e=e._getTransformedByDeletion(i.start,i.end.offset-i.start.offset),Gs(e,t)}function _y(i,e,t){Mn(i.start),Mn(i.end);for(const n of i.getItems({shallow:!0})){const s=n.is("$textProxy")?n.textNode:n;t!==null?s._setAttribute(e,t):s._removeAttribute(e),Rn(s.parent,s.index)}Rn(i.end.parent,i.end.index)}function fc(i){const e=[];i instanceof Array||(i=[i]);for(let t=0;t<i.length;t++)if(typeof i[t]=="string")e.push(new j(i[t]));else if(i[t]instanceof Ue)e.push(new j(i[t].data,i[t].getAttributes()));else if(i[t]instanceof it||i[t]instanceof Kt)for(const n of i[t])e.push(n);else i[t]instanceof Pt&&e.push(i[t]);for(let t=1;t<e.length;t++){const n=e[t],s=e[t-1];n instanceof j&&s instanceof j&&mc(n,s)&&(e.splice(t-1,2,new j(s.data+n.data,s.getAttributes())),t--)}return e}function Rn(i,e){const t=i.getChild(e-1),n=i.getChild(e);if(t&&n&&t.is("$text")&&n.is("$text")&&mc(t,n)){const s=new j(t.data+n.data,t.getAttributes());i._removeChildren(e-1,2),i._insertChild(e-1,s)}}function Mn(i){const e=i.textNode,t=i.parent;if(e){const n=i.offset-e.startOffset,s=e.index;t._removeChildren(s,1);const o=new j(e.data.substr(0,n),e.getAttributes()),r=new j(e.data.substr(n),e.getAttributes());t._insertChild(s,[o,r])}}function mc(i,e){const t=i.getAttributes(),n=e.getAttributes();for(const s of t){if(s[1]!==e.getAttribute(s[0]))return!1;n.next()}return n.next().done}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ne extends Se{constructor(e,t,n,s,o){super(o);this.range=e.clone(),this.key=t,this.oldValue=n===void 0?null:n,this.newValue=s===void 0?null:s}get type(){return this.oldValue===null?"addAttribute":this.newValue===null?"removeAttribute":"changeAttribute"}clone(){return new ne(this.range,this.key,this.oldValue,this.newValue,this.baseVersion)}getReversed(){return new ne(this.range,this.key,this.newValue,this.oldValue,this.baseVersion+1)}toJSON(){const e=super.toJSON();return e.range=this.range.toJSON(),e}_validate(){if(!this.range.isFlat)throw new f("attribute-operation-range-not-flat",this);for(const e of this.range.getItems({shallow:!0})){if(this.oldValue!==null&&!Da(e.getAttribute(this.key),this.oldValue))throw new f("attribute-operation-wrong-old-value",this,{item:e,key:this.key,value:this.oldValue});if(this.oldValue===null&&this.newValue!==null&&e.hasAttribute(this.key))throw new f("attribute-operation-attribute-exists",this,{node:e,key:this.key})}}_execute(){Da(this.oldValue,this.newValue)||_y(this.range,this.key,this.newValue)}static get className(){return"AttributeOperation"}static fromJSON(e,t){return new ne(w.fromJSON(e.range,t),e.key,e.oldValue,e.newValue,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class vy extends Se{constructor(e,t){super(null);this.sourcePosition=e.clone(),this.howMany=t}get type(){return"detach"}toJSON(){const e=super.toJSON();return e.sourcePosition=this.sourcePosition.toJSON(),e}_validate(){if(this.sourcePosition.root.document)throw new f("detach-operation-on-document-node",this)}_execute(){hc(w._createFromPositionAndShift(this.sourcePosition,this.howMany))}static get className(){return"DetachOperation"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class z extends Se{constructor(e,t,n,s){super(s);this.sourcePosition=e.clone(),this.sourcePosition.stickiness="toNext",this.howMany=t,this.targetPosition=n.clone(),this.targetPosition.stickiness="toNone"}get type(){return this.targetPosition.root.rootName=="$graveyard"?"remove":this.sourcePosition.root.rootName=="$graveyard"?"reinsert":"move"}clone(){return new this.constructor(this.sourcePosition,this.howMany,this.targetPosition,this.baseVersion)}getMovedRangeStart(){return this.targetPosition._getTransformedByDeletion(this.sourcePosition,this.howMany)}getReversed(){const e=this.sourcePosition._getTransformedByInsertion(this.targetPosition,this.howMany);return new this.constructor(this.getMovedRangeStart(),this.howMany,e,this.baseVersion+1)}_validate(){const e=this.sourcePosition.parent,t=this.targetPosition.parent,n=this.sourcePosition.offset,s=this.targetPosition.offset;if(n+this.howMany>e.maxOffset)throw new f("move-operation-nodes-do-not-exist",this);if(e===t&&n<s&&s<n+this.howMany)throw new f("move-operation-range-into-itself",this);if(this.sourcePosition.root==this.targetPosition.root&&he(this.sourcePosition.getParentPath(),this.targetPosition.getParentPath())=="prefix"){const o=this.sourcePosition.path.length-1;if(this.targetPosition.path[o]>=n&&this.targetPosition.path[o]<n+this.howMany)throw new f("move-operation-node-into-itself",this)}}_execute(){In(w._createFromPositionAndShift(this.sourcePosition,this.howMany),this.targetPosition)}toJSON(){const e=super.toJSON();return e.sourcePosition=this.sourcePosition.toJSON(),e.targetPosition=this.targetPosition.toJSON(),e}static get className(){return"MoveOperation"}static fromJSON(e,t){const n=_.fromJSON(e.sourcePosition,t),s=_.fromJSON(e.targetPosition,t);return new this(n,e.howMany,s,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class re extends Se{constructor(e,t,n){super(n);this.position=e.clone(),this.position.stickiness="toNone",this.nodes=new Kt(fc(t)),this.shouldReceiveAttributes=!1}get type(){return"insert"}get howMany(){return this.nodes.maxOffset}clone(){const e=new Kt([...this.nodes].map(n=>n._clone(!0))),t=new re(this.position,e,this.baseVersion);return t.shouldReceiveAttributes=this.shouldReceiveAttributes,t}getReversed(){const e=this.position.root.document.graveyard,t=new _(e,[0]);return new z(this.position,this.nodes.maxOffset,t,this.baseVersion+1)}_validate(){const e=this.position.parent;if(!e||e.maxOffset<this.position.offset)throw new f("insert-operation-position-invalid",this)}_execute(){const e=this.nodes;this.nodes=new Kt([...e].map(t=>t._clone(!0))),Gs(this.position,e)}toJSON(){const e=super.toJSON();return e.position=this.position.toJSON(),e.nodes=this.nodes.toJSON(),e}static get className(){return"InsertOperation"}static fromJSON(e,t){const n=[];for(const o of e.nodes)o.name?n.push(L.fromJSON(o)):n.push(j.fromJSON(o));const s=new re(_.fromJSON(e.position,t),n,e.baseVersion);return s.shouldReceiveAttributes=e.shouldReceiveAttributes,s}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class pe extends Se{constructor(e,t,n,s,o,r){super(r);this.name=e,this.oldRange=t?t.clone():null,this.newRange=n?n.clone():null,this.affectsData=o,this._markers=s}get type(){return"marker"}clone(){return new pe(this.name,this.oldRange,this.newRange,this._markers,this.affectsData,this.baseVersion)}getReversed(){return new pe(this.name,this.newRange,this.oldRange,this._markers,this.affectsData,this.baseVersion+1)}_execute(){const e=this.newRange?"_set":"_remove";this._markers[e](this.name,this.newRange,!0,this.affectsData)}toJSON(){const e=super.toJSON();return this.oldRange&&(e.oldRange=this.oldRange.toJSON()),this.newRange&&(e.newRange=this.newRange.toJSON()),delete e._markers,e}static get className(){return"MarkerOperation"}static fromJSON(e,t){return new pe(e.name,e.oldRange?w.fromJSON(e.oldRange,t):null,e.newRange?w.fromJSON(e.newRange,t):null,t.model.markers,e.affectsData,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class we extends Se{constructor(e,t,n,s){super(s);this.position=e,this.position.stickiness="toNext",this.oldName=t,this.newName=n}get type(){return"rename"}clone(){return new we(this.position.clone(),this.oldName,this.newName,this.baseVersion)}getReversed(){return new we(this.position.clone(),this.newName,this.oldName,this.baseVersion+1)}_validate(){const e=this.position.nodeAfter;if(e instanceof L){if(e.name!==this.oldName)throw new f("rename-operation-wrong-name",this)}else throw new f("rename-operation-wrong-position",this)}_execute(){const e=this.position.nodeAfter;e.name=this.newName}toJSON(){const e=super.toJSON();return e.position=this.position.toJSON(),e}static get className(){return"RenameOperation"}static fromJSON(e,t){return new we(_.fromJSON(e.position,t),e.oldName,e.newName,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class st extends Se{constructor(e,t,n,s,o){super(o);this.root=e,this.key=t,this.oldValue=n,this.newValue=s}get type(){return this.oldValue===null?"addRootAttribute":this.newValue===null?"removeRootAttribute":"changeRootAttribute"}clone(){return new st(this.root,this.key,this.oldValue,this.newValue,this.baseVersion)}getReversed(){return new st(this.root,this.key,this.newValue,this.oldValue,this.baseVersion+1)}_validate(){if(this.root!=this.root.root||this.root.is("documentFragment"))throw new f("rootattribute-operation-not-a-root",this,{root:this.root,key:this.key});if(this.oldValue!==null&&this.root.getAttribute(this.key)!==this.oldValue)throw new f("rootattribute-operation-wrong-old-value",this,{root:this.root,key:this.key});if(this.oldValue===null&&this.newValue!==null&&this.root.hasAttribute(this.key))throw new f("rootattribute-operation-attribute-exists",this,{root:this.root,key:this.key})}_execute(){this.newValue!==null?this.root._setAttribute(this.key,this.newValue):this.root._removeAttribute(this.key)}toJSON(){const e=super.toJSON();return e.root=this.root.toJSON(),e}static get className(){return"RootAttributeOperation"}static fromJSON(e,t){if(!t.getRoot(e.root))throw new f("rootattribute-operation-fromjson-no-root",this,{rootName:e.root});return new st(t.getRoot(e.root),e.key,e.oldValue,e.newValue,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ie extends Se{constructor(e,t,n,s,o){super(o);this.sourcePosition=e.clone(),this.sourcePosition.stickiness="toPrevious",this.howMany=t,this.targetPosition=n.clone(),this.targetPosition.stickiness="toNext",this.graveyardPosition=s.clone()}get type(){return"merge"}get deletionPosition(){return new _(this.sourcePosition.root,this.sourcePosition.path.slice(0,-1))}get movedRange(){const e=this.sourcePosition.getShiftedBy(Number.POSITIVE_INFINITY);return new w(this.sourcePosition,e)}clone(){return new this.constructor(this.sourcePosition,this.howMany,this.targetPosition,this.graveyardPosition,this.baseVersion)}getReversed(){const e=this.targetPosition._getTransformedByMergeOperation(this),t=this.sourcePosition.path.slice(0,-1),n=new _(this.sourcePosition.root,t)._getTransformedByMergeOperation(this);return new J(e,this.howMany,n,this.graveyardPosition,this.baseVersion+1)}_validate(){const e=this.sourcePosition.parent,t=this.targetPosition.parent;if(e.parent)if(t.parent){if(this.howMany!=e.maxOffset)throw new f("merge-operation-how-many-invalid",this)}else throw new f("merge-operation-target-position-invalid",this);else throw new f("merge-operation-source-position-invalid",this)}_execute(){const e=this.sourcePosition.parent,t=w._createIn(e);In(t,this.targetPosition),In(w._createOn(e),this.graveyardPosition)}toJSON(){const e=super.toJSON();return e.sourcePosition=e.sourcePosition.toJSON(),e.targetPosition=e.targetPosition.toJSON(),e.graveyardPosition=e.graveyardPosition.toJSON(),e}static get className(){return"MergeOperation"}static fromJSON(e,t){const n=_.fromJSON(e.sourcePosition,t),s=_.fromJSON(e.targetPosition,t),o=_.fromJSON(e.graveyardPosition,t);return new this(n,e.howMany,s,o,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class J extends Se{constructor(e,t,n,s,o){super(o);this.splitPosition=e.clone(),this.splitPosition.stickiness="toNext",this.howMany=t,this.insertionPosition=n,this.graveyardPosition=s?s.clone():null,this.graveyardPosition&&(this.graveyardPosition.stickiness="toNext")}get type(){return"split"}get moveTargetPosition(){const e=this.insertionPosition.path.slice();return e.push(0),new _(this.insertionPosition.root,e)}get movedRange(){const e=this.splitPosition.getShiftedBy(Number.POSITIVE_INFINITY);return new w(this.splitPosition,e)}clone(){return new this.constructor(this.splitPosition,this.howMany,this.insertionPosition,this.graveyardPosition,this.baseVersion)}getReversed(){const e=this.splitPosition.root.document.graveyard,t=new _(e,[0]);return new ie(this.moveTargetPosition,this.howMany,this.splitPosition,t,this.baseVersion+1)}_validate(){const e=this.splitPosition.parent,t=this.splitPosition.offset;if(!e||e.maxOffset<t)throw new f("split-operation-position-invalid",this);if(e.parent){if(this.howMany!=e.maxOffset-this.splitPosition.offset)throw new f("split-operation-how-many-invalid",this);if(this.graveyardPosition&&!this.graveyardPosition.nodeAfter)throw new f("split-operation-graveyard-position-invalid",this)}else throw new f("split-operation-split-in-root",this)}_execute(){const e=this.splitPosition.parent;if(this.graveyardPosition)In(w._createFromPositionAndShift(this.graveyardPosition,1),this.insertionPosition);else{const n=e._clone();Gs(this.insertionPosition,n)}const t=new w(_._createAt(e,this.splitPosition.offset),_._createAt(e,e.maxOffset));In(t,this.moveTargetPosition)}toJSON(){const e=super.toJSON();return e.splitPosition=this.splitPosition.toJSON(),e.insertionPosition=this.insertionPosition.toJSON(),this.graveyardPosition&&(e.graveyardPosition=this.graveyardPosition.toJSON()),e}static get className(){return"SplitOperation"}static getInsertionPosition(e){const t=e.path.slice(0,-1);return t[t.length-1]++,new _(e.root,t,"toPrevious")}static fromJSON(e,t){const n=_.fromJSON(e.splitPosition,t),s=_.fromJSON(e.insertionPosition,t),o=e.graveyardPosition?_.fromJSON(e.graveyardPosition,t):null;return new this(n,e.howMany,s,o,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Js extends L{constructor(e,t,n="main"){super(t);this._document=e,this.rootName=n}get document(){return this._document}is(e,t){return t?t===this.name&&(e==="rootElement"||e==="model:rootElement"||e==="element"||e==="model:element"):e==="rootElement"||e==="model:rootElement"||e==="element"||e==="model:element"||e==="node"||e==="model:node"}toJSON(){return this.rootName}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class yy{constructor(e,t){this.model=e,this.batch=t}createText(e,t){return new j(e,t)}createElement(e,t){return new L(e,t)}createDocumentFragment(){return new it}cloneElement(e,t=!0){return e._clone(t)}insert(e,t,n=0){if(this._assertWriterUsedCorrectly(),e instanceof j&&e.data=="")return;const s=_._createAt(t,n);if(e.parent)if(wc(e.root,s.root)){this.move(w._createOn(e),s);return}else{if(e.root.document)throw new f("model-writer-insert-forbidden-move",this);this.remove(e)}const o=s.root.document?s.root.document.version:null,r=new re(s,e,o);if(e instanceof j&&(r.shouldReceiveAttributes=!0),this.batch.addOperation(r),this.model.applyOperation(r),e instanceof it)for(const[a,l]of e.markers){const c=_._createAt(l.root,0),d={range:new w(l.start._getCombined(c,s),l.end._getCombined(c,s)),usingOperation:!0,affectsData:!0};this.model.markers.has(a)?this.updateMarker(a,d):this.addMarker(a,d)}}insertText(e,t,n,s){t instanceof it||t instanceof L||t instanceof _?this.insert(this.createText(e),t,n):this.insert(this.createText(e,t),n,s)}insertElement(e,t,n,s){t instanceof it||t instanceof L||t instanceof _?this.insert(this.createElement(e),t,n):this.insert(this.createElement(e,t),n,s)}append(e,t){this.insert(e,t,"end")}appendText(e,t,n){t instanceof it||t instanceof L?this.insert(this.createText(e),t,"end"):this.insert(this.createText(e,t),n,"end")}appendElement(e,t,n){t instanceof it||t instanceof L?this.insert(this.createElement(e),t,"end"):this.insert(this.createElement(e,t),n,"end")}setAttribute(e,t,n){if(this._assertWriterUsedCorrectly(),n instanceof w){const s=n.getMinimalFlatRanges();for(const o of s)gc(this,e,t,o)}else pc(this,e,t,n)}setAttributes(e,t){for(const[n,s]of Xe(e))this.setAttribute(n,s,t)}removeAttribute(e,t){if(this._assertWriterUsedCorrectly(),t instanceof w){const n=t.getMinimalFlatRanges();for(const s of n)gc(this,e,null,s)}else pc(this,e,null,t)}clearAttributes(e){this._assertWriterUsedCorrectly();const t=n=>{for(const s of n.getAttributeKeys())this.removeAttribute(s,n)};if(!(e instanceof w))t(e);else for(const n of e.getItems())t(n)}move(e,t,n){if(this._assertWriterUsedCorrectly(),!(e instanceof w))throw new f("writer-move-invalid-range",this);if(!e.isFlat)throw new f("writer-move-range-not-flat",this);const s=_._createAt(t,n);if(s.isEqual(e.start))return;if(this._addOperationForAffectedMarkers("move",e),!wc(e.root,s.root))throw new f("writer-move-different-document",this);const o=e.root.document?e.root.document.version:null,r=new z(e.start,e.end.offset-e.start.offset,s,o);this.batch.addOperation(r),this.model.applyOperation(r)}remove(e){this._assertWriterUsedCorrectly();const n=(e instanceof w?e:w._createOn(e)).getMinimalFlatRanges().reverse();for(const s of n)this._addOperationForAffectedMarkers("move",s),Cy(s.start,s.end.offset-s.start.offset,this.batch,this.model)}merge(e){this._assertWriterUsedCorrectly();const t=e.nodeBefore,n=e.nodeAfter;if(this._addOperationForAffectedMarkers("merge",e),!(t instanceof L))throw new f("writer-merge-no-element-before",this);if(!(n instanceof L))throw new f("writer-merge-no-element-after",this);e.root.document?this._merge(e):this._mergeDetached(e)}createPositionFromPath(e,t,n){return this.model.createPositionFromPath(e,t,n)}createPositionAt(e,t){return this.model.createPositionAt(e,t)}createPositionAfter(e){return this.model.createPositionAfter(e)}createPositionBefore(e){return this.model.createPositionBefore(e)}createRange(e,t){return this.model.createRange(e,t)}createRangeIn(e){return this.model.createRangeIn(e)}createRangeOn(e){return this.model.createRangeOn(e)}createSelection(e,t,n){return this.model.createSelection(e,t,n)}_mergeDetached(e){const t=e.nodeBefore,n=e.nodeAfter;this.move(w._createIn(n),_._createAt(t,"end")),this.remove(n)}_merge(e){const t=_._createAt(e.nodeBefore,"end"),n=_._createAt(e.nodeAfter,0),s=e.root.document.graveyard,o=new _(s,[0]),r=e.root.document.version,a=new ie(n,e.nodeAfter.maxOffset,t,o,r);this.batch.addOperation(a),this.model.applyOperation(a)}rename(e,t){if(this._assertWriterUsedCorrectly(),!(e instanceof L))throw new f("writer-rename-not-element-instance",this);const n=e.root.document?e.root.document.version:null,s=new we(_._createBefore(e),e.name,t,n);this.batch.addOperation(s),this.model.applyOperation(s)}split(e,t){this._assertWriterUsedCorrectly();let n=e.parent;if(!n.parent)throw new f("writer-split-element-no-parent",this);if(t||(t=n.parent),!e.parent.getAncestors({includeSelf:!0}).includes(t))throw new f("writer-split-invalid-limit-element",this);let s,o;do{const r=n.root.document?n.root.document.version:null,a=n.maxOffset-e.offset,l=J.getInsertionPosition(e),c=new J(e,a,l,null,r);this.batch.addOperation(c),this.model.applyOperation(c),!s&&!o&&(s=n,o=e.parent.nextSibling),e=this.createPositionAfter(e.parent),n=e.parent}while(n!==t);return{position:e,range:new w(_._createAt(s,"end"),_._createAt(o,0))}}wrap(e,t){if(this._assertWriterUsedCorrectly(),!e.isFlat)throw new f("writer-wrap-range-not-flat",this);const n=t instanceof L?t:new L(t);if(n.childCount>0)throw new f("writer-wrap-element-not-empty",this);if(n.parent!==null)throw new f("writer-wrap-element-attached",this);this.insert(n,e.start);const s=new w(e.start.getShiftedBy(1),e.end.getShiftedBy(1));this.move(s,_._createAt(n,0))}unwrap(e){if(this._assertWriterUsedCorrectly(),e.parent===null)throw new f("writer-unwrap-element-no-parent",this);this.move(w._createIn(e),this.createPositionAfter(e)),this.remove(e)}addMarker(e,t){if(this._assertWriterUsedCorrectly(),!t||typeof t.usingOperation!="boolean")throw new f("writer-addmarker-no-usingoperation",this);const n=t.usingOperation,s=t.range,o=t.affectsData===void 0?!1:t.affectsData;if(this.model.markers.has(e))throw new f("writer-addmarker-marker-exists",this);if(!s)throw new f("writer-addmarker-no-range",this);return n?(Vn(this,e,null,s,o),this.model.markers.get(e)):this.model.markers._set(e,s,n,o)}updateMarker(e,t){this._assertWriterUsedCorrectly();const n=typeof e=="string"?e:e.name,s=this.model.markers.get(n);if(!s)throw new f("writer-updatemarker-marker-not-exists",this);if(!t){this.model.markers._refresh(s);return}const o=typeof t.usingOperation=="boolean",r=typeof t.affectsData=="boolean",a=r?t.affectsData:s.affectsData;if(!o&&!t.range&&!r)throw new f("writer-updatemarker-wrong-options",this);const l=s.getRange(),c=t.range?t.range:l;if(o&&t.usingOperation!==s.managedUsingOperations){t.usingOperation?Vn(this,n,null,c,a):(Vn(this,n,l,null,a),this.model.markers._set(n,c,void 0,a));return}s.managedUsingOperations?Vn(this,n,l,c,a):this.model.markers._set(n,c,void 0,a)}removeMarker(e){this._assertWriterUsedCorrectly();const t=typeof e=="string"?e:e.name;if(!this.model.markers.has(t))throw new f("writer-removemarker-no-marker",this);const n=this.model.markers.get(t);if(!n.managedUsingOperations){this.model.markers._remove(t);return}const s=n.getRange();Vn(this,t,s,null,n.affectsData)}setSelection(e,t,n){this._assertWriterUsedCorrectly(),this.model.document.selection._setTo(e,t,n)}setSelectionFocus(e,t){this._assertWriterUsedCorrectly(),this.model.document.selection._setFocus(e,t)}setSelectionAttribute(e,t){if(this._assertWriterUsedCorrectly(),typeof e=="string")this._setSelectionAttribute(e,t);else for(const[n,s]of Xe(e))this._setSelectionAttribute(n,s)}removeSelectionAttribute(e){if(this._assertWriterUsedCorrectly(),typeof e=="string")this._removeSelectionAttribute(e);else for(const t of e)this._removeSelectionAttribute(t)}overrideSelectionGravity(){return this.model.document.selection._overrideGravity()}restoreSelectionGravity(e){this.model.document.selection._restoreGravity(e)}_setSelectionAttribute(e,t){const n=this.model.document.selection;if(n.isCollapsed&&n.anchor.parent.isEmpty){const s=Me._getStoreAttributeKey(e);this.setAttribute(s,t,n.anchor.parent)}n._setAttribute(e,t)}_removeSelectionAttribute(e){const t=this.model.document.selection;if(t.isCollapsed&&t.anchor.parent.isEmpty){const n=Me._getStoreAttributeKey(e);this.removeAttribute(n,t.anchor.parent)}t._removeAttribute(e)}_assertWriterUsedCorrectly(){if(this.model._currentWriter!==this)throw new f("writer-incorrect-use",this)}_addOperationForAffectedMarkers(e,t){for(const n of this.model.markers){if(!n.managedUsingOperations)continue;const s=n.getRange();let o=!1;if(e==="move")o=t.containsPosition(s.start)||t.start.isEqual(s.start)||t.containsPosition(s.end)||t.end.isEqual(s.end);else{const r=t.nodeBefore,a=t.nodeAfter,l=s.start.parent==r&&s.start.isAtEnd,c=s.end.parent==a&&s.end.offset==0,u=s.end.nodeAfter==a,d=s.start.nodeAfter==a;o=l||c||u||d}o&&this.updateMarker(n.name,{range:s})}}}function gc(i,e,t,n){const s=i.model,o=s.document;let r=n.start,a,l,c;for(const d of n.getWalker({shallow:!0}))c=d.item.getAttribute(e),a&&l!=c&&(l!=t&&u(),r=a),a=d.nextPosition,l=c;a instanceof _&&a!=r&&l!=t&&u();function u(){const d=new w(r,a),h=d.root.document?o.version:null,m=new ne(d,e,l,t,h);i.batch.addOperation(m),s.applyOperation(m)}}function pc(i,e,t,n){const s=i.model,o=s.document,r=n.getAttribute(e);let a,l;if(r!=t){if(n.root===n){const u=n.document?o.version:null;l=new st(n,e,r,t,u)}else{a=new w(_._createBefore(n),i.createPositionAfter(n));const u=a.root.document?o.version:null;l=new ne(a,e,r,t,u)}i.batch.addOperation(l),s.applyOperation(l)}}function Vn(i,e,t,n,s){const o=i.model,r=o.document,a=new pe(e,t,n,o.markers,s,r.version);i.batch.addOperation(a),o.applyOperation(a)}function Cy(i,e,t,n){let s;if(i.root.document){const o=n.document,r=new _(o.graveyard,[0]);s=new z(i,e,r,o.version)}else s=new vy(i,e);t.addOperation(s),n.applyOperation(s)}function wc(i,e){return i===e||i instanceof Js&&e instanceof Js}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ey{constructor(e){this._markerCollection=e,this._changesInElement=new Map,this._elementSnapshots=new Map,this._changedMarkers=new Map,this._changeCount=0,this._cachedChanges=null,this._cachedChangesWithGraveyard=null}get isEmpty(){return this._changesInElement.size==0&&this._changedMarkers.size==0}refreshItem(e){if(this._isInInsertedElement(e.parent))return;this._markRemove(e.parent,e.startOffset,e.offsetSize),this._markInsert(e.parent,e.startOffset,e.offsetSize);const t=w._createOn(e);for(const n of this._markerCollection.getMarkersIntersectingRange(t)){const s=n.getRange();this.bufferMarkerChange(n.name,s,s,n.affectsData)}this._cachedChanges=null}bufferOperation(e){switch(e.type){case"insert":{if(this._isInInsertedElement(e.position.parent))return;this._markInsert(e.position.parent,e.position.offset,e.nodes.maxOffset);break}case"addAttribute":case"removeAttribute":case"changeAttribute":{for(const t of e.range.getItems({shallow:!0}))this._isInInsertedElement(t.parent)||this._markAttribute(t);break}case"remove":case"move":case"reinsert":{if(e.sourcePosition.isEqual(e.targetPosition)||e.sourcePosition.getShiftedBy(e.howMany).isEqual(e.targetPosition))return;const t=this._isInInsertedElement(e.sourcePosition.parent),n=this._isInInsertedElement(e.targetPosition.parent);t||this._markRemove(e.sourcePosition.parent,e.sourcePosition.offset,e.howMany),n||this._markInsert(e.targetPosition.parent,e.getMovedRangeStart().offset,e.howMany);break}case"rename":{if(this._isInInsertedElement(e.position.parent))return;this._markRemove(e.position.parent,e.position.offset,1),this._markInsert(e.position.parent,e.position.offset,1);const t=w._createFromPositionAndShift(e.position,1);for(const n of this._markerCollection.getMarkersIntersectingRange(t)){const s=n.getRange();this.bufferMarkerChange(n.name,s,s,n.affectsData)}break}case"split":{const t=e.splitPosition.parent;this._isInInsertedElement(t)||this._markRemove(t,e.splitPosition.offset,e.howMany),this._isInInsertedElement(e.insertionPosition.parent)||this._markInsert(e.insertionPosition.parent,e.insertionPosition.offset,1),e.graveyardPosition&&this._markRemove(e.graveyardPosition.parent,e.graveyardPosition.offset,1);break}case"merge":{const t=e.sourcePosition.parent;this._isInInsertedElement(t.parent)||this._markRemove(t.parent,t.startOffset,1);const n=e.graveyardPosition.parent;this._markInsert(n,e.graveyardPosition.offset,1);const s=e.targetPosition.parent;this._isInInsertedElement(s)||this._markInsert(s,e.targetPosition.offset,t.maxOffset);break}}this._cachedChanges=null}bufferMarkerChange(e,t,n,s){const o=this._changedMarkers.get(e);o?(o.newRange=n,o.affectsData=s,o.oldRange==null&&o.newRange==null&&this._changedMarkers.delete(e)):this._changedMarkers.set(e,{oldRange:t,newRange:n,affectsData:s})}getMarkersToRemove(){const e=[];for(const[t,n]of this._changedMarkers)n.oldRange!=null&&e.push({name:t,range:n.oldRange});return e}getMarkersToAdd(){const e=[];for(const[t,n]of this._changedMarkers)n.newRange!=null&&e.push({name:t,range:n.newRange});return e}getChangedMarkers(){return Array.from(this._changedMarkers).map(e=>({name:e[0],data:{oldRange:e[1].oldRange,newRange:e[1].newRange}}))}hasDataChanges(){for(const[,e]of this._changedMarkers)if(e.affectsData)return!0;return this._changesInElement.size>0}getChanges(e={includeChangesInGraveyard:!1}){if(this._cachedChanges)return e.includeChangesInGraveyard?this._cachedChangesWithGraveyard.slice():this._cachedChanges.slice();let t=[];for(const n of this._changesInElement.keys()){const s=this._changesInElement.get(n).sort((u,d)=>u.offset===d.offset?u.type!=d.type?u.type=="remove"?-1:1:0:u.offset<d.offset?-1:1),o=this._elementSnapshots.get(n),r=bc(n.getChildren()),a=Ty(o.length,s);let l=0,c=0;for(const u of a)if(u==="i")t.push(this._getInsertDiff(n,l,r[l].name)),l++;else if(u==="r")t.push(this._getRemoveDiff(n,l,o[c].name)),c++;else if(u==="a"){const d=r[l].attributes,h=o[c].attributes;let m;if(r[l].name=="$text")m=new w(_._createAt(n,l),_._createAt(n,l+1));else{const g=n.offsetToIndex(l);m=new w(_._createAt(n,l),_._createAt(n.getChild(g),0))}t.push(...this._getAttributesDiff(m,h,d)),l++,c++}else l++,c++}t.sort((n,s)=>n.position.root!=s.position.root?n.position.root.rootName<s.position.root.rootName?-1:1:n.position.isEqual(s.position)?n.changeCount-s.changeCount:n.position.isBefore(s.position)?-1:1);for(let n=1,s=0;n<t.length;n++){const o=t[s],r=t[n],a=o.type=="remove"&&r.type=="remove"&&o.name=="$text"&&r.name=="$text"&&o.position.isEqual(r.position),l=o.type=="insert"&&r.type=="insert"&&o.name=="$text"&&r.name=="$text"&&o.position.parent==r.position.parent&&o.position.offset+o.length==r.position.offset,c=o.type=="attribute"&&r.type=="attribute"&&o.position.parent==r.position.parent&&o.range.isFlat&&r.range.isFlat&&o.position.offset+o.length==r.position.offset&&o.attributeKey==r.attributeKey&&o.attributeOldValue==r.attributeOldValue&&o.attributeNewValue==r.attributeNewValue;a||l||c?(o.length++,c&&(o.range.end=o.range.end.getShiftedBy(1)),t[n]=null):s=n}t=t.filter(n=>n);for(const n of t)delete n.changeCount,n.type=="attribute"&&(delete n.position,delete n.length);return this._changeCount=0,this._cachedChangesWithGraveyard=t.slice(),this._cachedChanges=t.filter(ky),e.includeChangesInGraveyard?this._cachedChangesWithGraveyard:this._cachedChanges}reset(){this._changesInElement.clear(),this._elementSnapshots.clear(),this._changedMarkers.clear(),this._cachedChanges=null}_markInsert(e,t,n){const s={type:"insert",offset:t,howMany:n,count:this._changeCount++};this._markChange(e,s)}_markRemove(e,t,n){const s={type:"remove",offset:t,howMany:n,count:this._changeCount++};this._markChange(e,s),this._removeAllNestedChanges(e,t,n)}_markAttribute(e){const t={type:"attribute",offset:e.startOffset,howMany:e.offsetSize,count:this._changeCount++};this._markChange(e.parent,t)}_markChange(e,t){this._makeSnapshot(e);const n=this._getChangesForElement(e);this._handleChange(t,n),n.push(t);for(let s=0;s<n.length;s++)n[s].howMany<1&&(n.splice(s,1),s--)}_getChangesForElement(e){let t;return this._changesInElement.has(e)?t=this._changesInElement.get(e):(t=[],this._changesInElement.set(e,t)),t}_makeSnapshot(e){this._elementSnapshots.has(e)||this._elementSnapshots.set(e,bc(e.getChildren()))}_handleChange(e,t){e.nodesToHandle=e.howMany;for(const n of t){const s=e.offset+e.howMany,o=n.offset+n.howMany;if(e.type=="insert"&&(n.type=="insert"&&(e.offset<=n.offset?n.offset+=e.howMany:e.offset<o&&(n.howMany+=e.nodesToHandle,e.nodesToHandle=0)),n.type=="remove"&&e.offset<n.offset&&(n.offset+=e.howMany),n.type=="attribute")){if(e.offset<=n.offset)n.offset+=e.howMany;else if(e.offset<o){const r=n.howMany;n.howMany=e.offset-n.offset,t.unshift({type:"attribute",offset:s,howMany:r-n.howMany,count:this._changeCount++})}}if(e.type=="remove"){if(n.type=="insert"){if(s<=n.offset)n.offset-=e.howMany;else if(s<=o)if(e.offset<n.offset){const r=s-n.offset;n.offset=e.offset,n.howMany-=r,e.nodesToHandle-=r}else n.howMany-=e.nodesToHandle,e.nodesToHandle=0;else if(e.offset<=n.offset)e.nodesToHandle-=n.howMany,n.howMany=0;else if(e.offset<o){const r=o-e.offset;n.howMany-=r,e.nodesToHandle-=r}}if(n.type=="remove"&&(s<=n.offset?n.offset-=e.howMany:e.offset<n.offset&&(e.nodesToHandle+=n.howMany,n.howMany=0)),n.type=="attribute"){if(s<=n.offset)n.offset-=e.howMany;else if(e.offset<n.offset){const r=s-n.offset;n.offset=e.offset,n.howMany-=r}else if(e.offset<o)if(s<=o){const r=n.howMany;n.howMany=e.offset-n.offset;const a=r-n.howMany-e.nodesToHandle;t.unshift({type:"attribute",offset:e.offset,howMany:a,count:this._changeCount++})}else n.howMany-=o-e.offset}}if(e.type=="attribute"){if(n.type=="insert")if(e.offset<n.offset&&s>n.offset){if(s>o){const r={type:"attribute",offset:o,howMany:s-o,count:this._changeCount++};this._handleChange(r,t),t.push(r)}e.nodesToHandle=n.offset-e.offset,e.howMany=e.nodesToHandle}else e.offset>=n.offset&&e.offset<o&&(s>o?(e.nodesToHandle=s-o,e.offset=o):e.nodesToHandle=0);if(n.type=="remove"&&e.offset<n.offset&&s>n.offset){const r={type:"attribute",offset:n.offset,howMany:s-n.offset,count:this._changeCount++};this._handleChange(r,t),t.push(r),e.nodesToHandle=n.offset-e.offset,e.howMany=e.nodesToHandle}n.type=="attribute"&&(e.offset>=n.offset&&s<=o?(e.nodesToHandle=0,e.howMany=0,e.offset=0):e.offset<=n.offset&&s>=o&&(n.howMany=0))}}e.howMany=e.nodesToHandle,delete e.nodesToHandle}_getInsertDiff(e,t,n){return{type:"insert",position:_._createAt(e,t),name:n,length:1,changeCount:this._changeCount++}}_getRemoveDiff(e,t,n){return{type:"remove",position:_._createAt(e,t),name:n,length:1,changeCount:this._changeCount++}}_getAttributesDiff(e,t,n){const s=[];n=new Map(n);for(const[o,r]of t){const a=n.has(o)?n.get(o):null;a!==r&&s.push({type:"attribute",position:e.start,range:e.clone(),length:1,attributeKey:o,attributeOldValue:r,attributeNewValue:a,changeCount:this._changeCount++}),n.delete(o)}for(const[o,r]of n)s.push({type:"attribute",position:e.start,range:e.clone(),length:1,attributeKey:o,attributeOldValue:null,attributeNewValue:r,changeCount:this._changeCount++});return s}_isInInsertedElement(e){const t=e.parent;if(!t)return!1;const n=this._changesInElement.get(t),s=e.startOffset;if(n){for(const o of n)if(o.type=="insert"&&s>=o.offset&&s<o.offset+o.howMany)return!0}return this._isInInsertedElement(t)}_removeAllNestedChanges(e,t,n){const s=new w(_._createAt(e,t),_._createAt(e,t+n));for(const o of s.getItems({shallow:!0}))o.is("element")&&(this._elementSnapshots.delete(o),this._changesInElement.delete(o),this._removeAllNestedChanges(o,0,o.maxOffset))}}function bc(i){const e=[];for(const t of i)if(t.is("$text"))for(let n=0;n<t.data.length;n++)e.push({name:"$text",attributes:new Map(t.getAttributes())});else e.push({name:t.name,attributes:new Map(t.getAttributes())});return e}function Ty(i,e){const t=[];let n=0,s=0;for(const o of e){if(o.offset>n){for(let r=0;r<o.offset-n;r++)t.push("e");s+=o.offset-n}if(o.type=="insert"){for(let r=0;r<o.howMany;r++)t.push("i");n=o.offset+o.howMany}else if(o.type=="remove"){for(let r=0;r<o.howMany;r++)t.push("r");n=o.offset,s+=o.howMany}else t.push(..."a".repeat(o.howMany).split("")),n=o.offset+o.howMany,s+=o.howMany}if(s<i)for(let o=0;o<i-s-n;o++)t.push("e");return t}function ky(i){const e=i.position&&i.position.root.rootName=="$graveyard",t=i.range&&i.range.root.rootName=="$graveyard";return!e&&!t}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ay{constructor(){this._operations=[],this._undoPairs=new Map,this._undoneOperations=new Set}addOperation(e){this._operations.includes(e)||this._operations.push(e)}getOperations(e=Number.NEGATIVE_INFINITY,t=Number.POSITIVE_INFINITY){const n=[];for(const s of this._operations)s.baseVersion>=e&&s.baseVersion<t&&n.push(s);return n}getOperation(e){for(const t of this._operations)if(t.baseVersion==e)return t}setOperationAsUndone(e,t){this._undoPairs.set(t,e),this._undoneOperations.add(e)}isUndoingOperation(e){return this._undoPairs.has(e)}isUndoneOperation(e){return this._undoneOperations.has(e)}getUndoneOperation(e){return this._undoPairs.get(e)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Sy(i){return!!i&&i.length==1&&/[\u0300-\u036f\u1ab0-\u1aff\u1dc0-\u1dff\u20d0-\u20ff\ufe20-\ufe2f]/.test(i)}function Py(i){return!!i&&i.length==1&&/[\ud800-\udbff]/.test(i)}function xy(i){return!!i&&i.length==1&&/[\udc00-\udfff]/.test(i)}function _c(i,e){return Py(i.charAt(e-1))&&xy(i.charAt(e))}function vc(i,e){return Sy(i.charAt(e))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Qs="$graveyard";class yc{constructor(e){this.model=e,this.version=0,this.history=new Ay(this),this.selection=new Me(this),this.roots=new _e({idProperty:"rootName"}),this.differ=new Ey(e.markers),this._postFixers=new Set,this._hasSelectionChangedFromTheLastChangeBlock=!1,this.createRoot("$root",Qs),this.listenTo(e,"applyOperation",(t,n)=>{const s=n[0];if(s.isDocumentOperation&&s.baseVersion!==this.version)throw new f("model-document-applyoperation-wrong-version",this,{operation:s})},{priority:"highest"}),this.listenTo(e,"applyOperation",(t,n)=>{const s=n[0];s.isDocumentOperation&&this.differ.bufferOperation(s)},{priority:"high"}),this.listenTo(e,"applyOperation",(t,n)=>{const s=n[0];s.isDocumentOperation&&(this.version++,this.history.addOperation(s))},{priority:"low"}),this.listenTo(this.selection,"change",()=>{this._hasSelectionChangedFromTheLastChangeBlock=!0}),this.listenTo(e.markers,"update",(t,n,s,o)=>{this.differ.bufferMarkerChange(n.name,s,o,n.affectsData),s===null&&n.on("change",(r,a)=>{this.differ.bufferMarkerChange(n.name,a,n.getRange(),n.affectsData)})})}get graveyard(){return this.getRoot(Qs)}createRoot(e="$root",t="main"){if(this.roots.get(t))throw new f("model-document-createroot-name-exists",this,{name:t});const n=new Js(this,e,t);return this.roots.add(n),n}destroy(){this.selection.destroy(),this.stopListening()}getRoot(e="main"){return this.roots.get(e)}getRootNames(){return Array.from(this.roots,e=>e.rootName).filter(e=>e!=Qs)}registerPostFixer(e){this._postFixers.add(e)}toJSON(){const e=Aa(this);return e.selection="[engine.model.DocumentSelection]",e.model="[engine.model.Model]",e}_handleChangeBlock(e){this._hasDocumentChangedFromTheLastChangeBlock()&&(this._callPostFixers(e),this.selection.refresh(),this.differ.hasDataChanges()?this.fire("change:data",e.batch):this.fire("change",e.batch),this.selection.refresh(),this.differ.reset()),this._hasSelectionChangedFromTheLastChangeBlock=!1}_hasDocumentChangedFromTheLastChangeBlock(){return!this.differ.isEmpty||this._hasSelectionChangedFromTheLastChangeBlock}_getDefaultRoot(){for(const e of this.roots)if(e!==this.graveyard)return e;return this.graveyard}_getDefaultRange(){const e=this._getDefaultRoot(),t=this.model,n=t.schema,s=t.createPositionFromPath(e,[0]);return n.getNearestSelectionRange(s)||t.createRange(s)}_validateSelectionRange(e){return Cc(e.start)&&Cc(e.end)}_callPostFixers(e){let t=!1;do for(const n of this._postFixers)if(this.selection.refresh(),t=n(e),t)break;while(t)}}A(yc,H);function Cc(i){const e=i.textNode;if(e){const t=e.data,n=i.offset-e.startOffset;return!_c(t,n)&&!vc(t,n)}return!0}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ec{constructor(){this._markers=new Map}[Symbol.iterator](){return this._markers.values()}has(e){const t=e instanceof Jt?e.name:e;return this._markers.has(t)}get(e){return this._markers.get(e)||null}_set(e,t,n=!1,s=!1){const o=e instanceof Jt?e.name:e;if(o.includes(","))throw new f("markercollection-incorrect-marker-name",this);const r=this._markers.get(o);if(r){const c=r.getRange();let u=!1;return c.isEqual(t)||(r._attachLiveRange(qe.fromRange(t)),u=!0),n!=r.managedUsingOperations&&(r._managedUsingOperations=n,u=!0),typeof s=="boolean"&&s!=r.affectsData&&(r._affectsData=s,u=!0),u&&this.fire("update:"+o,r,c,t),r}const a=qe.fromRange(t),l=new Jt(o,a,n,s);return this._markers.set(o,l),this.fire("update:"+o,l,null,t),l}_remove(e){const t=e instanceof Jt?e.name:e,n=this._markers.get(t);return n?(this._markers.delete(t),this.fire("update:"+t,n,n.getRange(),null),this._destroyMarker(n),!0):!1}_refresh(e){const t=e instanceof Jt?e.name:e,n=this._markers.get(t);if(!n)throw new f("markercollection-refresh-marker-not-exists",this);const s=n.getRange();this.fire("update:"+t,n,s,s,n.managedUsingOperations,n.affectsData)}*getMarkersAtPosition(e){for(const t of this)t.getRange().containsPosition(e)&&(yield t)}*getMarkersIntersectingRange(e){for(const t of this)t.getRange().getIntersection(e)!==null&&(yield t)}destroy(){for(const e of this._markers.values())this._destroyMarker(e);this._markers=null,this.stopListening()}*getMarkersGroup(e){for(const t of this._markers.values())t.name.startsWith(e+":")&&(yield t)}_destroyMarker(e){e.stopListening(),e._detachLiveRange()}}A(Ec,H);class Jt{constructor(e,t,n,s){this.name=e,this._liveRange=this._attachLiveRange(t),this._managedUsingOperations=n,this._affectsData=s}get managedUsingOperations(){if(!this._liveRange)throw new f("marker-destroyed",this);return this._managedUsingOperations}get affectsData(){if(!this._liveRange)throw new f("marker-destroyed",this);return this._affectsData}getStart(){if(!this._liveRange)throw new f("marker-destroyed",this);return this._liveRange.start.clone()}getEnd(){if(!this._liveRange)throw new f("marker-destroyed",this);return this._liveRange.end.clone()}getRange(){if(!this._liveRange)throw new f("marker-destroyed",this);return this._liveRange.toRange()}is(e){return e==="marker"||e==="model:marker"}_attachLiveRange(e){return this._liveRange&&this._detachLiveRange(),e.delegate("change:range").to(this),e.delegate("change:content").to(this),this._liveRange=e,e}_detachLiveRange(){this._liveRange.stopDelegating("change:range",this),this._liveRange.stopDelegating("change:content",this),this._liveRange.detach(),this._liveRange=null}}A(Jt,H);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ae extends Se{get type(){return"noop"}clone(){return new ae(this.baseVersion)}getReversed(){return new ae(this.baseVersion+1)}_execute(){}static get className(){return"NoOperation"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Ve={};Ve[ne.className]=ne;Ve[re.className]=re;Ve[pe.className]=pe;Ve[z.className]=z;Ve[ae.className]=ae;Ve[Se.className]=Se;Ve[we.className]=we;Ve[st.className]=st;Ve[J.className]=J;Ve[ie.className]=ie;class Iy{static fromJSON(e,t){return Ve[e.__className].fromJSON(e,t)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ce extends _{constructor(e,t,n="toNone"){super(e,t,n);if(!this.root.is("rootElement"))throw new f("model-liveposition-root-not-rootelement",e);Ry.call(this)}detach(){this.stopListening()}is(e){return e==="livePosition"||e==="model:livePosition"||e=="position"||e==="model:position"}toPosition(){return new _(this.root,this.path.slice(),this.stickiness)}static fromPosition(e,t){return new this(e.root,e.path.slice(),t||e.stickiness)}}function Ry(){this.listenTo(this.root.document.model,"applyOperation",(i,e)=>{const t=e[0];!t.isDocumentOperation||My.call(this,t)},{priority:"low"})}function My(i){const e=this.getTransformedByOperation(i);if(!this.isEqual(e)){const t=this.toPosition();this.path=e.path,this.root=e.root,this.fire("change",t)}}A(ce,H);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Vy(i,e,t,n){return i.change(s=>{let o;t?t instanceof nt||t instanceof Me?o=t:o=s.createSelection(t,n):o=i.document.selection,o.isCollapsed||i.deleteContent(o,{doNotAutoparagraph:!0});const r=new Oy(i,s,o.anchor);let a;e.is("documentFragment")?a=e.getChildren():a=[e],r.handleNodes(a);const l=r.getSelectionRange();l&&(o instanceof Me?s.setSelection(l):o.setTo(l));const c=r.getAffectedRange()||i.createRange(o.anchor);return r.destroy(),c})}class Oy{constructor(e,t,n){this.model=e,this.writer=t,this.position=n,this.canMergeWith=new Set([this.position.parent]),this.schema=e.schema,this._documentFragment=t.createDocumentFragment(),this._documentFragmentPosition=t.createPositionAt(this._documentFragment,0),this._firstNode=null,this._lastNode=null,this._lastAutoParagraph=null,this._filterAttributesOf=[],this._affectedStart=null,this._affectedEnd=null}handleNodes(e){for(const t of Array.from(e))this._handleNode(t);this._insertPartialFragment(),this._lastAutoParagraph&&this._updateLastNodeFromAutoParagraph(this._lastAutoParagraph),this._mergeOnRight(),this.schema.removeDisallowedAttributes(this._filterAttributesOf,this.writer),this._filterAttributesOf=[]}_updateLastNodeFromAutoParagraph(e){const t=this.writer.createPositionAfter(this._lastNode),n=this.writer.createPositionAfter(e);if(n.isAfter(t)){if(this._lastNode=e,this.position.parent!=e||!this.position.isAtEnd)throw new f("insertcontent-invalid-insertion-position",this);this.position=n,this._setAffectedBoundaries(this.position)}}getSelectionRange(){return this.nodeToSelect?w._createOn(this.nodeToSelect):this.model.schema.getNearestSelectionRange(this.position)}getAffectedRange(){return this._affectedStart?new w(this._affectedStart,this._affectedEnd):null}destroy(){this._affectedStart&&this._affectedStart.detach(),this._affectedEnd&&this._affectedEnd.detach()}_handleNode(e){if(this.schema.isObject(e)){this._handleObject(e);return}let t=this._checkAndAutoParagraphToAllowedPosition(e);if(!t&&(t=this._checkAndSplitToAllowedPosition(e),!t)){this._handleDisallowedNode(e);return}this._appendToFragment(e),this._firstNode||(this._firstNode=e),this._lastNode=e}_insertPartialFragment(){if(this._documentFragment.isEmpty)return;const e=ce.fromPosition(this.position,"toNext");this._setAffectedBoundaries(this.position),this._documentFragment.getChild(0)==this._firstNode&&(this.writer.insert(this._firstNode,this.position),this._mergeOnLeft(),this.position=e.toPosition()),this._documentFragment.isEmpty||this.writer.insert(this._documentFragment,this.position),this._documentFragmentPosition=this.writer.createPositionAt(this._documentFragment,0),this.position=e.toPosition(),e.detach()}_handleObject(e){this._checkAndSplitToAllowedPosition(e)?this._appendToFragment(e):this._tryAutoparagraphing(e)}_handleDisallowedNode(e){e.is("element")?this.handleNodes(e.getChildren()):this._tryAutoparagraphing(e)}_appendToFragment(e){if(!this.schema.checkChild(this.position,e))throw new f("insertcontent-wrong-position",this,{node:e,position:this.position});this.writer.insert(e,this._documentFragmentPosition),this._documentFragmentPosition=this._documentFragmentPosition.getShiftedBy(e.offsetSize),this.schema.isObject(e)&&!this.schema.checkChild(this.position,"$text")?this.nodeToSelect=e:this.nodeToSelect=null,this._filterAttributesOf.push(e)}_setAffectedBoundaries(e){this._affectedStart||(this._affectedStart=ce.fromPosition(e,"toPrevious")),(!this._affectedEnd||this._affectedEnd.isBefore(e))&&(this._affectedEnd&&this._affectedEnd.detach(),this._affectedEnd=ce.fromPosition(e,"toNext"))}_mergeOnLeft(){const e=this._firstNode;if(!(e instanceof L)||!this._canMergeLeft(e))return;const t=ce._createBefore(e);t.stickiness="toNext";const n=ce.fromPosition(this.position,"toNext");this._affectedStart.isEqual(t)&&(this._affectedStart.detach(),this._affectedStart=ce._createAt(t.nodeBefore,"end","toPrevious")),this._firstNode===this._lastNode&&(this._firstNode=t.nodeBefore,this._lastNode=t.nodeBefore),this.writer.merge(t),t.isEqual(this._affectedEnd)&&this._firstNode===this._lastNode&&(this._affectedEnd.detach(),this._affectedEnd=ce._createAt(t.nodeBefore,"end","toNext")),this.position=n.toPosition(),n.detach(),this._filterAttributesOf.push(this.position.parent),t.detach()}_mergeOnRight(){const e=this._lastNode;if(!(e instanceof L)||!this._canMergeRight(e))return;const t=ce._createAfter(e);if(t.stickiness="toNext",!this.position.isEqual(t))throw new f("insertcontent-invalid-insertion-position",this);this.position=_._createAt(t.nodeBefore,"end");const n=ce.fromPosition(this.position,"toPrevious");this._affectedEnd.isEqual(t)&&(this._affectedEnd.detach(),this._affectedEnd=ce._createAt(t.nodeBefore,"end","toNext")),this._firstNode===this._lastNode&&(this._firstNode=t.nodeBefore,this._lastNode=t.nodeBefore),this.writer.merge(t),t.getShiftedBy(-1).isEqual(this._affectedStart)&&this._firstNode===this._lastNode&&(this._affectedStart.detach(),this._affectedStart=ce._createAt(t.nodeBefore,0,"toPrevious")),this.position=n.toPosition(),n.detach(),this._filterAttributesOf.push(this.position.parent),t.detach()}_canMergeLeft(e){const t=e.previousSibling;return t instanceof L&&this.canMergeWith.has(t)&&this.model.schema.checkMerge(t,e)}_canMergeRight(e){const t=e.nextSibling;return t instanceof L&&this.canMergeWith.has(t)&&this.model.schema.checkMerge(e,t)}_tryAutoparagraphing(e){const t=this.writer.createElement("paragraph");this._getAllowedIn(this.position.parent,t)&&this.schema.checkChild(t,e)&&(t._appendChild(e),this._handleNode(t))}_checkAndAutoParagraphToAllowedPosition(e){if(this.schema.checkChild(this.position.parent,e))return!0;if(!this.schema.checkChild(this.position.parent,"paragraph")||!this.schema.checkChild("paragraph",e))return!1;this._insertPartialFragment();const t=this.writer.createElement("paragraph");return this.writer.insert(t,this.position),this._setAffectedBoundaries(this.position),this._lastAutoParagraph=t,this.position=this.writer.createPositionAt(t,0),!0}_checkAndSplitToAllowedPosition(e){const t=this._getAllowedIn(this.position.parent,e);if(!t)return!1;for(t!=this.position.parent&&this._insertPartialFragment();t!=this.position.parent;)if(this.position.isAtStart){const n=this.position.parent;this.position=this.writer.createPositionBefore(n),n.isEmpty&&n.parent===t&&this.writer.remove(n)}else if(this.position.isAtEnd)this.position=this.writer.createPositionAfter(this.position.parent);else{const n=this.writer.createPositionAfter(this.position.parent);this._setAffectedBoundaries(this.position),this.writer.split(this.position),this.position=n,this.canMergeWith.add(this.position.nodeAfter)}return!0}_getAllowedIn(e,t){return this.schema.checkChild(e,t)?e:this.schema.isLimit(e)?null:this._getAllowedIn(e.parent,t)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Ny(i,e,t={}){if(e.isCollapsed)return;const n=e.getFirstRange();if(n.root.rootName=="$graveyard")return;const s=i.schema;i.change(o=>{if(!t.doNotResetEntireContent&&Uy(s,e)){Wy(o,e);return}const[r,a]=Dy(n);r.isTouching(a)||o.remove(o.createRange(r,a)),t.leaveUnmerged||(Fy(o,r,a),s.removeDisallowedAttributes(r.parent.getChildren(),o)),Sc(o,e,r),!t.doNotAutoparagraph&&Hy(s,r)&&Ac(o,r,e),r.detach(),a.detach()})}function Dy(i){const e=i.root.document.model,t=i.start;let n=i.end;if(e.hasContent(i,{ignoreMarkers:!0})){const s=By(n);if(s&&n.isTouching(e.createPositionAt(s,0))){const o=e.createSelection(i);e.modifySelection(o,{direction:"backward"});const r=o.getLastPosition(),a=e.createRange(r,n);e.hasContent(a,{ignoreMarkers:!0})||(n=r)}}return[ce.fromPosition(t,"toPrevious"),ce.fromPosition(n,"toNext")]}function By(i){const e=i.parent,t=e.root.document.model.schema,n=e.getAncestors({parentFirst:!0,includeSelf:!0});for(const s of n){if(t.isLimit(s))return null;if(t.isBlock(s))return s}}function Fy(i,e,t){const n=i.model;if(!Ys(i.model.schema,e,t))return;const[s,o]=zy(e,t);!s||!o||(!n.hasContent(s,{ignoreMarkers:!0})&&n.hasContent(o,{ignoreMarkers:!0})?kc(i,e,t,s.parent):Tc(i,e,t,s.parent))}function Tc(i,e,t,n){const s=e.parent,o=t.parent;if(!(s==n||o==n)){for(e=i.createPositionAfter(s),t=i.createPositionBefore(o),t.isEqual(e)||i.insert(o,e),i.merge(e);t.parent.isEmpty;){const r=t.parent;t=i.createPositionBefore(r),i.remove(r)}!Ys(i.model.schema,e,t)||Tc(i,e,t,n)}}function kc(i,e,t,n){const s=e.parent,o=t.parent;if(!(s==n||o==n)){for(e=i.createPositionAfter(s),t=i.createPositionBefore(o),t.isEqual(e)||i.insert(s,t);e.parent.isEmpty;){const r=e.parent;e=i.createPositionBefore(r),i.remove(r)}t=i.createPositionBefore(o),Ly(i,t),!!Ys(i.model.schema,e,t)&&kc(i,e,t,n)}}function Ly(i,e){const t=e.nodeBefore,n=e.nodeAfter;t.name!=n.name&&i.rename(t,n.name),i.clearAttributes(t),i.setAttributes(Object.fromEntries(n.getAttributes()),t),i.merge(e)}function Ys(i,e,t){const n=e.parent,s=t.parent;return n==s||i.isLimit(n)||i.isLimit(s)?!1:$y(e,t,i)}function zy(i,e){const t=i.getAncestors(),n=e.getAncestors();let s=0;for(;t[s]&&t[s]==n[s];)s++;return[t[s],n[s]]}function Hy(i,e){const t=i.checkChild(e,"$text"),n=i.checkChild(e,"paragraph");return!t&&n}function $y(i,e,t){const n=new w(i,e);for(const s of n.getWalker())if(t.isLimit(s.item))return!1;return!0}function Ac(i,e,t){const n=i.createElement("paragraph");i.insert(n,e),Sc(i,t,i.createPositionAt(n,0))}function Wy(i,e){const t=i.model.schema.getLimitElement(e);i.remove(i.createRangeIn(t)),Ac(i,i.createPositionAt(t,0),e)}function Uy(i,e){const t=i.getLimitElement(e);if(!e.containsEntireContent(t))return!1;const n=e.getFirstRange();return n.start.parent==n.end.parent?!1:i.checkChild(t,"paragraph")}function Sc(i,e,t){e instanceof Me?i.setSelection(t):e.setTo(t)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Pc=' ,.?!:;"-()';function qy(i,e,t={}){const n=i.schema,s=t.direction!="backward",o=t.unit?t.unit:"character",r=e.focus,a=new tt({boundaries:Jy(r,s),singleCharacters:!0,direction:s?"forward":"backward"}),l={walker:a,schema:n,isForward:s,unit:o};let c;for(;c=a.next();){if(c.done)return;const u=jy(l,c.value);if(u){e instanceof Me?i.change(d=>{d.setSelectionFocus(u)}):e.setFocus(u);return}}}function jy(i,e){const{isForward:t,walker:n,unit:s,schema:o}=i,{type:r,item:a,nextPosition:l}=e;if(r=="text")return i.unit==="word"?Gy(n,t):Ky(n,s);if(r==(t?"elementStart":"elementEnd")){if(o.isSelectable(a))return _._createAt(a,t?"after":"before");if(o.checkChild(l,"$text"))return l}else{if(o.isLimit(a)){n.skip(()=>!0);return}if(o.checkChild(l,"$text"))return l}}function Ky(i,e){const t=i.position.textNode;if(t){const n=t.data;let s=i.position.offset-t.startOffset;for(;_c(n,s)||e=="character"&&vc(n,s);)i.next(),s=i.position.offset-t.startOffset}return i.position}function Gy(i,e){let t=i.position.textNode;if(t){let n=i.position.offset-t.startOffset;for(;!Qy(t.data,n,e)&&!Yy(t,n,e);){i.next();const s=e?i.position.nodeAfter:i.position.nodeBefore;if(s&&s.is("$text")){const o=s.data.charAt(e?0:s.data.length-1);Pc.includes(o)||(i.next(),t=i.position.textNode)}n=i.position.offset-t.startOffset}}return i.position}function Jy(i,e){const t=i.root,n=_._createAt(t,e?"end":0);return e?new w(i,n):new w(n,i)}function Qy(i,e,t){const n=e+(t?0:-1);return Pc.includes(i.charAt(n))}function Yy(i,e,t){return e===(t?i.endOffset:0)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Xy(i,e){return i.change(t=>{const n=t.createDocumentFragment(),s=e.getFirstRange();if(!s||s.isCollapsed)return n;const o=s.start.root,r=s.start.getCommonPath(s.end),a=o.getNodeByPath(r);let l;s.start.parent==s.end.parent?l=s:l=t.createRange(t.createPositionAt(a,s.start.path[r.length]),t.createPositionAt(a,s.end.path[r.length]+1));const c=l.end.offset-l.start.offset;for(const u of l.getItems({shallow:!0}))u.is("$textProxy")?t.appendText(u.data,u.getAttributes(),n):t.append(t.cloneElement(u,!0),n);if(l!=s){const u=s._getTransformedByMove(l.start,t.createPositionAt(n,0),c)[0],d=t.createRange(t.createPositionAt(n,0),u.start),h=t.createRange(u.end,t.createPositionAt(n,"end"));xc(h,t),xc(d,t)}return n})}function xc(i,e){const t=[];Array.from(i.getItems({direction:"backward"})).map(n=>e.createRangeOn(n)).filter(n=>(n.start.isAfter(i.start)||n.start.isEqual(i.start))&&(n.end.isBefore(i.end)||n.end.isEqual(i.end))).forEach(n=>{t.push(n.start.parent),e.remove(n)}),t.forEach(n=>{let s=n;for(;s.parent&&s.isEmpty;){const o=e.createRangeOn(s);s=s.parent,e.remove(o)}})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Zy(i){i.document.registerPostFixer(e=>e0(e,i))}function e0(i,e){const t=e.document.selection,n=e.schema,s=[];let o=!1;for(const r of t.getRanges()){const a=t0(r,n);a&&!a.isEqual(r)?(s.push(a),o=!0):s.push(r)}o&&i.setSelection(o0(s),{backward:t.isBackward})}function t0(i,e){return i.isCollapsed?n0(i,e):i0(i,e)}function n0(i,e){const t=i.start,n=e.getNearestSelectionRange(t);if(!n){const o=t.getAncestors().reverse().find(r=>e.isObject(r));return o?w._createOn(o):null}if(!n.isCollapsed)return n;const s=n.start;return t.isEqual(s)?null:new w(s)}function i0(i,e){const{start:t,end:n}=i,s=e.checkChild(t,"$text"),o=e.checkChild(n,"$text"),r=e.getLimitElement(t),a=e.getLimitElement(n);if(r===a){if(s&&o)return null;if(s0(t,n,e)){const d=t.nodeAfter&&e.isSelectable(t.nodeAfter)?null:e.getNearestSelectionRange(t,"forward"),m=n.nodeBefore&&e.isSelectable(n.nodeBefore)?null:e.getNearestSelectionRange(n,"backward"),g=d?d.start:t,p=m?m.end:n;return new w(g,p)}}const l=r&&!r.is("rootElement"),c=a&&!a.is("rootElement");if(l||c){const u=t.nodeAfter&&n.nodeBefore&&t.nodeAfter.parent===n.nodeBefore.parent,d=l&&(!u||!Rc(t.nodeAfter,e)),h=c&&(!u||!Rc(n.nodeBefore,e));let m=t,g=n;return d&&(m=_._createBefore(Ic(r,e))),h&&(g=_._createAfter(Ic(a,e))),new w(m,g)}return null}function Ic(i,e){let t=i,n=t;for(;e.isLimit(n)&&n.parent;)t=n,n=n.parent;return t}function s0(i,e,t){const n=i.nodeAfter&&!t.isLimit(i.nodeAfter)||t.checkChild(i,"$text"),s=e.nodeBefore&&!t.isLimit(e.nodeBefore)||t.checkChild(e,"$text");return n||s}function o0(i){const e=[...i],t=new Set;let n=1;for(;n<e.length;){const o=e[n],r=e.slice(0,n);for(const[a,l]of r.entries())if(!t.has(a)){if(o.isEqual(l))t.add(a);else if(o.isIntersecting(l)){t.add(a),t.add(n);const c=o.getJoined(l);e.push(c)}}n++}return e.filter((o,r)=>!t.has(r))}function Rc(i,e){return i&&e.isSelectable(i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Mc{constructor(){this.markers=new Ec,this.document=new yc(this),this.schema=new ac,this._pendingChanges=[],this._currentWriter=null,["insertContent","deleteContent","modifySelection","getSelectedContent","applyOperation"].forEach(e=>this.decorate(e)),this.on("applyOperation",(e,t)=>{t[0]._validate()},{priority:"highest"}),this.schema.register("$root",{isLimit:!0}),this.schema.register("$block",{allowIn:"$root",isBlock:!0}),this.schema.register("$text",{allowIn:"$block",isInline:!0,isContent:!0}),this.schema.register("$clipboardHolder",{allowContentOf:"$root",allowChildren:"$text",isLimit:!0}),this.schema.register("$documentFragment",{allowContentOf:"$root",allowChildren:"$text",isLimit:!0}),this.schema.register("$marker"),this.schema.addChildCheck((e,t)=>{if(t.name==="$marker")return!0}),Zy(this),this.document.registerPostFixer(Xl)}change(e){try{return this._pendingChanges.length===0?(this._pendingChanges.push({batch:new fi,callback:e}),this._runPendingChanges()[0]):e(this._currentWriter)}catch(t){f.rethrowUnexpectedError(t,this)}}enqueueChange(e,t){try{typeof e=="string"?e=new fi(e):typeof e=="function"&&(t=e,e=new fi),this._pendingChanges.push({batch:e,callback:t}),this._pendingChanges.length==1&&this._runPendingChanges()}catch(n){f.rethrowUnexpectedError(n,this)}}applyOperation(e){e._execute()}insertContent(e,t,n){return Vy(this,e,t,n)}deleteContent(e,t){Ny(this,e,t)}modifySelection(e,t){qy(this,e,t)}getSelectedContent(e){return Xy(this,e)}hasContent(e,t={}){const n=e instanceof L?w._createIn(e):e;if(n.isCollapsed)return!1;const{ignoreWhitespaces:s=!1,ignoreMarkers:o=!1}=t;if(!o){for(const r of this.markers.getMarkersIntersectingRange(n))if(r.affectsData)return!0}for(const r of n.getItems())if(this.schema.isContent(r))if(r.is("$textProxy"))if(s){if(r.data.search(/\S/)!==-1)return!0}else return!0;else return!0;return!1}createPositionFromPath(e,t,n){return new _(e,t,n)}createPositionAt(e,t){return _._createAt(e,t)}createPositionAfter(e){return _._createAfter(e)}createPositionBefore(e){return _._createBefore(e)}createRange(e,t){return new w(e,t)}createRangeIn(e){return w._createIn(e)}createRangeOn(e){return w._createOn(e)}createSelection(e,t,n){return new nt(e,t,n)}createBatch(e){return new fi(e)}createOperationFromJSON(e){return Iy.fromJSON(e,this.document)}destroy(){this.document.destroy(),this.stopListening()}_runPendingChanges(){const e=[];for(this.fire("_beforeChanges");this._pendingChanges.length;){const t=this._pendingChanges[0].batch;this._currentWriter=new yy(this,t);const n=this._pendingChanges[0].callback(this._currentWriter);e.push(n),this.document._handleChangeBlock(this._currentWriter),this._pendingChanges.shift(),this._currentWriter=null}return this.fire("_afterChanges"),e}}A(Mc,$);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class r0 extends et{constructor(e){super();this.editor=e}set(e,t,n={}){if(typeof t=="string"){const s=t;t=(o,r)=>{this.editor.execute(s),r()}}super.set(e,t,n)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Vc{constructor(e={}){const t=e.language||this.constructor.defaultConfig&&this.constructor.defaultConfig.language;this._context=e.context||new B_({language:t}),this._context._addEditor(this,!e.context);const n=Array.from(this.constructor.builtinPlugins||[]);this.config=new ja(e,this.constructor.defaultConfig),this.config.define("plugins",n),this.config.define(this._context._getEditorConfig()),this.plugins=new _s(this,n,this._context.plugins),this.locale=this._context.locale,this.t=this.locale.t,this.commands=new G1,this.set("state","initializing"),this.once("ready",()=>this.state="ready",{priority:"high"}),this.once("destroy",()=>this.state="destroyed",{priority:"high"}),this.set("isReadOnly",!1),this.model=new Mc;const s=new K_;this.data=new uc(this.model,s),this.editing=new rc(this.model,s),this.editing.view.document.bind("isReadOnly").to(this),this.conversion=new wy([this.editing.downcastDispatcher,this.data.downcastDispatcher],this.data.upcastDispatcher),this.conversion.addAlias("dataDowncast",this.data.downcastDispatcher),this.conversion.addAlias("editingDowncast",this.editing.downcastDispatcher),this.keystrokes=new r0(this),this.keystrokes.listenTo(this.editing.view.document)}initPlugins(){const e=this.config,t=e.get("plugins"),n=e.get("removePlugins")||[],s=e.get("extraPlugins")||[],o=e.get("substitutePlugins")||[];return this.plugins.init(t.concat(s),n,o)}destroy(){let e=Promise.resolve();return this.state=="initializing"&&(e=new Promise(t=>this.once("ready",t))),e.then(()=>{this.fire("destroy"),this.stopListening(),this.commands.destroy()}).then(()=>this.plugins.destroy()).then(()=>{this.model.destroy(),this.data.destroy(),this.editing.destroy(),this.keystrokes.destroy()}).then(()=>this._context._removeEditor(this))}execute(...e){try{return this.commands.execute(...e)}catch(t){f.rethrowUnexpectedError(t,this)}}focus(){this.editing.view.focus()}}A(Vc,$);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class a0{constructor(e){this.editor=e,this._components=new Map}*names(){for(const e of this._components.values())yield e.originalName}add(e,t){this._components.set(Xs(e),{callback:t,originalName:e})}create(e){if(!this.has(e))throw new f("componentfactory-item-missing",this,{name:e});return this._components.get(Xs(e)).callback(this.editor.locale)}has(e){return this._components.has(Xs(e))}}function Xs(i){return String(i).toLowerCase()}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Oc{constructor(e){this.editor=e,this.componentFactory=new a0(e),this.focusTracker=new Ae,this.set("viewportOffset",this._readViewportOffsetFromConfig()),this._editableElementsMap=new Map,this.listenTo(e.editing.view.document,"layoutChanged",()=>this.update())}get element(){return null}update(){this.fire("update")}destroy(){this.stopListening(),this.focusTracker.destroy();for(const e of this._editableElementsMap.values())e.ckeditorInstance=null;this._editableElementsMap=new Map}setEditableElement(e,t){this._editableElementsMap.set(e,t),t.ckeditorInstance||(t.ckeditorInstance=this.editor)}getEditableElement(e="main"){return this._editableElementsMap.get(e)}getEditableElementsNames(){return this._editableElementsMap.keys()}get _editableElements(){return console.warn("editor-ui-deprecated-editable-elements: The EditorUI#_editableElements property has been deprecated and will be removed in the near future.",{editorUI:this}),this._editableElementsMap}_readViewportOffsetFromConfig(){const e=this.editor,t=e.config.get("ui.viewportOffset");if(t)return t;const n=e.config.get("toolbar.viewportTopOffset");return n?(console.warn("editor-ui-deprecated-viewport-offset-config: The `toolbar.vieportTopOffset` configuration option is deprecated. It will be removed from future CKEditor versions. Use `ui.viewportOffset.top` instead."),{top:n}):{top:0}}}A(Oc,$);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const l0={setData(i){this.data.set(i)},getData(i){return this.data.get(i)}};/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function c0(i){const e=i.sourceElement;if(!!e){if(e.ckeditorInstance)throw new f("editor-source-element-already-used",i);e.ckeditorInstance=i,i.once("destroy",()=>{delete e.ckeditorInstance})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class mi extends Tn{static get pluginName(){return"PendingActions"}init(){this.set("hasAny",!1),this._actions=new _e({idProperty:"_id"}),this._actions.delegate("add","remove").to(this)}add(e){if(typeof e!="string")throw new f("pendingactions-add-invalid-message",this);const t=Object.create($);return t.set("message",e),this._actions.add(t),this.hasAny=!0,t}remove(e){this._actions.remove(e),this.hasAny=!!this._actions.length}get first(){return this._actions.get(0)}[Symbol.iterator](){return this._actions[Symbol.iterator]()}}var u0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.591 10.177 4.243 4.242a1 1 0 0 1-1.415 1.415l-4.242-4.243-4.243 4.243a1 1 0 0 1-1.414-1.415l4.243-4.242L4.52 5.934A1 1 0 0 1 5.934 4.52l4.243 4.243 4.242-4.243a1 1 0 1 1 1.415 1.414l-4.243 4.243z"/></svg>',d0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 16h9a1 1 0 0 1 0 2H2a1 1 0 0 1 0-2z"/><path d="M17 1a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h14zm0 1.5H3a.5.5 0 0 0-.492.41L2.5 3v9a.5.5 0 0 0 .41.492L3 12.5h14a.5.5 0 0 0 .492-.41L17.5 12V3a.5.5 0 0 0-.41-.492L17 2.5z" fill-opacity=".6"/></svg>',h0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6.972 16.615a.997.997 0 0 1-.744-.292l-4.596-4.596a1 1 0 1 1 1.414-1.414l3.926 3.926 9.937-9.937a1 1 0 0 1 1.414 1.415L7.717 16.323a.997.997 0 0 1-.745.292z"/></svg>',f0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.333 2 .19 2.263a5.899 5.899 0 0 1 1.458.604L14.714 3.4 16.6 5.286l-1.467 1.733c.263.452.468.942.605 1.46L18 8.666v2.666l-2.263.19a5.899 5.899 0 0 1-.604 1.458l1.467 1.733-1.886 1.886-1.733-1.467a5.899 5.899 0 0 1-1.46.605L11.334 18H8.667l-.19-2.263a5.899 5.899 0 0 1-1.458-.604L5.286 16.6 3.4 14.714l1.467-1.733a5.899 5.899 0 0 1-.604-1.458L2 11.333V8.667l2.262-.189a5.899 5.899 0 0 1 .605-1.459L3.4 5.286 5.286 3.4l1.733 1.467a5.899 5.899 0 0 1 1.46-.605L8.666 2h2.666zM10 6.267a3.733 3.733 0 1 0 0 7.466 3.733 3.733 0 0 0 0-7.466z"/></svg>',m0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m8.636 9.531-2.758 3.94a.5.5 0 0 0 .122.696l3.224 2.284h1.314l2.636-3.736L8.636 9.53zm.288 8.451L5.14 15.396a2 2 0 0 1-.491-2.786l6.673-9.53a2 2 0 0 1 2.785-.49l3.742 2.62a2 2 0 0 1 .491 2.785l-7.269 10.053-2.147-.066z"/><path d="M4 18h5.523v-1H4zm-2 0h1v-1H2z"/></svg>',g0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5.085 6.22 2.943 4.078a.75.75 0 1 1 1.06-1.06l2.592 2.59A11.094 11.094 0 0 1 10 5.068c4.738 0 8.578 3.101 8.578 5.083 0 1.197-1.401 2.803-3.555 3.887l1.714 1.713a.75.75 0 0 1-.09 1.138.488.488 0 0 1-.15.084.75.75 0 0 1-.821-.16L6.17 7.304c-.258.11-.51.233-.757.365l6.239 6.24-.006.005.78.78c-.388.094-.78.166-1.174.215l-1.11-1.11h.011L4.55 8.197a7.2 7.2 0 0 0-.665.514l-.112.098 4.897 4.897-.005.006 1.276 1.276a10.164 10.164 0 0 1-1.477-.117l-.479-.479-.009.009-4.863-4.863-.022.031a2.563 2.563 0 0 0-.124.2c-.043.077-.08.158-.108.241a.534.534 0 0 0-.028.133.29.29 0 0 0 .008.072.927.927 0 0 0 .082.226c.067.133.145.26.234.379l3.242 3.365.025.01.59.623c-3.265-.918-5.59-3.155-5.59-4.668 0-1.194 1.448-2.838 3.663-3.93zm7.07.531a4.632 4.632 0 0 1 1.108 5.992l.345.344.046-.018a9.313 9.313 0 0 0 2-1.112c.256-.187.5-.392.727-.613.137-.134.27-.277.392-.431.072-.091.141-.185.203-.286.057-.093.107-.19.148-.292a.72.72 0 0 0 .036-.12.29.29 0 0 0 .008-.072.492.492 0 0 0-.028-.133.999.999 0 0 0-.036-.096 2.165 2.165 0 0 0-.071-.145 2.917 2.917 0 0 0-.125-.2 3.592 3.592 0 0 0-.263-.335 5.444 5.444 0 0 0-.53-.523 7.955 7.955 0 0 0-1.054-.768 9.766 9.766 0 0 0-1.879-.891c-.337-.118-.68-.219-1.027-.301zm-2.85.21-.069.002a.508.508 0 0 0-.254.097.496.496 0 0 0-.104.679.498.498 0 0 0 .326.199l.045.005c.091.003.181.003.272.012a2.45 2.45 0 0 1 2.017 1.513c.024.061.043.125.069.185a.494.494 0 0 0 .45.287h.008a.496.496 0 0 0 .35-.158.482.482 0 0 0 .13-.335.638.638 0 0 0-.048-.219 3.379 3.379 0 0 0-.36-.723 3.438 3.438 0 0 0-2.791-1.543l-.028-.001h-.013z"/></svg>',p0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6.91 10.54c.26-.23.64-.21.88.03l3.36 3.14 2.23-2.06a.64.64 0 0 1 .87 0l2.52 2.97V4.5H3.2v10.12l3.71-4.08zm10.27-7.51c.6 0 1.09.47 1.09 1.05v11.84c0 .59-.49 1.06-1.09 1.06H2.79c-.6 0-1.09-.47-1.09-1.06V4.08c0-.58.49-1.05 1.1-1.05h14.38zm-5.22 5.56a1.96 1.96 0 1 1 3.4-1.96 1.96 1.96 0 0 1-3.4 1.96z"/></svg>',w0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m9.239 13.938-2.88-1.663a.75.75 0 0 1 .75-1.3L9 12.067V4.75a.75.75 0 1 1 1.5 0v7.318l1.89-1.093a.75.75 0 0 1 .75 1.3l-2.879 1.663a.752.752 0 0 1-.511.187.752.752 0 0 1-.511-.187zM4.25 17a.75.75 0 1 1 0-1.5h10.5a.75.75 0 0 1 0 1.5H4.25z"/></svg>',b0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.75 11.875a.752.752 0 0 1 .508.184l2.883 1.666a.75.75 0 0 1-.659 1.344l-.091-.044-1.892-1.093.001 4.318a.75.75 0 1 1-1.5 0v-4.317l-1.89 1.092a.75.75 0 0 1-.75-1.3l2.879-1.663a.752.752 0 0 1 .51-.187zM15.25 9a.75.75 0 1 1 0 1.5H4.75a.75.75 0 1 1 0-1.5h10.5zM9.75.375a.75.75 0 0 1 .75.75v4.318l1.89-1.093.092-.045a.75.75 0 0 1 .659 1.344l-2.883 1.667a.752.752 0 0 1-.508.184.752.752 0 0 1-.511-.187L6.359 5.65a.75.75 0 0 1 .75-1.299L9 5.442V1.125a.75.75 0 0 1 .75-.75z"/></svg>',_0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m10.261 7.062 2.88 1.663a.75.75 0 0 1-.75 1.3L10.5 8.933v7.317a.75.75 0 1 1-1.5 0V8.932l-1.89 1.093a.75.75 0 0 1-.75-1.3l2.879-1.663a.752.752 0 0 1 .511-.187.752.752 0 0 1 .511.187zM15.25 4a.75.75 0 1 1 0 1.5H4.75a.75.75 0 0 1 0-1.5h10.5z"/></svg>',v0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 4c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0-8c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75z"/></svg>',y0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm2.286 4c0 .414.336.75.75.75h9.928a.75.75 0 1 0 0-1.5H5.036a.75.75 0 0 0-.75.75zm0-8c0 .414.336.75.75.75h9.928a.75.75 0 1 0 0-1.5H5.036a.75.75 0 0 0-.75.75z"/></svg>',C0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M18 3.75a.75.75 0 0 1-.75.75H2.75a.75.75 0 1 1 0-1.5h14.5a.75.75 0 0 1 .75.75zm0 8a.75.75 0 0 1-.75.75H2.75a.75.75 0 1 1 0-1.5h14.5a.75.75 0 0 1 .75.75zm0 4a.75.75 0 0 1-.75.75H7.321a.75.75 0 1 1 0-1.5h9.929a.75.75 0 0 1 .75.75zm0-8a.75.75 0 0 1-.75.75H7.321a.75.75 0 1 1 0-1.5h9.929a.75.75 0 0 1 .75.75z"/></svg>',E0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 4c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0-8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75z"/></svg>',T0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm0 12h16v1.5H2z"/><path d="M12.003 7v5.5a1 1 0 0 1-1 1H2.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H3.5V12h6.997V7.5z"/></svg>',k0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm0 12h16v1.5H2z"/><path d="M15.003 7v5.5a1 1 0 0 1-1 1H5.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H6.5V12h6.997V7.5z"/></svg>',A0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm0 12h16v1.5H2z"/><path d="M18.003 7v5.5a1 1 0 0 1-1 1H8.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H9.5V12h6.997V7.5z"/></svg>',S0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm0 12h16v1.5H2z"/><path d="M18 7v5.5a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1zm-1.505.5H3.504V12h12.991V7.5z"/></svg>',P0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm11.5 9H18v1.5h-4.5zM2 15h16v1.5H2z"/><path d="M12.003 7v5.5a1 1 0 0 1-1 1H2.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H3.5V12h6.997V7.5z"/></svg>',x0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm11.5 9H18v1.5h-4.5zm0-3H18v1.5h-4.5zm0-3H18v1.5h-4.5zM2 15h16v1.5H2z"/><path d="M12.003 7v5.5a1 1 0 0 1-1 1H2.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H3.5V12h6.997V7.5z"/></svg>',I0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm0 12h16v1.5H2zm0-9h5v1.5H2zm0 3h5v1.5H2zm0 3h5v1.5H2z"/><path d="M18.003 7v5.5a1 1 0 0 1-1 1H8.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H9.5V12h6.997V7.5z"/></svg>',R0='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M2.5 17v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zM1 15.5v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm0-2v1h-1v-1h1zm-19 0v1H0v-1h1zM14.5 2v1h-1V2h1zm2 0v1h-1V2h1zm2 0v1h-1V2h1zm-8 0v1h-1V2h1zm-2 0v1h-1V2h1zm-2 0v1h-1V2h1zm-2 0v1h-1V2h1zm8 0v1h-1V2h1zm-10 0v1h-1V2h1z"/><path d="M18.095 2H1.905C.853 2 0 2.895 0 4v12c0 1.105.853 2 1.905 2h16.19C19.147 18 20 17.105 20 16V4c0-1.105-.853-2-1.905-2zm0 1.5c.263 0 .476.224.476.5v12c0 .276-.213.5-.476.5H1.905a.489.489 0 0 1-.476-.5V4c0-.276.213-.5.476-.5h16.19z"/></svg>',M0='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M2.5 17v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zM1 15.5v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm0-2v1h-1v-1h1zm-19 0v1H0v-1h1zM14.5 2v1h-1V2h1zm2 0v1h-1V2h1zm2 0v1h-1V2h1zm-8 0v1h-1V2h1zm-2 0v1h-1V2h1zm-2 0v1h-1V2h1zm-2 0v1h-1V2h1zm8 0v1h-1V2h1zm-10 0v1h-1V2h1z"/><path d="M13 6H2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2zm0 1.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5V8a.5.5 0 0 1 .5-.5h11z"/></svg>',V0='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M2.5 17v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zM1 15.5v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm0-2v1h-1v-1h1zm-19 0v1H0v-1h1zM14.5 2v1h-1V2h1zm2 0v1h-1V2h1zm2 0v1h-1V2h1zm-8 0v1h-1V2h1zm-2 0v1h-1V2h1zm-2 0v1h-1V2h1zm-2 0v1h-1V2h1zm8 0v1h-1V2h1zm-10 0v1h-1V2h1z"/><path d="M7 10H2a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h5a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2zm0 1.5a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5v-4a.5.5 0 0 1 .5-.5h5z"/></svg>',O0='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M2.5 17v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zM1 15.5v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm0-2v1h-1v-1h1zm-19 0v1H0v-1h1zM14.5 2v1h-1V2h1zm2 0v1h-1V2h1zm2 0v1h-1V2h1zm-8 0v1h-1V2h1zm-2 0v1h-1V2h1zm-2 0v1h-1V2h1zm-2 0v1h-1V2h1zm8 0v1h-1V2h1zm-10 0v1h-1V2h1z"/><path d="M10 8H2a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-6a2 2 0 0 0-2-2zm0 1.5a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5v-6a.5.5 0 0 1 .5-.5h8z"/></svg>',N0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m7.3 17.37-.061.088a1.518 1.518 0 0 1-.934.535l-4.178.663-.806-4.153a1.495 1.495 0 0 1 .187-1.058l.056-.086L8.77 2.639c.958-1.351 2.803-1.076 4.296-.03 1.497 1.047 2.387 2.693 1.433 4.055L7.3 17.37zM9.14 4.728l-5.545 8.346 3.277 2.294 5.544-8.346L9.14 4.728zM6.07 16.512l-3.276-2.295.53 2.73 2.746-.435zM9.994 3.506 13.271 5.8c.316-.452-.16-1.333-1.065-1.966-.905-.634-1.895-.78-2.212-.328zM8 18.5 9.375 17H19v1.5H8z"/></svg>',D0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6.999 2H15a1 1 0 0 1 0 2h-1.004v13a1 1 0 1 1-2 0V4H8.999v13a1 1 0 1 1-2 0v-7A4 4 0 0 1 3 6a4 4 0 0 1 3.999-4z"/></svg>',B0='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 10.423a6.5 6.5 0 0 1 6.056-6.408l.038.67C6.448 5.423 5.354 7.663 5.22 10H9c.552 0 .5.432.5.986v4.511c0 .554-.448.503-1 .503h-5c-.552 0-.5-.449-.5-1.003v-4.574zm8 0a6.5 6.5 0 0 1 6.056-6.408l.038.67c-2.646.739-3.74 2.979-3.873 5.315H17c.552 0 .5.432.5.986v4.511c0 .554-.448.503-1 .503h-5c-.552 0-.5-.449-.5-1.003v-4.574z"/></svg>',Nc='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><circle cx="9.5" cy="4.5" r="1.5"/><circle cx="9.5" cy="10.5" r="1.5"/><circle cx="9.5" cy="16.5" r="1.5"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const fe={cancel:u0,caption:d0,check:h0,cog:f0,eraser:m0,lowVision:g0,image:p0,alignBottom:w0,alignMiddle:b0,alignTop:_0,alignLeft:v0,alignCenter:y0,alignRight:C0,alignJustify:E0,objectLeft:x0,objectCenter:k0,objectRight:I0,objectFullWidth:S0,objectInline:P0,objectBlockLeft:T0,objectBlockRight:A0,objectSizeFull:R0,objectSizeLarge:M0,objectSizeSmall:V0,objectSizeMedium:O0,pencil:N0,pilcrow:D0,quote:B0,threeVerticalDots:Nc};/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Zs({emitter:i,activator:e,callback:t,contextElements:n}){i.listenTo(document,"mousedown",(s,o)=>{if(!e())return;const r=typeof o.composedPath=="function"?o.composedPath():[];for(const a of n)if(a.contains(o.target)||r.includes(a))return;t()})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function eo(i){i.set("_isCssTransitionsDisabled",!1),i.disableCssTransitions=()=>{i._isCssTransitionsDisabled=!0},i.enableCssTransitions=()=>{i._isCssTransitionsDisabled=!1},i.extendTemplate({attributes:{class:[i.bindTemplate.if("_isCssTransitionsDisabled","ck-transitions-disabled")]}})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function to({view:i}){i.listenTo(i.element,"submit",(e,t)=>{t.preventDefault(),i.fire("submit")},{useCapture:!0})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Mt extends _e{constructor(e=[]){super(e,{idProperty:"viewUid"});this.on("add",(t,n,s)=>{this._renderViewIntoCollectionParent(n,s)}),this.on("remove",(t,n)=>{n.element&&this._parentElement&&n.element.remove()}),this._parentElement=null}destroy(){this.map(e=>e.destroy())}setParent(e){this._parentElement=e;for(const t of this)this._renderViewIntoCollectionParent(t)}delegate(...e){if(!e.length||!F0(e))throw new f("ui-viewcollection-delegate-wrong-events",this);return{to:t=>{for(const n of this)for(const s of e)n.delegate(s).to(t);this.on("add",(n,s)=>{for(const o of e)s.delegate(o).to(t)}),this.on("remove",(n,s)=>{for(const o of e)s.stopDelegating(o,t)})}}}_renderViewIntoCollectionParent(e,t){e.isRendered||e.render(),e.element&&this._parentElement&&this._parentElement.insertBefore(e.element,this._parentElement.children[t])}}function F0(i){return i.every(e=>typeof e=="string")}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class M{constructor(e){this.element=null,this.isRendered=!1,this.locale=e,this.t=e&&e.t,this._viewCollections=new _e,this._unboundChildren=this.createCollection(),this._viewCollections.on("add",(t,n)=>{n.locale=e}),this.decorate("render")}get bindTemplate(){return this._bindTemplate?this._bindTemplate:this._bindTemplate=Oe.bind(this,this)}createCollection(e){const t=new Mt(e);return this._viewCollections.add(t),t}registerChild(e){Te(e)||(e=[e]);for(const t of e)this._unboundChildren.add(t)}deregisterChild(e){Te(e)||(e=[e]);for(const t of e)this._unboundChildren.remove(t)}setTemplate(e){this.template=new Oe(e)}extendTemplate(e){Oe.extend(this.template,e)}render(){if(this.isRendered)throw new f("ui-view-render-already-rendered",this);this.template&&(this.element=this.template.render(),this.registerChild(this.template.getViews())),this.isRendered=!0}destroy(){this.stopListening(),this._viewCollections.map(e=>e.destroy()),this.template&&this.template._revertData&&this.template.revert(this.element)}}A(M,jt);A(M,$);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const L0="http://www.w3.org/1999/xhtml";class Oe{constructor(e){Object.assign(this,Lc(Fc(e))),this._isRendered=!1,this._revertData=null}render(){const e=this._renderNode({intoFragment:!0});return this._isRendered=!0,e}apply(e){return this._revertData=Uc(),this._renderNode({node:e,isApplying:!0,revertData:this._revertData}),e}revert(e){if(!this._revertData)throw new f("ui-template-revert-not-applied",[this,e]);this._revertTemplateFromNode(e,this._revertData)}*getViews(){function*e(t){if(t.children)for(const n of t.children)pi(n)?yield n:no(n)&&(yield*e(n))}yield*e(this)}static bind(e,t){return{to(n,s){return new z0({eventNameOrFunction:n,attribute:n,observable:e,emitter:t,callback:s})},if(n,s,o){return new Dc({observable:e,emitter:t,attribute:n,valueIfTrue:s,callback:o})}}}static extend(e,t){if(e._isRendered)throw new f("template-extend-render",[this,e]);Wc(e,Lc(Fc(t)))}_renderNode(e){let t;if(e.node?t=this.tag&&this.text:t=this.tag?this.text:!this.text,t)throw new f("ui-template-wrong-syntax",this);return this.text?this._renderText(e):this._renderElement(e)}_renderElement(e){let t=e.node;return t||(t=e.node=document.createElementNS(this.ns||L0,this.tag)),this._renderAttributes(e),this._renderElementChildren(e),this._setUpListeners(e),t}_renderText(e){let t=e.node;return t?e.revertData.text=t.textContent:t=e.node=document.createTextNode(""),gi(this.text)?this._bindToObservable({schema:this.text,updater:$0(t),data:e}):t.textContent=this.text.join(""),t}_renderAttributes(e){let t,n,s,o;if(!this.attributes)return;const r=e.node,a=e.revertData;for(t in this.attributes)if(s=r.getAttribute(t),n=this.attributes[t],a&&(a.attributes[t]=s),o=Z(n[0])&&n[0].ns?n[0].ns:null,gi(n)){const l=o?n[0].value:n;a&&qc(t)&&l.unshift(s),this._bindToObservable({schema:l,updater:W0(r,t,o),data:e})}else t=="style"&&typeof n[0]!="string"?this._renderStyleAttribute(n[0],e):(a&&s&&qc(t)&&n.unshift(s),n=n.map(l=>l&&(l.value||l)).reduce((l,c)=>l.concat(c),[]).reduce(Hc,""),Qt(n)||r.setAttributeNS(o,t,n))}_renderStyleAttribute(e,t){const n=t.node;for(const s in e){const o=e[s];gi(o)?this._bindToObservable({schema:[o],updater:U0(n,s),data:t}):n.style[s]=o}}_renderElementChildren(e){const t=e.node,n=e.intoFragment?document.createDocumentFragment():t,s=e.isApplying;let o=0;for(const r of this.children)if(io(r)){if(!s){r.setParent(t);for(const a of r)n.appendChild(a.element)}}else if(pi(r))s||(r.isRendered||r.render(),n.appendChild(r.element));else if(qt(r))n.appendChild(r);else if(s){const a=e.revertData,l=Uc();a.children.push(l),r._renderNode({node:n.childNodes[o++],isApplying:!0,revertData:l})}else n.appendChild(r.render());e.intoFragment&&t.appendChild(n)}_setUpListeners(e){if(!!this.eventListeners)for(const t in this.eventListeners){const n=this.eventListeners[t].map(s=>{const[o,r]=t.split("@");return s.activateDomEventListener(o,r,e)});e.revertData&&e.revertData.bindings.push(n)}}_bindToObservable({schema:e,updater:t,data:n}){const s=n.revertData;Bc(e,t,n);const o=e.filter(r=>!Qt(r)).filter(r=>r.observable).map(r=>r.activateAttributeListener(e,t,n));s&&s.bindings.push(o)}_revertTemplateFromNode(e,t){for(const n of t.bindings)for(const s of n)s();if(t.text){e.textContent=t.text;return}for(const n in t.attributes){const s=t.attributes[n];s===null?e.removeAttribute(n):e.setAttribute(n,s)}for(let n=0;n<t.children.length;++n)this._revertTemplateFromNode(e.childNodes[n],t.children[n])}}A(Oe,H);class On{constructor(e){Object.assign(this,e)}getValue(e){const t=this.observable[this.attribute];return this.callback?this.callback(t,e):t}activateAttributeListener(e,t,n){const s=()=>Bc(e,t,n);return this.emitter.listenTo(this.observable,"change:"+this.attribute,s),()=>{this.emitter.stopListening(this.observable,"change:"+this.attribute,s)}}}class z0 extends On{activateDomEventListener(e,t,n){const s=(o,r)=>{(!t||r.target.matches(t))&&(typeof this.eventNameOrFunction=="function"?this.eventNameOrFunction(r):this.observable.fire(this.eventNameOrFunction,r))};return this.emitter.listenTo(n.node,e,s),()=>{this.emitter.stopListening(n.node,e,s)}}}class Dc extends On{getValue(e){const t=super.getValue(e);return Qt(t)?!1:this.valueIfTrue||!0}}function gi(i){return i?(i.value&&(i=i.value),Array.isArray(i)?i.some(gi):i instanceof On):!1}function H0(i,e){return i.map(t=>t instanceof On?t.getValue(e):t)}function Bc(i,e,{node:t}){let n=H0(i,t);i.length==1&&i[0]instanceof Dc?n=n[0]:n=n.reduce(Hc,""),Qt(n)?e.remove():e.set(n)}function $0(i){return{set(e){i.textContent=e},remove(){i.textContent=""}}}function W0(i,e,t){return{set(n){i.setAttributeNS(t,e,n)},remove(){i.removeAttributeNS(t,e)}}}function U0(i,e){return{set(t){i.style[e]=t},remove(){i.style[e]=null}}}function Fc(i){return Sa(i,t=>{if(t&&(t instanceof On||no(t)||pi(t)||io(t)))return t})}function Lc(i){if(typeof i=="string"?i=K0(i):i.text&&G0(i),i.on&&(i.eventListeners=j0(i.on),delete i.on),!i.text){i.attributes&&q0(i.attributes);const e=[];if(i.children)if(io(i.children))e.push(i.children);else for(const t of i.children)no(t)||pi(t)||qt(t)?e.push(t):e.push(new Oe(t));i.children=e}return i}function q0(i){for(const e in i)i[e].value&&(i[e].value=oe(i[e].value)),zc(i,e)}function j0(i){for(const e in i)zc(i,e);return i}function K0(i){return{text:[i]}}function G0(i){i.text=oe(i.text)}function zc(i,e){i[e]=oe(i[e])}function Hc(i,e){return Qt(e)?i:Qt(i)?e:`${i} ${e}`}function $c(i,e){for(const t in e)i[t]?i[t].push(...e[t]):i[t]=e[t]}function Wc(i,e){if(e.attributes&&(i.attributes||(i.attributes={}),$c(i.attributes,e.attributes)),e.eventListeners&&(i.eventListeners||(i.eventListeners={}),$c(i.eventListeners,e.eventListeners)),e.text&&i.text.push(...e.text),e.children&&e.children.length){if(i.children.length!=e.children.length)throw new f("ui-template-extend-children-mismatch",i);let t=0;for(const n of e.children)Wc(i.children[t++],n)}}function Qt(i){return!i&&i!==0}function pi(i){return i instanceof M}function no(i){return i instanceof Oe}function io(i){return i instanceof Mt}function Uc(){return{children:[],bindings:[],attributes:{}}}function qc(i){return i=="class"||i=="style"}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class J0 extends Mt{constructor(e,t=[]){super(t);this.locale=e}attachToDom(){this._bodyCollectionContainer=new Oe({tag:"div",attributes:{class:["ck","ck-reset_all","ck-body","ck-rounded-corners"],dir:this.locale.uiLanguageDirection},children:this}).render();let e=document.querySelector(".ck-body-wrapper");e||(e=Bs(document,"div",{class:"ck-body-wrapper"}),document.body.appendChild(e)),e.appendChild(this._bodyCollectionContainer)}detachFromDom(){super.destroy(),this._bodyCollectionContainer&&this._bodyCollectionContainer.remove();const e=document.querySelector(".ck-body-wrapper");e&&e.childElementCount==0&&e.remove()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class wi extends M{constructor(){super();const e=this.bindTemplate;this.set("content",""),this.set("viewBox","0 0 20 20"),this.set("fillColor",""),this.setTemplate({tag:"svg",ns:"http://www.w3.org/2000/svg",attributes:{class:["ck","ck-icon"],viewBox:e.to("viewBox")}})}render(){super.render(),this._updateXMLContent(),this._colorFillPaths(),this.on("change:content",()=>{this._updateXMLContent(),this._colorFillPaths()}),this.on("change:fillColor",()=>{this._colorFillPaths()})}_updateXMLContent(){if(this.content){const t=new DOMParser().parseFromString(this.content.trim(),"image/svg+xml").querySelector("svg"),n=t.getAttribute("viewBox");for(n&&(this.viewBox=n),this.element.innerHTML="";t.childNodes.length>0;)this.element.appendChild(t.childNodes[0])}}_colorFillPaths(){this.fillColor&&this.element.querySelectorAll(".ck-icon__fill").forEach(e=>{e.style.fill=this.fillColor})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class jc extends M{constructor(e){super(e);this.set("text",""),this.set("position","s");const t=this.bindTemplate;this.setTemplate({tag:"span",attributes:{class:["ck","ck-tooltip",t.to("position",n=>"ck-tooltip_"+n),t.if("text","ck-hidden",n=>!n.trim())]},children:[{tag:"span",attributes:{class:["ck","ck-tooltip__text"]},children:[{text:t.to("text")}]}]})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class U extends M{constructor(e){super(e);const t=this.bindTemplate,n=Be();this.set("class"),this.set("labelStyle"),this.set("icon"),this.set("isEnabled",!0),this.set("isOn",!1),this.set("isVisible",!0),this.set("isToggleable",!1),this.set("keystroke"),this.set("label"),this.set("tabindex",-1),this.set("tooltip"),this.set("tooltipPosition","s"),this.set("type","button"),this.set("withText",!1),this.set("withKeystroke",!1),this.children=this.createCollection(),this.tooltipView=this._createTooltipView(),this.labelView=this._createLabelView(n),this.iconView=new wi,this.iconView.extendTemplate({attributes:{class:"ck-button__icon"}}),this.keystrokeView=this._createKeystrokeView(),this.bind("_tooltipString").to(this,"tooltip",this,"label",this,"keystroke",this._getTooltipString.bind(this)),this.setTemplate({tag:"button",attributes:{class:["ck","ck-button",t.to("class"),t.if("isEnabled","ck-disabled",s=>!s),t.if("isVisible","ck-hidden",s=>!s),t.to("isOn",s=>s?"ck-on":"ck-off"),t.if("withText","ck-button_with-text"),t.if("withKeystroke","ck-button_with-keystroke")],type:t.to("type",s=>s||"button"),tabindex:t.to("tabindex"),"aria-labelledby":`ck-editor__aria-label_${n}`,"aria-disabled":t.if("isEnabled",!0,s=>!s),"aria-pressed":t.to("isOn",s=>this.isToggleable?String(s):!1)},children:this.children,on:{mousedown:t.to(s=>{s.preventDefault()}),click:t.to(s=>{this.isEnabled?this.fire("execute"):s.preventDefault()})}})}render(){super.render(),this.icon&&(this.iconView.bind("content").to(this,"icon"),this.children.add(this.iconView)),this.children.add(this.tooltipView),this.children.add(this.labelView),this.withKeystroke&&this.keystroke&&this.children.add(this.keystrokeView)}focus(){this.element.focus()}_createTooltipView(){const e=new jc;return e.bind("text").to(this,"_tooltipString"),e.bind("position").to(this,"tooltipPosition"),e}_createLabelView(e){const t=new M,n=this.bindTemplate;return t.setTemplate({tag:"span",attributes:{class:["ck","ck-button__label"],style:n.to("labelStyle"),id:`ck-editor__aria-label_${e}`},children:[{text:this.bindTemplate.to("label")}]}),t}_createKeystrokeView(){const e=new M;return e.setTemplate({tag:"span",attributes:{class:["ck","ck-button__keystroke"]},children:[{text:this.bindTemplate.to("keystroke",t=>il(t))}]}),e}_getTooltipString(e,t,n){return e?typeof e=="string"?e:(n&&(n=il(n)),e instanceof Function?e(t,n):`${t}${n?` (${n})`:""}`):""}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class so extends U{constructor(e){super(e);this.isToggleable=!0,this.toggleSwitchView=this._createToggleView(),this.extendTemplate({attributes:{class:"ck-switchbutton"}})}render(){super.render(),this.children.add(this.toggleSwitchView)}_createToggleView(){const e=new M;return e.setTemplate({tag:"span",attributes:{class:["ck","ck-button__toggle"]},children:[{tag:"span",attributes:{class:["ck","ck-button__toggle__inner"]}}]}),e}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Yt{constructor(e){if(Object.assign(this,e),e.actions&&e.keystrokeHandler)for(const t in e.actions){let n=e.actions[t];typeof n=="string"&&(n=[n]);for(const s of n)e.keystrokeHandler.set(s,(o,r)=>{this[t](),r()})}}get first(){return this.focusables.find(oo)||null}get last(){return this.focusables.filter(oo).slice(-1)[0]||null}get next(){return this._getFocusableItem(1)}get previous(){return this._getFocusableItem(-1)}get current(){let e=null;return this.focusTracker.focusedElement===null?null:(this.focusables.find((t,n)=>{const s=t.element===this.focusTracker.focusedElement;return s&&(e=n),s}),e)}focusFirst(){this._focus(this.first)}focusLast(){this._focus(this.last)}focusNext(){this._focus(this.next)}focusPrevious(){this._focus(this.previous)}_focus(e){e&&e.focus()}_getFocusableItem(e){const t=this.current,n=this.focusables.length;if(!n)return null;if(t===null)return this[e===1?"first":"last"];let s=(t+n+e)%n;do{const o=this.focusables.get(s);if(oo(o))return o;s=(s+n+e)%n}while(s!==t);return null}}function oo(i){return!!(i.focus&&ee.window.getComputedStyle(i.element).display!="none")}var Kc='<svg viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M.941 4.523a.75.75 0 1 1 1.06-1.06l3.006 3.005 3.005-3.005a.75.75 0 1 1 1.06 1.06l-3.549 3.55a.75.75 0 0 1-1.168-.136L.941 4.523z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ro extends U{constructor(e){super(e);this.arrowView=this._createArrowView(),this.extendTemplate({attributes:{"aria-haspopup":!0}}),this.delegate("execute").to(this,"open")}render(){super.render(),this.children.add(this.arrowView)}_createArrowView(){const e=new wi;return e.content=Kc,e.extendTemplate({attributes:{class:"ck-dropdown__arrow"}}),e}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Gc extends M{constructor(e){super(e);const t=this.bindTemplate;this.set("class"),this.set("icon"),this.set("isEnabled",!0),this.set("isOn",!1),this.set("isToggleable",!1),this.set("isVisible",!0),this.set("keystroke"),this.set("label"),this.set("tabindex",-1),this.set("tooltip"),this.set("tooltipPosition","s"),this.set("type","button"),this.set("withText",!1),this.children=this.createCollection(),this.actionView=this._createActionView(),this.arrowView=this._createArrowView(),this.keystrokes=new et,this.focusTracker=new Ae,this.setTemplate({tag:"div",attributes:{class:["ck","ck-splitbutton",t.to("class"),t.if("isVisible","ck-hidden",n=>!n),this.arrowView.bindTemplate.if("isOn","ck-splitbutton_open")]},children:this.children})}render(){super.render(),this.children.add(this.actionView),this.children.add(this.arrowView),this.focusTracker.add(this.actionView.element),this.focusTracker.add(this.arrowView.element),this.keystrokes.listenTo(this.element),this.keystrokes.set("arrowright",(e,t)=>{this.focusTracker.focusedElement===this.actionView.element&&(this.arrowView.focus(),t())}),this.keystrokes.set("arrowleft",(e,t)=>{this.focusTracker.focusedElement===this.arrowView.element&&(this.actionView.focus(),t())})}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this.actionView.focus()}_createActionView(){const e=new U;return e.bind("icon","isEnabled","isOn","isToggleable","keystroke","label","tabindex","tooltip","tooltipPosition","type","withText").to(this),e.extendTemplate({attributes:{class:"ck-splitbutton__action"}}),e.delegate("execute").to(this),e}_createArrowView(){const e=new U,t=e.bindTemplate;return e.icon=Kc,e.extendTemplate({attributes:{class:"ck-splitbutton__arrow","aria-haspopup":!0,"aria-expanded":t.to("isOn",n=>String(n))}}),e.bind("isEnabled").to(this),e.delegate("execute").to(this,"open"),e}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Q0 extends M{constructor(e){super(e);const t=this.bindTemplate;this.set("isVisible",!1),this.set("position","se"),this.children=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-dropdown__panel",t.to("position",n=>`ck-dropdown__panel_${n}`),t.if("isVisible","ck-dropdown__panel-visible")]},children:this.children,on:{selectstart:t.to(n=>n.preventDefault())}})}focus(){this.children.length&&this.children.first.focus()}focusLast(){if(this.children.length){const e=this.children.last;typeof e.focusLast=="function"?e.focusLast():e.focus()}}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Y0(i){return!i||!i.parentNode||i.offsetParent===ee.document.body?null:i.offsetParent}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Jc({element:i,target:e,positions:t,limiter:n,fitInViewport:s,viewportOffsetConfig:o}){pn(e)&&(e=e()),pn(n)&&(n=n());const r=Y0(i),a=new F(i),l=new F(e);let c;const u={targetRect:l,elementRect:a,positionedElementAncestor:r};if(!n&&!s)c=new ao(t[0],u);else{const d=n&&new F(n).getVisible(),h=s&&X0(o);Object.assign(u,{limiterRect:d,viewportRect:h}),c=Z0(t,u)||new ao(t[0],u)}return c}function X0(i){i=Object.assign({top:0,bottom:0,left:0,right:0},i);const e=new F(ee.window);return e.top+=i.top,e.height-=i.top,e.bottom-=i.bottom,e.height-=i.bottom,e}function Z0(i,e){const{elementRect:t}=e,n=t.getArea(),s=i.map(a=>new ao(a,e)).filter(a=>!!a.name);let o=0,r=null;for(const a of s){const{_limiterIntersectionArea:l,_viewportIntersectionArea:c}=a;if(l===n)return a;const u=c**2+l**2;u>o&&(o=u,r=a)}return r}function eC(i,e){const t=Qc(new F(e)),n=Pl(e);let s=0,o=0;s-=t.left,o-=t.top,s+=e.scrollLeft,o+=e.scrollTop,s-=n.left,o-=n.top,i.moveBy(s,o)}function Qc(i){const{scrollX:e,scrollY:t}=ee.window;return i.clone().moveBy(e,t)}class ao{constructor(e,t){const n=e(t.targetRect,t.elementRect,t.viewportRect);if(!n)return;const{left:s,top:o,name:r,config:a}=n;Object.assign(this,{name:r,config:a}),this._positioningFunctionCorrdinates={left:s,top:o},this._options=t}get left(){return this._absoluteRect.left}get top(){return this._absoluteRect.top}get _limiterIntersectionArea(){const e=this._options.limiterRect;if(e){const t=this._options.viewportRect;if(t){const n=e.getIntersection(t);if(n)return n.getIntersectionArea(this._rect)}else return e.getIntersectionArea(this._rect)}return 0}get _viewportIntersectionArea(){const e=this._options.viewportRect;return e?e.getIntersectionArea(this._rect):0}get _rect(){return this._cachedRect?this._cachedRect:(this._cachedRect=this._options.elementRect.clone().moveTo(this._positioningFunctionCorrdinates.left,this._positioningFunctionCorrdinates.top),this._cachedRect)}get _absoluteRect(){return this._cachedAbsoluteRect?this._cachedAbsoluteRect:(this._cachedAbsoluteRect=Qc(this._rect),this._options.positionedElementAncestor&&eC(this._cachedAbsoluteRect,this._options.positionedElementAncestor),this._cachedAbsoluteRect)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Xt extends M{constructor(e,t,n){super(e);const s=this.bindTemplate;this.buttonView=t,this.panelView=n,this.set("isOpen",!1),this.set("isEnabled",!0),this.set("class"),this.set("id"),this.set("panelPosition","auto"),this.keystrokes=new et,this.setTemplate({tag:"div",attributes:{class:["ck","ck-dropdown",s.to("class"),s.if("isEnabled","ck-disabled",o=>!o)],id:s.to("id"),"aria-describedby":s.to("ariaDescribedById")},children:[t,n]}),t.extendTemplate({attributes:{class:["ck-dropdown__button"]}})}render(){super.render(),this.listenTo(this.buttonView,"open",()=>{this.isOpen=!this.isOpen}),this.panelView.bind("isVisible").to(this,"isOpen"),this.on("change:isOpen",()=>{!this.isOpen||(this.panelPosition==="auto"?this.panelView.position=Xt._getOptimalPosition({element:this.panelView.element,target:this.buttonView.element,fitInViewport:!0,positions:this._panelPositions}).name:this.panelView.position=this.panelPosition)}),this.keystrokes.listenTo(this.element);const e=(t,n)=>{this.isOpen&&(this.buttonView.focus(),this.isOpen=!1,n())};this.keystrokes.set("arrowdown",(t,n)=>{this.buttonView.isEnabled&&!this.isOpen&&(this.isOpen=!0,n())}),this.keystrokes.set("arrowright",(t,n)=>{this.isOpen&&n()}),this.keystrokes.set("arrowleft",e),this.keystrokes.set("esc",e)}focus(){this.buttonView.focus()}get _panelPositions(){const{south:e,north:t,southEast:n,southWest:s,northEast:o,northWest:r,southMiddleEast:a,southMiddleWest:l,northMiddleEast:c,northMiddleWest:u}=Xt.defaultPanelPositions;return this.locale.uiLanguageDirection!=="rtl"?[n,s,a,l,e,o,r,c,u,t]:[s,n,l,a,e,r,o,u,c,t]}}Xt.defaultPanelPositions={south:(i,e)=>({top:i.bottom,left:i.left-(e.width-i.width)/2,name:"s"}),southEast:i=>({top:i.bottom,left:i.left,name:"se"}),southWest:(i,e)=>({top:i.bottom,left:i.left-e.width+i.width,name:"sw"}),southMiddleEast:(i,e)=>({top:i.bottom,left:i.left-(e.width-i.width)/4,name:"sme"}),southMiddleWest:(i,e)=>({top:i.bottom,left:i.left-(e.width-i.width)*3/4,name:"smw"}),north:(i,e)=>({top:i.top-e.height,left:i.left-(e.width-i.width)/2,name:"n"}),northEast:(i,e)=>({top:i.top-e.height,left:i.left,name:"ne"}),northWest:(i,e)=>({top:i.top-e.height,left:i.left-e.width+i.width,name:"nw"}),northMiddleEast:(i,e)=>({top:i.top-e.height,left:i.left-(e.width-i.width)/4,name:"nme"}),northMiddleWest:(i,e)=>({top:i.top-e.height,left:i.left-(e.width-i.width)*3/4,name:"nmw"})};Xt._getOptimalPosition=Jc;/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Yc extends M{constructor(e){super(e);this.setTemplate({tag:"span",attributes:{class:["ck","ck-toolbar__separator"]}})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class tC extends M{constructor(e){super(e);this.setTemplate({tag:"span",attributes:{class:["ck","ck-toolbar__line-break"]}})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function nC(i){return i.bindTemplate.to(e=>{e.target===i.element&&e.preventDefault()})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function iC(i){return Array.isArray(i)?{items:i,removeItems:[]}:i?Object.assign({items:[],removeItems:[]},i):{items:[],removeItems:[]}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class lo extends M{constructor(e,t){super(e);const n=this.bindTemplate,s=this.t;this.options=t||{},this.set("ariaLabel",s("Editor toolbar")),this.set("maxWidth","auto"),this.items=this.createCollection(),this.focusTracker=new Ae,this.keystrokes=new et,this.set("class"),this.set("isCompact",!1),this.itemsView=new sC(e),this.children=this.createCollection(),this.children.add(this.itemsView),this.focusables=this.createCollection();const o=e.uiLanguageDirection==="rtl";this._focusCycler=new Yt({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:[o?"arrowright":"arrowleft","arrowup"],focusNext:[o?"arrowleft":"arrowright","arrowdown"]}});const r=["ck","ck-toolbar",n.to("class"),n.if("isCompact","ck-toolbar_compact")];this.options.shouldGroupWhenFull&&this.options.isFloating&&r.push("ck-toolbar_floating"),this.setTemplate({tag:"div",attributes:{class:r,role:"toolbar","aria-label":n.to("ariaLabel"),style:{maxWidth:n.to("maxWidth")}},children:this.children,on:{mousedown:nC(this)}}),this._behavior=this.options.shouldGroupWhenFull?new rC(this):new oC(this)}render(){super.render();for(const e of this.items)this.focusTracker.add(e.element);this.items.on("add",(e,t)=>{this.focusTracker.add(t.element)}),this.items.on("remove",(e,t)=>{this.focusTracker.remove(t.element)}),this.keystrokes.listenTo(this.element),this._behavior.render(this)}destroy(){return this._behavior.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy(),super.destroy()}focus(){this._focusCycler.focusFirst()}focusLast(){this._focusCycler.focusLast()}fillFromConfig(e,t){const n=iC(e),s=n.items.filter((r,a,l)=>r==="|"?!0:n.removeItems.indexOf(r)!==-1?!1:r==="-"?this.options.shouldGroupWhenFull?(de("toolbarview-line-break-ignored-when-grouping-items",l),!1):!0:t.has(r)?!0:(de("toolbarview-item-unavailable",{name:r}),!1)),o=this._cleanSeparators(s).map(r=>r==="|"?new Yc:r==="-"?new tC:t.create(r));this.items.addMany(o)}_cleanSeparators(e){const t=r=>r!=="-"&&r!=="|",n=e.length,s=e.findIndex(t),o=n-e.slice().reverse().findIndex(t);return e.slice(s,o).filter((r,a,l)=>t(r)?!0:!(a>0&&l[a-1]===r))}}class sC extends M{constructor(e){super(e);this.children=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-toolbar__items"]},children:this.children})}}class oC{constructor(e){const t=e.bindTemplate;e.set("isVertical",!1),e.itemsView.children.bindTo(e.items).using(n=>n),e.focusables.bindTo(e.items).using(n=>n),e.extendTemplate({attributes:{class:[t.if("isVertical","ck-toolbar_vertical")]}})}render(){}destroy(){}}class rC{constructor(e){this.view=e,this.viewChildren=e.children,this.viewFocusables=e.focusables,this.viewItemsView=e.itemsView,this.viewFocusTracker=e.focusTracker,this.viewLocale=e.locale,this.ungroupedItems=e.createCollection(),this.groupedItems=e.createCollection(),this.groupedItemsDropdown=this._createGroupedItemsDropdown(),this.resizeObserver=null,this.cachedPadding=null,this.shouldUpdateGroupingOnNextResize=!1,e.itemsView.children.bindTo(this.ungroupedItems).using(t=>t),this.ungroupedItems.on("add",this._updateFocusCycleableItems.bind(this)),this.ungroupedItems.on("remove",this._updateFocusCycleableItems.bind(this)),e.children.on("add",this._updateFocusCycleableItems.bind(this)),e.children.on("remove",this._updateFocusCycleableItems.bind(this)),e.items.on("change",(t,n)=>{const s=n.index;for(const o of n.removed)s>=this.ungroupedItems.length?this.groupedItems.remove(o):this.ungroupedItems.remove(o);for(let o=s;o<s+n.added.length;o++){const r=n.added[o-s];o>this.ungroupedItems.length?this.groupedItems.add(r,o-this.ungroupedItems.length):this.ungroupedItems.add(r,o)}this._updateGrouping()}),e.extendTemplate({attributes:{class:["ck-toolbar_grouping"]}})}render(e){this.viewElement=e.element,this._enableGroupingOnResize(),this._enableGroupingOnMaxWidthChange(e)}destroy(){this.groupedItemsDropdown.destroy(),this.resizeObserver.destroy()}_updateGrouping(){if(!this.viewElement.ownerDocument.body.contains(this.viewElement))return;if(!this.viewElement.offsetParent){this.shouldUpdateGroupingOnNextResize=!0;return}const e=this.groupedItems.length;let t;for(;this._areItemsOverflowing;)this._groupLastItem(),t=!0;if(!t&&this.groupedItems.length){for(;this.groupedItems.length&&!this._areItemsOverflowing;)this._ungroupFirstItem();this._areItemsOverflowing&&this._groupLastItem()}this.groupedItems.length!==e&&this.view.fire("groupedItemsUpdate")}get _areItemsOverflowing(){if(!this.ungroupedItems.length)return!1;const e=this.viewElement,t=this.viewLocale.uiLanguageDirection,n=new F(e.lastChild),s=new F(e);if(!this.cachedPadding){const o=ee.window.getComputedStyle(e),r=t==="ltr"?"paddingRight":"paddingLeft";this.cachedPadding=Number.parseInt(o[r])}return t==="ltr"?n.right>s.right-this.cachedPadding:n.left<s.left+this.cachedPadding}_enableGroupingOnResize(){let e;this.resizeObserver=new Y(this.viewElement,t=>{(!e||e!==t.contentRect.width||this.shouldUpdateGroupingOnNextResize)&&(this.shouldUpdateGroupingOnNextResize=!1,this._updateGrouping(),e=t.contentRect.width)}),this._updateGrouping()}_enableGroupingOnMaxWidthChange(e){e.on("change:maxWidth",()=>{this._updateGrouping()})}_groupLastItem(){this.groupedItems.length||(this.viewChildren.add(new Yc),this.viewChildren.add(this.groupedItemsDropdown),this.viewFocusTracker.add(this.groupedItemsDropdown.element)),this.groupedItems.add(this.ungroupedItems.remove(this.ungroupedItems.last),0)}_ungroupFirstItem(){this.ungroupedItems.add(this.groupedItems.remove(this.groupedItems.first)),this.groupedItems.length||(this.viewChildren.remove(this.groupedItemsDropdown),this.viewChildren.remove(this.viewChildren.last),this.viewFocusTracker.remove(this.groupedItemsDropdown.element))}_createGroupedItemsDropdown(){const e=this.viewLocale,t=e.t,n=ht(e);return n.class="ck-toolbar__grouped-dropdown",n.panelPosition=e.uiLanguageDirection==="ltr"?"sw":"se",Xc(n,[]),n.buttonView.set({label:t("Show more items"),tooltip:!0,tooltipPosition:e.uiLanguageDirection==="rtl"?"se":"sw",icon:Nc}),n.toolbarView.items.bindTo(this.groupedItems).using(s=>s),n}_updateFocusCycleableItems(){this.viewFocusables.clear(),this.ungroupedItems.map(e=>{this.viewFocusables.add(e)}),this.groupedItems.length&&this.viewFocusables.add(this.groupedItemsDropdown)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class aC extends M{constructor(){super();this.items=this.createCollection(),this.focusTracker=new Ae,this.keystrokes=new et,this._focusCycler=new Yt({focusables:this.items,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"arrowup",focusNext:"arrowdown"}}),this.setTemplate({tag:"ul",attributes:{class:["ck","ck-reset","ck-list"]},children:this.items})}render(){super.render();for(const e of this.items)this.focusTracker.add(e.element);this.items.on("add",(e,t)=>{this.focusTracker.add(t.element)}),this.items.on("remove",(e,t)=>{this.focusTracker.remove(t.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}focusLast(){this._focusCycler.focusLast()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class lC extends M{constructor(e){super(e);this.children=this.createCollection(),this.setTemplate({tag:"li",attributes:{class:["ck","ck-list__item"]},children:this.children})}focus(){this.children.first.focus()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class cC extends M{constructor(e){super(e);this.setTemplate({tag:"li",attributes:{class:["ck","ck-list__separator"]}})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function ht(i,e=ro){const t=new e(i),n=new Q0(i),s=new Xt(i,t,n);return t.bind("isEnabled").to(s),t instanceof ro?t.bind("isOn").to(s,"isOpen"):t.arrowView.bind("isOn").to(s,"isOpen"),uC(s),s}function Xc(i,e){const t=i.locale,n=t.t,s=i.toolbarView=new lo(t);s.set("ariaLabel",n("Dropdown toolbar")),i.extendTemplate({attributes:{class:["ck-toolbar-dropdown"]}}),e.map(o=>s.items.add(o)),i.panelView.children.add(s),s.items.delegate("execute").to(i)}function co(i,e){const t=i.locale,n=i.listView=new aC(t);n.items.bindTo(e).using(({type:s,model:o})=>{if(s==="separator")return new cC(t);if(s==="button"||s==="switchbutton"){const r=new lC(t);let a;return s==="button"?a=new U(t):a=new so(t),a.bind(...Object.keys(o)).to(o),a.delegate("execute").to(r),r.children.add(a),r}}),i.panelView.children.add(n),n.items.delegate("execute").to(i)}function uC(i){dC(i),hC(i),fC(i)}function dC(i){i.on("render",()=>{Zs({emitter:i,activator:()=>i.isOpen,callback:()=>{i.isOpen=!1},contextElements:[i.element]})})}function hC(i){i.on("execute",e=>{e.source instanceof so||(i.isOpen=!1)})}function fC(i){i.keystrokes.set("arrowdown",(e,t)=>{i.isOpen&&(i.panelView.focus(),t())}),i.keystrokes.set("arrowup",(e,t)=>{i.isOpen&&(i.panelView.focusLast(),t())})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class mC extends M{constructor(e){super(e);this.body=new J0(e)}render(){super.render(),this.body.attachToDom()}destroy(){return this.body.detachFromDom(),super.destroy()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class gC extends M{constructor(e){super(e);this.set("text"),this.set("for"),this.id=`ck-editor__label_${Be()}`;const t=this.bindTemplate;this.setTemplate({tag:"label",attributes:{class:["ck","ck-label"],id:this.id,for:t.to("for")},children:[{text:t.to("text")}]})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class pC extends M{constructor(e,t,n){super(e);this.setTemplate({tag:"div",attributes:{class:["ck","ck-content","ck-editor__editable","ck-rounded-corners"],lang:e.contentLanguage,dir:e.contentLanguageDirection}}),this.name=null,this.set("isFocused",!1),this._editableElement=n,this._hasExternalElement=!!this._editableElement,this._editingView=t}render(){super.render(),this._hasExternalElement?this.template.apply(this.element=this._editableElement):this._editableElement=this.element,this.on("change:isFocused",()=>this._updateIsFocusedClasses()),this._updateIsFocusedClasses()}destroy(){this._hasExternalElement&&this.template.revert(this._editableElement),super.destroy()}_updateIsFocusedClasses(){const e=this._editingView;e.isRenderingInProgress?n(this):t(this);function t(s){e.change(o=>{const r=e.document.getRoot(s.name);o.addClass(s.isFocused?"ck-focused":"ck-blurred",r),o.removeClass(s.isFocused?"ck-blurred":"ck-focused",r)})}function n(s){e.once("change:isRenderingInProgress",(o,r,a)=>{a?n(s):t(s)})}}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class wC extends pC{constructor(e,t,n){super(e,t,n);this.extendTemplate({attributes:{role:"textbox",class:"ck-editor__editable_inline"}})}render(){super.render();const e=this._editingView,t=this.t;e.change(n=>{const s=e.document.getRoot(this.name);n.setAttribute("aria-label",t("Rich Text Editor, %0",this.name),s)})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class bC extends M{constructor(e){super(e);this.set("value"),this.set("id"),this.set("placeholder"),this.set("isReadOnly",!1),this.set("hasError",!1),this.set("ariaDescribedById"),this.focusTracker=new Ae,this.bind("isFocused").to(this.focusTracker),this.set("isEmpty",!0);const t=this.bindTemplate;this.setTemplate({tag:"input",attributes:{type:"text",class:["ck","ck-input","ck-input-text",t.if("isFocused","ck-input_focused"),t.if("isEmpty","ck-input-text_empty"),t.if("hasError","ck-error")],id:t.to("id"),placeholder:t.to("placeholder"),readonly:t.to("isReadOnly"),"aria-invalid":t.if("hasError",!0),"aria-describedby":t.to("ariaDescribedById")},on:{input:t.to((...n)=>{this.fire("input",...n),this._updateIsEmpty()}),change:t.to(this._updateIsEmpty.bind(this))}})}render(){super.render(),this.focusTracker.add(this.element),this._setDomElementValue(this.value),this._updateIsEmpty(),this.on("change:value",(e,t,n)=>{this._setDomElementValue(n),this._updateIsEmpty()})}destroy(){super.destroy(),this.focusTracker.destroy()}select(){this.element.select()}focus(){this.element.focus()}_updateIsEmpty(){this.isEmpty=_C(this.element)}_setDomElementValue(e){this.element.value=!e&&e!==0?"":e}}function _C(i){return!i.value}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class uo extends M{constructor(e,t){super(e);const n=`ck-labeled-field-view-${Be()}`,s=`ck-labeled-field-view-status-${Be()}`;this.fieldView=t(this,n,s),this.set("label"),this.set("isEnabled",!0),this.set("isEmpty",!0),this.set("isFocused",!1),this.set("errorText",null),this.set("infoText",null),this.set("class"),this.set("placeholder"),this.labelView=this._createLabelView(n),this.statusView=this._createStatusView(s),this.bind("_statusText").to(this,"errorText",this,"infoText",(r,a)=>r||a);const o=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck","ck-labeled-field-view",o.to("class"),o.if("isEnabled","ck-disabled",r=>!r),o.if("isEmpty","ck-labeled-field-view_empty"),o.if("isFocused","ck-labeled-field-view_focused"),o.if("placeholder","ck-labeled-field-view_placeholder"),o.if("errorText","ck-error")]},children:[{tag:"div",attributes:{class:["ck","ck-labeled-field-view__input-wrapper"]},children:[this.fieldView,this.labelView]},this.statusView]})}_createLabelView(e){const t=new gC(this.locale);return t.for=e,t.bind("text").to(this,"label"),t}_createStatusView(e){const t=new M(this.locale),n=this.bindTemplate;return t.setTemplate({tag:"div",attributes:{class:["ck","ck-labeled-field-view__status",n.if("errorText","ck-labeled-field-view__status_error"),n.if("_statusText","ck-hidden",s=>!s)],id:e,role:n.if("errorText","alert")},children:[{text:n.to("_statusText")}]}),t}focus(){this.fieldView.focus()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function ho(i,e,t){const n=new bC(i.locale);return n.set({id:e,ariaDescribedById:t}),n.bind("isReadOnly").to(i,"isEnabled",s=>!s),n.bind("hasError").to(i,"errorText",s=>!!s),n.on("input",()=>{i.errorText=null}),i.bind("isEmpty","isFocused","placeholder").to(n),n}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class fo extends Tn{static get pluginName(){return"Notification"}init(){this.on("show:warning",(e,t)=>{window.alert(t.message)},{priority:"lowest"})}showSuccess(e,t={}){this._showNotification({message:e,type:"success",namespace:t.namespace,title:t.title})}showInfo(e,t={}){this._showNotification({message:e,type:"info",namespace:t.namespace,title:t.title})}showWarning(e,t={}){this._showNotification({message:e,type:"warning",namespace:t.namespace,title:t.title})}_showNotification(e){const t=`show:${e.type}`+(e.namespace?`:${e.namespace}`:"");this.fire(t,{message:e.message,type:e.type,title:e.title||""})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class bi{constructor(e,t){t&&vn(this,t),e&&this.set(e)}}A(bi,$);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md.
 */const Zc=Vl("px"),eu=ee.document.body;class be extends M{constructor(e){super(e);const t=this.bindTemplate;this.set("top",0),this.set("left",0),this.set("position","arrow_nw"),this.set("isVisible",!1),this.set("withArrow",!0),this.set("class"),this.content=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-balloon-panel",t.to("position",n=>`ck-balloon-panel_${n}`),t.if("isVisible","ck-balloon-panel_visible"),t.if("withArrow","ck-balloon-panel_with-arrow"),t.to("class")],style:{top:t.to("top",Zc),left:t.to("left",Zc)}},children:this.content})}show(){this.isVisible=!0}hide(){this.isVisible=!1}attachTo(e){this.show();const t=be.defaultPositions,n=Object.assign({},{element:this.element,positions:[t.southArrowNorth,t.southArrowNorthMiddleWest,t.southArrowNorthMiddleEast,t.southArrowNorthWest,t.southArrowNorthEast,t.northArrowSouth,t.northArrowSouthMiddleWest,t.northArrowSouthMiddleEast,t.northArrowSouthWest,t.northArrowSouthEast,t.viewportStickyNorth],limiter:eu,fitInViewport:!0},e),s=be._getOptimalPosition(n),o=parseInt(s.left),r=parseInt(s.top),{name:a,config:l={}}=s,{withArrow:c=!0}=l;Object.assign(this,{top:r,left:o,position:a,withArrow:c})}pin(e){this.unpin(),this._pinWhenIsVisibleCallback=()=>{this.isVisible?this._startPinning(e):this._stopPinning()},this._startPinning(e),this.listenTo(this,"change:isVisible",this._pinWhenIsVisibleCallback)}unpin(){this._pinWhenIsVisibleCallback&&(this._stopPinning(),this.stopListening(this,"change:isVisible",this._pinWhenIsVisibleCallback),this._pinWhenIsVisibleCallback=null,this.hide())}_startPinning(e){this.attachTo(e);const t=mo(e.target),n=e.limiter?mo(e.limiter):eu;this.listenTo(ee.document,"scroll",(s,o)=>{const r=o.target,a=t&&r.contains(t),l=n&&r.contains(n);(a||l||!t||!n)&&this.attachTo(e)},{useCapture:!0}),this.listenTo(ee.window,"resize",()=>{this.attachTo(e)})}_stopPinning(){this.stopListening(ee.document,"scroll"),this.stopListening(ee.window,"resize")}}function mo(i){return Et(i)?i:ai(i)?i.commonAncestorContainer:typeof i=="function"?mo(i()):null}be.arrowHorizontalOffset=25;be.arrowVerticalOffset=10;be.stickyVerticalOffset=20;be._getOptimalPosition=Jc;be.defaultPositions=vC();function vC({horizontalOffset:i=be.arrowHorizontalOffset,verticalOffset:e=be.arrowVerticalOffset,stickyVerticalOffset:t=be.stickyVerticalOffset,config:n}={}){return{northWestArrowSouthWest:(r,a)=>x({top:s(r,a),left:r.left-i,name:"arrow_sw"},n&&{config:n}),northWestArrowSouthMiddleWest:(r,a)=>x({top:s(r,a),left:r.left-a.width*.25-i,name:"arrow_smw"},n&&{config:n}),northWestArrowSouth:(r,a)=>x({top:s(r,a),left:r.left-a.width/2,name:"arrow_s"},n&&{config:n}),northWestArrowSouthMiddleEast:(r,a)=>x({top:s(r,a),left:r.left-a.width*.75+i,name:"arrow_sme"},n&&{config:n}),northWestArrowSouthEast:(r,a)=>x({top:s(r,a),left:r.left-a.width+i,name:"arrow_se"},n&&{config:n}),northArrowSouthWest:(r,a)=>x({top:s(r,a),left:r.left+r.width/2-i,name:"arrow_sw"},n&&{config:n}),northArrowSouthMiddleWest:(r,a)=>x({top:s(r,a),left:r.left+r.width/2-a.width*.25-i,name:"arrow_smw"},n&&{config:n}),northArrowSouth:(r,a)=>x({top:s(r,a),left:r.left+r.width/2-a.width/2,name:"arrow_s"},n&&{config:n}),northArrowSouthMiddleEast:(r,a)=>x({top:s(r,a),left:r.left+r.width/2-a.width*.75+i,name:"arrow_sme"},n&&{config:n}),northArrowSouthEast:(r,a)=>x({top:s(r,a),left:r.left+r.width/2-a.width+i,name:"arrow_se"},n&&{config:n}),northEastArrowSouthWest:(r,a)=>x({top:s(r,a),left:r.right-i,name:"arrow_sw"},n&&{config:n}),northEastArrowSouthMiddleWest:(r,a)=>x({top:s(r,a),left:r.right-a.width*.25-i,name:"arrow_smw"},n&&{config:n}),northEastArrowSouth:(r,a)=>x({top:s(r,a),left:r.right-a.width/2,name:"arrow_s"},n&&{config:n}),northEastArrowSouthMiddleEast:(r,a)=>x({top:s(r,a),left:r.right-a.width*.75+i,name:"arrow_sme"},n&&{config:n}),northEastArrowSouthEast:(r,a)=>x({top:s(r,a),left:r.right-a.width+i,name:"arrow_se"},n&&{config:n}),southWestArrowNorthWest:(r,a)=>x({top:o(r),left:r.left-i,name:"arrow_nw"},n&&{config:n}),southWestArrowNorthMiddleWest:(r,a)=>x({top:o(r),left:r.left-a.width*.25-i,name:"arrow_nmw"},n&&{config:n}),southWestArrowNorth:(r,a)=>x({top:o(r),left:r.left-a.width/2,name:"arrow_n"},n&&{config:n}),southWestArrowNorthMiddleEast:(r,a)=>x({top:o(r),left:r.left-a.width*.75+i,name:"arrow_nme"},n&&{config:n}),southWestArrowNorthEast:(r,a)=>x({top:o(r),left:r.left-a.width+i,name:"arrow_ne"},n&&{config:n}),southArrowNorthWest:(r,a)=>x({top:o(r),left:r.left+r.width/2-i,name:"arrow_nw"},n&&{config:n}),southArrowNorthMiddleWest:(r,a)=>x({top:o(r),left:r.left+r.width/2-a.width*.25-i,name:"arrow_nmw"},n&&{config:n}),southArrowNorth:(r,a)=>x({top:o(r),left:r.left+r.width/2-a.width/2,name:"arrow_n"},n&&{config:n}),southArrowNorthMiddleEast:(r,a)=>x({top:o(r),left:r.left+r.width/2-a.width*.75+i,name:"arrow_nme"},n&&{config:n}),southArrowNorthEast:(r,a)=>x({top:o(r),left:r.left+r.width/2-a.width+i,name:"arrow_ne"},n&&{config:n}),southEastArrowNorthWest:(r,a)=>x({top:o(r),left:r.right-i,name:"arrow_nw"},n&&{config:n}),southEastArrowNorthMiddleWest:(r,a)=>x({top:o(r),left:r.right-a.width*.25-i,name:"arrow_nmw"},n&&{config:n}),southEastArrowNorth:(r,a)=>x({top:o(r),left:r.right-a.width/2,name:"arrow_n"},n&&{config:n}),southEastArrowNorthMiddleEast:(r,a)=>x({top:o(r),left:r.right-a.width*.75+i,name:"arrow_nme"},n&&{config:n}),southEastArrowNorthEast:(r,a)=>x({top:o(r),left:r.right-a.width+i,name:"arrow_ne"},n&&{config:n}),viewportStickyNorth:(r,a,l)=>r.getIntersection(l)?{top:l.top+t,left:r.left+r.width/2-a.width/2,name:"arrowless",config:x({withArrow:!1},n)}:null};function s(r,a){return r.top-a.height-e}function o(r){return r.bottom+e}}var yC='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M11.463 5.187a.888.888 0 1 1 1.254 1.255L9.16 10l3.557 3.557a.888.888 0 1 1-1.254 1.255L7.26 10.61a.888.888 0 0 1 .16-1.382l4.043-4.042z"/></svg>',CC='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M8.537 14.813a.888.888 0 1 1-1.254-1.255L10.84 10 7.283 6.442a.888.888 0 1 1 1.254-1.255L12.74 9.39a.888.888 0 0 1-.16 1.382l-4.043 4.042z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const _i=Vl("px");class vi extends v{static get pluginName(){return"ContextualBalloon"}constructor(e){super(e);this.positionLimiter=()=>{const t=this.editor.editing.view,s=t.document.selection.editableElement;return s?t.domConverter.mapViewToDom(s.root):null},this.set("visibleView",null),this.view=new be(e.locale),e.ui.view.body.add(this.view),e.ui.focusTracker.add(this.view.element),this._viewToStack=new Map,this._idToStack=new Map,this.set("_numberOfStacks",0),this.set("_singleViewMode",!1),this._rotatorView=this._createRotatorView(),this._fakePanelsView=this._createFakePanelsView()}destroy(){super.destroy(),this.view.destroy(),this._rotatorView.destroy(),this._fakePanelsView.destroy()}hasView(e){return Array.from(this._viewToStack.keys()).includes(e)}add(e){if(this.hasView(e.view))throw new f("contextualballoon-add-view-exist",[this,e]);const t=e.stackId||"main";if(!this._idToStack.has(t)){this._idToStack.set(t,new Map([[e.view,e]])),this._viewToStack.set(e.view,this._idToStack.get(t)),this._numberOfStacks=this._idToStack.size,(!this._visibleStack||e.singleViewMode)&&this.showStack(t);return}const n=this._idToStack.get(t);e.singleViewMode&&this.showStack(t),n.set(e.view,e),this._viewToStack.set(e.view,n),n===this._visibleStack&&this._showView(e)}remove(e){if(!this.hasView(e))throw new f("contextualballoon-remove-view-not-exist",[this,e]);const t=this._viewToStack.get(e);this._singleViewMode&&this.visibleView===e&&(this._singleViewMode=!1),this.visibleView===e&&(t.size===1?this._idToStack.size>1?this._showNextStack():(this.view.hide(),this.visibleView=null,this._rotatorView.hideView()):this._showView(Array.from(t.values())[t.size-2])),t.size===1?(this._idToStack.delete(this._getStackId(t)),this._numberOfStacks=this._idToStack.size):t.delete(e),this._viewToStack.delete(e)}updatePosition(e){e&&(this._visibleStack.get(this.visibleView).position=e),this.view.pin(this._getBalloonPosition()),this._fakePanelsView.updatePosition()}showStack(e){this.visibleStack=e;const t=this._idToStack.get(e);if(!t)throw new f("contextualballoon-showstack-stack-not-exist",this);this._visibleStack!==t&&this._showView(Array.from(t.values()).pop())}get _visibleStack(){return this._viewToStack.get(this.visibleView)}_getStackId(e){return Array.from(this._idToStack.entries()).find(n=>n[1]===e)[0]}_showNextStack(){const e=Array.from(this._idToStack.values());let t=e.indexOf(this._visibleStack)+1;e[t]||(t=0),this.showStack(this._getStackId(e[t]))}_showPrevStack(){const e=Array.from(this._idToStack.values());let t=e.indexOf(this._visibleStack)-1;e[t]||(t=e.length-1),this.showStack(this._getStackId(e[t]))}_createRotatorView(){const e=new EC(this.editor.locale),t=this.editor.locale.t;return this.view.content.add(e),e.bind("isNavigationVisible").to(this,"_numberOfStacks",this,"_singleViewMode",(n,s)=>!s&&n>1),e.on("change:isNavigationVisible",()=>this.updatePosition(),{priority:"low"}),e.bind("counter").to(this,"visibleView",this,"_numberOfStacks",(n,s)=>{if(s<2)return"";const o=Array.from(this._idToStack.values()).indexOf(this._visibleStack)+1;return t("%0 of %1",[o,s])}),e.buttonNextView.on("execute",()=>{e.focusTracker.isFocused&&this.editor.editing.view.focus(),this._showNextStack()}),e.buttonPrevView.on("execute",()=>{e.focusTracker.isFocused&&this.editor.editing.view.focus(),this._showPrevStack()}),e}_createFakePanelsView(){const e=new TC(this.editor.locale,this.view);return e.bind("numberOfPanels").to(this,"_numberOfStacks",this,"_singleViewMode",(t,n)=>!n&&t>=2?Math.min(t-1,2):0),e.listenTo(this.view,"change:top",()=>e.updatePosition()),e.listenTo(this.view,"change:left",()=>e.updatePosition()),this.editor.ui.view.body.add(e),e}_showView({view:e,balloonClassName:t="",withArrow:n=!0,singleViewMode:s=!1}){this.view.class=t,this.view.withArrow=n,this._rotatorView.showView(e),this.visibleView=e,this.view.pin(this._getBalloonPosition()),this._fakePanelsView.updatePosition(),s&&(this._singleViewMode=!0)}_getBalloonPosition(){let e=Array.from(this._visibleStack.values()).pop().position;return e&&(e.limiter||(e=Object.assign({},e,{limiter:this.positionLimiter})),e=Object.assign({},e,{viewportOffsetConfig:this.editor.ui.viewportOffset})),e}}class EC extends M{constructor(e){super(e);const t=e.t,n=this.bindTemplate;this.set("isNavigationVisible",!0),this.focusTracker=new Ae,this.buttonPrevView=this._createButtonView(t("Previous"),yC),this.buttonNextView=this._createButtonView(t("Next"),CC),this.content=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-balloon-rotator"],"z-index":"-1"},children:[{tag:"div",attributes:{class:["ck-balloon-rotator__navigation",n.to("isNavigationVisible",s=>s?"":"ck-hidden")]},children:[this.buttonPrevView,{tag:"span",attributes:{class:["ck-balloon-rotator__counter"]},children:[{text:n.to("counter")}]},this.buttonNextView]},{tag:"div",attributes:{class:"ck-balloon-rotator__content"},children:this.content}]})}render(){super.render(),this.focusTracker.add(this.element)}destroy(){super.destroy(),this.focusTracker.destroy()}showView(e){this.hideView(),this.content.add(e)}hideView(){this.content.clear()}_createButtonView(e,t){const n=new U(this.locale);return n.set({label:e,icon:t,tooltip:!0}),n}}class TC extends M{constructor(e,t){super(e);const n=this.bindTemplate;this.set("top",0),this.set("left",0),this.set("height",0),this.set("width",0),this.set("numberOfPanels",0),this.content=this.createCollection(),this._balloonPanelView=t,this.setTemplate({tag:"div",attributes:{class:["ck-fake-panel",n.to("numberOfPanels",s=>s?"":"ck-hidden")],style:{top:n.to("top",_i),left:n.to("left",_i),width:n.to("width",_i),height:n.to("height",_i)}},children:this.content}),this.on("change:numberOfPanels",(s,o,r,a)=>{r>a?this._addPanels(r-a):this._removePanels(a-r),this.updatePosition()})}_addPanels(e){for(;e--;){const t=new M;t.setTemplate({tag:"div"}),this.content.add(t),this.registerChild(t)}}_removePanels(e){for(;e--;){const t=this.content.last;this.content.remove(t),this.deregisterChild(t),t.destroy()}}updatePosition(){if(this.numberOfPanels){const{top:e,left:t}=this._balloonPanelView,{width:n,height:s}=new F(this._balloonPanelView.element);Object.assign(this,{top:e,left:t,width:n,height:s})}}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function kC({origin:i,originKeystrokeHandler:e,originFocusTracker:t,toolbar:n,beforeFocus:s,afterBlur:o}){t.add(n.element),e.set("Alt+F10",(r,a)=>{t.isFocused&&!n.focusTracker.isFocused&&(s&&s(),n.focus(),a())}),n.keystrokes.set("Esc",(r,a)=>{n.focusTracker.isFocused&&(i.focus(),o&&o(),a())})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const yi=new WeakMap;function tu(i){const{view:e,element:t,text:n,isDirectHost:s=!0,keepOnFocus:o=!1}=i,r=e.document;yi.has(r)||(yi.set(r,new Map),r.registerPostFixer(a=>nu(r,a))),yi.get(r).set(t,{text:n,isDirectHost:s,keepOnFocus:o,hostElement:s?t:null}),e.change(a=>nu(r,a))}function AC(i,e){return e.hasClass("ck-placeholder")?!1:(i.addClass("ck-placeholder",e),!0)}function SC(i,e){return e.hasClass("ck-placeholder")?(i.removeClass("ck-placeholder",e),!0):!1}function PC(i,e){if(!i.isAttached()||Array.from(i.getChildren()).some(r=>!r.is("uiElement")))return!1;if(e)return!0;const n=i.document;if(!n.isFocused)return!0;const o=n.selection.anchor;return o&&o.parent!==i}function nu(i,e){const t=yi.get(i),n=[];let s=!1;for(const[o,r]of t)r.isDirectHost&&(n.push(o),iu(e,o,r)&&(s=!0));for(const[o,r]of t){if(r.isDirectHost)continue;const a=xC(o);!a||n.includes(a)||(r.hostElement=a,iu(e,o,r)&&(s=!0))}return s}function iu(i,e,t){const{text:n,isDirectHost:s,hostElement:o}=t;let r=!1;return o.getAttribute("data-placeholder")!==n&&(i.setAttribute("data-placeholder",n,o),r=!0),(s||e.childCount==1)&&PC(o,t.keepOnFocus)?AC(i,o)&&(r=!0):SC(i,o)&&(r=!0),r}function xC(i){if(i.childCount){const e=i.getChild(0);if(e.is("element")&&!e.is("uiElement"))return e}return null}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const go=new Map;function O(i,e,t){let n=go.get(i);n||(n=new Map,go.set(i,n)),n.set(e,t)}function IC(i,e){const t=go.get(i);return t&&t.has(e)?t.get(e):RC}function RC(i){return[i]}function su(i,e,t={}){const n=IC(i.constructor,e.constructor);try{return i=i.clone(),n(i,e,t)}catch(s){throw s}}function MC(i,e,t){i=i.slice(),e=e.slice();const n=new VC(t.document,t.useRelations,t.forceWeakRemove);n.setOriginalOperations(i),n.setOriginalOperations(e);const s=n.originalOperations;if(i.length==0||e.length==0)return{operationsA:i,operationsB:e,originalOperations:s};const o=new WeakMap;for(const l of i)o.set(l,0);const r={nextBaseVersionA:i[i.length-1].baseVersion+1,nextBaseVersionB:e[e.length-1].baseVersion+1,originalOperationsACount:i.length,originalOperationsBCount:e.length};let a=0;for(;a<i.length;){const l=i[a],c=o.get(l);if(c==e.length){a++;continue}const u=e[c],d=su(l,u,n.getContext(l,u,!0)),h=su(u,l,n.getContext(u,l,!1));n.updateRelation(l,u),n.setOriginalOperations(d,l),n.setOriginalOperations(h,u);for(const m of d)o.set(m,c+h.length);i.splice(a,1,...d),e.splice(c,1,...h)}if(t.padWithNoOps){const l=i.length-r.originalOperationsACount,c=e.length-r.originalOperationsBCount;ru(i,c-l),ru(e,l-c)}return ou(i,r.nextBaseVersionB),ou(e,r.nextBaseVersionA),{operationsA:i,operationsB:e,originalOperations:s}}class VC{constructor(e,t,n=!1){this.originalOperations=new Map,this._history=e.history,this._useRelations=t,this._forceWeakRemove=!!n,this._relations=new Map}setOriginalOperations(e,t=null){const n=t?this.originalOperations.get(t):null;for(const s of e)this.originalOperations.set(s,n||s)}updateRelation(e,t){switch(e.constructor){case z:{switch(t.constructor){case ie:{e.targetPosition.isEqual(t.sourcePosition)||t.movedRange.containsPosition(e.targetPosition)?this._setRelation(e,t,"insertAtSource"):e.targetPosition.isEqual(t.deletionPosition)?this._setRelation(e,t,"insertBetween"):e.targetPosition.isAfter(t.sourcePosition)&&this._setRelation(e,t,"moveTargetAfter");break}case z:{e.targetPosition.isEqual(t.sourcePosition)||e.targetPosition.isBefore(t.sourcePosition)?this._setRelation(e,t,"insertBefore"):this._setRelation(e,t,"insertAfter");break}}break}case J:{switch(t.constructor){case ie:{e.splitPosition.isBefore(t.sourcePosition)&&this._setRelation(e,t,"splitBefore");break}case z:if(e.splitPosition.isEqual(t.sourcePosition)||e.splitPosition.isBefore(t.sourcePosition))this._setRelation(e,t,"splitBefore");else{const n=w._createFromPositionAndShift(t.sourcePosition,t.howMany);if(e.splitPosition.hasSameParentAs(t.sourcePosition)&&n.containsPosition(e.splitPosition)){const s=n.end.offset-e.splitPosition.offset,o=e.splitPosition.offset-n.start.offset;this._setRelation(e,t,{howMany:s,offset:o})}}}break}case ie:{switch(t.constructor){case ie:{e.targetPosition.isEqual(t.sourcePosition)||this._setRelation(e,t,"mergeTargetNotMoved"),e.sourcePosition.isEqual(t.targetPosition)&&this._setRelation(e,t,"mergeSourceNotMoved"),e.sourcePosition.isEqual(t.sourcePosition)&&this._setRelation(e,t,"mergeSameElement");break}case J:e.sourcePosition.isEqual(t.splitPosition)&&this._setRelation(e,t,"splitAtSource")}break}case pe:{const n=e.newRange;if(!n)return;switch(t.constructor){case z:{const s=w._createFromPositionAndShift(t.sourcePosition,t.howMany),o=s.containsPosition(n.start)||s.start.isEqual(n.start),r=s.containsPosition(n.end)||s.end.isEqual(n.end);(o||r)&&!s.containsRange(n)&&this._setRelation(e,t,{side:o?"left":"right",path:o?n.start.path.slice():n.end.path.slice()});break}case ie:{const s=n.start.isEqual(t.targetPosition),o=n.start.isEqual(t.deletionPosition),r=n.end.isEqual(t.deletionPosition),a=n.end.isEqual(t.sourcePosition);(s||o||r||a)&&this._setRelation(e,t,{wasInLeftElement:s,wasStartBeforeMergedElement:o,wasEndBeforeMergedElement:r,wasInRightElement:a});break}}break}}}getContext(e,t,n){return{aIsStrong:n,aWasUndone:this._wasUndone(e),bWasUndone:this._wasUndone(t),abRelation:this._useRelations?this._getRelation(e,t):null,baRelation:this._useRelations?this._getRelation(t,e):null,forceWeakRemove:this._forceWeakRemove}}_wasUndone(e){const t=this.originalOperations.get(e);return t.wasUndone||this._history.isUndoneOperation(t)}_getRelation(e,t){const n=this.originalOperations.get(t),s=this._history.getUndoneOperation(n);if(!s)return null;const o=this.originalOperations.get(e),r=this._relations.get(o);return r&&r.get(s)||null}_setRelation(e,t,n){const s=this.originalOperations.get(e),o=this.originalOperations.get(t);let r=this._relations.get(s);r||(r=new Map,this._relations.set(s,r)),r.set(o,n)}}function ou(i,e){for(const t of i)t.baseVersion=e++}function ru(i,e){for(let t=0;t<e;t++)i.push(new ae(0))}O(ne,ne,(i,e,t)=>{if(i.key===e.key&&i.range.start.hasSameParentAs(e.range.start)){const n=i.range.getDifference(e.range).map(o=>new ne(o,i.key,i.oldValue,i.newValue,0)),s=i.range.getIntersection(e.range);return s&&t.aIsStrong&&n.push(new ne(s,e.key,e.newValue,i.newValue,0)),n.length==0?[new ae(0)]:n}else return[i]});O(ne,re,(i,e)=>{if(i.range.start.hasSameParentAs(e.position)&&i.range.containsPosition(e.position)){const n=i.range._getTransformedByInsertion(e.position,e.howMany,!e.shouldReceiveAttributes).map(s=>new ne(s,i.key,i.oldValue,i.newValue,i.baseVersion));if(e.shouldReceiveAttributes){const s=au(e,i.key,i.oldValue);s&&n.unshift(s)}return n}return i.range=i.range._getTransformedByInsertion(e.position,e.howMany,!1)[0],[i]});function au(i,e,t){const s=i.nodes.getNode(0).getAttribute(e);if(s==t)return null;const o=new w(i.position,i.position.getShiftedBy(i.howMany));return new ne(o,e,s,t,0)}O(ne,ie,(i,e)=>{const t=[];i.range.start.hasSameParentAs(e.deletionPosition)&&(i.range.containsPosition(e.deletionPosition)||i.range.start.isEqual(e.deletionPosition))&&t.push(w._createFromPositionAndShift(e.graveyardPosition,1));const n=i.range._getTransformedByMergeOperation(e);return n.isCollapsed||t.push(n),t.map(s=>new ne(s,i.key,i.oldValue,i.newValue,i.baseVersion))});O(ne,z,(i,e)=>OC(i.range,e).map(n=>new ne(n,i.key,i.oldValue,i.newValue,i.baseVersion)));function OC(i,e){const t=w._createFromPositionAndShift(e.sourcePosition,e.howMany);let n=null,s=[];t.containsRange(i,!0)?n=i:i.start.hasSameParentAs(t.start)?(s=i.getDifference(t),n=i.getIntersection(t)):s=[i];const o=[];for(let r of s){r=r._getTransformedByDeletion(e.sourcePosition,e.howMany);const a=e.getMovedRangeStart(),l=r.start.hasSameParentAs(a);r=r._getTransformedByInsertion(a,e.howMany,l),o.push(...r)}return n&&o.push(n._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany,!1)[0]),o}O(ne,J,(i,e)=>{if(i.range.end.isEqual(e.insertionPosition))return e.graveyardPosition||i.range.end.offset++,[i];if(i.range.start.hasSameParentAs(e.splitPosition)&&i.range.containsPosition(e.splitPosition)){const t=i.clone();return t.range=new w(e.moveTargetPosition.clone(),i.range.end._getCombined(e.splitPosition,e.moveTargetPosition)),i.range.end=e.splitPosition.clone(),i.range.end.stickiness="toPrevious",[i,t]}return i.range=i.range._getTransformedBySplitOperation(e),[i]});O(re,ne,(i,e)=>{const t=[i];if(i.shouldReceiveAttributes&&i.position.hasSameParentAs(e.range.start)&&e.range.containsPosition(i.position)){const n=au(i,e.key,e.newValue);n&&t.push(n)}return t});O(re,re,(i,e,t)=>i.position.isEqual(e.position)&&t.aIsStrong?[i]:(i.position=i.position._getTransformedByInsertOperation(e),[i]));O(re,z,(i,e)=>(i.position=i.position._getTransformedByMoveOperation(e),[i]));O(re,J,(i,e)=>(i.position=i.position._getTransformedBySplitOperation(e),[i]));O(re,ie,(i,e)=>(i.position=i.position._getTransformedByMergeOperation(e),[i]));O(pe,re,(i,e)=>(i.oldRange&&(i.oldRange=i.oldRange._getTransformedByInsertOperation(e)[0]),i.newRange&&(i.newRange=i.newRange._getTransformedByInsertOperation(e)[0]),[i]));O(pe,pe,(i,e,t)=>{if(i.name==e.name)if(t.aIsStrong)i.oldRange=e.newRange?e.newRange.clone():null;else return[new ae(0)];return[i]});O(pe,ie,(i,e)=>(i.oldRange&&(i.oldRange=i.oldRange._getTransformedByMergeOperation(e)),i.newRange&&(i.newRange=i.newRange._getTransformedByMergeOperation(e)),[i]));O(pe,z,(i,e,t)=>{if(i.oldRange&&(i.oldRange=w._createFromRanges(i.oldRange._getTransformedByMoveOperation(e))),i.newRange){if(t.abRelation){const n=w._createFromRanges(i.newRange._getTransformedByMoveOperation(e));if(t.abRelation.side=="left"&&e.targetPosition.isEqual(i.newRange.start))return i.newRange.start.path=t.abRelation.path,i.newRange.end=n.end,[i];if(t.abRelation.side=="right"&&e.targetPosition.isEqual(i.newRange.end))return i.newRange.start=n.start,i.newRange.end.path=t.abRelation.path,[i]}i.newRange=w._createFromRanges(i.newRange._getTransformedByMoveOperation(e))}return[i]});O(pe,J,(i,e,t)=>{if(i.oldRange&&(i.oldRange=i.oldRange._getTransformedBySplitOperation(e)),i.newRange){if(t.abRelation){const n=i.newRange._getTransformedBySplitOperation(e);return i.newRange.start.isEqual(e.splitPosition)&&t.abRelation.wasStartBeforeMergedElement?i.newRange.start=_._createAt(e.insertionPosition):i.newRange.start.isEqual(e.splitPosition)&&!t.abRelation.wasInLeftElement&&(i.newRange.start=_._createAt(e.moveTargetPosition)),i.newRange.end.isEqual(e.splitPosition)&&t.abRelation.wasInRightElement?i.newRange.end=_._createAt(e.moveTargetPosition):i.newRange.end.isEqual(e.splitPosition)&&t.abRelation.wasEndBeforeMergedElement?i.newRange.end=_._createAt(e.insertionPosition):i.newRange.end=n.end,[i]}i.newRange=i.newRange._getTransformedBySplitOperation(e)}return[i]});O(ie,re,(i,e)=>(i.sourcePosition.hasSameParentAs(e.position)&&(i.howMany+=e.howMany),i.sourcePosition=i.sourcePosition._getTransformedByInsertOperation(e),i.targetPosition=i.targetPosition._getTransformedByInsertOperation(e),[i]));O(ie,ie,(i,e,t)=>{if(i.sourcePosition.isEqual(e.sourcePosition)&&i.targetPosition.isEqual(e.targetPosition))if(t.bWasUndone){const n=e.graveyardPosition.path.slice();return n.push(0),i.sourcePosition=new _(e.graveyardPosition.root,n),i.howMany=0,[i]}else return[new ae(0)];if(i.sourcePosition.isEqual(e.sourcePosition)&&!i.targetPosition.isEqual(e.targetPosition)&&!t.bWasUndone&&t.abRelation!="splitAtSource"){const n=i.targetPosition.root.rootName=="$graveyard",s=e.targetPosition.root.rootName=="$graveyard";if(s&&!n||!(n&&!s)&&t.aIsStrong){const l=e.targetPosition._getTransformedByMergeOperation(e),c=i.targetPosition._getTransformedByMergeOperation(e);return[new z(l,i.howMany,c,0)]}else return[new ae(0)]}return i.sourcePosition.hasSameParentAs(e.targetPosition)&&(i.howMany+=e.howMany),i.sourcePosition=i.sourcePosition._getTransformedByMergeOperation(e),i.targetPosition=i.targetPosition._getTransformedByMergeOperation(e),(!i.graveyardPosition.isEqual(e.graveyardPosition)||!t.aIsStrong)&&(i.graveyardPosition=i.graveyardPosition._getTransformedByMergeOperation(e)),[i]});O(ie,z,(i,e,t)=>{const n=w._createFromPositionAndShift(e.sourcePosition,e.howMany);return e.type=="remove"&&!t.bWasUndone&&!t.forceWeakRemove&&i.deletionPosition.hasSameParentAs(e.sourcePosition)&&n.containsPosition(i.sourcePosition)?[new ae(0)]:(i.sourcePosition.hasSameParentAs(e.targetPosition)&&(i.howMany+=e.howMany),i.sourcePosition.hasSameParentAs(e.sourcePosition)&&(i.howMany-=e.howMany),i.sourcePosition=i.sourcePosition._getTransformedByMoveOperation(e),i.targetPosition=i.targetPosition._getTransformedByMoveOperation(e),i.graveyardPosition.isEqual(e.targetPosition)||(i.graveyardPosition=i.graveyardPosition._getTransformedByMoveOperation(e)),[i])});O(ie,J,(i,e,t)=>{if(e.graveyardPosition&&(i.graveyardPosition=i.graveyardPosition._getTransformedByDeletion(e.graveyardPosition,1),i.deletionPosition.isEqual(e.graveyardPosition)&&(i.howMany=e.howMany)),i.targetPosition.isEqual(e.splitPosition)){const n=e.howMany!=0,s=e.graveyardPosition&&i.deletionPosition.isEqual(e.graveyardPosition);if(n||s||t.abRelation=="mergeTargetNotMoved")return i.sourcePosition=i.sourcePosition._getTransformedBySplitOperation(e),[i]}if(i.sourcePosition.isEqual(e.splitPosition)){if(t.abRelation=="mergeSourceNotMoved")return i.howMany=0,i.targetPosition=i.targetPosition._getTransformedBySplitOperation(e),[i];if(t.abRelation=="mergeSameElement"||i.sourcePosition.offset>0)return i.sourcePosition=e.moveTargetPosition.clone(),i.targetPosition=i.targetPosition._getTransformedBySplitOperation(e),[i]}return i.sourcePosition.hasSameParentAs(e.splitPosition)&&(i.howMany=e.splitPosition.offset),i.sourcePosition=i.sourcePosition._getTransformedBySplitOperation(e),i.targetPosition=i.targetPosition._getTransformedBySplitOperation(e),[i]});O(z,re,(i,e)=>{const n=w._createFromPositionAndShift(i.sourcePosition,i.howMany)._getTransformedByInsertOperation(e,!1)[0];return i.sourcePosition=n.start,i.howMany=n.end.offset-n.start.offset,i.targetPosition.isEqual(e.position)||(i.targetPosition=i.targetPosition._getTransformedByInsertOperation(e)),[i]});O(z,z,(i,e,t)=>{const n=w._createFromPositionAndShift(i.sourcePosition,i.howMany),s=w._createFromPositionAndShift(e.sourcePosition,e.howMany);let o=t.aIsStrong,r=!t.aIsStrong;t.abRelation=="insertBefore"||t.baRelation=="insertAfter"?r=!0:(t.abRelation=="insertAfter"||t.baRelation=="insertBefore")&&(r=!1);let a;if(i.targetPosition.isEqual(e.targetPosition)&&r?a=i.targetPosition._getTransformedByDeletion(e.sourcePosition,e.howMany):a=i.targetPosition._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany),lu(i,e)&&lu(e,i))return[e.getReversed()];if(n.containsPosition(e.targetPosition)&&n.containsRange(s,!0))return n.start=n.start._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany),n.end=n.end._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany),Zt([n],a);if(s.containsPosition(i.targetPosition)&&s.containsRange(n,!0))return n.start=n.start._getCombined(e.sourcePosition,e.getMovedRangeStart()),n.end=n.end._getCombined(e.sourcePosition,e.getMovedRangeStart()),Zt([n],a);const u=he(i.sourcePosition.getParentPath(),e.sourcePosition.getParentPath());if(u=="prefix"||u=="extension")return n.start=n.start._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany),n.end=n.end._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany),Zt([n],a);i.type=="remove"&&e.type!="remove"&&!t.aWasUndone&&!t.forceWeakRemove?o=!0:i.type!="remove"&&e.type=="remove"&&!t.bWasUndone&&!t.forceWeakRemove&&(o=!1);const d=[],h=n.getDifference(s);for(const g of h){g.start=g.start._getTransformedByDeletion(e.sourcePosition,e.howMany),g.end=g.end._getTransformedByDeletion(e.sourcePosition,e.howMany);const p=he(g.start.getParentPath(),e.getMovedRangeStart().getParentPath())=="same",b=g._getTransformedByInsertion(e.getMovedRangeStart(),e.howMany,p);d.push(...b)}const m=n.getIntersection(s);return m!==null&&o&&(m.start=m.start._getCombined(e.sourcePosition,e.getMovedRangeStart()),m.end=m.end._getCombined(e.sourcePosition,e.getMovedRangeStart()),d.length===0?d.push(m):d.length==1?s.start.isBefore(n.start)||s.start.isEqual(n.start)?d.unshift(m):d.push(m):d.splice(1,0,m)),d.length===0?[new ae(i.baseVersion)]:Zt(d,a)});O(z,J,(i,e,t)=>{let n=i.targetPosition.clone();(!i.targetPosition.isEqual(e.insertionPosition)||!e.graveyardPosition||t.abRelation=="moveTargetAfter")&&(n=i.targetPosition._getTransformedBySplitOperation(e));const s=w._createFromPositionAndShift(i.sourcePosition,i.howMany);if(s.end.isEqual(e.insertionPosition))return e.graveyardPosition||i.howMany++,i.targetPosition=n,[i];if(s.start.hasSameParentAs(e.splitPosition)&&s.containsPosition(e.splitPosition)){let a=new w(e.splitPosition,s.end);a=a._getTransformedBySplitOperation(e);const l=[new w(s.start,e.splitPosition),a];return Zt(l,n)}i.targetPosition.isEqual(e.splitPosition)&&t.abRelation=="insertAtSource"&&(n=e.moveTargetPosition),i.targetPosition.isEqual(e.insertionPosition)&&t.abRelation=="insertBetween"&&(n=i.targetPosition);const r=[s._getTransformedBySplitOperation(e)];if(e.graveyardPosition){const a=s.start.isEqual(e.graveyardPosition)||s.containsPosition(e.graveyardPosition);i.howMany>1&&a&&!t.aWasUndone&&r.push(w._createFromPositionAndShift(e.insertionPosition,1))}return Zt(r,n)});O(z,ie,(i,e,t)=>{const n=w._createFromPositionAndShift(i.sourcePosition,i.howMany);if(e.deletionPosition.hasSameParentAs(i.sourcePosition)&&n.containsPosition(e.sourcePosition)){if(i.type=="remove"&&!t.forceWeakRemove){if(!t.aWasUndone){const r=[];let a=e.graveyardPosition.clone(),l=e.targetPosition._getTransformedByMergeOperation(e);i.howMany>1&&(r.push(new z(i.sourcePosition,i.howMany-1,i.targetPosition,0)),a=a._getTransformedByMove(i.sourcePosition,i.targetPosition,i.howMany-1),l=l._getTransformedByMove(i.sourcePosition,i.targetPosition,i.howMany-1));const c=e.deletionPosition._getCombined(i.sourcePosition,i.targetPosition),u=new z(a,1,c,0),d=u.getMovedRangeStart().path.slice();d.push(0);const h=new _(u.targetPosition.root,d);l=l._getTransformedByMove(a,c,1);const m=new z(l,e.howMany,h,0);return r.push(u),r.push(m),r}}else if(i.howMany==1)return t.bWasUndone?(i.sourcePosition=e.graveyardPosition.clone(),i.targetPosition=i.targetPosition._getTransformedByMergeOperation(e),[i]):[new ae(0)]}const o=w._createFromPositionAndShift(i.sourcePosition,i.howMany)._getTransformedByMergeOperation(e);return i.sourcePosition=o.start,i.howMany=o.end.offset-o.start.offset,i.targetPosition=i.targetPosition._getTransformedByMergeOperation(e),[i]});O(we,re,(i,e)=>(i.position=i.position._getTransformedByInsertOperation(e),[i]));O(we,ie,(i,e)=>i.position.isEqual(e.deletionPosition)?(i.position=e.graveyardPosition.clone(),i.position.stickiness="toNext",[i]):(i.position=i.position._getTransformedByMergeOperation(e),[i]));O(we,z,(i,e)=>(i.position=i.position._getTransformedByMoveOperation(e),[i]));O(we,we,(i,e,t)=>{if(i.position.isEqual(e.position))if(t.aIsStrong)i.oldName=e.newName;else return[new ae(0)];return[i]});O(we,J,(i,e)=>{const t=i.position.path,n=e.splitPosition.getParentPath();if(he(t,n)=="same"&&!e.graveyardPosition){const s=new we(i.position.getShiftedBy(1),i.oldName,i.newName,0);return[i,s]}return i.position=i.position._getTransformedBySplitOperation(e),[i]});O(st,st,(i,e,t)=>{if(i.root===e.root&&i.key===e.key){if(!t.aIsStrong||i.newValue===e.newValue)return[new ae(0)];i.oldValue=e.newValue}return[i]});O(J,re,(i,e)=>(i.splitPosition.hasSameParentAs(e.position)&&i.splitPosition.offset<e.position.offset&&(i.howMany+=e.howMany),i.splitPosition=i.splitPosition._getTransformedByInsertOperation(e),i.insertionPosition=i.insertionPosition._getTransformedByInsertOperation(e),[i]));O(J,ie,(i,e,t)=>{if(!i.graveyardPosition&&!t.bWasUndone&&i.splitPosition.hasSameParentAs(e.sourcePosition)){const n=e.graveyardPosition.path.slice();n.push(0);const s=new _(e.graveyardPosition.root,n),o=J.getInsertionPosition(new _(e.graveyardPosition.root,n)),r=new J(s,0,o,null,0);return i.splitPosition=i.splitPosition._getTransformedByMergeOperation(e),i.insertionPosition=J.getInsertionPosition(i.splitPosition),i.graveyardPosition=r.insertionPosition.clone(),i.graveyardPosition.stickiness="toNext",[r,i]}return i.splitPosition.hasSameParentAs(e.deletionPosition)&&!i.splitPosition.isAfter(e.deletionPosition)&&i.howMany--,i.splitPosition.hasSameParentAs(e.targetPosition)&&(i.howMany+=e.howMany),i.splitPosition=i.splitPosition._getTransformedByMergeOperation(e),i.insertionPosition=J.getInsertionPosition(i.splitPosition),i.graveyardPosition&&(i.graveyardPosition=i.graveyardPosition._getTransformedByMergeOperation(e)),[i]});O(J,z,(i,e,t)=>{const n=w._createFromPositionAndShift(e.sourcePosition,e.howMany);if(i.graveyardPosition){const o=n.start.isEqual(i.graveyardPosition)||n.containsPosition(i.graveyardPosition);if(!t.bWasUndone&&o){const r=i.splitPosition._getTransformedByMoveOperation(e),a=i.graveyardPosition._getTransformedByMoveOperation(e),l=a.path.slice();l.push(0);const c=new _(a.root,l);return[new z(r,i.howMany,c,0)]}i.graveyardPosition=i.graveyardPosition._getTransformedByMoveOperation(e)}const s=i.splitPosition.isEqual(e.targetPosition);if(s&&(t.baRelation=="insertAtSource"||t.abRelation=="splitBefore"))return i.howMany+=e.howMany,i.splitPosition=i.splitPosition._getTransformedByDeletion(e.sourcePosition,e.howMany),i.insertionPosition=J.getInsertionPosition(i.splitPosition),[i];if(s&&t.abRelation&&t.abRelation.howMany){const{howMany:o,offset:r}=t.abRelation;return i.howMany+=o,i.splitPosition=i.splitPosition.getShiftedBy(r),[i]}if(i.splitPosition.hasSameParentAs(e.sourcePosition)&&n.containsPosition(i.splitPosition)){const o=e.howMany-(i.splitPosition.offset-e.sourcePosition.offset);return i.howMany-=o,i.splitPosition.hasSameParentAs(e.targetPosition)&&i.splitPosition.offset<e.targetPosition.offset&&(i.howMany+=e.howMany),i.splitPosition=e.sourcePosition.clone(),i.insertionPosition=J.getInsertionPosition(i.splitPosition),[i]}return e.sourcePosition.isEqual(e.targetPosition)||(i.splitPosition.hasSameParentAs(e.sourcePosition)&&i.splitPosition.offset<=e.sourcePosition.offset&&(i.howMany-=e.howMany),i.splitPosition.hasSameParentAs(e.targetPosition)&&i.splitPosition.offset<e.targetPosition.offset&&(i.howMany+=e.howMany)),i.splitPosition.stickiness="toNone",i.splitPosition=i.splitPosition._getTransformedByMoveOperation(e),i.splitPosition.stickiness="toNext",i.graveyardPosition?i.insertionPosition=i.insertionPosition._getTransformedByMoveOperation(e):i.insertionPosition=J.getInsertionPosition(i.splitPosition),[i]});O(J,J,(i,e,t)=>{if(i.splitPosition.isEqual(e.splitPosition)){if(!i.graveyardPosition&&!e.graveyardPosition)return[new ae(0)];if(i.graveyardPosition&&e.graveyardPosition&&i.graveyardPosition.isEqual(e.graveyardPosition))return[new ae(0)];if(t.abRelation=="splitBefore")return i.howMany=0,i.graveyardPosition=i.graveyardPosition._getTransformedBySplitOperation(e),[i]}if(i.graveyardPosition&&e.graveyardPosition&&i.graveyardPosition.isEqual(e.graveyardPosition)){const n=i.splitPosition.root.rootName=="$graveyard",s=e.splitPosition.root.rootName=="$graveyard";if(s&&!n||!(n&&!s)&&t.aIsStrong){const l=[];return e.howMany&&l.push(new z(e.moveTargetPosition,e.howMany,e.splitPosition,0)),i.howMany&&l.push(new z(i.splitPosition,i.howMany,i.moveTargetPosition,0)),l}else return[new ae(0)]}if(i.graveyardPosition&&(i.graveyardPosition=i.graveyardPosition._getTransformedBySplitOperation(e)),i.splitPosition.isEqual(e.insertionPosition)&&t.abRelation=="splitBefore")return i.howMany++,[i];if(e.splitPosition.isEqual(i.insertionPosition)&&t.baRelation=="splitBefore"){const n=e.insertionPosition.path.slice();n.push(0);const s=new _(e.insertionPosition.root,n),o=new z(i.insertionPosition,1,s,0);return[i,o]}return i.splitPosition.hasSameParentAs(e.splitPosition)&&i.splitPosition.offset<e.splitPosition.offset&&(i.howMany-=e.howMany),i.splitPosition=i.splitPosition._getTransformedBySplitOperation(e),i.insertionPosition=J.getInsertionPosition(i.splitPosition),[i]});function lu(i,e){return i.targetPosition._getTransformedByDeletion(e.sourcePosition,e.howMany)===null}function Zt(i,e){const t=[];for(let n=0;n<i.length;n++){const s=i[n],o=new z(s.start,s.end.offset-s.start.offset,e,0);t.push(o);for(let r=n+1;r<i.length;r++)i[r]=i[r]._getTransformedByMove(o.sourcePosition,o.targetPosition,o.howMany)[0];e=e._getTransformedByMove(o.sourcePosition,o.targetPosition,o.howMany)}return t}class NC extends dt{constructor(e){super(e);this.domEventType="click"}onDomEvent(e){this.fire(e.type,e)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ci extends dt{constructor(e){super(e);this.domEventType=["mousedown","mouseup","mouseover","mouseout"]}onDomEvent(e){this.fire(e.type,e)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class en{constructor(e){this.document=e}createDocumentFragment(e){return new St(this.document,e)}createElement(e,t,n){return new ke(this.document,e,t,n)}createText(e){return new q(this.document,e)}clone(e,t=!1){return e._clone(t)}appendChild(e,t){return t._appendChild(e)}insertChild(e,t,n){return n._insertChild(e,t)}removeChildren(e,t,n){return n._removeChildren(e,t)}remove(e){const t=e.parent;return t?this.removeChildren(t.getChildIndex(e),1,t):[]}replace(e,t){const n=e.parent;if(n){const s=n.getChildIndex(e);return this.removeChildren(s,1,n),this.insertChild(s,t,n),!0}return!1}unwrapElement(e){const t=e.parent;if(t){const n=t.getChildIndex(e);this.remove(e),this.insertChild(n,e.getChildren(),t)}}rename(e,t){const n=new ke(this.document,e,t.getAttributes(),t.getChildren());return this.replace(t,n)?n:null}setAttribute(e,t,n){n._setAttribute(e,t)}removeAttribute(e,t){t._removeAttribute(e)}addClass(e,t){t._addClass(e)}removeClass(e,t){t._removeClass(e)}setStyle(e,t,n){Ee(e)&&n===void 0&&(n=t),n._setStyle(e,t)}removeStyle(e,t){t._removeStyle(e)}setCustomProperty(e,t,n){n._setCustomProperty(e,t)}removeCustomProperty(e,t){return t._removeCustomProperty(e)}createPositionAt(e,t){return y._createAt(e,t)}createPositionAfter(e){return y._createAfter(e)}createPositionBefore(e){return y._createBefore(e)}createRange(e,t){return new P(e,t)}createRangeOn(e){return P._createOn(e)}createRangeIn(e){return P._createIn(e)}createSelection(e,t,n){return new Re(e,t,n)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class DC extends Oc{constructor(e,t){super(e);this.view=t}init(){const e=this.editor,t=this.view,n=e.editing.view,s=t.editable,o=n.document.getRoot();t.editable.name=o.rootName,t.render();const r=s.element;this.setEditableElement(s.name,r),this.focusTracker.add(r),t.editable.bind("isFocused").to(this.focusTracker),n.attachDomRoot(r),this._initPlaceholder(),this._initToolbar(),this.fire("ready")}destroy(){const e=this.view;this.editor.editing.view.detachDomRoot(e.editable.name),e.destroy(),super.destroy()}_initToolbar(){const e=this.editor,n=this.view.toolbar;n.fillFromConfig(e.config.get("toolbar"),this.componentFactory),kC({origin:e.editing.view,originFocusTracker:this.focusTracker,originKeystrokeHandler:e.keystrokes,toolbar:n})}_initPlaceholder(){const e=this.editor,t=e.editing.view,n=t.document.getRoot(),s=e.sourceElement,o=e.config.get("placeholder")||s&&s.tagName.toLowerCase()==="textarea"&&s.getAttribute("placeholder");o&&tu({view:t,element:n,text:o,isDirectHost:!1,keepOnFocus:!0})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class BC extends mC{constructor(e,t,n={}){super(e);this.toolbar=new lo(e,{shouldGroupWhenFull:n.shouldToolbarGroupWhenFull}),this.editable=new wC(e,t,n.editableElement),this.toolbar.extendTemplate({attributes:{class:["ck-reset_all","ck-rounded-corners"],dir:e.uiLanguageDirection}})}render(){super.render(),this.registerChild([this.toolbar,this.editable])}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class cu extends Vc{constructor(e,t){super(t);Et(e)&&(this.sourceElement=e,c0(this)),this.model.document.createRoot();const n=!this.config.get("toolbar.shouldNotGroupWhenFull"),s=new BC(this.locale,this.editing.view,{editableElement:this.sourceElement,shouldToolbarGroupWhenFull:n});this.ui=new DC(this,s)}destroy(){const e=this.getData();return this.ui.destroy(),super.destroy().then(()=>{this.sourceElement&&Jv(this.sourceElement,e)})}static create(e,t={}){return new Promise(n=>{const s=Et(e);if(s&&e.tagName==="TEXTAREA")throw new f("editor-wrong-element",null);const o=new this(e,t);n(o.initPlugins().then(()=>{o.ui.init()}).then(()=>{if(!s&&t.initialData)throw new f("editor-create-initial-data",null);const r=t.initialData!==void 0?t.initialData:FC(e);return o.data.init(r)}).then(()=>o.fire("ready")).then(()=>o))})}}A(cu,l0);function FC(i){return Et(i)?Gv(i):i}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class LC{constructor(e){this.files=zC(e),this._native=e}get types(){return this._native.types}getData(e){return this._native.getData(e)}setData(e,t){this._native.setData(e,t)}set effectAllowed(e){this._native.effectAllowed=e}get effectAllowed(){return this._native.effectAllowed}set dropEffect(e){this._native.dropEffect=e}get dropEffect(){return this._native.dropEffect}get isCanceled(){return this._native.dropEffect=="none"||!!this._native.mozUserCancelled}}function zC(i){const e=Array.from(i.files||[]),t=Array.from(i.items||[]);return e.length?e:t.filter(n=>n.kind==="file").map(n=>n.getAsFile())}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class po extends dt{constructor(e){super(e);const t=this.document;this.domEventType=["paste","copy","cut","drop","dragover","dragstart","dragend","dragenter","dragleave"],this.listenTo(t,"paste",n("clipboardInput"),{priority:"low"}),this.listenTo(t,"drop",n("clipboardInput"),{priority:"low"}),this.listenTo(t,"dragover",n("dragging"),{priority:"low"});function n(s){return(o,r)=>{r.preventDefault();const a=r.dropRange?[r.dropRange]:null,l=new at(t,s);t.fire(l,{dataTransfer:r.dataTransfer,method:o.name,targetRanges:a,target:r.target}),l.stop.called&&r.stopPropagation()}}}onDomEvent(e){const t={dataTransfer:new LC(e.clipboardData?e.clipboardData:e.dataTransfer)};(e.type=="drop"||e.type=="dragover")&&(t.dropRange=HC(this.view,e)),this.fire(e.type,e,t)}}function HC(i,e){const t=e.target.ownerDocument,n=e.clientX,s=e.clientY;let o;return t.caretRangeFromPoint&&t.caretRangeFromPoint(n,s)?o=t.caretRangeFromPoint(n,s):e.rangeParent&&(o=t.createRange(),o.setStart(e.rangeParent,e.rangeOffset),o.collapse(!0)),o?i.domConverter.domRangeToView(o):null}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function $C(i){return i=i.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r?\n\r?\n/g,"</p><p>").replace(/\r?\n/g,"<br>").replace(/^\s/,"&nbsp;").replace(/\s$/,"&nbsp;").replace(/\s\s/g," &nbsp;"),(i.includes("</p><p>")||i.includes("<br>"))&&(i=`<p>${i}</p>`),i}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function WC(i){return i.replace(/<span(?: class="Apple-converted-space"|)>(\s+)<\/span>/g,(e,t)=>t.length==1?" ":t).replace(/<!--[\s\S]*?-->/g,"")}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const uu=["figcaption","li"];function du(i){let e="";if(i.is("$text")||i.is("$textProxy"))e=i.data;else if(i.is("element","img")&&i.hasAttribute("alt"))e=i.getAttribute("alt");else if(i.is("element","br"))e=`
`;else{let t=null;for(const n of i.getChildren()){const s=du(n);t&&(t.is("containerElement")||n.is("containerElement"))&&(uu.includes(t.name)||uu.includes(n.name)?e+=`
`:e+=`

`),e+=s,t=n}}return e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class je extends v{static get pluginName(){return"ClipboardPipeline"}init(){this.editor.editing.view.addObserver(po),this._setupPasteDrop(),this._setupCopyCut()}_setupPasteDrop(){const e=this.editor,t=e.model,n=e.editing.view,s=n.document;this.listenTo(s,"clipboardInput",o=>{e.isReadOnly&&o.stop()},{priority:"highest"}),this.listenTo(s,"clipboardInput",(o,r)=>{const a=r.dataTransfer;let l=r.content||"";l||(a.getData("text/html")?l=WC(a.getData("text/html")):a.getData("text/plain")&&(l=$C(a.getData("text/plain"))),l=this.editor.data.htmlProcessor.toView(l));const c=new at(this,"inputTransformation");this.fire(c,{content:l,dataTransfer:a,targetRanges:r.targetRanges,method:r.method}),c.stop.called&&o.stop(),n.scrollToTheSelection()},{priority:"low"}),this.listenTo(this,"inputTransformation",(o,r)=>{if(r.content.isEmpty)return;const l=this.editor.data.toModel(r.content,"$clipboardHolder");l.childCount!=0&&(o.stop(),t.change(()=>{this.fire("contentInsertion",{content:l,method:r.method,dataTransfer:r.dataTransfer,targetRanges:r.targetRanges})}))},{priority:"low"}),this.listenTo(this,"contentInsertion",(o,r)=>{r.resultRange=t.insertContent(r.content)},{priority:"low"})}_setupCopyCut(){const e=this.editor,t=e.model.document,s=e.editing.view.document;function o(r,a){const l=a.dataTransfer;a.preventDefault();const c=e.data.toView(e.model.getSelectedContent(t.selection));s.fire("clipboardOutput",{dataTransfer:l,content:c,method:r.name})}this.listenTo(s,"copy",o,{priority:"low"}),this.listenTo(s,"cut",(r,a)=>{e.isReadOnly?a.preventDefault():o(r,a)},{priority:"low"}),this.listenTo(s,"clipboardOutput",(r,a)=>{a.content.isEmpty||(a.dataTransfer.setData("text/html",this.editor.data.htmlProcessor.toData(a.content)),a.dataTransfer.setData("text/plain",du(a.content))),a.method=="cut"&&e.model.deleteContent(t.selection)},{priority:"low"})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function*hu(i,e){for(const t of e)t&&i.getAttributeProperties(t[0]).copyOnEnter&&(yield t)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class UC extends R{execute(){const e=this.editor.model,t=e.document;e.change(n=>{qC(this.editor.model,n,t.selection,e.schema),this.fire("afterExecute",{writer:n})})}}function qC(i,e,t,n){const s=t.isCollapsed,o=t.getFirstRange(),r=o.start.parent,a=o.end.parent;if(n.isLimit(r)||n.isLimit(a)){!s&&r==a&&i.deleteContent(t);return}if(s){const l=hu(e.model.schema,t.getAttributes());fu(e,o.start),e.setSelectionAttribute(l)}else{const l=!(o.start.isAtStart&&o.end.isAtEnd),c=r==a;i.deleteContent(t,{leaveUnmerged:l}),l&&(c?fu(e,t.focus):e.setSelection(a,0))}}function fu(i,e){i.split(e),i.setSelection(e.parent.nextSibling,0)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class mu extends Ze{constructor(e){super(e);const t=this.document;t.on("keydown",(n,s)=>{if(this.isEnabled&&s.keyCode==V.enter){const o=new ti(t,"enter",t.selection.getFirstRange());t.fire(o,new Ds(t,s.domEvent,{isSoft:s.shiftKey})),o.stop.called&&n.stop()}})}observe(){}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ei extends v{static get pluginName(){return"Enter"}init(){const e=this.editor,t=e.editing.view,n=t.document;t.addObserver(mu),e.commands.add("enter",new UC(e)),this.listenTo(n,"enter",(s,o)=>{o.preventDefault(),!o.isSoft&&(e.execute("enter"),t.scrollToTheSelection())},{priority:"low"})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class gu{constructor(e,t=20){this.model=e,this.size=0,this.limit=t,this.isLocked=!1,this._changeCallback=(n,s)=>{s.type!="transparent"&&s!==this._batch&&this._reset(!0)},this._selectionChangeCallback=()=>{this._reset()},this.model.document.on("change",this._changeCallback),this.model.document.selection.on("change:range",this._selectionChangeCallback),this.model.document.selection.on("change:attribute",this._selectionChangeCallback)}get batch(){return this._batch||(this._batch=this.model.createBatch()),this._batch}input(e){this.size+=e,this.size>=this.limit&&this._reset(!0)}lock(){this.isLocked=!0}unlock(){this.isLocked=!1}destroy(){this.model.document.off("change",this._changeCallback),this.model.document.selection.off("change:range",this._selectionChangeCallback),this.model.document.selection.off("change:attribute",this._selectionChangeCallback)}_reset(e){(!this.isLocked||e)&&(this._batch=null,this.size=0)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class pu extends R{constructor(e,t){super(e);this.direction=t,this._buffer=new gu(e.model,e.config.get("typing.undoStep"))}get buffer(){return this._buffer}execute(e={}){const t=this.editor.model,n=t.document;t.enqueueChange(this._buffer.batch,s=>{this._buffer.lock();const o=s.createSelection(e.selection||n.selection),r=e.sequence||1,a=o.isCollapsed;if(o.isCollapsed&&t.modifySelection(o,{direction:this.direction,unit:e.unit}),this._shouldEntireContentBeReplacedWithParagraph(r)){this._replaceEntireContentWithParagraph(s);return}if(this._shouldReplaceFirstBlockWithParagraph(o,r)){this.editor.execute("paragraph",{selection:o});return}if(o.isCollapsed)return;let l=0;o.getFirstRange().getMinimalFlatRanges().forEach(c=>{l+=Es(c.getWalker({singleCharacters:!0,ignoreElementEnd:!0,shallow:!0}))}),t.deleteContent(o,{doNotResetEntireContent:a,direction:this.direction}),this._buffer.input(l),s.setSelection(o),this._buffer.unlock()})}_shouldEntireContentBeReplacedWithParagraph(e){if(e>1)return!1;const t=this.editor.model,s=t.document.selection,o=t.schema.getLimitElement(s);if(!(s.isCollapsed&&s.containsEntireContent(o))||!t.schema.checkChild(o,"paragraph"))return!1;const a=o.getChild(0);return!(a&&a.name==="paragraph")}_replaceEntireContentWithParagraph(e){const t=this.editor.model,s=t.document.selection,o=t.schema.getLimitElement(s),r=e.createElement("paragraph");e.remove(e.createRangeIn(o)),e.insert(r,o),e.setSelection(r,0)}_shouldReplaceFirstBlockWithParagraph(e,t){const n=this.editor.model;if(t>1||this.direction!="backward"||!e.isCollapsed)return!1;const s=e.getFirstPosition(),o=n.schema.getLimitElement(s),r=o.getChild(0);return!(s.parent!=r||!e.containsEntireContent(r)||!n.schema.checkChild(o,"paragraph")||r.name=="paragraph")}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function jC(i,e){const t=[];let n=0,s;return i.forEach(a=>{a=="equal"?(o(),n++):a=="insert"?(r("insert")?s.values.push(e[n]):(o(),s={type:"insert",index:n,values:[e[n]]}),n++):r("delete")?s.howMany++:(o(),s={type:"delete",index:n,howMany:1})}),o(),t;function o(){s&&(t.push(s),s=null)}function r(a){return s&&s.type==a}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function KC(i){if(i.length==0)return!1;for(const e of i)if(e.type==="children"&&!wu(e))return!0;return!1}function wu(i){if(i.newChildren.length-i.oldChildren.length!=1)return;const e=ut(i.oldChildren,i.newChildren,GC),t=jC(e,i.newChildren);if(t.length>1)return;const n=t[0];if(!!(!!n.values[0]&&n.values[0].is("$text")))return n}function GC(i,e){return!!i&&i.is("$text")&&!!e&&e.is("$text")?i.data===e.data:i===e}function bu(i,e){const t=e.selection,n=i.shiftKey&&i.keyCode===V.delete,s=!t.isCollapsed;return n&&s}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class JC extends Ze{constructor(e){super(e);const t=e.document;let n=0;t.on("keyup",(o,r)=>{(r.keyCode==V.delete||r.keyCode==V.backspace)&&(n=0)}),t.on("keydown",(o,r)=>{if(W.isWindows&&bu(r,t))return;const a={};if(r.keyCode==V.delete)a.direction="forward",a.unit="character";else if(r.keyCode==V.backspace)a.direction="backward",a.unit="codePoint";else return;const l=W.isMac?r.altKey:r.ctrlKey;a.unit=l?"word":a.unit,a.sequence=++n,s(o,r.domEvent,a)}),W.isAndroid&&t.on("beforeinput",(o,r)=>{if(r.domEvent.inputType!="deleteContentBackward")return;const a={unit:"codepoint",direction:"backward",sequence:1},l=r.domTarget.ownerDocument.defaultView.getSelection();l.anchorNode==l.focusNode&&l.anchorOffset+1!=l.focusOffset&&(a.selectionToRemove=e.domConverter.domSelectionToView(l)),s(o,r.domEvent,a)});function s(o,r,a){const l=new ti(t,"delete",t.selection.getFirstRange());t.fire(l,new Ds(t,r,a)),l.stop.called&&o.stop()}}observe(){}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ft extends v{static get pluginName(){return"Delete"}init(){const e=this.editor,t=e.editing.view,n=t.document,s=e.model.document;t.addObserver(JC),this._undoOnBackspace=!1;const o=new pu(e,"forward");if(e.commands.add("deleteForward",o),e.commands.add("forwardDelete",o),e.commands.add("delete",new pu(e,"backward")),this.listenTo(n,"delete",(r,a)=>{const l={unit:a.unit,sequence:a.sequence};if(a.selectionToRemove){const c=e.model.createSelection(),u=[];for(const d of a.selectionToRemove.getRanges())u.push(e.editing.mapper.toModelRange(d));c.setTo(u),l.selection=c}e.execute(a.direction=="forward"?"deleteForward":"delete",l),a.preventDefault(),t.scrollToTheSelection()},{priority:"low"}),W.isAndroid){let r=null;this.listenTo(n,"delete",(a,l)=>{const c=l.domTarget.ownerDocument.defaultView.getSelection();r={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}},{priority:"lowest"}),this.listenTo(n,"keyup",(a,l)=>{if(r){const c=l.domTarget.ownerDocument.defaultView.getSelection();c.collapse(r.anchorNode,r.anchorOffset),c.extend(r.focusNode,r.focusOffset),r=null}})}this.editor.plugins.has("UndoEditing")&&(this.listenTo(n,"delete",(r,a)=>{this._undoOnBackspace&&a.direction=="backward"&&a.sequence==1&&a.unit=="codePoint"&&(this._undoOnBackspace=!1,e.execute("undo"),a.preventDefault(),r.stop())},{context:"$capture"}),this.listenTo(s,"change",()=>{this._undoOnBackspace=!1}))}requestUndoOnBackspace(){this.editor.plugins.has("UndoEditing")&&(this._undoOnBackspace=!0)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class _u{constructor(){this._stack=[]}add(e,t){const n=this._stack,s=n[0];this._insertDescriptor(e);const o=n[0];s!==o&&!wo(s,o)&&this.fire("change:top",{oldDescriptor:s,newDescriptor:o,writer:t})}remove(e,t){const n=this._stack,s=n[0];this._removeDescriptor(e);const o=n[0];s!==o&&!wo(s,o)&&this.fire("change:top",{oldDescriptor:s,newDescriptor:o,writer:t})}_insertDescriptor(e){const t=this._stack,n=t.findIndex(o=>o.id===e.id);if(wo(e,t[n]))return;n>-1&&t.splice(n,1);let s=0;for(;t[s]&&QC(t[s],e);)s++;t.splice(s,0,e)}_removeDescriptor(e){const t=this._stack,n=t.findIndex(s=>s.id===e);n>-1&&t.splice(n,1)}}A(_u,H);function wo(i,e){return i&&e&&i.priority==e.priority&&Ti(i.classes)==Ti(e.classes)}function QC(i,e){return i.priority>e.priority?!0:i.priority<e.priority?!1:Ti(i.classes)>Ti(e.classes)}function Ti(i){return Array.isArray(i)?i.sort().join(","):i}var YC='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M4 0v1H1v3H0V.5A.5.5 0 0 1 .5 0H4zm8 0h3.5a.5.5 0 0 1 .5.5V4h-1V1h-3V0zM4 16H.5a.5.5 0 0 1-.5-.5V12h1v3h3v1zm8 0v-1h3v-3h1v3.5a.5.5 0 0 1-.5.5H12z"/><path fill-opacity=".256" d="M1 1h14v14H1z"/><g class="ck-icon__selected-indicator"><path d="M7 0h2v1H7V0zM0 7h1v2H0V7zm15 0h1v2h-1V7zm-8 8h2v1H7v-1z"/><path fill-opacity=".254" d="M1 1h14v14H1z"/></g></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const XC="ck-widget",vu="ck-widget_selected";function X(i){return i.is("element")?!!i.getCustomProperty("widget"):!1}function bo(i,e,t={}){if(!i.is("containerElement"))throw new f("widget-to-widget-wrong-element-type",null,{element:i});return e.setAttribute("contenteditable","false",i),e.addClass(XC,i),e.setCustomProperty("widget",!0,i),i.getFillerOffset=iE,t.label&&tE(i,t.label,e),t.hasSelectionHandle&&sE(i,e),yu(i,e),i}function ZC(i,e,t){if(e.classes&&t.addClass(oe(e.classes),i),e.attributes)for(const n in e.attributes)t.setAttribute(n,e.attributes[n],i)}function eE(i,e,t){if(e.classes&&t.removeClass(oe(e.classes),i),e.attributes)for(const n in e.attributes)t.removeAttribute(n,i)}function yu(i,e,t=ZC,n=eE){const s=new _u;s.on("change:top",(o,r)=>{r.oldDescriptor&&n(i,r.oldDescriptor,r.writer),r.newDescriptor&&t(i,r.newDescriptor,r.writer)}),e.setCustomProperty("addHighlight",(o,r,a)=>s.add(r,a),i),e.setCustomProperty("removeHighlight",(o,r,a)=>s.remove(r,a),i)}function tE(i,e,t){t.setCustomProperty("widgetLabel",e,i)}function nE(i){const e=i.getCustomProperty("widgetLabel");return e?typeof e=="function"?e():e:""}function _o(i,e){return e.addClass(["ck-editor__editable","ck-editor__nested-editable"],i),e.setAttribute("contenteditable",i.isReadOnly?"false":"true",i),i.on("change:isReadOnly",(t,n,s)=>{e.setAttribute("contenteditable",s?"false":"true",i)}),i.on("change:isFocused",(t,n,s)=>{s?e.addClass("ck-editor__nested-editable_focused",i):e.removeClass("ck-editor__nested-editable_focused",i)}),yu(i,e),i}function tn(i,e){const t=i.getSelectedElement();if(t){const s=Ot(i);if(s)return e.createRange(e.createPositionAt(t,s));if(e.schema.isObject(t)&&!e.schema.isInline(t))return e.createRangeOn(t)}const n=i.getSelectedBlocks().next().value;if(n){if(n.isEmpty)return e.createRange(e.createPositionAt(n,0));const s=e.createPositionAfter(n);return i.focus.isTouching(s)?e.createRange(s):e.createRange(e.createPositionBefore(n))}return e.createRange(i.focus)}function iE(){return null}function sE(i,e){const t=e.createUIElement("div",{class:"ck ck-widget__selection-handle"},function(n){const s=this.toDomElement(n),o=new wi;return o.set("content",YC),o.render(),s.appendChild(o.element),s});e.insert(e.createPositionAt(i,0),t),e.addClass(["ck-widget_with-selection-handle"],i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const ot="widget-type-around";function Vt(i,e,t){return i&&X(i)&&!t.isInline(e)}function oE(i){return i.closest(".ck-widget__type-around__button")}function rE(i){return i.classList.contains("ck-widget__type-around__button_before")?"before":"after"}function aE(i,e){const t=i.closest(".ck-widget");return e.mapDomToView(t)}function Ot(i){return i.getAttribute(ot)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function lE(i){let e=null;const t=i.model,n=i.editing.view,s=i.commands.get("input");W.isAndroid?n.document.on("beforeinput",(l,c)=>o(c),{priority:"lowest"}):n.document.on("keydown",(l,c)=>o(c),{priority:"lowest"}),n.document.on("compositionstart",r,{priority:"lowest"}),n.document.on("compositionend",()=>{e=t.createSelection(t.document.selection)},{priority:"lowest"});function o(l){if(W.isWindows&&bu(l,n.document))return;const c=t.document,u=n.document.isComposing,d=e&&e.isEqual(c.selection);e=null,!!s.isEnabled&&(Eu(l)||c.selection.isCollapsed||u&&l.keyCode===229||!u&&l.keyCode===229&&d||a())}function r(){const l=t.document,c=l.selection.rangeCount===1?l.selection.getFirstRange().isFlat:!0;l.selection.isCollapsed||c||a()}function a(){const l=s.buffer;l.lock();const c=l.batch;s._batches.add(c),t.enqueueChange(c,()=>{t.deleteContent(t.document.selection)}),l.unlock()}}const Cu=[$e("arrowUp"),$e("arrowRight"),$e("arrowDown"),$e("arrowLeft"),9,16,17,18,19,20,27,33,34,35,36,45,91,93,144,145,173,174,175,176,177,178,179,255];for(let i=112;i<=135;i++)Cu.push(i);function Eu(i){return i.ctrlKey||i.metaKey?!0:Cu.includes(i.keyCode)}var cE='<svg viewBox="0 0 10 8" xmlns="http://www.w3.org/2000/svg"><path d="M9.055.263v3.972h-6.77M1 4.216l2-2.038m-2 2 2 2.038"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Tu=["before","after"],uE=new DOMParser().parseFromString(cE,"image/svg+xml").firstChild,ku="ck-widget__type-around_disabled";class dE extends v{static get pluginName(){return"WidgetTypeAround"}static get requires(){return[Ei,ft]}constructor(e){super(e);this._currentFakeCaretModelElement=null}init(){const e=this.editor,t=e.editing.view;this.on("change:isEnabled",(n,s,o)=>{t.change(r=>{for(const a of t.document.roots)o?r.removeClass(ku,a):r.addClass(ku,a)}),o||e.model.change(r=>{r.removeSelectionAttribute(ot)})}),this._enableTypeAroundUIInjection(),this._enableInsertingParagraphsOnButtonClick(),this._enableInsertingParagraphsOnEnterKeypress(),this._enableInsertingParagraphsOnTypingKeystroke(),this._enableTypeAroundFakeCaretActivationUsingKeyboardArrows(),this._enableDeleteIntegration(),this._enableInsertContentIntegration(),this._enableDeleteContentIntegration()}destroy(){this._currentFakeCaretModelElement=null}_insertParagraph(e,t){const n=this.editor,s=n.editing.view;n.execute("insertParagraph",{position:n.model.createPositionAt(e,t)}),s.focus(),s.scrollToTheSelection()}_listenToIfEnabled(e,t,n,s){this.listenTo(e,t,(...o)=>{this.isEnabled&&n(...o)},s)}_insertParagraphAccordingToFakeCaretPosition(){const n=this.editor.model.document.selection,s=Ot(n);if(!s)return!1;const o=n.getSelectedElement();return this._insertParagraph(o,s),!0}_enableTypeAroundUIInjection(){const e=this.editor,t=e.model.schema,n=e.locale.t,s={before:n("Insert paragraph before block"),after:n("Insert paragraph after block")};e.editing.downcastDispatcher.on("insert",(o,r,a)=>{const l=a.mapper.toViewElement(r.item);Vt(l,r.item,t)&&hE(a.writer,s,l)},{priority:"low"})}_enableTypeAroundFakeCaretActivationUsingKeyboardArrows(){const e=this.editor,t=e.model,n=t.document.selection,s=t.schema,o=e.editing.view;this._listenToIfEnabled(o.document,"arrowKey",(a,l)=>{this._handleArrowKeyPress(a,l)},{context:[X,"$text"],priority:"high"}),this._listenToIfEnabled(n,"change:range",(a,l)=>{!l.directChange||e.model.change(c=>{c.removeSelectionAttribute(ot)})}),this._listenToIfEnabled(t.document,"change:data",()=>{const a=n.getSelectedElement();if(a){const l=e.editing.mapper.toViewElement(a);if(Vt(l,a,s))return}e.model.change(l=>{l.removeSelectionAttribute(ot)})}),this._listenToIfEnabled(e.editing.downcastDispatcher,"selection",(a,l,c)=>{const u=c.writer;if(this._currentFakeCaretModelElement){const g=c.mapper.toViewElement(this._currentFakeCaretModelElement);g&&(u.removeClass(Tu.map(r),g),this._currentFakeCaretModelElement=null)}const d=l.selection.getSelectedElement();if(!d)return;const h=c.mapper.toViewElement(d);if(!Vt(h,d,s))return;const m=Ot(l.selection);!m||(u.addClass(r(m),h),this._currentFakeCaretModelElement=d)}),this._listenToIfEnabled(e.ui.focusTracker,"change:isFocused",(a,l,c)=>{c||e.model.change(u=>{u.removeSelectionAttribute(ot)})});function r(a){return`ck-widget_type-around_show-fake-caret_${a}`}}_handleArrowKeyPress(e,t){const n=this.editor,s=n.model,o=s.document.selection,r=s.schema,a=n.editing.view,l=t.keyCode,c=mv(l,n.locale.contentLanguageDirection),u=a.document.selection.getSelectedElement(),d=n.editing.mapper.toModelElement(u);let h;Vt(u,d,r)?h=this._handleArrowKeyPressOnSelectedWidget(c):o.isCollapsed?h=this._handleArrowKeyPressWhenSelectionNextToAWidget(c):t.shiftKey||(h=this._handleArrowKeyPressWhenNonCollapsedSelection(c)),h&&(t.preventDefault(),e.stop())}_handleArrowKeyPressOnSelectedWidget(e){const n=this.editor.model,s=n.document.selection,o=Ot(s);return n.change(r=>{if(o){if(!(o===(e?"after":"before")))return r.removeSelectionAttribute(ot),!0}else return r.setSelectionAttribute(ot,e?"after":"before"),!0;return!1})}_handleArrowKeyPressWhenSelectionNextToAWidget(e){const t=this.editor,n=t.model,s=n.schema,o=t.plugins.get("Widget"),r=o._getObjectElementNextToSelection(e),a=t.editing.mapper.toViewElement(r);return Vt(a,r,s)?(n.change(l=>{o._setSelectionOverElement(r),l.setSelectionAttribute(ot,e?"before":"after")}),!0):!1}_handleArrowKeyPressWhenNonCollapsedSelection(e){const t=this.editor,n=t.model,s=n.schema,o=t.editing.mapper,r=n.document.selection,a=e?r.getLastPosition().nodeBefore:r.getFirstPosition().nodeAfter,l=o.toViewElement(a);return Vt(l,a,s)?(n.change(c=>{c.setSelection(a,"on"),c.setSelectionAttribute(ot,e?"after":"before")}),!0):!1}_enableInsertingParagraphsOnButtonClick(){const e=this.editor,t=e.editing.view;this._listenToIfEnabled(t.document,"mousedown",(n,s)=>{const o=oE(s.domTarget);if(!o)return;const r=rE(o),a=aE(o,t.domConverter),l=e.editing.mapper.toModelElement(a);this._insertParagraph(l,r),s.preventDefault(),n.stop()})}_enableInsertingParagraphsOnEnterKeypress(){const e=this.editor,t=e.model.document.selection,n=e.editing.view;this._listenToIfEnabled(n.document,"enter",(s,o)=>{if(s.eventPhase!="atTarget")return;const r=t.getSelectedElement(),a=e.editing.mapper.toViewElement(r),l=e.model.schema;let c;this._insertParagraphAccordingToFakeCaretPosition()?c=!0:Vt(a,r,l)&&(this._insertParagraph(r,o.isSoft?"before":"after"),c=!0),c&&(o.preventDefault(),s.stop())},{context:X})}_enableInsertingParagraphsOnTypingKeystroke(){const t=this.editor.editing.view,n=[V.enter,V.delete,V.backspace];this._listenToIfEnabled(t.document,"keydown",(s,o)=>{!n.includes(o.keyCode)&&!Eu(o)&&this._insertParagraphAccordingToFakeCaretPosition()},{priority:"high"})}_enableDeleteIntegration(){const e=this.editor,t=e.editing.view,n=e.model,s=n.schema;this._listenToIfEnabled(t.document,"delete",(o,r)=>{if(o.eventPhase!="atTarget")return;const a=Ot(n.document.selection);if(!a)return;const l=r.direction,c=n.document.selection.getSelectedElement(),u=a==="before",d=l=="forward";if(u===d)e.execute("delete",{selection:n.createSelection(c,"on")});else{const m=s.getNearestSelectionRange(n.createPositionAt(c,a),l);if(m)if(!m.isCollapsed)n.change(g=>{g.setSelection(m),e.execute(d?"deleteForward":"delete")});else{const g=n.createSelection(m.start);if(n.modifySelection(g,{direction:l}),!g.focus.isEqual(m.start))n.change(p=>{p.setSelection(m),e.execute(d?"deleteForward":"delete")});else{const p=gE(s,m.start.parent);n.deleteContent(n.createSelection(p,"on"),{doNotAutoparagraph:!0})}}}r.preventDefault(),o.stop()},{context:X})}_enableInsertContentIntegration(){const e=this.editor,t=this.editor.model,n=t.document.selection;this._listenToIfEnabled(e.model,"insertContent",(s,[o,r])=>{if(r&&!r.is("documentSelection"))return;const a=Ot(n);if(!!a)return s.stop(),t.change(l=>{const c=n.getSelectedElement(),u=t.createPositionAt(c,a),d=l.createSelection(u),h=t.insertContent(o,d);return l.setSelection(d),h})},{priority:"high"})}_enableDeleteContentIntegration(){const e=this.editor,n=this.editor.model.document.selection;this._listenToIfEnabled(e.model,"deleteContent",(s,[o])=>{if(o&&!o.is("documentSelection"))return;Ot(n)&&s.stop()},{priority:"high"})}}function hE(i,e,t){const n=i.createUIElement("div",{class:"ck ck-reset_all ck-widget__type-around"},function(s){const o=this.toDomElement(s);return fE(o,e),mE(o),o});i.insert(i.createPositionAt(t,"end"),n)}function fE(i,e){for(const t of Tu){const n=new Oe({tag:"div",attributes:{class:["ck","ck-widget__type-around__button",`ck-widget__type-around__button_${t}`],title:e[t]},children:[i.ownerDocument.importNode(uE,!0)]});i.appendChild(n.render())}}function mE(i){const e=new Oe({tag:"div",attributes:{class:["ck","ck-widget__type-around__fake-caret"]}});i.appendChild(e.render())}function gE(i,e){let t=e;for(const n of e.getAncestors({parentFirst:!0})){if(n.childCount>1||i.isLimit(n))break;t=n}return t}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function pE(i){const e=i.model;return(t,n)=>{const s=n.keyCode==V.arrowup,o=n.keyCode==V.arrowdown,r=n.shiftKey,a=e.document.selection;if(!s&&!o)return;const l=o;if(r&&_E(a,l))return;const c=wE(i,a,l);if(!!c){if(c.isCollapsed){if(a.isCollapsed)return;if(r)return}(c.isCollapsed||bE(i,c,l))&&(e.change(u=>{const d=l?c.end:c.start;if(r){const h=e.createSelection(a.anchor);h.setFocus(d),u.setSelection(h)}else u.setSelection(d)}),t.stop(),n.preventDefault(),n.stopPropagation())}}}function wE(i,e,t){const n=i.model;if(t){const s=e.isCollapsed?e.focus:e.getLastPosition(),o=Au(n,s,"forward");if(!o)return null;const r=n.createRange(s,o),a=Su(n.schema,r,"backward");return a?n.createRange(s,a):null}else{const s=e.isCollapsed?e.focus:e.getFirstPosition(),o=Au(n,s,"backward");if(!o)return null;const r=n.createRange(o,s),a=Su(n.schema,r,"forward");return a?n.createRange(a,s):null}}function Au(i,e,t){const n=i.schema,s=i.createRangeIn(e.root),o=t=="forward"?"elementStart":"elementEnd";for(const{previousPosition:r,item:a,type:l}of s.getWalker({startPosition:e,direction:t})){if(n.isLimit(a)&&!n.isInline(a))return r;if(l==o&&n.isBlock(a))return null}return null}function Su(i,e,t){const n=t=="backward"?e.end:e.start;if(i.checkChild(n,"$text"))return n;for(const{nextPosition:s}of e.getWalker({direction:t}))if(i.checkChild(s,"$text"))return s;return null}function bE(i,e,t){const n=i.model,s=i.view.domConverter;if(t){const c=n.createSelection(e.start);n.modifySelection(c),!c.focus.isAtEnd&&!e.start.isEqual(c.focus)&&(e=n.createRange(c.focus,e.end))}const o=i.mapper.toViewRange(e),r=s.viewRangeToDom(o),a=F.getDomRangeRects(r);let l;for(const c of a){if(l===void 0){l=Math.round(c.bottom);continue}if(Math.round(c.top)>=l)return!1;l=Math.max(l,Math.round(c.bottom))}return!0}function _E(i,e){return!i.isCollapsed&&i.isBackward==e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class nn extends v{static get pluginName(){return"Widget"}static get requires(){return[dE,ft]}init(){const e=this.editor,t=e.editing.view,n=t.document;this._previouslySelected=new Set,this.editor.editing.downcastDispatcher.on("selection",(s,o,r)=>{const a=r.writer,l=o.selection;if(l.isCollapsed)return;const c=l.getSelectedElement();if(!c)return;const u=e.editing.mapper.toViewElement(c);!X(u)||!r.consumable.consume(l,"selection")||a.setSelection(a.createRangeOn(u),{fake:!0,label:nE(u)})}),this.editor.editing.downcastDispatcher.on("selection",(s,o,r)=>{this._clearPreviouslySelectedWidgets(r.writer);const a=r.writer,l=a.document.selection;let c=null;for(const u of l.getRanges())for(const d of u){const h=d.item;X(h)&&!yE(h,c)&&(a.addClass(vu,h),this._previouslySelected.add(h),c=h)}},{priority:"low"}),t.addObserver(Ci),this.listenTo(n,"mousedown",(...s)=>this._onMousedown(...s)),this.listenTo(n,"arrowKey",(...s)=>{this._handleSelectionChangeOnArrowKeyPress(...s)},{context:[X,"$text"]}),this.listenTo(n,"arrowKey",(...s)=>{this._preventDefaultOnArrowKeyPress(...s)},{context:"$root"}),this.listenTo(n,"arrowKey",pE(this.editor.editing),{context:"$text"}),this.listenTo(n,"delete",(s,o)=>{this._handleDelete(o.direction=="forward")&&(o.preventDefault(),s.stop())},{context:"$root"})}_onMousedown(e,t){const n=this.editor,s=n.editing.view,o=s.document;let r=t.target;if(vE(r)){if((W.isSafari||W.isGecko)&&t.domEvent.detail>=3){const l=n.editing.mapper,c=r.is("attributeElement")?r.findAncestor(d=>!d.is("attributeElement")):r,u=l.toModelElement(c);t.preventDefault(),this.editor.model.change(d=>{d.setSelection(u,"in")})}return}if(!X(r)&&(r=r.findAncestor(X),!r))return;W.isAndroid&&t.preventDefault(),o.isFocused||s.focus();const a=n.editing.mapper.toModelElement(r);this._setSelectionOverElement(a)}_handleSelectionChangeOnArrowKeyPress(e,t){const n=t.keyCode,s=this.editor.model,o=s.schema,r=s.document.selection,a=r.getSelectedElement(),l=xs(n,this.editor.locale.contentLanguageDirection),c=l=="down"||l=="right",u=l=="up"||l=="down";if(a&&o.isObject(a)){const h=c?r.getLastPosition():r.getFirstPosition(),m=o.getNearestSelectionRange(h,c?"forward":"backward");m&&(s.change(g=>{g.setSelection(m)}),t.preventDefault(),e.stop());return}if(!r.isCollapsed&&!t.shiftKey){const h=r.getFirstPosition(),m=r.getLastPosition(),g=h.nodeAfter,p=m.nodeBefore;(g&&o.isObject(g)||p&&o.isObject(p))&&(s.change(b=>{b.setSelection(c?m:h)}),t.preventDefault(),e.stop());return}if(!r.isCollapsed)return;const d=this._getObjectElementNextToSelection(c);if(d&&o.isObject(d)){if(o.isInline(d)&&u)return;this._setSelectionOverElement(d),t.preventDefault(),e.stop()}}_preventDefaultOnArrowKeyPress(e,t){const n=this.editor.model,s=n.schema,o=n.document.selection.getSelectedElement();o&&s.isObject(o)&&(t.preventDefault(),e.stop())}_handleDelete(e){if(this.editor.isReadOnly)return;const n=this.editor.model.document.selection;if(!n.isCollapsed)return;const s=this._getObjectElementNextToSelection(e);if(s)return this.editor.model.change(o=>{let r=n.anchor.parent;for(;r.isEmpty;){const a=r;r=a.parent,o.remove(a)}this._setSelectionOverElement(s)}),!0}_setSelectionOverElement(e){this.editor.model.change(t=>{t.setSelection(t.createRangeOn(e))})}_getObjectElementNextToSelection(e){const t=this.editor.model,n=t.schema,s=t.document.selection,o=t.createSelection(s);if(t.modifySelection(o,{direction:e?"forward":"backward"}),o.isEqual(s))return null;const r=e?o.focus.nodeBefore:o.focus.nodeAfter;return!!r&&n.isObject(r)?r:null}_clearPreviouslySelectedWidgets(e){for(const t of this._previouslySelected)e.removeClass(vu,t);this._previouslySelected.clear()}}function vE(i){for(;i;){if(i.is("editableElement")&&!i.is("rootElement"))return!0;if(X(i))return!1;i=i.parent}return!1}function yE(i,e){return e?Array.from(i.getAncestors()).includes(e):!1}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class CE extends v{static get pluginName(){return"DragDrop"}static get requires(){return[je,nn]}init(){const e=this.editor,t=e.editing.view;this._draggedRange=null,this._draggingUid="",this._draggableElement=null,this._updateDropMarkerThrottled=Fa(n=>this._updateDropMarker(n),40),this._removeDropMarkerDelayed=Iu(()=>this._removeDropMarker(),40),this._clearDraggableAttributesDelayed=Iu(()=>this._clearDraggableAttributes(),40),t.addObserver(po),t.addObserver(Ci),this._setupDragging(),this._setupContentInsertionIntegration(),this._setupClipboardInputIntegration(),this._setupDropMarker(),this._setupDraggableAttributeHandling(),this.listenTo(e,"change:isReadOnly",(n,s,o)=>{o?this.forceDisabled("readOnlyMode"):this.clearForceDisabled("readOnlyMode")}),this.on("change:isEnabled",(n,s,o)=>{o||this._finalizeDragging(!1)}),W.isAndroid&&this.forceDisabled("noAndroidSupport")}destroy(){return this._draggedRange&&(this._draggedRange.detach(),this._draggedRange=null),this._updateDropMarkerThrottled.cancel(),this._removeDropMarkerDelayed.cancel(),this._clearDraggableAttributesDelayed.cancel(),super.destroy()}_setupDragging(){const e=this.editor,t=e.model,n=t.document,s=e.editing.view,o=s.document;this.listenTo(o,"dragstart",(r,a)=>{const l=n.selection;if(a.target&&a.target.is("editableElement")){a.preventDefault();return}const c=a.target?Ru(a.target):null;if(c){const h=e.editing.mapper.toModelElement(c);this._draggedRange=qe.fromRange(t.createRangeOn(h)),e.plugins.has("WidgetToolbarRepository")&&e.plugins.get("WidgetToolbarRepository").forceDisabled("dragDrop")}else if(!o.selection.isCollapsed){const h=o.selection.getSelectedElement();(!h||!X(h))&&(this._draggedRange=qe.fromRange(l.getFirstRange()))}if(!this._draggedRange){a.preventDefault();return}this._draggingUid=Be(),a.dataTransfer.effectAllowed=this.isEnabled?"copyMove":"copy",a.dataTransfer.setData("application/ckeditor5-dragging-uid",this._draggingUid);const u=t.createSelection(this._draggedRange.toRange()),d=e.data.toView(t.getSelectedContent(u));o.fire("clipboardOutput",{dataTransfer:a.dataTransfer,content:d,method:r.name}),this.isEnabled||(this._draggedRange.detach(),this._draggedRange=null,this._draggingUid="")},{priority:"low"}),this.listenTo(o,"dragend",(r,a)=>{this._finalizeDragging(!a.dataTransfer.isCanceled&&a.dataTransfer.dropEffect=="move")},{priority:"low"}),this.listenTo(o,"dragenter",()=>{!this.isEnabled||s.focus()}),this.listenTo(o,"dragleave",()=>{this._removeDropMarkerDelayed()}),this.listenTo(o,"dragging",(r,a)=>{if(!this.isEnabled){a.dataTransfer.dropEffect="none";return}this._removeDropMarkerDelayed.cancel();const l=Pu(e,a.targetRanges,a.target);this._draggedRange||(a.dataTransfer.dropEffect="copy"),W.isGecko||(a.dataTransfer.effectAllowed=="copy"?a.dataTransfer.dropEffect="copy":["all","copyMove"].includes(a.dataTransfer.effectAllowed)&&(a.dataTransfer.dropEffect="move")),l&&this._updateDropMarkerThrottled(l)},{priority:"low"})}_setupClipboardInputIntegration(){const e=this.editor,n=e.editing.view.document;this.listenTo(n,"clipboardInput",(s,o)=>{if(o.method!="drop")return;const r=Pu(e,o.targetRanges,o.target);if(this._removeDropMarker(),!r){this._finalizeDragging(!1),s.stop();return}if(this._draggedRange&&this._draggingUid!=o.dataTransfer.getData("application/ckeditor5-dragging-uid")&&(this._draggedRange.detach(),this._draggedRange=null,this._draggingUid=""),xu(o.dataTransfer)=="move"&&this._draggedRange&&this._draggedRange.containsRange(r,!0)){this._finalizeDragging(!1),s.stop();return}o.targetRanges=[e.editing.mapper.toViewRange(r)]},{priority:"high"})}_setupContentInsertionIntegration(){const e=this.editor.plugins.get(je);e.on("contentInsertion",(t,n)=>{if(!this.isEnabled||n.method!=="drop")return;const s=n.targetRanges.map(o=>this.editor.editing.mapper.toModelRange(o));this.editor.model.change(o=>o.setSelection(s))},{priority:"high"}),e.on("contentInsertion",(t,n)=>{if(!this.isEnabled||n.method!=="drop")return;const s=xu(n.dataTransfer)=="move",o=!n.resultRange||!n.resultRange.isCollapsed;this._finalizeDragging(o&&s)},{priority:"lowest"})}_setupDraggableAttributeHandling(){const e=this.editor,t=e.editing.view,n=t.document;this.listenTo(n,"mousedown",(s,o)=>{if(W.isAndroid||!o)return;this._clearDraggableAttributesDelayed.cancel();let r=Ru(o.target);if(W.isBlink&&!e.isReadOnly&&!r&&!n.selection.isCollapsed){const a=n.selection.getSelectedElement();(!a||!X(a))&&(r=n.selection.editableElement)}r&&(t.change(a=>{a.setAttribute("draggable","true",r)}),this._draggableElement=e.editing.mapper.toModelElement(r))}),this.listenTo(n,"mouseup",()=>{W.isAndroid||this._clearDraggableAttributesDelayed()})}_clearDraggableAttributes(){const e=this.editor.editing;e.view.change(t=>{this._draggableElement&&this._draggableElement.root.rootName!="$graveyard"&&t.removeAttribute("draggable",e.mapper.toViewElement(this._draggableElement)),this._draggableElement=null})}_setupDropMarker(){const e=this.editor;e.conversion.for("editingDowncast").markerToHighlight({model:"drop-target",view:{classes:["ck-clipboard-drop-target-range"]}}),e.conversion.for("editingDowncast").markerToElement({model:"drop-target",view:(t,{writer:n})=>{if(!!e.model.schema.checkChild(t.markerRange.start,"$text"))return n.createUIElement("span",{class:"ck ck-clipboard-drop-target-position"},function(o){const r=this.toDomElement(o);return r.innerHTML="&NoBreak;<span></span>&NoBreak;",r})}})}_updateDropMarker(e){const t=this.editor,n=t.model.markers;t.model.change(s=>{n.has("drop-target")?n.get("drop-target").getRange().isEqual(e)||s.updateMarker("drop-target",{range:e}):s.addMarker("drop-target",{range:e,usingOperation:!1,affectsData:!1})})}_removeDropMarker(){const e=this.editor.model;this._removeDropMarkerDelayed.cancel(),this._updateDropMarkerThrottled.cancel(),e.markers.has("drop-target")&&e.change(t=>{t.removeMarker("drop-target")})}_finalizeDragging(e){const t=this.editor,n=t.model;this._removeDropMarker(),this._clearDraggableAttributes(),t.plugins.has("WidgetToolbarRepository")&&t.plugins.get("WidgetToolbarRepository").clearForceDisabled("dragDrop"),this._draggingUid="",!!this._draggedRange&&(e&&this.isEnabled&&n.deleteContent(n.createSelection(this._draggedRange),{doNotAutoparagraph:!0}),this._draggedRange.detach(),this._draggedRange=null)}}function Pu(i,e,t){const n=i.model,s=i.editing.mapper;let o=null;const r=e?e[0].start:null;if(t.is("uiElement")&&(t=t.parent),o=EE(i,t),o)return o;const a=SE(i,t),l=r?s.toModelPosition(r):null;return l?(o=kE(i,l,a),o||(o=n.schema.getNearestSelectionRange(l,W.isGecko?"forward":"backward"),o)?o:AE(i,l.parent)):TE(i,a)}function EE(i,e){const t=i.model,n=i.editing.mapper;if(X(e))return t.createRangeOn(n.toModelElement(e));if(!e.is("editableElement")){const s=e.findAncestor(o=>X(o)||o.is("editableElement"));if(X(s))return t.createRangeOn(n.toModelElement(s))}return null}function TE(i,e){const t=i.model,n=t.schema,s=t.createPositionAt(e,0);return n.getNearestSelectionRange(s,"forward")}function kE(i,e,t){const n=i.model;if(!n.schema.checkChild(t,"$block"))return null;const s=n.createPositionAt(t,0),o=e.path.slice(0,s.path.length),a=n.createPositionFromPath(e.root,o).nodeAfter;return a&&n.schema.isObject(a)?n.createRangeOn(a):null}function AE(i,e){const t=i.model;for(;e;){if(t.schema.isObject(e))return t.createRangeOn(e);e=e.parent}}function SE(i,e){const t=i.editing.mapper,n=i.editing.view,s=t.toModelElement(e);if(s)return s;const o=n.createPositionBefore(e),r=t.findMappedViewAncestor(o);return t.toModelElement(r)}function xu(i){return W.isGecko?i.dropEffect:["all","copyMove"].includes(i.effectAllowed)?"move":"copy"}function Iu(i,e){let t;function n(...s){n.cancel(),t=setTimeout(()=>i(...s),e)}return n.cancel=()=>{clearTimeout(t)},n}function Ru(i){if(i.is("editableElement"))return null;if(i.hasClass("ck-widget__selection-handle"))return i.findAncestor(X);if(X(i))return i;const e=i.findAncestor(t=>X(t)||t.is("editableElement"));return X(e)?e:null}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class PE extends v{static get pluginName(){return"PastePlainText"}static get requires(){return[je]}init(){const e=this.editor,t=e.model,n=e.editing.view,s=n.document,o=t.document.selection;let r=!1;n.addObserver(po),this.listenTo(s,"keydown",(a,l)=>{r=l.shiftKey}),e.plugins.get(je).on("contentInsertion",(a,l)=>{!r&&!xE(l.content,t.schema)||t.change(c=>{const u=Array.from(o.getAttributes()).filter(([h])=>t.schema.getAttributeProperties(h).isFormatting);o.isCollapsed||t.deleteContent(o,{doNotAutoparagraph:!0}),u.push(...o.getAttributes());const d=c.createRangeIn(l.content);for(const h of d.getItems())h.is("$textProxy")&&c.setAttributes(u,h)})})}}function xE(i,e){if(i.childCount>1)return!1;const t=i.getChild(0);return e.isObject(t)?!1:[...t.getAttributeKeys()].length==0}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Mu extends v{static get pluginName(){return"Clipboard"}static get requires(){return[je,CE,PE]}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class IE extends R{execute(){const e=this.editor.model,t=e.document;e.change(n=>{ME(e,n,t.selection),this.fire("afterExecute",{writer:n})})}refresh(){const e=this.editor.model,t=e.document;this.isEnabled=RE(e.schema,t.selection)}}function RE(i,e){if(e.rangeCount>1)return!1;const t=e.anchor;if(!t||!i.checkChild(t,"softBreak"))return!1;const n=e.getFirstRange(),s=n.start.parent,o=n.end.parent;return!((vo(s,i)||vo(o,i))&&s!==o)}function ME(i,e,t){const n=t.isCollapsed,s=t.getFirstRange(),o=s.start.parent,r=s.end.parent,a=o==r;if(n){const l=hu(i.schema,t.getAttributes());Vu(i,e,s.end),e.removeSelectionAttribute(t.getAttributeKeys()),e.setSelectionAttribute(l)}else{const l=!(s.start.isAtStart&&s.end.isAtEnd);i.deleteContent(t,{leaveUnmerged:l}),a?Vu(i,e,t.focus):l&&e.setSelection(r,0)}}function Vu(i,e,t){const n=e.createElement("softBreak");i.insertContent(n,t),e.setSelection(n,"after")}function vo(i,e){return i.is("rootElement")?!1:e.isLimit(i)||vo(i.parent,e)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class VE extends v{static get pluginName(){return"ShiftEnter"}init(){const e=this.editor,t=e.model.schema,n=e.conversion,s=e.editing.view,o=s.document;t.register("softBreak",{allowWhere:"$text",isInline:!0}),n.for("upcast").elementToElement({model:"softBreak",view:"br"}),n.for("downcast").elementToElement({model:"softBreak",view:(r,{writer:a})=>a.createEmptyElement("br")}),s.addObserver(mu),e.commands.add("shiftEnter",new IE(e)),this.listenTo(o,"enter",(r,a)=>{a.preventDefault(),!!a.isSoft&&(e.execute("shiftEnter"),s.scrollToTheSelection())},{priority:"low"})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class OE extends R{constructor(e){super(e);this.affectsData=!1}execute(){const e=this.editor.model,t=e.document.selection;let n=e.schema.getLimitElement(t);if(t.containsEntireContent(n)||!Ou(e.schema,n))do if(n=n.parent,!n)return;while(!Ou(e.schema,n));e.change(s=>{s.setSelection(n,"in")})}}function Ou(i,e){return i.isLimit(e)&&(i.checkChild(e,"$text")||i.checkChild(e,"paragraph"))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const NE=Ps("Ctrl+A");class DE extends v{static get pluginName(){return"SelectAllEditing"}init(){const e=this.editor,n=e.editing.view.document;e.commands.add("selectAll",new OE(e)),this.listenTo(n,"keydown",(s,o)=>{$e(o)===NE&&(e.execute("selectAll"),o.preventDefault())})}}var BE='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M.75 15.5a.75.75 0 0 1 .75.75V18l.008.09A.5.5 0 0 0 2 18.5h1.75a.75.75 0 1 1 0 1.5H1.5l-.144-.007a1.5 1.5 0 0 1-1.35-1.349L0 18.5v-2.25a.75.75 0 0 1 .75-.75zm18.5 0a.75.75 0 0 1 .75.75v2.25l-.007.144a1.5 1.5 0 0 1-1.349 1.35L18.5 20h-2.25a.75.75 0 1 1 0-1.5H18a.5.5 0 0 0 .492-.41L18.5 18v-1.75a.75.75 0 0 1 .75-.75zm-10.45 3c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2H7.2a.2.2 0 0 1-.2-.2v-1.1c0-.11.09-.2.2-.2h1.6zm4 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2h-1.6a.2.2 0 0 1-.2-.2v-1.1c0-.11.09-.2.2-.2h1.6zm.45-5.5a.75.75 0 1 1 0 1.5h-8.5a.75.75 0 1 1 0-1.5h8.5zM1.3 11c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2H.2a.2.2 0 0 1-.2-.2v-1.6c0-.11.09-.2.2-.2h1.1zm18.5 0c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2h-1.1a.2.2 0 0 1-.2-.2v-1.6c0-.11.09-.2.2-.2h1.1zm-4.55-2a.75.75 0 1 1 0 1.5H4.75a.75.75 0 1 1 0-1.5h10.5zM1.3 7c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2H.2a.2.2 0 0 1-.2-.2V7.2c0-.11.09-.2.2-.2h1.1zm18.5 0c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2h-1.1a.2.2 0 0 1-.2-.2V7.2c0-.11.09-.2.2-.2h1.1zm-4.55-2a.75.75 0 1 1 0 1.5h-2.5a.75.75 0 1 1 0-1.5h2.5zm-5 0a.75.75 0 1 1 0 1.5h-5.5a.75.75 0 0 1 0-1.5h5.5zm-6.5-5a.75.75 0 0 1 0 1.5H2a.5.5 0 0 0-.492.41L1.5 2v1.75a.75.75 0 0 1-1.5 0V1.5l.007-.144A1.5 1.5 0 0 1 1.356.006L1.5 0h2.25zM18.5 0l.144.007a1.5 1.5 0 0 1 1.35 1.349L20 1.5v2.25a.75.75 0 1 1-1.5 0V2l-.008-.09A.5.5 0 0 0 18 1.5h-1.75a.75.75 0 1 1 0-1.5h2.25zM8.8 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2H7.2a.2.2 0 0 1-.2-.2V.2c0-.11.09-.2.2-.2h1.6zm4 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2h-1.6a.2.2 0 0 1-.2-.2V.2c0-.11.09-.2.2-.2h1.6z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class FE extends v{static get pluginName(){return"SelectAllUI"}init(){const e=this.editor;e.ui.componentFactory.add("selectAll",t=>{const n=e.commands.get("selectAll"),s=new U(t),o=t.t;return s.set({label:o("Select all"),icon:BE,keystroke:"Ctrl+A",tooltip:!0}),s.bind("isOn","isEnabled").to(n,"value","isEnabled"),this.listenTo(s,"execute",()=>{e.execute("selectAll"),e.editing.view.focus()}),s})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class LE extends v{static get requires(){return[DE,FE]}static get pluginName(){return"SelectAll"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class zE extends R{constructor(e,t){super(e);this._buffer=new gu(e.model,t),this._batches=new WeakSet}get buffer(){return this._buffer}destroy(){super.destroy(),this._buffer.destroy()}execute(e={}){const t=this.editor.model,n=t.document,s=e.text||"",o=s.length,r=e.range?t.createSelection(e.range):n.selection,a=e.resultRange;t.enqueueChange(this._buffer.batch,l=>{this._buffer.lock(),this._batches.add(this._buffer.batch),t.deleteContent(r),s&&t.insertContent(l.createText(s,n.selection.getAttributes()),r),a?l.setSelection(a):r.is("documentSelection")||l.setSelection(r),this._buffer.unlock(),this._buffer.input(o)})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function HE(i){i.editing.view.document.on("mutations",(e,t,n)=>{new $E(i).handle(t,n)})}class $E{constructor(e){this.editor=e,this.editing=this.editor.editing}handle(e,t){if(KC(e))this._handleContainerChildrenMutations(e,t);else for(const n of e)this._handleTextMutation(n,t),this._handleTextNodeInsertion(n)}_handleContainerChildrenMutations(e,t){const n=WE(e);if(!n)return;const o=this.editor.editing.view.domConverter.mapViewToDom(n),r=new oi(this.editor.editing.view.document),a=this.editor.data.toModel(r.domToView(o)).getChild(0),l=this.editor.editing.mapper.toModelElement(n);if(!l)return;const c=Array.from(a.getChildren()),u=Array.from(l.getChildren()),d=c[c.length-1],h=u[u.length-1],m=d&&d.is("element","softBreak"),g=h&&!h.is("element","softBreak");m&&g&&c.pop();const p=this.editor.model.schema;if(!Nu(c,p)||!Nu(u,p))return;const b=c.map(B=>B.is("$text")?B.data:"@").join("").replace(/\u00A0/g," "),C=u.map(B=>B.is("$text")?B.data:"@").join("").replace(/\u00A0/g," ");if(C===b)return;const E=ut(C,b),{firstChangeAt:I,insertions:N,deletions:K}=Du(E);let T=null;t&&(T=this.editing.mapper.toModelRange(t.getFirstRange()));const S=b.substr(I,N),k=this.editor.model.createRange(this.editor.model.createPositionAt(l,I),this.editor.model.createPositionAt(l,I+K));this.editor.execute("input",{text:S,range:k,resultRange:T})}_handleTextMutation(e,t){if(e.type!="text")return;const n=e.newText.replace(/\u00A0/g," "),s=e.oldText.replace(/\u00A0/g," ");if(s===n)return;const o=ut(s,n),{firstChangeAt:r,insertions:a,deletions:l}=Du(o);let c=null;t&&(c=this.editing.mapper.toModelRange(t.getFirstRange()));const u=this.editing.view.createPositionAt(e.node,r),d=this.editing.mapper.toModelPosition(u),h=this.editor.model.createRange(d,d.getShiftedBy(l)),m=n.substr(r,a);this.editor.execute("input",{text:m,range:h,resultRange:c})}_handleTextNodeInsertion(e){if(e.type!="children")return;const t=wu(e),n=this.editing.view.createPositionAt(e.node,t.index),s=this.editing.mapper.toModelPosition(n),o=t.values[0].data;this.editor.execute("input",{text:o.replace(/\u00A0/g," "),range:this.editor.model.createRange(s)})}}function WE(i){const e=i.map(t=>t.node).reduce((t,n)=>t.getCommonAncestor(n,{includeSelf:!0}));if(!!e)return e.getAncestors({includeSelf:!0,parentFirst:!0}).find(t=>t.is("containerElement")||t.is("rootElement"))}function Nu(i,e){return i.every(t=>e.isInline(t))}function Du(i){let e=null,t=null;for(let o=0;o<i.length;o++)i[o]!="equal"&&(e=e===null?o:e,t=o);let n=0,s=0;for(let o=e;o<=t;o++)i[o]!="insert"&&n++,i[o]!="delete"&&s++;return{insertions:s,deletions:n,firstChangeAt:e}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Bu extends v{static get pluginName(){return"Input"}init(){const e=this.editor,t=new zE(e,e.config.get("typing.undoStep")||20);e.commands.add("input",t),lE(e),HE(e)}isInput(e){return this.editor.commands.get("input")._batches.has(e)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class UE extends v{static get requires(){return[Bu,ft]}static get pluginName(){return"Typing"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Fu(i,e){let t=i.start;return{text:Array.from(i.getItems()).reduce((s,o)=>o.is("$text")||o.is("$textProxy")?s+o.data:(t=e.createPositionAfter(o),""),""),range:e.createRange(t,i.end)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class yo{constructor(e,t){this.model=e,this.testCallback=t,this.hasMatch=!1,this.set("isEnabled",!0),this.on("change:isEnabled",()=>{this.isEnabled?this._startListening():(this.stopListening(e.document.selection),this.stopListening(e.document))}),this._startListening()}_startListening(){const t=this.model.document;this.listenTo(t.selection,"change:range",(n,{directChange:s})=>{if(!!s){if(!t.selection.isCollapsed){this.hasMatch&&(this.fire("unmatched"),this.hasMatch=!1);return}this._evaluateTextBeforeSelection("selection")}}),this.listenTo(t,"change:data",(n,s)=>{s.type!="transparent"&&this._evaluateTextBeforeSelection("data",{batch:s})})}_evaluateTextBeforeSelection(e,t={}){const n=this.model,o=n.document.selection,r=n.createRange(n.createPositionAt(o.focus.parent,0),o.focus),{text:a,range:l}=Fu(r,n),c=this.testCallback(a);if(!c&&this.hasMatch&&this.fire("unmatched"),this.hasMatch=!!c,c){const u=Object.assign(t,{text:a,range:l});typeof c=="object"&&Object.assign(u,c),this.fire(`matched:${e}`,u)}}}A(yo,$);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ki extends v{static get pluginName(){return"TwoStepCaretMovement"}constructor(e){super(e);this.attributes=new Set,this._overrideUid=null}init(){const e=this.editor,t=e.model,n=e.editing.view,s=e.locale,o=t.document.selection;this.listenTo(n.document,"arrowKey",(r,a)=>{if(!o.isCollapsed||a.shiftKey||a.altKey||a.ctrlKey)return;const l=a.keyCode==V.arrowright,c=a.keyCode==V.arrowleft;if(!l&&!c)return;const u=s.contentLanguageDirection;let d=!1;u==="ltr"&&l||u==="rtl"&&c?d=this._handleForwardMovement(a):d=this._handleBackwardMovement(a),d===!0&&r.stop()},{context:"$text",priority:"highest"}),this._isNextGravityRestorationSkipped=!1,this.listenTo(o,"change:range",(r,a)=>{if(this._isNextGravityRestorationSkipped){this._isNextGravityRestorationSkipped=!1;return}!this._isGravityOverridden||!a.directChange&&Si(o.getFirstPosition(),this.attributes)||this._restoreGravity()})}registerAttribute(e){this.attributes.add(e)}_handleForwardMovement(e){const t=this.attributes,s=this.editor.model.document.selection,o=s.getFirstPosition();if(this._isGravityOverridden||o.isAtStart&&Co(s,t))return!1;if(Si(o,t))return Ai(e),this._overrideGravity(),!0}_handleBackwardMovement(e){const t=this.attributes,n=this.editor.model,s=n.document.selection,o=s.getFirstPosition();if(this._isGravityOverridden)return Ai(e),this._restoreGravity(),Eo(n,t,o),!0;if(o.isAtStart)return Co(s,t)?(Ai(e),Eo(n,t,o),!0):!1;if(qE(o,t))return o.isAtEnd&&!Co(s,t)&&Si(o,t)?(Ai(e),Eo(n,t,o),!0):(this._isNextGravityRestorationSkipped=!0,this._overrideGravity(),!1)}get _isGravityOverridden(){return!!this._overrideUid}_overrideGravity(){this._overrideUid=this.editor.model.change(e=>e.overrideSelectionGravity())}_restoreGravity(){this.editor.model.change(e=>{e.restoreSelectionGravity(this._overrideUid),this._overrideUid=null})}}function Co(i,e){for(const t of e)if(i.hasAttribute(t))return!0;return!1}function Eo(i,e,t){const n=t.nodeBefore;i.change(s=>{n?s.setSelectionAttribute(n.getAttributes()):s.removeSelectionAttribute(e)})}function Ai(i){i.preventDefault()}function qE(i,e){const t=i.getShiftedBy(-1);return Si(t,e)}function Si(i,e){const{nodeBefore:t,nodeAfter:n}=i;for(const s of e){const o=t?t.getAttribute(s):void 0;if((n?n.getAttribute(s):void 0)!==o)return!0}return!1}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const jE={copyright:{from:"(c)",to:"\xA9"},registeredTrademark:{from:"(r)",to:"\xAE"},trademark:{from:"(tm)",to:"\u2122"},oneHalf:{from:/(^|[^/a-z0-9])(1\/2)([^/a-z0-9])$/i,to:[null,"\xBD",null]},oneThird:{from:/(^|[^/a-z0-9])(1\/3)([^/a-z0-9])$/i,to:[null,"\u2153",null]},twoThirds:{from:/(^|[^/a-z0-9])(2\/3)([^/a-z0-9])$/i,to:[null,"\u2154",null]},oneForth:{from:/(^|[^/a-z0-9])(1\/4)([^/a-z0-9])$/i,to:[null,"\xBC",null]},threeQuarters:{from:/(^|[^/a-z0-9])(3\/4)([^/a-z0-9])$/i,to:[null,"\xBE",null]},lessThanOrEqual:{from:"<=",to:"\u2264"},greaterThanOrEqual:{from:">=",to:"\u2265"},notEqual:{from:"!=",to:"\u2260"},arrowLeft:{from:"<-",to:"\u2190"},arrowRight:{from:"->",to:"\u2192"},horizontalEllipsis:{from:"...",to:"\u2026"},enDash:{from:/(^| )(--)( )$/,to:[null,"\u2013",null]},emDash:{from:/(^| )(---)( )$/,to:[null,"\u2014",null]},quotesPrimary:{from:sn('"'),to:[null,"\u201C",null,"\u201D"]},quotesSecondary:{from:sn("'"),to:[null,"\u2018",null,"\u2019"]},quotesPrimaryEnGb:{from:sn("'"),to:[null,"\u2018",null,"\u2019"]},quotesSecondaryEnGb:{from:sn('"'),to:[null,"\u201C",null,"\u201D"]},quotesPrimaryPl:{from:sn('"'),to:[null,"\u201E",null,"\u201D"]},quotesSecondaryPl:{from:sn("'"),to:[null,"\u201A",null,"\u2019"]}},Lu={symbols:["copyright","registeredTrademark","trademark"],mathematical:["oneHalf","oneThird","twoThirds","oneForth","threeQuarters","lessThanOrEqual","greaterThanOrEqual","notEqual","arrowLeft","arrowRight"],typography:["horizontalEllipsis","enDash","emDash"],quotes:["quotesPrimary","quotesSecondary"]},KE=["symbols","mathematical","typography","quotes"];class GE extends v{static get requires(){return["Delete","Input"]}static get pluginName(){return"TextTransformation"}constructor(e){super(e);e.config.define("typing",{transformations:{include:KE}})}init(){const t=this.editor.model.document.selection;t.on("change:range",()=>{this.isEnabled=!t.anchor.parent.is("element","codeBlock")}),this._enableTransformationWatchers()}_enableTransformationWatchers(){const e=this.editor,t=e.model,n=e.plugins.get("Input"),s=e.plugins.get("Delete"),o=XE(e.config.get("typing.transformations")),r=c=>{for(const u of o)if(u.from.test(c))return{normalizedTransformation:u}},a=(c,u)=>{if(!n.isInput(u.batch))return;const{from:d,to:h}=u.normalizedTransformation,m=d.exec(u.text),g=h(m.slice(1)),p=u.range;let b=m.index;t.enqueueChange(C=>{for(let E=1;E<m.length;E++){const I=m[E],N=g[E-1];if(N==null){b+=I.length;continue}const K=p.start.getShiftedBy(b),T=t.createRange(K,K.getShiftedBy(I.length)),S=YE(K);t.insertContent(C.createText(N,S),T),b+=N.length}t.enqueueChange(()=>{s.requestUndoOnBackspace()})})},l=new yo(e.model,r);l.on("matched:data",a),l.bind("isEnabled").to(this)}}function JE(i){return typeof i=="string"?new RegExp(`(${f_(i)})$`):i}function QE(i){return typeof i=="string"?()=>[i]:i instanceof Array?()=>i:i}function YE(i){return(i.textNode?i.textNode:i.nodeAfter).getAttributes()}function sn(i){return new RegExp(`(^|\\s)(${i})([^${i}]*)(${i})$`)}function XE(i){const e=i.extra||[],t=i.remove||[],n=o=>!t.includes(o),s=i.include.concat(e).filter(n);return ZE(s).filter(n).map(o=>jE[o]||o).map(o=>({from:JE(o.from),to:QE(o.to)}))}function ZE(i){const e=new Set;for(const t of i)if(Lu[t])for(const n of Lu[t])e.add(n);else e.add(t);return Array.from(e)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function on(i,e,t,n){return n.createRange(zu(i,e,t,!0,n),zu(i,e,t,!1,n))}function zu(i,e,t,n,s){let o=i.textNode||(n?i.nodeBefore:i.nodeAfter),r=null;for(;o&&o.getAttribute(e)==t;)r=o,o=n?o.previousSibling:o.nextSibling;return r?s.createPositionAt(r,n?"before":"after"):i}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Hu(i,e,t,n){const s=i.editing.view,o=new Set;s.document.registerPostFixer(r=>{const a=i.model.document.selection;let l=!1;if(a.hasAttribute(e)){const c=on(a.getFirstPosition(),e,a.getAttribute(e),i.model),u=i.editing.mapper.toViewRange(c);for(const d of u.getItems())d.is("element",t)&&!d.hasClass(n)&&(r.addClass(n,d),o.add(d),l=!0)}return l}),i.conversion.for("editingDowncast").add(r=>{r.on("insert",a,{priority:"highest"}),r.on("remove",a,{priority:"highest"}),r.on("attribute",a,{priority:"highest"}),r.on("selection",a,{priority:"highest"});function a(){s.change(l=>{for(const c of o.values())l.removeClass(n,c),o.delete(c)})}})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class $u extends R{constructor(e){super(e);this._stack=[],this._createdBatches=new WeakSet,this.refresh(),this.listenTo(e.data,"set",(t,n)=>{n[1]=x({},n[1]);const s=n[1];s.batchType||(s.batchType="transparent")},{priority:"high"}),this.listenTo(e.data,"set",(t,n)=>{n[1].batchType==="transparent"&&this.clearStack()})}refresh(){this.isEnabled=this._stack.length>0}addBatch(e){const t=this.editor.model.document.selection,n={ranges:t.hasOwnRange?Array.from(t.getRanges()):[],isBackward:t.isBackward};this._stack.push({batch:e,selection:n}),this.refresh()}clearStack(){this._stack=[],this.refresh()}_restoreSelection(e,t,n){const s=this.editor.model,o=s.document,r=[],a=e.map(c=>c.getTransformedByOperations(n)),l=a.flat();for(const c of a){const u=c.filter(d=>d.root!=o.graveyard).filter(d=>!tT(d,l));!u.length||(eT(u),r.push(u[0]))}r.length&&s.change(c=>{c.setSelection(r,{backward:t})})}_undo(e,t){const n=this.editor.model,s=n.document;this._createdBatches.add(t);const o=e.operations.slice().filter(r=>r.isDocumentOperation);o.reverse();for(const r of o){const a=r.baseVersion+1,l=Array.from(s.history.getOperations(a)),u=MC([r.getReversed()],l,{useRelations:!0,document:this.editor.model.document,padWithNoOps:!1,forceWeakRemove:!0}).operationsA;for(const d of u)t.addOperation(d),n.applyOperation(d),s.history.setOperationAsUndone(r,d)}}}function eT(i){i.sort((e,t)=>e.start.isBefore(t.start)?-1:1);for(let e=1;e<i.length;e++){const n=i[e-1].getJoined(i[e],!0);n&&(e--,i.splice(e,2,n))}}function tT(i,e){return e.some(t=>t!==i&&t.containsRange(i,!0))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class nT extends $u{execute(e=null){const t=e?this._stack.findIndex(o=>o.batch==e):this._stack.length-1,n=this._stack.splice(t,1)[0],s=this.editor.model.createBatch("transparent");this.editor.model.enqueueChange(s,()=>{this._undo(n.batch,s);const o=this.editor.model.document.history.getOperations(n.batch.baseVersion);this._restoreSelection(n.selection.ranges,n.selection.isBackward,o),this.fire("revert",n.batch,s)}),this.refresh()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class iT extends $u{execute(){const e=this._stack.pop(),t=this.editor.model.createBatch("transparent");this.editor.model.enqueueChange(t,()=>{const s=e.batch.operations[e.batch.operations.length-1].baseVersion+1,o=this.editor.model.document.history.getOperations(s);this._restoreSelection(e.selection.ranges,e.selection.isBackward,o),this._undo(e.batch,t)}),this.refresh()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class sT extends v{static get pluginName(){return"UndoEditing"}constructor(e){super(e);this._batchRegistry=new WeakSet}init(){const e=this.editor;this._undoCommand=new nT(e),this._redoCommand=new iT(e),e.commands.add("undo",this._undoCommand),e.commands.add("redo",this._redoCommand),this.listenTo(e.model,"applyOperation",(t,n)=>{const s=n[0];if(!s.isDocumentOperation)return;const o=s.batch,r=this._redoCommand._createdBatches.has(o),a=this._undoCommand._createdBatches.has(o);this._batchRegistry.has(o)||o.type=="transparent"&&!r&&!a||(r?this._undoCommand.addBatch(o):a||(this._undoCommand.addBatch(o),this._redoCommand.clearStack()),this._batchRegistry.add(o))},{priority:"highest"}),this.listenTo(this._undoCommand,"revert",(t,n,s)=>{this._redoCommand.addBatch(s)}),e.keystrokes.set("CTRL+Z","undo"),e.keystrokes.set("CTRL+Y","redo"),e.keystrokes.set("CTRL+SHIFT+Z","redo")}}var Wu='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m5.042 9.367 2.189 1.837a.75.75 0 0 1-.965 1.149l-3.788-3.18a.747.747 0 0 1-.21-.284.75.75 0 0 1 .17-.945L6.23 4.762a.75.75 0 1 1 .964 1.15L4.863 7.866h8.917A.75.75 0 0 1 14 7.9a4 4 0 1 1-1.477 7.718l.344-1.489a2.5 2.5 0 1 0 1.094-4.73l.008-.032H5.042z"/></svg>',Uu='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m14.958 9.367-2.189 1.837a.75.75 0 0 0 .965 1.149l3.788-3.18a.747.747 0 0 0 .21-.284.75.75 0 0 0-.17-.945L13.77 4.762a.75.75 0 1 0-.964 1.15l2.331 1.955H6.22A.75.75 0 0 0 6 7.9a4 4 0 1 0 1.477 7.718l-.344-1.489A2.5 2.5 0 1 1 6.039 9.4l-.008-.032h8.927z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class oT extends v{static get pluginName(){return"UndoUI"}init(){const e=this.editor,t=e.locale,n=e.t,s=t.uiLanguageDirection=="ltr"?Wu:Uu,o=t.uiLanguageDirection=="ltr"?Uu:Wu;this._addButton("undo",n("Undo"),"CTRL+Z",s),this._addButton("redo",n("Redo"),"CTRL+Y",o)}_addButton(e,t,n,s){const o=this.editor;o.ui.componentFactory.add(e,r=>{const a=o.commands.get(e),l=new U(r);return l.set({label:t,icon:s,keystroke:n,tooltip:!0}),l.bind("isEnabled").to(a,"isEnabled"),this.listenTo(l,"execute",()=>{o.execute(e),o.editing.view.focus()}),l})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class qu extends v{static get requires(){return[sT,oT]}static get pluginName(){return"Undo"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class rT extends v{static get requires(){return[Mu,Ei,LE,VE,UE,qu]}static get pluginName(){return"Essentials"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ju{constructor(){const e=new window.FileReader;this._reader=e,this._data=void 0,this.set("loaded",0),e.onprogress=t=>{this.loaded=t.loaded}}get error(){return this._reader.error}get data(){return this._data}read(e){const t=this._reader;return this.total=e.size,new Promise((n,s)=>{t.onload=()=>{const o=t.result;this._data=o,n(o)},t.onerror=()=>{s("error")},t.onabort=()=>{s("aborted")},this._reader.readAsDataURL(e)})}abort(){this._reader.abort()}}A(ju,$);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ke extends v{static get pluginName(){return"FileRepository"}static get requires(){return[mi]}init(){this.loaders=new _e,this.loaders.on("add",()=>this._updatePendingAction()),this.loaders.on("remove",()=>this._updatePendingAction()),this._loadersMap=new Map,this._pendingAction=null,this.set("uploaded",0),this.set("uploadTotal",null),this.bind("uploadedPercent").to(this,"uploaded",this,"uploadTotal",(e,t)=>t?e/t*100:0)}getLoader(e){return this._loadersMap.get(e)||null}createLoader(e){if(!this.createUploadAdapter)return de("filerepository-no-upload-adapter"),null;const t=new To(Promise.resolve(e),this.createUploadAdapter);return this.loaders.add(t),this._loadersMap.set(e,t),e instanceof Promise&&t.file.then(n=>{this._loadersMap.set(n,t)}).catch(()=>{}),t.on("change:uploaded",()=>{let n=0;for(const s of this.loaders)n+=s.uploaded;this.uploaded=n}),t.on("change:uploadTotal",()=>{let n=0;for(const s of this.loaders)s.uploadTotal&&(n+=s.uploadTotal);this.uploadTotal=n}),t}destroyLoader(e){const t=e instanceof To?e:this.getLoader(e);t._destroy(),this.loaders.remove(t),this._loadersMap.forEach((n,s)=>{n===t&&this._loadersMap.delete(s)})}_updatePendingAction(){const e=this.editor.plugins.get(mi);if(this.loaders.length){if(!this._pendingAction){const t=this.editor.t,n=s=>`${t("Upload in progress")} ${parseInt(s)}%.`;this._pendingAction=e.add(n(this.uploadedPercent)),this._pendingAction.bind("message").to(this,"uploadedPercent",n)}}else e.remove(this._pendingAction),this._pendingAction=null}}A(Ke,$);class To{constructor(e,t){this.id=Be(),this._filePromiseWrapper=this._createFilePromiseWrapper(e),this._adapter=t(this),this._reader=new ju,this.set("status","idle"),this.set("uploaded",0),this.set("uploadTotal",null),this.bind("uploadedPercent").to(this,"uploaded",this,"uploadTotal",(n,s)=>s?n/s*100:0),this.set("uploadResponse",null)}get file(){return this._filePromiseWrapper?this._filePromiseWrapper.promise.then(e=>this._filePromiseWrapper?e:null):Promise.resolve(null)}get data(){return this._reader.data}read(){if(this.status!="idle")throw new f("filerepository-read-wrong-status",this);return this.status="reading",this.file.then(e=>this._reader.read(e)).then(e=>{if(this.status!=="reading")throw this.status;return this.status="idle",e}).catch(e=>{throw e==="aborted"?(this.status="aborted","aborted"):(this.status="error",this._reader.error?this._reader.error:e)})}upload(){if(this.status!="idle")throw new f("filerepository-upload-wrong-status",this);return this.status="uploading",this.file.then(()=>this._adapter.upload()).then(e=>(this.uploadResponse=e,this.status="idle",e)).catch(e=>{throw this.status==="aborted"?"aborted":(this.status="error",e)})}abort(){const e=this.status;this.status="aborted",this._filePromiseWrapper.isFulfilled?e=="reading"?this._reader.abort():e=="uploading"&&this._adapter.abort&&this._adapter.abort():(this._filePromiseWrapper.promise.catch(()=>{}),this._filePromiseWrapper.rejecter("aborted")),this._destroy()}_destroy(){this._filePromiseWrapper=void 0,this._reader=void 0,this._adapter=void 0,this.uploadResponse=void 0}_createFilePromiseWrapper(e){const t={};return t.promise=new Promise((n,s)=>{t.rejecter=s,t.isFulfilled=!1,e.then(o=>{t.isFulfilled=!0,n(o)}).catch(o=>{t.isFulfilled=!0,s(o)})}),t}}A(To,$);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class aT extends M{constructor(e){super(e);this.buttonView=new U(e),this._fileInputView=new lT(e),this._fileInputView.bind("acceptedType").to(this),this._fileInputView.bind("allowMultipleFiles").to(this),this._fileInputView.delegate("done").to(this),this.setTemplate({tag:"span",attributes:{class:"ck-file-dialog-button"},children:[this.buttonView,this._fileInputView]}),this.buttonView.on("execute",()=>{this._fileInputView.open()})}focus(){this.buttonView.focus()}}class lT extends M{constructor(e){super(e);this.set("acceptedType"),this.set("allowMultipleFiles",!1);const t=this.bindTemplate;this.setTemplate({tag:"input",attributes:{class:["ck-hidden"],type:"file",tabindex:"-1",accept:t.to("acceptedType"),multiple:t.to("allowMultipleFiles")},on:{change:t.to(()=>{this.element&&this.element.files&&this.element.files.length&&this.fire("done",this.element.files),this.element.value=""})}})}open(){this.element.click()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Ku="ckCsrfToken",Gu=40,Ju="abcdefghijklmnopqrstuvwxyz0123456789";function cT(){let i=uT(Ku);return(!i||i.length!=Gu)&&(i=hT(Gu),dT(Ku,i)),i}function uT(i){i=i.toLowerCase();const e=document.cookie.split(";");for(const t of e){const n=t.split("=");if(decodeURIComponent(n[0].trim().toLowerCase())===i)return decodeURIComponent(n[1])}return null}function dT(i,e){document.cookie=encodeURIComponent(i)+"="+encodeURIComponent(e)+";path=/"}function hT(i){let e="";const t=new Uint8Array(i);window.crypto.getRandomValues(t);for(let n=0;n<t.length;n++){const s=Ju.charAt(t[n]%Ju.length);e+=Math.random()>.5?s.toUpperCase():s}return e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class fT extends v{static get requires(){return[Ke]}static get pluginName(){return"CKFinderUploadAdapter"}init(){const e=this.editor.config.get("ckfinder.uploadUrl");!e||(this.editor.plugins.get(Ke).createUploadAdapter=t=>new mT(t,e,this.editor.t))}}class mT{constructor(e,t,n){this.loader=e,this.url=t,this.t=n}upload(){return this.loader.file.then(e=>new Promise((t,n)=>{this._initRequest(),this._initListeners(t,n,e),this._sendRequest(e)}))}abort(){this.xhr&&this.xhr.abort()}_initRequest(){const e=this.xhr=new XMLHttpRequest;e.open("POST",this.url,!0),e.responseType="json"}_initListeners(e,t,n){const s=this.xhr,o=this.loader,a=this.t("Cannot upload file:")+` ${n.name}.`;s.addEventListener("error",()=>t(a)),s.addEventListener("abort",()=>t()),s.addEventListener("load",()=>{const l=s.response;if(!l||!l.uploaded)return t(l&&l.error&&l.error.message?l.error.message:a);e({default:l.url})}),s.upload&&s.upload.addEventListener("progress",l=>{l.lengthComputable&&(o.uploadTotal=l.total,o.uploaded=l.loaded)})}_sendRequest(e){const t=new FormData;t.append("upload",e),t.append("ckCsrfToken",cT()),this.xhr.send(t)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function mt(i,e,t,n){let s,o=null;typeof n=="function"?s=n:(o=i.commands.get(n),s=()=>{i.execute(n)}),i.model.document.on("change:data",(r,a)=>{if(o&&!o.isEnabled||!e.isEnabled)return;const l=ge(i.model.document.selection.getRanges());if(!l.isCollapsed||a.type=="transparent")return;const c=Array.from(i.model.document.differ.getChanges()),u=c[0];if(c.length!=1||u.type!=="insert"||u.name!="$text"||u.length!=1)return;const d=u.position.parent;if(d.is("element","codeBlock")||d.is("element","listItem")&&typeof n!="function"&&!["numberedList","bulletedList","todoList"].includes(n)||o&&o.value===!0)return;const h=d.getChild(0),m=i.model.createRangeOn(h);if(!m.containsRange(l)&&!l.end.isEqual(m.end))return;const g=t.exec(h.data.substr(0,l.end.offset));!g||i.model.enqueueChange(p=>{const b=p.createPositionAt(d,0),C=p.createPositionAt(d,g[0].length),E=new qe(b,C);if(s({match:g})!==!1){p.remove(E);const N=i.model.document.selection.getFirstRange(),K=p.createRangeIn(d);d.isEmpty&&!K.isEqual(N)&&!K.containsRange(N,!0)&&p.remove(d)}E.detach(),i.model.enqueueChange(()=>{i.plugins.get("Delete").requestUndoOnBackspace()})})})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function rn(i,e,t,n){let s,o;t instanceof RegExp?s=t:o=t,o=o||(r=>{let a;const l=[],c=[];for(;(a=s.exec(r))!==null&&!(a&&a.length<4);){let{index:u,"1":d,"2":h,"3":m}=a;const g=d+h+m;u+=a[0].length-g.length;const p=[u,u+d.length],b=[u+d.length+h.length,u+d.length+h.length+m.length];l.push(p),l.push(b),c.push([u+d.length,u+d.length+h.length])}return{remove:l,format:c}}),i.model.document.on("change:data",(r,a)=>{if(a.type=="transparent"||!e.isEnabled)return;const l=i.model,c=l.document.selection;if(!c.isCollapsed)return;const u=Array.from(l.document.differ.getChanges()),d=u[0];if(u.length!=1||d.type!=="insert"||d.name!="$text"||d.length!=1)return;const h=c.focus,m=h.parent,{text:g,range:p}=gT(l.createRange(l.createPositionAt(m,0),h),l),b=o(g),C=Qu(p.start,b.format,l),E=Qu(p.start,b.remove,l);!(C.length&&E.length)||l.enqueueChange(I=>{if(n(I,C)!==!1){for(const K of E.reverse())I.remove(K);l.enqueueChange(()=>{i.plugins.get("Delete").requestUndoOnBackspace()})}})})}function Qu(i,e,t){return e.filter(n=>n[0]!==void 0&&n[1]!==void 0).map(n=>t.createRange(i.getShiftedBy(n[0]),i.getShiftedBy(n[1])))}function gT(i,e){let t=i.start;return{text:Array.from(i.getItems()).reduce((s,o)=>!(o.is("$text")||o.is("$textProxy"))||o.getAttribute("code")?(t=e.createPositionAfter(o),""):s+o.data,""),range:e.createRange(t,i.end)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class pT extends v{static get requires(){return[ft]}static get pluginName(){return"Autoformat"}afterInit(){this._addListAutoformats(),this._addBasicStylesAutoformats(),this._addHeadingAutoformats(),this._addBlockQuoteAutoformats(),this._addCodeBlockAutoformats(),this._addHorizontalLineAutoformats()}_addListAutoformats(){const e=this.editor.commands;e.get("bulletedList")&&mt(this.editor,this,/^[*-]\s$/,"bulletedList"),e.get("numberedList")&&mt(this.editor,this,/^1[.|)]\s$/,"numberedList"),e.get("todoList")&&mt(this.editor,this,/^\[\s?\]\s$/,"todoList"),e.get("checkTodoList")&&mt(this.editor,this,/^\[\s?x\s?\]\s$/,()=>{this.editor.execute("todoList"),this.editor.execute("checkTodoList")})}_addBasicStylesAutoformats(){const e=this.editor.commands;if(e.get("bold")){const t=Pi(this.editor,"bold");rn(this.editor,this,/(?:^|\s)(\*\*)([^*]+)(\*\*)$/g,t),rn(this.editor,this,/(?:^|\s)(__)([^_]+)(__)$/g,t)}if(e.get("italic")){const t=Pi(this.editor,"italic");rn(this.editor,this,/(?:^|\s)(\*)([^*_]+)(\*)$/g,t),rn(this.editor,this,/(?:^|\s)(_)([^_]+)(_)$/g,t)}if(e.get("code")){const t=Pi(this.editor,"code");rn(this.editor,this,/(`)([^`]+)(`)$/g,t)}if(e.get("strikethrough")){const t=Pi(this.editor,"strikethrough");rn(this.editor,this,/(~~)([^~]+)(~~)$/g,t)}}_addHeadingAutoformats(){const e=this.editor.commands.get("heading");e&&e.modelElements.filter(t=>t.match(/^heading[1-6]$/)).forEach(t=>{const n=t[7],s=new RegExp(`^(#{${n}})\\s$`);mt(this.editor,this,s,()=>{if(!e.isEnabled||e.value===t)return!1;this.editor.execute("heading",{value:t})})})}_addBlockQuoteAutoformats(){this.editor.commands.get("blockQuote")&&mt(this.editor,this,/^>\s$/,"blockQuote")}_addCodeBlockAutoformats(){const e=this.editor,t=e.model.document.selection;e.commands.get("codeBlock")&&mt(e,this,/^```$/,()=>{if(t.getFirstPosition().parent.is("element","listItem"))return!1;this.editor.execute("codeBlock",{usePreviousLanguageChoice:!0})})}_addHorizontalLineAutoformats(){this.editor.commands.get("horizontalLine")&&mt(this.editor,this,/^---$/,"horizontalLine")}}function Pi(i,e){return(t,n)=>{if(!i.commands.get(e).isEnabled)return!1;const o=i.model.schema.getValidRanges(n,e);for(const r of o)t.setAttribute(e,!0,r);t.removeSelectionAttribute(e)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ko extends R{constructor(e,t){super(e);this.attributeKey=t}refresh(){const e=this.editor.model,t=e.document;this.value=this._getValueFromFirstAllowedNode(),this.isEnabled=e.schema.checkAttributeInSelection(t.selection,this.attributeKey)}execute(e={}){const t=this.editor.model,s=t.document.selection,o=e.forceValue===void 0?!this.value:e.forceValue;t.change(r=>{if(s.isCollapsed)o?r.setSelectionAttribute(this.attributeKey,!0):r.removeSelectionAttribute(this.attributeKey);else{const a=t.schema.getValidRanges(s.getRanges(),this.attributeKey);for(const l of a)o?r.setAttribute(this.attributeKey,o,l):r.removeAttribute(this.attributeKey,l)}})}_getValueFromFirstAllowedNode(){const e=this.editor.model,t=e.schema,n=e.document.selection;if(n.isCollapsed)return n.hasAttribute(this.attributeKey);for(const s of n.getRanges())for(const o of s.getItems())if(t.checkAttribute(o,this.attributeKey))return o.hasAttribute(this.attributeKey);return!1}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const an="bold";class wT extends v{static get pluginName(){return"BoldEditing"}init(){const e=this.editor;e.model.schema.extend("$text",{allowAttributes:an}),e.model.schema.setAttributeProperties(an,{isFormatting:!0,copyOnEnter:!0}),e.conversion.attributeToElement({model:an,view:"strong",upcastAlso:["b",t=>{const n=t.getStyle("font-weight");if(!n)return null;if(n=="bold"||Number(n)>=600)return{name:!0,styles:["font-weight"]}}]}),e.commands.add(an,new ko(e,an)),e.keystrokes.set("CTRL+B",an)}}var bT='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.187 17H5.773c-.637 0-1.092-.138-1.364-.415-.273-.277-.409-.718-.409-1.323V4.738c0-.617.14-1.062.419-1.332.279-.27.73-.406 1.354-.406h4.68c.69 0 1.288.041 1.793.124.506.083.96.242 1.36.478.341.197.644.447.906.75a3.262 3.262 0 0 1 .808 2.162c0 1.401-.722 2.426-2.167 3.075C15.05 10.175 16 11.315 16 13.01a3.756 3.756 0 0 1-2.296 3.504 6.1 6.1 0 0 1-1.517.377c-.571.073-1.238.11-2 .11zm-.217-6.217H7v4.087h3.069c1.977 0 2.965-.69 2.965-2.072 0-.707-.256-1.22-.768-1.537-.512-.319-1.277-.478-2.296-.478zM7 5.13v3.619h2.606c.729 0 1.292-.067 1.69-.2a1.6 1.6 0 0 0 .91-.765c.165-.267.247-.566.247-.897 0-.707-.26-1.176-.778-1.409-.519-.232-1.31-.348-2.375-.348H7z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Ao="bold";class _T extends v{static get pluginName(){return"BoldUI"}init(){const e=this.editor,t=e.t;e.ui.componentFactory.add(Ao,n=>{const s=e.commands.get(Ao),o=new U(n);return o.set({label:t("Bold"),icon:bT,keystroke:"CTRL+B",tooltip:!0,isToggleable:!0}),o.bind("isOn","isEnabled").to(s,"value","isEnabled"),this.listenTo(o,"execute",()=>{e.execute(Ao),e.editing.view.focus()}),o})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class vT extends v{static get requires(){return[wT,_T]}static get pluginName(){return"Bold"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Nt="code",yT="ck-code_selected";class CT extends v{static get pluginName(){return"CodeEditing"}static get requires(){return[ki]}init(){const e=this.editor;e.model.schema.extend("$text",{allowAttributes:Nt}),e.model.schema.setAttributeProperties(Nt,{isFormatting:!0,copyOnEnter:!1}),e.conversion.attributeToElement({model:Nt,view:"code",upcastAlso:{styles:{"word-wrap":"break-word"}}}),e.commands.add(Nt,new ko(e,Nt)),e.plugins.get(ki).registerAttribute(Nt),Hu(e,Nt,"code",yT)}}var ET='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m12.5 5.7 5.2 3.9v1.3l-5.6 4c-.1.2-.3.2-.5.2-.3-.1-.6-.7-.6-1l.3-.4 4.7-3.5L11.5 7l-.2-.2c-.1-.3-.1-.6 0-.8.2-.2.5-.4.8-.4a.8.8 0 0 1 .4.1zm-5.2 0L2 9.6v1.3l5.6 4c.1.2.3.2.5.2.3-.1.7-.7.6-1 0-.1 0-.3-.2-.4l-5-3.5L8.2 7l.2-.2c.1-.3.1-.6 0-.8-.2-.2-.5-.4-.8-.4a.8.8 0 0 0-.3.1z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const So="code";class TT extends v{static get pluginName(){return"CodeUI"}init(){const e=this.editor,t=e.t;e.ui.componentFactory.add(So,n=>{const s=e.commands.get(So),o=new U(n);return o.set({label:t("Code"),icon:ET,tooltip:!0,isToggleable:!0}),o.bind("isOn","isEnabled").to(s,"value","isEnabled"),this.listenTo(o,"execute",()=>{e.execute(So),e.editing.view.focus()}),o})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class kT extends v{static get requires(){return[CT,TT]}static get pluginName(){return"Code"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const ln="italic";class AT extends v{static get pluginName(){return"ItalicEditing"}init(){const e=this.editor;e.model.schema.extend("$text",{allowAttributes:ln}),e.model.schema.setAttributeProperties(ln,{isFormatting:!0,copyOnEnter:!0}),e.conversion.attributeToElement({model:ln,view:"i",upcastAlso:["em",{styles:{"font-style":"italic"}}]}),e.commands.add(ln,new ko(e,ln)),e.keystrokes.set("CTRL+I",ln)}}var ST='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m9.586 14.633.021.004c-.036.335.095.655.393.962.082.083.173.15.274.201h1.474a.6.6 0 1 1 0 1.2H5.304a.6.6 0 0 1 0-1.2h1.15c.474-.07.809-.182 1.005-.334.157-.122.291-.32.404-.597l2.416-9.55a1.053 1.053 0 0 0-.281-.823 1.12 1.12 0 0 0-.442-.296H8.15a.6.6 0 0 1 0-1.2h6.443a.6.6 0 1 1 0 1.2h-1.195c-.376.056-.65.155-.823.296-.215.175-.423.439-.623.79l-2.366 9.347z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Po="italic";class PT extends v{static get pluginName(){return"ItalicUI"}init(){const e=this.editor,t=e.t;e.ui.componentFactory.add(Po,n=>{const s=e.commands.get(Po),o=new U(n);return o.set({label:t("Italic"),icon:ST,keystroke:"CTRL+I",tooltip:!0,isToggleable:!0}),o.bind("isOn","isEnabled").to(s,"value","isEnabled"),this.listenTo(o,"execute",()=>{e.execute(Po),e.editing.view.focus()}),o})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class xT extends v{static get requires(){return[AT,PT]}static get pluginName(){return"Italic"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class IT extends R{refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(e={}){const t=this.editor.model,n=t.schema,s=t.document.selection,o=Array.from(s.getSelectedBlocks()),r=e.forceValue===void 0?!this.value:e.forceValue;t.change(a=>{if(!r)this._removeQuote(a,o.filter(xi));else{const l=o.filter(c=>xi(c)||Xu(n,c));this._applyQuote(a,l)}})}_getValue(){const e=this.editor.model.document.selection,t=ge(e.getSelectedBlocks());return!!(t&&xi(t))}_checkEnabled(){if(this.value)return!0;const e=this.editor.model.document.selection,t=this.editor.model.schema,n=ge(e.getSelectedBlocks());return n?Xu(t,n):!1}_removeQuote(e,t){Yu(e,t).reverse().forEach(n=>{if(n.start.isAtStart&&n.end.isAtEnd){e.unwrap(n.start.parent);return}if(n.start.isAtStart){const o=e.createPositionBefore(n.start.parent);e.move(n,o);return}n.end.isAtEnd||e.split(n.end);const s=e.createPositionAfter(n.end.parent);e.move(n,s)})}_applyQuote(e,t){const n=[];Yu(e,t).reverse().forEach(s=>{let o=xi(s.start);o||(o=e.createElement("blockQuote"),e.wrap(s,o)),n.push(o)}),n.reverse().reduce((s,o)=>s.nextSibling==o?(e.merge(e.createPositionAfter(s)),s):o)}}function xi(i){return i.parent.name=="blockQuote"?i.parent:null}function Yu(i,e){let t,n=0;const s=[];for(;n<e.length;){const o=e[n],r=e[n+1];t||(t=i.createPositionBefore(o)),(!r||o.nextSibling!=r)&&(s.push(i.createRange(t,i.createPositionAfter(o))),t=null),n++}return s}function Xu(i,e){const t=i.checkChild(e.parent,"blockQuote"),n=i.checkChild(["$root","blockQuote"],e);return t&&n}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class RT extends v{static get pluginName(){return"BlockQuoteEditing"}static get requires(){return[Ei,ft]}init(){const e=this.editor,t=e.model.schema;e.commands.add("blockQuote",new IT(e)),t.register("blockQuote",{allowWhere:"$block",allowContentOf:"$root"}),e.conversion.elementToElement({model:"blockQuote",view:"blockquote"}),e.model.document.registerPostFixer(r=>{const a=e.model.document.differ.getChanges();for(const l of a)if(l.type=="insert"){const c=l.position.nodeAfter;if(!c)continue;if(c.is("element","blockQuote")&&c.isEmpty)return r.remove(c),!0;if(c.is("element","blockQuote")&&!t.checkChild(l.position,c))return r.unwrap(c),!0;if(c.is("element")){const u=r.createRangeIn(c);for(const d of u.getItems())if(d.is("element","blockQuote")&&!t.checkChild(r.createPositionBefore(d),d))return r.unwrap(d),!0}}else if(l.type=="remove"){const c=l.position.parent;if(c.is("element","blockQuote")&&c.isEmpty)return r.remove(c),!0}return!1});const n=this.editor.editing.view.document,s=e.model.document.selection,o=e.commands.get("blockQuote");this.listenTo(n,"enter",(r,a)=>{if(!s.isCollapsed||!o.value)return;s.getLastPosition().parent.isEmpty&&(e.execute("blockQuote"),e.editing.view.scrollToTheSelection(),a.preventDefault(),r.stop())},{context:"blockquote"}),this.listenTo(n,"delete",(r,a)=>{if(a.direction!="backward"||!s.isCollapsed||!o.value)return;const l=s.getLastPosition().parent;l.isEmpty&&!l.previousSibling&&(e.execute("blockQuote"),e.editing.view.scrollToTheSelection(),a.preventDefault(),r.stop())},{context:"blockquote"})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class MT extends v{static get pluginName(){return"BlockQuoteUI"}init(){const e=this.editor,t=e.t;e.ui.componentFactory.add("blockQuote",n=>{const s=e.commands.get("blockQuote"),o=new U(n);return o.set({label:t("Block quote"),icon:fe.quote,tooltip:!0,isToggleable:!0}),o.bind("isOn","isEnabled").to(s,"value","isEnabled"),this.listenTo(o,"execute",()=>{e.execute("blockQuote"),e.editing.view.focus()}),o})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class VT extends v{static get requires(){return[RT,MT]}static get pluginName(){return"BlockQuote"}}var OT='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M11.627 16.5zm5.873-.196zm0-7.001V8h-13v8.5h4.341c.191.54.457 1.044.785 1.5H2a1.5 1.5 0 0 1-1.5-1.5v-13A1.5 1.5 0 0 1 2 2h4.5a1.5 1.5 0 0 1 1.06.44L9.122 4H16a1.5 1.5 0 0 1 1.5 1.5v1A1.5 1.5 0 0 1 19 8v2.531a6.027 6.027 0 0 0-1.5-1.228zM16 6.5v-1H8.5l-2-2H2v13h1V8a1.5 1.5 0 0 1 1.5-1.5H16z"/><path d="M14.5 19.5a5 5 0 1 1 0-10 5 5 0 0 1 0 10zM15 14v-2h-1v2h-2v1h2v2h1v-2h2v-1h-2z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class NT extends v{static get pluginName(){return"CKFinderUI"}init(){const e=this.editor,t=e.ui.componentFactory,n=e.t;t.add("ckfinder",s=>{const o=e.commands.get("ckfinder"),r=new U(s);return r.set({label:n("Insert image or file"),icon:OT,tooltip:!0}),r.bind("isEnabled").to(o),r.on("execute",()=>{e.execute("ckfinder"),e.editing.view.focus()}),r})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class DT extends R{constructor(e){super(e);this.stopListening(this.editor.model.document,"change"),this.listenTo(this.editor.model.document,"change",()=>this.refresh(),{priority:"low"})}refresh(){const e=this.editor.commands.get("insertImage"),t=this.editor.commands.get("link");this.isEnabled=e.isEnabled||t.isEnabled}execute(){const e=this.editor,t=this.editor.config.get("ckfinder.openerMethod")||"modal";if(t!="popup"&&t!="modal")throw new f("ckfinder-unknown-openermethod",e);const n=this.editor.config.get("ckfinder.options")||{};n.chooseFiles=!0;const s=n.onInit;n.language||(n.language=e.locale.uiLanguage),n.onInit=o=>{s&&s(o),o.on("files:choose",r=>{const a=r.data.files.toArray(),l=a.filter(d=>!d.isImage()),c=a.filter(d=>d.isImage());for(const d of l)e.execute("link",d.getUrl());const u=[];for(const d of c){const h=d.getUrl();u.push(h||o.request("file:getProxyUrl",{file:d}))}u.length&&Zu(e,u)}),o.on("file:choose:resizedImage",r=>{const a=r.data.resizedUrl;if(!a){const l=e.plugins.get("Notification"),c=e.locale.t;l.showWarning(c("Could not obtain resized image URL."),{title:c("Selecting resized image failed"),namespace:"ckfinder"});return}Zu(e,[a])})},window.CKFinder[t](n)}}function Zu(i,e){if(!i.commands.get("insertImage").isEnabled){const n=i.plugins.get("Notification"),s=i.locale.t;n.showWarning(s("Could not insert image at the current position."),{title:s("Inserting image failed"),namespace:"ckfinder"});return}i.execute("insertImage",{source:e})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class BT extends v{static get pluginName(){return"CKFinderEditing"}static get requires(){return[fo,"LinkEditing"]}init(){const e=this.editor;if(!e.plugins.has("ImageBlockEditing")&&!e.plugins.has("ImageInlineEditing"))throw new f("ckfinder-missing-image-plugin",e);e.commands.add("ckfinder",new DT(e))}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class FT extends v{static get pluginName(){return"CKFinder"}static get requires(){return["Link","CKFinderUploadAdapter",BT,NT]}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class LT extends v{static get pluginName(){return"CloudServicesUploadAdapter"}static get requires(){return["CloudServices",Ke]}init(){const e=this.editor,t=e.plugins.get("CloudServices"),n=t.token,s=t.uploadUrl;!n||(this._uploadGateway=e.plugins.get("CloudServicesCore").createUploadGateway(n,s),e.plugins.get(Ke).createUploadAdapter=o=>new zT(this._uploadGateway,o))}}class zT{constructor(e,t){this.uploadGateway=e,this.loader=t}upload(){return this.loader.file.then(e=>(this.fileUploader=this.uploadGateway.upload(e),this.fileUploader.on("progress",(t,n)=>{this.loader.uploadTotal=n.total,this.loader.uploaded=n.uploaded}),this.fileUploader.send()))}abort(){this.fileUploader.abort()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class HT extends v{static get requires(){return[LT,"ImageUpload"]}init(){const e=this.editor;!e.plugins.has("ImageBlockEditing")&&!e.plugins.has("ImageInlineEditing")&&de("easy-image-image-feature-missing",e)}static get pluginName(){return"EasyImage"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class $T extends R{refresh(){const e=this.editor.model,t=e.document,n=ge(t.selection.getSelectedBlocks());this.value=!!n&&n.is("element","paragraph"),this.isEnabled=!!n&&ed(n,e.schema)}execute(e={}){const t=this.editor.model,n=t.document;t.change(s=>{const o=(e.selection||n.selection).getSelectedBlocks();for(const r of o)!r.is("element","paragraph")&&ed(r,t.schema)&&s.rename(r,"paragraph")})}}function ed(i,e){return e.checkChild(i.parent,"paragraph")&&!e.isObject(i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class WT extends R{execute(e){const t=this.editor.model;let n=e.position;t.change(s=>{const o=s.createElement("paragraph");if(!t.schema.checkChild(n.parent,o)){const r=t.schema.findAllowedParent(n,o);if(!r)return;n=s.split(n,r).position}t.insertContent(o,n),s.setSelection(o,"in")})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Nn extends v{static get pluginName(){return"Paragraph"}init(){const e=this.editor,t=e.model;e.commands.add("paragraph",new $T(e)),e.commands.add("insertParagraph",new WT(e)),t.schema.register("paragraph",{inheritAllFrom:"$block"}),e.conversion.elementToElement({model:"paragraph",view:"p"}),e.conversion.for("upcast").elementToElement({model:(n,{writer:s})=>!Nn.paragraphLikeElements.has(n.name)||n.isEmpty?null:s.createElement("paragraph"),view:/.+/,converterPriority:"low"})}}Nn.paragraphLikeElements=new Set(["blockquote","dd","div","dt","h1","h2","h3","h4","h5","h6","li","p","td","th"]);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class UT extends R{constructor(e,t){super(e);this.modelElements=t}refresh(){const e=ge(this.editor.model.document.selection.getSelectedBlocks());this.value=!!e&&this.modelElements.includes(e.name)&&e.name,this.isEnabled=!!e&&this.modelElements.some(t=>td(e,t,this.editor.model.schema))}execute(e){const t=this.editor.model,n=t.document,s=e.value;t.change(o=>{const r=Array.from(n.selection.getSelectedBlocks()).filter(a=>td(a,s,t.schema));for(const a of r)a.is("element",s)||o.rename(a,s)})}}function td(i,e,t){return t.checkChild(i.parent,e)&&!t.isObject(i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const xo="paragraph";class qT extends v{static get pluginName(){return"HeadingEditing"}constructor(e){super(e);e.config.define("heading",{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h2",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h3",title:"Heading 2",class:"ck-heading_heading2"},{model:"heading3",view:"h4",title:"Heading 3",class:"ck-heading_heading3"}]})}static get requires(){return[Nn]}init(){const e=this.editor,t=e.config.get("heading.options"),n=[];for(const s of t)s.model!==xo&&(e.model.schema.register(s.model,{inheritAllFrom:"$block"}),e.conversion.elementToElement(s),n.push(s.model));this._addDefaultH1Conversion(e),e.commands.add("heading",new UT(e,n))}afterInit(){const e=this.editor,t=e.commands.get("enter"),n=e.config.get("heading.options");t&&this.listenTo(t,"afterExecute",(s,o)=>{const r=e.model.document.selection.getFirstPosition().parent;n.some(l=>r.is("element",l.model))&&!r.is("element",xo)&&r.childCount===0&&o.writer.rename(r,xo)})}_addDefaultH1Conversion(e){e.conversion.for("upcast").elementToElement({model:"heading1",view:"h1",converterPriority:mn.get("low")+1})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function jT(i){const e=i.t,t={Paragraph:e("Paragraph"),"Heading 1":e("Heading 1"),"Heading 2":e("Heading 2"),"Heading 3":e("Heading 3"),"Heading 4":e("Heading 4"),"Heading 5":e("Heading 5"),"Heading 6":e("Heading 6")};return i.config.get("heading.options").map(n=>{const s=t[n.title];return s&&s!=n.title&&(n.title=s),n})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class KT extends v{static get pluginName(){return"HeadingUI"}init(){const e=this.editor,t=e.t,n=jT(e),s=t("Choose heading"),o=t("Heading");e.ui.componentFactory.add("heading",r=>{const a={},l=new _e,c=e.commands.get("heading"),u=e.commands.get("paragraph"),d=[c];for(const m of n){const g={type:"button",model:new bi({label:m.title,class:m.class,withText:!0})};m.model==="paragraph"?(g.model.bind("isOn").to(u,"value"),g.model.set("commandName","paragraph"),d.push(u)):(g.model.bind("isOn").to(c,"value",p=>p===m.model),g.model.set({commandName:"heading",commandValue:m.model})),l.add(g),a[m.model]=m.title}const h=ht(r);return co(h,l),h.buttonView.set({isOn:!1,withText:!0,tooltip:o}),h.extendTemplate({attributes:{class:["ck-heading-dropdown"]}}),h.bind("isEnabled").toMany(d,"isEnabled",(...m)=>m.some(g=>g)),h.buttonView.bind("label").to(c,"value",u,"value",(m,g)=>{const p=m||g&&"paragraph";return a[p]?a[p]:s}),this.listenTo(h,"execute",m=>{e.execute(m.source.commandName,m.source.commandValue?{value:m.source.commandValue}:void 0),e.editing.view.focus()}),h})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class GT extends v{static get requires(){return[qT,KT]}static get pluginName(){return"Heading"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ii extends v{static get requires(){return[vi]}static get pluginName(){return"WidgetToolbarRepository"}init(){const e=this.editor;if(e.plugins.has("BalloonToolbar")){const t=e.plugins.get("BalloonToolbar");this.listenTo(t,"show",n=>{JT(e.editing.view.document.selection)&&n.stop()},{priority:"high"})}this._toolbarDefinitions=new Map,this._balloon=this.editor.plugins.get("ContextualBalloon"),this.on("change:isEnabled",()=>{this._updateToolbarsVisibility()}),this.listenTo(e.ui,"update",()=>{this._updateToolbarsVisibility()}),this.listenTo(e.ui.focusTracker,"change:isFocused",()=>{this._updateToolbarsVisibility()},{priority:"low"})}destroy(){super.destroy();for(const e of this._toolbarDefinitions.values())e.view.destroy()}register(e,{ariaLabel:t,items:n,getRelatedElement:s,balloonClassName:o="ck-toolbar-container"}){if(!n.length){de("widget-toolbar-no-items",{toolbarId:e});return}const r=this.editor,a=r.t,l=new lo(r.locale);if(l.ariaLabel=t||a("Widget toolbar"),this._toolbarDefinitions.has(e))throw new f("widget-toolbar-duplicated",this,{toolbarId:e});l.fillFromConfig(n,r.ui.componentFactory),this._toolbarDefinitions.set(e,{view:l,getRelatedElement:s,balloonClassName:o})}_updateToolbarsVisibility(){let e=0,t=null,n=null;for(const s of this._toolbarDefinitions.values()){const o=s.getRelatedElement(this.editor.editing.view.document.selection);if(!this.isEnabled||!o)this._isToolbarInBalloon(s)&&this._hideToolbar(s);else if(!this.editor.ui.focusTracker.isFocused)this._isToolbarVisible(s)&&this._hideToolbar(s);else{const r=o.getAncestors().length;r>e&&(e=r,t=o,n=s)}}n&&this._showToolbar(n,t)}_hideToolbar(e){this._balloon.remove(e.view),this.stopListening(this._balloon,"change:visibleView")}_showToolbar(e,t){this._isToolbarVisible(e)?nd(this.editor,t):this._isToolbarInBalloon(e)||(this._balloon.add({view:e.view,position:id(this.editor,t),balloonClassName:e.balloonClassName}),this.listenTo(this._balloon,"change:visibleView",()=>{for(const n of this._toolbarDefinitions.values())if(this._isToolbarVisible(n)){const s=n.getRelatedElement(this.editor.editing.view.document.selection);nd(this.editor,s)}}))}_isToolbarVisible(e){return this._balloon.visibleView===e.view}_isToolbarInBalloon(e){return this._balloon.hasView(e.view)}}function nd(i,e){const t=i.plugins.get("ContextualBalloon"),n=id(i,e);t.updatePosition(n)}function id(i,e){const t=i.editing.view,n=be.defaultPositions;return{target:t.domConverter.mapViewToDom(e),positions:[n.northArrowSouth,n.northArrowSouthWest,n.northArrowSouthEast,n.southArrowNorth,n.southArrowNorthWest,n.southArrowNorthEast,n.viewportStickyNorth]}}function JT(i){const e=i.getSelectedElement();return!!(e&&X(e))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class sd{constructor(e){this.set("activeHandlePosition",null),this.set("proposedWidthPercents",null),this.set("proposedWidth",null),this.set("proposedHeight",null),this.set("proposedHandleHostWidth",null),this.set("proposedHandleHostHeight",null),this._options=e,this._referenceCoordinates=null}begin(e,t,n){const s=new F(t);this.activeHandlePosition=ZT(e),this._referenceCoordinates=YT(t,ek(this.activeHandlePosition)),this.originalWidth=s.width,this.originalHeight=s.height,this.aspectRatio=s.width/s.height;const o=n.style.width;o&&o.match(/^\d+(\.\d*)?%$/)?this.originalWidthPercents=parseFloat(o):this.originalWidthPercents=QT(n,s)}update(e){this.proposedWidth=e.width,this.proposedHeight=e.height,this.proposedWidthPercents=e.widthPercents,this.proposedHandleHostWidth=e.handleHostWidth,this.proposedHandleHostHeight=e.handleHostHeight}}A(sd,$);function QT(i,e){const t=i.parentElement,n=parseFloat(t.ownerDocument.defaultView.getComputedStyle(t).width);return e.width/n*100}function YT(i,e){const t=new F(i),n=e.split("-"),s={x:n[1]=="right"?t.right:t.left,y:n[0]=="bottom"?t.bottom:t.top};return s.x+=i.ownerDocument.defaultView.scrollX,s.y+=i.ownerDocument.defaultView.scrollY,s}function XT(i){return`ck-widget__resizer__handle-${i}`}function ZT(i){const e=["top-left","top-right","bottom-right","bottom-left"];for(const t of e)if(i.classList.contains(XT(t)))return t}function ek(i){const e=i.split("-"),t={top:"bottom",bottom:"top",left:"right",right:"left"};return`${t[e[0]]}-${t[e[1]]}`}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class tk extends M{constructor(){super();const e=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck","ck-size-view",e.to("_viewPosition",t=>t?`ck-orientation-${t}`:"")],style:{display:e.if("_isVisible","none",t=>!t)}},children:[{text:e.to("_label")}]})}_bindToState(e,t){this.bind("_isVisible").to(t,"proposedWidth",t,"proposedHeight",(n,s)=>n!==null&&s!==null),this.bind("_label").to(t,"proposedHandleHostWidth",t,"proposedHandleHostHeight",t,"proposedWidthPercents",(n,s,o)=>e.unit==="px"?`${n}\xD7${s}`:`${o}%`),this.bind("_viewPosition").to(t,"activeHandlePosition",t,"proposedHandleHostWidth",t,"proposedHandleHostHeight",(n,s,o)=>s<50||o<50?"above-center":n)}_dismiss(){this.unbind(),this._isVisible=!1}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Io{constructor(e){this._options=e,this._viewResizerWrapper=null,this.set("isEnabled",!0),this.decorate("begin"),this.decorate("cancel"),this.decorate("commit"),this.decorate("updateSize"),this.on("commit",t=>{!this.state.proposedWidth&&!this.state.proposedWidthPercents&&(this._cleanup(),t.stop())},{priority:"high"}),this.on("change:isEnabled",()=>{this.isEnabled&&this.redraw()})}attach(){const e=this,t=this._options.viewElement;this._options.editor.editing.view.change(s=>{const o=s.createUIElement("div",{class:"ck ck-reset_all ck-widget__resizer"},function(r){const a=this.toDomElement(r);return e._appendHandles(a),e._appendSizeUI(a),e.on("change:isEnabled",(l,c,u)=>{a.style.display=u?"":"none"}),a.style.display=e.isEnabled?"":"none",a});s.insert(s.createPositionAt(t,"end"),o),s.addClass("ck-widget_with-resizer",t),this._viewResizerWrapper=o})}begin(e){this.state=new sd(this._options),this._sizeView._bindToState(this._options,this.state),this._initialViewWidth=this._options.viewElement.getStyle("width"),this.state.begin(e,this._getHandleHost(),this._getResizeHost())}updateSize(e){const t=this._proposeNewSize(e);this._options.editor.editing.view.change(a=>{const l=this._options.unit||"%",c=(l==="%"?t.widthPercents:t.width)+l;a.setStyle("width",c,this._options.viewElement)});const s=this._getHandleHost(),o=new F(s);t.handleHostWidth=Math.round(o.width),t.handleHostHeight=Math.round(o.height);const r=new F(s);t.width=Math.round(r.width),t.height=Math.round(r.height),this.redraw(o),this.state.update(t)}commit(){const e=this._options.unit||"%",t=(e==="%"?this.state.proposedWidthPercents:this.state.proposedWidth)+e;this._options.editor.editing.view.change(()=>{this._cleanup(),this._options.onCommit(t)})}cancel(){this._cleanup()}destroy(){this.cancel()}redraw(e){const t=this._domResizerWrapper;if(!sk(t))return;const n=t.parentElement,s=this._getHandleHost(),o=this._viewResizerWrapper,r=[o.getStyle("width"),o.getStyle("height"),o.getStyle("left"),o.getStyle("top")];let a;if(n.isSameNode(s)){const l=e||new F(s);a=[l.width+"px",l.height+"px",void 0,void 0]}else a=[s.offsetWidth+"px",s.offsetHeight+"px",s.offsetLeft+"px",s.offsetTop+"px"];he(r,a)!=="same"&&this._options.editor.editing.view.change(l=>{l.setStyle({width:a[0],height:a[1],left:a[2],top:a[3]},o)})}containsHandle(e){return this._domResizerWrapper.contains(e)}static isResizeHandle(e){return e.classList.contains("ck-widget__resizer__handle")}_cleanup(){this._sizeView._dismiss(),this._options.editor.editing.view.change(t=>{t.setStyle("width",this._initialViewWidth,this._options.viewElement)})}_proposeNewSize(e){const t=this.state,n=ik(e),s=this._options.isCentered?this._options.isCentered(this):!0,o={x:t._referenceCoordinates.x-(n.x+t.originalWidth),y:n.y-t.originalHeight-t._referenceCoordinates.y};s&&t.activeHandlePosition.endsWith("-right")&&(o.x=n.x-(t._referenceCoordinates.x+t.originalWidth)),s&&(o.x*=2);const r={width:Math.abs(t.originalWidth+o.x),height:Math.abs(t.originalHeight+o.y)};r.dominant=r.width/t.aspectRatio>r.height?"width":"height",r.max=r[r.dominant];const a={width:r.width,height:r.height};return r.dominant=="width"?a.height=a.width/t.aspectRatio:a.width=a.height*t.aspectRatio,{width:Math.round(a.width),height:Math.round(a.height),widthPercents:Math.min(Math.round(t.originalWidthPercents/t.originalWidth*a.width*100)/100,100)}}_getResizeHost(){const e=this._domResizerWrapper.parentElement;return this._options.getResizeHost(e)}_getHandleHost(){const e=this._domResizerWrapper.parentElement;return this._options.getHandleHost(e)}get _domResizerWrapper(){return this._options.editor.editing.view.domConverter.mapViewToDom(this._viewResizerWrapper)}_appendHandles(e){const t=["top-left","top-right","bottom-right","bottom-left"];for(const n of t)e.appendChild(new Oe({tag:"div",attributes:{class:`ck-widget__resizer__handle ${nk(n)}`}}).render())}_appendSizeUI(e){this._sizeView=new tk,this._sizeView.render(),e.appendChild(this._sizeView.element)}}A(Io,$);function nk(i){return`ck-widget__resizer__handle-${i}`}function ik(i){return{x:i.pageX,y:i.pageY}}function sk(i){return i&&i.ownerDocument&&i.ownerDocument.contains(i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ri extends v{static get pluginName(){return"WidgetResize"}init(){const e=this.editor.editing,t=ee.window.document;this.set("visibleResizer",null),this.set("_activeResizer",null),this._resizers=new Map,e.view.addObserver(Ci),this._observer=Object.create(jt),this.listenTo(e.view.document,"mousedown",this._mouseDownListener.bind(this),{priority:"high"}),this._observer.listenTo(t,"mousemove",this._mouseMoveListener.bind(this)),this._observer.listenTo(t,"mouseup",this._mouseUpListener.bind(this));const n=()=>{this.visibleResizer&&this.visibleResizer.redraw()};this._redrawFocusedResizerThrottled=Fa(n,200),this.on("change:visibleResizer",n),this.editor.ui.on("update",this._redrawFocusedResizerThrottled),this.editor.model.document.on("change",()=>{for(const[o,r]of this._resizers)o.isAttached()||(this._resizers.delete(o),r.destroy())},{priority:"lowest"}),this._observer.listenTo(ee.window,"resize",this._redrawFocusedResizerThrottled);const s=this.editor.editing.view.document.selection;s.on("change",()=>{const o=s.getSelectedElement();this.visibleResizer=this.getResizerByViewElement(o)||null})}destroy(){this._observer.stopListening();for(const e of this._resizers.values())e.destroy();this._redrawFocusedResizerThrottled.cancel()}attachTo(e){const t=new Io(e),n=this.editor.plugins;if(t.attach(),n.has("WidgetToolbarRepository")){const r=n.get("WidgetToolbarRepository");t.on("begin",()=>{r.forceDisabled("resize")},{priority:"lowest"}),t.on("cancel",()=>{r.clearForceDisabled("resize")},{priority:"highest"}),t.on("commit",()=>{r.clearForceDisabled("resize")},{priority:"highest"})}this._resizers.set(e.viewElement,t);const o=this.editor.editing.view.document.selection.getSelectedElement();return this.getResizerByViewElement(o)==t&&(this.visibleResizer=t),t}getResizerByViewElement(e){return this._resizers.get(e)}_getResizerByHandle(e){for(const t of this._resizers.values())if(t.containsHandle(e))return t}_mouseDownListener(e,t){const n=t.domTarget;!Io.isResizeHandle(n)||(this._activeResizer=this._getResizerByHandle(n),this._activeResizer&&(this._activeResizer.begin(n),e.stop(),t.preventDefault()))}_mouseMoveListener(e,t){this._activeResizer&&this._activeResizer.updateSize(t)}_mouseUpListener(){this._activeResizer&&(this._activeResizer.commit(),this._activeResizer=null)}}A(Ri,$);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ok extends R{refresh(){const n=this.editor.plugins.get("ImageUtils").getClosestSelectedImageElement(this.editor.model.document.selection);this.isEnabled=!!n,this.isEnabled&&n.hasAttribute("alt")?this.value=n.getAttribute("alt"):this.value=!1}execute(e){const t=this.editor,n=t.plugins.get("ImageUtils"),s=t.model,o=n.getClosestSelectedImageElement(s.document.selection);s.change(r=>{r.setAttribute("alt",e.newValue,o)})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Ro(i,e){const t=i.createEmptyElement("img"),n=e==="imageBlock"?i.createContainerElement("figure",{class:"image"}):i.createContainerElement("span",{class:"image-inline"},{isAllowedInsideAttributeElement:!0});return i.insert(i.createPositionAt(n,0),t),n}function od(i,e){if(i.plugins.has("ImageInlineEditing")!==i.plugins.has("ImageBlockEditing"))return{name:"img"};const t=i.plugins.get("ImageUtils");return n=>!t.isInlineImageView(n)||(n.findAncestor(t.isBlockImageView)?"imageBlock":"imageInline")!==e?null:{name:!0}}function Mo(i,e){const t=ge(e.getSelectedBlocks());return!t||i.isObject(t)||t.isEmpty&&t.name!="listItem"?"imageBlock":"imageInline"}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ne extends v{static get pluginName(){return"ImageUtils"}isImage(e){return this.isInlineImage(e)||this.isBlockImage(e)}isInlineImageView(e){return!!e&&e.is("element","img")}isBlockImageView(e){return!!e&&e.is("element","figure")&&e.hasClass("image")}insertImage(e={},t=null,n=null){const s=this.editor,o=s.model,r=o.document.selection;n=rd(s,t||r,n),e=x(x({},Object.fromEntries(r.getAttributes())),e);for(const a in e)o.schema.checkAttribute(n,a)||delete e[a];return o.change(a=>{const l=a.createElement(n,e);return!t&&n!="imageInline"&&(t=tn(r,o)),o.insertContent(l,t),l.parent?(a.setSelection(l,"on"),l):null})}getClosestSelectedImageWidget(e){const t=e.getSelectedElement();if(t&&this.isImageWidget(t))return t;let n=e.getFirstPosition().parent;for(;n;){if(n.is("element")&&this.isImageWidget(n))return n;n=n.parent}return null}getClosestSelectedImageElement(e){const t=e.getSelectedElement();return this.isImage(t)?t:e.getFirstPosition().findAncestor("imageBlock")}isImageAllowed(){const t=this.editor.model.document.selection;return rk(this.editor,t)&&ak(t)}toImageWidget(e,t,n){return t.setCustomProperty("image",!0,e),bo(e,t,{label:()=>{const r=this.findViewImgElement(e).getAttribute("alt");return r?`${r} ${n}`:n}})}isImageWidget(e){return!!e.getCustomProperty("image")&&X(e)}isBlockImage(e){return!!e&&e.is("element","imageBlock")}isInlineImage(e){return!!e&&e.is("element","imageInline")}findViewImgElement(e){if(this.isInlineImageView(e))return e;const t=this.editor.editing.view;for(const{item:n}of t.createRangeIn(e))if(this.isInlineImageView(n))return n}}function rk(i,e){if(rd(i,e)=="imageBlock"){const n=lk(e,i.model);if(i.model.schema.checkChild(n,"imageBlock"))return!0}else if(i.model.schema.checkChild(e.focus,"imageInline"))return!0;return!1}function ak(i){return[...i.focus.getAncestors()].every(e=>!e.is("element","imageBlock"))}function lk(i,e){const n=tn(i,e).start.parent;return n.isEmpty&&!n.is("element","$root")?n.parent:n}function rd(i,e,t){const n=i.model.schema,s=i.config.get("image.insert.type");return i.plugins.has("ImageBlockEditing")?i.plugins.has("ImageInlineEditing")?t||(s==="inline"?"imageInline":s==="block"?"imageBlock":e.is("selection")?Mo(n,e):n.checkChild(e,"imageInline")?"imageInline":"imageBlock"):"imageBlock":"imageInline"}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ck extends v{static get requires(){return[Ne]}static get pluginName(){return"ImageTextAlternativeEditing"}init(){this.editor.commands.add("imageTextAlternative",new ok(this.editor))}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class uk extends M{constructor(e){super(e);const t=this.locale.t;this.focusTracker=new Ae,this.keystrokes=new et,this.labeledInput=this._createLabeledInputView(),this.saveButtonView=this._createButton(t("Save"),fe.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(t("Cancel"),fe.cancel,"ck-button-cancel","cancel"),this._focusables=new Mt,this._focusCycler=new Yt({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"form",attributes:{class:["ck","ck-text-alternative-form","ck-responsive-form"],tabindex:"-1"},children:[this.labeledInput,this.saveButtonView,this.cancelButtonView]}),eo(this)}render(){super.render(),this.keystrokes.listenTo(this.element),to({view:this}),[this.labeledInput,this.saveButtonView,this.cancelButtonView].forEach(e=>{this._focusables.add(e),this.focusTracker.add(e.element)})}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createButton(e,t,n,s){const o=new U(this.locale);return o.set({label:e,icon:t,tooltip:!0}),o.extendTemplate({attributes:{class:n}}),s&&o.delegate("execute").to(this,s),o}_createLabeledInputView(){const e=this.locale.t,t=new uo(this.locale,ho);return t.label=e("Text alternative"),t}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function dk(i){const e=i.plugins.get("ContextualBalloon");if(i.plugins.get("ImageUtils").getClosestSelectedImageWidget(i.editing.view.document.selection)){const t=ad(i);e.updatePosition(t)}}function ad(i){const e=i.editing.view,t=be.defaultPositions,n=i.plugins.get("ImageUtils");return{target:e.domConverter.viewToDom(n.getClosestSelectedImageWidget(e.document.selection)),positions:[t.northArrowSouth,t.northArrowSouthWest,t.northArrowSouthEast,t.southArrowNorth,t.southArrowNorthWest,t.southArrowNorthEast,t.viewportStickyNorth]}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class hk extends v{static get requires(){return[vi]}static get pluginName(){return"ImageTextAlternativeUI"}init(){this._createButton(),this._createForm()}destroy(){super.destroy(),this._form.destroy()}_createButton(){const e=this.editor,t=e.t;e.ui.componentFactory.add("imageTextAlternative",n=>{const s=e.commands.get("imageTextAlternative"),o=new U(n);return o.set({label:t("Change image text alternative"),icon:fe.lowVision,tooltip:!0}),o.bind("isEnabled").to(s,"isEnabled"),this.listenTo(o,"execute",()=>{this._showForm()}),o})}_createForm(){const e=this.editor,n=e.editing.view.document,s=e.plugins.get("ImageUtils");this._balloon=this.editor.plugins.get("ContextualBalloon"),this._form=new uk(e.locale),this._form.render(),this.listenTo(this._form,"submit",()=>{e.execute("imageTextAlternative",{newValue:this._form.labeledInput.fieldView.element.value}),this._hideForm(!0)}),this.listenTo(this._form,"cancel",()=>{this._hideForm(!0)}),this._form.keystrokes.set("Esc",(o,r)=>{this._hideForm(!0),r()}),this.listenTo(e.ui,"update",()=>{s.getClosestSelectedImageWidget(n.selection)?this._isVisible&&dk(e):this._hideForm(!0)}),Zs({emitter:this._form,activator:()=>this._isVisible,contextElements:[this._balloon.view.element],callback:()=>this._hideForm()})}_showForm(){if(this._isVisible)return;const e=this.editor,t=e.commands.get("imageTextAlternative"),n=this._form.labeledInput;this._form.disableCssTransitions(),this._isInBalloon||this._balloon.add({view:this._form,position:ad(e)}),n.fieldView.value=n.fieldView.element.value=t.value||"",this._form.labeledInput.fieldView.select(),this._form.enableCssTransitions()}_hideForm(e){!this._isInBalloon||(this._form.focusTracker.isFocused&&this._form.saveButtonView.focus(),this._balloon.remove(this._form),e&&this.editor.editing.view.focus())}get _isVisible(){return this._balloon.visibleView===this._form}get _isInBalloon(){return this._balloon.hasView(this._form)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ld extends v{static get requires(){return[ck,hk]}static get pluginName(){return"ImageTextAlternative"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function fk(i){return t=>{t.on("element:figure",e)};function e(t,n,s){if(!s.consumable.test(n.viewItem,{name:!0,classes:"image"}))return;const o=i.findViewImgElement(n.viewItem);if(!o||!s.consumable.test(o,{name:!0}))return;s.consumable.consume(n.viewItem,{name:!0,classes:"image"});const r=s.convertItem(o,n.modelCursor),a=ge(r.modelRange.getItems());if(!a){s.consumable.revert(n.viewItem,{name:!0,classes:"image"});return}s.convertChildren(n.viewItem,a),s.updateConversionResult(a,n)}}function cd(i,e){return n=>{n.on(`attribute:srcset:${e}`,t)};function t(n,s,o){if(!o.consumable.consume(s.item,n.name))return;const r=o.writer,a=o.mapper.toViewElement(s.item),l=i.findViewImgElement(a);if(s.attributeNewValue===null){const c=s.attributeOldValue;c.data&&(r.removeAttribute("srcset",l),r.removeAttribute("sizes",l),c.width&&r.removeAttribute("width",l))}else{const c=s.attributeNewValue;c.data&&(r.setAttribute("srcset",c.data,l),r.setAttribute("sizes","100vw",l),c.width&&r.setAttribute("width",c.width,l))}}}function Mi(i,e,t){return s=>{s.on(`attribute:${t}:${e}`,n)};function n(s,o,r){if(!r.consumable.consume(o.item,s.name))return;const a=r.writer,l=r.mapper.toViewElement(o.item),c=i.findViewImgElement(l);a.setAttribute(o.attributeKey,o.attributeNewValue||"",c)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ud extends Ze{observe(e){this.listenTo(e,"load",(t,n)=>{const s=n.target;this.checkShouldIgnoreEventFromTarget(s)||s.tagName=="IMG"&&this._fireEvents(n)},{useCapture:!0})}_fireEvents(e){this.isEnabled&&(this.document.fire("layoutChanged"),this.document.fire("imageLoaded",e))}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class mk extends R{constructor(e){super(e);const t=e.config.get("image.insert.type");e.plugins.has("ImageBlockEditing")||t==="block"&&de("image-block-plugin-required"),e.plugins.has("ImageInlineEditing")||t==="inline"&&de("image-inline-plugin-required")}refresh(){this.isEnabled=this.editor.plugins.get("ImageUtils").isImageAllowed()}execute(e){const t=oe(e.source),n=this.editor.model.document.selection,s=this.editor.plugins.get("ImageUtils"),o=Object.fromEntries(n.getAttributes());t.forEach((r,a)=>{const l=n.getSelectedElement();if(typeof r=="string"&&(r={src:r}),a&&l&&s.isImage(l)){const c=this.editor.model.createPositionAfter(l);s.insertImage(x(x({},r),o),c)}else s.insertImage(x(x({},r),o))})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class dd extends v{static get requires(){return[Ne]}static get pluginName(){return"ImageEditing"}init(){const e=this.editor,t=e.conversion;e.editing.view.addObserver(ud),t.for("upcast").attributeToAttribute({view:{name:"img",key:"alt"},model:"alt"}).attributeToAttribute({view:{name:"img",key:"srcset"},model:{key:"srcset",value:s=>{const o={data:s.getAttribute("srcset")};return s.hasAttribute("width")&&(o.width=s.getAttribute("width")),o}}});const n=new mk(e);e.commands.add("insertImage",n),e.commands.add("imageInsert",n)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class hd extends R{constructor(e,t){super(e);this._modelElementName=t}refresh(){const t=this.editor.plugins.get("ImageUtils"),n=t.getClosestSelectedImageElement(this.editor.model.document.selection);this._modelElementName==="imageBlock"?this.isEnabled=t.isInlineImage(n):this.isEnabled=t.isBlockImage(n)}execute(){const e=this.editor,t=this.editor.model,n=e.plugins.get("ImageUtils"),s=n.getClosestSelectedImageElement(t.document.selection),o=Object.fromEntries(s.getAttributes());return!o.src&&!o.uploadId?null:t.change(r=>{const a=Array.from(t.markers).filter(u=>u.getRange().containsItem(s)),l=n.insertImage(o,t.createSelection(s,"on"),this._modelElementName);if(!l)return null;const c=r.createRangeOn(l);for(const u of a){const d=u.getRange(),h=d.root.rootName!="$graveyard"?d.getJoined(c,!0):c;r.updateMarker(u,{range:h})}return{oldElement:s,newElement:l}})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class fd extends v{static get requires(){return[dd,Ne,je]}static get pluginName(){return"ImageBlockEditing"}init(){const e=this.editor;e.model.schema.register("imageBlock",{isObject:!0,isBlock:!0,allowWhere:"$block",allowAttributes:["alt","src","srcset"]}),this._setupConversion(),e.plugins.has("ImageInlineEditing")&&(e.commands.add("imageTypeBlock",new hd(this.editor,"imageBlock")),this._setupClipboardIntegration())}_setupConversion(){const e=this.editor,t=e.t,n=e.conversion,s=e.plugins.get("ImageUtils");n.for("dataDowncast").elementToElement({model:"imageBlock",view:(o,{writer:r})=>Ro(r,"imageBlock")}),n.for("editingDowncast").elementToElement({model:"imageBlock",view:(o,{writer:r})=>s.toImageWidget(Ro(r,"imageBlock"),r,t("image widget"))}),n.for("downcast").add(Mi(s,"imageBlock","src")).add(Mi(s,"imageBlock","alt")).add(cd(s,"imageBlock")),n.for("upcast").elementToElement({view:od(e,"imageBlock"),model:(o,{writer:r})=>r.createElement("imageBlock",o.hasAttribute("src")?{src:o.getAttribute("src")}:null)}).add(fk(s))}_setupClipboardIntegration(){const e=this.editor,t=e.model,n=e.editing.view,s=e.plugins.get("ImageUtils");this.listenTo(e.plugins.get("ClipboardPipeline"),"inputTransformation",(o,r)=>{const a=Array.from(r.content.getChildren());let l;if(!a.every(s.isInlineImageView))return;r.targetRanges?l=e.editing.mapper.toModelRange(r.targetRanges[0]):l=t.document.selection.getFirstRange();const c=t.createSelection(l);if(Mo(t.schema,c)==="imageBlock"){const u=new en(n.document),d=a.map(h=>u.createElement("figure",{class:"image"},h));r.content=u.createDocumentFragment(d)}})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class gk extends v{static get requires(){return[fd,nn,ld]}static get pluginName(){return"ImageBlock"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class pk extends v{static get requires(){return[dd,Ne,je]}static get pluginName(){return"ImageInlineEditing"}init(){const e=this.editor,t=e.model.schema;t.register("imageInline",{isObject:!0,isInline:!0,allowWhere:"$text",allowAttributesOf:"$text",allowAttributes:["alt","src","srcset"]}),t.addChildCheck((n,s)=>{if(n.endsWith("caption")&&s.name==="imageInline")return!1}),this._setupConversion(),e.plugins.has("ImageBlockEditing")&&(e.commands.add("imageTypeInline",new hd(this.editor,"imageInline")),this._setupClipboardIntegration())}_setupConversion(){const e=this.editor,t=e.t,n=e.conversion,s=e.plugins.get("ImageUtils");n.for("dataDowncast").elementToElement({model:"imageInline",view:(o,{writer:r})=>r.createEmptyElement("img")}),n.for("editingDowncast").elementToElement({model:"imageInline",view:(o,{writer:r})=>s.toImageWidget(Ro(r,"imageInline"),r,t("image widget"))}),n.for("downcast").add(Mi(s,"imageInline","src")).add(Mi(s,"imageInline","alt")).add(cd(s,"imageInline")),n.for("upcast").elementToElement({view:od(e,"imageInline"),model:(o,{writer:r})=>r.createElement("imageInline",o.hasAttribute("src")?{src:o.getAttribute("src")}:null)})}_setupClipboardIntegration(){const e=this.editor,t=e.model,n=e.editing.view,s=e.plugins.get("ImageUtils");this.listenTo(e.plugins.get("ClipboardPipeline"),"inputTransformation",(o,r)=>{const a=Array.from(r.content.getChildren());let l;if(!a.every(s.isBlockImageView))return;r.targetRanges?l=e.editing.mapper.toModelRange(r.targetRanges[0]):l=t.document.selection.getFirstRange();const c=t.createSelection(l);if(Mo(t.schema,c)==="imageInline"){const u=new en(n.document),d=a.map(h=>h.childCount===1?(Array.from(h.getAttributes()).forEach(m=>u.setAttribute(...m,s.findViewImgElement(h))),h.getChild(0)):h);r.content=u.createDocumentFragment(d)}})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class wk extends v{static get requires(){return[pk,nn,ld]}static get pluginName(){return"ImageInline"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class bk extends v{static get requires(){return[gk,wk]}static get pluginName(){return"Image"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Vo(i){for(const e of i.getChildren())if(!!e&&e.is("element","caption"))return e;return null}function Oo(i,e){const t=e.getFirstPosition().findAncestor("caption");return t&&i.isBlockImage(t.parent)?t:null}function _k(i,e){return e.name=="figcaption"&&i.isBlockImageView(e.parent)?{name:!0}:null}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class vk extends R{refresh(){const e=this.editor,t=e.plugins.get("ImageUtils");if(!e.plugins.has(fd)){this.isEnabled=!1,this.value=!1;return}const n=e.model.document.selection,s=n.getSelectedElement();if(!s){const o=Oo(t,n);this.isEnabled=!!o,this.value=!!o;return}this.isEnabled=this.editor.plugins.get("ImageUtils").isImage(s),this.isEnabled?this.value=!!Vo(s):this.value=!1}execute(e={}){const{focusCaptionOnShow:t}=e;this.editor.model.change(n=>{this.value?this._hideImageCaption(n):this._showImageCaption(n,t)})}_showImageCaption(e,t){const s=this.editor.model.document.selection,o=this.editor.plugins.get("ImageCaptionEditing");let r=s.getSelectedElement();const a=o._getSavedCaption(r);this.editor.plugins.get("ImageUtils").isInlineImage(r)&&(this.editor.execute("imageTypeBlock"),r=s.getSelectedElement());const l=a||e.createElement("caption");e.append(l,r),t&&e.setSelection(l,"in")}_hideImageCaption(e){const t=this.editor,n=t.model.document.selection,s=t.plugins.get("ImageCaptionEditing"),o=t.plugins.get("ImageUtils");let r=n.getSelectedElement(),a;r?a=Vo(r):(a=Oo(o,n),r=a.parent),s._saveCaption(r,a),e.setSelection(r,"on"),e.remove(a)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class yk extends v{static get requires(){return[Ne]}static get pluginName(){return"ImageCaptionEditing"}constructor(e){super(e);this._savedCaptionsMap=new WeakMap}init(){const e=this.editor,t=e.model.schema;t.isRegistered("caption")?t.extend("caption",{allowIn:"imageBlock"}):t.register("caption",{allowIn:"imageBlock",allowContentOf:"$block",isLimit:!0}),e.commands.add("toggleImageCaption",new vk(this.editor)),this._setupConversion(),this._setupImageTypeCommandsIntegration()}_setupConversion(){const e=this.editor,t=e.editing.view,n=e.plugins.get("ImageUtils"),s=e.t;e.conversion.for("upcast").elementToElement({view:o=>_k(n,o),model:"caption"}),e.conversion.for("dataDowncast").elementToElement({model:"caption",view:(o,{writer:r})=>n.isBlockImage(o.parent)?r.createContainerElement("figcaption"):null}),e.conversion.for("editingDowncast").elementToElement({model:"caption",view:(o,{writer:r})=>{if(!n.isBlockImage(o.parent))return null;const a=r.createEditableElement("figcaption");return r.setCustomProperty("imageCaption",!0,a),tu({view:t,element:a,text:s("Enter image caption"),keepOnFocus:!0}),_o(a,r)}}),e.editing.mapper.on("modelToViewPosition",md(t)),e.data.mapper.on("modelToViewPosition",md(t))}_setupImageTypeCommandsIntegration(){const e=this.editor,t=e.plugins.get("ImageUtils"),n=e.commands.get("imageTypeInline"),s=e.commands.get("imageTypeBlock"),o=r=>{if(!r.return)return;const{oldElement:a,newElement:l}=r.return;if(!a)return;if(t.isBlockImage(a)){const u=Vo(a);if(u){this._saveCaption(l,u);return}}const c=this._getSavedCaption(a);c&&this._saveCaption(l,c)};n&&this.listenTo(n,"execute",o,{priority:"low"}),s&&this.listenTo(s,"execute",o,{priority:"low"})}_getSavedCaption(e){const t=this._savedCaptionsMap.get(e);return t?L.fromJSON(t):null}_saveCaption(e,t){this._savedCaptionsMap.set(e,t.toJSON())}}function md(i){return(e,t)=>{const n=t.modelPosition,s=n.parent;if(!s.is("element","imageBlock"))return;const o=t.mapper.toViewElement(s);t.viewPosition=i.createPositionAt(o,n.offset+1)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ck extends v{static get requires(){return[Ne]}static get pluginName(){return"ImageCaptionUI"}init(){const e=this.editor,t=e.editing.view,n=e.plugins.get("ImageUtils"),s=e.t;e.ui.componentFactory.add("toggleImageCaption",o=>{const r=e.commands.get("toggleImageCaption"),a=new U(o);return a.set({icon:fe.caption,tooltip:!0,isToggleable:!0}),a.bind("isOn","isEnabled").to(r,"value","isEnabled"),a.bind("label").to(r,"value",l=>s(l?"Toggle caption off":"Toggle caption on")),this.listenTo(a,"execute",()=>{e.execute("toggleImageCaption",{focusCaptionOnShow:!0});const l=Oo(n,e.model.document.selection);if(l){const c=e.editing.mapper.toViewElement(l);t.scrollToTheSelection(),t.change(u=>{u.addClass("image__caption_highlighted",c)})}}),a})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ek extends v{static get requires(){return[yk,Ck]}static get pluginName(){return"ImageCaption"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Tk extends R{constructor(e,t){super(e);this._defaultStyles={imageBlock:!1,imageInline:!1},this._styles=new Map(t.map(n=>{if(n.isDefault)for(const s of n.modelElements)this._defaultStyles[s]=n.name;return[n.name,n]}))}refresh(){const n=this.editor.plugins.get("ImageUtils").getClosestSelectedImageElement(this.editor.model.document.selection);this.isEnabled=!!n,this.isEnabled?n.hasAttribute("imageStyle")?this.value=n.getAttribute("imageStyle"):this.value=this._defaultStyles[n.name]:this.value=!1}execute(e={}){const t=this.editor,n=t.model,s=t.plugins.get("ImageUtils");n.change(o=>{const r=e.value;let a=s.getClosestSelectedImageElement(n.document.selection);r&&this.shouldConvertImageType(r,a)&&(this.editor.execute(s.isBlockImage(a)?"imageTypeInline":"imageTypeBlock"),a=s.getClosestSelectedImageElement(n.document.selection)),!r||this._styles.get(r).isDefault?o.removeAttribute("imageStyle",a):o.setAttribute("imageStyle",r,a)})}shouldConvertImageType(e,t){return!this._styles.get(e).modelElements.includes(t.name)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const{objectFullWidth:kk,objectInline:gd,objectLeft:pd,objectRight:No,objectCenter:Do,objectBlockLeft:wd,objectBlockRight:bd}=fe,Vi={inline:{name:"inline",title:"In line",icon:gd,modelElements:["imageInline"],isDefault:!0},alignLeft:{name:"alignLeft",title:"Left aligned image",icon:pd,modelElements:["imageBlock","imageInline"],className:"image-style-align-left"},alignBlockLeft:{name:"alignBlockLeft",title:"Left aligned image",icon:wd,modelElements:["imageBlock"],className:"image-style-block-align-left"},alignCenter:{name:"alignCenter",title:"Centered image",icon:Do,modelElements:["imageBlock"],className:"image-style-align-center"},alignRight:{name:"alignRight",title:"Right aligned image",icon:No,modelElements:["imageBlock","imageInline"],className:"image-style-align-right"},alignBlockRight:{name:"alignBlockRight",title:"Right aligned image",icon:bd,modelElements:["imageBlock"],className:"image-style-block-align-right"},block:{name:"block",title:"Centered image",icon:Do,modelElements:["imageBlock"],isDefault:!0},side:{name:"side",title:"Side image",icon:No,modelElements:["imageBlock"],className:"image-style-side"}},_d={full:kk,left:wd,right:bd,center:Do,inlineLeft:pd,inlineRight:No,inline:gd},vd=[{name:"imageStyle:wrapText",title:"Wrap text",defaultItem:"imageStyle:alignLeft",items:["imageStyle:alignLeft","imageStyle:alignRight"]},{name:"imageStyle:breakText",title:"Break text",defaultItem:"imageStyle:block",items:["imageStyle:alignBlockLeft","imageStyle:block","imageStyle:alignBlockRight"]}];function Ak(i){return(i.configuredStyles.options||[]).map(n=>xk(n)).filter(n=>Ik(n,i))}function Sk(i,e){return i&&e?{options:["inline","alignLeft","alignRight","alignCenter","alignBlockLeft","alignBlockRight","block","side"]}:i?{options:["block","side"]}:e?{options:["inline","alignLeft","alignRight"]}:{}}function Pk(i){return i.has("ImageBlockEditing")&&i.has("ImageInlineEditing")?[...vd]:[]}function xk(i){return typeof i=="string"?Vi[i]?i=x({},Vi[i]):i={name:i}:i=Rk(Vi[i.name],i),typeof i.icon=="string"&&(i.icon=_d[i.icon]||i.icon),i}function Ik(i,{isBlockPluginLoaded:e,isInlinePluginLoaded:t}){const{modelElements:n,name:s}=i;if(!n||!n.length||!s)return yd({style:i}),!1;{const o=[e?"imageBlock":null,t?"imageInline":null];if(!n.some(r=>o.includes(r)))return de("image-style-missing-dependency",{style:i,missingPlugins:n.map(r=>r==="imageBlock"?"ImageBlockEditing":"ImageInlineEditing")}),!1}return!0}function Rk(i,e){const t=x({},e);for(const n in i)Object.prototype.hasOwnProperty.call(e,n)||(t[n]=i[n]);return t}function yd(i){de("image-style-configuration-definition-invalid",i)}var Bo={normalizeStyles:Ak,getDefaultStylesConfiguration:Sk,getDefaultDropdownDefinitions:Pk,warnInvalidStyle:yd,DEFAULT_OPTIONS:Vi,DEFAULT_ICONS:_d,DEFAULT_DROPDOWN_DEFINITIONS:vd};/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Mk(i){return(e,t,n)=>{if(!n.consumable.consume(t.item,e.name))return;const s=Cd(t.attributeNewValue,i),o=Cd(t.attributeOldValue,i),r=n.mapper.toViewElement(t.item),a=n.writer;o&&a.removeClass(o.className,r),s&&a.addClass(s.className,r)}}function Vk(i){const e={imageInline:i.filter(t=>!t.isDefault&&t.modelElements.includes("imageInline")),imageBlock:i.filter(t=>!t.isDefault&&t.modelElements.includes("imageBlock"))};return(t,n,s)=>{if(!n.modelRange)return;const o=n.viewItem,r=ge(n.modelRange.getItems());if(!!r&&!!s.schema.checkAttribute(r,"imageStyle"))for(const a of e[r.name])s.consumable.consume(o,{classes:a.className})&&s.writer.setAttribute("imageStyle",a.name,r)}}function Cd(i,e){for(const t of e)if(t.name===i)return t}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ed extends v{static get pluginName(){return"ImageStyleEditing"}static get requires(){return[Ne]}init(){const{normalizeStyles:e,getDefaultStylesConfiguration:t}=Bo,n=this.editor,s=n.plugins.has("ImageBlockEditing"),o=n.plugins.has("ImageInlineEditing");n.config.define("image.styles",t(s,o)),this.normalizedStyles=e({configuredStyles:n.config.get("image.styles"),isBlockPluginLoaded:s,isInlinePluginLoaded:o}),this._setupConversion(s,o),this._setupPostFixer(),n.commands.add("imageStyle",new Tk(n,this.normalizedStyles))}_setupConversion(e,t){const n=this.editor,s=n.model.schema,o=Mk(this.normalizedStyles),r=Vk(this.normalizedStyles);n.editing.downcastDispatcher.on("attribute:imageStyle",o),n.data.downcastDispatcher.on("attribute:imageStyle",o),e&&(s.extend("imageBlock",{allowAttributes:"imageStyle"}),n.data.upcastDispatcher.on("element:figure",r,{priority:"low"})),t&&(s.extend("imageInline",{allowAttributes:"imageStyle"}),n.data.upcastDispatcher.on("element:img",r,{priority:"low"}))}_setupPostFixer(){const e=this.editor,t=e.model.document,n=e.plugins.get(Ne),s=new Map(this.normalizedStyles.map(o=>[o.name,o]));t.registerPostFixer(o=>{let r=!1;for(const a of t.differ.getChanges())if(a.type=="insert"||a.type=="attribute"&&a.attributeKey=="imageStyle"){let l=a.type=="insert"?a.position.nodeAfter:a.range.start.nodeAfter;if(l&&l.is("element","paragraph")&&l.childCount>0&&(l=l.getChild(0)),!n.isImage(l))continue;const c=l.getAttribute("imageStyle");if(!c)continue;const u=s.get(c);(!u||!u.modelElements.includes(l.name))&&(o.removeAttribute("imageStyle",l),r=!0)}return r})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ok extends v{static get requires(){return[Ed]}static get pluginName(){return"ImageStyleUI"}get localizedDefaultStylesTitles(){const e=this.editor.t;return{"Wrap text":e("Wrap text"),"Break text":e("Break text"),"In line":e("In line"),"Full size image":e("Full size image"),"Side image":e("Side image"),"Left aligned image":e("Left aligned image"),"Centered image":e("Centered image"),"Right aligned image":e("Right aligned image")}}init(){const e=this.editor.plugins,t=this.editor.config.get("image.toolbar")||[],n=Td(e.get("ImageStyleEditing").normalizedStyles,this.localizedDefaultStylesTitles);for(const o of n)this._createButton(o);const s=Td([...t.filter(Z),...Bo.getDefaultDropdownDefinitions(e)],this.localizedDefaultStylesTitles);for(const o of s)this._createDropdown(o,n)}_createDropdown(e,t){const n=this.editor.ui.componentFactory;n.add(e.name,s=>{let o;const{defaultItem:r,items:a,title:l}=e,c=a.filter(h=>t.find(({name:m})=>kd(m)===h)).map(h=>{const m=n.create(h);return h===r&&(o=m),m});a.length!==c.length&&Bo.warnInvalidStyle({dropdown:e});const u=ht(s,Gc),d=u.buttonView;return Xc(u,c),d.set({label:Ad(l,o.label),class:null,tooltip:!0}),d.bind("icon").toMany(c,"isOn",(...h)=>{const m=h.findIndex(bt);return m<0?o.icon:c[m].icon}),d.bind("label").toMany(c,"isOn",(...h)=>{const m=h.findIndex(bt);return Ad(l,m<0?o.label:c[m].label)}),d.bind("isOn").toMany(c,"isOn",(...h)=>h.some(bt)),d.bind("class").toMany(c,"isOn",(...h)=>h.some(bt)?"ck-splitbutton_flatten":null),d.on("execute",()=>{c.some(({isOn:h})=>h)?u.isOpen=!u.isOpen:o.fire("execute")}),u.bind("isEnabled").toMany(c,"isEnabled",(...h)=>h.some(bt)),u})}_createButton(e){const t=e.name;this.editor.ui.componentFactory.add(kd(t),n=>{const s=this.editor.commands.get("imageStyle"),o=new U(n);return o.set({label:e.title,icon:e.icon,tooltip:!0,isToggleable:!0}),o.bind("isEnabled").to(s,"isEnabled"),o.bind("isOn").to(s,"value",r=>r===t),o.on("execute",this._executeCommand.bind(this,t)),o})}_executeCommand(e){this.editor.execute("imageStyle",{value:e}),this.editor.editing.view.focus()}}function Td(i,e){for(const t of i)e[t.title]&&(t.title=e[t.title]);return i}function kd(i){return`imageStyle:${i}`}function Ad(i,e){return(i?i+": ":"")+e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Nk extends v{static get requires(){return[Ed,Ok]}static get pluginName(){return"ImageStyle"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Dk extends v{static get requires(){return[Ii,Ne]}static get pluginName(){return"ImageToolbar"}afterInit(){const e=this.editor,t=e.t,n=e.plugins.get(Ii),s=e.plugins.get("ImageUtils");n.register("image",{ariaLabel:t("Image toolbar"),items:Bk(e.config.get("image.toolbar")||[]),getRelatedElement:o=>s.getClosestSelectedImageWidget(o)})}}function Bk(i){return i.map(e=>Z(e)?e.name:e)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Sd(i){const e=i.map(t=>t.replace("+","\\+"));return new RegExp(`^image\\/(${e.join("|")})$`)}function Fk(i){return new Promise((e,t)=>{const n=i.getAttribute("src");fetch(n).then(s=>s.blob()).then(s=>{const o=Pd(s,n),a=`image.${o.replace("image/","")}`,l=new File([s],a,{type:o});e(l)}).catch(s=>s&&s.name==="TypeError"?zk(n).then(e).catch(t):t(s))})}function Lk(i,e){return!i.isInlineImageView(e)||!e.getAttribute("src")?!1:e.getAttribute("src").match(/^data:image\/\w+;base64,/g)||e.getAttribute("src").match(/^blob:/g)}function Pd(i,e){return i.type?i.type:e.match(/data:(image\/\w+);base64/)?e.match(/data:(image\/\w+);base64/)[1].toLowerCase():"image/jpeg"}function zk(i){return Hk(i).then(e=>{const t=Pd(e,i),s=`image.${t.replace("image/","")}`;return new File([e],s,{type:t})})}function Hk(i){return new Promise((e,t)=>{const n=ee.document.createElement("img");n.addEventListener("load",()=>{const s=ee.document.createElement("canvas");s.width=n.width,s.height=n.height,s.getContext("2d").drawImage(n,0,0),s.toBlob(r=>r?e(r):t())}),n.addEventListener("error",()=>t()),n.src=i})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class $k extends v{static get pluginName(){return"ImageUploadUI"}init(){const e=this.editor,t=e.t,n=s=>{const o=new aT(s),r=e.commands.get("uploadImage"),a=e.config.get("image.upload.types"),l=Sd(a);return o.set({acceptedType:a.map(c=>`image/${c}`).join(","),allowMultipleFiles:!0}),o.buttonView.set({label:t("Insert image"),icon:fe.image,tooltip:!0}),o.buttonView.bind("isEnabled").to(r),o.on("done",(c,u)=>{const d=Array.from(u).filter(h=>l.test(h.type));d.length&&e.execute("uploadImage",{file:d})}),o};e.ui.componentFactory.add("uploadImage",n),e.ui.componentFactory.add("imageUpload",n)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Wk extends v{static get pluginName(){return"ImageUploadProgress"}constructor(e){super(e);this.placeholder="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}init(){const e=this.editor;e.plugins.has("ImageBlockEditing")&&e.editing.downcastDispatcher.on("attribute:uploadStatus:imageBlock",(...t)=>this.uploadStatusChange(...t)),e.plugins.has("ImageInlineEditing")&&e.editing.downcastDispatcher.on("attribute:uploadStatus:imageInline",(...t)=>this.uploadStatusChange(...t))}uploadStatusChange(e,t,n){const s=this.editor,o=t.item,r=o.getAttribute("uploadId");if(!n.consumable.consume(t.item,e.name))return;const a=s.plugins.get("ImageUtils"),l=s.plugins.get(Ke),c=r?t.attributeNewValue:null,u=this.placeholder,d=s.editing.mapper.toViewElement(o),h=n.writer;if(c=="reading"){xd(d,h),Id(a,u,d,h);return}if(c=="uploading"){const m=l.loaders.get(r);xd(d,h),m?(Rd(d,h),qk(d,h,m,s.editing.view),Qk(a,d,h,m)):Id(a,u,d,h);return}c=="complete"&&l.loaders.get(r)&&Kk(d,h,s.editing.view),jk(d,h),Rd(d,h),Uk(d,h)}}function xd(i,e){i.hasClass("ck-appear")||e.addClass("ck-appear",i)}function Uk(i,e){e.removeClass("ck-appear",i)}function Id(i,e,t,n){t.hasClass("ck-image-upload-placeholder")||n.addClass("ck-image-upload-placeholder",t);const s=i.findViewImgElement(t);s.getAttribute("src")!==e&&n.setAttribute("src",e,s),Md(t,"placeholder")||n.insert(n.createPositionAfter(s),Jk(n))}function Rd(i,e){i.hasClass("ck-image-upload-placeholder")&&e.removeClass("ck-image-upload-placeholder",i),Vd(i,e,"placeholder")}function qk(i,e,t,n){const s=Gk(e);e.insert(e.createPositionAt(i,"end"),s),t.on("change:uploadedPercent",(o,r,a)=>{n.change(l=>{l.setStyle("width",a+"%",s)})})}function jk(i,e){Vd(i,e,"progressBar")}function Kk(i,e,t){const n=e.createUIElement("div",{class:"ck-image-upload-complete-icon"});e.insert(e.createPositionAt(i,"end"),n),setTimeout(()=>{t.change(s=>s.remove(s.createRangeOn(n)))},3e3)}function Gk(i){const e=i.createUIElement("div",{class:"ck-progress-bar"});return i.setCustomProperty("progressBar",!0,e),e}function Jk(i){const e=i.createUIElement("div",{class:"ck-upload-placeholder-loader"});return i.setCustomProperty("placeholder",!0,e),e}function Md(i,e){for(const t of i.getChildren())if(t.getCustomProperty(e))return t}function Vd(i,e,t){const n=Md(i,t);n&&e.remove(e.createRangeOn(n))}function Qk(i,e,t,n){if(n.data){const s=i.findViewImgElement(e);t.setAttribute("src",n.data,s)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Yk extends R{refresh(){const e=this.editor,t=e.plugins.get("ImageUtils"),n=e.model.document.selection.getSelectedElement();this.isEnabled=t.isImageAllowed()||t.isImage(n)}execute(e){const t=oe(e.file),n=this.editor.model.document.selection,s=this.editor.plugins.get("ImageUtils"),o=Object.fromEntries(n.getAttributes());t.forEach((r,a)=>{const l=n.getSelectedElement();if(a&&l&&s.isImage(l)){const c=this.editor.model.createPositionAfter(l);this._uploadImage(r,o,c)}else this._uploadImage(r,o)})}_uploadImage(e,t,n){const s=this.editor,r=s.plugins.get(Ke).createLoader(e),a=s.plugins.get("ImageUtils");!r||a.insertImage(ur(x({},t),{uploadId:r.id}),n)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Xk extends v{static get requires(){return[Ke,fo,je,Ne]}static get pluginName(){return"ImageUploadEditing"}constructor(e){super(e);e.config.define("image",{upload:{types:["jpeg","png","gif","bmp","webp","tiff"]}}),this._uploadImageElements=new Map}init(){const e=this.editor,t=e.model.document,n=e.conversion,s=e.plugins.get(Ke),o=e.plugins.get("ImageUtils"),r=Sd(e.config.get("image.upload.types")),a=new Yk(e);e.commands.add("uploadImage",a),e.commands.add("imageUpload",a),n.for("upcast").attributeToAttribute({view:{name:"img",key:"uploadId"},model:"uploadId"}),this.listenTo(e.editing.view.document,"clipboardInput",(l,c)=>{if(Zk(c.dataTransfer))return;const u=Array.from(c.dataTransfer.files).filter(d=>d?r.test(d.type):!1);!u.length||(l.stop(),e.model.change(d=>{c.targetRanges&&d.setSelection(c.targetRanges.map(h=>e.editing.mapper.toModelRange(h))),e.model.enqueueChange("default",()=>{e.execute("uploadImage",{file:u})})}))}),this.listenTo(e.plugins.get("ClipboardPipeline"),"inputTransformation",(l,c)=>{const u=Array.from(e.editing.view.createRangeIn(c.content)).filter(h=>Lk(o,h.item)&&!h.item.getAttribute("uploadProcessed")).map(h=>({promise:Fk(h.item),imageElement:h.item}));if(!u.length)return;const d=new en(e.editing.view.document);for(const h of u){d.setAttribute("uploadProcessed",!0,h.imageElement);const m=s.createLoader(h.promise);m&&(d.setAttribute("src","",h.imageElement),d.setAttribute("uploadId",m.id,h.imageElement))}}),e.editing.view.document.on("dragover",(l,c)=>{c.preventDefault()}),t.on("change",()=>{const l=t.differ.getChanges({includeChangesInGraveyard:!0}).reverse(),c=new Set;for(const u of l)if(u.type=="insert"&&u.name!="$text"){const d=u.position.nodeAfter,h=u.position.root.rootName=="$graveyard";for(const m of eA(e,d)){const g=m.getAttribute("uploadId");if(!g)continue;const p=s.loaders.get(g);!p||(h?c.has(g)||p.abort():(c.add(g),this._uploadImageElements.set(g,m),p.status=="idle"&&this._readAndUpload(p)))}}}),this.on("uploadComplete",(l,{imageElement:c,data:u})=>{const d=u.urls?u.urls:u;this.editor.model.change(h=>{h.setAttribute("src",d.default,c),this._parseAndSetSrcsetAttributeOnImage(d,c,h)})},{priority:"low"})}afterInit(){const e=this.editor.model.schema;this.editor.plugins.has("ImageBlockEditing")&&e.extend("imageBlock",{allowAttributes:["uploadId","uploadStatus"]}),this.editor.plugins.has("ImageInlineEditing")&&e.extend("imageInline",{allowAttributes:["uploadId","uploadStatus"]})}_readAndUpload(e){const t=this.editor,n=t.model,s=t.locale.t,o=t.plugins.get(Ke),r=t.plugins.get(fo),a=t.plugins.get("ImageUtils"),l=this._uploadImageElements;return n.enqueueChange("transparent",u=>{u.setAttribute("uploadStatus","reading",l.get(e.id))}),e.read().then(()=>{const u=e.upload(),d=l.get(e.id);if(W.isSafari){const h=t.editing.mapper.toViewElement(d),m=a.findViewImgElement(h);t.editing.view.once("render",()=>{if(!m.parent)return;const g=t.editing.view.domConverter.mapViewToDom(m.parent);if(!g)return;const p=g.style.display;g.style.display="none",g._ckHack=g.offsetHeight,g.style.display=p})}return n.enqueueChange("transparent",h=>{h.setAttribute("uploadStatus","uploading",d)}),u}).then(u=>{n.enqueueChange("transparent",d=>{const h=l.get(e.id);d.setAttribute("uploadStatus","complete",h),this.fire("uploadComplete",{data:u,imageElement:h})}),c()}).catch(u=>{if(e.status!=="error"&&e.status!=="aborted")throw u;e.status=="error"&&u&&r.showWarning(u,{title:s("Upload failed"),namespace:"upload"}),n.enqueueChange("transparent",d=>{d.remove(l.get(e.id))}),c()});function c(){n.enqueueChange("transparent",u=>{const d=l.get(e.id);u.removeAttribute("uploadId",d),u.removeAttribute("uploadStatus",d),l.delete(e.id)}),o.destroyLoader(e)}}_parseAndSetSrcsetAttributeOnImage(e,t,n){let s=0;const o=Object.keys(e).filter(r=>{const a=parseInt(r,10);if(!isNaN(a))return s=Math.max(s,a),!0}).map(r=>`${e[r]} ${r}w`).join(", ");o!=""&&n.setAttribute("srcset",{data:o,width:s},t)}}function Zk(i){return Array.from(i.types).includes("text/html")&&i.getData("text/html")!==""}function eA(i,e){const t=i.plugins.get("ImageUtils");return Array.from(i.model.createRangeOn(e)).filter(n=>t.isImage(n.item)).map(n=>n.item)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class tA extends v{static get pluginName(){return"ImageUpload"}static get requires(){return[Xk,$k,Wk]}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class nA extends R{refresh(){const e=this.editor,n=e.plugins.get("ImageUtils").getClosestSelectedImageElement(e.model.document.selection);this.isEnabled=!!n,!n||!n.hasAttribute("width")?this.value=null:this.value={width:n.getAttribute("width"),height:null}}execute(e){const t=this.editor,n=t.model,o=t.plugins.get("ImageUtils").getClosestSelectedImageElement(n.document.selection);this.value={width:e.width,height:null},o&&n.change(r=>{r.setAttribute("width",e.width,o)})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Fo extends v{static get requires(){return[Ne]}static get pluginName(){return"ImageResizeEditing"}constructor(e){super(e);e.config.define("image",{resizeUnit:"%",resizeOptions:[{name:"resizeImage:original",value:null,icon:"original"},{name:"resizeImage:25",value:"25",icon:"small"},{name:"resizeImage:50",value:"50",icon:"medium"},{name:"resizeImage:75",value:"75",icon:"large"}]})}init(){const e=this.editor,t=new nA(e);this._registerSchema(),this._registerConverters("imageBlock"),this._registerConverters("imageInline"),e.commands.add("resizeImage",t),e.commands.add("imageResize",t)}_registerSchema(){this.editor.plugins.has("ImageBlockEditing")&&this.editor.model.schema.extend("imageBlock",{allowAttributes:"width"}),this.editor.plugins.has("ImageInlineEditing")&&this.editor.model.schema.extend("imageInline",{allowAttributes:"width"})}_registerConverters(e){const t=this.editor;t.conversion.for("downcast").add(n=>n.on(`attribute:width:${e}`,(s,o,r)=>{if(!r.consumable.consume(o.item,s.name))return;const a=r.writer,l=r.mapper.toViewElement(o.item);o.attributeNewValue!==null?(a.setStyle("width",o.attributeNewValue,l),a.addClass("image_resized",l)):(a.removeStyle("width",l),a.removeClass("image_resized",l))})),t.conversion.for("upcast").attributeToAttribute({view:{name:e==="imageBlock"?"figure":"img",styles:{width:/.+/}},model:{key:"width",value:n=>n.getStyle("width")}})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Lo={small:fe.objectSizeSmall,medium:fe.objectSizeMedium,large:fe.objectSizeLarge,original:fe.objectSizeFull};class iA extends v{static get requires(){return[Fo]}static get pluginName(){return"ImageResizeButtons"}constructor(e){super(e);this._resizeUnit=e.config.get("image.resizeUnit")}init(){const e=this.editor,t=e.config.get("image.resizeOptions"),n=e.commands.get("resizeImage");this.bind("isEnabled").to(n);for(const s of t)this._registerImageResizeButton(s);this._registerImageResizeDropdown(t)}_registerImageResizeButton(e){const t=this.editor,{name:n,value:s,icon:o}=e,r=s?s+this._resizeUnit:null;t.ui.componentFactory.add(n,a=>{const l=new U(a),c=t.commands.get("resizeImage"),u=this._getOptionLabelValue(e,!0);if(!Lo[o])throw new f("imageresizebuttons-missing-icon",t,e);return l.set({label:u,icon:Lo[o],tooltip:u,isToggleable:!0}),l.bind("isEnabled").to(this),l.bind("isOn").to(c,"value",Od(r)),this.listenTo(l,"execute",()=>{t.execute("resizeImage",{width:r})}),l})}_registerImageResizeDropdown(e){const t=this.editor,n=t.t,s=e.find(r=>!r.value),o=r=>{const a=t.commands.get("resizeImage"),l=ht(r,ro),c=l.buttonView;return c.set({tooltip:n("Resize image"),commandValue:s.value,icon:Lo.medium,isToggleable:!0,label:this._getOptionLabelValue(s),withText:!0,class:"ck-resize-image-button"}),c.bind("label").to(a,"value",u=>u&&u.width?u.width:this._getOptionLabelValue(s)),l.bind("isOn").to(a),l.bind("isEnabled").to(this),co(l,this._getResizeDropdownListItemDefinitions(e,a)),l.listView.ariaLabel=n("Image resize list"),this.listenTo(l,"execute",u=>{t.execute(u.source.commandName,{width:u.source.commandValue}),t.editing.view.focus()}),l};t.ui.componentFactory.add("resizeImage",o),t.ui.componentFactory.add("imageResize",o)}_getOptionLabelValue(e,t){const n=this.editor.t;return e.label?e.label:t?e.value?n("Resize image to %0",e.value+this._resizeUnit):n("Resize image to the original size"):e.value?e.value+this._resizeUnit:n("Original")}_getResizeDropdownListItemDefinitions(e,t){const n=new _e;return e.map(s=>{const o=s.value?s.value+this._resizeUnit:null,r={type:"button",model:new bi({commandName:"resizeImage",commandValue:o,label:this._getOptionLabelValue(s),withText:!0,icon:null})};r.model.bind("isOn").to(t,"value",Od(o)),n.add(r)}),n}}function Od(i){return e=>i===null&&e===i?!0:e&&e.width===i}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const sA="figure.image.ck-widget > img,figure.image.ck-widget > picture > img,figure.image.ck-widget > a > img,figure.image.ck-widget > a > picture > img,span.image-inline.ck-widget > img,span.image-inline.ck-widget > picture > img",oA=/(image|image-inline)/,zo="image_resized";class Nd extends v{static get requires(){return[Ri]}static get pluginName(){return"ImageResizeHandles"}init(){const e=this.editor.commands.get("resizeImage");this.bind("isEnabled").to(e),this._setupResizerCreator()}_setupResizerCreator(){const e=this.editor,t=e.editing.view;t.addObserver(ud),this.listenTo(t.document,"imageLoaded",(n,s)=>{if(!s.target.matches(sA))return;const o=e.editing.view.domConverter,a=o.domToView(s.target).findAncestor({classes:oA});let l=this.editor.plugins.get(Ri).getResizerByViewElement(a);if(l){l.redraw();return}const c=e.editing.mapper,u=c.toModelElement(a);l=e.plugins.get(Ri).attachTo({unit:e.config.get("image.resizeUnit"),modelElement:u,viewElement:a,editor:e,getHandleHost(d){return d.querySelector("img")},getResizeHost(){return o.viewToDom(c.toViewElement(u.parent))},isCentered(){const d=u.getAttribute("imageStyle");return!d||d=="block"||d=="alignCenter"},onCommit(d){t.change(h=>{h.removeClass(zo,a)}),e.execute("resizeImage",{width:d})}}),l.on("updateSize",()=>{a.hasClass(zo)||t.change(d=>{d.addClass(zo,a)})}),l.bind("isEnabled").to(this)})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class rA extends v{static get requires(){return[Fo,Nd,iA]}static get pluginName(){return"ImageResize"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class aA extends v{static get pluginName(){return"IndentEditing"}init(){const e=this.editor;e.commands.add("indent",new qa(e)),e.commands.add("outdent",new qa(e))}}var Dd='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm5 6c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zM2.75 16.5h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 1 0 0 1.5zM1.632 6.95 5.02 9.358a.4.4 0 0 1-.013.661l-3.39 2.207A.4.4 0 0 1 1 11.892V7.275a.4.4 0 0 1 .632-.326z"/></svg>',Bd='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm5 6c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zM2.75 16.5h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 1 0 0 1.5zm1.618-9.55L.98 9.358a.4.4 0 0 0 .013.661l3.39 2.207A.4.4 0 0 0 5 11.892V7.275a.4.4 0 0 0-.632-.326z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class lA extends v{static get pluginName(){return"IndentUI"}init(){const e=this.editor,t=e.locale,n=e.t,s=t.uiLanguageDirection=="ltr"?Dd:Bd,o=t.uiLanguageDirection=="ltr"?Bd:Dd;this._defineButton("indent",n("Increase indent"),s),this._defineButton("outdent",n("Decrease indent"),o)}_defineButton(e,t,n){const s=this.editor;s.ui.componentFactory.add(e,o=>{const r=s.commands.get(e),a=new U(o);return a.set({label:t,icon:n,tooltip:!0}),a.bind("isOn","isEnabled").to(r,"value","isEnabled"),this.listenTo(a,"execute",()=>{s.execute(e),s.editing.view.focus()}),a})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class cA extends v{static get pluginName(){return"Indent"}static get requires(){return[aA,lA]}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md.
 */class uA{constructor(){this._definitions=new Set}get length(){return this._definitions.size}add(e){Array.isArray(e)?e.forEach(t=>this._definitions.add(t)):this._definitions.add(e)}getDispatcher(){return e=>{e.on("attribute:linkHref",(t,n,s)=>{if(!s.consumable.test(n.item,"attribute:linkHref"))return;const o=s.writer,r=o.document.selection;for(const a of this._definitions){const l=o.createAttributeElement("a",a.attributes,{priority:5});a.classes&&o.addClass(a.classes,l);for(const c in a.styles)o.setStyle(c,a.styles[c],l);o.setCustomProperty("link",!0,l),a.callback(n.attributeNewValue)?n.item.is("selection")?o.wrap(r.getFirstRange(),l):o.wrap(s.mapper.toViewRange(n.range),l):o.unwrap(s.mapper.toViewRange(n.range),l)}},{priority:"high"})}}getDispatcherForLinkedImage(){return e=>{e.on("attribute:linkHref:imageBlock",(t,n,{writer:s,mapper:o})=>{const r=o.toViewElement(n.item),a=Array.from(r.getChildren()).find(l=>l.name==="a");for(const l of this._definitions){const c=Xe(l.attributes);if(l.callback(n.attributeNewValue)){for(const[u,d]of c)u==="class"?s.addClass(d,a):s.setAttribute(u,d,a);l.classes&&s.addClass(l.classes,a);for(const u in l.styles)s.setStyle(u,l.styles[u],a)}else{for(const[u,d]of c)u==="class"?s.removeClass(d,a):s.removeAttribute(u,a);l.classes&&s.removeClass(l.classes,a);for(const u in l.styles)s.removeStyle(u,a)}}})}}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const dA=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,hA=/^(?:(?:https?|ftps?|mailto):|[^a-z]|[a-z+.-]+(?:[^a-z+.:-]|$))/i,fA=/^[\S]+@((?![-_])(?:[-\w\u00a1-\uffff]{0,63}[^-_]\.))+(?:[a-z\u00a1-\uffff]{2,})$/i,mA=/^((\w+:(\/{2,})?)|(\W))/i,Ho="Ctrl+K";function gA(i){return i.is("attributeElement")&&!!i.getCustomProperty("link")}function Fd(i,{writer:e}){const t=e.createAttributeElement("a",{href:i},{priority:5});return e.setCustomProperty("link",!0,t),t}function Ld(i){return i=String(i),pA(i)?i:"#"}function pA(i){return i.replace(dA,"").match(hA)}function wA(i,e){const t={"Open in a new tab":i("Open in a new tab"),Downloadable:i("Downloadable")};return e.forEach(n=>(n.label&&t[n.label]&&(n.label=t[n.label]),n)),e}function bA(i){const e=[];if(i)for(const[t,n]of Object.entries(i)){const s=Object.assign({},n,{id:`link${Fp(t)}`});e.push(s)}return e}function $o(i,e){return i?e.checkAttribute(i.name,"linkHref"):!1}function _A(i){return fA.test(i)}function zd(i,e){const t=_A(i)?"mailto:":e,n=!!t&&!mA.test(i);return i&&n?t+i:i}function Hd(i){window.open(i,"_blank","noopener")}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class vA extends R{constructor(e){super(e);this.manualDecorators=new _e,this.automaticDecorators=new uA}restoreManualDecoratorStates(){for(const e of this.manualDecorators)e.value=this._getDecoratorStateFromModel(e.id)}refresh(){const e=this.editor.model,t=e.document.selection,n=t.getSelectedElement()||ge(t.getSelectedBlocks());$o(n,e.schema)?(this.value=n.getAttribute("linkHref"),this.isEnabled=e.schema.checkAttribute(n,"linkHref")):(this.value=t.getAttribute("linkHref"),this.isEnabled=e.schema.checkAttributeInSelection(t,"linkHref"));for(const s of this.manualDecorators)s.value=this._getDecoratorStateFromModel(s.id)}execute(e,t={}){const n=this.editor.model,s=n.document.selection,o=[],r=[];for(const a in t)t[a]?o.push(a):r.push(a);n.change(a=>{if(s.isCollapsed){const l=s.getFirstPosition();if(s.hasAttribute("linkHref")){const c=on(l,"linkHref",s.getAttribute("linkHref"),n);a.setAttribute("linkHref",e,c),o.forEach(u=>{a.setAttribute(u,!0,c)}),r.forEach(u=>{a.removeAttribute(u,c)}),a.setSelection(a.createPositionAfter(c.end.nodeBefore))}else if(e!==""){const c=Xe(s.getAttributes());c.set("linkHref",e),o.forEach(d=>{c.set(d,!0)});const{end:u}=n.insertContent(a.createText(e,c),l);a.setSelection(u)}["linkHref",...o,...r].forEach(c=>{a.removeSelectionAttribute(c)})}else{const l=n.schema.getValidRanges(s.getRanges(),"linkHref"),c=[];for(const d of s.getSelectedBlocks())n.schema.checkAttribute(d,"linkHref")&&c.push(a.createRangeOn(d));const u=c.slice();for(const d of l)this._isRangeToUpdate(d,c)&&u.push(d);for(const d of u)a.setAttribute("linkHref",e,d),o.forEach(h=>{a.setAttribute(h,!0,d)}),r.forEach(h=>{a.removeAttribute(h,d)})}})}_getDecoratorStateFromModel(e){const t=this.editor.model,n=t.document.selection,s=n.getSelectedElement();return $o(s,t.schema)?s.getAttribute(e):n.getAttribute(e)}_isRangeToUpdate(e,t){for(const n of t)if(n.containsRange(e))return!1;return!0}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class yA extends R{refresh(){const e=this.editor.model,t=e.document.selection,n=t.getSelectedElement();$o(n,e.schema)?this.isEnabled=e.schema.checkAttribute(n,"linkHref"):this.isEnabled=e.schema.checkAttributeInSelection(t,"linkHref")}execute(){const e=this.editor,t=this.editor.model,n=t.document.selection,s=e.commands.get("link");t.change(o=>{const r=n.isCollapsed?[on(n.getFirstPosition(),"linkHref",n.getAttribute("linkHref"),t)]:t.schema.getValidRanges(n.getRanges(),"linkHref");for(const a of r)if(o.removeAttribute("linkHref",a),s)for(const l of s.manualDecorators)o.removeAttribute(l.id,a)})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class $d{constructor({id:e,label:t,attributes:n,classes:s,styles:o,defaultValue:r}){this.id=e,this.set("value"),this.defaultValue=r,this.label=t,this.attributes=n,this.classes=s,this.styles=o}_createPattern(){return{attributes:this.attributes,classes:this.classes,styles:this.styles}}}A($d,$);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const CA="ck-link_selected",Wd="automatic",EA="manual",TA=/^(https?:)?\/\//;class kA extends v{static get pluginName(){return"LinkEditing"}static get requires(){return[ki,Bu,je]}constructor(e){super(e);e.config.define("link",{addTargetToExternalLinks:!1})}init(){const e=this.editor;e.model.schema.extend("$text",{allowAttributes:"linkHref"}),e.conversion.for("dataDowncast").attributeToElement({model:"linkHref",view:Fd}),e.conversion.for("editingDowncast").attributeToElement({model:"linkHref",view:(s,o)=>Fd(Ld(s),o)}),e.conversion.for("upcast").elementToAttribute({view:{name:"a",attributes:{href:!0}},model:{key:"linkHref",value:s=>s.getAttribute("href")}}),e.commands.add("link",new vA(e)),e.commands.add("unlink",new yA(e));const t=wA(e.t,bA(e.config.get("link.decorators")));this._enableAutomaticDecorators(t.filter(s=>s.mode===Wd)),this._enableManualDecorators(t.filter(s=>s.mode===EA)),e.plugins.get(ki).registerAttribute("linkHref"),Hu(e,"linkHref","a",CA),this._enableLinkOpen(),this._enableInsertContentSelectionAttributesFixer(),this._enableClickingAfterLink(),this._enableTypingOverLink(),this._handleDeleteContentAfterLink()}_enableAutomaticDecorators(e){const t=this.editor,s=t.commands.get("link").automaticDecorators;t.config.get("link.addTargetToExternalLinks")&&s.add({id:"linkIsExternal",mode:Wd,callback:o=>TA.test(o),attributes:{target:"_blank",rel:"noopener noreferrer"}}),s.add(e),s.length&&t.conversion.for("downcast").add(s.getDispatcher())}_enableManualDecorators(e){if(!e.length)return;const t=this.editor,s=t.commands.get("link").manualDecorators;e.forEach(o=>{t.model.schema.extend("$text",{allowAttributes:o.id}),o=new $d(o),s.add(o),t.conversion.for("downcast").attributeToElement({model:o.id,view:(r,{writer:a})=>{if(r){const l=a.createAttributeElement("a",o.attributes,{priority:5});o.classes&&a.addClass(o.classes,l);for(const c in o.styles)a.setStyle(c,o.styles[c],l);return a.setCustomProperty("link",!0,l),l}}}),t.conversion.for("upcast").elementToAttribute({view:x({name:"a"},o._createPattern()),model:{key:o.id}})})}_enableLinkOpen(){const e=this.editor,n=e.editing.view.document,s=e.model.document;this.listenTo(n,"click",(o,r)=>{if(!(W.isMac?r.domEvent.metaKey:r.domEvent.ctrlKey))return;let l=r.domTarget;if(l.tagName.toLowerCase()!="a"&&(l=l.closest("a")),!l)return;const c=l.getAttribute("href");!c||(o.stop(),r.preventDefault(),Hd(c))},{context:"$capture"}),this.listenTo(n,"enter",(o,r)=>{const a=s.selection,l=a.getSelectedElement(),c=l?l.getAttribute("linkHref"):a.getAttribute("linkHref");!(c&&r.domEvent.altKey)||(o.stop(),Hd(c))},{context:"a"})}_enableInsertContentSelectionAttributesFixer(){const t=this.editor.model,n=t.document.selection;this.listenTo(t,"insertContent",()=>{const s=n.anchor.nodeBefore,o=n.anchor.nodeAfter;!n.hasAttribute("linkHref")||!s||!s.hasAttribute("linkHref")||o&&o.hasAttribute("linkHref")||t.change(r=>{Wo(r,Uo(t.schema))})},{priority:"low"})}_enableClickingAfterLink(){const e=this.editor,t=e.model;e.editing.view.addObserver(Ci);let n=!1;this.listenTo(e.editing.view.document,"mousedown",()=>{n=!0}),this.listenTo(e.editing.view.document,"selectionChange",()=>{if(!n)return;n=!1;const s=t.document.selection;if(!s.isCollapsed||!s.hasAttribute("linkHref"))return;const o=s.getFirstPosition(),r=on(o,"linkHref",s.getAttribute("linkHref"),t);(o.isTouching(r.start)||o.isTouching(r.end))&&t.change(a=>{Wo(a,Uo(t.schema))})})}_enableTypingOverLink(){const e=this.editor,t=e.editing.view;let n,s;this.listenTo(t.document,"delete",()=>{s=!0},{priority:"high"}),this.listenTo(e.model,"deleteContent",()=>{const o=e.model.document.selection;if(!o.isCollapsed){if(s){s=!1;return}!Ud(e)||AA(e.model)&&(n=o.getAttributes())}},{priority:"high"}),this.listenTo(e.model,"insertContent",(o,[r])=>{s=!1,!!Ud(e)&&(!n||(e.model.change(a=>{for(const[l,c]of n)a.setAttribute(l,c,r)}),n=null))},{priority:"high"})}_handleDeleteContentAfterLink(){const e=this.editor,t=e.model,n=t.document.selection,s=e.editing.view;let o=!1,r=!1;this.listenTo(s.document,"delete",(a,l)=>{r=l.domEvent.keyCode===V.backspace},{priority:"high"}),this.listenTo(t,"deleteContent",()=>{o=!1;const a=n.getFirstPosition(),l=n.getAttribute("linkHref");if(!l)return;const c=on(a,"linkHref",l,t);o=c.containsPosition(a)||c.end.isEqual(a)},{priority:"high"}),this.listenTo(t,"deleteContent",()=>{!r||(r=!1,!o&&e.model.enqueueChange(a=>{Wo(a,Uo(t.schema))}))},{priority:"low"})}}function Wo(i,e){i.removeSelectionAttribute("linkHref");for(const t of e)i.removeSelectionAttribute(t)}function AA(i){const e=i.document.selection,t=e.getFirstPosition(),n=e.getLastPosition(),s=t.nodeAfter;if(!s||!s.is("$text")||!s.hasAttribute("linkHref"))return!1;const o=n.textNode||n.nodeBefore;return s===o?!0:on(t,"linkHref",s.getAttribute("linkHref"),i).containsRange(i.createRange(t,n),!0)}function Ud(i){return i.plugins.get("Input").isInput(i.model.change(t=>t.batch))}function Uo(i){return i.getDefinition("$text").allowAttributes.filter(t=>t.startsWith("link"))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class SA extends M{constructor(e,t){super(e);const n=e.t;this.focusTracker=new Ae,this.keystrokes=new et,this.urlInputView=this._createUrlInput(),this.saveButtonView=this._createButton(n("Save"),fe.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(n("Cancel"),fe.cancel,"ck-button-cancel","cancel"),this._manualDecoratorSwitches=this._createManualDecoratorSwitches(t),this.children=this._createFormChildren(t.manualDecorators),this._focusables=new Mt,this._focusCycler=new Yt({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}});const s=["ck","ck-link-form","ck-responsive-form"];t.manualDecorators.length&&s.push("ck-link-form_layout-vertical","ck-vertical-form"),this.setTemplate({tag:"form",attributes:{class:s,tabindex:"-1"},children:this.children}),eo(this)}getDecoratorSwitchesState(){return Array.from(this._manualDecoratorSwitches).reduce((e,t)=>(e[t.name]=t.isOn,e),{})}render(){super.render(),to({view:this}),[this.urlInputView,...this._manualDecoratorSwitches,this.saveButtonView,this.cancelButtonView].forEach(t=>{this._focusables.add(t),this.focusTracker.add(t.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createUrlInput(){const e=this.locale.t,t=new uo(this.locale,ho);return t.label=e("Link URL"),t}_createButton(e,t,n,s){const o=new U(this.locale);return o.set({label:e,icon:t,tooltip:!0}),o.extendTemplate({attributes:{class:n}}),s&&o.delegate("execute").to(this,s),o}_createManualDecoratorSwitches(e){const t=this.createCollection();for(const n of e.manualDecorators){const s=new so(this.locale);s.set({name:n.id,label:n.label,withText:!0}),s.bind("isOn").toMany([n,e],"value",(o,r)=>r===void 0&&o===void 0?n.defaultValue:o),s.on("execute",()=>{n.set("value",!s.isOn)}),t.add(s)}return t}_createFormChildren(e){const t=this.createCollection();if(t.add(this.urlInputView),e.length){const n=new M;n.setTemplate({tag:"ul",children:this._manualDecoratorSwitches.map(s=>({tag:"li",children:[s],attributes:{class:["ck","ck-list__item"]}})),attributes:{class:["ck","ck-reset","ck-list"]}}),t.add(n)}return t.add(this.saveButtonView),t.add(this.cancelButtonView),t}}var PA='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.077 15 .991-1.416a.75.75 0 1 1 1.229.86l-1.148 1.64a.748.748 0 0 1-.217.206 5.251 5.251 0 0 1-8.503-5.955.741.741 0 0 1 .12-.274l1.147-1.639a.75.75 0 1 1 1.228.86L4.933 10.7l.006.003a3.75 3.75 0 0 0 6.132 4.294l.006.004zm5.494-5.335a.748.748 0 0 1-.12.274l-1.147 1.639a.75.75 0 1 1-1.228-.86l.86-1.23a3.75 3.75 0 0 0-6.144-4.301l-.86 1.229a.75.75 0 0 1-1.229-.86l1.148-1.64a.748.748 0 0 1 .217-.206 5.251 5.251 0 0 1 8.503 5.955zm-4.563-2.532a.75.75 0 0 1 .184 1.045l-3.155 4.505a.75.75 0 1 1-1.229-.86l3.155-4.506a.75.75 0 0 1 1.045-.184zm4.919 10.562-1.414 1.414a.75.75 0 1 1-1.06-1.06l1.414-1.415-1.415-1.414a.75.75 0 0 1 1.061-1.06l1.414 1.414 1.414-1.415a.75.75 0 0 1 1.061 1.061l-1.414 1.414 1.414 1.415a.75.75 0 0 1-1.06 1.06l-1.415-1.414z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class xA extends M{constructor(e){super(e);const t=e.t;this.focusTracker=new Ae,this.keystrokes=new et,this.previewButtonView=this._createPreviewButton(),this.unlinkButtonView=this._createButton(t("Unlink"),PA,"unlink"),this.editButtonView=this._createButton(t("Edit link"),fe.pencil,"edit"),this.set("href"),this._focusables=new Mt,this._focusCycler=new Yt({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-link-actions","ck-responsive-form"],tabindex:"-1"},children:[this.previewButtonView,this.editButtonView,this.unlinkButtonView]})}render(){super.render(),[this.previewButtonView,this.editButtonView,this.unlinkButtonView].forEach(t=>{this._focusables.add(t),this.focusTracker.add(t.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createButton(e,t,n){const s=new U(this.locale);return s.set({label:e,icon:t,tooltip:!0}),s.delegate("execute").to(this,n),s}_createPreviewButton(){const e=new U(this.locale),t=this.bindTemplate,n=this.t;return e.set({withText:!0,tooltip:n("Open link in new tab")}),e.extendTemplate({attributes:{class:["ck","ck-link-actions__preview"],href:t.to("href",s=>s&&Ld(s)),target:"_blank",rel:"noopener noreferrer"}}),e.bind("label").to(this,"href",s=>s||n("This link has no URL")),e.bind("isEnabled").to(this,"href",s=>!!s),e.template.tag="a",e.template.eventListeners={},e}}var IA='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.077 15 .991-1.416a.75.75 0 1 1 1.229.86l-1.148 1.64a.748.748 0 0 1-.217.206 5.251 5.251 0 0 1-8.503-5.955.741.741 0 0 1 .12-.274l1.147-1.639a.75.75 0 1 1 1.228.86L4.933 10.7l.006.003a3.75 3.75 0 0 0 6.132 4.294l.006.004zm5.494-5.335a.748.748 0 0 1-.12.274l-1.147 1.639a.75.75 0 1 1-1.228-.86l.86-1.23a3.75 3.75 0 0 0-6.144-4.301l-.86 1.229a.75.75 0 0 1-1.229-.86l1.148-1.64a.748.748 0 0 1 .217-.206 5.251 5.251 0 0 1 8.503 5.955zm-4.563-2.532a.75.75 0 0 1 .184 1.045l-3.155 4.505a.75.75 0 1 1-1.229-.86l3.155-4.506a.75.75 0 0 1 1.045-.184z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Ge="link-ui";class RA extends v{static get requires(){return[vi]}static get pluginName(){return"LinkUI"}init(){const e=this.editor;e.editing.view.addObserver(NC),this.actionsView=this._createActionsView(),this.formView=this._createFormView(),this._balloon=e.plugins.get(vi),this._createToolbarLinkButton(),this._enableUserBalloonInteractions(),e.conversion.for("editingDowncast").markerToHighlight({model:Ge,view:{classes:["ck-fake-link-selection"]}}),e.conversion.for("editingDowncast").markerToElement({model:Ge,view:{name:"span",classes:["ck-fake-link-selection","ck-fake-link-selection_collapsed"]}})}destroy(){super.destroy(),this.formView.destroy()}_createActionsView(){const e=this.editor,t=new xA(e.locale),n=e.commands.get("link"),s=e.commands.get("unlink");return t.bind("href").to(n,"value"),t.editButtonView.bind("isEnabled").to(n),t.unlinkButtonView.bind("isEnabled").to(s),this.listenTo(t,"edit",()=>{this._addFormView()}),this.listenTo(t,"unlink",()=>{e.execute("unlink"),this._hideUI()}),t.keystrokes.set("Esc",(o,r)=>{this._hideUI(),r()}),t.keystrokes.set(Ho,(o,r)=>{this._addFormView(),r()}),t}_createFormView(){const e=this.editor,t=e.commands.get("link"),n=e.config.get("link.defaultProtocol"),s=new SA(e.locale,t);return s.urlInputView.fieldView.bind("value").to(t,"value"),s.urlInputView.bind("isReadOnly").to(t,"isEnabled",o=>!o),s.saveButtonView.bind("isEnabled").to(t),this.listenTo(s,"submit",()=>{const{value:o}=s.urlInputView.fieldView.element,r=zd(o,n);e.execute("link",r,s.getDecoratorSwitchesState()),this._closeFormView()}),this.listenTo(s,"cancel",()=>{this._closeFormView()}),s.keystrokes.set("Esc",(o,r)=>{this._closeFormView(),r()}),s}_createToolbarLinkButton(){const e=this.editor,t=e.commands.get("link"),n=e.t;e.keystrokes.set(Ho,(s,o)=>{o(),t.isEnabled&&this._showUI(!0)}),e.ui.componentFactory.add("link",s=>{const o=new U(s);return o.isEnabled=!0,o.label=n("Link"),o.icon=IA,o.keystroke=Ho,o.tooltip=!0,o.isToggleable=!0,o.bind("isEnabled").to(t,"isEnabled"),o.bind("isOn").to(t,"value",r=>!!r),this.listenTo(o,"execute",()=>this._showUI(!0)),o})}_enableUserBalloonInteractions(){const e=this.editor.editing.view.document;this.listenTo(e,"click",()=>{this._getSelectedLinkElement()&&this._showUI()}),this.editor.keystrokes.set("Tab",(t,n)=>{this._areActionsVisible&&!this.actionsView.focusTracker.isFocused&&(this.actionsView.focus(),n())},{priority:"high"}),this.editor.keystrokes.set("Esc",(t,n)=>{this._isUIVisible&&(this._hideUI(),n())}),Zs({emitter:this.formView,activator:()=>this._isUIInPanel,contextElements:[this._balloon.view.element],callback:()=>this._hideUI()})}_addActionsView(){this._areActionsInPanel||this._balloon.add({view:this.actionsView,position:this._getBalloonPositionData()})}_addFormView(){if(this._isFormInPanel)return;const t=this.editor.commands.get("link");this.formView.disableCssTransitions(),this._balloon.add({view:this.formView,position:this._getBalloonPositionData()}),this._balloon.visibleView===this.formView&&this.formView.urlInputView.fieldView.select(),this.formView.enableCssTransitions(),this.formView.urlInputView.fieldView.element.value=t.value||""}_closeFormView(){const e=this.editor.commands.get("link");e.restoreManualDecoratorStates(),e.value!==void 0?this._removeFormView():this._hideUI()}_removeFormView(){this._isFormInPanel&&(this.formView.saveButtonView.focus(),this._balloon.remove(this.formView),this.editor.editing.view.focus(),this._hideFakeVisualSelection())}_showUI(e=!1){this._getSelectedLinkElement()?(this._areActionsVisible?this._addFormView():this._addActionsView(),e&&this._balloon.showStack("main")):(this._showFakeVisualSelection(),this._addActionsView(),e&&this._balloon.showStack("main"),this._addFormView()),this._startUpdatingUI()}_hideUI(){if(!this._isUIInPanel)return;const e=this.editor;this.stopListening(e.ui,"update"),this.stopListening(this._balloon,"change:visibleView"),e.editing.view.focus(),this._removeFormView(),this._balloon.remove(this.actionsView),this._hideFakeVisualSelection()}_startUpdatingUI(){const e=this.editor,t=e.editing.view.document;let n=this._getSelectedLinkElement(),s=r();const o=()=>{const a=this._getSelectedLinkElement(),l=r();n&&!a||!n&&l!==s?this._hideUI():this._isUIVisible&&this._balloon.updatePosition(this._getBalloonPositionData()),n=a,s=l};function r(){return t.selection.focus.getAncestors().reverse().find(a=>a.is("element"))}this.listenTo(e.ui,"update",o),this.listenTo(this._balloon,"change:visibleView",o)}get _isFormInPanel(){return this._balloon.hasView(this.formView)}get _areActionsInPanel(){return this._balloon.hasView(this.actionsView)}get _areActionsVisible(){return this._balloon.visibleView===this.actionsView}get _isUIInPanel(){return this._isFormInPanel||this._areActionsInPanel}get _isUIVisible(){return this._balloon.visibleView==this.formView||this._areActionsVisible}_getBalloonPositionData(){const e=this.editor.editing.view,t=this.editor.model,n=e.document;let s=null;if(t.markers.has(Ge)){const o=Array.from(this.editor.editing.mapper.markerNameToElements(Ge)),r=e.createRange(e.createPositionBefore(o[0]),e.createPositionAfter(o[o.length-1]));s=e.domConverter.viewRangeToDom(r)}else s=()=>{const o=this._getSelectedLinkElement();return o?e.domConverter.mapViewToDom(o):e.domConverter.viewRangeToDom(n.selection.getFirstRange())};return{target:s}}_getSelectedLinkElement(){const e=this.editor.editing.view,t=e.document.selection,n=t.getSelectedElement();if(t.isCollapsed||n&&X(n))return qo(t.getFirstPosition());{const s=t.getFirstRange().getTrimmed(),o=qo(s.start),r=qo(s.end);return!o||o!=r?null:e.createRangeIn(o).getTrimmed().isEqual(s)?o:null}}_showFakeVisualSelection(){const e=this.editor.model;e.change(t=>{const n=e.document.selection.getFirstRange();if(e.markers.has(Ge))t.updateMarker(Ge,{range:n});else if(n.start.isAtEnd){const s=n.start.getLastMatchingPosition(({item:o})=>!e.schema.isContent(o),{boundaries:n});t.addMarker(Ge,{usingOperation:!1,affectsData:!1,range:t.createRange(s,n.end)})}else t.addMarker(Ge,{usingOperation:!1,affectsData:!1,range:n})})}_hideFakeVisualSelection(){const e=this.editor.model;e.markers.has(Ge)&&e.change(t=>{t.removeMarker(Ge)})}}function qo(i){return i.getAncestors().find(e=>gA(e))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const MA=4,VA=new RegExp("(^|\\s)(((?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(((?!www\\.)|(www\\.))(?![-_])(?:[-_a-z0-9\\u00a1-\\uffff]{1,63}\\.)+(?:[a-z\\u00a1-\\uffff]{2,63})))(?::\\d{2,5})?(?:[/?#]\\S*)?)|((www.|(\\S+@))((?![-_])(?:[-_a-z0-9\\u00a1-\\uffff]{1,63}\\.))+(?:[a-z\\u00a1-\\uffff]{2,63})))$","i"),OA=2;class NA extends v{static get requires(){return[ft]}static get pluginName(){return"AutoLink"}init(){const t=this.editor.model.document.selection;t.on("change:range",()=>{this.isEnabled=!t.anchor.parent.is("element","codeBlock")}),this._enableTypingHandling()}afterInit(){this._enableEnterHandling(),this._enableShiftEnterHandling()}_enableTypingHandling(){const e=this.editor,t=new yo(e.model,s=>{if(!DA(s))return;const o=qd(s.substr(0,s.length-1));if(o)return{url:o}}),n=e.plugins.get("Input");t.on("matched:data",(s,o)=>{const{batch:r,range:a,url:l}=o;if(!n.isInput(r))return;const c=a.end.getShiftedBy(-1),u=c.getShiftedBy(-l.length),d=e.model.createRange(u,c);this._applyAutoLink(l,d)}),t.bind("isEnabled").to(this)}_enableEnterHandling(){const e=this.editor,t=e.model,n=e.commands.get("enter");!n||n.on("execute",()=>{const s=t.document.selection.getFirstPosition();if(!s.parent.previousSibling)return;const o=t.createRangeIn(s.parent.previousSibling);this._checkAndApplyAutoLinkOnRange(o)})}_enableShiftEnterHandling(){const e=this.editor,t=e.model,n=e.commands.get("shiftEnter");!n||n.on("execute",()=>{const s=t.document.selection.getFirstPosition(),o=t.createRange(t.createPositionAt(s.parent,0),s.getShiftedBy(-1));this._checkAndApplyAutoLinkOnRange(o)})}_checkAndApplyAutoLinkOnRange(e){const t=this.editor.model,{text:n,range:s}=Fu(e,t),o=qd(n);if(o){const r=t.createRange(s.end.getShiftedBy(-o.length),s.end);this._applyAutoLink(o,r)}}_applyAutoLink(e,t){const n=this.editor.model,s=this.editor.plugins.get("Delete");!this.isEnabled||!BA(t,n)||n.enqueueChange(o=>{const r=this.editor.config.get("link.defaultProtocol"),a=zd(e,r);o.setAttribute("linkHref",a,t),n.enqueueChange(()=>{s.requestUndoOnBackspace()})})}}function DA(i){return i.length>MA&&i[i.length-1]===" "&&i[i.length-2]!==" "}function qd(i){const e=VA.exec(i);return e?e[OA]:null}function BA(i,e){return e.schema.checkAttributeInSelection(e.createSelection(i),"linkHref")}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class FA extends v{static get requires(){return[kA,RA,NA]}static get pluginName(){return"Link"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class jd extends R{constructor(e,t){super(e);this.type=t}refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(e={}){const t=this.editor.model,n=t.document,s=Array.from(n.selection.getSelectedBlocks()).filter(r=>Gd(r,t.schema)),o=e.forceValue!==void 0?!e.forceValue:this.value;t.change(r=>{if(o){let a=s[s.length-1].nextSibling,l=Number.POSITIVE_INFINITY,c=[];for(;a&&a.name=="listItem"&&a.getAttribute("listIndent")!==0;){const u=a.getAttribute("listIndent");u<l&&(l=u);const d=u-l;c.push({element:a,listIndent:d}),a=a.nextSibling}c=c.reverse();for(const u of c)r.setAttribute("listIndent",u.listIndent,u.element)}if(!o){let a=Number.POSITIVE_INFINITY;for(const l of s)l.is("element","listItem")&&l.getAttribute("listIndent")<a&&(a=l.getAttribute("listIndent"));a=a===0?1:a,Kd(s,!0,a),Kd(s,!1,a)}for(const a of s.reverse())o&&a.name=="listItem"?r.rename(a,"paragraph"):!o&&a.name!="listItem"?(r.setAttributes({listType:this.type,listIndent:0},a),r.rename(a,"listItem")):!o&&a.name=="listItem"&&a.getAttribute("listType")!=this.type&&r.setAttribute("listType",this.type,a);this.fire("_executeCleanup",s)})}_getValue(){const e=ge(this.editor.model.document.selection.getSelectedBlocks());return!!e&&e.is("element","listItem")&&e.getAttribute("listType")==this.type}_checkEnabled(){if(this.value)return!0;const e=this.editor.model.document.selection,t=this.editor.model.schema,n=ge(e.getSelectedBlocks());return n?Gd(n,t):!1}}function Kd(i,e,t){const n=e?i[0]:i[i.length-1];if(n.is("element","listItem")){let s=n[e?"previousSibling":"nextSibling"],o=n.getAttribute("listIndent");for(;s&&s.is("element","listItem")&&s.getAttribute("listIndent")>=t;)o>s.getAttribute("listIndent")&&(o=s.getAttribute("listIndent")),s.getAttribute("listIndent")==o&&i[e?"unshift":"push"](s),s=s[e?"previousSibling":"nextSibling"]}}function Gd(i,e){return e.checkChild(i.parent,"listItem")&&!e.isObject(i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Jd extends R{constructor(e,t){super(e);this._indentBy=t=="forward"?1:-1}refresh(){this.isEnabled=this._checkEnabled()}execute(){const e=this.editor.model,t=e.document;let n=Array.from(t.selection.getSelectedBlocks());e.change(s=>{const o=n[n.length-1];let r=o.nextSibling;for(;r&&r.name=="listItem"&&r.getAttribute("listIndent")>o.getAttribute("listIndent");)n.push(r),r=r.nextSibling;this._indentBy<0&&(n=n.reverse());for(const a of n){const l=a.getAttribute("listIndent")+this._indentBy;l<0?s.rename(a,"paragraph"):s.setAttribute("listIndent",l,a)}this.fire("_executeCleanup",n)})}_checkEnabled(){const e=ge(this.editor.model.document.selection.getSelectedBlocks());if(!e||!e.is("element","listItem"))return!1;if(this._indentBy>0){const t=e.getAttribute("listIndent"),n=e.getAttribute("listType");let s=e.previousSibling;for(;s&&s.is("element","listItem")&&s.getAttribute("listIndent")>=t;){if(s.getAttribute("listIndent")==t)return s.getAttribute("listType")==n;s=s.previousSibling}return!1}return!0}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function LA(i){const e=i.createContainerElement("li");return e.getFillerOffset=$A,e}function zA(i,e){const t=e.mapper,n=e.writer,s=i.getAttribute("listType")=="numbered"?"ol":"ul",o=LA(n),r=n.createContainerElement(s,null);return n.insert(n.createPositionAt(r,0),o),t.bindElements(i,o),o}function Qd(i,e,t,n){const s=e.parent,o=t.mapper,r=t.writer;let a=o.toViewPosition(n.createPositionBefore(i));const l=Xd(i.previousSibling,{sameIndent:!0,smallerIndent:!0,listIndent:i.getAttribute("listIndent")}),c=i.previousSibling;if(l&&l.getAttribute("listIndent")==i.getAttribute("listIndent")){const u=o.toViewElement(l);a=r.breakContainer(r.createPositionAfter(u))}else if(c&&c.name=="listItem"){a=o.toViewPosition(n.createPositionAt(c,"end"));const u=o.findMappedViewAncestor(a),d=HA(u);d?a=r.createPositionBefore(d):a=r.createPositionAt(u,"end")}else a=o.toViewPosition(n.createPositionBefore(i));if(a=Yd(a),r.insert(a,s),c&&c.name=="listItem"){const u=o.toViewElement(c),h=r.createRange(r.createPositionAt(u,0),a).getWalker({ignoreElementEnd:!0});for(const m of h)if(m.item.is("element","li")){const g=r.breakContainer(r.createPositionBefore(m.item)),p=m.item.parent,b=r.createPositionAt(e,"end");Pe(r,b.nodeBefore,b.nodeAfter),r.move(r.createRangeOn(p),b),h.position=g}}else{const u=s.nextSibling;if(u&&(u.is("element","ul")||u.is("element","ol"))){let d=null;for(const h of u.getChildren()){const m=o.toModelElement(h);if(m&&m.getAttribute("listIndent")>i.getAttribute("listIndent"))d=h;else break}d&&(r.breakContainer(r.createPositionAfter(d)),r.move(r.createRangeOn(d.parent),r.createPositionAt(e,"end")))}}Pe(r,s,s.nextSibling),Pe(r,s.previousSibling,s)}function Pe(i,e,t){return!e||!t||e.name!="ul"&&e.name!="ol"||e.name!=t.name||e.getAttribute("class")!==t.getAttribute("class")?null:i.mergeContainers(i.createPositionAfter(e))}function Yd(i){return i.getLastMatchingPosition(e=>e.item.is("uiElement"))}function Xd(i,e){const t=!!e.sameIndent,n=!!e.smallerIndent,s=e.listIndent;let o=i;for(;o&&o.name=="listItem";){const r=o.getAttribute("listIndent");if(t&&s==r||n&&s>r)return o;e.direction==="forward"?o=o.nextSibling:o=o.previousSibling}return null}function Zd(i,e,t,n){i.ui.componentFactory.add(e,s=>{const o=i.commands.get(e),r=new U(s);return r.set({label:t,icon:n,tooltip:!0,isToggleable:!0}),r.bind("isOn","isEnabled").to(o,"value","isEnabled"),r.on("execute",()=>{i.execute(e),i.editing.view.focus()}),r})}function HA(i){for(const e of i.getChildren())if(e.name=="ul"||e.name=="ol")return e;return null}function $A(){const i=!this.isEmpty&&(this.getChild(0).name=="ul"||this.getChild(0).name=="ol");return this.isEmpty||i?0:Ya.call(this)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function eh(i){return(e,t,n)=>{const s=n.consumable;if(!s.test(t.item,"insert")||!s.test(t.item,"attribute:listType")||!s.test(t.item,"attribute:listIndent"))return;s.consume(t.item,"insert"),s.consume(t.item,"attribute:listType"),s.consume(t.item,"attribute:listIndent");const o=t.item,r=zA(o,n);Qd(o,r,n,i)}}function WA(i){return(e,t,n)=>{const r=n.mapper.toViewPosition(t.position).getLastMatchingPosition(m=>!m.item.is("element","li")).nodeAfter,a=n.writer;a.breakContainer(a.createPositionBefore(r)),a.breakContainer(a.createPositionAfter(r));const l=r.parent,c=l.previousSibling,u=a.createRangeOn(l),d=a.remove(u);c&&c.nextSibling&&Pe(a,c,c.nextSibling);const h=n.mapper.toModelElement(r);sh(h.getAttribute("listIndent")+1,t.position,u.start,r,n,i);for(const m of a.createRangeIn(d).getItems())n.mapper.unbindViewElement(m);e.stop()}}function UA(i,e,t){if(!t.consumable.consume(e.item,"attribute:listType"))return;const n=t.mapper.toViewElement(e.item),s=t.writer;s.breakContainer(s.createPositionBefore(n)),s.breakContainer(s.createPositionAfter(n));const o=n.parent,r=e.attributeNewValue=="numbered"?"ol":"ul";s.rename(r,o)}function qA(i,e,t){const s=t.mapper.toViewElement(e.item).parent,o=t.writer;Pe(o,s,s.nextSibling),Pe(o,s.previousSibling,s);for(const r of e.item.getChildren())t.consumable.consume(r,"insert")}function jA(i){return(e,t,n)=>{if(!n.consumable.consume(t.item,"attribute:listIndent"))return;const s=n.mapper.toViewElement(t.item),o=n.writer;o.breakContainer(o.createPositionBefore(s)),o.breakContainer(o.createPositionAfter(s));const r=s.parent,a=r.previousSibling,l=o.createRangeOn(r);o.remove(l),a&&a.nextSibling&&Pe(o,a,a.nextSibling),sh(t.attributeOldValue+1,t.range.start,l.start,s,n,i),Qd(t.item,s,n,i);for(const c of t.item.getChildren())n.consumable.consume(c,"insert")}}function th(i,e,t){if(e.item.name!="listItem"){let n=t.mapper.toViewPosition(e.range.start);const s=t.writer,o=[];for(;(n.parent.name=="ul"||n.parent.name=="ol")&&(n=s.breakContainer(n),n.parent.name=="li");){const r=n,a=s.createPositionAt(n.parent,"end");if(!r.isEqual(a)){const l=s.remove(s.createRange(r,a));o.push(l)}n=s.createPositionAfter(n.parent)}if(o.length>0){for(let r=0;r<o.length;r++){const a=n.nodeBefore;if(n=s.insert(n,o[r]).end,r>0){const c=Pe(s,a,a.nextSibling);c&&c.parent==a&&n.offset--}}Pe(s,n.nodeBefore,n.nodeAfter)}}}function KA(i,e,t){const n=t.mapper.toViewPosition(e.position),s=n.nodeBefore,o=n.nodeAfter;Pe(t.writer,s,o)}function GA(i,e,t){if(t.consumable.consume(e.viewItem,{name:!0})){const n=t.writer,s=n.createElement("listItem"),o=tS(e.viewItem);n.setAttribute("listIndent",o,s);const r=e.viewItem.parent&&e.viewItem.parent.name=="ol"?"numbered":"bulleted";if(n.setAttribute("listType",r,s),!t.safeInsert(s,e.modelCursor))return;const a=ZA(s,e.viewItem.getChildren(),t);e.modelRange=n.createRange(e.modelCursor,a),t.updateConversionResult(s,e)}}function nh(i,e,t){if(t.consumable.test(e.viewItem,{name:!0})){const n=Array.from(e.viewItem.getChildren());for(const s of n)!(s.is("element","li")||cn(s))&&s._remove()}}function JA(i,e,t){if(t.consumable.test(e.viewItem,{name:!0})){if(e.viewItem.childCount===0)return;const n=[...e.viewItem.getChildren()];let s=!1;for(const o of n)s&&!cn(o)&&o._remove(),cn(o)&&(s=!0)}}function ih(i){return(e,t)=>{if(t.isPhantom)return;const n=t.modelPosition.nodeBefore;if(n&&n.is("element","listItem")){const s=t.mapper.toViewElement(n),o=s.getAncestors().find(cn),r=i.createPositionAt(s,0).getWalker();for(const a of r)if(a.type=="elementStart"&&a.item.is("element","li")){t.viewPosition=a.previousPosition;break}else if(a.type=="elementEnd"&&a.item==o){t.viewPosition=a.nextPosition;break}}}}function QA(i){return(e,t)=>{const n=t.viewPosition,s=n.parent,o=t.mapper;if(s.name=="ul"||s.name=="ol"){if(n.isAtEnd){const r=o.toModelElement(n.nodeBefore),a=o.getModelLength(n.nodeBefore);t.modelPosition=i.createPositionBefore(r).getShiftedBy(a)}else{const r=o.toModelElement(n.nodeAfter);t.modelPosition=i.createPositionBefore(r)}e.stop()}else if(s.name=="li"&&n.nodeBefore&&(n.nodeBefore.name=="ul"||n.nodeBefore.name=="ol")){const r=o.toModelElement(s);let a=1,l=n.nodeBefore;for(;l&&cn(l);)a+=o.getModelLength(l),l=l.previousSibling;t.modelPosition=i.createPositionBefore(r).getShiftedBy(a),e.stop()}}}function YA(i,e){const t=i.document.differ.getChanges(),n=new Map;let s=!1;for(const l of t)if(l.type=="insert"&&l.name=="listItem")o(l.position);else if(l.type=="insert"&&l.name!="listItem"){if(l.name!="$text"){const u=l.position.nodeAfter;u.hasAttribute("listIndent")&&(e.removeAttribute("listIndent",u),s=!0),u.hasAttribute("listType")&&(e.removeAttribute("listType",u),s=!0),u.hasAttribute("listStyle")&&(e.removeAttribute("listStyle",u),s=!0);for(const d of Array.from(i.createRangeIn(u)).filter(h=>h.item.is("element","listItem")))o(d.previousPosition)}const c=l.position.getShiftedBy(l.length);o(c)}else l.type=="remove"&&l.name=="listItem"?o(l.position):(l.type=="attribute"&&l.attributeKey=="listIndent"||l.type=="attribute"&&l.attributeKey=="listType")&&o(l.range.start);for(const l of n.values())r(l),a(l);return s;function o(l){const c=l.nodeBefore;if(!c||!c.is("element","listItem")){const u=l.nodeAfter;u&&u.is("element","listItem")&&n.set(u,u)}else{let u=c;if(n.has(u))return;for(let d=u.previousSibling;d&&d.is("element","listItem");d=u.previousSibling)if(u=d,n.has(u))return;n.set(c,u)}}function r(l){let c=0,u=null;for(;l&&l.is("element","listItem");){const d=l.getAttribute("listIndent");if(d>c){let h;u===null?(u=d-c,h=c):(u>d&&(u=d),h=d-u),e.setAttribute("listIndent",h,l),s=!0}else u=null,c=l.getAttribute("listIndent")+1;l=l.nextSibling}}function a(l){let c=[],u=null;for(;l&&l.is("element","listItem");){const d=l.getAttribute("listIndent");if(u&&u.getAttribute("listIndent")>d&&(c=c.slice(0,d+1)),d!=0)if(c[d]){const h=c[d];l.getAttribute("listType")!=h&&(e.setAttribute("listType",h,l),s=!0)}else c[d]=l.getAttribute("listType");u=l,l=l.nextSibling}}}function XA(i,[e,t]){let n=e.is("documentFragment")?e.getChild(0):e,s;if(t?s=this.createSelection(t):s=this.document.selection,n&&n.is("element","listItem")){const o=s.getFirstPosition();let r=null;if(o.parent.is("element","listItem")?r=o.parent:o.nodeBefore&&o.nodeBefore.is("element","listItem")&&(r=o.nodeBefore),r){const a=r.getAttribute("listIndent");if(a>0)for(;n&&n.is("element","listItem");)n._setAttribute("listIndent",n.getAttribute("listIndent")+a),n=n.nextSibling}}}function ZA(i,e,t){const{writer:n,schema:s}=t;let o=n.createPositionAfter(i);for(const r of e)if(r.name=="ul"||r.name=="ol")o=t.convertItem(r,o).modelCursor;else{const a=t.convertItem(r,n.createPositionAt(i,"end")),l=a.modelRange.start.nodeAfter;l&&l.is("element")&&!s.checkChild(i,l.name)&&(a.modelCursor.parent.is("element","listItem")?i=a.modelCursor.parent:i=eS(a.modelCursor),o=n.createPositionAfter(i))}return o}function eS(i){const e=new tt({startPosition:i});let t;do t=e.next();while(!t.value.item.is("element","listItem"));return t.value.item}function sh(i,e,t,n,s,o){const r=Xd(e.nodeBefore,{sameIndent:!0,smallerIndent:!0,listIndent:i,foo:"b"}),a=s.mapper,l=s.writer,c=r?r.getAttribute("listIndent"):null;let u;if(!r)u=t;else if(c==i){const d=a.toViewElement(r).parent;u=l.createPositionAfter(d)}else{const d=o.createPositionAt(r,"end");u=a.toViewPosition(d)}u=Yd(u);for(const d of[...n.getChildren()])cn(d)&&(u=l.move(l.createRangeOn(d),u).end,Pe(l,d,d.nextSibling),Pe(l,d.previousSibling,d))}function cn(i){return i.is("element","ol")||i.is("element","ul")}function tS(i){let e=0,t=i.parent;for(;t;){if(t.is("element","li"))e++;else{const n=t.previousSibling;n&&n.is("element","li")&&e++}t=t.parent}return e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class nS extends v{static get pluginName(){return"ListEditing"}static get requires(){return[Ei,ft]}init(){const e=this.editor;e.model.schema.register("listItem",{inheritAllFrom:"$block",allowAttributes:["listType","listIndent"]});const t=e.data,n=e.editing;e.model.document.registerPostFixer(r=>YA(e.model,r)),n.mapper.registerViewToModelLength("li",jo),t.mapper.registerViewToModelLength("li",jo),n.mapper.on("modelToViewPosition",ih(n.view)),n.mapper.on("viewToModelPosition",QA(e.model)),t.mapper.on("modelToViewPosition",ih(n.view)),e.conversion.for("editingDowncast").add(r=>{r.on("insert",th,{priority:"high"}),r.on("insert:listItem",eh(e.model)),r.on("attribute:listType:listItem",UA,{priority:"high"}),r.on("attribute:listType:listItem",qA,{priority:"low"}),r.on("attribute:listIndent:listItem",jA(e.model)),r.on("remove:listItem",WA(e.model)),r.on("remove",KA,{priority:"low"})}),e.conversion.for("dataDowncast").add(r=>{r.on("insert",th,{priority:"high"}),r.on("insert:listItem",eh(e.model))}),e.conversion.for("upcast").add(r=>{r.on("element:ul",nh,{priority:"high"}),r.on("element:ol",nh,{priority:"high"}),r.on("element:li",JA,{priority:"high"}),r.on("element:li",GA)}),e.model.on("insertContent",XA,{priority:"high"}),e.commands.add("numberedList",new jd(e,"numbered")),e.commands.add("bulletedList",new jd(e,"bulleted")),e.commands.add("indentList",new Jd(e,"forward")),e.commands.add("outdentList",new Jd(e,"backward"));const s=n.view.document;this.listenTo(s,"enter",(r,a)=>{const l=this.editor.model.document,c=l.selection.getLastPosition().parent;l.selection.isCollapsed&&c.name=="listItem"&&c.isEmpty&&(this.editor.execute("outdentList"),a.preventDefault(),r.stop())},{context:"li"}),this.listenTo(s,"delete",(r,a)=>{if(a.direction!=="backward")return;const l=this.editor.model.document.selection;if(!l.isCollapsed)return;const c=l.getFirstPosition();if(!c.isAtStart)return;const u=c.parent;u.name!=="listItem"||u.previousSibling&&u.previousSibling.name==="listItem"||(this.editor.execute("outdentList"),a.preventDefault(),r.stop())},{context:"li"});const o=r=>(a,l)=>{this.editor.commands.get(r).isEnabled&&(this.editor.execute(r),l())};e.keystrokes.set("Tab",o("indentList")),e.keystrokes.set("Shift+Tab",o("outdentList"))}afterInit(){const e=this.editor.commands,t=e.get("indent"),n=e.get("outdent");t&&t.registerChildCommand(e.get("indentList")),n&&n.registerChildCommand(e.get("outdentList"))}}function jo(i){let e=1;for(const t of i.getChildren())if(t.name=="ul"||t.name=="ol")for(const n of t.getChildren())e+=jo(n);return e}var iS='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M7 5.75c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zM3.5 3v5H2V3.7H1v-1h2.5V3zM.343 17.857l2.59-3.257H2.92a.6.6 0 1 0-1.04 0H.302a2 2 0 1 1 3.995 0h-.001c-.048.405-.16.734-.333.988-.175.254-.59.692-1.244 1.312H4.3v1h-4l.043-.043zM7 14.75a.75.75 0 0 1 .75-.75h9.5a.75.75 0 1 1 0 1.5h-9.5a.75.75 0 0 1-.75-.75z"/></svg>',sS='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M7 5.75c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zm-6 0C1 4.784 1.777 4 2.75 4c.966 0 1.75.777 1.75 1.75 0 .966-.777 1.75-1.75 1.75C1.784 7.5 1 6.723 1 5.75zm6 9c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zm-6 0c0-.966.777-1.75 1.75-1.75.966 0 1.75.777 1.75 1.75 0 .966-.777 1.75-1.75 1.75-.966 0-1.75-.777-1.75-1.75z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class oS extends v{static get pluginName(){return"ListUI"}init(){const e=this.editor.t;Zd(this.editor,"numberedList",e("Numbered List"),iS),Zd(this.editor,"bulletedList",e("Bulleted List"),sS)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class rS extends v{static get requires(){return[nS,oS]}static get pluginName(){return"List"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function oh(i,e){return n=>{n.on("attribute:url:media",t)};function t(n,s,o){if(!o.consumable.consume(s.item,n.name))return;const r=s.attributeNewValue,a=o.writer,l=o.mapper.toViewElement(s.item),c=[...l.getChildren()].find(d=>d.getCustomProperty("media-content"));a.remove(c);const u=i.getMediaViewElement(a,r,e);a.insert(a.createPositionAt(l,0),u)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function aS(i,e,t){return e.setCustomProperty("media",!0,i),bo(i,e,{label:t})}function rh(i,e,t,n){const s=i.createContainerElement("figure",{class:"media"});return i.insert(i.createPositionAt(s,0),e.getMediaViewElement(i,t,n)),s}function ah(i){const e=i.getSelectedElement();return e&&e.is("element","media")?e:null}function lh(i,e,t){i.change(n=>{const s=n.createElement("media",{url:e});i.insertContent(s,t),n.setSelection(s,"on")})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class lS extends R{refresh(){const e=this.editor.model,t=e.document.selection,n=ah(t);this.value=n?n.getAttribute("url"):null,this.isEnabled=uS(t)||cS(t,e)}execute(e){const t=this.editor.model,n=t.document.selection,s=ah(n);s?t.change(o=>{o.setAttribute("url",e,s)}):lh(t,e,tn(n,t))}}function cS(i,e){let n=tn(i,e).start.parent;return n.isEmpty&&!e.schema.isLimit(n)&&(n=n.parent),e.schema.checkChild(n,"media")}function uS(i){const e=i.getSelectedElement();return!!e&&e.name==="media"}var dS='<svg viewBox="0 0 64 42" xmlns="http://www.w3.org/2000/svg"><path d="M47.426 17V3.713L63.102 0v19.389h-.001l.001.272c0 1.595-2.032 3.43-4.538 4.098-2.506.668-4.538-.083-4.538-1.678 0-1.594 2.032-3.43 4.538-4.098.914-.244 2.032-.565 2.888-.603V4.516L49.076 7.447v9.556A1.014 1.014 0 0 0 49 17h-1.574zM29.5 17h-8.343a7.073 7.073 0 1 0-4.657 4.06v3.781H3.3a2.803 2.803 0 0 1-2.8-2.804V8.63a2.803 2.803 0 0 1 2.8-2.805h4.082L8.58 2.768A1.994 1.994 0 0 1 10.435 1.5h8.985c.773 0 1.477.448 1.805 1.149l1.488 3.177H26.7c1.546 0 2.8 1.256 2.8 2.805V17zm-11.637 0H17.5a1 1 0 0 0-1 1v.05A4.244 4.244 0 1 1 17.863 17zm29.684 2c.97 0 .953-.048.953.889v20.743c0 .953.016.905-.953.905H19.453c-.97 0-.953.048-.953-.905V19.89c0-.937-.016-.889.97-.889h28.077zm-4.701 19.338V22.183H24.154v16.155h18.692zM20.6 21.375v1.616h1.616v-1.616H20.6zm0 3.231v1.616h1.616v-1.616H20.6zm0 3.231v1.616h1.616v-1.616H20.6zm0 3.231v1.616h1.616v-1.616H20.6zm0 3.231v1.616h1.616v-1.616H20.6zm0 3.231v1.616h1.616V37.53H20.6zm24.233-16.155v1.616h1.615v-1.616h-1.615zm0 3.231v1.616h1.615v-1.616h-1.615zm0 3.231v1.616h1.615v-1.616h-1.615zm0 3.231v1.616h1.615v-1.616h-1.615zm0 3.231v1.616h1.615v-1.616h-1.615zm0 3.231v1.616h1.615V37.53h-1.615zM29.485 25.283a.4.4 0 0 1 .593-.35l9.05 4.977a.4.4 0 0 1 0 .701l-9.05 4.978a.4.4 0 0 1-.593-.35v-9.956z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const hS="0 0 64 42";class fS{constructor(e,t){const n=t.providers,s=t.extraProviders||[],o=new Set(t.removeProviders),r=n.concat(s).filter(a=>{const l=a.name;return l?!o.has(l):(de("media-embed-no-provider-name",{provider:a}),!1)});this.locale=e,this.providerDefinitions=r}hasMedia(e){return!!this._getMedia(e)}getMediaViewElement(e,t,n){return this._getMedia(t).getViewElement(e,n)}_getMedia(e){if(!e)return new ch(this.locale);e=e.trim();for(const t of this.providerDefinitions){const n=t.html,s=oe(t.url);for(const o of s){const r=this._getUrlMatches(e,o);if(r)return new ch(this.locale,e,r,n)}}return null}_getUrlMatches(e,t){let n=e.match(t);if(n)return n;let s=e.replace(/^https?:\/\//,"");return n=s.match(t),n||(s=s.replace(/^www\./,""),n=s.match(t),n)?n:null}}class ch{constructor(e,t,n,s){this.url=this._getValidUrl(t),this._t=e.t,this._match=n,this._previewRenderer=s}getViewElement(e,t){const n={};let s;if(t.renderForEditingView||t.renderMediaPreview&&this.url&&this._previewRenderer){this.url&&(n["data-oembed-url"]=this.url),t.renderForEditingView&&(n.class="ck-media__wrapper");const o=this._getPreviewHtml(t);s=e.createRawElement("div",n,(r,a)=>{a.setContentOf(r,o)})}else this.url&&(n.url=this.url),s=e.createEmptyElement(t.elementName,n);return e.setCustomProperty("media-content",!0,s),s}_getPreviewHtml(e){return this._previewRenderer?this._previewRenderer(this._match):this.url&&e.renderForEditingView?this._getPlaceholderHtml():""}_getPlaceholderHtml(){const e=new jc,t=new wi;return e.text=this._t("Open media in new tab"),t.content=dS,t.viewBox=hS,new Oe({tag:"div",attributes:{class:"ck ck-reset_all ck-media__placeholder"},children:[{tag:"div",attributes:{class:"ck-media__placeholder__icon"},children:[t]},{tag:"a",attributes:{class:"ck-media__placeholder__url",target:"_blank",rel:"noopener noreferrer",href:this.url},children:[{tag:"span",attributes:{class:"ck-media__placeholder__url__text"},children:[this.url]},e]}]}).render().outerHTML}_getValidUrl(e){return e?e.match(/^https?/)?e:"https://"+e:null}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Oi extends v{static get pluginName(){return"MediaEmbedEditing"}constructor(e){super(e);e.config.define("mediaEmbed",{elementName:"oembed",providers:[{name:"dailymotion",url:/^dailymotion\.com\/video\/(\w+)/,html:t=>`<div style="position: relative; padding-bottom: 100%; height: 0; "><iframe src="https://www.dailymotion.com/embed/video/${t[1]}" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0;" frameborder="0" width="480" height="270" allowfullscreen allow="autoplay"></iframe></div>`},{name:"spotify",url:[/^open\.spotify\.com\/(artist\/\w+)/,/^open\.spotify\.com\/(album\/\w+)/,/^open\.spotify\.com\/(track\/\w+)/],html:t=>`<div style="position: relative; padding-bottom: 100%; height: 0; padding-bottom: 126%;"><iframe src="https://open.spotify.com/embed/${t[1]}" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0;" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe></div>`},{name:"youtube",url:[/^(?:m\.)?youtube\.com\/watch\?v=([\w-]+)/,/^(?:m\.)?youtube\.com\/v\/([\w-]+)/,/^youtube\.com\/embed\/([\w-]+)/,/^youtu\.be\/([\w-]+)/],html:t=>`<div style="position: relative; padding-bottom: 100%; height: 0; padding-bottom: 56.2493%;"><iframe src="https://www.youtube.com/embed/${t[1]}" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0;" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div>`},{name:"vimeo",url:[/^vimeo\.com\/(\d+)/,/^vimeo\.com\/[^/]+\/[^/]+\/video\/(\d+)/,/^vimeo\.com\/album\/[^/]+\/video\/(\d+)/,/^vimeo\.com\/channels\/[^/]+\/(\d+)/,/^vimeo\.com\/groups\/[^/]+\/videos\/(\d+)/,/^vimeo\.com\/ondemand\/[^/]+\/(\d+)/,/^player\.vimeo\.com\/video\/(\d+)/],html:t=>`<div style="position: relative; padding-bottom: 100%; height: 0; padding-bottom: 56.2493%;"><iframe src="https://player.vimeo.com/video/${t[1]}" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0;" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>`},{name:"instagram",url:/^instagram\.com\/p\/(\w+)/},{name:"twitter",url:/^twitter\.com/},{name:"googleMaps",url:[/^google\.com\/maps/,/^goo\.gl\/maps/,/^maps\.google\.com/,/^maps\.app\.goo\.gl/]},{name:"flickr",url:/^flickr\.com/},{name:"facebook",url:/^facebook\.com/}]}),this.registry=new fS(e.locale,e.config.get("mediaEmbed"))}init(){const e=this.editor,t=e.model.schema,n=e.t,s=e.conversion,o=e.config.get("mediaEmbed.previewsInData"),r=e.config.get("mediaEmbed.elementName"),a=this.registry;e.commands.add("mediaEmbed",new lS(e)),t.register("media",{isObject:!0,isBlock:!0,allowWhere:"$block",allowAttributes:["url"]}),s.for("dataDowncast").elementToElement({model:"media",view:(l,{writer:c})=>{const u=l.getAttribute("url");return rh(c,a,u,{elementName:r,renderMediaPreview:u&&o})}}),s.for("dataDowncast").add(oh(a,{elementName:r,renderMediaPreview:o})),s.for("editingDowncast").elementToElement({model:"media",view:(l,{writer:c})=>{const u=l.getAttribute("url"),d=rh(c,a,u,{elementName:r,renderForEditingView:!0});return aS(d,c,n("media widget"))}}),s.for("editingDowncast").add(oh(a,{elementName:r,renderForEditingView:!0})),s.for("upcast").elementToElement({view:l=>["oembed",r].includes(l.name)&&l.getAttribute("url")?{name:!0}:null,model:(l,{writer:c})=>{const u=l.getAttribute("url");if(a.hasMedia(u))return c.createElement("media",{url:u})}}).elementToElement({view:{name:"div",attributes:{"data-oembed-url":!0}},model:(l,{writer:c})=>{const u=l.getAttribute("data-oembed-url");if(a.hasMedia(u))return c.createElement("media",{url:u})}}).add(l=>{l.on("element:figure",c);function c(u,d,h){if(!h.consumable.consume(d.viewItem,{name:!0,classes:"media"}))return;const{modelRange:m,modelCursor:g}=h.convertChildren(d.viewItem,d.modelCursor);d.modelRange=m,d.modelCursor=g,ge(m.getItems())||h.consumable.revert(d.viewItem,{name:!0,classes:"media"})}})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const mS=/^(?:http(s)?:\/\/)?[\w-]+\.[\w-.~:/?#[\]@!$&'()*+,;=%]+$/;class gS extends v{static get requires(){return[Mu,ft,qu]}static get pluginName(){return"AutoMediaEmbed"}constructor(e){super(e);this._timeoutId=null,this._positionToInsert=null}init(){const e=this.editor,t=e.model.document;this.listenTo(e.plugins.get("ClipboardPipeline"),"inputTransformation",()=>{const n=t.selection.getFirstRange(),s=ce.fromPosition(n.start);s.stickiness="toPrevious";const o=ce.fromPosition(n.end);o.stickiness="toNext",t.once("change:data",()=>{this._embedMediaBetweenPositions(s,o),s.detach(),o.detach()},{priority:"high"})}),e.commands.get("undo").on("execute",()=>{this._timeoutId&&(ee.window.clearTimeout(this._timeoutId),this._positionToInsert.detach(),this._timeoutId=null,this._positionToInsert=null)},{priority:"high"})}_embedMediaBetweenPositions(e,t){const n=this.editor,s=n.plugins.get(Oi).registry,o=new qe(e,t),r=o.getWalker({ignoreElementEnd:!0});let a="";for(const c of r)c.item.is("$textProxy")&&(a+=c.item.data);if(a=a.trim(),!a.match(mS)){o.detach();return}if(!s.hasMedia(a)){o.detach();return}if(!n.commands.get("mediaEmbed").isEnabled){o.detach();return}this._positionToInsert=ce.fromPosition(e),this._timeoutId=ee.window.setTimeout(()=>{n.model.change(c=>{this._timeoutId=null,c.remove(o),o.detach();let u;this._positionToInsert.root.rootName!=="$graveyard"&&(u=this._positionToInsert),lh(n.model,a,u),this._positionToInsert.detach(),this._positionToInsert=null}),n.plugins.get("Delete").requestUndoOnBackspace()},100)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class pS extends M{constructor(e,t){super(t);const n=t.t;this.focusTracker=new Ae,this.keystrokes=new et,this.set("mediaURLInputValue",""),this.urlInputView=this._createUrlInput(),this.saveButtonView=this._createButton(n("Save"),fe.check,"ck-button-save"),this.saveButtonView.type="submit",this.saveButtonView.bind("isEnabled").to(this,"mediaURLInputValue",s=>!!s),this.cancelButtonView=this._createButton(n("Cancel"),fe.cancel,"ck-button-cancel","cancel"),this._focusables=new Mt,this._focusCycler=new Yt({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this._validators=e,this.setTemplate({tag:"form",attributes:{class:["ck","ck-media-form","ck-responsive-form"],tabindex:"-1"},children:[this.urlInputView,this.saveButtonView,this.cancelButtonView]}),eo(this)}render(){super.render(),to({view:this}),[this.urlInputView,this.saveButtonView,this.cancelButtonView].forEach(n=>{this._focusables.add(n),this.focusTracker.add(n.element)}),this.keystrokes.listenTo(this.element);const t=n=>n.stopPropagation();this.keystrokes.set("arrowright",t),this.keystrokes.set("arrowleft",t),this.keystrokes.set("arrowup",t),this.keystrokes.set("arrowdown",t),this.listenTo(this.urlInputView.element,"selectstart",(n,s)=>{s.stopPropagation()},{priority:"high"})}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}get url(){return this.urlInputView.fieldView.element.value.trim()}set url(e){this.urlInputView.fieldView.element.value=e.trim()}isValid(){this.resetFormStatus();for(const e of this._validators){const t=e(this);if(t)return this.urlInputView.errorText=t,!1}return!0}resetFormStatus(){this.urlInputView.errorText=null,this.urlInputView.infoText=this._urlInputViewInfoDefault}_createUrlInput(){const e=this.locale.t,t=new uo(this.locale,ho),n=t.fieldView;return this._urlInputViewInfoDefault=e("Paste the media URL in the input."),this._urlInputViewInfoTip=e("Tip: Paste the URL into the content to embed faster."),t.label=e("Media URL"),t.infoText=this._urlInputViewInfoDefault,n.on("input",()=>{t.infoText=n.element.value?this._urlInputViewInfoTip:this._urlInputViewInfoDefault,this.mediaURLInputValue=n.element.value.trim()}),t}_createButton(e,t,n,s){const o=new U(this.locale);return o.set({label:e,icon:t,tooltip:!0}),o.extendTemplate({attributes:{class:n}}),s&&o.delegate("execute").to(this,s),o}}var wS='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M18.68 3.03c.6 0 .59-.03.59.55v12.84c0 .59.01.56-.59.56H1.29c-.6 0-.59.03-.59-.56V3.58c0-.58-.01-.55.6-.55h17.38zM15.77 15V5H4.2v10h11.57zM2 4v1h1V4H2zm0 2v1h1V6H2zm0 2v1h1V8H2zm0 2v1h1v-1H2zm0 2v1h1v-1H2zm0 2v1h1v-1H2zM17 4v1h1V4h-1zm0 2v1h1V6h-1zm0 2v1h1V8h-1zm0 2v1h1v-1h-1zm0 2v1h1v-1h-1zm0 2v1h1v-1h-1zM7.5 7.177a.4.4 0 0 1 .593-.351l5.133 2.824a.4.4 0 0 1 0 .7l-5.133 2.824a.4.4 0 0 1-.593-.35V7.176v.001z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class bS extends v{static get requires(){return[Oi]}static get pluginName(){return"MediaEmbedUI"}init(){const e=this.editor,t=e.commands.get("mediaEmbed"),n=e.plugins.get(Oi).registry;e.ui.componentFactory.add("mediaEmbed",s=>{const o=ht(s),r=new pS(_S(e.t,n),e.locale);return this._setUpDropdown(o,r,t,e),this._setUpForm(o,r,t),o})}_setUpDropdown(e,t,n){const s=this.editor,o=s.t,r=e.buttonView;e.bind("isEnabled").to(n),e.panelView.children.add(t),r.set({label:o("Insert media"),icon:wS,tooltip:!0}),r.on("open",()=>{t.disableCssTransitions(),t.url=n.value||"",t.urlInputView.fieldView.select(),t.focus(),t.enableCssTransitions()},{priority:"low"}),e.on("submit",()=>{t.isValid()&&(s.execute("mediaEmbed",t.url),a())}),e.on("change:isOpen",()=>t.resetFormStatus()),e.on("cancel",()=>a());function a(){s.editing.view.focus(),e.isOpen=!1}}_setUpForm(e,t,n){t.delegate("submit","cancel").to(e),t.urlInputView.bind("value").to(n,"value"),t.urlInputView.bind("isReadOnly").to(n,"isEnabled",s=>!s)}}function _S(i,e){return[t=>{if(!t.url.length)return i("The URL must not be empty.")},t=>{if(!e.hasMedia(t.url))return i("This media URL is not supported.")}]}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class vS extends v{static get requires(){return[Oi,bS,gS,nn]}static get pluginName(){return"MediaEmbed"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function yS(i,e){for(const t of i.getChildren())if(t.is("element","b")&&t.getStyle("font-weight")==="normal"){const n=i.getChildIndex(t);e.remove(t),e.insertChild(n,t.getChildren(),i)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function CS(i,e){if(!i.childCount)return;const t=new en(i.document),n=TS(i,t);if(!n.length)return;let s=null,o=1;n.forEach((r,a)=>{const l=MS(n[a-1],r),c=l?null:n[a-1],u=OS(c,r);if(l&&(s=null,o=1),!s||u!==0){const h=kS(r,e);if(!s)s=uh(h,r.element,t);else if(r.indent>o){const m=s.getChild(s.childCount-1),g=m.getChild(m.childCount-1);s=uh(h,g,t),o+=1}else if(r.indent<o){const m=o-r.indent;s=NS(s,m),o=parseInt(r.indent)}r.indent<=o&&(s.is("element",h.type)||(s=t.rename(h.type,s)))}const d=xS(r.element,t);t.appendChild(d,s)})}function ES(i,e){for(const t of e.createRangeIn(i)){const n=t.item;if(n.is("element","li")){const s=n.getChild(0);s&&s.is("element","p")&&e.unwrapElement(s)}}}function TS(i,e){const t=e.createRangeIn(i),n=new He({name:/^p|h\d+$/,styles:{"mso-list":/.*/}}),s=[];for(const o of t)if(o.type==="elementStart"&&n.match(o.item)){const r=IS(o.item);s.push({element:o.item,id:r.id,order:r.order,indent:r.indent})}return s}function kS(i,e){const t=new RegExp(`@list l${i.id}:level${i.indent}\\s*({[^}]*)`,"gi"),n=/mso-level-number-format:([^;]{0,100});/gi,s=t.exec(e);let o="decimal",r="ol";if(s&&s[1]){const a=n.exec(s[1]);if(a&&a[1]&&(o=a[1].trim(),r=o!=="bullet"&&o!=="image"?"ol":"ul"),o==="bullet"){const l=AS(i.element);l&&(o=l)}}return{type:r,style:PS(o)}}function AS(i){const e=SS(i);if(!e)return null;const t=e._data;return t==="o"?"circle":t==="\xB7"?"disc":t==="\xA7"?"square":null}function SS(i){if(i.getChild(0).is("$text"))return null;for(const e of i.getChildren()){if(!e.is("element","span"))continue;const t=e.getChild(0);return t.is("$text")?t:t.getChild(0)}}function PS(i){switch(i){case"arabic-leading-zero":return"decimal-leading-zero";case"alpha-upper":return"upper-alpha";case"alpha-lower":return"lower-alpha";case"roman-upper":return"upper-roman";case"roman-lower":return"lower-roman";case"circle":case"disc":case"square":return i;default:return null}}function uh(i,e,t){const n=e.parent,s=t.createElement(i.type),o=n.getChildIndex(e)+1;return t.insertChild(o,s,n),i.style&&t.setStyle("list-style-type",i.style,s),s}function xS(i,e){return RS(i,e),e.rename("li",i)}function IS(i){const e={},t=i.getStyle("mso-list");if(t){const n=t.match(/(^|\s{1,100})l(\d+)/i),s=t.match(/\s{0,100}lfo(\d+)/i),o=t.match(/\s{0,100}level(\d+)/i);n&&s&&o&&(e.id=n[2],e.order=s[1],e.indent=o[1])}return e}function RS(i,e){const t=new He({name:"span",styles:{"mso-list":"Ignore"}}),n=e.createRangeIn(i);for(const s of n)s.type==="elementStart"&&t.match(s.item)&&e.remove(s.item)}function MS(i,e){if(!i)return!0;if(i.id!==e.id)return e.indent-i.indent!=1;const t=e.element.previousSibling;return t?!VS(t):!0}function VS(i){return i.is("element","ol")||i.is("element","ul")}function OS(i,e){return i?e.indent-i.indent:e.indent-1}function NS(i,e){const t=i.getAncestors({parentFirst:!0});let n=null,s=0;for(const o of t)if((o.name==="ul"||o.name==="ol")&&s++,s===e){n=o;break}return n}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const DS=/id=("|')docs-internal-guid-[-0-9a-f]+("|')/i;class BS{constructor(e){this.document=e}isActive(e){return DS.test(e)}execute(e){const t=new en(this.document),{body:n}=e._parsedData;yS(n,t),ES(n,t),e.content=n}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function FS(i,e){if(!i.childCount)return;const t=new en,n=zS(i,t);HS(n,i,t),$S(i,t);const s=WS(i,t);s.length&&qS(s,US(e),t)}function LS(i){return btoa(i.match(/\w{2}/g).map(e=>String.fromCharCode(parseInt(e,16))).join(""))}function zS(i,e){const t=e.createRangeIn(i),n=new He({name:/v:(.+)/}),s=[];for(const o of t){if(o.type!="elementStart")continue;const r=o.item,a=r.previousSibling&&r.previousSibling.name||null;n.match(r)&&r.getAttribute("o:gfxdata")&&a!=="v:shapetype"&&s.push(o.item.getAttribute("id"))}return s}function HS(i,e,t){const n=t.createRangeIn(e),s=new He({name:"img"}),o=[];for(const r of n)if(s.match(r.item)){const a=r.item,l=a.getAttribute("v:shapes")?a.getAttribute("v:shapes").split(" "):[];l.length&&l.every(c=>i.indexOf(c)>-1)?o.push(a):a.getAttribute("src")||o.push(a)}for(const r of o)t.remove(r)}function $S(i,e){const t=e.createRangeIn(i),n=new He({name:/v:(.+)/}),s=[];for(const o of t)o.type=="elementStart"&&n.match(o.item)&&s.push(o.item);for(const o of s)e.remove(o)}function WS(i,e){const t=e.createRangeIn(i),n=new He({name:"img"}),s=[];for(const o of t)n.match(o.item)&&o.item.getAttribute("src").startsWith("file://")&&s.push(o.item);return s}function US(i){if(!i)return[];const e=/{\\pict[\s\S]+?\\bliptag-?\d+(\\blipupi-?\d+)?({\\\*\\blipuid\s?[\da-fA-F]+)?[\s}]*?/,t=new RegExp("(?:("+e.source+"))([\\da-fA-F\\s]+)\\}","g"),n=i.match(t),s=[];if(n)for(const o of n){let r=!1;o.includes("\\pngblip")?r="image/png":o.includes("\\jpegblip")&&(r="image/jpeg"),r&&s.push({hex:o.replace(e,"").replace(/[^\da-fA-F]/g,""),type:r})}return s}function qS(i,e,t){if(i.length===e.length)for(let n=0;n<i.length;n++){const s=`data:${e[n].type};base64,${LS(e[n].hex)}`;t.setAttribute("src",s,i[n])}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const jS=/<meta\s*name="?generator"?\s*content="?microsoft\s*word\s*\d+"?\/?>/i,KS=/xmlns:o="urn:schemas-microsoft-com/i;class GS{constructor(e){this.document=e}isActive(e){return jS.test(e)||KS.test(e)}execute(e){const{body:t,stylesString:n}=e._parsedData;CS(t,n),FS(t,e.dataTransfer.getData("text/rtf")),e.content=t}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function JS(i){return dh(dh(i)).replace(/(<span\s+style=['"]mso-spacerun:yes['"]>[^\S\r\n]*?)[\r\n]+([^\S\r\n]*<\/span>)/g,"$1$2").replace(/<span\s+style=['"]mso-spacerun:yes['"]><\/span>/g,"").replace(/ <\//g,"\xA0</").replace(/ <o:p><\/o:p>/g,"\xA0<o:p></o:p>").replace(/<o:p>(&nbsp;|\u00A0)<\/o:p>/g,"").replace(/>([^\S\r\n]*[\r\n]\s*)</g,"><")}function QS(i){i.querySelectorAll("span[style*=spacerun]").forEach(e=>{const t=e.innerText.length||0;e.innerHTML=Array(t+1).join("\xA0 ").substr(0,t)})}function dh(i){return i.replace(/<span(?: class="Apple-converted-space"|)>(\s+)<\/span>/g,(e,t)=>t.length===1?" ":Array(t.length+1).join("\xA0 ").substr(0,t.length))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function YS(i,e){const t=new DOMParser;i=i.replace(/<!--\[if gte vml 1]>/g,"");const n=JS(eP(i)),s=t.parseFromString(n,"text/html");QS(s);const o=s.body.innerHTML,r=XS(s,e),a=ZS(s);return{body:r,bodyString:o,styles:a.styles,stylesString:a.stylesString}}function XS(i,e){const t=new An(e),n=new oi(t,{renderingMode:"data"}),s=i.createDocumentFragment(),o=i.body.childNodes;for(;o.length>0;)s.appendChild(o[0]);return n.domToView(s,{skipComments:!0})}function ZS(i){const e=[],t=[],n=Array.from(i.getElementsByTagName("style"));for(const s of n)s.sheet&&s.sheet.cssRules&&s.sheet.cssRules.length&&(e.push(s.sheet),t.push(s.innerHTML));return{styles:e,stylesString:t.join(" ")}}function eP(i){const e="</body>",t="</html>",n=i.indexOf(e);if(n<0)return i;const s=i.indexOf(t,n+e.length);return i.substring(0,n+e.length)+(s>=0?i.substring(s):"")}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class tP extends v{static get pluginName(){return"PasteFromOffice"}static get requires(){return[je]}init(){const e=this.editor,t=e.editing.view.document,n=[];n.push(new GS(t)),n.push(new BS(t)),e.plugins.get("ClipboardPipeline").on("inputTransformation",(s,o)=>{if(o._isTransformedWithPasteFromOffice)return;const r=o.dataTransfer.getData("text/html"),a=n.find(l=>l.isActive(r));a&&(o._parsedData=YS(r,t.stylesProcessor),a.execute(o),o._isTransformedWithPasteFromOffice=!0)},{priority:"high"})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function te(i,e,t,n,s=1){e>s?n.setAttribute(i,e,t):n.removeAttribute(i,t)}function Dt(i,e,t={}){const n=i.createElement("tableCell",t);return i.insertElement("paragraph",n),i.insert(n,e),n}function Ko(i,e){const t=e.parent.parent,n=parseInt(t.getAttribute("headingColumns")||0),{column:s}=i.getCellLocation(e);return!!n&&s<n}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function nP(){return i=>{i.on("element:figure",(e,t,n)=>{if(!n.consumable.test(t.viewItem,{name:!0,classes:"table"}))return;const s=oP(t.viewItem);if(!s||!n.consumable.test(s,{name:!0}))return;n.consumable.consume(t.viewItem,{name:!0,classes:"table"});const o=n.convertItem(s,t.modelCursor),r=ge(o.modelRange.getItems());if(!r){n.consumable.revert(t.viewItem,{name:!0,classes:"table"});return}n.convertChildren(t.viewItem,n.writer.createPositionAt(r,"end")),n.updateConversionResult(r,t)})}}function iP(){return i=>{i.on("element:table",(e,t,n)=>{const s=t.viewItem;if(!n.consumable.test(s,{name:!0}))return;const{rows:o,headingRows:r,headingColumns:a}=rP(s),l={};a&&(l.headingColumns=a),r&&(l.headingRows=r);const c=n.writer.createElement("table",l);if(!!n.safeInsert(c,t.modelCursor)){if(n.consumable.consume(s,{name:!0}),o.forEach(u=>n.convertItem(u,n.writer.createPositionAt(c,"end"))),n.convertChildren(s,n.writer.createPositionAt(c,"end")),c.isEmpty){const u=n.writer.createElement("tableRow");n.writer.insert(u,n.writer.createPositionAt(c,"end")),Dt(n.writer,n.writer.createPositionAt(u,"end"))}n.updateConversionResult(c,t)}})}}function sP(){return i=>{i.on("element:tr",(e,t)=>{t.viewItem.isEmpty&&t.modelCursor.index==0&&e.stop()},{priority:"high"})}}function hh(i){return e=>{e.on(`element:${i}`,(t,n,s)=>{if(!!n.modelRange&&n.viewItem.isEmpty){const o=n.modelRange.start.nodeAfter,r=s.writer.createPositionAt(o,0);s.writer.insertElement("paragraph",r)}},{priority:"low"})}}function oP(i){for(const e of i.getChildren())if(e.is("element","table"))return e}function rP(i){const e={headingRows:0,headingColumns:0},t=[],n=[];let s;for(const o of Array.from(i.getChildren()))if(o.name==="tbody"||o.name==="thead"||o.name==="tfoot"){o.name==="thead"&&!s&&(s=o);const r=Array.from(o.getChildren()).filter(a=>a.is("element","tr"));for(const a of r)if(a.parent.name==="thead"&&a.parent===s)e.headingRows++,t.push(a);else{n.push(a);const l=aP(a);l>e.headingColumns&&(e.headingColumns=l)}}return e.rows=[...t,...n],e}function aP(i){let e=0,t=0;const n=Array.from(i.getChildren()).filter(s=>s.name==="th"||s.name==="td");for(;t<n.length&&n[t].name==="th";){const s=n[t],o=parseInt(s.getAttribute("colspan")||1);e=e+o,t++}return e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class D{constructor(e,t={}){this._table=e,this._startRow=t.row!==void 0?t.row:t.startRow||0,this._endRow=t.row!==void 0?t.row:t.endRow,this._startColumn=t.column!==void 0?t.column:t.startColumn||0,this._endColumn=t.column!==void 0?t.column:t.endColumn,this._includeAllSlots=!!t.includeAllSlots,this._skipRows=new Set,this._row=0,this._rowIndex=0,this._column=0,this._cellIndex=0,this._spannedCells=new Map,this._nextCellAtColumn=-1}[Symbol.iterator](){return this}next(){const e=this._table.getChild(this._rowIndex);if(!e||this._isOverEndRow())return{done:!0};if(!e.is("element","tableRow"))return this._rowIndex++,this.next();if(this._isOverEndColumn())return this._advanceToNextRow();let t=null;const n=this._getSpanned();if(n)this._includeAllSlots&&!this._shouldSkipSlot()&&(t=this._formatOutValue(n.cell,n.row,n.column));else{const s=e.getChild(this._cellIndex);if(!s)return this._advanceToNextRow();const o=parseInt(s.getAttribute("colspan")||1),r=parseInt(s.getAttribute("rowspan")||1);(o>1||r>1)&&this._recordSpans(s,r,o),this._shouldSkipSlot()||(t=this._formatOutValue(s)),this._nextCellAtColumn=this._column+o}return this._column++,this._column==this._nextCellAtColumn&&this._cellIndex++,t||this.next()}skipRow(e){this._skipRows.add(e)}_advanceToNextRow(){return this._row++,this._rowIndex++,this._column=0,this._cellIndex=0,this._nextCellAtColumn=-1,this.next()}_isOverEndRow(){return this._endRow!==void 0&&this._row>this._endRow}_isOverEndColumn(){return this._endColumn!==void 0&&this._column>this._endColumn}_formatOutValue(e,t=this._row,n=this._column){return{done:!1,value:new lP(this,e,t,n)}}_shouldSkipSlot(){const e=this._skipRows.has(this._row),t=this._row<this._startRow,n=this._column<this._startColumn,s=this._endColumn!==void 0&&this._column>this._endColumn;return e||t||n||s}_getSpanned(){const e=this._spannedCells.get(this._row);return e&&e.get(this._column)||null}_recordSpans(e,t,n){const s={cell:e,row:this._row,column:this._column};for(let o=this._row;o<this._row+t;o++)for(let r=this._column;r<this._column+n;r++)(o!=this._row||r!=this._column)&&this._markSpannedCell(o,r,s)}_markSpannedCell(e,t,n){this._spannedCells.has(e)||this._spannedCells.set(e,new Map),this._spannedCells.get(e).set(t,n)}}class lP{constructor(e,t,n,s){this.cell=t,this.row=e._row,this.column=e._column,this.cellAnchorRow=n,this.cellAnchorColumn=s,this._cellIndex=e._cellIndex,this._rowIndex=e._rowIndex,this._table=e._table}get isAnchor(){return this.row===this.cellAnchorRow&&this.column===this.cellAnchorColumn}get cellWidth(){return parseInt(this.cell.getAttribute("colspan")||1)}get cellHeight(){return parseInt(this.cell.getAttribute("rowspan")||1)}get rowIndex(){return this._rowIndex}getPositionBefore(){return this._table.root.document.model.createPositionAt(this._table.getChild(this.row),this._cellIndex)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function fh(i={}){return e=>e.on("insert:table",(t,n,s)=>{const o=n.item;if(!s.consumable.consume(o,"insert"))return;s.consumable.consume(o,"attribute:headingRows:table"),s.consumable.consume(o,"attribute:headingColumns:table");const r=i&&i.asWidget,a=s.writer.createContainerElement("figure",{class:"table"}),l=s.writer.createContainerElement("table");s.writer.insert(s.writer.createPositionAt(a,0),l);let c;r&&(c=mP(a,s.writer));const u=new D(o),d={headingRows:o.getAttribute("headingRows")||0,headingColumns:o.getAttribute("headingColumns")||0},h=new Map;for(const g of u){const{row:p,cell:b}=g,C=o.getChild(p),E=h.get(p)||Jo(l,C,p,d,s);h.set(p,E),s.consumable.consume(b,"insert");const I=s.writer.createPositionAt(E,"end");Go(g,d,I,s,i)}for(const g of o.getChildren()){const p=g.index;g.is("element","tableRow")&&!h.has(p)&&h.set(p,Jo(l,g,p,d,s))}const m=s.mapper.toViewPosition(n.range.start);s.mapper.bindElements(o,r?c:a),s.writer.insert(m,r?c:a)})}function cP(){return i=>i.on("insert:tableRow",(e,t,n)=>{const s=t.item;if(!n.consumable.consume(s,"insert"))return;const o=s.parent,r=n.mapper.toViewElement(o),a=vP(r),l=o.getChildIndex(s),c=new D(o,{row:l}),u={headingRows:o.getAttribute("headingRows")||0,headingColumns:o.getAttribute("headingColumns")||0},d=new Map;for(const h of c){const m=d.get(l)||Jo(a,s,l,u,n);d.set(l,m),n.consumable.consume(h.cell,"insert");const g=n.writer.createPositionAt(m,"end");Go(h,u,g,n,{asWidget:!0})}})}function uP(){return i=>i.on("insert:tableCell",(e,t,n)=>{const s=t.item;if(!n.consumable.consume(s,"insert"))return;const o=s.parent,r=o.parent,a=r.getChildIndex(o),l=new D(r,{row:a}),c={headingRows:r.getAttribute("headingRows")||0,headingColumns:r.getAttribute("headingColumns")||0};for(const u of l)if(u.cell===s){const d=n.mapper.toViewElement(o),h=n.writer.createPositionAt(d,o.getChildIndex(s));Go(u,c,h,n,{asWidget:!0});return}})}function dP(){return i=>i.on("attribute:headingColumns:table",(e,t,n)=>{const s=t.item;if(!n.consumable.consume(t.item,e.name))return;const o={headingRows:s.getAttribute("headingRows")||0,headingColumns:s.getAttribute("headingColumns")||0},r=t.attributeOldValue,a=t.attributeNewValue,l=(r>a?r:a)-1;for(const c of new D(s,{endColumn:l}))pP(c,o,n)})}function hP(){return i=>i.on("remove:tableRow",(e,t,n)=>{e.stop();const s=n.writer,o=n.mapper,a=o.toViewPosition(t.position).getLastMatchingPosition(h=>!h.item.is("element","tr")).nodeAfter,c=a.parent.parent,u=s.createRangeOn(a),d=s.remove(u);for(const h of s.createRangeIn(d).getItems())o.unbindViewElement(h);wh("thead",c,n),wh("tbody",c,n)},{priority:"higher"})}function fP(i,e){const{writer:t}=e;if(!!i.parent.is("element","tableCell"))return mh(i)?t.createContainerElement("span",{class:"ck-table-bogus-paragraph"}):t.createContainerElement("p")}function mh(i){return i.parent.childCount===1&&!bh(i)}function mP(i,e){return e.setCustomProperty("table",!0,i),bo(i,e,{hasSelectionHandle:!0})}function gP(i,e,t){const n=t.writer,s=t.mapper.toViewElement(i),o=n.createEditableElement(e,s.getAttributes()),r=_o(o,n);n.insert(n.createPositionAfter(s),r),n.move(n.createRangeIn(s),n.createPositionAt(r,0)),n.remove(n.createRangeOn(s)),t.mapper.unbindViewElement(s),t.mapper.bindElements(i,r)}function pP(i,e,t){const{cell:n}=i,s=gh(i,e),o=t.mapper.toViewElement(n);o&&o.name!==s&&gP(n,s,t)}function Go(i,e,t,n,s){const o=s&&s.asWidget,r=gh(i,e),a=o?_o(n.writer.createEditableElement(r),n.writer):n.writer.createContainerElement(r),l=i.cell,c=l.getChild(0),u=l.childCount===1&&c.name==="paragraph";if(n.writer.insert(t,a),n.mapper.bindElements(l,a),!o&&u&&!bh(c)){const d=l.getChild(0);n.consumable.consume(d,"insert"),n.mapper.bindElements(d,a)}}function Jo(i,e,t,n,s){s.consumable.consume(e,"insert");const o=e.isEmpty?s.writer.createEmptyElement("tr"):s.writer.createContainerElement("tr");s.mapper.bindElements(e,o);const r=n.headingRows,a=bP(wP(t,n),i,s),l=r>0&&t>=r?t-r:t,c=s.writer.createPositionAt(a,l);return s.writer.insert(c,o),o}function gh(i,e){const{row:t,column:n}=i,{headingColumns:s,headingRows:o}=e;return o&&o>t||s&&s>n?"th":"td"}function wP(i,e){return i<e.headingRows?"thead":"tbody"}function bP(i,e,t){const n=ph(i,e);return n||_P(i,e,t)}function ph(i,e){for(const t of e.getChildren())if(t.name==i)return t}function _P(i,e,t){const n=t.writer.createContainerElement(i),s=t.writer.createPositionAt(e,i=="tbody"?"end":0);return t.writer.insert(s,n),n}function wh(i,e,t){const n=ph(i,e);n&&n.childCount===0&&t.writer.remove(t.writer.createRangeOn(n))}function vP(i){for(const e of i.getChildren())if(e.name==="table")return e}function bh(i){return!![...i.getAttributeKeys()].length}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class yP extends R{refresh(){const e=this.editor.model,t=e.document.selection,n=e.schema;this.isEnabled=CP(t,n)}execute(e={}){const t=this.editor.model,n=t.document.selection,s=this.editor.plugins.get("TableUtils"),o=this.editor.config.get("table"),r=tn(n,t),a=o.defaultHeadings.rows,l=o.defaultHeadings.columns;e.headingRows===void 0&&a&&(e.headingRows=a),e.headingColumns===void 0&&l&&(e.headingColumns=l),t.change(c=>{const u=s.createTable(c,e);t.insertContent(u,r),c.setSelection(c.createPositionAt(u.getNodeByPath([0,0,0]),0))})}}function CP(i,e){const t=i.getFirstPosition().parent,n=t===t.root?t:t.parent;return e.checkChild(n,"table")}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function un(i){const e=[];for(const t of _h(i.getRanges())){const n=t.getContainedElement();n&&n.is("element","tableCell")&&e.push(n)}return e}function Dn(i){const e=[];for(const t of i.getRanges()){const n=t.start.findAncestor("tableCell");n&&e.push(n)}return e}function se(i){const e=un(i);return e.length?e:Dn(i)}function gt(i){const e=i.map(t=>t.parent.index);return vh(e)}function dn(i){const e=i[0].findAncestor("table"),n=[...new D(e)].filter(s=>i.includes(s.cell)).map(s=>s.column);return vh(n)}function Qo(i,e){if(i.length<2||!kP(i))return!1;const t=new Set,n=new Set;let s=0;for(const r of i){const{row:a,column:l}=e.getCellLocation(r),c=parseInt(r.getAttribute("rowspan")||1),u=parseInt(r.getAttribute("colspan")||1);t.add(a),n.add(l),c>1&&t.add(a+c-1),u>1&&n.add(l+u-1),s+=c*u}return TP(t,n)==s}function _h(i){return Array.from(i).sort(EP)}function vh(i){const e=i.sort((s,o)=>s-o),t=e[0],n=e[e.length-1];return{first:t,last:n}}function EP(i,e){const t=i.start,n=e.start;return t.isBefore(n)?-1:1}function TP(i,e){const t=Array.from(i.values()),n=Array.from(e.values()),s=Math.max(...t),o=Math.min(...t),r=Math.max(...n),a=Math.min(...n);return(s-o+1)*(r-a+1)}function kP(i){const e=i[0].findAncestor("table"),t=gt(i),n=parseInt(e.getAttribute("headingRows")||0);if(!yh(t,n))return!1;const s=parseInt(e.getAttribute("headingColumns")||0),o=dn(i);return yh(o,s)}function yh({first:i,last:e},t){const n=i<t,s=e<t;return n===s}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ch extends R{constructor(e,t={}){super(e);this.order=t.order||"below"}refresh(){const e=this.editor.model.document.selection,t=!!se(e).length;this.isEnabled=t}execute(){const e=this.editor,t=e.model.document.selection,n=e.plugins.get("TableUtils"),s=this.order==="above",o=se(t),r=gt(o),a=s?r.first:r.last,l=o[0].findAncestor("table");n.insertRows(l,{at:s?a:a+1,copyStructureFromAbove:!s})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Eh extends R{constructor(e,t={}){super(e);this.order=t.order||"right"}refresh(){const e=this.editor.model.document.selection,t=!!se(e).length;this.isEnabled=t}execute(){const e=this.editor,t=e.model.document.selection,n=e.plugins.get("TableUtils"),s=this.order==="left",o=se(t),r=dn(o),a=s?r.first:r.last,l=o[0].findAncestor("table");n.insertColumns(l,{columns:1,at:s?a:a+1})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Th extends R{constructor(e,t={}){super(e);this.direction=t.direction||"horizontally"}refresh(){const e=se(this.editor.model.document.selection);this.isEnabled=e.length===1}execute(){const e=se(this.editor.model.document.selection)[0],t=this.direction==="horizontally",n=this.editor.plugins.get("TableUtils");t?n.splitCellHorizontally(e,2):n.splitCellVertically(e,2)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function kh(i,e,t){const{startRow:n,startColumn:s,endRow:o,endColumn:r}=e,a=t.createElement("table"),l=o-n+1;for(let u=0;u<l;u++)t.insertElement("tableRow",a,"end");const c=[...new D(i,{startRow:n,endRow:o,startColumn:s,endColumn:r,includeAllSlots:!0})];for(const{row:u,column:d,cell:h,isAnchor:m,cellAnchorRow:g,cellAnchorColumn:p}of c){const b=u-n,C=a.getChild(b);if(!m)(g<n||p<s)&&Dt(t,t.createPositionAt(C,"end"));else{const E=t.cloneElement(h);t.append(E,C),Ih(E,u,d,o,r,t)}}return AP(a,i,n,s,t),a}function Ah(i,e,t=0){const n=[],s=new D(i,{startRow:t,endRow:e-1});for(const o of s){const{row:r,cellHeight:a}=o,l=r+a-1;r<e&&e<=l&&n.push(o)}return n}function Sh(i,e,t){const n=i.parent,s=n.parent,o=n.index,r=parseInt(i.getAttribute("rowspan")),a=e-o,l={},c=r-a;c>1&&(l.rowspan=c);const u=parseInt(i.getAttribute("colspan")||1);u>1&&(l.colspan=u);const d=o,h=d+a,m=[...new D(s,{startRow:d,endRow:h,includeAllSlots:!0})];let g=null,p;for(const b of m){const{row:C,column:E,cell:I}=b;I===i&&p===void 0&&(p=E),p!==void 0&&p===E&&C===h&&(g=Dt(t,b.getPositionBefore(),l))}return te("rowspan",a,i,t),g}function Ph(i,e){const t=[],n=new D(i);for(const s of n){const{column:o,cellWidth:r}=s,a=o+r-1;o<e&&e<=a&&t.push(s)}return t}function xh(i,e,t,n){const s=parseInt(i.getAttribute("colspan")),o=t-e,r={},a=s-o;a>1&&(r.colspan=a);const l=parseInt(i.getAttribute("rowspan")||1);l>1&&(r.rowspan=l);const c=Dt(n,n.createPositionAfter(i),r);return te("colspan",o,i,n),c}function Ih(i,e,t,n,s,o){const r=parseInt(i.getAttribute("colspan")||1),a=parseInt(i.getAttribute("rowspan")||1);if(t+r-1>s){const u=s-t+1;te("colspan",u,i,o,1)}if(e+a-1>n){const u=n-e+1;te("rowspan",u,i,o,1)}}function AP(i,e,t,n,s){const o=parseInt(e.getAttribute("headingRows")||0);if(o>0){const a=o-t;te("headingRows",a,i,s,0)}const r=parseInt(e.getAttribute("headingColumns")||0);if(r>0){const a=r-n;te("headingColumns",a,i,s,0)}}function Yo(i,e){const t=e.getColumns(i),n=new Array(t).fill(0);for(const{column:o}of new D(i))n[o]++;const s=n.reduce((o,r,a)=>r?o:[...o,a],[]);if(s.length>0){const o=s[s.length-1];return e.removeColumns(i,{at:o}),!0}return!1}function Xo(i,e){const t=[],n=e.getRows(i);for(let s=0;s<n;s++)i.getChild(s).isEmpty&&t.push(s);if(t.length>0){const s=t[t.length-1];return e.removeRows(i,{at:s}),!0}return!1}function Zo(i,e){Yo(i,e)||Xo(i,e)}function Rh(i,e){const t=Array.from(new D(i,{startColumn:e.firstColumn,endColumn:e.lastColumn,row:e.lastRow}));if(t.every(({cellHeight:o})=>o===1))return e.lastRow;const s=t[0].cellHeight-1;return e.lastRow+s}function Mh(i,e){const t=Array.from(new D(i,{startRow:e.firstRow,endRow:e.lastRow,column:e.lastColumn}));if(t.every(({cellWidth:o})=>o===1))return e.lastColumn;const s=t[0].cellWidth-1;return e.lastColumn+s}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ni extends R{constructor(e,t){super(e);this.direction=t.direction,this.isHorizontal=this.direction=="right"||this.direction=="left"}refresh(){const e=this._getMergeableCell();this.value=e,this.isEnabled=!!e}execute(){const e=this.editor.model,t=e.document,n=Dn(t.selection)[0],s=this.value,o=this.direction;e.change(r=>{const a=o=="right"||o=="down",l=a?n:s,c=a?s:n,u=c.parent;xP(c,l,r);const d=this.isHorizontal?"colspan":"rowspan",h=parseInt(n.getAttribute(d)||1),m=parseInt(s.getAttribute(d)||1);r.setAttribute(d,h+m,l),r.setSelection(r.createRangeIn(l));const g=this.editor.plugins.get("TableUtils"),p=u.findAncestor("table");Zo(p,g)})}_getMergeableCell(){const t=this.editor.model.document,n=Dn(t.selection)[0];if(!n)return;const s=this.editor.plugins.get("TableUtils"),o=this.isHorizontal?SP(n,this.direction,s):PP(n,this.direction,s);if(!o)return;const r=this.isHorizontal?"rowspan":"colspan",a=parseInt(n.getAttribute(r)||1);if(parseInt(o.getAttribute(r)||1)===a)return o}}function SP(i,e,t){const s=i.parent.parent,o=e=="right"?i.nextSibling:i.previousSibling,r=(s.getAttribute("headingColumns")||0)>0;if(!o)return;const a=e=="right"?i:o,l=e=="right"?o:i,{column:c}=t.getCellLocation(a),{column:u}=t.getCellLocation(l),d=parseInt(a.getAttribute("colspan")||1),h=Ko(t,a),m=Ko(t,l);return r&&h!=m?void 0:c+d===u?o:void 0}function PP(i,e,t){const n=i.parent,s=n.parent,o=s.getChildIndex(n);if(e=="down"&&o===t.getRows(s)-1||e=="up"&&o===0)return;const r=parseInt(i.getAttribute("rowspan")||1),a=s.getAttribute("headingRows")||0,l=e=="down"&&o+r===a,c=e=="up"&&o===a;if(a&&(l||c))return;const u=parseInt(i.getAttribute("rowspan")||1),d=e=="down"?o+u:o,h=[...new D(s,{endRow:d})],g=h.find(b=>b.cell===i).column,p=h.find(({row:b,cellHeight:C,column:E})=>E!==g?!1:e=="down"?b===d:d===b+C);return p&&p.cell}function xP(i,e,t){Vh(i)||(Vh(e)&&t.remove(t.createRangeIn(e)),t.move(t.createRangeIn(i),t.createPositionAt(e,"end"))),t.remove(i)}function Vh(i){return i.childCount==1&&i.getChild(0).is("element","paragraph")&&i.getChild(0).isEmpty}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class IP extends R{refresh(){const e=se(this.editor.model.document.selection),t=e[0];if(t){const n=t.findAncestor("table"),o=this.editor.plugins.get("TableUtils").getRows(n)-1,r=gt(e),a=r.first===0&&r.last===o;this.isEnabled=!a}else this.isEnabled=!1}execute(){const e=this.editor.model,t=this.editor.plugins.get("TableUtils"),n=se(e.document.selection),s=gt(n),o=n[0],r=o.findAncestor("table"),a=t.getCellLocation(o).column;e.change(l=>{const c=s.last-s.first+1;t.removeRows(r,{at:s.first,rows:c});const u=RP(r,s.first,a,t.getRows(r));l.setSelection(l.createPositionAt(u,0))})}}function RP(i,e,t,n){const s=i.getChild(Math.min(e,n-1));let o=s.getChild(0),r=0;for(const a of s.getChildren()){if(r>t)return o;o=a,r+=parseInt(a.getAttribute("colspan")||1)}return o}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class MP extends R{refresh(){const e=se(this.editor.model.document.selection),t=e[0];if(t){const n=t.findAncestor("table"),s=this.editor.plugins.get("TableUtils").getColumns(n),{first:o,last:r}=dn(e);this.isEnabled=r-o<s-1}else this.isEnabled=!1}execute(){const[e,t]=OP(this.editor.model.document.selection),n=e.parent.parent,s=[...new D(n)],o={first:s.find(a=>a.cell===e).column,last:s.find(a=>a.cell===t).column},r=VP(s,e,t,o);this.editor.model.change(a=>{const l=o.last-o.first+1;this.editor.plugins.get("TableUtils").removeColumns(n,{at:o.first,columns:l}),a.setSelection(a.createPositionAt(r,0))})}}function VP(i,e,t,n){return parseInt(t.getAttribute("colspan")||1)>1?t:e.previousSibling||t.nextSibling?t.nextSibling||e.previousSibling:n.first?i.reverse().find(({column:o})=>o<n.first).cell:i.reverse().find(({column:o})=>o>n.last).cell}function OP(i){const e=se(i),t=e[0],n=e.pop(),s=[t,n];return t.isBefore(n)?s:s.reverse()}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class NP extends R{refresh(){const e=this.editor.model,t=se(e.document.selection),n=t.length>0;this.isEnabled=n,this.value=n&&t.every(s=>this._isInHeading(s,s.parent.parent))}execute(e={}){if(e.forceValue===this.value)return;const t=this.editor.model,n=se(t.document.selection),s=n[0].findAncestor("table"),{first:o,last:r}=gt(n),a=this.value?o:r+1,l=s.getAttribute("headingRows")||0;t.change(c=>{if(a){const u=a>l?l:0,d=Ah(s,a,u);for(const{cell:h}of d)Sh(h,a,c)}te("headingRows",a,s,c,0)})}_isInHeading(e,t){const n=parseInt(t.getAttribute("headingRows")||0);return!!n&&e.parent.index<n}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class DP extends R{refresh(){const e=this.editor.model,t=se(e.document.selection),n=this.editor.plugins.get("TableUtils"),s=t.length>0;this.isEnabled=s,this.value=s&&t.every(o=>Ko(n,o))}execute(e={}){if(e.forceValue===this.value)return;const t=this.editor.model,n=se(t.document.selection),s=n[0].findAncestor("table"),{first:o,last:r}=dn(n),a=this.value?o:r+1;t.change(l=>{if(a){const c=Ph(s,a);for(const{cell:u,column:d}of c)xh(u,d,a,l)}te("headingColumns",a,s,l,0)})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class hn extends v{static get pluginName(){return"TableUtils"}init(){this.decorate("insertColumns"),this.decorate("insertRows")}getCellLocation(e){const t=e.parent,n=t.parent,s=n.getChildIndex(t),o=new D(n,{row:s});for(const{cell:r,row:a,column:l}of o)if(r===e)return{row:a,column:l}}createTable(e,t){const n=e.createElement("table"),s=parseInt(t.rows)||2,o=parseInt(t.columns)||2;return er(e,n,0,s,o),t.headingRows&&te("headingRows",Math.min(t.headingRows,s),n,e,0),t.headingColumns&&te("headingColumns",Math.min(t.headingColumns,o),n,e,0),n}insertRows(e,t={}){const n=this.editor.model,s=t.at||0,o=t.rows||1,r=t.copyStructureFromAbove!==void 0,a=t.copyStructureFromAbove?s-1:s,l=this.getRows(e),c=this.getColumns(e);if(s>l)throw new f("tableutils-insertrows-insert-out-of-range",this,{options:t});n.change(u=>{const d=e.getAttribute("headingRows")||0;if(d>s&&te("headingRows",d+o,e,u,0),!r&&(s===0||s===l)){er(u,e,s,o,c);return}const h=r?Math.max(s,a):s,m=new D(e,{endRow:h}),g=new Array(c).fill(1);for(const{row:p,column:b,cellHeight:C,cellWidth:E,cell:I}of m){const N=p+C-1,K=p<s&&s<=N,T=p<=a&&a<=N;K?(u.setAttribute("rowspan",C+o,I),g[b]=-E):r&&T&&(g[b]=E)}for(let p=0;p<o;p++){const b=u.createElement("tableRow");u.insert(b,e,s);for(let C=0;C<g.length;C++){const E=g[C],I=u.createPositionAt(b,"end");E>0&&Dt(u,I,E>1?{colspan:E}:null),C+=Math.abs(E)-1}}})}insertColumns(e,t={}){const n=this.editor.model,s=t.at||0,o=t.columns||1;n.change(r=>{const a=e.getAttribute("headingColumns");s<a&&r.setAttribute("headingColumns",a+o,e);const l=this.getColumns(e);if(s===0||l===s){for(const u of e.getChildren())!u.is("element","tableRow")||fn(o,r,r.createPositionAt(u,s?"end":0));return}const c=new D(e,{column:s,includeAllSlots:!0});for(const u of c){const{row:d,cell:h,cellAnchorColumn:m,cellAnchorRow:g,cellWidth:p,cellHeight:b}=u;if(m<s){r.setAttribute("colspan",p+o,h);const C=g+b-1;for(let E=d;E<=C;E++)c.skipRow(E)}else fn(o,r,u.getPositionBefore())}})}removeRows(e,t){const n=this.editor.model,s=t.rows||1,o=this.getRows(e),r=t.at,a=r+s-1;if(a>o-1)throw new f("tableutils-removerows-row-index-out-of-range",this,{table:e,options:t});n.change(l=>{const{cellsToMove:c,cellsToTrim:u}=LP(e,r,a);if(c.size){const d=a+1;zP(e,d,c,l)}for(let d=a;d>=r;d--)l.remove(e.getChild(d));for(const{rowspan:d,cell:h}of u)te("rowspan",d,h,l);FP(e,r,a,l),Yo(e,this)||Xo(e,this)})}removeColumns(e,t){const n=this.editor.model,s=t.at,o=t.columns||1,r=t.at+o-1;n.change(a=>{BP(e,{first:s,last:r},a);for(let l=r;l>=s;l--)for(const{cell:c,column:u,cellWidth:d}of[...new D(e)])u<=l&&d>1&&u+d>l?te("colspan",d-1,c,a):u===l&&a.remove(c);Xo(e,this)||Yo(e,this)})}splitCellVertically(e,t=2){const n=this.editor.model,o=e.parent.parent,r=parseInt(e.getAttribute("rowspan")||1),a=parseInt(e.getAttribute("colspan")||1);n.change(l=>{if(a>1){const{newCellsSpan:c,updatedSpan:u}=Oh(a,t);te("colspan",u,e,l);const d={};c>1&&(d.colspan=c),r>1&&(d.rowspan=r);const h=a>t?t-1:a-1;fn(h,l,l.createPositionAfter(e),d)}if(a<t){const c=t-a,u=[...new D(o)],{column:d}=u.find(({cell:p})=>p===e),h=u.filter(({cell:p,cellWidth:b,column:C})=>{const E=p!==e&&C===d,I=C<d&&C+b>d;return E||I});for(const{cell:p,cellWidth:b}of h)l.setAttribute("colspan",b+c,p);const m={};r>1&&(m.rowspan=r),fn(c,l,l.createPositionAfter(e),m);const g=o.getAttribute("headingColumns")||0;g>d&&te("headingColumns",g+c,o,l)}})}splitCellHorizontally(e,t=2){const n=this.editor.model,s=e.parent,o=s.parent,r=o.getChildIndex(s),a=parseInt(e.getAttribute("rowspan")||1),l=parseInt(e.getAttribute("colspan")||1);n.change(c=>{if(a>1){const u=[...new D(o,{startRow:r,endRow:r+a-1,includeAllSlots:!0})],{newCellsSpan:d,updatedSpan:h}=Oh(a,t);te("rowspan",h,e,c);const{column:m}=u.find(({cell:p})=>p===e),g={};d>1&&(g.rowspan=d),l>1&&(g.colspan=l);for(const p of u){const{column:b,row:C}=p,E=C>=r+h,I=b===m,N=(C+r+h)%d==0;E&&I&&N&&fn(1,c,p.getPositionBefore(),g)}}if(a<t){const u=t-a,d=[...new D(o,{startRow:0,endRow:r})];for(const{cell:g,cellHeight:p,row:b}of d)if(g!==e&&b+p>r){const C=p+u;c.setAttribute("rowspan",C,g)}const h={};l>1&&(h.colspan=l),er(c,o,r+1,u,1,h);const m=o.getAttribute("headingRows")||0;m>r&&te("headingRows",m+u,o,c)}})}getColumns(e){return[...e.getChild(0).getChildren()].reduce((n,s)=>{const o=parseInt(s.getAttribute("colspan")||1);return n+o},0)}getRows(e){return Array.from(e.getChildren()).reduce((t,n)=>n.is("element","tableRow")?t+1:t,0)}}function er(i,e,t,n,s,o={}){for(let r=0;r<n;r++){const a=i.createElement("tableRow");i.insert(a,e,t),fn(s,i,i.createPositionAt(a,"end"),o)}}function fn(i,e,t,n={}){for(let s=0;s<i;s++)Dt(e,t,n)}function Oh(i,e){if(i<e)return{newCellsSpan:1,updatedSpan:1};const t=Math.floor(i/e),n=i-t*e+t;return{newCellsSpan:t,updatedSpan:n}}function BP(i,e,t){const n=i.getAttribute("headingColumns")||0;if(n&&e.first<n){const s=Math.min(n-1,e.last)-e.first+1;t.setAttribute("headingColumns",n-s,i)}}function FP(i,e,t,n){const s=i.getAttribute("headingRows")||0;if(e<s){const o=t<s?s-(t-e+1):e;te("headingRows",o,i,n,0)}}function LP(i,e,t){const n=new Map,s=[];for(const{row:o,column:r,cellHeight:a,cell:l}of new D(i,{endRow:t})){const c=o+a-1;if(o>=e&&o<=t&&c>t){const h=t-o+1,m=a-h;n.set(r,{cell:l,rowspan:m})}if(o<e&&c>=e){let h;c>=t?h=t-e+1:h=c-e+1,s.push({cell:l,rowspan:a-h})}}return{cellsToMove:n,cellsToTrim:s}}function zP(i,e,t,n){const o=[...new D(i,{includeAllSlots:!0,row:e})],r=i.getChild(e);let a;for(const{column:l,cell:c,isAnchor:u}of o)if(t.has(l)){const{cell:d,rowspan:h}=t.get(l),m=a?n.createPositionAfter(a):n.createPositionAt(r,0);n.move(n.createRangeOn(d),m),te("rowspan",h,d,n),a=d}else u&&(a=c)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class HP extends R{refresh(){const e=un(this.editor.model.document.selection);this.isEnabled=Qo(e,this.editor.plugins.get(hn))}execute(){const e=this.editor.model,t=this.editor.plugins.get(hn);e.change(n=>{const s=un(e.document.selection),o=s.shift(),{mergeWidth:r,mergeHeight:a}=WP(o,s,t);te("colspan",r,o,n),te("rowspan",a,o,n);for(const c of s)$P(c,o,n);const l=o.findAncestor("table");Zo(l,t),n.setSelection(o,"in")})}}function $P(i,e,t){Nh(i)||(Nh(e)&&t.remove(t.createRangeIn(e)),t.move(t.createRangeIn(i),t.createPositionAt(e,"end"))),t.remove(i)}function Nh(i){return i.childCount==1&&i.getChild(0).is("element","paragraph")&&i.getChild(0).isEmpty}function WP(i,e,t){let n=0,s=0;for(const c of e){const{row:u,column:d}=t.getCellLocation(c);n=Dh(c,d,n,"colspan"),s=Dh(c,u,s,"rowspan")}const{row:o,column:r}=t.getCellLocation(i),a=n-r,l=s-o;return{mergeWidth:a,mergeHeight:l}}function Dh(i,e,t,n){const s=parseInt(i.getAttribute(n)||1);return Math.max(t,e+s)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class UP extends R{constructor(e){super(e);this.affectsData=!1}refresh(){const e=se(this.editor.model.document.selection);this.isEnabled=e.length>0}execute(){const e=this.editor.model,t=se(e.document.selection),n=gt(t),s=t[0].findAncestor("table"),o=[];for(let r=n.first;r<=n.last;r++)for(const a of s.getChild(r).getChildren())o.push(e.createRangeOn(a));e.change(r=>{r.setSelection(o)})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class qP extends R{constructor(e){super(e);this.affectsData=!1}refresh(){const e=se(this.editor.model.document.selection);this.isEnabled=e.length>0}execute(){const e=this.editor.model,t=se(e.document.selection),n=t[0],s=t.pop(),o=n.findAncestor("table"),r=this.editor.plugins.get("TableUtils"),a=r.getCellLocation(n),l=r.getCellLocation(s),c=Math.min(a.column,l.column),u=Math.max(a.column,l.column),d=[];for(const h of new D(o,{startColumn:c,endColumn:u}))d.push(e.createRangeOn(h.cell));e.change(h=>{h.setSelection(d)})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function jP(i){i.document.registerPostFixer(e=>KP(e,i))}function KP(i,e){const t=e.document.differ.getChanges();let n=!1;const s=new Set;for(const o of t){let r;o.name=="table"&&o.type=="insert"&&(r=o.position.nodeAfter),(o.name=="tableRow"||o.name=="tableCell")&&(r=o.position.findAncestor("table")),XP(o)&&(r=o.range.start.findAncestor("table")),r&&!s.has(r)&&(n=GP(r,i)||n,n=JP(r,i)||n,s.add(r))}return n}function GP(i,e){let t=!1;const n=QP(i);if(n.length){t=!0;for(const s of n)te("rowspan",s.rowspan,s.cell,e,1)}return t}function JP(i,e){let t=!1;const n=YP(i),s=[];for(const[l,c]of n.entries())!c&&i.getChild(l).is("element","tableRow")&&s.push(l);if(s.length){t=!0;for(const l of s.reverse())e.remove(i.getChild(l)),n.splice(l,1)}const o=n.filter((l,c)=>i.getChild(c).is("element","tableRow")),r=o[0];if(!o.every(l=>l===r)){const l=o.reduce((c,u)=>u>c?u:c,0);for(const[c,u]of o.entries()){const d=l-u;if(d){for(let h=0;h<d;h++)Dt(e,e.createPositionAt(i.getChild(c),"end"));t=!0}}}return t}function QP(i){const e=parseInt(i.getAttribute("headingRows")||0),t=Array.from(i.getChildren()).reduce((s,o)=>o.is("element","tableRow")?s+1:s,0),n=[];for(const{row:s,cell:o,cellHeight:r}of new D(i)){if(r<2)continue;const l=s<e?e:t;if(s+r>l){const c=l-s;n.push({cell:o,rowspan:c})}}return n}function YP(i){const e=new Array(i.childCount).fill(0);for(const{rowIndex:t}of new D(i,{includeAllSlots:!0}))e[t]++;return e}function XP(i){const e=i.type==="attribute",t=i.attributeKey;return e&&(t==="headingRows"||t==="colspan"||t==="rowspan")}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function ZP(i){i.document.registerPostFixer(e=>ex(e,i))}function ex(i,e){const t=e.document.differ.getChanges();let n=!1;for(const s of t)s.type=="insert"&&s.name=="table"&&(n=tx(s.position.nodeAfter,i)||n),s.type=="insert"&&s.name=="tableRow"&&(n=Bh(s.position.nodeAfter,i)||n),s.type=="insert"&&s.name=="tableCell"&&(n=tr(s.position.nodeAfter,i)||n),nx(s)&&(n=tr(s.position.parent,i)||n);return n}function tx(i,e){let t=!1;for(const n of i.getChildren())n.is("element","tableRow")&&(t=Bh(n,e)||t);return t}function Bh(i,e){let t=!1;for(const n of i.getChildren())t=tr(n,e)||t;return t}function tr(i,e){if(i.childCount==0)return e.insertElement("paragraph",i),!0;const t=Array.from(i.getChildren()).filter(n=>n.is("$text"));for(const n of t)e.wrap(e.createRangeOn(n),"paragraph");return!!t.length}function nx(i){return!i.position||!i.position.parent.is("element","tableCell")?!1:i.type=="insert"&&i.name=="$text"||i.type=="remove"}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function ix(i,e){i.document.registerPostFixer(()=>sx(i.document.differ,e))}function sx(i,e){const t=new Set;for(const n of i.getChanges()){const s=n.type=="attribute"?n.range.start.parent:n.position.parent;s.is("element","tableCell")&&t.add(s)}for(const n of t.values())for(const s of[...n.getChildren()].filter(o=>ox(o,e)))i.refreshItem(s);return!1}function ox(i,e){if(!i.is("element","paragraph"))return!1;const t=e.toViewElement(i);return t?mh(i)!==t.is("element","span"):!1}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function rx(i){i.document.registerPostFixer(()=>ax(i))}function ax(i){const e=i.document.differ,t=new Set;for(const n of e.getChanges())if(n.type==="attribute"){const s=n.range.start.nodeAfter;s&&s.is("element","table")&&n.attributeKey==="headingRows"&&t.add(s)}else if(n.type==="insert"||n.type==="remove"){if(n.name==="tableRow"){const s=n.position.findAncestor("table"),o=s.getAttribute("headingRows")||0;n.position.offset<o&&t.add(s)}else if(n.name==="tableCell"){const s=n.position.findAncestor("table"),o=s.getAttribute("headingColumns")||0;n.position.offset<o&&t.add(s)}}if(t.size){for(const n of t.values())e.refreshItem(n);return!0}return!1}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class lx extends v{static get pluginName(){return"TableEditing"}init(){const e=this.editor,t=e.model,n=t.schema,s=e.conversion;n.register("table",{allowWhere:"$block",allowAttributes:["headingRows","headingColumns"],isObject:!0,isBlock:!0}),n.register("tableRow",{allowIn:"table",isLimit:!0}),n.register("tableCell",{allowIn:"tableRow",allowChildren:"$block",allowAttributes:["colspan","rowspan"],isLimit:!0,isSelectable:!0}),s.for("upcast").add(nP()),s.for("upcast").add(iP()),s.for("editingDowncast").add(fh({asWidget:!0})),s.for("dataDowncast").add(fh()),s.for("upcast").elementToElement({model:"tableRow",view:"tr"}),s.for("upcast").add(sP()),s.for("editingDowncast").add(cP()),s.for("editingDowncast").add(hP()),s.for("upcast").elementToElement({model:"tableCell",view:"td"}),s.for("upcast").elementToElement({model:"tableCell",view:"th"}),s.for("upcast").add(hh("td")),s.for("upcast").add(hh("th")),s.for("editingDowncast").add(uP()),s.for("editingDowncast").elementToElement({model:"paragraph",view:fP,converterPriority:"high"}),s.for("downcast").attributeToAttribute({model:"colspan",view:"colspan"}),s.for("upcast").attributeToAttribute({model:{key:"colspan",value:Fh("colspan")},view:"colspan"}),s.for("downcast").attributeToAttribute({model:"rowspan",view:"rowspan"}),s.for("upcast").attributeToAttribute({model:{key:"rowspan",value:Fh("rowspan")},view:"rowspan"}),s.for("editingDowncast").add(dP()),e.data.mapper.on("modelToViewPosition",cx()),e.config.define("table.defaultHeadings.rows",0),e.config.define("table.defaultHeadings.columns",0),e.commands.add("insertTable",new yP(e)),e.commands.add("insertTableRowAbove",new Ch(e,{order:"above"})),e.commands.add("insertTableRowBelow",new Ch(e,{order:"below"})),e.commands.add("insertTableColumnLeft",new Eh(e,{order:"left"})),e.commands.add("insertTableColumnRight",new Eh(e,{order:"right"})),e.commands.add("removeTableRow",new IP(e)),e.commands.add("removeTableColumn",new MP(e)),e.commands.add("splitTableCellVertically",new Th(e,{direction:"vertically"})),e.commands.add("splitTableCellHorizontally",new Th(e,{direction:"horizontally"})),e.commands.add("mergeTableCells",new HP(e)),e.commands.add("mergeTableCellRight",new Ni(e,{direction:"right"})),e.commands.add("mergeTableCellLeft",new Ni(e,{direction:"left"})),e.commands.add("mergeTableCellDown",new Ni(e,{direction:"down"})),e.commands.add("mergeTableCellUp",new Ni(e,{direction:"up"})),e.commands.add("setTableColumnHeader",new DP(e)),e.commands.add("setTableRowHeader",new NP(e)),e.commands.add("selectTableRow",new UP(e)),e.commands.add("selectTableColumn",new qP(e)),rx(t),jP(t),ix(t,e.editing.mapper),ZP(t)}static get requires(){return[hn]}}function cx(){return(i,e)=>{const t=e.modelPosition.parent,n=e.modelPosition.nodeBefore;if(!t.is("element","tableCell")||!n||!n.is("element","paragraph"))return;const s=e.mapper.toViewElement(n),o=e.mapper.toViewElement(t);s===o&&(e.viewPosition=e.mapper.findPositionIn(o,n.maxOffset))}}function Fh(i){return e=>{const t=parseInt(e.getAttribute(i));return Number.isNaN(t)||t<=0?null:t}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ux extends M{constructor(e){super(e);const t=this.bindTemplate;this.items=this._createGridCollection(),this.set("rows",0),this.set("columns",0),this.bind("label").to(this,"columns",this,"rows",(n,s)=>`${s} \xD7 ${n}`),this.setTemplate({tag:"div",attributes:{class:["ck"]},children:[{tag:"div",attributes:{class:["ck-insert-table-dropdown__grid"]},on:{"mouseover@.ck-insert-table-dropdown-grid-box":t.to("boxover")},children:this.items},{tag:"div",attributes:{class:["ck-insert-table-dropdown__label"]},children:[{text:t.to("label")}]}],on:{mousedown:t.to(n=>{n.preventDefault()}),click:t.to(()=>{this.fire("execute")})}}),this.on("boxover",(n,s)=>{const{row:o,column:r}=s.target.dataset;this.set({rows:parseInt(o),columns:parseInt(r)})}),this.on("change:columns",()=>{this._highlightGridBoxes()}),this.on("change:rows",()=>{this._highlightGridBoxes()})}focus(){}focusLast(){}_highlightGridBoxes(){const e=this.rows,t=this.columns;this.items.map((n,s)=>{const o=Math.floor(s/10),r=s%10,a=o<e&&r<t;n.set("isOn",a)})}_createGridCollection(){const e=[];for(let t=0;t<100;t++){const n=Math.floor(t/10),s=t%10;e.push(new dx(this.locale,n+1,s+1))}return this.createCollection(e)}}class dx extends M{constructor(e,t,n){super(e);const s=this.bindTemplate;this.set("isOn",!1),this.setTemplate({tag:"div",attributes:{class:["ck-insert-table-dropdown-grid-box",s.if("isOn","ck-on")],"data-row":t,"data-column":n}})}}var hx='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 6v3h4V6H3zm0 4v3h4v-3H3zm0 4v3h4v-3H3zm5 3h4v-3H8v3zm5 0h4v-3h-4v3zm4-4v-3h-4v3h4zm0-4V6h-4v3h4zm1.5 8a1.5 1.5 0 0 1-1.5 1.5H3A1.5 1.5 0 0 1 1.5 17V4c.222-.863 1.068-1.5 2-1.5h13c.932 0 1.778.637 2 1.5v13zM12 13v-3H8v3h4zm0-4V6H8v3h4z"/></svg>',fx='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M18 7v1H2V7h16zm0 5v1H2v-1h16z" opacity=".6"/><path d="M14 1v18a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V1a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1zm-2 1H8v4h4V2zm0 6H8v4h4V8zm0 6H8v4h4v-4z"/></svg>',mx='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v16h-1V2z" opacity=".6"/><path d="M1 6h18a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1zm1 2v4h4V8H2zm6 0v4h4V8H8zm6 0v4h4V8h-4z"/></svg>',gx='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v7h-1V2zm6 5v1H2V7h16zM8 12v1H2v-1h6z" opacity=".6"/><path d="M7 7h12a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1zm1 2v9h10V9H8z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class px extends v{static get pluginName(){return"TableUI"}init(){const e=this.editor,t=this.editor.t,s=e.locale.contentLanguageDirection==="ltr";e.ui.componentFactory.add("insertTable",o=>{const r=e.commands.get("insertTable"),a=ht(o);a.bind("isEnabled").to(r),a.buttonView.set({icon:hx,label:t("Insert table"),tooltip:!0});let l;return a.on("change:isOpen",()=>{l||(l=new ux(o),a.panelView.children.add(l),l.delegate("execute").to(a),a.buttonView.on("open",()=>{l.rows=0,l.columns=0}),a.on("execute",()=>{e.execute("insertTable",{rows:l.rows,columns:l.columns}),e.editing.view.focus()}))}),a}),e.ui.componentFactory.add("tableColumn",o=>{const r=[{type:"switchbutton",model:{commandName:"setTableColumnHeader",label:t("Header column"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:s?"insertTableColumnLeft":"insertTableColumnRight",label:t("Insert column left")}},{type:"button",model:{commandName:s?"insertTableColumnRight":"insertTableColumnLeft",label:t("Insert column right")}},{type:"button",model:{commandName:"removeTableColumn",label:t("Delete column")}},{type:"button",model:{commandName:"selectTableColumn",label:t("Select column")}}];return this._prepareDropdown(t("Column"),fx,r,o)}),e.ui.componentFactory.add("tableRow",o=>{const r=[{type:"switchbutton",model:{commandName:"setTableRowHeader",label:t("Header row"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:"insertTableRowAbove",label:t("Insert row above")}},{type:"button",model:{commandName:"insertTableRowBelow",label:t("Insert row below")}},{type:"button",model:{commandName:"removeTableRow",label:t("Delete row")}},{type:"button",model:{commandName:"selectTableRow",label:t("Select row")}}];return this._prepareDropdown(t("Row"),mx,r,o)}),e.ui.componentFactory.add("mergeTableCells",o=>{const r=[{type:"button",model:{commandName:"mergeTableCellUp",label:t("Merge cell up")}},{type:"button",model:{commandName:s?"mergeTableCellRight":"mergeTableCellLeft",label:t("Merge cell right")}},{type:"button",model:{commandName:"mergeTableCellDown",label:t("Merge cell down")}},{type:"button",model:{commandName:s?"mergeTableCellLeft":"mergeTableCellRight",label:t("Merge cell left")}},{type:"separator"},{type:"button",model:{commandName:"splitTableCellVertically",label:t("Split cell vertically")}},{type:"button",model:{commandName:"splitTableCellHorizontally",label:t("Split cell horizontally")}}];return this._prepareMergeSplitButtonDropdown(t("Merge cells"),gx,r,o)})}_prepareDropdown(e,t,n,s){const o=this.editor,r=ht(s),a=this._fillDropdownWithListOptions(r,n);return r.buttonView.set({label:e,icon:t,tooltip:!0}),r.bind("isEnabled").toMany(a,"isEnabled",(...l)=>l.some(c=>c)),this.listenTo(r,"execute",l=>{o.execute(l.source.commandName),o.editing.view.focus()}),r}_prepareMergeSplitButtonDropdown(e,t,n,s){const o=this.editor,r=ht(s,Gc),a="mergeTableCells",l=o.commands.get(a),c=this._fillDropdownWithListOptions(r,n);return r.buttonView.set({label:e,icon:t,tooltip:!0,isEnabled:!0}),r.bind("isEnabled").toMany([l,...c],"isEnabled",(...u)=>u.some(d=>d)),this.listenTo(r.buttonView,"execute",()=>{o.execute(a),o.editing.view.focus()}),this.listenTo(r,"execute",u=>{o.execute(u.source.commandName),o.editing.view.focus()}),r}_fillDropdownWithListOptions(e,t){const n=this.editor,s=[],o=new _e;for(const r of t)wx(r,n,s,o);return co(e,o,n.ui.componentFactory),s}}function wx(i,e,t,n){const s=i.model=new bi(i.model),{commandName:o,bindIsOn:r}=i.model;if(i.type==="button"||i.type==="switchbutton"){const a=e.commands.get(o);t.push(a),s.set({commandName:o}),s.bind("isEnabled").to(a),r&&s.bind("isOn").to(a,"value")}s.set({withText:!0}),n.add(i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Bt extends v{static get pluginName(){return"TableSelection"}static get requires(){return[hn]}init(){const t=this.editor.model;this.listenTo(t,"deleteContent",(n,s)=>this._handleDeleteContent(n,s),{priority:"high"}),this._defineSelectionConverter(),this._enablePluginDisabling()}getSelectedTableCells(){const e=this.editor.model.document.selection,t=un(e);return t.length==0?null:t}getSelectionAsFragment(){const e=this.getSelectedTableCells();return e?this.editor.model.change(t=>{const n=t.createDocumentFragment(),s=this.editor.plugins.get("TableUtils"),{first:o,last:r}=dn(e),{first:a,last:l}=gt(e),c=e[0].findAncestor("table");let u=l,d=r;if(Qo(e,s)){const g={firstColumn:o,lastColumn:r,firstRow:a,lastRow:l};u=Rh(c,g),d=Mh(c,g)}const m=kh(c,{startRow:a,startColumn:o,endRow:u,endColumn:d},t);return t.insert(m,n,0),n}):null}setCellSelection(e,t){const n=this._getCellsToSelect(e,t);this.editor.model.change(s=>{s.setSelection(n.cells.map(o=>s.createRangeOn(o)),{backward:n.backward})})}getFocusCell(){const n=[...this.editor.model.document.selection.getRanges()].pop().getContainedElement();return n&&n.is("element","tableCell")?n:null}getAnchorCell(){const e=this.editor.model.document.selection,n=ge(e.getRanges()).getContainedElement();return n&&n.is("element","tableCell")?n:null}_defineSelectionConverter(){const e=this.editor,t=new Set;e.conversion.for("editingDowncast").add(s=>s.on("selection",(o,r,a)=>{const l=a.writer;n(l);const c=this.getSelectedTableCells();if(!c)return;for(const d of c){const h=a.mapper.toViewElement(d);l.addClass("ck-editor__editable_selected",h),t.add(h)}const u=a.mapper.toViewElement(c[c.length-1]);l.setSelection(u,0)},{priority:"lowest"}));function n(s){for(const o of t)s.removeClass("ck-editor__editable_selected",o);t.clear()}}_enablePluginDisabling(){const e=this.editor;this.on("change:isEnabled",()=>{if(!this.isEnabled){const t=this.getSelectedTableCells();if(!t)return;e.model.change(n=>{const s=n.createPositionAt(t[0],0),o=e.model.schema.getNearestSelectionRange(s);n.setSelection(o)})}})}_handleDeleteContent(e,t){const[n,s]=t,o=this.editor.model,r=!s||s.direction=="backward",a=un(n);!a.length||(e.stop(),o.change(l=>{const c=a[r?a.length-1:0];o.change(d=>{for(const h of a)o.deleteContent(d.createSelection(h,"in"))});const u=o.schema.getNearestSelectionRange(l.createPositionAt(c,0));n.is("documentSelection")?l.setSelection(u):n.setTo(u)}))}_getCellsToSelect(e,t){const n=this.editor.plugins.get("TableUtils"),s=n.getCellLocation(e),o=n.getCellLocation(t),r=Math.min(s.row,o.row),a=Math.max(s.row,o.row),l=Math.min(s.column,o.column),c=Math.max(s.column,o.column),u=new Array(a-r+1).fill(null).map(()=>[]),d={startRow:r,endRow:a,startColumn:l,endColumn:c};for(const{row:g,cell:p}of new D(e.findAncestor("table"),d))u[g-r].push(p);const h=o.row<s.row,m=o.column<s.column;return h&&u.reverse(),m&&u.forEach(g=>g.reverse()),{cells:u.flat(),backward:h||m}}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class bx extends v{static get pluginName(){return"TableClipboard"}static get requires(){return[Bt,hn]}init(){const e=this.editor,t=e.editing.view.document;this.listenTo(t,"copy",(n,s)=>this._onCopyCut(n,s)),this.listenTo(t,"cut",(n,s)=>this._onCopyCut(n,s)),this.listenTo(e.model,"insertContent",(n,s)=>this._onInsertContent(n,...s),{priority:"high"}),this.decorate("_replaceTableSlotCell")}_onCopyCut(e,t){const n=this.editor.plugins.get(Bt);if(!n.getSelectedTableCells()||e.name=="cut"&&this.editor.isReadOnly)return;t.preventDefault(),e.stop();const s=this.editor.data,o=this.editor.editing.view.document,r=s.toView(n.getSelectionAsFragment());o.fire("clipboardOutput",{dataTransfer:t.dataTransfer,content:r,method:e.name})}_onInsertContent(e,t,n){if(n&&!n.is("documentSelection"))return;const s=this.editor.model,o=this.editor.plugins.get(hn);let r=_x(t,s);if(!r)return;const a=se(s.document.selection);if(!a.length){Zo(r,o);return}e.stop(),s.change(l=>{const c={width:o.getColumns(r),height:o.getRows(r)},u=vx(a,c,l,o),d=u.lastRow-u.firstRow+1,h=u.lastColumn-u.firstColumn+1,m={startRow:0,startColumn:0,endRow:Math.min(d,c.height)-1,endColumn:Math.min(h,c.width)-1};r=kh(r,m,l);const g=a[0].findAncestor("table"),p=this._replaceSelectedCellsWithPasted(r,c,g,u,l);if(this.editor.plugins.get("TableSelection").isEnabled){const b=_h(p.map(C=>l.createRangeOn(C)));l.setSelection(b)}else l.setSelection(p[0],0)})}_replaceSelectedCellsWithPasted(e,t,n,s,o){const{width:r,height:a}=t,l=Cx(e,r,a),c=[...new D(n,{startRow:s.firstRow,endRow:s.lastRow,startColumn:s.firstColumn,endColumn:s.lastColumn,includeAllSlots:!0})],u=[];let d;for(const b of c){const{row:C,column:E}=b;E===s.firstColumn&&(d=b.getPositionBefore());const I=C-s.firstRow,N=E-s.firstColumn,K=l[I%a][N%r],T=K?o.cloneElement(K):null,S=this._replaceTableSlotCell(b,T,d,o);!S||(Ih(S,C,E,s.lastRow,s.lastColumn,o),u.push(S),d=o.createPositionAfter(S))}const h=parseInt(n.getAttribute("headingRows")||0),m=parseInt(n.getAttribute("headingColumns")||0),g=s.firstRow<h&&h<=s.lastRow,p=s.firstColumn<m&&m<=s.lastColumn;if(g){const b={first:s.firstColumn,last:s.lastColumn},C=nr(n,h,b,o,s.firstRow);u.push(...C)}if(p){const b={first:s.firstRow,last:s.lastRow},C=ir(n,m,b,o);u.push(...C)}return u}_replaceTableSlotCell(e,t,n,s){const{cell:o,isAnchor:r}=e;return r&&s.remove(o),t?(s.insert(t,n),t):null}}function _x(i,e){if(!i.is("documentFragment")&&!i.is("element"))return null;if(i.is("element","table"))return i;if(i.childCount==1&&i.getChild(0).is("element","table"))return i.getChild(0);const t=e.createRangeIn(i);for(const n of t.getItems())if(n.is("element","table")){const s=e.createRange(t.start,e.createPositionBefore(n));if(e.hasContent(s,{ignoreWhitespaces:!0}))return null;const o=e.createRange(e.createPositionAfter(n),t.end);return e.hasContent(o,{ignoreWhitespaces:!0})?null:n}return null}function vx(i,e,t,n){const s=i[0].findAncestor("table"),o=dn(i),r=gt(i),a={firstColumn:o.first,lastColumn:o.last,firstRow:r.first,lastRow:r.last},l=i.length===1;return l&&(a.lastRow+=e.height-1,a.lastColumn+=e.width-1,yx(s,a.lastRow+1,a.lastColumn+1,n)),l||!Qo(i,n)?Ex(s,a,t):(a.lastRow=Rh(s,a),a.lastColumn=Mh(s,a)),a}function yx(i,e,t,n){const s=n.getColumns(i),o=n.getRows(i);t>s&&n.insertColumns(i,{at:s,columns:t-s}),e>o&&n.insertRows(i,{at:o,rows:e-o})}function Cx(i,e,t){const n=new Array(t).fill(null).map(()=>new Array(e).fill(null));for(const{column:s,row:o,cell:r}of new D(i))n[o][s]=r;return n}function Ex(i,e,t){const{firstRow:n,lastRow:s,firstColumn:o,lastColumn:r}=e,a={first:n,last:s},l={first:o,last:r};ir(i,o,a,t),ir(i,r+1,a,t),nr(i,n,l,t),nr(i,s+1,l,t,n)}function nr(i,e,t,n,s=0){return e<1?void 0:Ah(i,e,s).filter(({column:a,cellWidth:l})=>Lh(a,l,t)).map(({cell:a})=>Sh(a,e,n))}function ir(i,e,t,n){return e<1?void 0:Ph(i,e).filter(({row:r,cellHeight:a})=>Lh(r,a,t)).map(({cell:r,column:a})=>xh(r,a,e,n))}function Lh(i,e,t){const n=i+e-1,{first:s,last:o}=t,r=i>=s&&i<=o,a=i<s&&n>=s;return r||a}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Tx extends v{static get pluginName(){return"TableKeyboard"}static get requires(){return[Bt]}init(){const t=this.editor.editing.view.document;this.editor.keystrokes.set("Tab",(...n)=>this._handleTabOnSelectedTable(...n),{priority:"low"}),this.editor.keystrokes.set("Tab",this._getTabHandler(!0),{priority:"low"}),this.editor.keystrokes.set("Shift+Tab",this._getTabHandler(!1),{priority:"low"}),this.listenTo(t,"arrowKey",(...n)=>this._onArrowKey(...n),{context:"table"})}_handleTabOnSelectedTable(e,t){const n=this.editor,o=n.model.document.selection.getSelectedElement();!o||!o.is("element","table")||(t(),n.model.change(r=>{r.setSelection(r.createRangeIn(o.getChild(0).getChild(0)))}))}_getTabHandler(e){const t=this.editor;return(n,s)=>{const o=t.model.document.selection;let r=Dn(o)[0];if(r||(r=this.editor.plugins.get("TableSelection").getFocusCell()),!r)return;s();const a=r.parent,l=a.parent,c=l.getChildIndex(a),u=a.getChildIndex(r),d=u===0;if(!e&&d&&c===0){t.model.change(b=>{b.setSelection(b.createRangeOn(l))});return}const h=this.editor.plugins.get("TableUtils"),m=u===a.childCount-1,g=c===h.getRows(l)-1;if(e&&g&&m&&(t.execute("insertTableRowBelow"),c===h.getRows(l)-1)){t.model.change(b=>{b.setSelection(b.createRangeOn(l))});return}let p;if(e&&m)p=l.getChild(c+1).getChild(0);else if(!e&&d){const b=l.getChild(c-1);p=b.getChild(b.childCount-1)}else p=a.getChild(u+(e?1:-1));t.model.change(b=>{b.setSelection(b.createRangeIn(p))})}}_onArrowKey(e,t){const n=this.editor,s=t.keyCode,o=xs(s,n.locale.contentLanguageDirection);this._handleArrowKeys(o,t.shiftKey)&&(t.preventDefault(),t.stopPropagation(),e.stop())}_handleArrowKeys(e,t){const n=this.editor.model,s=n.document.selection,o=["right","down"].includes(e),r=un(s);if(r.length){let l;return t?l=this.editor.plugins.get("TableSelection").getFocusCell():l=o?r[r.length-1]:r[0],this._navigateFromCellInDirection(l,e,t),!0}const a=s.focus.findAncestor("tableCell");if(!a)return!1;if(!s.isCollapsed)if(t){if(s.isBackward==o&&!s.containsEntireContent(a))return!1}else{const l=s.getSelectedElement();if(!l||!n.schema.isObject(l))return!1}return this._isSelectionAtCellEdge(s,a,o)?(this._navigateFromCellInDirection(a,e,t),!0):!1}_isSelectionAtCellEdge(e,t,n){const s=this.editor.model,o=this.editor.model.schema,r=n?e.getLastPosition():e.getFirstPosition();if(!o.getLimitElement(r).is("element","tableCell"))return s.createPositionAt(t,n?"end":0).isTouching(r);const a=s.createSelection(r);return s.modifySelection(a,{direction:n?"forward":"backward"}),r.isEqual(a.focus)}_navigateFromCellInDirection(e,t,n=!1){const s=this.editor.model,o=e.findAncestor("table"),r=[...new D(o,{includeAllSlots:!0})],{row:a,column:l}=r[r.length-1],c=r.find(({cell:E})=>E==e);let{row:u,column:d}=c;switch(t){case"left":d--;break;case"up":u--;break;case"right":d+=c.cellWidth;break;case"down":u+=c.cellHeight;break}const h=u<0||u>a,m=d<0&&u<=0,g=d>l&&u>=a;if(h||m||g){s.change(E=>{E.setSelection(E.createRangeOn(o))});return}d<0?(d=n?0:l,u--):d>l&&(d=n?l:0,u++);const p=r.find(E=>E.row==u&&E.column==d).cell,b=["right","down"].includes(t),C=this.editor.plugins.get("TableSelection");if(n&&C.isEnabled){const E=C.getAnchorCell()||e;C.setCellSelection(E,p)}else{const E=s.createPositionAt(p,b?0:"end");s.change(I=>{I.setSelection(E)})}}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class kx extends dt{constructor(e){super(e);this.domEventType=["mousemove","mouseleave"]}onDomEvent(e){this.fire(e.type,e)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ax extends v{static get pluginName(){return"TableMouse"}static get requires(){return[Bt]}init(){this.editor.editing.view.addObserver(kx),this._enableShiftClickSelection(),this._enableMouseDragSelection()}_enableShiftClickSelection(){const e=this.editor;let t=!1;const n=e.plugins.get(Bt);this.listenTo(e.editing.view.document,"mousedown",(s,o)=>{if(!this.isEnabled||!n.isEnabled||!o.domEvent.shiftKey)return;const r=n.getAnchorCell()||Dn(e.model.document.selection)[0];if(!r)return;const a=this._getModelTableCellFromDomEvent(o);a&&zh(r,a)&&(t=!0,n.setCellSelection(r,a),o.preventDefault())}),this.listenTo(e.editing.view.document,"mouseup",()=>{t=!1}),this.listenTo(e.editing.view.document,"selectionChange",s=>{t&&s.stop()},{priority:"highest"})}_enableMouseDragSelection(){const e=this.editor;let t,n,s=!1,o=!1;const r=e.plugins.get(Bt);this.listenTo(e.editing.view.document,"mousedown",(a,l)=>{!this.isEnabled||!r.isEnabled||l.domEvent.shiftKey||l.domEvent.ctrlKey||l.domEvent.altKey||(t=this._getModelTableCellFromDomEvent(l))}),this.listenTo(e.editing.view.document,"mousemove",(a,l)=>{if(!l.domEvent.buttons||!t)return;const c=this._getModelTableCellFromDomEvent(l);c&&zh(t,c)&&(n=c,!s&&n!=t&&(s=!0)),!!s&&(o=!0,r.setCellSelection(t,n),l.preventDefault())}),this.listenTo(e.editing.view.document,"mouseup",()=>{s=!1,o=!1,t=null,n=null}),this.listenTo(e.editing.view.document,"selectionChange",a=>{o&&a.stop()},{priority:"highest"})}_getModelTableCellFromDomEvent(e){const t=e.target,n=this.editor.editing.view.createPositionAt(t,0);return this.editor.editing.mapper.toModelPosition(n).parent.findAncestor("tableCell",{includeSelf:!0})}}function zh(i,e){return i.parent.parent==e.parent.parent}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Sx extends v{static get requires(){return[lx,px,Bt,Ax,Tx,bx,nn]}static get pluginName(){return"Table"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Px(i){const e=i.getSelectedElement();return e&&Hh(e)?e:null}function xx(i){let e=i.getFirstPosition().parent;for(;e;){if(e.is("element")&&Hh(e))return e;e=e.parent}return null}function Hh(i){return!!i.getCustomProperty("table")&&X(i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ix extends v{static get requires(){return[Ii]}static get pluginName(){return"TableToolbar"}afterInit(){const e=this.editor,t=e.t,n=e.plugins.get(Ii),s=e.config.get("table.contentToolbar"),o=e.config.get("table.tableToolbar");s&&n.register("tableContent",{ariaLabel:t("Table toolbar"),items:s,getRelatedElement:xx}),o&&n.register("table",{ariaLabel:t("Table toolbar"),items:o,getRelatedElement:Px})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const sr={autoRefresh:!0},$h=36e5;class Di{constructor(e,t=sr){if(!e)throw new f("token-missing-token-url",this);t.initValue&&this._validateTokenValue(t.initValue),this.set("value",t.initValue),typeof e=="function"?this._refresh=e:this._refresh=()=>Rx(e),this._options=Object.assign({},sr,t)}init(){return new Promise((e,t)=>{if(!this.value){this.refreshToken().then(e).catch(t);return}this._options.autoRefresh&&this._registerRefreshTokenTimeout(),e(this)})}refreshToken(){return this._refresh().then(e=>{this._validateTokenValue(e),this.set("value",e),this._options.autoRefresh&&this._registerRefreshTokenTimeout()}).then(()=>this)}destroy(){clearTimeout(this._tokenRefreshTimeout)}_validateTokenValue(e){const t=typeof e=="string",n=!/^".*"$/.test(e),s=t&&e.split(".").length===3;if(!(n&&s))throw new f("token-not-in-jwt-format",this)}_registerRefreshTokenTimeout(){const e=this._getTokenRefreshTimeoutTime();clearTimeout(this._tokenRefreshTimeout),this._tokenRefreshTimeout=setTimeout(()=>{this.refreshToken()},e)}_getTokenRefreshTimeoutTime(){try{const[,e]=this.value.split("."),{exp:t}=JSON.parse(atob(e));return t?Math.floor((t*1e3-Date.now())/2):$h}catch{return $h}}static create(e,t=sr){return new Di(e,t).init()}}A(Di,$);function Rx(i){return new Promise((e,t)=>{const n=new XMLHttpRequest;n.open("GET",i),n.addEventListener("load",()=>{const s=n.status,o=n.response;return s<200||s>299?t(new f("token-cannot-download-new-token",null)):e(o)}),n.addEventListener("error",()=>t(new Error("Network Error"))),n.addEventListener("abort",()=>t(new Error("Abort"))),n.send()})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const or=/^data:(\S*?);base64,/;class Wh{constructor(e,t,n){if(!e)throw new f("fileuploader-missing-file",null);if(!t)throw new f("fileuploader-missing-token",null);if(!n)throw new f("fileuploader-missing-api-address",null);this.file=Vx(e)?Mx(e):e,this._token=t,this._apiAddress=n}onProgress(e){return this.on("progress",(t,n)=>e(n)),this}onError(e){return this.once("error",(t,n)=>e(n)),this}abort(){this.xhr.abort()}send(){return this._prepareRequest(),this._attachXHRListeners(),this._sendRequest()}_prepareRequest(){const e=new XMLHttpRequest;e.open("POST",this._apiAddress),e.setRequestHeader("Authorization",this._token.value),e.responseType="json",this.xhr=e}_attachXHRListeners(){const e=this,t=this.xhr;t.addEventListener("error",n("Network Error")),t.addEventListener("abort",n("Abort")),t.upload&&t.upload.addEventListener("progress",s=>{s.lengthComputable&&this.fire("progress",{total:s.total,uploaded:s.loaded})}),t.addEventListener("load",()=>{const s=t.status,o=t.response;if(s<200||s>299)return this.fire("error",o.message||o.error)});function n(s){return()=>e.fire("error",s)}}_sendRequest(){const e=new FormData,t=this.xhr;return e.append("file",this.file),new Promise((n,s)=>{t.addEventListener("load",()=>{const o=t.status,r=t.response;return o<200||o>299?r.message?s(new f("fileuploader-uploading-data-failed",this,{message:r.message})):s(r.error):n(r)}),t.addEventListener("error",()=>s(new Error("Network Error"))),t.addEventListener("abort",()=>s(new Error("Abort"))),t.send(e)})}}A(Wh,H);function Mx(i,e=512){try{const t=i.match(or)[1],n=atob(i.replace(or,"")),s=[];for(let o=0;o<n.length;o+=e){const r=n.slice(o,o+e),a=new Array(r.length);for(let l=0;l<r.length;l++)a[l]=r.charCodeAt(l);s.push(new Uint8Array(a))}return new Blob(s,{type:t})}catch{throw new f("fileuploader-decoding-image-data-error",null)}}function Vx(i){if(typeof i!="string")return!1;const e=i.match(or);return!!(e&&e.length)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ox{constructor(e,t){if(!e)throw new f("uploadgateway-missing-token",null);if(!t)throw new f("uploadgateway-missing-api-address",null);this._token=e,this._apiAddress=t}upload(e){return new Wh(e,this._token,this._apiAddress)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Nx extends Tn{static get pluginName(){return"CloudServicesCore"}createToken(e,t){return new Di(e,t)}createUploadGateway(e,t){return new Ox(e,t)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Dx extends Tn{static get pluginName(){return"CloudServices"}static get requires(){return[Nx]}init(){const t=this.context.config.get("cloudServices")||{};for(const n in t)this[n]=t[n];if(this._tokens=new Map,!this.tokenUrl){this.token=null;return}return this.token=this.context.plugins.get("CloudServicesCore").createToken(this.tokenUrl),this._tokens.set(this.tokenUrl,this.token),this.token.init()}registerTokenUrl(e){if(this._tokens.has(e))return Promise.resolve(this.getTokenFor(e));const t=this.context.plugins.get("CloudServicesCore").createToken(e);return this._tokens.set(e,t),t.init()}getTokenFor(e){const t=this._tokens.get(e);if(!t)throw new f("cloudservices-token-not-registered",this);return t}destroy(){super.destroy();for(const e of this._tokens.values())e.destroy()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Bx(i){const e=[{name:"address",isVoid:!1},{name:"article",isVoid:!1},{name:"aside",isVoid:!1},{name:"blockquote",isVoid:!1},{name:"br",isVoid:!0},{name:"details",isVoid:!1},{name:"dialog",isVoid:!1},{name:"dd",isVoid:!1},{name:"div",isVoid:!1},{name:"dl",isVoid:!1},{name:"dt",isVoid:!1},{name:"fieldset",isVoid:!1},{name:"figcaption",isVoid:!1},{name:"figure",isVoid:!1},{name:"footer",isVoid:!1},{name:"form",isVoid:!1},{name:"h1",isVoid:!1},{name:"h2",isVoid:!1},{name:"h3",isVoid:!1},{name:"h4",isVoid:!1},{name:"h5",isVoid:!1},{name:"h6",isVoid:!1},{name:"header",isVoid:!1},{name:"hgroup",isVoid:!1},{name:"hr",isVoid:!0},{name:"input",isVoid:!0},{name:"li",isVoid:!1},{name:"main",isVoid:!1},{name:"nav",isVoid:!1},{name:"ol",isVoid:!1},{name:"p",isVoid:!1},{name:"pre",isVoid:!1},{name:"section",isVoid:!1},{name:"table",isVoid:!1},{name:"tbody",isVoid:!1},{name:"td",isVoid:!1},{name:"textarea",isVoid:!1},{name:"th",isVoid:!1},{name:"thead",isVoid:!1},{name:"tr",isVoid:!1},{name:"ul",isVoid:!1}],t=e.map(o=>o.name).join("|"),n=i.replace(new RegExp(`</?(${t})( .*?)?>`,"g"),`
$&
`).split(`
`);let s=0;return n.filter(o=>o.length).map(o=>Fx(o,e)?rr(o,s++):Lx(o,e)?rr(o,--s):rr(o,s)).join(`
`)}function Fx(i,e){return e.some(t=>!(t.isVoid||!new RegExp(`<${t.name}( .*?)?>`).test(i)))}function Lx(i,e){return e.some(t=>new RegExp(`</${t.name}>`).test(i))}function rr(i,e,t="    "){return`${t.repeat(e)}${i}`}var zx='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m12.5 0 5 4.5v15.003h-16V0h11zM3 1.5v3.25l-1.497 1-.003 8 1.5 1v3.254L7.685 18l-.001 1.504H17.5V8.002L16 9.428l-.004-4.22-4.222-3.692L3 1.5z"/><path d="M4.06 6.64a.75.75 0 0 1 .958 1.15l-.085.07L2.29 9.75l2.646 1.89c.302.216.4.62.232.951l-.058.095a.75.75 0 0 1-.951.232l-.095-.058-3.5-2.5V9.14l3.496-2.5zm4.194 6.22a.75.75 0 0 1-.958-1.149l.085-.07 2.643-1.89-2.646-1.89a.75.75 0 0 1-.232-.952l.058-.095a.75.75 0 0 1 .95-.232l.096.058 3.5 2.5v1.22l-3.496 2.5zm7.644-.836 2.122 2.122-5.825 5.809-2.125-.005.003-2.116zm2.539-1.847 1.414 1.414a.5.5 0 0 1 0 .707l-1.06 1.06-2.122-2.12 1.061-1.061a.5.5 0 0 1 .707 0z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Uh="SourceEditingMode";class Hx extends v{static get pluginName(){return"SourceEditing"}static get requires(){return[mi]}constructor(e){super(e);this.set("isSourceEditingMode",!1),this._elementReplacer=new Kv,this._replacedRoots=new Map,this._dataFromRoots=new Map}init(){const e=this.editor,t=e.t;e.ui.componentFactory.add("sourceEditing",n=>{const s=new U(n);return s.set({label:t("Source"),icon:zx,tooltip:!0,withText:!0,class:"ck-source-editing-button"}),s.bind("isOn").to(this,"isSourceEditingMode"),s.bind("isEnabled").to(this,"isEnabled",e,"isReadOnly",e.plugins.get(mi),"hasAny",(o,r,a)=>!(!o||r||a)),this.listenTo(s,"execute",()=>{this.isSourceEditingMode=!this.isSourceEditingMode}),s}),this._isAllowedToHandleSourceEditingMode()&&(this.on("change:isSourceEditingMode",(n,s,o)=>{o?(this._showSourceEditing(),this._disableCommands()):(this._hideSourceEditing(),this._enableCommands())}),this.on("change:isEnabled",(n,s,o)=>this._handleReadOnlyMode(!o)),this.listenTo(e,"change:isReadOnly",(n,s,o)=>this._handleReadOnlyMode(o))),e.data.on("get",()=>{this.isSourceEditingMode&&this._updateEditorData()},{priority:"high"})}afterInit(){const e=this.editor;["RealTimeCollaborativeEditing","CommentsEditing","TrackChangesEditing","RevisionHistory"].some(n=>e.plugins.has(n))&&console.warn("You initialized the editor with the source editing feature and at least one of the collaboration features. Please be advised that the source editing feature may not work, and be careful when editing document source that contains markers created by the collaboration features."),e.plugins.has("RestrictedEditingModeEditing")&&console.warn("You initialized the editor with the source editing feature and restricted editing feature. Please be advised that the source editing feature may not work, and be careful when editing document source that contains markers created by the restricted editing feature.")}_showSourceEditing(){const e=this.editor,t=e.editing.view,n=e.model;n.change(s=>{s.setSelection(null),s.removeSelectionAttribute(n.document.selection.getAttributeKeys())});for(const[s,o]of t.domRoots){const r=$x(e.data.get({rootName:s})),a=Bs(o.ownerDocument,"textarea",{rows:"1"}),l=Bs(o.ownerDocument,"div",{class:"ck-source-editing-area","data-value":r},[a]);a.value=r,a.setSelectionRange(0,0),a.addEventListener("input",()=>{l.dataset.value=a.value}),t.change(c=>{const u=t.document.getRoot(s);c.addClass("ck-hidden",u)}),this._replacedRoots.set(s,l),this._elementReplacer.replace(o,l),this._dataFromRoots.set(s,r)}this._focusSourceEditing()}_hideSourceEditing(){const t=this.editor.editing.view;this._updateEditorData(),t.change(n=>{for(const[s]of this._replacedRoots)n.removeClass("ck-hidden",t.document.getRoot(s))}),this._elementReplacer.restore(),this._replacedRoots.clear(),this._dataFromRoots.clear(),t.focus()}_updateEditorData(){const e=this.editor,t={};for(const[n,s]of this._replacedRoots){const o=this._dataFromRoots.get(n),r=s.dataset.value;o!==r&&(t[n]=r)}Object.keys(t).length&&e.data.set(t,{batchType:"default"})}_focusSourceEditing(){const[e]=this._replacedRoots.values();e.querySelector("textarea").focus()}_disableCommands(){const e=this.editor;for(const t of e.commands.commands())t.forceDisabled(Uh)}_enableCommands(){const e=this.editor;for(const t of e.commands.commands())t.clearForceDisabled(Uh)}_handleReadOnlyMode(e){if(!!this.isSourceEditingMode)for(const[,t]of this._replacedRoots)t.querySelector("textarea").readOnly=e}_isAllowedToHandleSourceEditingMode(){const t=this.editor.ui.view.editable;return t&&!t._hasExternalElement}}function $x(i){return Wx(i)?Bx(i):i}function Wx(i){return i.startsWith("<")}var Ux='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6.91 10.54c.26-.23.64-.21.88.03l3.36 3.14 2.23-2.06a.64.64 0 0 1 .87 0l2.52 2.97V4.5H3.2v10.12l3.71-4.08zm10.27-7.51c.6 0 1.09.47 1.09 1.05v11.84c0 .59-.49 1.06-1.09 1.06H2.79c-.6 0-1.09-.47-1.09-1.06V4.08c0-.58.49-1.05 1.1-1.05h14.38zm-5.22 5.56a1.96 1.96 0 1 1 3.4-1.96 1.96 1.96 0 0 1-3.4 1.96z"/></svg>';const Bi="imgPlugin",qx="\u56FE\u7247",qh="image";class jx extends v{init(){this.createToolbarButton()}createToolbarButton(){const e=this.editor;console.log(Array.from(e.ui.componentFactory.names()));const t=e.commands.get(Bi);Fn.editorObj=e,window.dd=e.model,e.ui.componentFactory.add(Bi,n=>{const s=new U(n);return s.set({label:qx,tooltip:!0,icon:Ux,class:"toolbar_button_img_extend"}),s.bind("isOn","isEnabled").to(t,"value","isEnabled"),this.listenTo(s,"execute",()=>{console.log("======execute image view click"),Fn.dialogObj.openDialog(5)}),s})}}class Kx extends R{constructor(e){super(e);this.attributeKey=qh}refresh(){const e=this.editor.model,t=e.document.selection;this.isEnabled=e.schema.checkAttributeInSelection(t,this.attributeKey)}}class Gx extends v{static get requires(){return[nn]}static get pluginName(){return"ImgEditing"}init(){const e=this.editor;this.defineSchema(),e.commands.add(Bi,new Kx(e))}defineSchema(){this.editor.model.schema.extend("$text",{allowAttributes:qh})}}class jh extends v{static get requires(){return[Gx,jx]}static get pluginName(){return Bi}}function Jx(i,e={}){console.log(i),!(!e||!e.src)&&i.change(t=>{const n=t.createElement("imageInline",e),s=tn(i.document.selection,i);i.insertContent(n,s)})}const Qx={name:"ckeditorAttachDialog",props:{fileType:String,isClient:{type:Boolean,default:!1}},setup(i,e){let t="fastcms/api/admin/attachment/upload";i.isClient&&i.isClient==!0&&(t="fastcms/api/client/attachment/upload");const n=hr({isShowDialog:!1,queryParams:{},showSearch:!0,max:1,limit:3,uploadUrl:t,headers:{Authorization:ef.get("token")},checkedObjs:[],tableData:{data:[],total:99,loading:!1,param:{pageNum:1,pageSize:10}}}),s=g=>{n.isShowDialog=!0,n.max=g},o=()=>{n.isShowDialog=!1,n.max=1},r=()=>{i.isClient&&i.isClient==!0?Zh(n.tableData.param).then(g=>{n.tableData.data=g.data.records,n.tableData.total=g.data.total}):Xh(n.tableData.param).then(g=>{n.tableData.data=g.data.records,n.tableData.total=g.data.total})},a=()=>{r()},l=()=>{mr.error("\u4E0A\u4F20\u6587\u4EF6\u6570\u91CF\u4E0D\u80FD\u8D85\u8FC7 "+n.limit+" \u4E2A!")},c=()=>{mr.error("\u4E0A\u4F20\u5931\u8D25")};return fr(()=>{r()}),x({openDialog:s,closeDialog:o,initTableData:r,onTableItemClick:g=>{console.log(g)},onHandleSizeChange:g=>{n.tableData.param.pageSize=g,r()},onHandleCurrentChange:g=>{n.tableData.param.pageNum=g,r()},onHandleExceed:l,onHandleUploadError:c,uploadSuccess:a,onSubmit:()=>{let g=[];n.checkedObjs.forEach(p=>g.push({src:p.path})),g.forEach(p=>Jx(Fn.editorObj.model,p)),o()},confirm},tf(n))}},Yx=Li("\u4E0A\u4F20\u9644\u4EF6"),Xx={key:0},Zx=["src"],eI={style:{padding:"14px"}},tI={class:"dialog-footer"},nI=Li("\u53D6 \u6D88"),iI=Li("\u786E \u5B9A");function sI(i,e,t,n,s,o){const r=xe("el-button"),a=xe("el-upload"),l=xe("el-checkbox"),c=xe("el-card"),u=xe("el-col"),d=xe("el-checkbox-group"),h=xe("el-row"),m=xe("el-empty"),g=xe("el-pagination"),p=xe("el-dialog");return wt(),Bn(p,{title:"\u9009\u62E9\u9644\u4EF6",fullscreen:"",modelValue:i.isShowDialog,"onUpdate:modelValue":e[1]||(e[1]=b=>i.isShowDialog=b)},{footer:ye(()=>[rt("span",tI,[De(r,{onClick:n.closeDialog,size:"small"},{default:ye(()=>[nI]),_:1},8,["onClick"]),De(r,{type:"primary",onClick:n.onSubmit,size:"small"},{default:ye(()=>[iI]),_:1},8,["onClick"])])]),default:ye(()=>[rt("div",null,[De(a,{class:"upload-btn",action:i.uploadUrl,name:"files",multiple:"",headers:i.headers,"show-file-list":!1,"on-success":n.uploadSuccess,"on-exceed":n.onHandleExceed,"on-error":n.onHandleUploadError,limit:i.limit},{default:ye(()=>[De(r,{size:"small",type:"primary"},{default:ye(()=>[Yx]),_:1})]),_:1},8,["action","headers","on-success","on-exceed","on-error","limit"]),De(c,{shadow:"hover"},{default:ye(()=>[i.tableData.data.length>0?(wt(),Fi("div",Xx,[De(h,{gutter:15},{default:ye(()=>[De(d,{max:i.max,modelValue:i.checkedObjs,"onUpdate:modelValue":e[0]||(e[0]=b=>i.checkedObjs=b)},{default:ye(()=>[(wt(!0),Fi(nf,null,sf(i.tableData.data,(b,C)=>(wt(),Bn(u,{xs:24,sm:12,md:8,lg:6,xl:4,class:"mb15",key:C,onClick:E=>n.onTableItemClick(b)},{default:ye(()=>[De(c,{"body-style":{padding:"0px"}},{default:ye(()=>[rt("img",{src:b.path,class:"image"},null,8,Zx),rt("div",eI,[De(l,{label:b},{default:ye(()=>[rt("span",null,of(b.fileName),1)]),_:2},1032,["label"])])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1},8,["max","modelValue"])]),_:1})])):(wt(),Bn(m,{key:1,description:"\u6682\u65E0\u6570\u636E"})),i.tableData.data.length>0?(wt(),Bn(g,{key:2,style:{"text-align":"right"},background:"",onSizeChange:n.onHandleSizeChange,onCurrentChange:n.onHandleCurrentChange,"page-sizes":[10,20,30],"current-page":i.tableData.param.pageNum,"page-size":i.tableData.param.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:i.tableData.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])):rf("",!0)]),_:1})])]),_:1},8,["modelValue"])}var oI=dr(Qx,[["render",sI],["__scopeId","data-v-751509a3"]]);const rI=af({props:{isClient:{type:Boolean,default:!1},modelValue:{type:String}},components:{imgResWin:oI},setup(i,{emit:e}){let t=gr(),n=gr(),s=null,o=!1;const r=hr({isClient:i.isClient||!1});return fr(()=>{Fn.dialogObj=t.value;const a=n.value;cu.create(a.querySelector(".CKEditorContent"),{language:{ui:"zh-cn"},plugins:[Hx,rT,fT,pT,vT,kT,xT,VT,FT,Dx,HT,GT,bk,Ek,Nk,Dk,tA,rA,Fo,Nd,cA,FA,rS,vS,Nn,tP,Sx,Ix,GE,jh],toolbar:["sourceEditing","|","heading","|","bold","italic","link","bulletedList","numberedList","|","outdent","indent","|",jh.pluginName,"blockQuote","insertTable","mediaEmbed","undo","redo"],image:{styles:["alignLeft","alignCenter","alignRight"],resizeOptions:[{name:"imageResize:original",label:"Original",value:null},{name:"imageResize:25",label:"25%",value:"25"},{name:"imageResize:50",label:"50%",value:"50"},{name:"imageResize:75",label:"75%",value:"75"}],toolbar:["imageStyle:inline","imageStyle:block","imageStyle:side","|","imageStyle:alignLeft","imageStyle:alignCenter","imageStyle:alignRight","|","imageResize","imageTextAlternative","toggleImageCaption"]},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]}}).then(l=>{const c=a.querySelector(".CKEditorToolbar");c&&(c.innerHTML=""),setTimeout(()=>c.appendChild(l.ui.view.toolbar.element),0),s=l,l.setData(i.modelValue),l.model.document.on("change",function(){o=!0,e("update:modelValue",l.getData())})}).catch(l=>{console.log(l)})}),lf(()=>i.modelValue,a=>{if(o)return o=!1;s&&s.setData(a)}),{ckeditorDom:n,attachDialog:t,state:r}}}),aI={class:"CKEditor",ref:"ckeditorDom"},lI=rt("div",{class:"CKEditorBox"},[rt("div",{class:"CKEditorToolbar"}),rt("div",{class:"CKEditorContent"})],-1);function cI(i,e,t,n,s,o){const r=xe("imgResWin");return wt(),Fi("div",aI,[lI,De(r,{ref:"attachDialog",isClient:i.isClient},null,8,["isClient"])],512)}var gI=dr(rI,[["render",cI]]);export{gI as C};
