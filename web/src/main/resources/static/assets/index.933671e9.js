var z=Object.defineProperty;var D=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var _=(e,a,n)=>a in e?z(e,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[a]=n,w=(e,a)=>{for(var n in a||(a={}))S.call(a,n)&&_(e,n,a[n]);if(D)for(var n of D(a))B.call(a,n)&&_(e,n,a[n]);return e};import{B as f,_ as U,S as x}from"./index.1733e4c9.js";import{j as k,o as H,t as I,l as r,m as y,z as t,A as s,E as N,b as d,D as V,p as F,x as h}from"./vendor.e5eb9059.js";function j(e){return f({url:"/admin/plugin/list",method:"get",params:e})}function R(e){return f({url:"/admin/plugin/unInstall/"+e,method:"post"})}function M(e){return f({url:"/admin/plugin/config/url/"+e,method:"get"})}const T={name:"pluginManager",setup(){const e=k({dialogVisible:!1,pluginConfigUrl:"",limit:1,uploadUrl:"fastcms/api/admin/plugin/install",headers:{Authorization:x.get("token")},tableData:{data:[],total:0,loading:!1,param:{pageNum:1,pageSize:10}}}),a=()=>{j(e.tableData.param).then(o=>{e.tableData.data=o.data.records,e.tableData.total=o.data.total}).catch(()=>{})},n=o=>{N.confirm("\u6B64\u64CD\u4F5C\u5C06\u5378\u8F7D\u63D2\u4EF6, \u662F\u5426\u7EE7\u7EED?","\u63D0\u793A",{confirmButtonText:"\u5378\u8F7D",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{R(o.pluginId).then(()=>{d.success("\u5378\u8F7D\u6210\u529F"),a()}).catch(p=>{d.error(p.message)})}).catch(()=>{})},l=o=>{M(o.pluginId).then(p=>{e.pluginConfigUrl=p.data,e.dialogVisible=!0}).catch(()=>{d.error("\u63D2\u4EF6\u4E0D\u652F\u6301\u914D\u7F6E")})},C=()=>{e.dialogVisible=!1},b=o=>{e.tableData.param.pageSize=o},c=o=>{e.tableData.param.pageNum=o},g=o=>{o.code==200?(d.success("\u5B89\u88C5\u6210\u529F"),a()):d.error(o.message)},u=o=>{d.error("\u5B89\u88C5\u5931\u8D25,"+o)},m=()=>{};return H(()=>{a()}),w({handleClose:C,onRowConfig:l,onRowUnInstall:n,onHandleSizeChange:b,onHandleCurrentChange:c,initTableData:a,uploadSuccess:g,onHandleUploadError:u,onHandleExceed:m},I(e))}},A={class:"mb15"},P=h("\u5B89\u88C5\u63D2\u4EF6"),L=h("\u914D\u7F6E"),q=h("\u5378\u8F7D"),G=["src"];function J(e,a,n,l,C,b){const c=r("el-button"),g=r("el-upload"),u=r("el-table-column"),m=r("el-table"),o=r("el-pagination"),p=r("el-card"),E=r("el-dialog");return V(),y("div",null,[t(p,{shadow:"hover"},{default:s(()=>[F("div",A,[t(g,{action:e.uploadUrl,name:"file",headers:e.headers,"show-file-list":!1,"on-success":l.uploadSuccess,"on-error":l.onHandleUploadError,"on-exceed":l.onHandleExceed,accept:".jar"},{default:s(()=>[t(c,{class:"mt15",size:"small",type:"primary",icon:"iconfont icon-shuxingtu"},{default:s(()=>[P]),_:1})]),_:1},8,["action","headers","on-success","on-error","on-exceed"])]),t(m,{data:e.tableData.data,stripe:"",style:{width:"100%"}},{default:s(()=>[t(u,{prop:"pluginId",label:"ID","show-overflow-tooltip":""}),t(u,{prop:"pluginClass",label:"\u63D2\u4EF6\u540D\u79F0","show-overflow-tooltip":""}),t(u,{prop:"provider",label:"\u4F5C\u8005","show-overflow-tooltip":""}),t(u,{prop:"pluginState",label:"\u72B6\u6001","show-overflow-tooltip":""}),t(u,{prop:"description",label:"\u63CF\u8FF0","show-overflow-tooltip":""}),t(u,{prop:"path",label:"\u64CD\u4F5C",width:"90"},{default:s(i=>[t(c,{size:"mini",type:"text",onClick:v=>l.onRowConfig(i.row)},{default:s(()=>[L]),_:2},1032,["onClick"]),t(c,{size:"mini",type:"text",onClick:v=>l.onRowUnInstall(i.row)},{default:s(()=>[q]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),t(o,{onSizeChange:l.onHandleSizeChange,onCurrentChange:l.onHandleCurrentChange,class:"mt15","pager-count":5,"page-sizes":[10,20,30],"current-page":e.tableData.param.pageNum,"onUpdate:current-page":a[0]||(a[0]=i=>e.tableData.param.pageNum=i),background:"","page-size":e.tableData.param.pageSize,"onUpdate:page-size":a[1]||(a[1]=i=>e.tableData.param.pageSize=i),layout:"total, sizes, prev, pager, next, jumper",total:e.tableData.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])]),_:1}),t(E,{title:"\u63D2\u4EF6\u914D\u7F6E",fullscreen:"","model-value":e.dialogVisible,"before-close":l.handleClose},{default:s(()=>[F("iframe",{src:e.pluginConfigUrl,frameborder:"0",width:"100%",height:"100%"},null,8,G)]),_:1},8,["model-value","before-close"])])}var W=U(T,[["render",J]]);export{W as default};
