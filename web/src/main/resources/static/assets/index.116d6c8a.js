var Dm=Object.defineProperty,Bm=Object.defineProperties;var Fm=Object.getOwnPropertyDescriptors;var ma=Object.getOwnPropertySymbols;var Lm=Object.prototype.hasOwnProperty,zm=Object.prototype.propertyIsEnumerable;var ga=(i,e,t)=>e in i?Dm(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,$=(i,e)=>{for(var t in e||(e={}))Lm.call(e,t)&&ga(i,t,e[t]);if(ma)for(var t of ma(e))zm.call(e,t)&&ga(i,t,e[t]);return i},pa=(i,e)=>Bm(i,Fm(e));import{a7 as $m,j as wa,o as ba,t as Hm,l as Xe,D as qt,Q as ki,A as We,p as Vt,z as ot,m as xs,Y as Um,X as Wm,y as qm,L as jm,b as _a,x as Ps,i as Km,r as va,P as Gm}from"./vendor.07d41a1e.js";import{g as Jm}from"./index.29664876.js";import{g as Qm}from"./client.c694f0cb.js";import{_ as ya,L as Ym}from"./index.a0667a29.js";var Ti={editorObj:null,dialogObj:null};/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Ca(){return function i(){i.called=!0}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ot{constructor(e,t){this.source=e,this.name=t,this.path=[],this.stop=Ca(),this.off=Ca()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Ie=new Array(256).fill().map((i,e)=>("0"+e.toString(16)).slice(-2));function rt(){const i=Math.random()*4294967296>>>0,e=Math.random()*4294967296>>>0,t=Math.random()*4294967296>>>0,n=Math.random()*4294967296>>>0;return"e"+Ie[i>>0&255]+Ie[i>>8&255]+Ie[i>>16&255]+Ie[i>>24&255]+Ie[e>>0&255]+Ie[e>>8&255]+Ie[e>>16&255]+Ie[e>>24&255]+Ie[t>>0&255]+Ie[t>>8&255]+Ie[t>>16&255]+Ie[t>>24&255]+Ie[n>>0&255]+Ie[n>>8&255]+Ie[n>>16&255]+Ie[n>>24&255]}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Jn={get(i){return typeof i!="number"?this[i]||this.normal:i},highest:1e5,high:1e3,normal:0,low:-1e3,lowest:-1e5};/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Xm="https://ckeditor.com/docs/ckeditor5/latest/framework/guides/support/error-codes.html";class p extends Error{constructor(e,t,n){super(Zm(e,n));this.name="CKEditorError",this.context=t,this.data=n}is(e){return e==="CKEditorError"}static rethrowUnexpectedError(e,t){if(e.is&&e.is("CKEditorError"))throw e;const n=new p(e.message,t);throw n.stack=e.stack,n}}function Re(i,e){console.warn(...eg(i,e))}function ka(i){return`
Read more: ${Xm}#error-${i}`}function Zm(i,e){const t=new WeakSet,n=(r,a)=>{if(typeof a=="object"&&a!==null){if(t.has(a))return`[object ${a.constructor.name}]`;t.add(a)}return a},s=e?` ${JSON.stringify(e,n)}`:"",o=ka(i);return i+s+o}function eg(i,e){const t=ka(i);return e?[i,e,t]:[i,t]}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const tg="31.1.0",Ta=typeof window=="object"?window:global;if(Ta.CKEDITOR_VERSION)throw new p("ckeditor-duplicated-modules",null);Ta.CKEDITOR_VERSION=tg;/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Nt=Symbol("listeningTo"),Is=Symbol("emitterId"),oe={on(i,e,t={}){this.listenTo(this,i,e,t)},once(i,e,t){let n=!1;const s=function(o,...r){n||(n=!0,o.off(),e.call(this,o,...r))};this.listenTo(this,i,s,t)},off(i,e){this.stopListening(this,i,e)},listenTo(i,e,t,n={}){let s,o;this[Nt]||(this[Nt]={});const r=this[Nt];Rs(i)||Ea(i);const a=Rs(i);(s=r[a])||(s=r[a]={emitter:i,callbacks:{}}),(o=s.callbacks[e])||(o=s.callbacks[e]=[]),o.push(t),og(this,i,e,t,n)},stopListening(i,e,t){const n=this[Nt];let s=i&&Rs(i);const o=n&&s&&n[s],r=o&&e&&o.callbacks[e];if(!(!n||i&&!o||e&&!r))if(t)Vs(this,i,e,t),r.indexOf(t)!==-1&&(r.length===1?delete o.callbacks[e]:Vs(this,i,e,t));else if(r){for(;t=r.pop();)Vs(this,i,e,t);delete o.callbacks[e]}else if(o){for(e in o.callbacks)this.stopListening(i,e);delete n[s]}else{for(s in n)this.stopListening(n[s].emitter);delete this[Nt]}},fire(i,...e){try{const t=i instanceof Ot?i:new Ot(this,i),n=t.name;let s=Sa(this,n);if(t.path.push(this),s){const o=[t,...e];s=Array.from(s);for(let r=0;r<s.length&&(s[r].callback.apply(this,o),t.off.called&&(delete t.off.called,this._removeEventListener(n,s[r].callback)),!t.stop.called);r++);}if(this._delegations){const o=this._delegations.get(n),r=this._delegations.get("*");o&&xa(o,t,e),r&&xa(r,t,e)}return t.return}catch(t){p.rethrowUnexpectedError(t,this)}},delegate(...i){return{to:(e,t)=>{this._delegations||(this._delegations=new Map),i.forEach(n=>{const s=this._delegations.get(n);s?s.set(e,t):this._delegations.set(n,new Map([[e,t]]))})}}},stopDelegating(i,e){if(!!this._delegations)if(!i)this._delegations.clear();else if(!e)this._delegations.delete(i);else{const t=this._delegations.get(i);t&&t.delete(e)}},_addEventListener(i,e,t){sg(this,i);const n=Ms(this,i),s=Jn.get(t.priority),o={callback:e,priority:s};for(const r of n){let a=!1;for(let l=0;l<r.length;l++)if(r[l].priority<s){r.splice(l,0,o),a=!0;break}a||r.push(o)}},_removeEventListener(i,e){const t=Ms(this,i);for(const n of t)for(let s=0;s<n.length;s++)n[s].callback==e&&(n.splice(s,1),s--)}};function ng(i,e){return i[Nt]&&i[Nt][e]?i[Nt][e].emitter:null}function Ea(i,e){i[Is]||(i[Is]=e||rt())}function Rs(i){return i[Is]}function Aa(i){return i._events||Object.defineProperty(i,"_events",{value:{}}),i._events}function ig(){return{callbacks:[],childEvents:[]}}function sg(i,e){const t=Aa(i);if(t[e])return;let n=e,s=null;const o=[];for(;n!==""&&!t[n];)t[n]=ig(),o.push(t[n]),s&&t[n].childEvents.push(s),s=n,n=n.substr(0,n.lastIndexOf(":"));if(n!==""){for(const r of o)r.callbacks=t[n].callbacks.slice();t[n].childEvents.push(s)}}function Ms(i,e){const t=Aa(i)[e];if(!t)return[];let n=[t.callbacks];for(let s=0;s<t.childEvents.length;s++){const o=Ms(i,t.childEvents[s]);n=n.concat(o)}return n}function Sa(i,e){let t;return!i._events||!(t=i._events[e])||!t.callbacks.length?e.indexOf(":")>-1?Sa(i,e.substr(0,e.lastIndexOf(":"))):null:t.callbacks}function xa(i,e,t){for(let[n,s]of i){s?typeof s=="function"&&(s=s(e.name)):s=e.name;const o=new Ot(e.source,s);o.path=[...e.path],n.fire(o,...t)}}function og(i,e,t,n,s){e._addEventListener?e._addEventListener(t,n,s):i._addEventListener.call(e,t,n,s)}function Vs(i,e,t,n){e._removeEventListener?e._removeEventListener(t,n):i._removeEventListener.call(e,t,n)}var rg=typeof global=="object"&&global&&global.Object===Object&&global,Pa=rg,ag=typeof self=="object"&&self&&self.Object===Object&&self,lg=Pa||ag||Function("return this")(),Ze=lg,cg=Ze.Symbol,at=cg,Ia=Object.prototype,ug=Ia.hasOwnProperty,dg=Ia.toString,Qn=at?at.toStringTag:void 0;function hg(i){var e=ug.call(i,Qn),t=i[Qn];try{i[Qn]=void 0;var n=!0}catch{}var s=dg.call(i);return n&&(e?i[Qn]=t:delete i[Qn]),s}var fg=Object.prototype,mg=fg.toString;function gg(i){return mg.call(i)}var pg="[object Null]",wg="[object Undefined]",Ra=at?at.toStringTag:void 0;function Dt(i){return i==null?i===void 0?wg:pg:Ra&&Ra in Object(i)?hg(i):gg(i)}function qe(i){return i!=null&&typeof i=="object"}var bg="[object Symbol]";function Ei(i){return typeof i=="symbol"||qe(i)&&Dt(i)==bg}function _g(i,e){for(var t=-1,n=i==null?0:i.length,s=Array(n);++t<n;)s[t]=e(i[t],t,i);return s}var vg=Array.isArray,Ne=vg,yg=1/0,Ma=at?at.prototype:void 0,Va=Ma?Ma.toString:void 0;function Oa(i){if(typeof i=="string")return i;if(Ne(i))return _g(i,Oa)+"";if(Ei(i))return Va?Va.call(i):"";var e=i+"";return e=="0"&&1/i==-yg?"-0":e}var Cg=/\s/;function kg(i){for(var e=i.length;e--&&Cg.test(i.charAt(e)););return e}var Tg=/^\s+/;function Eg(i){return i&&i.slice(0,kg(i)+1).replace(Tg,"")}function be(i){var e=typeof i;return i!=null&&(e=="object"||e=="function")}var Na=0/0,Ag=/^[-+]0x[0-9a-f]+$/i,Sg=/^0b[01]+$/i,xg=/^0o[0-7]+$/i,Pg=parseInt;function Da(i){if(typeof i=="number")return i;if(Ei(i))return Na;if(be(i)){var e=typeof i.valueOf=="function"?i.valueOf():i;i=be(e)?e+"":e}if(typeof i!="string")return i===0?i:+i;i=Eg(i);var t=Sg.test(i);return t||xg.test(i)?Pg(i.slice(2),t?2:8):Ag.test(i)?Na:+i}function jt(i){return i}var Ig="[object AsyncFunction]",Rg="[object Function]",Mg="[object GeneratorFunction]",Vg="[object Proxy]";function Yn(i){if(!be(i))return!1;var e=Dt(i);return e==Rg||e==Mg||e==Ig||e==Vg}var Og=Ze["__core-js_shared__"],Os=Og,Ba=function(){var i=/[^.]+$/.exec(Os&&Os.keys&&Os.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}();function Ng(i){return!!Ba&&Ba in i}var Dg=Function.prototype,Bg=Dg.toString;function Kt(i){if(i!=null){try{return Bg.call(i)}catch{}try{return i+""}catch{}}return""}var Fg=/[\\^$.*+?()[\]{}|]/g,Lg=/^\[object .+?Constructor\]$/,zg=Function.prototype,$g=Object.prototype,Hg=zg.toString,Ug=$g.hasOwnProperty,Wg=RegExp("^"+Hg.call(Ug).replace(Fg,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function qg(i){if(!be(i)||Ng(i))return!1;var e=Yn(i)?Wg:Lg;return e.test(Kt(i))}function jg(i,e){return i==null?void 0:i[e]}function Gt(i,e){var t=jg(i,e);return qg(t)?t:void 0}var Kg=Gt(Ze,"WeakMap"),Ns=Kg,Fa=Object.create,Gg=function(){function i(){}return function(e){if(!be(e))return{};if(Fa)return Fa(e);i.prototype=e;var t=new i;return i.prototype=void 0,t}}(),Jg=Gg;function Qg(i,e,t){switch(t.length){case 0:return i.call(e);case 1:return i.call(e,t[0]);case 2:return i.call(e,t[0],t[1]);case 3:return i.call(e,t[0],t[1],t[2])}return i.apply(e,t)}function La(i,e){var t=-1,n=i.length;for(e||(e=Array(n));++t<n;)e[t]=i[t];return e}var Yg=800,Xg=16,Zg=Date.now;function ep(i){var e=0,t=0;return function(){var n=Zg(),s=Xg-(n-t);if(t=n,s>0){if(++e>=Yg)return arguments[0]}else e=0;return i.apply(void 0,arguments)}}function tp(i){return function(){return i}}var np=function(){try{var i=Gt(Object,"defineProperty");return i({},"",{}),i}catch{}}(),Ai=np,ip=Ai?function(i,e){return Ai(i,"toString",{configurable:!0,enumerable:!1,value:tp(e),writable:!0})}:jt,sp=ip,op=ep(sp),rp=op;function ap(i,e){for(var t=-1,n=i==null?0:i.length;++t<n&&e(i[t],t,i)!==!1;);return i}var lp=9007199254740991,cp=/^(?:0|[1-9]\d*)$/;function Ds(i,e){var t=typeof i;return e=e==null?lp:e,!!e&&(t=="number"||t!="symbol"&&cp.test(i))&&i>-1&&i%1==0&&i<e}function Bs(i,e,t){e=="__proto__"&&Ai?Ai(i,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):i[e]=t}function Xn(i,e){return i===e||i!==i&&e!==e}var up=Object.prototype,dp=up.hasOwnProperty;function Fs(i,e,t){var n=i[e];(!(dp.call(i,e)&&Xn(n,t))||t===void 0&&!(e in i))&&Bs(i,e,t)}function mn(i,e,t,n){var s=!t;t||(t={});for(var o=-1,r=e.length;++o<r;){var a=e[o],l=n?n(t[a],i[a],a,t,i):void 0;l===void 0&&(l=i[a]),s?Bs(t,a,l):Fs(t,a,l)}return t}var za=Math.max;function hp(i,e,t){return e=za(e===void 0?i.length-1:e,0),function(){for(var n=arguments,s=-1,o=za(n.length-e,0),r=Array(o);++s<o;)r[s]=n[e+s];s=-1;for(var a=Array(e+1);++s<e;)a[s]=n[s];return a[e]=t(r),Qg(i,this,a)}}function fp(i,e){return rp(hp(i,e,jt),i+"")}var mp=9007199254740991;function $a(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=mp}function Si(i){return i!=null&&$a(i.length)&&!Yn(i)}function gp(i,e,t){if(!be(t))return!1;var n=typeof e;return(n=="number"?Si(t)&&Ds(e,t.length):n=="string"&&e in t)?Xn(t[e],i):!1}function Ha(i){return fp(function(e,t){var n=-1,s=t.length,o=s>1?t[s-1]:void 0,r=s>2?t[2]:void 0;for(o=i.length>3&&typeof o=="function"?(s--,o):void 0,r&&gp(t[0],t[1],r)&&(o=s<3?void 0:o,s=1),e=Object(e);++n<s;){var a=t[n];a&&i(e,a,n,o)}return e})}var pp=Object.prototype;function Ls(i){var e=i&&i.constructor,t=typeof e=="function"&&e.prototype||pp;return i===t}function wp(i,e){for(var t=-1,n=Array(i);++t<i;)n[t]=e(t);return n}var bp="[object Arguments]";function Ua(i){return qe(i)&&Dt(i)==bp}var Wa=Object.prototype,_p=Wa.hasOwnProperty,vp=Wa.propertyIsEnumerable,yp=Ua(function(){return arguments}())?Ua:function(i){return qe(i)&&_p.call(i,"callee")&&!vp.call(i,"callee")},zs=yp;function Cp(){return!1}var qa=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ja=qa&&typeof module=="object"&&module&&!module.nodeType&&module,kp=ja&&ja.exports===qa,Ka=kp?Ze.Buffer:void 0,Tp=Ka?Ka.isBuffer:void 0,Ep=Tp||Cp,Zn=Ep,Ap="[object Arguments]",Sp="[object Array]",xp="[object Boolean]",Pp="[object Date]",Ip="[object Error]",Rp="[object Function]",Mp="[object Map]",Vp="[object Number]",Op="[object Object]",Np="[object RegExp]",Dp="[object Set]",Bp="[object String]",Fp="[object WeakMap]",Lp="[object ArrayBuffer]",zp="[object DataView]",$p="[object Float32Array]",Hp="[object Float64Array]",Up="[object Int8Array]",Wp="[object Int16Array]",qp="[object Int32Array]",jp="[object Uint8Array]",Kp="[object Uint8ClampedArray]",Gp="[object Uint16Array]",Jp="[object Uint32Array]",me={};me[$p]=me[Hp]=me[Up]=me[Wp]=me[qp]=me[jp]=me[Kp]=me[Gp]=me[Jp]=!0;me[Ap]=me[Sp]=me[Lp]=me[xp]=me[zp]=me[Pp]=me[Ip]=me[Rp]=me[Mp]=me[Vp]=me[Op]=me[Np]=me[Dp]=me[Bp]=me[Fp]=!1;function Qp(i){return qe(i)&&$a(i.length)&&!!me[Dt(i)]}function $s(i){return function(e){return i(e)}}var Ga=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ei=Ga&&typeof module=="object"&&module&&!module.nodeType&&module,Yp=ei&&ei.exports===Ga,Hs=Yp&&Pa.process,Xp=function(){try{var i=ei&&ei.require&&ei.require("util").types;return i||Hs&&Hs.binding&&Hs.binding("util")}catch{}}(),gn=Xp,Ja=gn&&gn.isTypedArray,Zp=Ja?$s(Ja):Qp,Us=Zp,ew=Object.prototype,tw=ew.hasOwnProperty;function Qa(i,e){var t=Ne(i),n=!t&&zs(i),s=!t&&!n&&Zn(i),o=!t&&!n&&!s&&Us(i),r=t||n||s||o,a=r?wp(i.length,String):[],l=a.length;for(var c in i)(e||tw.call(i,c))&&!(r&&(c=="length"||s&&(c=="offset"||c=="parent")||o&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||Ds(c,l)))&&a.push(c);return a}function Ya(i,e){return function(t){return i(e(t))}}var nw=Ya(Object.keys,Object),iw=nw,sw=Object.prototype,ow=sw.hasOwnProperty;function rw(i){if(!Ls(i))return iw(i);var e=[];for(var t in Object(i))ow.call(i,t)&&t!="constructor"&&e.push(t);return e}function Ws(i){return Si(i)?Qa(i):rw(i)}function aw(i){var e=[];if(i!=null)for(var t in Object(i))e.push(t);return e}var lw=Object.prototype,cw=lw.hasOwnProperty;function uw(i){if(!be(i))return aw(i);var e=Ls(i),t=[];for(var n in i)n=="constructor"&&(e||!cw.call(i,n))||t.push(n);return t}function pn(i){return Si(i)?Qa(i,!0):uw(i)}var dw=Ha(function(i,e){mn(e,pn(e),i)}),ti=dw,hw=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,fw=/^\w*$/;function mw(i,e){if(Ne(i))return!1;var t=typeof i;return t=="number"||t=="symbol"||t=="boolean"||i==null||Ei(i)?!0:fw.test(i)||!hw.test(i)||e!=null&&i in Object(e)}var gw=Gt(Object,"create"),ni=gw;function pw(){this.__data__=ni?ni(null):{},this.size=0}function ww(i){var e=this.has(i)&&delete this.__data__[i];return this.size-=e?1:0,e}var bw="__lodash_hash_undefined__",_w=Object.prototype,vw=_w.hasOwnProperty;function yw(i){var e=this.__data__;if(ni){var t=e[i];return t===bw?void 0:t}return vw.call(e,i)?e[i]:void 0}var Cw=Object.prototype,kw=Cw.hasOwnProperty;function Tw(i){var e=this.__data__;return ni?e[i]!==void 0:kw.call(e,i)}var Ew="__lodash_hash_undefined__";function Aw(i,e){var t=this.__data__;return this.size+=this.has(i)?0:1,t[i]=ni&&e===void 0?Ew:e,this}function Jt(i){var e=-1,t=i==null?0:i.length;for(this.clear();++e<t;){var n=i[e];this.set(n[0],n[1])}}Jt.prototype.clear=pw;Jt.prototype.delete=ww;Jt.prototype.get=yw;Jt.prototype.has=Tw;Jt.prototype.set=Aw;function Sw(){this.__data__=[],this.size=0}function xi(i,e){for(var t=i.length;t--;)if(Xn(i[t][0],e))return t;return-1}var xw=Array.prototype,Pw=xw.splice;function Iw(i){var e=this.__data__,t=xi(e,i);if(t<0)return!1;var n=e.length-1;return t==n?e.pop():Pw.call(e,t,1),--this.size,!0}function Rw(i){var e=this.__data__,t=xi(e,i);return t<0?void 0:e[t][1]}function Mw(i){return xi(this.__data__,i)>-1}function Vw(i,e){var t=this.__data__,n=xi(t,i);return n<0?(++this.size,t.push([i,e])):t[n][1]=e,this}function yt(i){var e=-1,t=i==null?0:i.length;for(this.clear();++e<t;){var n=i[e];this.set(n[0],n[1])}}yt.prototype.clear=Sw;yt.prototype.delete=Iw;yt.prototype.get=Rw;yt.prototype.has=Mw;yt.prototype.set=Vw;var Ow=Gt(Ze,"Map"),ii=Ow;function Nw(){this.size=0,this.__data__={hash:new Jt,map:new(ii||yt),string:new Jt}}function Dw(i){var e=typeof i;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?i!=="__proto__":i===null}function Pi(i,e){var t=i.__data__;return Dw(e)?t[typeof e=="string"?"string":"hash"]:t.map}function Bw(i){var e=Pi(this,i).delete(i);return this.size-=e?1:0,e}function Fw(i){return Pi(this,i).get(i)}function Lw(i){return Pi(this,i).has(i)}function zw(i,e){var t=Pi(this,i),n=t.size;return t.set(i,e),this.size+=t.size==n?0:1,this}function Ct(i){var e=-1,t=i==null?0:i.length;for(this.clear();++e<t;){var n=i[e];this.set(n[0],n[1])}}Ct.prototype.clear=Nw;Ct.prototype.delete=Bw;Ct.prototype.get=Fw;Ct.prototype.has=Lw;Ct.prototype.set=zw;var $w="Expected a function";function qs(i,e){if(typeof i!="function"||e!=null&&typeof e!="function")throw new TypeError($w);var t=function(){var n=arguments,s=e?e.apply(this,n):n[0],o=t.cache;if(o.has(s))return o.get(s);var r=i.apply(this,n);return t.cache=o.set(s,r)||o,r};return t.cache=new(qs.Cache||Ct),t}qs.Cache=Ct;var Hw=500;function Uw(i){var e=qs(i,function(n){return t.size===Hw&&t.clear(),n}),t=e.cache;return e}var Ww=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,qw=/\\(\\)?/g,jw=Uw(function(i){var e=[];return i.charCodeAt(0)===46&&e.push(""),i.replace(Ww,function(t,n,s,o){e.push(s?o.replace(qw,"$1"):n||t)}),e}),Kw=jw;function js(i){return i==null?"":Oa(i)}function Ks(i,e){return Ne(i)?i:mw(i,e)?[i]:Kw(js(i))}var Gw=1/0;function Gs(i){if(typeof i=="string"||Ei(i))return i;var e=i+"";return e=="0"&&1/i==-Gw?"-0":e}function Xa(i,e){e=Ks(e,i);for(var t=0,n=e.length;i!=null&&t<n;)i=i[Gs(e[t++])];return t&&t==n?i:void 0}function Ii(i,e,t){var n=i==null?void 0:Xa(i,e);return n===void 0?t:n}function Za(i,e){for(var t=-1,n=e.length,s=i.length;++t<n;)i[s+t]=e[t];return i}var Jw=Ya(Object.getPrototypeOf,Object),Js=Jw,Qw="[object Object]",Yw=Function.prototype,Xw=Object.prototype,el=Yw.toString,Zw=Xw.hasOwnProperty,eb=el.call(Object);function je(i){if(!qe(i)||Dt(i)!=Qw)return!1;var e=Js(i);if(e===null)return!0;var t=Zw.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&el.call(t)==eb}function tl(i,e,t){var n=-1,s=i.length;e<0&&(e=-e>s?0:s+e),t=t>s?s:t,t<0&&(t+=s),s=e>t?0:t-e>>>0,e>>>=0;for(var o=Array(s);++n<s;)o[n]=i[n+e];return o}function tb(i,e,t){var n=i.length;return t=t===void 0?n:t,!e&&t>=n?i:tl(i,e,t)}var nb="\\ud800-\\udfff",ib="\\u0300-\\u036f",sb="\\ufe20-\\ufe2f",ob="\\u20d0-\\u20ff",rb=ib+sb+ob,ab="\\ufe0e\\ufe0f",lb="\\u200d",cb=RegExp("["+lb+nb+rb+ab+"]");function nl(i){return cb.test(i)}function ub(i){return i.split("")}var il="\\ud800-\\udfff",db="\\u0300-\\u036f",hb="\\ufe20-\\ufe2f",fb="\\u20d0-\\u20ff",mb=db+hb+fb,gb="\\ufe0e\\ufe0f",pb="["+il+"]",Qs="["+mb+"]",Ys="\\ud83c[\\udffb-\\udfff]",wb="(?:"+Qs+"|"+Ys+")",sl="[^"+il+"]",ol="(?:\\ud83c[\\udde6-\\uddff]){2}",rl="[\\ud800-\\udbff][\\udc00-\\udfff]",bb="\\u200d",al=wb+"?",ll="["+gb+"]?",_b="(?:"+bb+"(?:"+[sl,ol,rl].join("|")+")"+ll+al+")*",vb=ll+al+_b,yb="(?:"+[sl+Qs+"?",Qs,ol,rl,pb].join("|")+")",Cb=RegExp(Ys+"(?="+Ys+")|"+yb+vb,"g");function kb(i){return i.match(Cb)||[]}function Tb(i){return nl(i)?kb(i):ub(i)}function Eb(i){return function(e){e=js(e);var t=nl(e)?Tb(e):void 0,n=t?t[0]:e.charAt(0),s=t?tb(t,1).join(""):e.slice(1);return n[i]()+s}}var Ab=Eb("toUpperCase"),Sb=Ab;function xb(){this.__data__=new yt,this.size=0}function Pb(i){var e=this.__data__,t=e.delete(i);return this.size=e.size,t}function Ib(i){return this.__data__.get(i)}function Rb(i){return this.__data__.has(i)}var Mb=200;function Vb(i,e){var t=this.__data__;if(t instanceof yt){var n=t.__data__;if(!ii||n.length<Mb-1)return n.push([i,e]),this.size=++t.size,this;t=this.__data__=new Ct(n)}return t.set(i,e),this.size=t.size,this}function lt(i){var e=this.__data__=new yt(i);this.size=e.size}lt.prototype.clear=xb;lt.prototype.delete=Pb;lt.prototype.get=Ib;lt.prototype.has=Rb;lt.prototype.set=Vb;function Ob(i,e){return i&&mn(e,Ws(e),i)}function Nb(i,e){return i&&mn(e,pn(e),i)}var cl=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ul=cl&&typeof module=="object"&&module&&!module.nodeType&&module,Db=ul&&ul.exports===cl,dl=Db?Ze.Buffer:void 0,hl=dl?dl.allocUnsafe:void 0;function fl(i,e){if(e)return i.slice();var t=i.length,n=hl?hl(t):new i.constructor(t);return i.copy(n),n}function Bb(i,e){for(var t=-1,n=i==null?0:i.length,s=0,o=[];++t<n;){var r=i[t];e(r,t,i)&&(o[s++]=r)}return o}function ml(){return[]}var Fb=Object.prototype,Lb=Fb.propertyIsEnumerable,gl=Object.getOwnPropertySymbols,zb=gl?function(i){return i==null?[]:(i=Object(i),Bb(gl(i),function(e){return Lb.call(i,e)}))}:ml,Xs=zb;function $b(i,e){return mn(i,Xs(i),e)}var Hb=Object.getOwnPropertySymbols,Ub=Hb?function(i){for(var e=[];i;)Za(e,Xs(i)),i=Js(i);return e}:ml,pl=Ub;function Wb(i,e){return mn(i,pl(i),e)}function wl(i,e,t){var n=e(i);return Ne(i)?n:Za(n,t(i))}function Zs(i){return wl(i,Ws,Xs)}function qb(i){return wl(i,pn,pl)}var jb=Gt(Ze,"DataView"),eo=jb,Kb=Gt(Ze,"Promise"),to=Kb,Gb=Gt(Ze,"Set"),no=Gb,bl="[object Map]",Jb="[object Object]",_l="[object Promise]",vl="[object Set]",yl="[object WeakMap]",Cl="[object DataView]",Qb=Kt(eo),Yb=Kt(ii),Xb=Kt(to),Zb=Kt(no),e_=Kt(Ns),Qt=Dt;(eo&&Qt(new eo(new ArrayBuffer(1)))!=Cl||ii&&Qt(new ii)!=bl||to&&Qt(to.resolve())!=_l||no&&Qt(new no)!=vl||Ns&&Qt(new Ns)!=yl)&&(Qt=function(i){var e=Dt(i),t=e==Jb?i.constructor:void 0,n=t?Kt(t):"";if(n)switch(n){case Qb:return Cl;case Yb:return bl;case Xb:return _l;case Zb:return vl;case e_:return yl}return e});var si=Qt,t_=Object.prototype,n_=t_.hasOwnProperty;function i_(i){var e=i.length,t=new i.constructor(e);return e&&typeof i[0]=="string"&&n_.call(i,"index")&&(t.index=i.index,t.input=i.input),t}var s_=Ze.Uint8Array,Ri=s_;function io(i){var e=new i.constructor(i.byteLength);return new Ri(e).set(new Ri(i)),e}function o_(i,e){var t=e?io(i.buffer):i.buffer;return new i.constructor(t,i.byteOffset,i.byteLength)}var r_=/\w*$/;function a_(i){var e=new i.constructor(i.source,r_.exec(i));return e.lastIndex=i.lastIndex,e}var kl=at?at.prototype:void 0,Tl=kl?kl.valueOf:void 0;function l_(i){return Tl?Object(Tl.call(i)):{}}function El(i,e){var t=e?io(i.buffer):i.buffer;return new i.constructor(t,i.byteOffset,i.length)}var c_="[object Boolean]",u_="[object Date]",d_="[object Map]",h_="[object Number]",f_="[object RegExp]",m_="[object Set]",g_="[object String]",p_="[object Symbol]",w_="[object ArrayBuffer]",b_="[object DataView]",__="[object Float32Array]",v_="[object Float64Array]",y_="[object Int8Array]",C_="[object Int16Array]",k_="[object Int32Array]",T_="[object Uint8Array]",E_="[object Uint8ClampedArray]",A_="[object Uint16Array]",S_="[object Uint32Array]";function x_(i,e,t){var n=i.constructor;switch(e){case w_:return io(i);case c_:case u_:return new n(+i);case b_:return o_(i,t);case __:case v_:case y_:case C_:case k_:case T_:case E_:case A_:case S_:return El(i,t);case d_:return new n;case h_:case g_:return new n(i);case f_:return a_(i);case m_:return new n;case p_:return l_(i)}}function Al(i){return typeof i.constructor=="function"&&!Ls(i)?Jg(Js(i)):{}}var P_="[object Map]";function I_(i){return qe(i)&&si(i)==P_}var Sl=gn&&gn.isMap,R_=Sl?$s(Sl):I_,M_=R_,V_="[object Set]";function O_(i){return qe(i)&&si(i)==V_}var xl=gn&&gn.isSet,N_=xl?$s(xl):O_,D_=N_,B_=1,F_=2,L_=4,Pl="[object Arguments]",z_="[object Array]",$_="[object Boolean]",H_="[object Date]",U_="[object Error]",Il="[object Function]",W_="[object GeneratorFunction]",q_="[object Map]",j_="[object Number]",Rl="[object Object]",K_="[object RegExp]",G_="[object Set]",J_="[object String]",Q_="[object Symbol]",Y_="[object WeakMap]",X_="[object ArrayBuffer]",Z_="[object DataView]",ev="[object Float32Array]",tv="[object Float64Array]",nv="[object Int8Array]",iv="[object Int16Array]",sv="[object Int32Array]",ov="[object Uint8Array]",rv="[object Uint8ClampedArray]",av="[object Uint16Array]",lv="[object Uint32Array]",he={};he[Pl]=he[z_]=he[X_]=he[Z_]=he[$_]=he[H_]=he[ev]=he[tv]=he[nv]=he[iv]=he[sv]=he[q_]=he[j_]=he[Rl]=he[K_]=he[G_]=he[J_]=he[Q_]=he[ov]=he[rv]=he[av]=he[lv]=!0;he[U_]=he[Il]=he[Y_]=!1;function wn(i,e,t,n,s,o){var r,a=e&B_,l=e&F_,c=e&L_;if(t&&(r=s?t(i,n,s,o):t(i)),r!==void 0)return r;if(!be(i))return i;var u=Ne(i);if(u){if(r=i_(i),!a)return La(i,r)}else{var d=si(i),f=d==Il||d==W_;if(Zn(i))return fl(i,a);if(d==Rl||d==Pl||f&&!s){if(r=l||f?{}:Al(i),!a)return l?Wb(i,Nb(r,i)):$b(i,Ob(r,i))}else{if(!he[d])return s?i:{};r=x_(i,d,a)}}o||(o=new lt);var b=o.get(i);if(b)return b;o.set(i,r),D_(i)?i.forEach(function(A){r.add(wn(A,e,t,A,i,o))}):M_(i)&&i.forEach(function(A,R){r.set(R,wn(A,e,t,R,i,o))});var _=c?l?qb:Zs:l?pn:Ws,C=u?void 0:_(i);return ap(C||i,function(A,R){C&&(R=A,A=i[R]),Fs(r,R,wn(A,e,t,R,i,o))}),r}var cv=4;function Ml(i){return wn(i,cv)}var uv=1,dv=4;function ct(i){return wn(i,uv|dv)}var hv=1,fv=4;function Vl(i,e){return e=typeof e=="function"?e:void 0,wn(i,hv|fv,e)}var mv="__lodash_hash_undefined__";function gv(i){return this.__data__.set(i,mv),this}function pv(i){return this.__data__.has(i)}function Mi(i){var e=-1,t=i==null?0:i.length;for(this.__data__=new Ct;++e<t;)this.add(i[e])}Mi.prototype.add=Mi.prototype.push=gv;Mi.prototype.has=pv;function wv(i,e){for(var t=-1,n=i==null?0:i.length;++t<n;)if(e(i[t],t,i))return!0;return!1}function bv(i,e){return i.has(e)}var _v=1,vv=2;function Ol(i,e,t,n,s,o){var r=t&_v,a=i.length,l=e.length;if(a!=l&&!(r&&l>a))return!1;var c=o.get(i),u=o.get(e);if(c&&u)return c==e&&u==i;var d=-1,f=!0,b=t&vv?new Mi:void 0;for(o.set(i,e),o.set(e,i);++d<a;){var _=i[d],C=e[d];if(n)var A=r?n(C,_,d,e,i,o):n(_,C,d,i,e,o);if(A!==void 0){if(A)continue;f=!1;break}if(b){if(!wv(e,function(R,O){if(!bv(b,O)&&(_===R||s(_,R,t,n,o)))return b.push(O)})){f=!1;break}}else if(!(_===C||s(_,C,t,n,o))){f=!1;break}}return o.delete(i),o.delete(e),f}function yv(i){var e=-1,t=Array(i.size);return i.forEach(function(n,s){t[++e]=[s,n]}),t}function Cv(i){var e=-1,t=Array(i.size);return i.forEach(function(n){t[++e]=n}),t}var kv=1,Tv=2,Ev="[object Boolean]",Av="[object Date]",Sv="[object Error]",xv="[object Map]",Pv="[object Number]",Iv="[object RegExp]",Rv="[object Set]",Mv="[object String]",Vv="[object Symbol]",Ov="[object ArrayBuffer]",Nv="[object DataView]",Nl=at?at.prototype:void 0,so=Nl?Nl.valueOf:void 0;function Dv(i,e,t,n,s,o,r){switch(t){case Nv:if(i.byteLength!=e.byteLength||i.byteOffset!=e.byteOffset)return!1;i=i.buffer,e=e.buffer;case Ov:return!(i.byteLength!=e.byteLength||!o(new Ri(i),new Ri(e)));case Ev:case Av:case Pv:return Xn(+i,+e);case Sv:return i.name==e.name&&i.message==e.message;case Iv:case Mv:return i==e+"";case xv:var a=yv;case Rv:var l=n&kv;if(a||(a=Cv),i.size!=e.size&&!l)return!1;var c=r.get(i);if(c)return c==e;n|=Tv,r.set(i,e);var u=Ol(a(i),a(e),n,s,o,r);return r.delete(i),u;case Vv:if(so)return so.call(i)==so.call(e)}return!1}var Bv=1,Fv=Object.prototype,Lv=Fv.hasOwnProperty;function zv(i,e,t,n,s,o){var r=t&Bv,a=Zs(i),l=a.length,c=Zs(e),u=c.length;if(l!=u&&!r)return!1;for(var d=l;d--;){var f=a[d];if(!(r?f in e:Lv.call(e,f)))return!1}var b=o.get(i),_=o.get(e);if(b&&_)return b==e&&_==i;var C=!0;o.set(i,e),o.set(e,i);for(var A=r;++d<l;){f=a[d];var R=i[f],O=e[f];if(n)var U=r?n(O,R,f,e,i,o):n(R,O,f,i,e,o);if(!(U===void 0?R===O||s(R,O,t,n,o):U)){C=!1;break}A||(A=f=="constructor")}if(C&&!A){var Q=i.constructor,se=e.constructor;Q!=se&&"constructor"in i&&"constructor"in e&&!(typeof Q=="function"&&Q instanceof Q&&typeof se=="function"&&se instanceof se)&&(C=!1)}return o.delete(i),o.delete(e),C}var $v=1,Dl="[object Arguments]",Bl="[object Array]",Vi="[object Object]",Hv=Object.prototype,Fl=Hv.hasOwnProperty;function Uv(i,e,t,n,s,o){var r=Ne(i),a=Ne(e),l=r?Bl:si(i),c=a?Bl:si(e);l=l==Dl?Vi:l,c=c==Dl?Vi:c;var u=l==Vi,d=c==Vi,f=l==c;if(f&&Zn(i)){if(!Zn(e))return!1;r=!0,u=!1}if(f&&!u)return o||(o=new lt),r||Us(i)?Ol(i,e,t,n,s,o):Dv(i,e,l,t,n,s,o);if(!(t&$v)){var b=u&&Fl.call(i,"__wrapped__"),_=d&&Fl.call(e,"__wrapped__");if(b||_){var C=b?i.value():i,A=_?e.value():e;return o||(o=new lt),s(C,A,t,n,o)}}return f?(o||(o=new lt),zv(i,e,t,n,s,o)):!1}function oo(i,e,t,n,s){return i===e?!0:i==null||e==null||!qe(i)&&!qe(e)?i!==i&&e!==e:Uv(i,e,t,n,oo,s)}function Wv(i){return function(e,t,n){for(var s=-1,o=Object(e),r=n(e),a=r.length;a--;){var l=r[i?a:++s];if(t(o[l],l,o)===!1)break}return e}}var qv=Wv(),jv=qv,Kv=function(){return Ze.Date.now()},ro=Kv,Gv="Expected a function",Jv=Math.max,Qv=Math.min;function Oi(i,e,t){var n,s,o,r,a,l,c=0,u=!1,d=!1,f=!0;if(typeof i!="function")throw new TypeError(Gv);e=Da(e)||0,be(t)&&(u=!!t.leading,d="maxWait"in t,o=d?Jv(Da(t.maxWait)||0,e):o,f="trailing"in t?!!t.trailing:f);function b(N){var B=n,D=s;return n=s=void 0,c=N,r=i.apply(D,B),r}function _(N){return c=N,a=setTimeout(R,e),u?b(N):r}function C(N){var B=N-l,D=N-c,X=e-B;return d?Qv(X,o-D):X}function A(N){var B=N-l,D=N-c;return l===void 0||B>=e||B<0||d&&D>=o}function R(){var N=ro();if(A(N))return O(N);a=setTimeout(R,C(N))}function O(N){return a=void 0,f&&n?b(N):(n=s=void 0,r)}function U(){a!==void 0&&clearTimeout(a),c=0,n=l=s=a=void 0}function Q(){return a===void 0?r:O(ro())}function se(){var N=ro(),B=A(N);if(n=arguments,s=this,l=N,B){if(a===void 0)return _(l);if(d)return clearTimeout(a),a=setTimeout(R,e),b(l)}return a===void 0&&(a=setTimeout(R,e)),r}return se.cancel=U,se.flush=Q,se}function ao(i,e,t){(t!==void 0&&!Xn(i[e],t)||t===void 0&&!(e in i))&&Bs(i,e,t)}function Yv(i){return qe(i)&&Si(i)}function lo(i,e){if(!(e==="constructor"&&typeof i[e]=="function")&&e!="__proto__")return i[e]}function Xv(i){return mn(i,pn(i))}function Zv(i,e,t,n,s,o,r){var a=lo(i,t),l=lo(e,t),c=r.get(l);if(c){ao(i,t,c);return}var u=o?o(a,l,t+"",i,e,r):void 0,d=u===void 0;if(d){var f=Ne(l),b=!f&&Zn(l),_=!f&&!b&&Us(l);u=l,f||b||_?Ne(a)?u=a:Yv(a)?u=La(a):b?(d=!1,u=fl(l,!0)):_?(d=!1,u=El(l,!0)):u=[]:je(l)||zs(l)?(u=a,zs(a)?u=Xv(a):(!be(a)||Yn(a))&&(u=Al(l))):d=!1}d&&(r.set(l,u),s(u,l,n,o,r),r.delete(l)),ao(i,t,u)}function Ll(i,e,t,n,s){i!==e&&jv(e,function(o,r){if(s||(s=new lt),be(o))Zv(i,e,r,t,Ll,n,s);else{var a=n?n(lo(i,r),o,r+"",i,e,s):void 0;a===void 0&&(a=o),ao(i,r,a)}},pn)}function e1(i){var e=i==null?0:i.length;return e?i[e-1]:void 0}var zl=/[\\^$.*+?()[\]{}|]/g,t1=RegExp(zl.source);function n1(i){return i=js(i),i&&t1.test(i)?i.replace(zl,"\\$&"):i}var i1="[object String]";function $l(i){return typeof i=="string"||!Ne(i)&&qe(i)&&Dt(i)==i1}function s1(i,e){return e.length<2?i:Xa(i,tl(e,0,-1))}function Yt(i){return qe(i)&&i.nodeType===1&&!je(i)}function Hl(i,e){return oo(i,e)}function o1(i,e,t){t=typeof t=="function"?t:void 0;var n=t?t(i,e):void 0;return n===void 0?oo(i,e,void 0,t):!!n}var r1=Ha(function(i,e,t){Ll(i,e,t)}),Ul=r1;function a1(i,e){return e=Ks(e,i),i=s1(i,e),i==null||delete i[Gs(e1(e))]}function l1(i,e,t,n){if(!be(i))return i;e=Ks(e,i);for(var s=-1,o=e.length,r=o-1,a=i;a!=null&&++s<o;){var l=Gs(e[s]),c=t;if(l==="__proto__"||l==="constructor"||l==="prototype")return i;if(s!=r){var u=a[l];c=n?n(u,l,a):void 0,c===void 0&&(c=be(u)?u:Ds(e[s+1])?[]:{})}Fs(a,l,c),a=a[l]}return i}function c1(i,e,t){return i==null?i:l1(i,e,t)}var u1="Expected a function";function Wl(i,e,t){var n=!0,s=!0;if(typeof i!="function")throw new TypeError(u1);return be(t)&&(n="leading"in t?!!t.leading:n,s="trailing"in t?!!t.trailing:s),Oi(i,e,{leading:n,maxWait:e,trailing:s})}function d1(i,e){return i==null?!0:a1(i,e)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Ni=Symbol("observableProperties"),Di=Symbol("boundObservables"),Bi=Symbol("boundProperties"),bn=Symbol("decoratedMethods"),ql=Symbol("decoratedOriginal"),re={set(i,e){if(be(i)){Object.keys(i).forEach(n=>{this.set(n,i[n])},this);return}jl(this);const t=this[Ni];if(i in this&&!t.has(i))throw new p("observable-set-cannot-override",this);Object.defineProperty(this,i,{enumerable:!0,configurable:!0,get(){return t.get(i)},set(n){const s=t.get(i);let o=this.fire("set:"+i,i,n,s);o===void 0&&(o=n),(s!==o||!t.has(i))&&(t.set(i,o),this.fire("change:"+i,i,o,s))}}),this[i]=e},bind(...i){if(!i.length||!Kl(i))throw new p("observable-bind-wrong-properties",this);if(new Set(i).size!==i.length)throw new p("observable-bind-duplicate-properties",this);jl(this);const e=this[Bi];i.forEach(n=>{if(e.has(n))throw new p("observable-bind-rebind",this)});const t=new Map;return i.forEach(n=>{const s={property:n,to:[]};e.set(n,s),t.set(n,s)}),{to:h1,toMany:f1,_observable:this,_bindProperties:i,_to:[],_bindings:t}},unbind(...i){if(!this[Ni])return;const e=this[Bi],t=this[Di];if(i.length){if(!Kl(i))throw new p("observable-unbind-wrong-properties",this);i.forEach(n=>{const s=e.get(n);if(!s)return;let o,r,a,l;s.to.forEach(c=>{o=c[0],r=c[1],a=t.get(o),l=a[r],l.delete(s),l.size||delete a[r],Object.keys(a).length||(t.delete(o),this.stopListening(o,"change"))}),e.delete(n)})}else t.forEach((n,s)=>{this.stopListening(s,"change")}),t.clear(),e.clear()},decorate(i){const e=this[i];if(!e)throw new p("observablemixin-cannot-decorate-undefined",this,{object:this,methodName:i});this.on(i,(t,n)=>{t.return=e.apply(this,n)}),this[i]=function(...t){return this.fire(i,t)},this[i][ql]=e,this[bn]||(this[bn]=[]),this[bn].push(i)}};ti(re,oe);re.stopListening=function(i,e,t){if(!i&&this[bn]){for(const n of this[bn])this[n]=this[n][ql];delete this[bn]}oe.stopListening.call(this,i,e,t)};function jl(i){i[Ni]||(Object.defineProperty(i,Ni,{value:new Map}),Object.defineProperty(i,Di,{value:new Map}),Object.defineProperty(i,Bi,{value:new Map}))}function h1(...i){const e=g1(...i),t=Array.from(this._bindings.keys()),n=t.length;if(!e.callback&&e.to.length>1)throw new p("observable-bind-to-no-callback",this);if(n>1&&e.callback)throw new p("observable-bind-to-extra-callback",this);e.to.forEach(s=>{if(s.properties.length&&s.properties.length!==n)throw new p("observable-bind-to-properties-length",this);s.properties.length||(s.properties=this._bindProperties)}),this._to=e.to,e.callback&&(this._bindings.get(t[0]).callback=e.callback),b1(this._observable,this._to),w1(this),this._bindProperties.forEach(s=>{Gl(this._observable,s)})}function f1(i,e,t){if(this._bindings.size>1)throw new p("observable-bind-to-many-not-one-binding",this);this.to(...m1(i,e),t)}function m1(i,e){const t=i.map(n=>[n,e]);return Array.prototype.concat.apply([],t)}function Kl(i){return i.every(e=>typeof e=="string")}function g1(...i){if(!i.length)throw new p("observable-bind-to-parse-error",null);const e={to:[]};let t;return typeof i[i.length-1]=="function"&&(e.callback=i.pop()),i.forEach(n=>{if(typeof n=="string")t.properties.push(n);else if(typeof n=="object")t={observable:n,properties:[]},e.to.push(t);else throw new p("observable-bind-to-parse-error",null)}),e}function p1(i,e,t,n){const s=i[Di],o=s.get(t),r=o||{};r[n]||(r[n]=new Set),r[n].add(e),o||s.set(t,r)}function w1(i){let e;i._bindings.forEach((t,n)=>{i._to.forEach(s=>{e=s.properties[t.callback?0:i._bindProperties.indexOf(n)],t.to.push([s.observable,e]),p1(i._observable,t,s.observable,e)})})}function Gl(i,e){const n=i[Bi].get(e);let s;n.callback?s=n.callback.apply(i,n.to.map(o=>o[0][o[1]])):(s=n.to[0],s=s[0][s[1]]),Object.prototype.hasOwnProperty.call(i,e)?i[e]=s:i.set(e,s)}function b1(i,e){e.forEach(t=>{const n=i[Di];let s;n.get(t.observable)||i.listenTo(t.observable,"change",(o,r)=>{s=n.get(t.observable)[r],s&&s.forEach(a=>{Gl(i,a.property)})})})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function F(i,...e){e.forEach(t=>{Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t)).forEach(n=>{if(n in i.prototype)return;const s=Object.getOwnPropertyDescriptor(t,n);s.enumerable=!1,Object.defineProperty(i.prototype,n,s)})})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class P{constructor(e){this.editor=e,this.set("isEnabled",!0),this._disableStack=new Set}forceDisabled(e){this._disableStack.add(e),this._disableStack.size==1&&(this.on("set:isEnabled",Jl,{priority:"highest"}),this.isEnabled=!1)}clearForceDisabled(e){this._disableStack.delete(e),this._disableStack.size==0&&(this.off("set:isEnabled",Jl),this.isEnabled=!0)}destroy(){this.stopListening()}static get isContextPlugin(){return!1}}F(P,re);function Jl(i){i.return=!1,i.stop()}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class q{constructor(e){this.editor=e,this.set("value",void 0),this.set("isEnabled",!1),this.affectsData=!0,this._disableStack=new Set,this.decorate("execute"),this.listenTo(this.editor.model.document,"change",()=>{this.refresh()}),this.on("execute",t=>{this.isEnabled||t.stop()},{priority:"high"}),this.listenTo(e,"change:isReadOnly",(t,n,s)=>{s&&this.affectsData?this.forceDisabled("readOnlyMode"):this.clearForceDisabled("readOnlyMode")})}refresh(){this.isEnabled=!0}forceDisabled(e){this._disableStack.add(e),this._disableStack.size==1&&(this.on("set:isEnabled",Ql,{priority:"highest"}),this.isEnabled=!1)}clearForceDisabled(e){this._disableStack.delete(e),this._disableStack.size==0&&(this.off("set:isEnabled",Ql),this.refresh())}execute(){}destroy(){this.stopListening()}}F(q,re);function Ql(i){i.return=!1,i.stop()}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Yl extends q{constructor(e){super(e);this._childCommands=[]}refresh(){}execute(...e){const t=this._getFirstEnabledCommand();return t!=null&&t.execute(e)}registerChildCommand(e){this._childCommands.push(e),e.on("change:isEnabled",()=>this._checkEnabled()),this._checkEnabled()}_checkEnabled(){this.isEnabled=!!this._getFirstEnabledCommand()}_getFirstEnabledCommand(){return this._childCommands.find(e=>e.isEnabled)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Xl{constructor(e,t){this._config={},t&&this.define(Zl(t)),e&&this._setObjectToTarget(this._config,e)}set(e,t){this._setToTarget(this._config,e,t)}define(e,t){const n=!0;this._setToTarget(this._config,e,t,n)}get(e){return this._getFromSource(this._config,e)}*names(){for(const e of Object.keys(this._config))yield e}_setToTarget(e,t,n,s=!1){if(je(t)){this._setObjectToTarget(e,t,s);return}const o=t.split(".");t=o.pop();for(const r of o)je(e[r])||(e[r]={}),e=e[r];if(je(n)){je(e[t])||(e[t]={}),e=e[t],this._setObjectToTarget(e,n,s);return}s&&typeof e[t]!="undefined"||(e[t]=n)}_getFromSource(e,t){const n=t.split(".");t=n.pop();for(const s of n){if(!je(e[s])){e=null;break}e=e[s]}return e?Zl(e[t]):void 0}_setObjectToTarget(e,t,n){Object.keys(t).forEach(s=>{this._setToTarget(e,s,t[s],n)})}}function Zl(i){return Vl(i,_1)}function _1(i){return Yt(i)?i:void 0}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Ke(i){return!!(i&&i[Symbol.iterator])}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class $e{constructor(e={},t={}){const n=Ke(e);if(n||(t=e),this._items=[],this._itemMap=new Map,this._idProperty=t.idProperty||"id",this._bindToExternalToInternalMap=new WeakMap,this._bindToInternalToExternalMap=new WeakMap,this._skippedIndexesFromExternal=[],n)for(const s of e)this._items.push(s),this._itemMap.set(this._getItemIdBeforeAdding(s),s)}get length(){return this._items.length}get first(){return this._items[0]||null}get last(){return this._items[this.length-1]||null}add(e,t){return this.addMany([e],t)}addMany(e,t){if(t===void 0)t=this._items.length;else if(t>this._items.length||t<0)throw new p("collection-add-item-invalid-index",this);for(let n=0;n<e.length;n++){const s=e[n],o=this._getItemIdBeforeAdding(s),r=t+n;this._items.splice(r,0,s),this._itemMap.set(o,s),this.fire("add",s,r)}return this.fire("change",{added:e,removed:[],index:t}),this}get(e){let t;if(typeof e=="string")t=this._itemMap.get(e);else if(typeof e=="number")t=this._items[e];else throw new p("collection-get-invalid-arg",this);return t||null}has(e){if(typeof e=="string")return this._itemMap.has(e);{const t=this._idProperty,n=e[t];return this._itemMap.has(n)}}getIndex(e){let t;return typeof e=="string"?t=this._itemMap.get(e):t=e,this._items.indexOf(t)}remove(e){const[t,n]=this._remove(e);return this.fire("change",{added:[],removed:[t],index:n}),t}map(e,t){return this._items.map(e,t)}find(e,t){return this._items.find(e,t)}filter(e,t){return this._items.filter(e,t)}clear(){this._bindToCollection&&(this.stopListening(this._bindToCollection),this._bindToCollection=null);const e=Array.from(this._items);for(;this.length;)this._remove(0);this.fire("change",{added:[],removed:e,index:0})}bindTo(e){if(this._bindToCollection)throw new p("collection-bind-to-rebind",this);return this._bindToCollection=e,{as:t=>{this._setUpBindToBinding(n=>new t(n))},using:t=>{typeof t=="function"?this._setUpBindToBinding(n=>t(n)):this._setUpBindToBinding(n=>n[t])}}}_setUpBindToBinding(e){const t=this._bindToCollection,n=(s,o,r)=>{const a=t._bindToCollection==this,l=t._bindToInternalToExternalMap.get(o);if(a&&l)this._bindToExternalToInternalMap.set(o,l),this._bindToInternalToExternalMap.set(l,o);else{const c=e(o);if(!c){this._skippedIndexesFromExternal.push(r);return}let u=r;for(const d of this._skippedIndexesFromExternal)r>d&&u--;for(const d of t._skippedIndexesFromExternal)u>=d&&u++;this._bindToExternalToInternalMap.set(o,c),this._bindToInternalToExternalMap.set(c,o),this.add(c,u);for(let d=0;d<t._skippedIndexesFromExternal.length;d++)u<=t._skippedIndexesFromExternal[d]&&t._skippedIndexesFromExternal[d]++}};for(const s of t)n(null,s,t.getIndex(s));this.listenTo(t,"add",n),this.listenTo(t,"remove",(s,o,r)=>{const a=this._bindToExternalToInternalMap.get(o);a&&this.remove(a),this._skippedIndexesFromExternal=this._skippedIndexesFromExternal.reduce((l,c)=>(r<c&&l.push(c-1),r>c&&l.push(c),l),[])})}_getItemIdBeforeAdding(e){const t=this._idProperty;let n;if(t in e){if(n=e[t],typeof n!="string")throw new p("collection-add-invalid-id",this);if(this.get(n))throw new p("collection-add-item-already-exists",this)}else e[t]=n=rt();return n}_remove(e){let t,n,s,o=!1;const r=this._idProperty;if(typeof e=="string"?(n=e,s=this._itemMap.get(n),o=!s,s&&(t=this._items.indexOf(s))):typeof e=="number"?(t=e,s=this._items[t],o=!s,s&&(n=s[r])):(s=e,n=s[r],t=this._items.indexOf(s),o=t==-1||!this._itemMap.get(n)),o)throw new p("collection-remove-404",this);this._items.splice(t,1),this._itemMap.delete(n);const a=this._bindToInternalToExternalMap.get(s);return this._bindToInternalToExternalMap.delete(s),this._bindToExternalToInternalMap.delete(a),this.fire("remove",s,t),[s,t]}[Symbol.iterator](){return this._items[Symbol.iterator]()}}F($e,oe);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class co{constructor(e,t=[],n=[]){this._context=e,this._plugins=new Map,this._availablePlugins=new Map;for(const s of t)s.pluginName&&this._availablePlugins.set(s.pluginName,s);this._contextPlugins=new Map;for(const[s,o]of n)this._contextPlugins.set(s,o),this._contextPlugins.set(o,s),s.pluginName&&this._availablePlugins.set(s.pluginName,s)}*[Symbol.iterator](){for(const e of this._plugins)typeof e[0]=="function"&&(yield e)}get(e){const t=this._plugins.get(e);if(!t){let n=e;throw typeof e=="function"&&(n=e.pluginName||e.name),new p("plugincollection-plugin-not-loaded",this._context,{plugin:n})}return t}has(e){return this._plugins.has(e)}init(e,t=[],n=[]){const s=this,o=this._context;b(e),C(e);const r=e.filter(N=>!d(N,t)),a=[..._(r)];se(a,n);const l=U(a);return Q(l,"init").then(()=>Q(l,"afterInit")).then(()=>l);function c(N){return typeof N=="function"}function u(N){return c(N)&&N.isContextPlugin}function d(N,B){return B.some(D=>D===N||f(N)===D||f(D)===N)}function f(N){return c(N)?N.pluginName||N.name:N}function b(N,B=new Set){N.forEach(D=>{!c(D)||B.has(D)||(B.add(D),D.pluginName&&!s._availablePlugins.has(D.pluginName)&&s._availablePlugins.set(D.pluginName,D),D.requires&&b(D.requires,B))})}function _(N,B=new Set){return N.map(D=>c(D)?D:s._availablePlugins.get(D)).reduce((D,X)=>B.has(X)?D:(B.add(X),X.requires&&(C(X.requires,X),_(X.requires,B).forEach(bt=>D.add(bt))),D.add(X)),new Set)}function C(N,B=null){N.map(D=>c(D)?D:s._availablePlugins.get(D)||D).forEach(D=>{A(D,B),R(D,B),O(D,B)})}function A(N,B){if(!c(N))throw B?new p("plugincollection-soft-required",o,{missingPlugin:N,requiredBy:f(B)}):new p("plugincollection-plugin-not-found",o,{plugin:N})}function R(N,B){if(!!u(B)&&!u(N))throw new p("plugincollection-context-required",o,{plugin:f(N),requiredBy:f(B)})}function O(N,B){if(!!B&&!!d(N,t))throw new p("plugincollection-required",o,{plugin:f(N),requiredBy:f(B)})}function U(N){return N.map(B=>{const D=s._contextPlugins.get(B)||new B(o);return s._add(B,D),D})}function Q(N,B){return N.reduce((D,X)=>!X[B]||s._contextPlugins.has(X)?D:D.then(X[B].bind(X)),Promise.resolve())}function se(N,B){for(const D of B){if(typeof D!="function")throw new p("plugincollection-replace-plugin-invalid-type",null,{pluginItem:D});const X=D.pluginName;if(!X)throw new p("plugincollection-replace-plugin-missing-name",null,{pluginItem:D});if(D.requires&&D.requires.length)throw new p("plugincollection-plugin-for-replacing-cannot-have-dependencies",null,{pluginName:X});const bt=s._availablePlugins.get(X);if(!bt)throw new p("plugincollection-plugin-for-replacing-not-exist",null,{pluginName:X});const qn=N.indexOf(bt);if(qn===-1){if(s._contextPlugins.has(bt))return;throw new p("plugincollection-plugin-for-replacing-not-loaded",null,{pluginName:X})}if(bt.requires&&bt.requires.length)throw new p("plugincollection-replaced-plugin-cannot-have-dependencies",null,{pluginName:X});N.splice(qn,1,D),s._availablePlugins.set(X,D)}}}destroy(){const e=[];for(const[,t]of this)typeof t.destroy=="function"&&!this._contextPlugins.has(t)&&e.push(t.destroy());return Promise.all(e)}_add(e,t){this._plugins.set(e,t);const n=e.pluginName;if(!!n){if(this._plugins.has(n))throw new p("plugincollection-plugin-name-conflict",null,{pluginName:n,plugin1:this._plugins.get(n).constructor,plugin2:e});this._plugins.set(n,t)}}}F(co,oe);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Ee(i){return Array.isArray(i)?i:[i]}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */window.CKEDITOR_TRANSLATIONS||(window.CKEDITOR_TRANSLATIONS={});function v1(i,e,t=1){if(typeof t!="number")throw new p("translation-service-quantity-not-a-number",null,{quantity:t});const n=C1();n===1&&(i=Object.keys(window.CKEDITOR_TRANSLATIONS)[0]);const s=e.id||e.string;if(n===0||!y1(i,s))return t!==1?e.plural:e.string;const o=window.CKEDITOR_TRANSLATIONS[i].dictionary,r=window.CKEDITOR_TRANSLATIONS[i].getPluralForm||(l=>l===1?0:1);if(typeof o[s]=="string")return o[s];const a=Number(r(t));return o[s][a]}function y1(i,e){return!!window.CKEDITOR_TRANSLATIONS[i]&&!!window.CKEDITOR_TRANSLATIONS[i].dictionary[e]}function C1(){return Object.keys(window.CKEDITOR_TRANSLATIONS).length}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const k1=["ar","ara","fa","per","fas","he","heb","ku","kur","ug","uig"];function ec(i){return k1.includes(i)?"rtl":"ltr"}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class T1{constructor(e={}){this.uiLanguage=e.uiLanguage||"en",this.contentLanguage=e.contentLanguage||this.uiLanguage,this.uiLanguageDirection=ec(this.uiLanguage),this.contentLanguageDirection=ec(this.contentLanguage),this.t=(t,n)=>this._t(t,n)}get language(){return console.warn("locale-deprecated-language-property: The Locale#language property has been deprecated and will be removed in the near future. Please use #uiLanguage and #contentLanguage properties instead."),this.uiLanguage}_t(e,t=[]){t=Ee(t),typeof e=="string"&&(e={string:e});const s=!!e.plural?t[0]:1,o=v1(this.uiLanguage,e,s);return E1(o,t)}}function E1(i,e){return i.replace(/%(\d+)/g,(t,n)=>n<e.length?e[n]:t)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class A1{constructor(e){this.config=new Xl(e,this.constructor.defaultConfig);const t=this.constructor.builtinPlugins;this.config.define("plugins",t),this.plugins=new co(this,t);const n=this.config.get("language")||{};this.locale=new T1({uiLanguage:typeof n=="string"?n:n.ui,contentLanguage:this.config.get("language.content")}),this.t=this.locale.t,this.editors=new $e,this._contextOwner=null}initPlugins(){const e=this.config.get("plugins")||[],t=this.config.get("substitutePlugins")||[];for(const n of e.concat(t)){if(typeof n!="function")throw new p("context-initplugins-constructor-only",null,{Plugin:n});if(n.isContextPlugin!==!0)throw new p("context-initplugins-invalid-plugin",null,{Plugin:n})}return this.plugins.init(e,[],t)}destroy(){return Promise.all(Array.from(this.editors,e=>e.destroy())).then(()=>this.plugins.destroy())}_addEditor(e,t){if(this._contextOwner)throw new p("context-addeditor-private-context");this.editors.add(e),t&&(this._contextOwner=e)}_removeEditor(e){return this.editors.has(e)&&this.editors.remove(e),this._contextOwner===e?this.destroy():Promise.resolve()}_getEditorConfig(){const e={};for(const t of this.config.names())["plugins","removePlugins","extraPlugins"].includes(t)||(e[t]=this.config.get(t));return e}static create(e){return new Promise(t=>{const n=new this(e);t(n.initPlugins().then(()=>n))})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class oi{constructor(e){this.context=e}destroy(){this.stopListening()}static get isContextPlugin(){return!0}}F(oi,re);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Me(i,e){const t=Math.min(i.length,e.length);for(let n=0;n<t;n++)if(i[n]!=e[n])return n;return i.length==e.length?"same":i.length<e.length?"prefix":"extension"}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Xt{constructor(e){this.document=e,this.parent=null}get index(){let e;if(!this.parent)return null;if((e=this.parent.getChildIndex(this))==-1)throw new p("view-node-not-found-in-parent",this);return e}get nextSibling(){const e=this.index;return e!==null&&this.parent.getChild(e+1)||null}get previousSibling(){const e=this.index;return e!==null&&this.parent.getChild(e-1)||null}get root(){let e=this;for(;e.parent;)e=e.parent;return e}isAttached(){return this.root.is("rootElement")}getPath(){const e=[];let t=this;for(;t.parent;)e.unshift(t.index),t=t.parent;return e}getAncestors(e={includeSelf:!1,parentFirst:!1}){const t=[];let n=e.includeSelf?this:this.parent;for(;n;)t[e.parentFirst?"push":"unshift"](n),n=n.parent;return t}getCommonAncestor(e,t={}){const n=this.getAncestors(t),s=e.getAncestors(t);let o=0;for(;n[o]==s[o]&&n[o];)o++;return o===0?null:n[o-1]}isBefore(e){if(this==e||this.root!==e.root)return!1;const t=this.getPath(),n=e.getPath(),s=Me(t,n);switch(s){case"prefix":return!0;case"extension":return!1;default:return t[s]<n[s]}}isAfter(e){return this==e||this.root!==e.root?!1:!this.isBefore(e)}_remove(){this.parent._removeChildren(this.index)}_fireChange(e,t){this.fire("change:"+e,t),this.parent&&this.parent._fireChange(e,t)}toJSON(){const e=Ml(this);return delete e.parent,e}is(e){return e==="node"||e==="view:node"}}F(Xt,oe);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ce extends Xt{constructor(e,t){super(e);this._textData=t}is(e){return e==="$text"||e==="view:$text"||e==="text"||e==="view:text"||e==="node"||e==="view:node"}get data(){return this._textData}get _data(){return this.data}set _data(e){this._fireChange("text",this),this._textData=e}isSimilar(e){return e instanceof ce?this===e||this.data===e.data:!1}_clone(){return new ce(this.document,this.data)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class kt{constructor(e,t,n){if(this.textNode=e,t<0||t>e.data.length)throw new p("view-textproxy-wrong-offsetintext",this);if(n<0||t+n>e.data.length)throw new p("view-textproxy-wrong-length",this);this.data=e.data.substring(t,t+n),this.offsetInText=t}get offsetSize(){return this.data.length}get isPartial(){return this.data.length!==this.textNode.data.length}get parent(){return this.textNode.parent}get root(){return this.textNode.root}get document(){return this.textNode.document}is(e){return e==="$textProxy"||e==="view:$textProxy"||e==="textProxy"||e==="view:textProxy"}getAncestors(e={includeSelf:!1,parentFirst:!1}){const t=[];let n=e.includeSelf?this.textNode:this.parent;for(;n!==null;)t[e.parentFirst?"push":"unshift"](n),n=n.parent;return t}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function S1(i){const e=new Map;for(const t in i)e.set(t,i[t]);return e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Tt(i){return Ke(i)?new Map(i):S1(i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ut{constructor(...e){this._patterns=[],this.add(...e)}add(...e){for(let t of e)(typeof t=="string"||t instanceof RegExp)&&(t={name:t}),this._patterns.push(t)}match(...e){for(const t of e)for(const n of this._patterns){const s=tc(t,n);if(s)return{element:t,pattern:n,match:s}}return null}matchAll(...e){const t=[];for(const n of e)for(const s of this._patterns){const o=tc(n,s);o&&t.push({element:n,pattern:s,match:o})}return t.length>0?t:null}getElementName(){if(this._patterns.length!==1)return null;const e=this._patterns[0],t=e.name;return typeof e!="function"&&t&&!(t instanceof RegExp)?t:null}}function tc(i,e){if(typeof e=="function")return e(i);const t={};return e.name&&(t.name=x1(e.name,i.name),!t.name)||e.attributes&&(t.attributes=M1(e.attributes,i),!t.attributes)?null:e.classes&&(t.classes=V1(e.classes,i),!t.classes)||e.styles&&(t.styles=O1(e.styles,i),!t.styles)?!1:t}function x1(i,e){return i instanceof RegExp?!!e.match(i):i===e}function uo(i,e,t){const n=P1(i),s=Array.from(e),o=[];return n.forEach(([r,a])=>{s.forEach(l=>{I1(r,l)&&R1(a,l,t)&&o.push(l)})}),!n.length||o.length<n.length?null:o}function P1(i){return Array.isArray(i)?i.map(e=>je(e)?((e.key===void 0||e.value===void 0)&&Re("matcher-pattern-missing-key-or-value",e),[e.key,e.value]):[e,!0]):je(i)?Object.entries(i):[[i,!0]]}function I1(i,e){return i===!0||i===e||i instanceof RegExp&&e.match(i)}function R1(i,e,t){if(i===!0)return!0;const n=t(e);return i===n||i instanceof RegExp&&!!String(n).match(i)}function M1(i,e){const t=new Set(e.getAttributeKeys());return je(i)?(i.style!==void 0&&Re("matcher-pattern-deprecated-attributes-style-key",i),i.class!==void 0&&Re("matcher-pattern-deprecated-attributes-class-key",i)):(t.delete("style"),t.delete("class")),uo(i,t,n=>e.getAttribute(n))}function V1(i,e){return uo(i,e.getClassNames())}function O1(i,e){return uo(i,e.getStyleNames(!0),t=>e.getStyle(t))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class N1{constructor(e){this._styles={},this._styleProcessor=e}get isEmpty(){const e=Object.entries(this._styles);return!Array.from(e).length}get size(){return this.isEmpty?0:this.getStyleNames().length}setTo(e){this.clear();const t=Array.from(B1(e).entries());for(const[n,s]of t)this._styleProcessor.toNormalizedForm(n,s,this._styles)}has(e){if(this.isEmpty)return!1;const n=this._styleProcessor.getReducedForm(e,this._styles).find(([s])=>s===e);return Array.isArray(n)}set(e,t){if(be(e))for(const[n,s]of Object.entries(e))this._styleProcessor.toNormalizedForm(n,s,this._styles);else this._styleProcessor.toNormalizedForm(e,t,this._styles)}remove(e){const t=ho(e);d1(this._styles,t),delete this._styles[e],this._cleanEmptyObjectsOnPath(t)}getNormalized(e){return this._styleProcessor.getNormalized(e,this._styles)}toString(){return this.isEmpty?"":this._getStylesEntries().map(e=>e.join(":")).sort().join(";")+";"}getAsString(e){if(this.isEmpty)return;if(this._styles[e]&&!be(this._styles[e]))return this._styles[e];const n=this._styleProcessor.getReducedForm(e,this._styles).find(([s])=>s===e);if(Array.isArray(n))return n[1]}getStyleNames(e=!1){return this.isEmpty?[]:e?this._styleProcessor.getStyleNames(this._styles):this._getStylesEntries().map(([n])=>n)}clear(){this._styles={}}_getStylesEntries(){const e=[],t=Object.keys(this._styles);for(const n of t)e.push(...this._styleProcessor.getReducedForm(n,this._styles));return e}_cleanEmptyObjectsOnPath(e){const t=e.split(".");if(!(t.length>1))return;const s=t.splice(0,t.length-1).join("."),o=Ii(this._styles,s);if(!o)return;!Array.from(Object.keys(o)).length&&this.remove(s)}}class D1{constructor(){this._normalizers=new Map,this._extractors=new Map,this._reducers=new Map,this._consumables=new Map}toNormalizedForm(e,t,n){if(be(t)){fo(n,ho(e),t);return}if(this._normalizers.has(e)){const s=this._normalizers.get(e),{path:o,value:r}=s(t);fo(n,o,r)}else fo(n,e,t)}getNormalized(e,t){if(!e)return Ul({},t);if(t[e]!==void 0)return t[e];if(this._extractors.has(e)){const n=this._extractors.get(e);if(typeof n=="string")return Ii(t,n);const s=n(e,t);if(s)return s}return Ii(t,ho(e))}getReducedForm(e,t){const n=this.getNormalized(e,t);return n===void 0?[]:this._reducers.has(e)?this._reducers.get(e)(n):[[e,n]]}getStyleNames(e){const t=Array.from(this._consumables.keys()).filter(s=>{const o=this.getNormalized(s,e);return o&&typeof o=="object"?Object.keys(o).length:o}),n=new Set([...t,...Object.keys(e)]);return Array.from(n.values())}getRelatedStyles(e){return this._consumables.get(e)||[]}setNormalizer(e,t){this._normalizers.set(e,t)}setExtractor(e,t){this._extractors.set(e,t)}setReducer(e,t){this._reducers.set(e,t)}setStyleRelation(e,t){this._mapStyleNames(e,t);for(const n of t)this._mapStyleNames(n,[e])}_mapStyleNames(e,t){this._consumables.has(e)||this._consumables.set(e,[]),this._consumables.get(e).push(...t)}}function B1(i){let e=null,t=0,n=0,s=null;const o=new Map;if(i==="")return o;i.charAt(i.length-1)!=";"&&(i=i+";");for(let r=0;r<i.length;r++){const a=i.charAt(r);if(e===null)switch(a){case":":s||(s=i.substr(t,r-t),n=r+1);break;case'"':case"'":e=a;break;case";":{const l=i.substr(n,r-n);s&&o.set(s.trim(),l.trim()),s=null,t=r+1;break}}else a===e&&(e=null)}return o}function ho(i){return i.replace("-",".")}function fo(i,e,t){let n=t;be(t)&&(n=Ul({},Ii(i,e),t)),c1(i,e,n)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ge extends Xt{constructor(e,t,n,s){super(e);if(this.name=t,this._attrs=F1(n),this._children=[],s&&this._insertChild(0,s),this._classes=new Set,this._attrs.has("class")){const o=this._attrs.get("class");nc(this._classes,o),this._attrs.delete("class")}this._styles=new N1(this.document.stylesProcessor),this._attrs.has("style")&&(this._styles.setTo(this._attrs.get("style")),this._attrs.delete("style")),this._customProperties=new Map,this._isAllowedInsideAttributeElement=!1,this._unsafeAttributesToRender=[]}get childCount(){return this._children.length}get isEmpty(){return this._children.length===0}get isAllowedInsideAttributeElement(){return this._isAllowedInsideAttributeElement}is(e,t=null){return t?t===this.name&&(e==="element"||e==="view:element"):e==="element"||e==="view:element"||e==="node"||e==="view:node"}getChild(e){return this._children[e]}getChildIndex(e){return this._children.indexOf(e)}getChildren(){return this._children[Symbol.iterator]()}*getAttributeKeys(){this._classes.size>0&&(yield"class"),this._styles.isEmpty||(yield"style"),yield*this._attrs.keys()}*getAttributes(){yield*this._attrs.entries(),this._classes.size>0&&(yield["class",this.getAttribute("class")]),this._styles.isEmpty||(yield["style",this.getAttribute("style")])}getAttribute(e){if(e=="class")return this._classes.size>0?[...this._classes].join(" "):void 0;if(e=="style"){const t=this._styles.toString();return t==""?void 0:t}return this._attrs.get(e)}hasAttribute(e){return e=="class"?this._classes.size>0:e=="style"?!this._styles.isEmpty:this._attrs.has(e)}isSimilar(e){if(!(e instanceof Ge))return!1;if(this===e)return!0;if(this.name!=e.name||this.isAllowedInsideAttributeElement!=e.isAllowedInsideAttributeElement||this._attrs.size!==e._attrs.size||this._classes.size!==e._classes.size||this._styles.size!==e._styles.size)return!1;for(const[t,n]of this._attrs)if(!e._attrs.has(t)||e._attrs.get(t)!==n)return!1;for(const t of this._classes)if(!e._classes.has(t))return!1;for(const t of this._styles.getStyleNames())if(!e._styles.has(t)||e._styles.getAsString(t)!==this._styles.getAsString(t))return!1;return!0}hasClass(...e){for(const t of e)if(!this._classes.has(t))return!1;return!0}getClassNames(){return this._classes.keys()}getStyle(e){return this._styles.getAsString(e)}getNormalizedStyle(e){return this._styles.getNormalized(e)}getStyleNames(e=!1){return this._styles.getStyleNames(e)}hasStyle(...e){for(const t of e)if(!this._styles.has(t))return!1;return!0}findAncestor(...e){const t=new ut(...e);let n=this.parent;for(;n;){if(t.match(n))return n;n=n.parent}return null}getCustomProperty(e){return this._customProperties.get(e)}*getCustomProperties(){yield*this._customProperties.entries()}getIdentity(){const e=Array.from(this._classes).sort().join(","),t=this._styles.toString(),n=Array.from(this._attrs).map(s=>`${s[0]}="${s[1]}"`).sort().join(" ");return this.name+(e==""?"":` class="${e}"`)+(t?` style="${t}"`:"")+(n==""?"":` ${n}`)}shouldRenderUnsafeAttribute(e){return this._unsafeAttributesToRender.includes(e)}_clone(e=!1){const t=[];if(e)for(const s of this.getChildren())t.push(s._clone(e));const n=new this.constructor(this.document,this.name,this._attrs,t);return n._classes=new Set(this._classes),n._styles.set(this._styles.getNormalized()),n._customProperties=new Map(this._customProperties),n.getFillerOffset=this.getFillerOffset,n._isAllowedInsideAttributeElement=this.isAllowedInsideAttributeElement,n}_appendChild(e){return this._insertChild(this.childCount,e)}_insertChild(e,t){this._fireChange("children",this);let n=0;const s=L1(this.document,t);for(const o of s)o.parent!==null&&o._remove(),o.parent=this,o.document=this.document,this._children.splice(e,0,o),e++,n++;return n}_removeChildren(e,t=1){this._fireChange("children",this);for(let n=e;n<e+t;n++)this._children[n].parent=null;return this._children.splice(e,t)}_setAttribute(e,t){t=String(t),this._fireChange("attributes",this),e=="class"?nc(this._classes,t):e=="style"?this._styles.setTo(t):this._attrs.set(e,t)}_removeAttribute(e){return this._fireChange("attributes",this),e=="class"?this._classes.size>0?(this._classes.clear(),!0):!1:e=="style"?this._styles.isEmpty?!1:(this._styles.clear(),!0):this._attrs.delete(e)}_addClass(e){this._fireChange("attributes",this);for(const t of Ee(e))this._classes.add(t)}_removeClass(e){this._fireChange("attributes",this);for(const t of Ee(e))this._classes.delete(t)}_setStyle(e,t){this._fireChange("attributes",this),this._styles.set(e,t)}_removeStyle(e){this._fireChange("attributes",this);for(const t of Ee(e))this._styles.remove(t)}_setCustomProperty(e,t){this._customProperties.set(e,t)}_removeCustomProperty(e){return this._customProperties.delete(e)}}function F1(i){i=Tt(i);for(const[e,t]of i)t===null?i.delete(e):typeof t!="string"&&i.set(e,String(t));return i}function nc(i,e){const t=e.split(/\s+/);i.clear(),t.forEach(n=>i.add(n))}function L1(i,e){return typeof e=="string"?[new ce(i,e)]:(Ke(e)||(e=[e]),Array.from(e).map(t=>typeof t=="string"?new ce(i,t):t instanceof kt?new ce(i,t.data):t))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Fi extends Ge{constructor(e,t,n,s){super(e,t,n,s);this.getFillerOffset=ic}is(e,t=null){return t?t===this.name&&(e==="containerElement"||e==="view:containerElement"||e==="element"||e==="view:element"):e==="containerElement"||e==="view:containerElement"||e==="element"||e==="view:element"||e==="node"||e==="view:node"}}function ic(){const i=[...this.getChildren()],e=i[this.childCount-1];if(e&&e.is("element","br"))return this.childCount;for(const t of i)if(!t.is("uiElement"))return null;return this.childCount}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Li extends Fi{constructor(e,t,n,s){super(e,t,n,s);this.set("isReadOnly",!1),this.set("isFocused",!1),this.bind("isReadOnly").to(e),this.bind("isFocused").to(e,"isFocused",o=>o&&e.selection.editableElement==this),this.listenTo(e.selection,"change",()=>{this.isFocused=e.isFocused&&e.selection.editableElement==this})}is(e,t=null){return t?t===this.name&&(e==="editableElement"||e==="view:editableElement"||e==="containerElement"||e==="view:containerElement"||e==="element"||e==="view:element"):e==="editableElement"||e==="view:editableElement"||e==="containerElement"||e==="view:containerElement"||e==="element"||e==="view:element"||e==="node"||e==="view:node"}destroy(){this.stopListening()}}F(Li,re);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const sc=Symbol("rootName");class z1 extends Li{constructor(e,t){super(e,t);this.rootName="main"}is(e,t=null){return t?t===this.name&&(e==="rootElement"||e==="view:rootElement"||e==="editableElement"||e==="view:editableElement"||e==="containerElement"||e==="view:containerElement"||e==="element"||e==="view:element"):e==="rootElement"||e==="view:rootElement"||e==="editableElement"||e==="view:editableElement"||e==="containerElement"||e==="view:containerElement"||e==="element"||e==="view:element"||e==="node"||e==="view:node"}get rootName(){return this.getCustomProperty(sc)}set rootName(e){this._setCustomProperty(sc,e)}set _name(e){this.name=e}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Zt{constructor(e={}){if(!e.boundaries&&!e.startPosition)throw new p("view-tree-walker-no-start-position",null);if(e.direction&&e.direction!="forward"&&e.direction!="backward")throw new p("view-tree-walker-unknown-direction",e.startPosition,{direction:e.direction});this.boundaries=e.boundaries||null,e.startPosition?this.position=I._createAt(e.startPosition):this.position=I._createAt(e.boundaries[e.direction=="backward"?"end":"start"]),this.direction=e.direction||"forward",this.singleCharacters=!!e.singleCharacters,this.shallow=!!e.shallow,this.ignoreElementEnd=!!e.ignoreElementEnd,this._boundaryStartParent=this.boundaries?this.boundaries.start.parent:null,this._boundaryEndParent=this.boundaries?this.boundaries.end.parent:null}[Symbol.iterator](){return this}skip(e){let t,n,s;do s=this.position,{done:t,value:n}=this.next();while(!t&&e(n));t||(this.position=s)}next(){return this.direction=="forward"?this._next():this._previous()}_next(){let e=this.position.clone();const t=this.position,n=e.parent;if(n.parent===null&&e.offset===n.childCount)return{done:!0};if(n===this._boundaryEndParent&&e.offset==this.boundaries.end.offset)return{done:!0};let s;if(n instanceof ce){if(e.isAtEnd)return this.position=I._createAfter(n),this._next();s=n.data[e.offset]}else s=n.getChild(e.offset);if(s instanceof Ge)return this.shallow?e.offset++:e=new I(s,0),this.position=e,this._formatReturnValue("elementStart",s,t,e,1);if(s instanceof ce){if(this.singleCharacters)return e=new I(s,0),this.position=e,this._next();{let o=s.data.length,r;return s==this._boundaryEndParent?(o=this.boundaries.end.offset,r=new kt(s,0,o),e=I._createAfter(r)):(r=new kt(s,0,s.data.length),e.offset++),this.position=e,this._formatReturnValue("text",r,t,e,o)}}else if(typeof s=="string"){let o;this.singleCharacters?o=1:o=(n===this._boundaryEndParent?this.boundaries.end.offset:n.data.length)-e.offset;const r=new kt(n,e.offset,o);return e.offset+=o,this.position=e,this._formatReturnValue("text",r,t,e,o)}else return e=I._createAfter(n),this.position=e,this.ignoreElementEnd?this._next():this._formatReturnValue("elementEnd",n,t,e)}_previous(){let e=this.position.clone();const t=this.position,n=e.parent;if(n.parent===null&&e.offset===0)return{done:!0};if(n==this._boundaryStartParent&&e.offset==this.boundaries.start.offset)return{done:!0};let s;if(n instanceof ce){if(e.isAtStart)return this.position=I._createBefore(n),this._previous();s=n.data[e.offset-1]}else s=n.getChild(e.offset-1);if(s instanceof Ge)return this.shallow?(e.offset--,this.position=e,this._formatReturnValue("elementStart",s,t,e,1)):(e=new I(s,s.childCount),this.position=e,this.ignoreElementEnd?this._previous():this._formatReturnValue("elementEnd",s,t,e));if(s instanceof ce){if(this.singleCharacters)return e=new I(s,s.data.length),this.position=e,this._previous();{let o=s.data.length,r;if(s==this._boundaryStartParent){const a=this.boundaries.start.offset;r=new kt(s,a,s.data.length-a),o=r.data.length,e=I._createBefore(r)}else r=new kt(s,0,s.data.length),e.offset--;return this.position=e,this._formatReturnValue("text",r,t,e,o)}}else if(typeof s=="string"){let o;if(this.singleCharacters)o=1;else{const a=n===this._boundaryStartParent?this.boundaries.start.offset:0;o=e.offset-a}e.offset-=o;const r=new kt(n,e.offset,o);return this.position=e,this._formatReturnValue("text",r,t,e,o)}else return e=I._createBefore(n),this.position=e,this._formatReturnValue("elementStart",n,t,e,1)}_formatReturnValue(e,t,n,s,o){return t instanceof kt&&(t.offsetInText+t.data.length==t.textNode.data.length&&(this.direction=="forward"&&!(this.boundaries&&this.boundaries.end.isEqual(this.position))?(s=I._createAfter(t.textNode),this.position=s):n=I._createAfter(t.textNode)),t.offsetInText===0&&(this.direction=="backward"&&!(this.boundaries&&this.boundaries.start.isEqual(this.position))?(s=I._createBefore(t.textNode),this.position=s):n=I._createBefore(t.textNode))),{done:!1,value:{type:e,item:t,previousPosition:n,nextPosition:s,length:o}}}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class I{constructor(e,t){this.parent=e,this.offset=t}get nodeAfter(){return this.parent.is("$text")?null:this.parent.getChild(this.offset)||null}get nodeBefore(){return this.parent.is("$text")?null:this.parent.getChild(this.offset-1)||null}get isAtStart(){return this.offset===0}get isAtEnd(){const e=this.parent.is("$text")?this.parent.data.length:this.parent.childCount;return this.offset===e}get root(){return this.parent.root}get editableElement(){let e=this.parent;for(;!(e instanceof Li);)if(e.parent)e=e.parent;else return null;return e}getShiftedBy(e){const t=I._createAt(this),n=t.offset+e;return t.offset=n<0?0:n,t}getLastMatchingPosition(e,t={}){t.startPosition=this;const n=new Zt(t);return n.skip(e),n.position}getAncestors(){return this.parent.is("documentFragment")?[this.parent]:this.parent.getAncestors({includeSelf:!0})}getCommonAncestor(e){const t=this.getAncestors(),n=e.getAncestors();let s=0;for(;t[s]==n[s]&&t[s];)s++;return s===0?null:t[s-1]}is(e){return e==="position"||e==="view:position"}isEqual(e){return this.parent==e.parent&&this.offset==e.offset}isBefore(e){return this.compareWith(e)=="before"}isAfter(e){return this.compareWith(e)=="after"}compareWith(e){if(this.root!==e.root)return"different";if(this.isEqual(e))return"same";const t=this.parent.is("node")?this.parent.getPath():[],n=e.parent.is("node")?e.parent.getPath():[];t.push(this.offset),n.push(e.offset);const s=Me(t,n);switch(s){case"prefix":return"before";case"extension":return"after";default:return t[s]<n[s]?"before":"after"}}getWalker(e={}){return e.startPosition=this,new Zt(e)}clone(){return new I(this.parent,this.offset)}static _createAt(e,t){if(e instanceof I)return new this(e.parent,e.offset);{const n=e;if(t=="end")t=n.is("$text")?n.data.length:n.childCount;else{if(t=="before")return this._createBefore(n);if(t=="after")return this._createAfter(n);if(t!==0&&!t)throw new p("view-createpositionat-offset-required",n)}return new I(n,t)}}static _createAfter(e){if(e.is("$textProxy"))return new I(e.textNode,e.offsetInText+e.data.length);if(!e.parent)throw new p("view-position-after-root",e,{root:e});return new I(e.parent,e.index+1)}static _createBefore(e){if(e.is("$textProxy"))return new I(e.textNode,e.offsetInText);if(!e.parent)throw new p("view-position-before-root",e,{root:e});return new I(e.parent,e.index)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class z{constructor(e,t=null){this.start=e.clone(),this.end=t?t.clone():e.clone()}*[Symbol.iterator](){yield*new Zt({boundaries:this,ignoreElementEnd:!0})}get isCollapsed(){return this.start.isEqual(this.end)}get isFlat(){return this.start.parent===this.end.parent}get root(){return this.start.root}getEnlarged(){let e=this.start.getLastMatchingPosition(zi,{direction:"backward"}),t=this.end.getLastMatchingPosition(zi);return e.parent.is("$text")&&e.isAtStart&&(e=I._createBefore(e.parent)),t.parent.is("$text")&&t.isAtEnd&&(t=I._createAfter(t.parent)),new z(e,t)}getTrimmed(){let e=this.start.getLastMatchingPosition(zi);if(e.isAfter(this.end)||e.isEqual(this.end))return new z(e,e);let t=this.end.getLastMatchingPosition(zi,{direction:"backward"});const n=e.nodeAfter,s=t.nodeBefore;return n&&n.is("$text")&&(e=new I(n,0)),s&&s.is("$text")&&(t=new I(s,s.data.length)),new z(e,t)}isEqual(e){return this==e||this.start.isEqual(e.start)&&this.end.isEqual(e.end)}containsPosition(e){return e.isAfter(this.start)&&e.isBefore(this.end)}containsRange(e,t=!1){e.isCollapsed&&(t=!1);const n=this.containsPosition(e.start)||t&&this.start.isEqual(e.start),s=this.containsPosition(e.end)||t&&this.end.isEqual(e.end);return n&&s}getDifference(e){const t=[];return this.isIntersecting(e)?(this.containsPosition(e.start)&&t.push(new z(this.start,e.start)),this.containsPosition(e.end)&&t.push(new z(e.end,this.end))):t.push(this.clone()),t}getIntersection(e){if(this.isIntersecting(e)){let t=this.start,n=this.end;return this.containsPosition(e.start)&&(t=e.start),this.containsPosition(e.end)&&(n=e.end),new z(t,n)}return null}getWalker(e={}){return e.boundaries=this,new Zt(e)}getCommonAncestor(){return this.start.getCommonAncestor(this.end)}getContainedElement(){if(this.isCollapsed)return null;let e=this.start.nodeAfter,t=this.end.nodeBefore;return this.start.parent.is("$text")&&this.start.isAtEnd&&this.start.parent.nextSibling&&(e=this.start.parent.nextSibling),this.end.parent.is("$text")&&this.end.isAtStart&&this.end.parent.previousSibling&&(t=this.end.parent.previousSibling),e&&e.is("element")&&e===t?e:null}clone(){return new z(this.start,this.end)}*getItems(e={}){e.boundaries=this,e.ignoreElementEnd=!0;const t=new Zt(e);for(const n of t)yield n.item}*getPositions(e={}){e.boundaries=this;const t=new Zt(e);yield t.position;for(const n of t)yield n.nextPosition}is(e){return e==="range"||e==="view:range"}isIntersecting(e){return this.start.isBefore(e.end)&&this.end.isAfter(e.start)}static _createFromParentsAndOffsets(e,t,n,s){return new this(new I(e,t),new I(n,s))}static _createFromPositionAndShift(e,t){const n=e,s=e.getShiftedBy(t);return t>0?new this(n,s):new this(s,n)}static _createIn(e){return this._createFromParentsAndOffsets(e,0,e,e.childCount)}static _createOn(e){const t=e.is("$textProxy")?e.offsetSize:1;return this._createFromPositionAndShift(I._createBefore(e),t)}}function zi(i){return!!(i.item.is("attributeElement")||i.item.is("uiElement"))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function mo(i){let e=0;for(const t of i)e++;return e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class et{constructor(e=null,t,n){this._ranges=[],this._lastRangeBackward=!1,this._isFake=!1,this._fakeSelectionLabel="",this.setTo(e,t,n)}get isFake(){return this._isFake}get fakeSelectionLabel(){return this._fakeSelectionLabel}get anchor(){if(!this._ranges.length)return null;const e=this._ranges[this._ranges.length-1];return(this._lastRangeBackward?e.end:e.start).clone()}get focus(){if(!this._ranges.length)return null;const e=this._ranges[this._ranges.length-1];return(this._lastRangeBackward?e.start:e.end).clone()}get isCollapsed(){return this.rangeCount===1&&this._ranges[0].isCollapsed}get rangeCount(){return this._ranges.length}get isBackward(){return!this.isCollapsed&&this._lastRangeBackward}get editableElement(){return this.anchor?this.anchor.editableElement:null}*getRanges(){for(const e of this._ranges)yield e.clone()}getFirstRange(){let e=null;for(const t of this._ranges)(!e||t.start.isBefore(e.start))&&(e=t);return e?e.clone():null}getLastRange(){let e=null;for(const t of this._ranges)(!e||t.end.isAfter(e.end))&&(e=t);return e?e.clone():null}getFirstPosition(){const e=this.getFirstRange();return e?e.start.clone():null}getLastPosition(){const e=this.getLastRange();return e?e.end.clone():null}isEqual(e){if(this.isFake!=e.isFake||this.isFake&&this.fakeSelectionLabel!=e.fakeSelectionLabel||this.rangeCount!=e.rangeCount)return!1;if(this.rangeCount===0)return!0;if(!this.anchor.isEqual(e.anchor)||!this.focus.isEqual(e.focus))return!1;for(const t of this._ranges){let n=!1;for(const s of e._ranges)if(t.isEqual(s)){n=!0;break}if(!n)return!1}return!0}isSimilar(e){if(this.isBackward!=e.isBackward)return!1;const t=mo(this.getRanges()),n=mo(e.getRanges());if(t!=n)return!1;if(t==0)return!0;for(let s of this.getRanges()){s=s.getTrimmed();let o=!1;for(let r of e.getRanges())if(r=r.getTrimmed(),s.start.isEqual(r.start)&&s.end.isEqual(r.end)){o=!0;break}if(!o)return!1}return!0}getSelectedElement(){return this.rangeCount!==1?null:this.getFirstRange().getContainedElement()}setTo(e,t,n){if(e===null)this._setRanges([]),this._setFakeOptions(t);else if(e instanceof et||e instanceof go)this._setRanges(e.getRanges(),e.isBackward),this._setFakeOptions({fake:e.isFake,label:e.fakeSelectionLabel});else if(e instanceof z)this._setRanges([e],t&&t.backward),this._setFakeOptions(t);else if(e instanceof I)this._setRanges([new z(e)]),this._setFakeOptions(t);else if(e instanceof Xt){const s=!!n&&!!n.backward;let o;if(t===void 0)throw new p("view-selection-setto-required-second-parameter",this);t=="in"?o=z._createIn(e):t=="on"?o=z._createOn(e):o=new z(I._createAt(e,t)),this._setRanges([o],s),this._setFakeOptions(n)}else if(Ke(e))this._setRanges(e,t&&t.backward),this._setFakeOptions(t);else throw new p("view-selection-setto-not-selectable",this);this.fire("change")}setFocus(e,t){if(this.anchor===null)throw new p("view-selection-setfocus-no-ranges",this);const n=I._createAt(e,t);if(n.compareWith(this.focus)=="same")return;const s=this.anchor;this._ranges.pop(),n.compareWith(s)=="before"?this._addRange(new z(n,s),!0):this._addRange(new z(s,n)),this.fire("change")}is(e){return e==="selection"||e==="view:selection"}_setRanges(e,t=!1){e=Array.from(e),this._ranges=[];for(const n of e)this._addRange(n);this._lastRangeBackward=!!t}_setFakeOptions(e={}){this._isFake=!!e.fake,this._fakeSelectionLabel=e.fake&&e.label||""}_addRange(e,t=!1){if(!(e instanceof z))throw new p("view-selection-add-range-not-range",this);this._pushRange(e),this._lastRangeBackward=!!t}_pushRange(e){for(const t of this._ranges)if(e.isIntersecting(t))throw new p("view-selection-range-intersects",this,{addedRange:e,intersectingRange:t});this._ranges.push(new z(e.start,e.end))}}F(et,oe);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class go{constructor(e=null,t,n){this._selection=new et,this._selection.delegate("change").to(this),this._selection.setTo(e,t,n)}get isFake(){return this._selection.isFake}get fakeSelectionLabel(){return this._selection.fakeSelectionLabel}get anchor(){return this._selection.anchor}get focus(){return this._selection.focus}get isCollapsed(){return this._selection.isCollapsed}get rangeCount(){return this._selection.rangeCount}get isBackward(){return this._selection.isBackward}get editableElement(){return this._selection.editableElement}get _ranges(){return this._selection._ranges}*getRanges(){yield*this._selection.getRanges()}getFirstRange(){return this._selection.getFirstRange()}getLastRange(){return this._selection.getLastRange()}getFirstPosition(){return this._selection.getFirstPosition()}getLastPosition(){return this._selection.getLastPosition()}getSelectedElement(){return this._selection.getSelectedElement()}isEqual(e){return this._selection.isEqual(e)}isSimilar(e){return this._selection.isSimilar(e)}is(e){return e==="selection"||e=="documentSelection"||e=="view:selection"||e=="view:documentSelection"}_setTo(e,t,n){this._selection.setTo(e,t,n)}_setFocus(e,t){this._selection.setFocus(e,t)}}F(go,oe);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class $i extends Ot{constructor(e,t,n){super(e,t);this.startRange=n,this._eventPhase="none",this._currentTarget=null}get eventPhase(){return this._eventPhase}get currentTarget(){return this._currentTarget}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const po=Symbol("bubbling contexts"),$1={fire(i,...e){try{const t=i instanceof Ot?i:new Ot(this,i),n=wo(this);if(!n.size)return;if(ri(t,"capturing",this),_n(n,"$capture",t,...e))return t.return;const s=t.startRange||this.selection.getFirstRange(),o=s?s.getContainedElement():null,r=o?Boolean(oc(n,o)):!1;let a=o||H1(s);if(ri(t,"atTarget",a),!r){if(_n(n,"$text",t,...e))return t.return;ri(t,"bubbling",a)}for(;a;){if(a.is("rootElement")){if(_n(n,"$root",t,...e))return t.return}else if(a.is("element")&&_n(n,a.name,t,...e))return t.return;if(_n(n,a,t,...e))return t.return;a=a.parent,ri(t,"bubbling",a)}return ri(t,"bubbling",this),_n(n,"$document",t,...e),t.return}catch(t){p.rethrowUnexpectedError(t,this)}},_addEventListener(i,e,t){const n=Ee(t.context||"$document"),s=wo(this);for(const o of n){let r=s.get(o);r||(r=Object.create(oe),s.set(o,r)),this.listenTo(r,i,e,t)}},_removeEventListener(i,e){const t=wo(this);for(const n of t.values())this.stopListening(n,i,e)}};function ri(i,e,t){i instanceof $i&&(i._eventPhase=e,i._currentTarget=t)}function _n(i,e,t,...n){const s=typeof e=="string"?i.get(e):oc(i,e);return s?(s.fire(t,...n),t.stop.called):!1}function oc(i,e){for(const[t,n]of i)if(typeof t=="function"&&t(e))return n;return null}function wo(i){return i[po]||(i[po]=new Map),i[po]}function H1(i){if(!i)return null;const e=i.start.parent,t=i.end.parent,n=e.getPath(),s=t.getPath();return n.length>s.length?e:t}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ai{constructor(e){this.selection=new go,this.roots=new $e({idProperty:"rootName"}),this.stylesProcessor=e,this.set("isReadOnly",!1),this.set("isFocused",!1),this.set("isSelecting",!1),this.set("isComposing",!1),this._postFixers=new Set}getRoot(e="main"){return this.roots.get(e)}registerPostFixer(e){this._postFixers.add(e)}destroy(){this.roots.map(e=>e.destroy()),this.stopListening()}_callPostFixers(e){let t=!1;do for(const n of this._postFixers)if(t=n(e),t)break;while(t)}}F(ai,$1);F(ai,re);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const rc=10;class vn extends Ge{constructor(e,t,n,s){super(e,t,n,s);this.getFillerOffset=U1,this._priority=rc,this._id=null,this._clonesGroup=null}get priority(){return this._priority}get id(){return this._id}getElementsWithSameId(){if(this.id===null)throw new p("attribute-element-get-elements-with-same-id-no-id",this);return new Set(this._clonesGroup)}is(e,t=null){return t?t===this.name&&(e==="attributeElement"||e==="view:attributeElement"||e==="element"||e==="view:element"):e==="attributeElement"||e==="view:attributeElement"||e==="element"||e==="view:element"||e==="node"||e==="view:node"}isSimilar(e){return this.id!==null||e.id!==null?this.id===e.id:super.isSimilar(e)&&this.priority==e.priority}_clone(e){const t=super._clone(e);return t._priority=this._priority,t._id=this._id,t}}vn.DEFAULT_PRIORITY=rc;function U1(){if(bo(this))return null;let i=this.parent;for(;i&&i.is("attributeElement");){if(bo(i)>1)return null;i=i.parent}return!i||bo(i)>1?null:this.childCount}function bo(i){return Array.from(i.getChildren()).filter(e=>!e.is("uiElement")).length}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ac extends Ge{constructor(e,t,n,s){super(e,t,n,s);this._isAllowedInsideAttributeElement=!0,this.getFillerOffset=W1}is(e,t=null){return t?t===this.name&&(e==="emptyElement"||e==="view:emptyElement"||e==="element"||e==="view:element"):e==="emptyElement"||e==="view:emptyElement"||e==="element"||e==="view:element"||e==="node"||e==="view:node"}_insertChild(e,t){if(t&&(t instanceof Xt||Array.from(t).length>0))throw new p("view-emptyelement-cannot-add",[this,t])}}function W1(){return null}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const en=navigator.userAgent.toLowerCase(),ae={isMac:lc(en),isWindows:q1(en),isGecko:j1(en),isSafari:K1(en),isiOS:G1(en),isAndroid:J1(en),isBlink:Q1(en),features:{isRegExpUnicodePropertySupported:Y1()}};function lc(i){return i.indexOf("macintosh")>-1}function q1(i){return i.indexOf("windows")>-1}function j1(i){return!!i.match(/gecko\/\d+/)}function K1(i){return i.indexOf(" applewebkit/")>-1&&i.indexOf("chrome")===-1}function G1(i){return!!i.match(/iphone|ipad/i)||lc(i)&&navigator.maxTouchPoints>0}function J1(i){return i.indexOf("android")>-1}function Q1(i){return i.indexOf("chrome/")>-1&&i.indexOf("edge/")<0}function Y1(){let i=!1;try{i="\u0107".search(new RegExp("[\\p{L}]","u"))===0}catch{}return i}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const X1={ctrl:"\u2303",cmd:"\u2318",alt:"\u2325",shift:"\u21E7"},Z1={ctrl:"Ctrl+",alt:"Alt+",shift:"Shift+"},K=s0(),e0=Object.fromEntries(Object.entries(K).map(([i,e])=>[e,i.charAt(0).toUpperCase()+i.slice(1)]));function dt(i){let e;if(typeof i=="string"){if(e=K[i.toLowerCase()],!e)throw new p("keyboard-unknown-key",null,{key:i})}else e=i.keyCode+(i.altKey?K.alt:0)+(i.ctrlKey?K.ctrl:0)+(i.shiftKey?K.shift:0)+(i.metaKey?K.cmd:0);return e}function _o(i){return typeof i=="string"&&(i=o0(i)),i.map(e=>typeof e=="string"?n0(e):e).reduce((e,t)=>t+e,0)}function cc(i){let e=_o(i);return Object.entries(ae.isMac?X1:Z1).reduce((s,[o,r])=>((e&K[o])!=0&&(e&=~K[o],s+=r),s),"")+(e?e0[e]:"")}function t0(i){return i==K.arrowright||i==K.arrowleft||i==K.arrowup||i==K.arrowdown}function vo(i,e){const t=e==="ltr";switch(i){case K.arrowleft:return t?"left":"right";case K.arrowright:return t?"right":"left";case K.arrowup:return"up";case K.arrowdown:return"down"}}function n0(i){if(i.endsWith("!"))return dt(i.slice(0,-1));const e=dt(i);return ae.isMac&&e==K.ctrl?K.cmd:e}function i0(i,e){const t=vo(i,e);return t==="down"||t==="right"}function s0(){const i={arrowleft:37,arrowup:38,arrowright:39,arrowdown:40,backspace:8,delete:46,enter:13,space:32,esc:27,tab:9,ctrl:1114112,shift:2228224,alt:4456448,cmd:8912896};for(let e=65;e<=90;e++){const t=String.fromCharCode(e);i[t.toLowerCase()]=e}for(let e=48;e<=57;e++)i[e-48]=e;for(let e=112;e<=123;e++)i["f"+(e-111)]=e;for(const e of"`-=[];',./\\")i[e]=e.charCodeAt(0);return i}function o0(i){return i.split("+").map(e=>e.trim())}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class yo extends Ge{constructor(e,t,n,s){super(e,t,n,s);this._isAllowedInsideAttributeElement=!0,this.getFillerOffset=a0}is(e,t=null){return t?t===this.name&&(e==="uiElement"||e==="view:uiElement"||e==="element"||e==="view:element"):e==="uiElement"||e==="view:uiElement"||e==="element"||e==="view:element"||e==="node"||e==="view:node"}_insertChild(e,t){if(t&&(t instanceof Xt||Array.from(t).length>0))throw new p("view-uielement-cannot-add",this)}render(e){return this.toDomElement(e)}toDomElement(e){const t=e.createElement(this.name);for(const n of this.getAttributeKeys())t.setAttribute(n,this.getAttribute(n));return t}}function r0(i){i.document.on("arrowKey",(e,t)=>l0(e,t,i.domConverter),{priority:"low"})}function a0(){return null}function l0(i,e,t){if(e.keyCode==K.arrowright){const n=e.domTarget.ownerDocument.defaultView.getSelection(),s=n.rangeCount==1&&n.getRangeAt(0).collapsed;if(s||e.shiftKey){const o=n.focusNode,r=n.focusOffset,a=t.domPositionToView(o,r);if(a===null)return;let l=!1;const c=a.getLastMatchingPosition(u=>(u.item.is("uiElement")&&(l=!0),!!(u.item.is("uiElement")||u.item.is("attributeElement"))));if(l){const u=t.viewPositionToDom(c);s?n.collapse(u.parent,u.offset):n.extend(u.parent,u.offset)}}}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class uc extends Ge{constructor(e,t,n,s){super(e,t,n,s);this._isAllowedInsideAttributeElement=!0,this.getFillerOffset=c0}is(e,t=null){return t?t===this.name&&(e==="rawElement"||e==="view:rawElement"||e==="element"||e==="view:element"):e==="rawElement"||e==="view:rawElement"||e===this.name||e==="view:"+this.name||e==="element"||e==="view:element"||e==="node"||e==="view:node"}_insertChild(e,t){if(t&&(t instanceof Xt||Array.from(t).length>0))throw new p("view-rawelement-cannot-add",[this,t])}}function c0(){return null}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class tn{constructor(e,t){this.document=e,this._children=[],t&&this._insertChild(0,t)}[Symbol.iterator](){return this._children[Symbol.iterator]()}get childCount(){return this._children.length}get isEmpty(){return this.childCount===0}get root(){return this}get parent(){return null}is(e){return e==="documentFragment"||e==="view:documentFragment"}_appendChild(e){return this._insertChild(this.childCount,e)}getChild(e){return this._children[e]}getChildIndex(e){return this._children.indexOf(e)}getChildren(){return this._children[Symbol.iterator]()}_insertChild(e,t){this._fireChange("children",this);let n=0;const s=u0(this.document,t);for(const o of s)o.parent!==null&&o._remove(),o.parent=this,this._children.splice(e,0,o),e++,n++;return n}_removeChildren(e,t=1){this._fireChange("children",this);for(let n=e;n<e+t;n++)this._children[n].parent=null;return this._children.splice(e,t)}_fireChange(e,t){this.fire("change:"+e,t)}}F(tn,oe);function u0(i,e){return typeof e=="string"?[new ce(i,e)]:(Ke(e)||(e=[e]),Array.from(e).map(t=>typeof t=="string"?new ce(i,t):t instanceof kt?new ce(i,t.data):t))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class dc{constructor(e){this.document=e,this._cloneGroups=new Map}setSelection(e,t,n){this.document.selection._setTo(e,t,n)}setSelectionFocus(e,t){this.document.selection._setFocus(e,t)}createDocumentFragment(e){return new tn(this.document,e)}createText(e){return new ce(this.document,e)}createAttributeElement(e,t,n={}){const s=new vn(this.document,e,t);return typeof n.priority=="number"&&(s._priority=n.priority),n.id&&(s._id=n.id),n.renderUnsafeAttributes&&s._unsafeAttributesToRender.push(...n.renderUnsafeAttributes),s}createContainerElement(e,t,n={}){const s=new Fi(this.document,e,t);return n.isAllowedInsideAttributeElement!==void 0&&(s._isAllowedInsideAttributeElement=n.isAllowedInsideAttributeElement),n.renderUnsafeAttributes&&s._unsafeAttributesToRender.push(...n.renderUnsafeAttributes),s}createEditableElement(e,t,n={}){const s=new Li(this.document,e,t);return s._document=this.document,n.renderUnsafeAttributes&&s._unsafeAttributesToRender.push(...n.renderUnsafeAttributes),s}createEmptyElement(e,t,n={}){const s=new ac(this.document,e,t);return n.isAllowedInsideAttributeElement!==void 0&&(s._isAllowedInsideAttributeElement=n.isAllowedInsideAttributeElement),n.renderUnsafeAttributes&&s._unsafeAttributesToRender.push(...n.renderUnsafeAttributes),s}createUIElement(e,t,n,s={}){const o=new yo(this.document,e,t);return n&&(o.render=n),s.isAllowedInsideAttributeElement!==void 0&&(o._isAllowedInsideAttributeElement=s.isAllowedInsideAttributeElement),o}createRawElement(e,t,n,s={}){const o=new uc(this.document,e,t);return o.render=n||(()=>{}),s.isAllowedInsideAttributeElement!==void 0&&(o._isAllowedInsideAttributeElement=s.isAllowedInsideAttributeElement),s.renderUnsafeAttributes&&o._unsafeAttributesToRender.push(...s.renderUnsafeAttributes),o}setAttribute(e,t,n){n._setAttribute(e,t)}removeAttribute(e,t){t._removeAttribute(e)}addClass(e,t){t._addClass(e)}removeClass(e,t){t._removeClass(e)}setStyle(e,t,n){je(e)&&n===void 0&&(n=t),n._setStyle(e,t)}removeStyle(e,t){t._removeStyle(e)}setCustomProperty(e,t,n){n._setCustomProperty(e,t)}removeCustomProperty(e,t){return t._removeCustomProperty(e)}breakAttributes(e){return e instanceof I?this._breakAttributes(e):this._breakAttributesRange(e)}breakContainer(e){const t=e.parent;if(!t.is("containerElement"))throw new p("view-writer-break-non-container-element",this.document);if(!t.parent)throw new p("view-writer-break-root",this.document);if(e.isAtStart)return I._createBefore(t);if(!e.isAtEnd){const n=t._clone(!1);this.insert(I._createAfter(t),n);const s=new z(e,I._createAt(t,"end")),o=new I(n,0);this.move(s,o)}return I._createAfter(t)}mergeAttributes(e){const t=e.offset,n=e.parent;if(n.is("$text"))return e;if(n.is("attributeElement")&&n.childCount===0){const r=n.parent,a=n.index;return n._remove(),this._removeFromClonedElementsGroup(n),this.mergeAttributes(new I(r,a))}const s=n.getChild(t-1),o=n.getChild(t);if(!s||!o)return e;if(s.is("$text")&&o.is("$text"))return fc(s,o);if(s.is("attributeElement")&&o.is("attributeElement")&&s.isSimilar(o)){const r=s.childCount;return s._appendChild(o.getChildren()),o._remove(),this._removeFromClonedElementsGroup(o),this.mergeAttributes(new I(s,r))}return e}mergeContainers(e){const t=e.nodeBefore,n=e.nodeAfter;if(!t||!n||!t.is("containerElement")||!n.is("containerElement"))throw new p("view-writer-merge-containers-invalid-position",this.document);const s=t.getChild(t.childCount-1),o=s instanceof ce?I._createAt(s,"end"):I._createAt(t,"end");return this.move(z._createIn(n),I._createAt(t,"end")),this.remove(z._createOn(n)),o}insert(e,t){t=Ke(t)?[...t]:[t],mc(t,this.document);const n=t.reduce((r,a)=>{const l=r[r.length-1],c=!(a.is("uiElement")&&a.isAllowedInsideAttributeElement);return!l||l.breakAttributes!=c?r.push({breakAttributes:c,nodes:[a]}):l.nodes.push(a),r},[]);let s=null,o=e;for(const{nodes:r,breakAttributes:a}of n){const l=this._insertNodes(o,r,a);s||(s=l.start),o=l.end}return s?new z(s,o):new z(e)}remove(e){const t=e instanceof z?e:z._createOn(e);if(li(t,this.document),t.isCollapsed)return new tn(this.document);const{start:n,end:s}=this._breakAttributesRange(t,!0),o=n.parent,r=s.offset-n.offset,a=o._removeChildren(n.offset,r);for(const c of a)this._removeFromClonedElementsGroup(c);const l=this.mergeAttributes(n);return t.start=l,t.end=l.clone(),new tn(this.document,a)}clear(e,t){li(e,this.document);const n=e.getWalker({direction:"backward",ignoreElementEnd:!0});for(const s of n){const o=s.item;let r;if(o.is("element")&&t.isSimilar(o))r=z._createOn(o);else if(!s.nextPosition.isAfter(e.start)&&o.is("$textProxy")){const a=o.getAncestors().find(l=>l.is("element")&&t.isSimilar(l));a&&(r=z._createIn(a))}r&&(r.end.isAfter(e.end)&&(r.end=e.end),r.start.isBefore(e.start)&&(r.start=e.start),this.remove(r))}}move(e,t){let n;if(t.isAfter(e.end)){t=this._breakAttributes(t,!0);const s=t.parent,o=s.childCount;e=this._breakAttributesRange(e,!0),n=this.remove(e),t.offset+=s.childCount-o}else n=this.remove(e);return this.insert(t,n)}wrap(e,t){if(!(t instanceof vn))throw new p("view-writer-wrap-invalid-attribute",this.document);if(li(e,this.document),e.isCollapsed){let n=e.start;n.parent.is("element")&&!d0(n.parent)&&(n=n.getLastMatchingPosition(o=>o.item.is("uiElement"))),n=this._wrapPosition(n,t);const s=this.document.selection;return s.isCollapsed&&s.getFirstPosition().isEqual(e.start)&&this.setSelection(n),new z(n)}else return this._wrapRange(e,t)}unwrap(e,t){if(!(t instanceof vn))throw new p("view-writer-unwrap-invalid-attribute",this.document);if(li(e,this.document),e.isCollapsed)return e;const{start:n,end:s}=this._breakAttributesRange(e,!0),o=n.parent,r=this._unwrapChildren(o,n.offset,s.offset,t),a=this.mergeAttributes(r.start);a.isEqual(r.start)||r.end.offset--;const l=this.mergeAttributes(r.end);return new z(a,l)}rename(e,t){const n=new Fi(this.document,e,t.getAttributes());return this.insert(I._createAfter(t),n),this.move(z._createIn(t),I._createAt(n,0)),this.remove(z._createOn(t)),n}clearClonedElementsGroup(e){this._cloneGroups.delete(e)}createPositionAt(e,t){return I._createAt(e,t)}createPositionAfter(e){return I._createAfter(e)}createPositionBefore(e){return I._createBefore(e)}createRange(e,t){return new z(e,t)}createRangeOn(e){return z._createOn(e)}createRangeIn(e){return z._createIn(e)}createSelection(e,t,n){return new et(e,t,n)}_insertNodes(e,t,n){let s;if(n?s=Co(e):s=e.parent.is("$text")?e.parent.parent:e.parent,!s)throw new p("view-writer-invalid-position-container",this.document);let o;n?o=this._breakAttributes(e,!0):o=e.parent.is("$text")?ko(e):e;const r=s._insertChild(o.offset,t);for(const u of t)this._addToClonedElementsGroup(u);const a=o.getShiftedBy(r),l=this.mergeAttributes(o);l.isEqual(o)||a.offset--;const c=this.mergeAttributes(a);return new z(l,c)}_wrapChildren(e,t,n,s){let o=t;const r=[];for(;o<n;){const l=e.getChild(o),c=l.is("$text"),u=l.is("attributeElement"),d=l.isAllowedInsideAttributeElement;if(u&&this._wrapAttributeElement(s,l))r.push(new I(e,o));else if(c||d||u&&h0(s,l)){const f=s._clone();l._remove(),f._appendChild(l),e._insertChild(o,f),this._addToClonedElementsGroup(f),r.push(new I(e,o))}else u&&this._wrapChildren(l,0,l.childCount,s);o++}let a=0;for(const l of r){if(l.offset-=a,l.offset==t)continue;this.mergeAttributes(l).isEqual(l)||(a++,n--)}return z._createFromParentsAndOffsets(e,t,e,n)}_unwrapChildren(e,t,n,s){let o=t;const r=[];for(;o<n;){const l=e.getChild(o);if(!l.is("attributeElement")){o++;continue}if(l.isSimilar(s)){const c=l.getChildren(),u=l.childCount;l._remove(),e._insertChild(o,c),this._removeFromClonedElementsGroup(l),r.push(new I(e,o),new I(e,o+u)),o+=u,n+=u-1;continue}if(this._unwrapAttributeElement(s,l)){r.push(new I(e,o),new I(e,o+1)),o++;continue}this._unwrapChildren(l,0,l.childCount,s),o++}let a=0;for(const l of r){if(l.offset-=a,l.offset==t||l.offset==n)continue;this.mergeAttributes(l).isEqual(l)||(a++,n--)}return z._createFromParentsAndOffsets(e,t,e,n)}_wrapRange(e,t){const{start:n,end:s}=this._breakAttributesRange(e,!0),o=n.parent,r=this._wrapChildren(o,n.offset,s.offset,t),a=this.mergeAttributes(r.start);a.isEqual(r.start)||r.end.offset--;const l=this.mergeAttributes(r.end);return new z(a,l)}_wrapPosition(e,t){if(t.isSimilar(e.parent))return hc(e.clone());e.parent.is("$text")&&(e=ko(e));const n=this.createAttributeElement();n._priority=Number.POSITIVE_INFINITY,n.isSimilar=()=>!1,e.parent._insertChild(e.offset,n);const s=new z(e,e.getShiftedBy(1));this.wrap(s,t);const o=new I(n.parent,n.index);n._remove();const r=o.nodeBefore,a=o.nodeAfter;return r instanceof ce&&a instanceof ce?fc(r,a):hc(o)}_wrapAttributeElement(e,t){if(!gc(e,t)||e.name!==t.name||e.priority!==t.priority)return!1;for(const n of e.getAttributeKeys())if(!(n==="class"||n==="style")&&t.hasAttribute(n)&&t.getAttribute(n)!==e.getAttribute(n))return!1;for(const n of e.getStyleNames())if(t.hasStyle(n)&&t.getStyle(n)!==e.getStyle(n))return!1;for(const n of e.getAttributeKeys())n==="class"||n==="style"||t.hasAttribute(n)||this.setAttribute(n,e.getAttribute(n),t);for(const n of e.getStyleNames())t.hasStyle(n)||this.setStyle(n,e.getStyle(n),t);for(const n of e.getClassNames())t.hasClass(n)||this.addClass(n,t);return!0}_unwrapAttributeElement(e,t){if(!gc(e,t)||e.name!==t.name||e.priority!==t.priority)return!1;for(const n of e.getAttributeKeys())if(!(n==="class"||n==="style")&&(!t.hasAttribute(n)||t.getAttribute(n)!==e.getAttribute(n)))return!1;if(!t.hasClass(...e.getClassNames()))return!1;for(const n of e.getStyleNames())if(!t.hasStyle(n)||t.getStyle(n)!==e.getStyle(n))return!1;for(const n of e.getAttributeKeys())n==="class"||n==="style"||this.removeAttribute(n,t);return this.removeClass(Array.from(e.getClassNames()),t),this.removeStyle(Array.from(e.getStyleNames()),t),!0}_breakAttributesRange(e,t=!1){const n=e.start,s=e.end;if(li(e,this.document),e.isCollapsed){const l=this._breakAttributes(e.start,t);return new z(l,l)}const o=this._breakAttributes(s,t),r=o.parent.childCount,a=this._breakAttributes(n,t);return o.offset+=o.parent.childCount-r,new z(a,o)}_breakAttributes(e,t=!1){const n=e.offset,s=e.parent;if(e.parent.is("emptyElement"))throw new p("view-writer-cannot-break-empty-element",this.document);if(e.parent.is("uiElement"))throw new p("view-writer-cannot-break-ui-element",this.document);if(e.parent.is("rawElement"))throw new p("view-writer-cannot-break-raw-element",this.document);if(!t&&s.is("$text")&&To(s.parent)||To(s))return e.clone();if(s.is("$text"))return this._breakAttributes(ko(e),t);const o=s.childCount;if(n==o){const r=new I(s.parent,s.index+1);return this._breakAttributes(r,t)}else if(n===0){const r=new I(s.parent,s.index);return this._breakAttributes(r,t)}else{const r=s.index+1,a=s._clone();s.parent._insertChild(r,a),this._addToClonedElementsGroup(a);const l=s.childCount-n,c=s._removeChildren(n,l);a._appendChild(c);const u=new I(s.parent,r);return this._breakAttributes(u,t)}}_addToClonedElementsGroup(e){if(!e.root.is("rootElement"))return;if(e.is("element"))for(const s of e.getChildren())this._addToClonedElementsGroup(s);const t=e.id;if(!t)return;let n=this._cloneGroups.get(t);n||(n=new Set,this._cloneGroups.set(t,n)),n.add(e),e._clonesGroup=n}_removeFromClonedElementsGroup(e){if(e.is("element"))for(const s of e.getChildren())this._removeFromClonedElementsGroup(s);const t=e.id;if(!t)return;const n=this._cloneGroups.get(t);!n||n.delete(e)}}function d0(i){return Array.from(i.getChildren()).some(e=>!e.is("uiElement"))}function Co(i){let e=i.parent;for(;!To(e);){if(!e)return;e=e.parent}return e}function h0(i,e){return i.priority<e.priority?!0:i.priority>e.priority?!1:i.getIdentity()<e.getIdentity()}function hc(i){const e=i.nodeBefore;if(e&&e.is("$text"))return new I(e,e.data.length);const t=i.nodeAfter;return t&&t.is("$text")?new I(t,0):i}function ko(i){if(i.offset==i.parent.data.length)return new I(i.parent.parent,i.parent.index+1);if(i.offset===0)return new I(i.parent.parent,i.parent.index);const e=i.parent.data.slice(i.offset);return i.parent._data=i.parent.data.slice(0,i.offset),i.parent.parent._insertChild(i.parent.index+1,new ce(i.root.document,e)),new I(i.parent.parent,i.parent.index+1)}function fc(i,e){const t=i.data.length;return i._data+=e.data,e._remove(),new I(i,t)}function mc(i,e){for(const t of i){if(!f0.some(n=>t instanceof n))throw new p("view-writer-insert-invalid-node-type",e);t.is("$text")||mc(t.getChildren(),e)}}const f0=[ce,vn,Fi,ac,uc,yo];function To(i){return i&&(i.is("containerElement")||i.is("documentFragment"))}function li(i,e){const t=Co(i.start),n=Co(i.end);if(!t||!n||t!==n)throw new p("view-writer-invalid-range-container",e)}function gc(i,e){return i.id===null&&e.id===null}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function xe(i){return Object.prototype.toString.call(i)=="[object Text]"}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const pc=i=>i.createTextNode("\xA0"),wc=i=>{const e=i.createElement("span");return e.dataset.ckeFiller=!0,e.innerHTML="\xA0",e},bc=i=>{const e=i.createElement("br");return e.dataset.ckeFiller=!0,e},ht=7,Hi="\u2060".repeat(ht);function He(i){return xe(i)&&i.data.substr(0,ht)===Hi}function Ui(i){return i.data.length==ht&&He(i)}function Eo(i){return He(i)?i.data.slice(ht):i.data}function m0(i){i.document.on("arrowKey",g0,{priority:"low"})}function g0(i,e){if(e.keyCode==K.arrowleft){const t=e.domTarget.ownerDocument.defaultView.getSelection();if(t.rangeCount==1&&t.getRangeAt(0).collapsed){const n=t.getRangeAt(0).startContainer,s=t.getRangeAt(0).startOffset;He(n)&&s<=ht&&t.collapse(n,0)}}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function _c(i,e,t,n=!1){t=t||function(o,r){return o===r},Array.isArray(i)||(i=Array.prototype.slice.call(i)),Array.isArray(e)||(e=Array.prototype.slice.call(e));const s=p0(i,e,t);return n?b0(s,e.length):w0(e,s)}function p0(i,e,t){const n=vc(i,e,t);if(n===-1)return{firstIndex:-1,lastIndexOld:-1,lastIndexNew:-1};const s=yc(i,n),o=yc(e,n),r=vc(s,o,t),a=i.length-r,l=e.length-r;return{firstIndex:n,lastIndexOld:a,lastIndexNew:l}}function vc(i,e,t){for(let n=0;n<Math.max(i.length,e.length);n++)if(i[n]===void 0||e[n]===void 0||!t(i[n],e[n]))return n;return-1}function yc(i,e){return i.slice(e).reverse()}function w0(i,e){const t=[],{firstIndex:n,lastIndexOld:s,lastIndexNew:o}=e;return o-n>0&&t.push({index:n,type:"insert",values:i.slice(n,o)}),s-n>0&&t.push({index:n+(o-n),type:"delete",howMany:s-n}),t}function b0(i,e){const{firstIndex:t,lastIndexOld:n,lastIndexNew:s}=i;if(t===-1)return Array(e).fill("equal");let o=[];return t>0&&(o=o.concat(Array(t).fill("equal"))),s-t>0&&(o=o.concat(Array(s-t).fill("insert"))),n-t>0&&(o=o.concat(Array(n-t).fill("delete"))),s<e&&(o=o.concat(Array(e-s).fill("equal"))),o}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Bt(i,e,t){t=t||function(C,A){return C===A};const n=i.length,s=e.length;if(n>200||s>200||n+s>300)return Bt.fastDiff(i,e,t,!0);let o,r;if(s<n){const C=i;i=e,e=C,o="delete",r="insert"}else o="insert",r="delete";const a=i.length,l=e.length,c=l-a,u={},d={};function f(C){const A=(d[C-1]!==void 0?d[C-1]:-1)+1,R=d[C+1]!==void 0?d[C+1]:-1,O=A>R?-1:1;u[C+O]&&(u[C]=u[C+O].slice(0)),u[C]||(u[C]=[]),u[C].push(A>R?o:r);let U=Math.max(A,R),Q=U-C;for(;Q<a&&U<l&&t(i[Q],e[U]);)Q++,U++,u[C].push("equal");return U}let b=0,_;do{for(_=-b;_<c;_++)d[_]=f(_);for(_=c+b;_>c;_--)d[_]=f(_);d[c]=f(c),b++}while(d[c]!==l);return u[c].slice(1)}Bt.fastDiff=_c;/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Cc(i,e,t){i.insertBefore(t,i.childNodes[e]||null)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function kc(i){const e=i.parentNode;e&&e.removeChild(i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function yn(i){if(i){if(i.defaultView)return i instanceof i.defaultView.Document;if(i.ownerDocument&&i.ownerDocument.defaultView)return i instanceof i.ownerDocument.defaultView.Node}return!1}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Tc{constructor(e,t){this.domDocuments=new Set,this.domConverter=e,this.markedAttributes=new Set,this.markedChildren=new Set,this.markedTexts=new Set,this.selection=t,this.set("isFocused",!1),this.set("isSelecting",!1),ae.isBlink&&!ae.isAndroid&&this.on("change:isSelecting",()=>{this.isSelecting||this.render()}),this._inlineFiller=null,this._fakeSelectionContainer=null}markToSync(e,t){if(e==="text")this.domConverter.mapViewToDom(t.parent)&&this.markedTexts.add(t);else{if(!this.domConverter.mapViewToDom(t))return;if(e==="attributes")this.markedAttributes.add(t);else if(e==="children")this.markedChildren.add(t);else throw new p("view-renderer-unknown-type",this)}}render(){let e;const t=ae.isBlink&&!ae.isAndroid?!this.isSelecting:!0;for(const n of this.markedChildren)this._updateChildrenMappings(n);t?(this._inlineFiller&&!this._isSelectionInInlineFiller()&&this._removeInlineFiller(),this._inlineFiller?e=this._getInlineFillerPosition():this._needsInlineFillerAtSelection()&&(e=this.selection.getFirstPosition(),this.markedChildren.add(e.parent))):this._inlineFiller&&this._inlineFiller.parentNode&&(e=this.domConverter.domPositionToView(this._inlineFiller));for(const n of this.markedAttributes)this._updateAttrs(n);for(const n of this.markedChildren)this._updateChildren(n,{inlineFillerPosition:e});for(const n of this.markedTexts)!this.markedChildren.has(n.parent)&&this.domConverter.mapViewToDom(n.parent)&&this._updateText(n,{inlineFillerPosition:e});if(t)if(e){const n=this.domConverter.viewPositionToDom(e),s=n.parent.ownerDocument;He(n.parent)?this._inlineFiller=n.parent:this._inlineFiller=Ec(s,n.parent,n.offset)}else this._inlineFiller=null;this._updateFocus(),this._updateSelection(),this.markedTexts.clear(),this.markedAttributes.clear(),this.markedChildren.clear()}_updateChildrenMappings(e){const t=this.domConverter.mapViewToDom(e);if(!t)return;const n=Array.from(this.domConverter.mapViewToDom(e).childNodes),s=Array.from(this.domConverter.viewChildrenToDom(e,t.ownerDocument,{withChildren:!1})),o=this._diffNodeLists(n,s),r=this._findReplaceActions(o,n,s);if(r.indexOf("replace")!==-1){const a={equal:0,insert:0,delete:0};for(const l of r)if(l==="replace"){const c=a.equal+a.insert,u=a.equal+a.delete,d=e.getChild(c);d&&!(d.is("uiElement")||d.is("rawElement"))&&this._updateElementMappings(d,n[u]),kc(s[c]),a.equal++}else a[l]++}}_updateElementMappings(e,t){this.domConverter.unbindDomElement(t),this.domConverter.bindElements(t,e),this.markedChildren.add(e),this.markedAttributes.add(e)}_getInlineFillerPosition(){const e=this.selection.getFirstPosition();return e.parent.is("$text")?I._createBefore(this.selection.getFirstPosition().parent):e}_isSelectionInInlineFiller(){if(this.selection.rangeCount!=1||!this.selection.isCollapsed)return!1;const e=this.selection.getFirstPosition(),t=this.domConverter.viewPositionToDom(e);return!!(t&&xe(t.parent)&&He(t.parent))}_removeInlineFiller(){const e=this._inlineFiller;if(!He(e))throw new p("view-renderer-filler-was-lost",this);Ui(e)?e.remove():e.data=e.data.substr(ht),this._inlineFiller=null}_needsInlineFillerAtSelection(){if(this.selection.rangeCount!=1||!this.selection.isCollapsed)return!1;const e=this.selection.getFirstPosition(),t=e.parent,n=e.offset;if(!this.domConverter.mapViewToDom(t.root)||!t.is("element")||!_0(t)||n===t.getFillerOffset())return!1;const s=e.nodeBefore,o=e.nodeAfter;return!(s instanceof ce||o instanceof ce)}_updateText(e,t){const n=this.domConverter.findCorrespondingDomText(e),s=this.domConverter.viewToDom(e,n.ownerDocument),o=n.data;let r=s.data;const a=t.inlineFillerPosition;if(a&&a.parent==e.parent&&a.offset==e.index&&(r=Hi+r),o!=r){const l=_c(o,r);for(const c of l)c.type==="insert"?n.insertData(c.index,c.values.join("")):n.deleteData(c.index,c.howMany)}}_updateAttrs(e){const t=this.domConverter.mapViewToDom(e);if(!t)return;const n=Array.from(t.attributes).map(o=>o.name),s=e.getAttributeKeys();for(const o of s)this.domConverter.setDomElementAttribute(t,o,e.getAttribute(o),e);for(const o of n)e.hasAttribute(o)||this.domConverter.removeDomElementAttribute(t,o)}_updateChildren(e,t){const n=this.domConverter.mapViewToDom(e);if(!n)return;const s=t.inlineFillerPosition,o=this.domConverter.mapViewToDom(e).childNodes,r=Array.from(this.domConverter.viewChildrenToDom(e,n.ownerDocument,{bind:!0}));s&&s.parent===e&&Ec(n.ownerDocument,r,s.offset);const a=this._diffNodeLists(o,r);let l=0;const c=new Set;for(const u of a)u==="delete"?(c.add(o[l]),kc(o[l])):u==="equal"&&l++;l=0;for(const u of a)u==="insert"?(Cc(n,l,r[l]),l++):u==="equal"&&(this._markDescendantTextToSync(this.domConverter.domToView(r[l])),l++);for(const u of c)u.parentNode||this.domConverter.unbindDomElement(u)}_diffNodeLists(e,t){return e=C0(e,this._fakeSelectionContainer),Bt(e,t,v0.bind(null,this.domConverter))}_findReplaceActions(e,t,n){if(e.indexOf("insert")===-1||e.indexOf("delete")===-1)return e;let s=[],o=[],r=[];const a={equal:0,insert:0,delete:0};for(const l of e)l==="insert"?r.push(n[a.equal+a.insert]):l==="delete"?o.push(t[a.equal+a.delete]):(s=s.concat(Bt(o,r,Ac).map(c=>c==="equal"?"replace":c)),s.push("equal"),o=[],r=[]),a[l]++;return s.concat(Bt(o,r,Ac).map(l=>l==="equal"?"replace":l))}_markDescendantTextToSync(e){if(!!e){if(e.is("$text"))this.markedTexts.add(e);else if(e.is("element"))for(const t of e.getChildren())this._markDescendantTextToSync(t)}}_updateSelection(){if(ae.isBlink&&!ae.isAndroid&&this.isSelecting&&!this.markedChildren.size)return;if(this.selection.rangeCount===0){this._removeDomSelection(),this._removeFakeSelection();return}const e=this.domConverter.mapViewToDom(this.selection.editableElement);!this.isFocused||!e||(this.selection.isFake?this._updateFakeSelection(e):(this._removeFakeSelection(),this._updateDomSelection(e)))}_updateFakeSelection(e){const t=e.ownerDocument;this._fakeSelectionContainer||(this._fakeSelectionContainer=k0(t));const n=this._fakeSelectionContainer;if(this.domConverter.bindFakeSelection(n,this.selection),!this._fakeSelectionNeedsUpdate(e))return;(!n.parentElement||n.parentElement!=e)&&e.appendChild(n),n.textContent=this.selection.fakeSelectionLabel||"\xA0";const s=t.getSelection(),o=t.createRange();s.removeAllRanges(),o.selectNodeContents(n),s.addRange(o)}_updateDomSelection(e){const t=e.ownerDocument.defaultView.getSelection();if(!this._domSelectionNeedsUpdate(t))return;const n=this.domConverter.viewPositionToDom(this.selection.anchor),s=this.domConverter.viewPositionToDom(this.selection.focus);t.collapse(n.parent,n.offset),t.extend(s.parent,s.offset),ae.isGecko&&y0(s,t)}_domSelectionNeedsUpdate(e){if(!this.domConverter.isDomSelectionCorrect(e))return!0;const t=e&&this.domConverter.domSelectionToView(e);return!(t&&this.selection.isEqual(t)||!this.selection.isCollapsed&&this.selection.isSimilar(t))}_fakeSelectionNeedsUpdate(e){const t=this._fakeSelectionContainer,n=e.ownerDocument.getSelection();return!t||t.parentElement!==e||n.anchorNode!==t&&!t.contains(n.anchorNode)?!0:t.textContent!==this.selection.fakeSelectionLabel}_removeDomSelection(){for(const e of this.domDocuments)if(e.getSelection().rangeCount){const n=e.activeElement,s=this.domConverter.mapDomToView(n);n&&s&&e.getSelection().removeAllRanges()}}_removeFakeSelection(){const e=this._fakeSelectionContainer;e&&e.remove()}_updateFocus(){if(this.isFocused){const e=this.selection.editableElement;e&&this.domConverter.focus(e)}}}F(Tc,re);function _0(i){if(i.getAttribute("contenteditable")=="false")return!1;const e=i.findAncestor(t=>t.hasAttribute("contenteditable"));return!e||e.getAttribute("contenteditable")=="true"}function Ec(i,e,t){const n=e instanceof Array?e:e.childNodes,s=n[t];if(xe(s))return s.data=Hi+s.data,s;{const o=i.createTextNode(Hi);return Array.isArray(e)?n.splice(t,0,o):Cc(e,t,o),o}}function Ac(i,e){return yn(i)&&yn(e)&&!xe(i)&&!xe(e)&&i.nodeType!==Node.COMMENT_NODE&&e.nodeType!==Node.COMMENT_NODE&&i.tagName.toLowerCase()===e.tagName.toLowerCase()}function v0(i,e,t){return e===t?!0:xe(e)&&xe(t)?e.data===t.data:!!(i.isBlockFiller(e)&&i.isBlockFiller(t))}function y0(i,e){const t=i.parent;if(t.nodeType!=Node.ELEMENT_NODE||i.offset!=t.childNodes.length-1)return;const n=t.childNodes[i.offset];n&&n.tagName=="BR"&&e.addRange(e.getRangeAt(0))}function C0(i,e){const t=Array.from(i);return t.length==0||!e||t[t.length-1]==e&&t.pop(),t}function k0(i){const e=i.createElement("div");return e.className="ck-fake-selection-container",Object.assign(e.style,{position:"fixed",top:0,left:"-9999px",width:"42px"}),e.textContent="\xA0",e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */var _e={window,document};/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Ao(i){let e=0;for(;i.previousSibling;)i=i.previousSibling,e++;return e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Sc(i){const e=[];for(;i&&i.nodeType!=Node.DOCUMENT_NODE;)e.unshift(i),i=i.parentNode;return e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const T0=bc(document),E0=pc(document),A0=wc(document),Wi="data-ck-unsafe-attribute-",xc="data-ck-unsafe-element";class qi{constructor(e,t={}){this.document=e,this.renderingMode=t.renderingMode||"editing",this.blockFillerMode=t.blockFillerMode||(this.renderingMode==="editing"?"br":"nbsp"),this.preElements=["pre"],this.blockElements=["address","article","aside","blockquote","caption","center","dd","details","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","legend","li","main","menu","nav","ol","p","pre","section","summary","table","tbody","td","tfoot","th","thead","tr","ul"],this.inlineObjectElements=["object","iframe","input","button","textarea","select","option","video","embed","audio","img","canvas"],this._domToViewMapping=new WeakMap,this._viewToDomMapping=new WeakMap,this._fakeSelectionMapping=new WeakMap,this._rawContentElementMatcher=new ut,this._encounteredRawContentDomNodes=new WeakSet}bindFakeSelection(e,t){this._fakeSelectionMapping.set(e,new et(t))}fakeSelectionToView(e){return this._fakeSelectionMapping.get(e)}bindElements(e,t){this._domToViewMapping.set(e,t),this._viewToDomMapping.set(t,e)}unbindDomElement(e){const t=this._domToViewMapping.get(e);if(t){this._domToViewMapping.delete(e),this._viewToDomMapping.delete(t);for(const n of e.childNodes)this.unbindDomElement(n)}}bindDocumentFragments(e,t){this._domToViewMapping.set(e,t),this._viewToDomMapping.set(t,e)}shouldRenderAttribute(e,t,n){return this.renderingMode==="data"?!0:(e=e.toLowerCase(),e.startsWith("on")||e==="srcdoc"&&t.match(/\bon\S+\s*=|javascript:|<\s*\/*script/i)?!1:n==="img"&&(e==="src"||e==="srcset")||n==="source"&&e==="srcset"?!0:!t.match(/^\s*(javascript:|data:(image\/svg|text\/x?html))/i))}setContentOf(e,t){if(this.renderingMode==="data"){e.innerHTML=t;return}const n=new DOMParser().parseFromString(t,"text/html"),s=n.createDocumentFragment(),o=n.body.childNodes;for(;o.length>0;)s.appendChild(o[0]);const r=n.createTreeWalker(s,NodeFilter.SHOW_ELEMENT),a=[];let l;for(;l=r.nextNode();)a.push(l);for(const c of a){for(const d of c.getAttributeNames())this.setDomElementAttribute(c,d,c.getAttribute(d));const u=c.tagName.toLowerCase();this._shouldRenameElement(u)&&(Re("domconverter-unsafe-element-detected",{unsafeElement:c}),c.replaceWith(this._createReplacementDomElement(u,c)))}for(;e.firstChild;)e.firstChild.remove();e.append(s)}viewToDom(e,t,n={}){if(e.is("$text")){const s=this._processDataFromViewText(e);return t.createTextNode(s)}else{if(this.mapViewToDom(e))return this.mapViewToDom(e);let s;if(e.is("documentFragment"))s=t.createDocumentFragment(),n.bind&&this.bindDocumentFragments(s,e);else{if(e.is("uiElement"))return e.name==="$comment"?s=t.createComment(e.getCustomProperty("$rawContent")):s=e.render(t,this),n.bind&&this.bindElements(s,e),s;this._shouldRenameElement(e.name)?(Re("domconverter-unsafe-element-detected",{unsafeElement:e}),s=this._createReplacementDomElement(e.name)):e.hasAttribute("xmlns")?s=t.createElementNS(e.getAttribute("xmlns"),e.name):s=t.createElement(e.name),e.is("rawElement")&&e.render(s,this),n.bind&&this.bindElements(s,e);for(const o of e.getAttributeKeys())this.setDomElementAttribute(s,o,e.getAttribute(o),e)}if(n.withChildren!==!1)for(const o of this.viewChildrenToDom(e,t,n))s.appendChild(o);return s}}setDomElementAttribute(e,t,n,s=null){const o=this.shouldRenderAttribute(t,n,e.tagName.toLowerCase())||s&&s.shouldRenderUnsafeAttribute(t);o||Re("domconverter-unsafe-attribute-detected",{domElement:e,key:t,value:n}),e.hasAttribute(t)&&!o?e.removeAttribute(t):e.hasAttribute(Wi+t)&&o&&e.removeAttribute(Wi+t),e.setAttribute(o?t:Wi+t,n)}removeDomElementAttribute(e,t){t!=xc&&(e.removeAttribute(t),e.removeAttribute(Wi+t))}*viewChildrenToDom(e,t,n={}){const s=e.getFillerOffset&&e.getFillerOffset();let o=0;for(const r of e.getChildren())s===o&&(yield this._getBlockFiller(t)),yield this.viewToDom(r,t,n),o++;s===o&&(yield this._getBlockFiller(t))}viewRangeToDom(e){const t=this.viewPositionToDom(e.start),n=this.viewPositionToDom(e.end),s=document.createRange();return s.setStart(t.parent,t.offset),s.setEnd(n.parent,n.offset),s}viewPositionToDom(e){const t=e.parent;if(t.is("$text")){const n=this.findCorrespondingDomText(t);if(!n)return null;let s=e.offset;return He(n)&&(s+=ht),{parent:n,offset:s}}else{let n,s,o;if(e.offset===0){if(n=this.mapViewToDom(t),!n)return null;o=n.childNodes[0]}else{const a=e.nodeBefore;if(s=a.is("$text")?this.findCorrespondingDomText(a):this.mapViewToDom(e.nodeBefore),!s)return null;n=s.parentNode,o=s.nextSibling}if(xe(o)&&He(o))return{parent:o,offset:ht};const r=s?Ao(s)+1:0;return{parent:n,offset:r}}}domToView(e,t={}){if(this.isBlockFiller(e))return null;const n=this.getHostViewElement(e);if(n)return n;if(this.isComment(e)&&t.skipComments)return null;if(xe(e)){if(Ui(e))return null;{const s=this._processDataFromDomText(e);return s===""?null:new ce(this.document,s)}}else{if(this.mapDomToView(e))return this.mapDomToView(e);let s;if(this.isDocumentFragment(e))s=new tn(this.document),t.bind&&this.bindDocumentFragments(e,s);else{s=this._createViewElement(e,t),t.bind&&this.bindElements(e,s);const o=e.attributes;if(o)for(let r=o.length-1;r>=0;r--)s._setAttribute(o[r].name,o[r].value);if(this._isViewElementWithRawContent(s,t)||this.isComment(e)){const r=this.isComment(e)?e.data:e.innerHTML;return s._setCustomProperty("$rawContent",r),this._encounteredRawContentDomNodes.add(e),s}}if(t.withChildren!==!1)for(const o of this.domChildrenToView(e,t))s._appendChild(o);return s}}*domChildrenToView(e,t={}){for(let n=0;n<e.childNodes.length;n++){const s=e.childNodes[n],o=this.domToView(s,t);o!==null&&(yield o)}}domSelectionToView(e){if(e.rangeCount===1){let s=e.getRangeAt(0).startContainer;xe(s)&&(s=s.parentNode);const o=this.fakeSelectionToView(s);if(o)return o}const t=this.isDomSelectionBackward(e),n=[];for(let s=0;s<e.rangeCount;s++){const o=e.getRangeAt(s),r=this.domRangeToView(o);r&&n.push(r)}return new et(n,{backward:t})}domRangeToView(e){const t=this.domPositionToView(e.startContainer,e.startOffset),n=this.domPositionToView(e.endContainer,e.endOffset);return t&&n?new z(t,n):null}domPositionToView(e,t=0){if(this.isBlockFiller(e))return this.domPositionToView(e.parentNode,Ao(e));const n=this.mapDomToView(e);if(n&&(n.is("uiElement")||n.is("rawElement")))return I._createBefore(n);if(xe(e)){if(Ui(e))return this.domPositionToView(e.parentNode,Ao(e));const s=this.findCorrespondingViewText(e);let o=t;return s?(He(e)&&(o-=ht,o=o<0?0:o),new I(s,o)):null}else{if(t===0){const s=this.mapDomToView(e);if(s)return new I(s,0)}else{const s=e.childNodes[t-1],o=xe(s)?this.findCorrespondingViewText(s):this.mapDomToView(s);if(o&&o.parent)return new I(o.parent,o.index+1)}return null}}mapDomToView(e){return this.getHostViewElement(e)||this._domToViewMapping.get(e)}findCorrespondingViewText(e){if(Ui(e))return null;const t=this.getHostViewElement(e);if(t)return t;const n=e.previousSibling;if(n){if(!this.isElement(n))return null;const s=this.mapDomToView(n);if(s)return s.nextSibling instanceof ce?s.nextSibling:null}else{const s=this.mapDomToView(e.parentNode);if(s){const o=s.getChild(0);return o instanceof ce?o:null}}return null}mapViewToDom(e){return this._viewToDomMapping.get(e)}findCorrespondingDomText(e){const t=e.previousSibling;return t&&this.mapViewToDom(t)?this.mapViewToDom(t).nextSibling:!t&&e.parent&&this.mapViewToDom(e.parent)?this.mapViewToDom(e.parent).childNodes[0]:null}focus(e){const t=this.mapViewToDom(e);if(t&&t.ownerDocument.activeElement!==t){const{scrollX:n,scrollY:s}=_e.window,o=[];Pc(t,r=>{const{scrollLeft:a,scrollTop:l}=r;o.push([a,l])}),t.focus(),Pc(t,r=>{const[a,l]=o.shift();r.scrollLeft=a,r.scrollTop=l}),_e.window.scrollTo(n,s)}}isElement(e){return e&&e.nodeType==Node.ELEMENT_NODE}isDocumentFragment(e){return e&&e.nodeType==Node.DOCUMENT_FRAGMENT_NODE}isComment(e){return e&&e.nodeType==Node.COMMENT_NODE}isBlockFiller(e){return this.blockFillerMode=="br"?e.isEqualNode(T0):e.tagName==="BR"&&Ic(e,this.blockElements)&&e.parentNode.childNodes.length===1?!0:e.isEqualNode(A0)||x0(e,this.blockElements)}isDomSelectionBackward(e){if(e.isCollapsed)return!1;const t=document.createRange();t.setStart(e.anchorNode,e.anchorOffset),t.setEnd(e.focusNode,e.focusOffset);const n=t.collapsed;return t.detach(),n}getHostViewElement(e){const t=Sc(e);for(t.pop();t.length;){const n=t.pop(),s=this._domToViewMapping.get(n);if(s&&(s.is("uiElement")||s.is("rawElement")))return s}return null}isDomSelectionCorrect(e){return this._isDomSelectionPositionCorrect(e.anchorNode,e.anchorOffset)&&this._isDomSelectionPositionCorrect(e.focusNode,e.focusOffset)}registerRawContentMatcher(e){this._rawContentElementMatcher.add(e)}_getBlockFiller(e){switch(this.blockFillerMode){case"nbsp":return pc(e);case"markedNbsp":return wc(e);case"br":return bc(e)}}_isDomSelectionPositionCorrect(e,t){if(xe(e)&&He(e)&&t<ht||this.isElement(e)&&He(e.childNodes[t]))return!1;const n=this.mapDomToView(e);return!(n&&(n.is("uiElement")||n.is("rawElement")))}_processDataFromViewText(e){let t=e.data;if(e.getAncestors().some(n=>this.preElements.includes(n.name)))return t;if(t.charAt(0)==" "){const n=this._getTouchingInlineViewNode(e,!1);(n&&n.is("$textProxy")&&this._nodeEndsWithSpace(n)||!n)&&(t="\xA0"+t.substr(1))}if(t.charAt(t.length-1)==" "){const n=this._getTouchingInlineViewNode(e,!0),s=n&&n.is("$textProxy")&&n.data.charAt(0)==" ";(t.charAt(t.length-2)==" "||!n||s)&&(t=t.substr(0,t.length-1)+"\xA0")}return t.replace(/ {2}/g," \xA0")}_nodeEndsWithSpace(e){if(e.getAncestors().some(n=>this.preElements.includes(n.name)))return!1;const t=this._processDataFromViewText(e);return t.charAt(t.length-1)==" "}_processDataFromDomText(e){let t=e.data;if(S0(e,this.preElements))return Eo(e);t=t.replace(/[ \n\t\r]{1,}/g," ");const n=this._getTouchingInlineDomNode(e,!1),s=this._getTouchingInlineDomNode(e,!0),o=this._checkShouldLeftTrimDomText(e,n),r=this._checkShouldRightTrimDomText(e,s);o&&(t=t.replace(/^ /,"")),r&&(t=t.replace(/ $/,"")),t=Eo(new Text(t)),t=t.replace(/ \u00A0/g,"  ");const a=s&&this.isElement(s)&&s.tagName!="BR",l=s&&xe(s)&&s.data.charAt(0)==" ";return(/( |\u00A0)\u00A0$/.test(t)||!s||a||l)&&(t=t.replace(/\u00A0$/," ")),(o||n&&this.isElement(n)&&n.tagName!="BR")&&(t=t.replace(/^\u00A0/," ")),t}_checkShouldLeftTrimDomText(e,t){return t?this.isElement(t)?t.tagName==="BR":this._encounteredRawContentDomNodes.has(e.previousSibling)?!1:/[^\S\u00A0]/.test(t.data.charAt(t.data.length-1)):!0}_checkShouldRightTrimDomText(e,t){return t?!1:!He(e)}_getTouchingInlineViewNode(e,t){const n=new Zt({startPosition:t?I._createAfter(e):I._createBefore(e),direction:t?"forward":"backward"});for(const s of n){if(s.item.is("element")&&this.inlineObjectElements.includes(s.item.name))return s.item;if(s.item.is("containerElement"))return null;if(s.item.is("element","br"))return null;if(s.item.is("$textProxy"))return s.item}return null}_getTouchingInlineDomNode(e,t){if(!e.parentNode)return null;const n=t?"firstChild":"lastChild",s=t?"nextSibling":"previousSibling";let o=!0;do if(!o&&e[n]?e=e[n]:e[s]?(e=e[s],o=!1):(e=e.parentNode,o=!0),!e||this._isBlockElement(e))return null;while(!(xe(e)||e.tagName=="BR"||this._isInlineObjectElement(e)));return e}_isBlockElement(e){return this.isElement(e)&&this.blockElements.includes(e.tagName.toLowerCase())}_isInlineObjectElement(e){return this.isElement(e)&&this.inlineObjectElements.includes(e.tagName.toLowerCase())}_createViewElement(e,t){if(this.isComment(e))return new yo(this.document,"$comment");const n=t.keepOriginalCase?e.tagName:e.tagName.toLowerCase();return new Ge(this.document,n)}_isViewElementWithRawContent(e,t){return t.withChildren!==!1&&this._rawContentElementMatcher.match(e)}_shouldRenameElement(e){return this.renderingMode=="editing"&&e.toLowerCase()=="script"}_createReplacementDomElement(e,t=null){const n=document.createElement("span");if(n.setAttribute(xc,e),t){for(;t.firstChild;)n.appendChild(t.firstChild);for(const s of t.getAttributeNames())n.setAttribute(s,t.getAttribute(s))}return n}}function S0(i,e){return Sc(i).some(n=>n.tagName&&e.includes(n.tagName.toLowerCase()))}function Pc(i,e){for(;i&&i!=_e.document;)e(i),i=i.parentNode}function x0(i,e){return i.isEqualNode(E0)&&Ic(i,e)&&i.parentNode.childNodes.length===1}function Ic(i,e){const t=i.parentNode;return t&&t.tagName&&e.includes(t.tagName.toLowerCase())}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function ji(i){const e=Object.prototype.toString.apply(i);return e=="[object Window]"||e=="[object global]"}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Cn=ti({},oe,{listenTo(i,e,t,n={}){if(yn(i)||ji(i)){const s={capture:!!n.useCapture,passive:!!n.usePassive},o=this._getProxyEmitter(i,s)||new Rc(i,s);this.listenTo(o,e,t,n)}else oe.listenTo.call(this,i,e,t,n)},stopListening(i,e,t){if(yn(i)||ji(i)){const n=this._getAllProxyEmitters(i);for(const s of n)this.stopListening(s,e,t)}else oe.stopListening.call(this,i,e,t)},_getProxyEmitter(i,e){return ng(this,Mc(i,e))},_getAllProxyEmitters(i){return[{capture:!1,passive:!1},{capture:!1,passive:!0},{capture:!0,passive:!1},{capture:!0,passive:!0}].map(e=>this._getProxyEmitter(i,e)).filter(e=>!!e)}});class Rc{constructor(e,t){Ea(this,Mc(e,t)),this._domNode=e,this._options=t}}ti(Rc.prototype,oe,{attach(i){if(this._domListeners&&this._domListeners[i])return;const e=this._createDomListener(i);this._domNode.addEventListener(i,e,this._options),this._domListeners||(this._domListeners={}),this._domListeners[i]=e},detach(i){let e;this._domListeners[i]&&(!(e=this._events[i])||!e.callbacks.length)&&this._domListeners[i].removeListener()},_addEventListener(i,e,t){this.attach(i),oe._addEventListener.call(this,i,e,t)},_removeEventListener(i,e){oe._removeEventListener.call(this,i,e),this.detach(i)},_createDomListener(i){const e=t=>{this.fire(i,t)};return e.removeListener=()=>{this._domNode.removeEventListener(i,e,this._options),delete this._domListeners[i]},e}});function P0(i){return i["data-ck-expando"]||(i["data-ck-expando"]=rt())}function Mc(i,e){let t=P0(i);for(const n of Object.keys(e).sort())e[n]&&(t+="-"+n);return t}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Et{constructor(e){this.view=e,this.document=e.document,this.isEnabled=!1}enable(){this.isEnabled=!0}disable(){this.isEnabled=!1}destroy(){this.disable(),this.stopListening()}checkShouldIgnoreEventFromTarget(e){return e&&e.nodeType===3&&(e=e.parentNode),!e||e.nodeType!==1?!1:e.matches("[data-cke-ignore-events], [data-cke-ignore-events] *")}}F(Et,Cn);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Vc extends Et{constructor(e){super(e);this._config={childList:!0,characterData:!0,characterDataOldValue:!0,subtree:!0},this.domConverter=e.domConverter,this.renderer=e._renderer,this._domElements=[],this._mutationObserver=new window.MutationObserver(this._onMutations.bind(this))}flush(){this._onMutations(this._mutationObserver.takeRecords())}observe(e){this._domElements.push(e),this.isEnabled&&this._mutationObserver.observe(e,this._config)}enable(){super.enable();for(const e of this._domElements)this._mutationObserver.observe(e,this._config)}disable(){super.disable(),this._mutationObserver.disconnect()}destroy(){super.destroy(),this._mutationObserver.disconnect()}_onMutations(e){if(e.length===0)return;const t=this.domConverter,n=new Map,s=new Set;for(const c of e)if(c.type==="childList"){const u=t.mapDomToView(c.target);if(u&&(u.is("uiElement")||u.is("rawElement")))continue;u&&!this._isBogusBrMutation(c)&&s.add(u)}for(const c of e){const u=t.mapDomToView(c.target);if(!(u&&(u.is("uiElement")||u.is("rawElement")))&&c.type==="characterData"){const d=t.findCorrespondingViewText(c.target);d&&!s.has(d.parent)?n.set(d,{type:"text",oldText:d.data,newText:Eo(c.target),node:d}):!d&&He(c.target)&&s.add(t.mapDomToView(c.target.parentNode))}}const o=[];for(const c of n.values())this.renderer.markToSync("text",c.node),o.push(c);for(const c of s){const u=t.mapViewToDom(c),d=Array.from(c.getChildren()),f=Array.from(t.domChildrenToView(u,{withChildren:!1}));o1(d,f,l)||(this.renderer.markToSync("children",c),o.push({type:"children",oldChildren:d,newChildren:f,node:c}))}const r=e[0].target.ownerDocument.getSelection();let a=null;if(r&&r.anchorNode){const c=t.domPositionToView(r.anchorNode,r.anchorOffset),u=t.domPositionToView(r.focusNode,r.focusOffset);c&&u&&(a=new et(c),a.setFocus(u))}o.length&&(this.document.fire("mutations",o,a),this.view.forceRender());function l(c,u){if(!Array.isArray(c))return c===u?!0:c.is("$text")&&u.is("$text")?c.data===u.data:!1}}_isBogusBrMutation(e){let t=null;return e.nextSibling===null&&e.removedNodes.length===0&&e.addedNodes.length==1&&(t=this.domConverter.domToView(e.addedNodes[0],{withChildren:!1})),t&&t.is("element","br")}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class So{constructor(e,t,n){this.view=e,this.document=e.document,this.domEvent=t,this.domTarget=t.target,ti(this,n)}get target(){return this.view.domConverter.mapDomToView(this.domTarget)}preventDefault(){this.domEvent.preventDefault()}stopPropagation(){this.domEvent.stopPropagation()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ft extends Et{constructor(e){super(e);this.useCapture=!1}observe(e){(typeof this.domEventType=="string"?[this.domEventType]:this.domEventType).forEach(n=>{this.listenTo(e,n,(s,o)=>{this.isEnabled&&!this.checkShouldIgnoreEventFromTarget(o.target)&&this.onDomEvent(o)},{useCapture:this.useCapture})})}fire(e,t,n){this.isEnabled&&this.document.fire(e,new So(this.view,t,n))}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class I0 extends Ft{constructor(e){super(e);this.domEventType=["keydown","keyup"]}onDomEvent(e){this.fire(e.type,e,{keyCode:e.keyCode,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,get keystroke(){return dt(this)}})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class R0 extends Et{constructor(e){super(e);this._fireSelectionChangeDoneDebounced=Oi(t=>this.document.fire("selectionChangeDone",t),200)}observe(){const e=this.document;e.on("arrowKey",(t,n)=>{e.selection.isFake&&this.isEnabled&&n.preventDefault()},{context:"$capture"}),e.on("arrowKey",(t,n)=>{e.selection.isFake&&this.isEnabled&&this._handleSelectionMove(n.keyCode)},{priority:"lowest"})}destroy(){super.destroy(),this._fireSelectionChangeDoneDebounced.cancel()}_handleSelectionMove(e){const t=this.document.selection,n=new et(t.getRanges(),{backward:t.isBackward,fake:!1});(e==K.arrowleft||e==K.arrowup)&&n.setTo(n.getFirstPosition()),(e==K.arrowright||e==K.arrowdown)&&n.setTo(n.getLastPosition());const s={oldSelection:t,newSelection:n,domSelection:null};this.document.fire("selectionChange",s),this._fireSelectionChangeDoneDebounced(s)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class M0 extends Et{constructor(e){super(e);this.mutationObserver=e.getObserver(Vc),this.selection=this.document.selection,this.domConverter=e.domConverter,this._documents=new WeakSet,this._fireSelectionChangeDoneDebounced=Oi(t=>this.document.fire("selectionChangeDone",t),200),this._clearInfiniteLoopInterval=setInterval(()=>this._clearInfiniteLoop(),1e3),this._documentIsSelectingInactivityTimeoutDebounced=Oi(()=>this.document.isSelecting=!1,5e3),this._loopbackCounter=0}observe(e){const t=e.ownerDocument,n=()=>{this.document.isSelecting=!0,this._documentIsSelectingInactivityTimeoutDebounced()},s=()=>{this.document.isSelecting=!1,this._documentIsSelectingInactivityTimeoutDebounced.cancel()};this.listenTo(e,"selectstart",n,{priority:"highest"}),this.listenTo(e,"keydown",s,{priority:"highest"}),this.listenTo(e,"keyup",s,{priority:"highest"}),!this._documents.has(t)&&(this.listenTo(t,"mouseup",s,{priority:"highest"}),this.listenTo(t,"selectionchange",(o,r)=>{this._handleSelectionChange(r,t),this._documentIsSelectingInactivityTimeoutDebounced()}),this._documents.add(t))}destroy(){super.destroy(),clearInterval(this._clearInfiniteLoopInterval),this._fireSelectionChangeDoneDebounced.cancel(),this._documentIsSelectingInactivityTimeoutDebounced.cancel()}_handleSelectionChange(e,t){if(!this.isEnabled)return;const n=t.defaultView.getSelection();if(this.checkShouldIgnoreEventFromTarget(n.anchorNode))return;this.mutationObserver.flush();const s=this.domConverter.domSelectionToView(n);if(s.rangeCount==0){this.view.hasDomSelection=!1;return}if(this.view.hasDomSelection=!0,!(this.selection.isEqual(s)&&this.domConverter.isDomSelectionCorrect(n))&&!(++this._loopbackCounter>60))if(this.selection.isSimilar(s))this.view.forceRender();else{const o={oldSelection:this.selection,newSelection:s,domSelection:n};this.document.fire("selectionChange",o),this._fireSelectionChangeDoneDebounced(o)}}_clearInfiniteLoop(){this._loopbackCounter=0}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class V0 extends Ft{constructor(e){super(e);this.domEventType=["focus","blur"],this.useCapture=!0;const t=this.document;t.on("focus",()=>{t.isFocused=!0,this._renderTimeoutId=setTimeout(()=>e.change(()=>{}),50)}),t.on("blur",(n,s)=>{const o=t.selection.editableElement;(o===null||o===s.target)&&(t.isFocused=!1,e.change(()=>{}))})}onDomEvent(e){this.fire(e.type,e)}destroy(){this._renderTimeoutId&&clearTimeout(this._renderTimeoutId),super.destroy()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class O0 extends Ft{constructor(e){super(e);this.domEventType=["compositionstart","compositionupdate","compositionend"];const t=this.document;t.on("compositionstart",()=>{t.isComposing=!0}),t.on("compositionend",()=>{t.isComposing=!1})}onDomEvent(e){this.fire(e.type,e)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md.
 */class N0 extends Ft{constructor(e){super(e);this.domEventType=["beforeinput"]}onDomEvent(e){this.fire(e.type,e)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class D0{constructor(){this._replacedElements=[]}replace(e,t){this._replacedElements.push({element:e,newElement:t}),e.style.display="none",t&&e.parentNode.insertBefore(t,e.nextSibling)}restore(){this._replacedElements.forEach(({element:e,newElement:t})=>{e.style.display="",t&&t.remove()}),this._replacedElements=[]}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function xo(i,e,t={},n=[]){const s=t&&t.xmlns,o=s?i.createElementNS(s,e):i.createElement(e);for(const r in t)o.setAttribute(r,t[r]);($l(n)||!Ke(n))&&(n=[n]);for(let r of n)$l(r)&&(r=i.createTextNode(r)),o.appendChild(r);return o}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function B0(i){return i instanceof HTMLTextAreaElement?i.value:i.innerHTML}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Ki(i){return Object.prototype.toString.apply(i)=="[object Range]"}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Oc(i){const e=i.ownerDocument.defaultView.getComputedStyle(i);return{top:parseInt(e.borderTopWidth,10),right:parseInt(e.borderRightWidth,10),bottom:parseInt(e.borderBottomWidth,10),left:parseInt(e.borderLeftWidth,10)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Nc=["top","right","bottom","left","width","height"];class te{constructor(e){const t=Ki(e);if(Object.defineProperty(this,"_source",{value:e._source||e,writable:!0,enumerable:!1}),Yt(e)||t)if(t){const n=te.getDomRangeRects(e);Gi(this,te.getBoundingRect(n))}else Gi(this,e.getBoundingClientRect());else if(ji(e)){const{innerWidth:n,innerHeight:s}=e;Gi(this,{top:0,right:n,bottom:s,left:0,width:n,height:s})}else Gi(this,e)}clone(){return new te(this)}moveTo(e,t){return this.top=t,this.right=e+this.width,this.bottom=t+this.height,this.left=e,this}moveBy(e,t){return this.top+=t,this.right+=e,this.left+=e,this.bottom+=t,this}getIntersection(e){const t={top:Math.max(this.top,e.top),right:Math.min(this.right,e.right),bottom:Math.min(this.bottom,e.bottom),left:Math.max(this.left,e.left)};return t.width=t.right-t.left,t.height=t.bottom-t.top,t.width<0||t.height<0?null:new te(t)}getIntersectionArea(e){const t=this.getIntersection(e);return t?t.getArea():0}getArea(){return this.width*this.height}getVisible(){const e=this._source;let t=this.clone();if(!Dc(e)){let n=e.parentNode||e.commonAncestorContainer;for(;n&&!Dc(n);){const s=new te(n),o=t.getIntersection(s);if(o)o.getArea()<t.getArea()&&(t=o);else return null;n=n.parentNode}}return t}isEqual(e){for(const t of Nc)if(this[t]!==e[t])return!1;return!0}contains(e){const t=this.getIntersection(e);return!!(t&&t.isEqual(e))}excludeScrollbarsAndBorders(){const e=this._source;let t,n,s;if(ji(e))t=e.innerWidth-e.document.documentElement.clientWidth,n=e.innerHeight-e.document.documentElement.clientHeight,s=e.getComputedStyle(e.document.documentElement).direction;else{const o=Oc(this._source);t=e.offsetWidth-e.clientWidth-o.left-o.right,n=e.offsetHeight-e.clientHeight-o.top-o.bottom,s=e.ownerDocument.defaultView.getComputedStyle(e).direction,this.left+=o.left,this.top+=o.top,this.right-=o.right,this.bottom-=o.bottom,this.width=this.right-this.left,this.height=this.bottom-this.top}return this.width-=t,s==="ltr"?this.right-=t:this.left+=t,this.height-=n,this.bottom-=n,this}static getDomRangeRects(e){const t=[],n=Array.from(e.getClientRects());if(n.length)for(const s of n)t.push(new te(s));else{let s=e.startContainer;xe(s)&&(s=s.parentNode);const o=new te(s.getBoundingClientRect());o.right=o.left,o.width=0,t.push(o)}return t}static getBoundingRect(e){const t={left:Number.POSITIVE_INFINITY,top:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY,bottom:Number.NEGATIVE_INFINITY};let n=0;for(const s of e)n++,t.left=Math.min(t.left,s.left),t.top=Math.min(t.top,s.top),t.right=Math.max(t.right,s.right),t.bottom=Math.max(t.bottom,s.bottom);return n==0?null:(t.width=t.right-t.left,t.height=t.bottom-t.top,new te(t))}}function Gi(i,e){for(const t of Nc)i[t]=e[t]}function Dc(i){return Yt(i)?i===i.ownerDocument.body:!1}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Bc=100;class pe{constructor(e,t){pe._observerInstance||pe._createObserver(),this._element=e,this._callback=t,pe._addElementCallback(e,t),pe._observerInstance.observe(e)}destroy(){pe._deleteElementCallback(this._element,this._callback)}static _addElementCallback(e,t){pe._elementCallbacks||(pe._elementCallbacks=new Map);let n=pe._elementCallbacks.get(e);n||(n=new Set,pe._elementCallbacks.set(e,n)),n.add(t)}static _deleteElementCallback(e,t){const n=pe._getElementCallbacks(e);n&&(n.delete(t),n.size||(pe._elementCallbacks.delete(e),pe._observerInstance.unobserve(e))),pe._elementCallbacks&&!pe._elementCallbacks.size&&(pe._observerInstance=null,pe._elementCallbacks=null)}static _getElementCallbacks(e){return pe._elementCallbacks?pe._elementCallbacks.get(e):null}static _createObserver(){let e;typeof _e.window.ResizeObserver=="function"?e=_e.window.ResizeObserver:e=Fc,pe._observerInstance=new e(t=>{for(const n of t){const s=pe._getElementCallbacks(n.target);if(s)for(const o of s)o(n)}})}}pe._observerInstance=null;pe._elementCallbacks=null;class Fc{constructor(e){this._callback=e,this._elements=new Set,this._previousRects=new Map,this._periodicCheckTimeout=null}observe(e){this._elements.add(e),this._checkElementRectsAndExecuteCallback(),this._elements.size===1&&this._startPeriodicCheck()}unobserve(e){this._elements.delete(e),this._previousRects.delete(e),this._elements.size||this._stopPeriodicCheck()}_startPeriodicCheck(){const e=()=>{this._checkElementRectsAndExecuteCallback(),this._periodicCheckTimeout=setTimeout(e,Bc)};this.listenTo(_e.window,"resize",()=>{this._checkElementRectsAndExecuteCallback()}),this._periodicCheckTimeout=setTimeout(e,Bc)}_stopPeriodicCheck(){clearTimeout(this._periodicCheckTimeout),this.stopListening(),this._previousRects.clear()}_checkElementRectsAndExecuteCallback(){const e=[];for(const t of this._elements)this._hasRectChanged(t)&&e.push({target:t,contentRect:this._previousRects.get(t)});e.length&&this._callback(e)}_hasRectChanged(e){if(!e.ownerDocument.body.contains(e))return!1;const t=new te(e),n=this._previousRects.get(e),s=!n||!n.isEqual(t);return this._previousRects.set(e,t),s}}F(Fc,Cn);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function F0(i,e){i instanceof HTMLTextAreaElement&&(i.value=e),i.innerHTML=e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Lc(i){return e=>e+i}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function De(i){const e=i.next();return e.done?null:e.value}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Je{constructor(){this.set("isFocused",!1),this.set("focusedElement",null),this._elements=new Set,this._nextEventLoopTimeout=null}add(e){if(this._elements.has(e))throw new p("focustracker-add-element-already-exist",this);this.listenTo(e,"focus",()=>this._focus(e),{useCapture:!0}),this.listenTo(e,"blur",()=>this._blur(),{useCapture:!0}),this._elements.add(e)}remove(e){e===this.focusedElement&&this._blur(e),this._elements.has(e)&&(this.stopListening(e),this._elements.delete(e))}destroy(){this.stopListening()}_focus(e){clearTimeout(this._nextEventLoopTimeout),this.focusedElement=e,this.isFocused=!0}_blur(){clearTimeout(this._nextEventLoopTimeout),this._nextEventLoopTimeout=setTimeout(()=>{this.focusedElement=null,this.isFocused=!1},0)}}F(Je,Cn);F(Je,re);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class At{constructor(){this._listener=Object.create(Cn)}listenTo(e){this._listener.listenTo(e,"keydown",(t,n)=>{this._listener.fire("_keydown:"+dt(n),n)})}set(e,t,n={}){const s=_o(e),o=n.priority;this._listener.listenTo(this._listener,"_keydown:"+s,(r,a)=>{t(a,()=>{a.preventDefault(),a.stopPropagation(),r.stop()}),r.return=!0},{priority:o})}press(e){return!!this._listener.fire("_keydown:"+dt(e),e)}destroy(){this._listener.stopListening()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class L0 extends Et{constructor(e){super(e);this.document.on("keydown",(t,n)=>{if(this.isEnabled&&t0(n.keyCode)){const s=new $i(this.document,"arrowKey",this.document.selection.getFirstRange());this.document.fire(s,n),s.stop.called&&t.stop()}})}observe(){}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const z0={};function zc({target:i,viewportOffset:e=0}){const t=Po(i);let n=t,s=null;for(;n;){let o;n==t?o=Io(i):o=Io(s),$c(o,()=>jc(i,n));const r=jc(i,n);if(H0(n,r,e),n.parent!=n){if(s=n.frameElement,n=n.parent,!s)return}else n=null}}function $0(i){const e=Io(i);$c(e,()=>new te(i))}Object.assign(z0,{scrollViewportToShowTarget:zc,scrollAncestorsToShowTarget:$0});function H0(i,e,t){const n=e.clone().moveBy(0,t),s=e.clone().moveBy(0,-t),o=new te(i).excludeScrollbarsAndBorders();if(![s,n].every(a=>o.contains(a))){let{scrollX:a,scrollY:l}=i;Uc(s,o)?l-=o.top-e.top+t:Hc(n,o)&&(l+=e.bottom-o.bottom+t),Wc(e,o)?a-=o.left-e.left+t:qc(e,o)&&(a+=e.right-o.right+t),i.scrollTo(a,l)}}function $c(i,e){const t=Po(i);let n,s;for(;i!=t.document.body;)s=e(),n=new te(i).excludeScrollbarsAndBorders(),n.contains(s)||(Uc(s,n)?i.scrollTop-=n.top-s.top:Hc(s,n)&&(i.scrollTop+=s.bottom-n.bottom),Wc(s,n)?i.scrollLeft-=n.left-s.left:qc(s,n)&&(i.scrollLeft+=s.right-n.right)),i=i.parentNode}function Hc(i,e){return i.bottom>e.bottom}function Uc(i,e){return i.top<e.top}function Wc(i,e){return i.left<e.left}function qc(i,e){return i.right>e.right}function Po(i){return Ki(i)?i.startContainer.ownerDocument.defaultView:i.ownerDocument.defaultView}function Io(i){if(Ki(i)){let e=i.commonAncestorContainer;return xe(e)&&(e=e.parentNode),e}else return i.parentNode}function jc(i,e){const t=Po(i),n=new te(i);if(t===e)return n;{let s=t;for(;s!=e;){const o=s.frameElement,r=new te(o).excludeScrollbarsAndBorders();n.moveBy(r.left,r.top),s=s.parent}}return n}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Kc{constructor(e){this.document=new ai(e),this.domConverter=new qi(this.document),this.domRoots=new Map,this.set("isRenderingInProgress",!1),this.set("hasDomSelection",!1),this._renderer=new Tc(this.domConverter,this.document.selection),this._renderer.bind("isFocused","isSelecting").to(this.document),this._initialDomRootAttributes=new WeakMap,this._observers=new Map,this._ongoingChange=!1,this._postFixersInProgress=!1,this._renderingDisabled=!1,this._hasChangedSinceTheLastRendering=!1,this._writer=new dc(this.document),this.addObserver(Vc),this.addObserver(M0),this.addObserver(V0),this.addObserver(I0),this.addObserver(R0),this.addObserver(O0),this.addObserver(L0),ae.isAndroid&&this.addObserver(N0),m0(this),r0(this),this.on("render",()=>{this._render(),this.document.fire("layoutChanged"),this._hasChangedSinceTheLastRendering=!1}),this.listenTo(this.document.selection,"change",()=>{this._hasChangedSinceTheLastRendering=!0}),this.listenTo(this.document,"change:isFocused",()=>{this._hasChangedSinceTheLastRendering=!0})}attachDomRoot(e,t="main"){const n=this.document.getRoot(t);n._name=e.tagName.toLowerCase();const s={};for(const{name:r,value:a}of Array.from(e.attributes))s[r]=a,r==="class"?this._writer.addClass(a.split(" "),n):this._writer.setAttribute(r,a,n);this._initialDomRootAttributes.set(e,s);const o=()=>{this._writer.setAttribute("contenteditable",!n.isReadOnly,n),n.isReadOnly?this._writer.addClass("ck-read-only",n):this._writer.removeClass("ck-read-only",n)};o(),this.domRoots.set(t,e),this.domConverter.bindElements(e,n),this._renderer.markToSync("children",n),this._renderer.markToSync("attributes",n),this._renderer.domDocuments.add(e.ownerDocument),n.on("change:children",(r,a)=>this._renderer.markToSync("children",a)),n.on("change:attributes",(r,a)=>this._renderer.markToSync("attributes",a)),n.on("change:text",(r,a)=>this._renderer.markToSync("text",a)),n.on("change:isReadOnly",()=>this.change(o)),n.on("change",()=>{this._hasChangedSinceTheLastRendering=!0});for(const r of this._observers.values())r.observe(e,t)}detachDomRoot(e){const t=this.domRoots.get(e);Array.from(t.attributes).forEach(({name:s})=>t.removeAttribute(s));const n=this._initialDomRootAttributes.get(t);for(const s in n)t.setAttribute(s,n[s]);this.domRoots.delete(e),this.domConverter.unbindDomElement(t)}getDomRoot(e="main"){return this.domRoots.get(e)}addObserver(e){let t=this._observers.get(e);if(t)return t;t=new e(this),this._observers.set(e,t);for(const[n,s]of this.domRoots)t.observe(s,n);return t.enable(),t}getObserver(e){return this._observers.get(e)}disableObservers(){for(const e of this._observers.values())e.disable()}enableObservers(){for(const e of this._observers.values())e.enable()}scrollToTheSelection(){const e=this.document.selection.getFirstRange();e&&zc({target:this.domConverter.viewRangeToDom(e),viewportOffset:20})}focus(){if(!this.document.isFocused){const e=this.document.selection.editableElement;e&&(this.domConverter.focus(e),this.forceRender())}}change(e){if(this.isRenderingInProgress||this._postFixersInProgress)throw new p("cannot-change-view-tree",this);try{if(this._ongoingChange)return e(this._writer);this._ongoingChange=!0;const t=e(this._writer);return this._ongoingChange=!1,!this._renderingDisabled&&this._hasChangedSinceTheLastRendering&&(this._postFixersInProgress=!0,this.document._callPostFixers(this._writer),this._postFixersInProgress=!1,this.fire("render")),t}catch(t){p.rethrowUnexpectedError(t,this)}}forceRender(){this._hasChangedSinceTheLastRendering=!0,this.change(()=>{})}destroy(){for(const e of this._observers.values())e.destroy();this.document.destroy(),this.stopListening()}createPositionAt(e,t){return I._createAt(e,t)}createPositionAfter(e){return I._createAfter(e)}createPositionBefore(e){return I._createBefore(e)}createRange(e,t){return new z(e,t)}createRangeOn(e){return z._createOn(e)}createRangeIn(e){return z._createIn(e)}createSelection(e,t,n){return new et(e,t,n)}_disableRendering(e){this._renderingDisabled=e,e==!1&&this.change(()=>{})}_render(){this.isRenderingInProgress=!0,this.disableObservers(),this._renderer.render(),this.enableObservers(),this.isRenderingInProgress=!1}}F(Kc,re);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class nn{constructor(e){this.parent=null,this._attrs=Tt(e)}get index(){let e;if(!this.parent)return null;if((e=this.parent.getChildIndex(this))===null)throw new p("model-node-not-found-in-parent",this);return e}get startOffset(){let e;if(!this.parent)return null;if((e=this.parent.getChildStartOffset(this))===null)throw new p("model-node-not-found-in-parent",this);return e}get offsetSize(){return 1}get endOffset(){return this.parent?this.startOffset+this.offsetSize:null}get nextSibling(){const e=this.index;return e!==null&&this.parent.getChild(e+1)||null}get previousSibling(){const e=this.index;return e!==null&&this.parent.getChild(e-1)||null}get root(){let e=this;for(;e.parent;)e=e.parent;return e}isAttached(){return this.root.is("rootElement")}getPath(){const e=[];let t=this;for(;t.parent;)e.unshift(t.startOffset),t=t.parent;return e}getAncestors(e={includeSelf:!1,parentFirst:!1}){const t=[];let n=e.includeSelf?this:this.parent;for(;n;)t[e.parentFirst?"push":"unshift"](n),n=n.parent;return t}getCommonAncestor(e,t={}){const n=this.getAncestors(t),s=e.getAncestors(t);let o=0;for(;n[o]==s[o]&&n[o];)o++;return o===0?null:n[o-1]}isBefore(e){if(this==e||this.root!==e.root)return!1;const t=this.getPath(),n=e.getPath(),s=Me(t,n);switch(s){case"prefix":return!0;case"extension":return!1;default:return t[s]<n[s]}}isAfter(e){return this==e||this.root!==e.root?!1:!this.isBefore(e)}hasAttribute(e){return this._attrs.has(e)}getAttribute(e){return this._attrs.get(e)}getAttributes(){return this._attrs.entries()}getAttributeKeys(){return this._attrs.keys()}toJSON(){const e={};return this._attrs.size&&(e.attributes=Array.from(this._attrs).reduce((t,n)=>(t[n[0]]=n[1],t),{})),e}is(e){return e==="node"||e==="model:node"}_clone(){return new nn(this._attrs)}_remove(){this.parent._removeChildren(this.index)}_setAttribute(e,t){this._attrs.set(e,t)}_setAttributesTo(e){this._attrs=Tt(e)}_removeAttribute(e){return this._attrs.delete(e)}_clearAttributes(){this._attrs.clear()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ue extends nn{constructor(e,t){super(t);this._data=e||""}get offsetSize(){return this.data.length}get data(){return this._data}is(e){return e==="$text"||e==="model:$text"||e==="text"||e==="model:text"||e==="node"||e==="model:node"}toJSON(){const e=super.toJSON();return e.data=this.data,e}_clone(){return new ue(this.data,this.getAttributes())}static fromJSON(e){return new ue(e.data,e.attributes)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ft{constructor(e,t,n){if(this.textNode=e,t<0||t>e.offsetSize)throw new p("model-textproxy-wrong-offsetintext",this);if(n<0||t+n>e.offsetSize)throw new p("model-textproxy-wrong-length",this);this.data=e.data.substring(t,t+n),this.offsetInText=t}get startOffset(){return this.textNode.startOffset!==null?this.textNode.startOffset+this.offsetInText:null}get offsetSize(){return this.data.length}get endOffset(){return this.startOffset!==null?this.startOffset+this.offsetSize:null}get isPartial(){return this.offsetSize!==this.textNode.offsetSize}get parent(){return this.textNode.parent}get root(){return this.textNode.root}is(e){return e==="$textProxy"||e==="model:$textProxy"||e==="textProxy"||e==="model:textProxy"}getPath(){const e=this.textNode.getPath();return e.length>0&&(e[e.length-1]+=this.offsetInText),e}getAncestors(e={includeSelf:!1,parentFirst:!1}){const t=[];let n=e.includeSelf?this:this.parent;for(;n;)t[e.parentFirst?"push":"unshift"](n),n=n.parent;return t}hasAttribute(e){return this.textNode.hasAttribute(e)}getAttribute(e){return this.textNode.getAttribute(e)}getAttributes(){return this.textNode.getAttributes()}getAttributeKeys(){return this.textNode.getAttributeKeys()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class kn{constructor(e){this._nodes=[],e&&this._insertNodes(0,e)}[Symbol.iterator](){return this._nodes[Symbol.iterator]()}get length(){return this._nodes.length}get maxOffset(){return this._nodes.reduce((e,t)=>e+t.offsetSize,0)}getNode(e){return this._nodes[e]||null}getNodeIndex(e){const t=this._nodes.indexOf(e);return t==-1?null:t}getNodeStartOffset(e){const t=this.getNodeIndex(e);return t===null?null:this._nodes.slice(0,t).reduce((n,s)=>n+s.offsetSize,0)}indexToOffset(e){if(e==this._nodes.length)return this.maxOffset;const t=this._nodes[e];if(!t)throw new p("model-nodelist-index-out-of-bounds",this);return this.getNodeStartOffset(t)}offsetToIndex(e){let t=0;for(const n of this._nodes){if(e>=t&&e<t+n.offsetSize)return this.getNodeIndex(n);t+=n.offsetSize}if(t!=e)throw new p("model-nodelist-offset-out-of-bounds",this,{offset:e,nodeList:this});return this.length}_insertNodes(e,t){for(const n of t)if(!(n instanceof nn))throw new p("model-nodelist-insertnodes-not-node",this);this._nodes.splice(e,0,...t)}_removeNodes(e,t=1){return this._nodes.splice(e,t)}toJSON(){return this._nodes.map(e=>e.toJSON())}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ne extends nn{constructor(e,t,n){super(t);this.name=e,this._children=new kn,n&&this._insertChild(0,n)}get childCount(){return this._children.length}get maxOffset(){return this._children.maxOffset}get isEmpty(){return this.childCount===0}is(e,t=null){return t?t===this.name&&(e==="element"||e==="model:element"):e==="element"||e==="model:element"||e==="node"||e==="model:node"}getChild(e){return this._children.getNode(e)}getChildren(){return this._children[Symbol.iterator]()}getChildIndex(e){return this._children.getNodeIndex(e)}getChildStartOffset(e){return this._children.getNodeStartOffset(e)}offsetToIndex(e){return this._children.offsetToIndex(e)}getNodeByPath(e){let t=this;for(const n of e)t=t.getChild(t.offsetToIndex(n));return t}findAncestor(e,t={includeSelf:!1}){let n=t.includeSelf?this:this.parent;for(;n;){if(n.name===e)return n;n=n.parent}return null}toJSON(){const e=super.toJSON();if(e.name=this.name,this._children.length>0){e.children=[];for(const t of this._children)e.children.push(t.toJSON())}return e}_clone(e=!1){const t=e?Array.from(this._children).map(n=>n._clone(!0)):null;return new ne(this.name,this.getAttributes(),t)}_appendChild(e){this._insertChild(this.childCount,e)}_insertChild(e,t){const n=U0(t);for(const s of n)s.parent!==null&&s._remove(),s.parent=this;this._children._insertNodes(e,n)}_removeChildren(e,t=1){const n=this._children._removeNodes(e,t);for(const s of n)s.parent=null;return n}static fromJSON(e){let t=null;if(e.children){t=[];for(const n of e.children)n.name?t.push(ne.fromJSON(n)):t.push(ue.fromJSON(n))}return new ne(e.name,e.attributes,t)}}function U0(i){return typeof i=="string"?[new ue(i)]:(Ke(i)||(i=[i]),Array.from(i).map(e=>typeof e=="string"?new ue(e):e instanceof ft?new ue(e.data,e.getAttributes()):e))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class St{constructor(e={}){if(!e.boundaries&&!e.startPosition)throw new p("model-tree-walker-no-start-position",null);const t=e.direction||"forward";if(t!="forward"&&t!="backward")throw new p("model-tree-walker-unknown-direction",e,{direction:t});this.direction=t,this.boundaries=e.boundaries||null,e.startPosition?this.position=e.startPosition.clone():this.position=x._createAt(this.boundaries[this.direction=="backward"?"end":"start"]),this.position.stickiness="toNone",this.singleCharacters=!!e.singleCharacters,this.shallow=!!e.shallow,this.ignoreElementEnd=!!e.ignoreElementEnd,this._boundaryStartParent=this.boundaries?this.boundaries.start.parent:null,this._boundaryEndParent=this.boundaries?this.boundaries.end.parent:null,this._visitedParent=this.position.parent}[Symbol.iterator](){return this}skip(e){let t,n,s,o;do s=this.position,o=this._visitedParent,{done:t,value:n}=this.next();while(!t&&e(n));t||(this.position=s,this._visitedParent=o)}next(){return this.direction=="forward"?this._next():this._previous()}_next(){const e=this.position,t=this.position.clone(),n=this._visitedParent;if(n.parent===null&&t.offset===n.maxOffset)return{done:!0};if(n===this._boundaryEndParent&&t.offset==this.boundaries.end.offset)return{done:!0};const s=t.parent,o=Tn(t,s),r=o||Ro(t,s,o);if(r instanceof ne)return this.shallow?t.offset++:(t.path.push(0),this._visitedParent=r),this.position=t,sn("elementStart",r,e,t,1);if(r instanceof ue){let a;if(this.singleCharacters)a=1;else{let u=r.endOffset;this._boundaryEndParent==n&&this.boundaries.end.offset<u&&(u=this.boundaries.end.offset),a=u-t.offset}const l=t.offset-r.startOffset,c=new ft(r,l,a);return t.offset+=a,this.position=t,sn("text",c,e,t,a)}else return t.path.pop(),t.offset++,this.position=t,this._visitedParent=n.parent,this.ignoreElementEnd?this._next():sn("elementEnd",n,e,t)}_previous(){const e=this.position,t=this.position.clone(),n=this._visitedParent;if(n.parent===null&&t.offset===0)return{done:!0};if(n==this._boundaryStartParent&&t.offset==this.boundaries.start.offset)return{done:!0};const s=t.parent,o=Tn(t,s),r=o||Gc(t,s,o);if(r instanceof ne)return t.offset--,this.shallow?(this.position=t,sn("elementStart",r,e,t,1)):(t.path.push(r.maxOffset),this.position=t,this._visitedParent=r,this.ignoreElementEnd?this._previous():sn("elementEnd",r,e,t));if(r instanceof ue){let a;if(this.singleCharacters)a=1;else{let u=r.startOffset;this._boundaryStartParent==n&&this.boundaries.start.offset>u&&(u=this.boundaries.start.offset),a=t.offset-u}const l=t.offset-r.startOffset,c=new ft(r,l-a,a);return t.offset-=a,this.position=t,sn("text",c,e,t,a)}else return t.path.pop(),this.position=t,this._visitedParent=n.parent,sn("elementStart",n,e,t,1)}}function sn(i,e,t,n,s){return{done:!1,value:{type:i,item:e,previousPosition:t,nextPosition:n,length:s}}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class x{constructor(e,t,n="toNone"){if(!e.is("element")&&!e.is("documentFragment"))throw new p("model-position-root-invalid",e);if(!(t instanceof Array)||t.length===0)throw new p("model-position-path-incorrect-format",e,{path:t});e.is("rootElement")?t=t.slice():(t=[...e.getPath(),...t],e=e.root),this.root=e,this.path=t,this.stickiness=n}get offset(){return this.path[this.path.length-1]}set offset(e){this.path[this.path.length-1]=e}get parent(){let e=this.root;for(let t=0;t<this.path.length-1;t++)if(e=e.getChild(e.offsetToIndex(this.path[t])),!e)throw new p("model-position-path-incorrect",this,{position:this});if(e.is("$text"))throw new p("model-position-path-incorrect",this,{position:this});return e}get index(){return this.parent.offsetToIndex(this.offset)}get textNode(){return Tn(this,this.parent)}get nodeAfter(){const e=this.parent;return Ro(this,e,Tn(this,e))}get nodeBefore(){const e=this.parent;return Gc(this,e,Tn(this,e))}get isAtStart(){return this.offset===0}get isAtEnd(){return this.offset==this.parent.maxOffset}compareWith(e){if(this.root!=e.root)return"different";const t=Me(this.path,e.path);switch(t){case"same":return"same";case"prefix":return"before";case"extension":return"after";default:return this.path[t]<e.path[t]?"before":"after"}}getLastMatchingPosition(e,t={}){t.startPosition=this;const n=new St(t);return n.skip(e),n.position}getParentPath(){return this.path.slice(0,-1)}getAncestors(){const e=this.parent;return e.is("documentFragment")?[e]:e.getAncestors({includeSelf:!0})}findAncestor(e){const t=this.parent;return t.is("element")?t.findAncestor(e,{includeSelf:!0}):null}getCommonPath(e){if(this.root!=e.root)return[];const t=Me(this.path,e.path),n=typeof t=="string"?Math.min(this.path.length,e.path.length):t;return this.path.slice(0,n)}getCommonAncestor(e){const t=this.getAncestors(),n=e.getAncestors();let s=0;for(;t[s]==n[s]&&t[s];)s++;return s===0?null:t[s-1]}getShiftedBy(e){const t=this.clone(),n=t.offset+e;return t.offset=n<0?0:n,t}isAfter(e){return this.compareWith(e)=="after"}isBefore(e){return this.compareWith(e)=="before"}isEqual(e){return this.compareWith(e)=="same"}isTouching(e){let t=null,n=null;switch(this.compareWith(e)){case"same":return!0;case"before":t=x._createAt(this),n=x._createAt(e);break;case"after":t=x._createAt(e),n=x._createAt(this);break;default:return!1}let o=t.parent;for(;t.path.length+n.path.length;){if(t.isEqual(n))return!0;if(t.path.length>n.path.length){if(t.offset!==o.maxOffset)return!1;t.path=t.path.slice(0,-1),o=o.parent,t.offset++}else{if(n.offset!==0)return!1;n.path=n.path.slice(0,-1)}}}is(e){return e==="position"||e==="model:position"}hasSameParentAs(e){if(this.root!==e.root)return!1;const t=this.getParentPath(),n=e.getParentPath();return Me(t,n)=="same"}getTransformedByOperation(e){let t;switch(e.type){case"insert":t=this._getTransformedByInsertOperation(e);break;case"move":case"remove":case"reinsert":t=this._getTransformedByMoveOperation(e);break;case"split":t=this._getTransformedBySplitOperation(e);break;case"merge":t=this._getTransformedByMergeOperation(e);break;default:t=x._createAt(this);break}return t}_getTransformedByInsertOperation(e){return this._getTransformedByInsertion(e.position,e.howMany)}_getTransformedByMoveOperation(e){return this._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany)}_getTransformedBySplitOperation(e){const t=e.movedRange;return t.containsPosition(this)||t.start.isEqual(this)&&this.stickiness=="toNext"?this._getCombined(e.splitPosition,e.moveTargetPosition):e.graveyardPosition?this._getTransformedByMove(e.graveyardPosition,e.insertionPosition,1):this._getTransformedByInsertion(e.insertionPosition,1)}_getTransformedByMergeOperation(e){const t=e.movedRange,n=t.containsPosition(this)||t.start.isEqual(this);let s;return n?(s=this._getCombined(e.sourcePosition,e.targetPosition),e.sourcePosition.isBefore(e.targetPosition)&&(s=s._getTransformedByDeletion(e.deletionPosition,1))):this.isEqual(e.deletionPosition)?s=x._createAt(e.deletionPosition):s=this._getTransformedByMove(e.deletionPosition,e.graveyardPosition,1),s}_getTransformedByDeletion(e,t){const n=x._createAt(this);if(this.root!=e.root)return n;if(Me(e.getParentPath(),this.getParentPath())=="same"){if(e.offset<this.offset){if(e.offset+t>this.offset)return null;n.offset-=t}}else if(Me(e.getParentPath(),this.getParentPath())=="prefix"){const s=e.path.length-1;if(e.offset<=this.path[s]){if(e.offset+t>this.path[s])return null;n.path[s]-=t}}return n}_getTransformedByInsertion(e,t){const n=x._createAt(this);if(this.root!=e.root)return n;if(Me(e.getParentPath(),this.getParentPath())=="same")(e.offset<this.offset||e.offset==this.offset&&this.stickiness!="toPrevious")&&(n.offset+=t);else if(Me(e.getParentPath(),this.getParentPath())=="prefix"){const s=e.path.length-1;e.offset<=this.path[s]&&(n.path[s]+=t)}return n}_getTransformedByMove(e,t,n){if(t=t._getTransformedByDeletion(e,n),e.isEqual(t))return x._createAt(this);const s=this._getTransformedByDeletion(e,n);return s===null||e.isEqual(this)&&this.stickiness=="toNext"||e.getShiftedBy(n).isEqual(this)&&this.stickiness=="toPrevious"?this._getCombined(e,t):s._getTransformedByInsertion(t,n)}_getCombined(e,t){const n=e.path.length-1,s=x._createAt(t);return s.stickiness=this.stickiness,s.offset=s.offset+this.path[n]-e.offset,s.path=[...s.path,...this.path.slice(n+1)],s}toJSON(){return{root:this.root.toJSON(),path:Array.from(this.path),stickiness:this.stickiness}}clone(){return new this.constructor(this.root,this.path,this.stickiness)}static _createAt(e,t,n="toNone"){if(e instanceof x)return new x(e.root,e.path,e.stickiness);{const s=e;if(t=="end")t=s.maxOffset;else{if(t=="before")return this._createBefore(s,n);if(t=="after")return this._createAfter(s,n);if(t!==0&&!t)throw new p("model-createpositionat-offset-required",[this,e])}if(!s.is("element")&&!s.is("documentFragment"))throw new p("model-position-parent-incorrect",[this,e]);const o=s.getPath();return o.push(t),new this(s.root,o,n)}}static _createAfter(e,t){if(!e.parent)throw new p("model-position-after-root",[this,e],{root:e});return this._createAt(e.parent,e.endOffset,t)}static _createBefore(e,t){if(!e.parent)throw new p("model-position-before-root",e,{root:e});return this._createAt(e.parent,e.startOffset,t)}static fromJSON(e,t){if(e.root==="$graveyard"){const n=new x(t.graveyard,e.path);return n.stickiness=e.stickiness,n}if(!t.getRoot(e.root))throw new p("model-position-fromjson-no-root",t,{rootName:e.root});return new x(t.getRoot(e.root),e.path,e.stickiness)}}function Tn(i,e){const t=e.getChild(e.offsetToIndex(i.offset));return t&&t.is("$text")&&t.startOffset<i.offset?t:null}function Ro(i,e,t){return t!==null?null:e.getChild(e.offsetToIndex(i.offset))}function Gc(i,e,t){return t!==null?null:e.getChild(e.offsetToIndex(i.offset)-1)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class E{constructor(e,t=null){this.start=x._createAt(e),this.end=t?x._createAt(t):x._createAt(e),this.start.stickiness=this.isCollapsed?"toNone":"toNext",this.end.stickiness=this.isCollapsed?"toNone":"toPrevious"}*[Symbol.iterator](){yield*new St({boundaries:this,ignoreElementEnd:!0})}get isCollapsed(){return this.start.isEqual(this.end)}get isFlat(){const e=this.start.getParentPath(),t=this.end.getParentPath();return Me(e,t)=="same"}get root(){return this.start.root}containsPosition(e){return e.isAfter(this.start)&&e.isBefore(this.end)}containsRange(e,t=!1){e.isCollapsed&&(t=!1);const n=this.containsPosition(e.start)||t&&this.start.isEqual(e.start),s=this.containsPosition(e.end)||t&&this.end.isEqual(e.end);return n&&s}containsItem(e){const t=x._createBefore(e);return this.containsPosition(t)||this.start.isEqual(t)}is(e){return e==="range"||e==="model:range"}isEqual(e){return this.start.isEqual(e.start)&&this.end.isEqual(e.end)}isIntersecting(e){return this.start.isBefore(e.end)&&this.end.isAfter(e.start)}getDifference(e){const t=[];return this.isIntersecting(e)?(this.containsPosition(e.start)&&t.push(new E(this.start,e.start)),this.containsPosition(e.end)&&t.push(new E(e.end,this.end))):t.push(new E(this.start,this.end)),t}getIntersection(e){if(this.isIntersecting(e)){let t=this.start,n=this.end;return this.containsPosition(e.start)&&(t=e.start),this.containsPosition(e.end)&&(n=e.end),new E(t,n)}return null}getJoined(e,t=!1){let n=this.isIntersecting(e);if(n||(this.start.isBefore(e.start)?n=t?this.end.isTouching(e.start):this.end.isEqual(e.start):n=t?e.end.isTouching(this.start):e.end.isEqual(this.start)),!n)return null;let s=this.start,o=this.end;return e.start.isBefore(s)&&(s=e.start),e.end.isAfter(o)&&(o=e.end),new E(s,o)}getMinimalFlatRanges(){const e=[],t=this.start.getCommonPath(this.end).length,n=x._createAt(this.start);let s=n.parent;for(;n.path.length>t+1;){const o=s.maxOffset-n.offset;o!==0&&e.push(new E(n,n.getShiftedBy(o))),n.path=n.path.slice(0,-1),n.offset++,s=s.parent}for(;n.path.length<=this.end.path.length;){const o=this.end.path[n.path.length-1],r=o-n.offset;r!==0&&e.push(new E(n,n.getShiftedBy(r))),n.offset=o,n.path.push(0)}return e}getWalker(e={}){return e.boundaries=this,new St(e)}*getItems(e={}){e.boundaries=this,e.ignoreElementEnd=!0;const t=new St(e);for(const n of t)yield n.item}*getPositions(e={}){e.boundaries=this;const t=new St(e);yield t.position;for(const n of t)yield n.nextPosition}getTransformedByOperation(e){switch(e.type){case"insert":return this._getTransformedByInsertOperation(e);case"move":case"remove":case"reinsert":return this._getTransformedByMoveOperation(e);case"split":return[this._getTransformedBySplitOperation(e)];case"merge":return[this._getTransformedByMergeOperation(e)]}return[new E(this.start,this.end)]}getTransformedByOperations(e){const t=[new E(this.start,this.end)];for(const n of e)for(let s=0;s<t.length;s++){const o=t[s].getTransformedByOperation(n);t.splice(s,1,...o),s+=o.length-1}for(let n=0;n<t.length;n++){const s=t[n];for(let o=n+1;o<t.length;o++){const r=t[o];(s.containsRange(r)||r.containsRange(s)||s.isEqual(r))&&t.splice(o,1)}}return t}getCommonAncestor(){return this.start.getCommonAncestor(this.end)}getContainedElement(){if(this.isCollapsed)return null;const e=this.start.nodeAfter,t=this.end.nodeBefore;return e&&e.is("element")&&e===t?e:null}toJSON(){return{start:this.start.toJSON(),end:this.end.toJSON()}}clone(){return new this.constructor(this.start,this.end)}_getTransformedByInsertOperation(e,t=!1){return this._getTransformedByInsertion(e.position,e.howMany,t)}_getTransformedByMoveOperation(e,t=!1){const n=e.sourcePosition,s=e.howMany,o=e.targetPosition;return this._getTransformedByMove(n,o,s,t)}_getTransformedBySplitOperation(e){const t=this.start._getTransformedBySplitOperation(e);let n=this.end._getTransformedBySplitOperation(e);return this.end.isEqual(e.insertionPosition)&&(n=this.end.getShiftedBy(1)),t.root!=n.root&&(n=this.end.getShiftedBy(-1)),new E(t,n)}_getTransformedByMergeOperation(e){if(this.start.isEqual(e.targetPosition)&&this.end.isEqual(e.deletionPosition))return new E(this.start);let t=this.start._getTransformedByMergeOperation(e),n=this.end._getTransformedByMergeOperation(e);return t.root!=n.root&&(n=this.end.getShiftedBy(-1)),t.isAfter(n)?(e.sourcePosition.isBefore(e.targetPosition)?(t=x._createAt(n),t.offset=0):(e.deletionPosition.isEqual(t)||(n=e.deletionPosition),t=e.targetPosition),new E(t,n)):new E(t,n)}_getTransformedByInsertion(e,t,n=!1){if(n&&this.containsPosition(e))return[new E(this.start,e),new E(e.getShiftedBy(t),this.end._getTransformedByInsertion(e,t))];{const s=new E(this.start,this.end);return s.start=s.start._getTransformedByInsertion(e,t),s.end=s.end._getTransformedByInsertion(e,t),[s]}}_getTransformedByMove(e,t,n,s=!1){if(this.isCollapsed){const d=this.start._getTransformedByMove(e,t,n);return[new E(d)]}const o=E._createFromPositionAndShift(e,n),r=t._getTransformedByDeletion(e,n);if(this.containsPosition(t)&&!s&&(o.containsPosition(this.start)||o.containsPosition(this.end))){const d=this.start._getTransformedByMove(e,t,n),f=this.end._getTransformedByMove(e,t,n);return[new E(d,f)]}let a;const l=this.getDifference(o);let c=null;const u=this.getIntersection(o);if(l.length==1?c=new E(l[0].start._getTransformedByDeletion(e,n),l[0].end._getTransformedByDeletion(e,n)):l.length==2&&(c=new E(this.start,this.end._getTransformedByDeletion(e,n))),c?a=c._getTransformedByInsertion(r,n,u!==null||s):a=[],u){const d=new E(u.start._getCombined(o.start,r),u.end._getCombined(o.start,r));a.length==2?a.splice(1,0,d):a.push(d)}return a}_getTransformedByDeletion(e,t){let n=this.start._getTransformedByDeletion(e,t),s=this.end._getTransformedByDeletion(e,t);return n==null&&s==null?null:(n==null&&(n=e),s==null&&(s=e),new E(n,s))}static _createFromPositionAndShift(e,t){const n=e,s=e.getShiftedBy(t);return t>0?new this(n,s):new this(s,n)}static _createIn(e){return new this(x._createAt(e,0),x._createAt(e,e.maxOffset))}static _createOn(e){return this._createFromPositionAndShift(x._createBefore(e),e.offsetSize)}static _createFromRanges(e){if(e.length===0)throw new p("range-create-from-ranges-empty-array",null);if(e.length==1)return e[0].clone();const t=e[0];e.sort((o,r)=>o.start.isAfter(r.start)?1:-1);const n=e.indexOf(t),s=new this(t.start,t.end);if(n>0)for(let o=n-1;e[o].end.isEqual(s.start);o++)s.start=x._createAt(e[o].start);for(let o=n+1;o<e.length&&e[o].start.isEqual(s.end);o++)s.end=x._createAt(e[o].end);return s}static fromJSON(e,t){return new this(x.fromJSON(e.start,t),x.fromJSON(e.end,t))}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Mo{constructor(){this._modelToViewMapping=new WeakMap,this._viewToModelMapping=new WeakMap,this._viewToModelLengthCallbacks=new Map,this._markerNameToElements=new Map,this._elementToMarkerNames=new Map,this._unboundMarkerNames=new Set,this.on("modelToViewPosition",(e,t)=>{if(t.viewPosition)return;const n=this._modelToViewMapping.get(t.modelPosition.parent);t.viewPosition=this.findPositionIn(n,t.modelPosition.offset)},{priority:"low"}),this.on("viewToModelPosition",(e,t)=>{if(t.modelPosition)return;const n=this.findMappedViewAncestor(t.viewPosition),s=this._viewToModelMapping.get(n),o=this._toModelOffset(t.viewPosition.parent,t.viewPosition.offset,n);t.modelPosition=x._createAt(s,o)},{priority:"low"})}bindElements(e,t){this._modelToViewMapping.set(e,t),this._viewToModelMapping.set(t,e)}unbindViewElement(e){const t=this.toModelElement(e);if(this._viewToModelMapping.delete(e),this._elementToMarkerNames.has(e))for(const n of this._elementToMarkerNames.get(e))this._unboundMarkerNames.add(n);this._modelToViewMapping.get(t)==e&&this._modelToViewMapping.delete(t)}unbindModelElement(e){const t=this.toViewElement(e);this._modelToViewMapping.delete(e),this._viewToModelMapping.get(t)==e&&this._viewToModelMapping.delete(t)}bindElementToMarker(e,t){const n=this._markerNameToElements.get(t)||new Set;n.add(e);const s=this._elementToMarkerNames.get(e)||new Set;s.add(t),this._markerNameToElements.set(t,n),this._elementToMarkerNames.set(e,s)}unbindElementFromMarkerName(e,t){const n=this._markerNameToElements.get(t);n&&(n.delete(e),n.size==0&&this._markerNameToElements.delete(t));const s=this._elementToMarkerNames.get(e);s&&(s.delete(t),s.size==0&&this._elementToMarkerNames.delete(e))}flushUnboundMarkerNames(){const e=Array.from(this._unboundMarkerNames);return this._unboundMarkerNames.clear(),e}clearBindings(){this._modelToViewMapping=new WeakMap,this._viewToModelMapping=new WeakMap,this._markerNameToElements=new Map,this._elementToMarkerNames=new Map,this._unboundMarkerNames=new Set}toModelElement(e){return this._viewToModelMapping.get(e)}toViewElement(e){return this._modelToViewMapping.get(e)}toModelRange(e){return new E(this.toModelPosition(e.start),this.toModelPosition(e.end))}toViewRange(e){return new z(this.toViewPosition(e.start),this.toViewPosition(e.end))}toModelPosition(e){const t={viewPosition:e,mapper:this};return this.fire("viewToModelPosition",t),t.modelPosition}toViewPosition(e,t={isPhantom:!1}){const n={modelPosition:e,mapper:this,isPhantom:t.isPhantom};return this.fire("modelToViewPosition",n),n.viewPosition}markerNameToElements(e){const t=this._markerNameToElements.get(e);if(!t)return null;const n=new Set;for(const s of t)if(s.is("attributeElement"))for(const o of s.getElementsWithSameId())n.add(o);else n.add(s);return n}registerViewToModelLength(e,t){this._viewToModelLengthCallbacks.set(e,t)}findMappedViewAncestor(e){let t=e.parent;for(;!this._viewToModelMapping.has(t);)t=t.parent;return t}_toModelOffset(e,t,n){if(n!=e){const o=this._toModelOffset(e.parent,e.index,n),r=this._toModelOffset(e,t,e);return o+r}if(e.is("$text"))return t;let s=0;for(let o=0;o<t;o++)s+=this.getModelLength(e.getChild(o));return s}getModelLength(e){if(this._viewToModelLengthCallbacks.get(e.name))return this._viewToModelLengthCallbacks.get(e.name)(e);if(this._viewToModelMapping.has(e))return 1;if(e.is("$text"))return e.data.length;if(e.is("uiElement"))return 0;{let t=0;for(const n of e.getChildren())t+=this.getModelLength(n);return t}}findPositionIn(e,t){let n,s=0,o=0,r=0;if(e.is("$text"))return new I(e,t);for(;o<t;)n=e.getChild(r),s=this.getModelLength(n),o+=s,r++;return o==t?this._moveViewPositionToTextNode(new I(e,r)):this.findPositionIn(n,t-(o-s))}_moveViewPositionToTextNode(e){const t=e.nodeBefore,n=e.nodeAfter;return t instanceof ce?new I(t,t.data.length):n instanceof ce?new I(n,0):e}}F(Mo,oe);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ji{constructor(){this._consumable=new Map,this._textProxyRegistry=new Map}add(e,t){t=Qi(t),e instanceof ft&&(e=this._getSymbolForTextProxy(e)),this._consumable.has(e)||this._consumable.set(e,new Map),this._consumable.get(e).set(t,!0)}consume(e,t){return t=Qi(t),e instanceof ft&&(e=this._getSymbolForTextProxy(e)),this.test(e,t)?(this._consumable.get(e).set(t,!1),!0):!1}test(e,t){t=Qi(t),e instanceof ft&&(e=this._getSymbolForTextProxy(e));const n=this._consumable.get(e);if(n===void 0)return null;const s=n.get(t);return s===void 0?null:s}revert(e,t){t=Qi(t),e instanceof ft&&(e=this._getSymbolForTextProxy(e));const n=this.test(e,t);return n===!1?(this._consumable.get(e).set(t,!0),!0):n===!0?!1:null}_getSymbolForTextProxy(e){let t=null;const n=this._textProxyRegistry.get(e.startOffset);if(n){const s=n.get(e.endOffset);s&&(t=s.get(e.parent))}return t||(t=this._addSymbolForTextProxy(e.startOffset,e.endOffset,e.parent)),t}_addSymbolForTextProxy(e,t,n){const s=Symbol("textProxySymbol");let o,r;return o=this._textProxyRegistry.get(e),o||(o=new Map,this._textProxyRegistry.set(e,o)),r=o.get(t),r||(r=new Map,o.set(t,r)),r.set(n,s),s}}function Qi(i){const e=i.split(":");return e[0]=="addMarker"||e[0]=="removeMarker"?i:e.length>1?e[0]+":"+e[1]:e[0]}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Vo{constructor(e){this.conversionApi=Object.assign({dispatcher:this},e),this._reconversionEventsMapping=new Map}convertChanges(e,t,n){for(const o of e.getMarkersToRemove())this.convertMarkerRemove(o.name,o.range,n);const s=this._mapChangesWithAutomaticReconversion(e);for(const o of s)o.type==="insert"?this.convertInsert(E._createFromPositionAndShift(o.position,o.length),n):o.type==="remove"?this.convertRemove(o.position,o.length,o.name,n):o.type==="reconvert"?this.reconvertElement(o.element,n):this.convertAttribute(o.range,o.attributeKey,o.attributeOldValue,o.attributeNewValue,n);for(const o of this.conversionApi.mapper.flushUnboundMarkerNames()){const r=t.get(o).getRange();this.convertMarkerRemove(o,r,n),this.convertMarkerAdd(o,r,n)}for(const o of e.getMarkersToAdd())this.convertMarkerAdd(o.name,o.range,n)}convertInsert(e,t){this.conversionApi.writer=t,this.conversionApi.consumable=this._createInsertConsumable(e);for(const n of Array.from(e).map(Jc))this._convertInsertWithAttributes(n);this._clearConversionApi()}convertRemove(e,t,n,s){this.conversionApi.writer=s,this.fire("remove:"+n,{position:e,length:t},this.conversionApi),this._clearConversionApi()}convertAttribute(e,t,n,s,o){this.conversionApi.writer=o,this.conversionApi.consumable=this._createConsumableForRange(e,`attribute:${t}`);for(const r of e){const a=r.item,l=E._createFromPositionAndShift(r.previousPosition,r.length),c={item:a,range:l,attributeKey:t,attributeOldValue:n,attributeNewValue:s};this._testAndFire(`attribute:${t}`,c)}this._clearConversionApi()}reconvertElement(e,t){const n=E._createOn(e);this.conversionApi.writer=t,this.conversionApi.consumable=this._createInsertConsumable(n);const s=this.conversionApi.mapper,o=s.toViewElement(e);t.remove(o),this._convertInsertWithAttributes({item:e,range:n});const r=s.toViewElement(e);for(const a of E._createIn(e)){const{item:l}=a,c=j0(l,s);c?c.root!==r.root&&t.move(t.createRangeOn(c),s.toViewPosition(x._createBefore(l))):this._convertInsertWithAttributes(Jc(a))}s.unbindViewElement(o),this._clearConversionApi()}convertSelection(e,t,n){const s=Array.from(t.getMarkersAtPosition(e.getFirstPosition()));if(this.conversionApi.writer=n,this.conversionApi.consumable=this._createSelectionConsumable(e,s),this.fire("selection",{selection:e},this.conversionApi),!e.isCollapsed){this._clearConversionApi();return}for(const o of s){const r=o.getRange();if(!W0(e.getFirstPosition(),o,this.conversionApi.mapper))continue;const a={item:e,markerName:o.name,markerRange:r};this.conversionApi.consumable.test(e,"addMarker:"+o.name)&&this.fire("addMarker:"+o.name,a,this.conversionApi)}for(const o of e.getAttributeKeys()){const r={item:e,range:e.getFirstRange(),attributeKey:o,attributeOldValue:null,attributeNewValue:e.getAttribute(o)};this.conversionApi.consumable.test(e,"attribute:"+r.attributeKey)&&this.fire("attribute:"+r.attributeKey+":$text",r,this.conversionApi)}this._clearConversionApi()}convertMarkerAdd(e,t,n){if(t.root.rootName=="$graveyard")return;this.conversionApi.writer=n;const s="addMarker:"+e,o=new Ji;if(o.add(t,s),this.conversionApi.consumable=o,this.fire(s,{markerName:e,markerRange:t},this.conversionApi),!o.test(t,s)){this._clearConversionApi();return}this.conversionApi.consumable=this._createConsumableForRange(t,s);for(const r of t.getItems()){if(!this.conversionApi.consumable.test(r,s))continue;const a={item:r,range:E._createOn(r),markerName:e,markerRange:t};this.fire(s,a,this.conversionApi)}this._clearConversionApi()}convertMarkerRemove(e,t,n){t.root.rootName!="$graveyard"&&(this.conversionApi.writer=n,this.fire("removeMarker:"+e,{markerName:e,markerRange:t},this.conversionApi),this._clearConversionApi())}_mapReconversionTriggerEvent(e,t){this._reconversionEventsMapping.set(t,e)}_createInsertConsumable(e){const t=new Ji;for(const n of e){const s=n.item;t.add(s,"insert");for(const o of s.getAttributeKeys())t.add(s,"attribute:"+o)}return t}_createConsumableForRange(e,t){const n=new Ji;for(const s of e.getItems())n.add(s,t);return n}_createSelectionConsumable(e,t){const n=new Ji;n.add(e,"selection");for(const s of t)n.add(e,"addMarker:"+s.name);for(const s of e.getAttributeKeys())n.add(e,"attribute:"+s);return n}_testAndFire(e,t){!this.conversionApi.consumable.test(t.item,e)||this.fire(q0(e,t),t,this.conversionApi)}_clearConversionApi(){delete this.conversionApi.writer,delete this.conversionApi.consumable}_convertInsertWithAttributes(e){this._testAndFire("insert",e);for(const t of e.item.getAttributeKeys())e.attributeKey=t,e.attributeOldValue=null,e.attributeNewValue=e.item.getAttribute(t),this._testAndFire(`attribute:${t}`,e)}_mapChangesWithAutomaticReconversion(e){const t=new Set,n=[];for(const s of e.getChanges()){const o=s.position||s.range.start,r=o.parent;if(Tn(o,r)){n.push(s);continue}const l=s.type==="attribute"?Ro(o,r,null):r;if(l.is("$text")){n.push(s);continue}let c;if(s.type==="attribute"?c=`attribute:${s.attributeKey}:${l.name}`:c=`${s.type}:${s.name}`,this._isReconvertTriggerEvent(c,l.name)){if(t.has(l))continue;t.add(l),n.push({type:"reconvert",element:l})}else n.push(s)}return n}_isReconvertTriggerEvent(e,t){return this._reconversionEventsMapping.get(e)===t}}F(Vo,oe);function W0(i,e,t){const n=e.getRange(),s=Array.from(i.getAncestors());return s.shift(),s.reverse(),!s.some(r=>{if(n.containsItem(r))return!!t.toViewElement(r).getCustomProperty("addHighlight")})}function q0(i,e){const t=e.item.name||"$text";return`${i}:${t}`}function Jc(i){const e=i.item,t=E._createFromPositionAndShift(i.previousPosition,i.length);return{item:e,range:t}}function j0(i,e){if(i.is("textProxy")){const n=e.toViewPosition(x._createBefore(i)).parent;return n.is("$text")?n:null}return e.toViewElement(i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class xt{constructor(e,t,n){this._lastRangeBackward=!1,this._ranges=[],this._attrs=new Map,e&&this.setTo(e,t,n)}get anchor(){if(this._ranges.length>0){const e=this._ranges[this._ranges.length-1];return this._lastRangeBackward?e.end:e.start}return null}get focus(){if(this._ranges.length>0){const e=this._ranges[this._ranges.length-1];return this._lastRangeBackward?e.start:e.end}return null}get isCollapsed(){return this._ranges.length===1?this._ranges[0].isCollapsed:!1}get rangeCount(){return this._ranges.length}get isBackward(){return!this.isCollapsed&&this._lastRangeBackward}isEqual(e){if(this.rangeCount!=e.rangeCount)return!1;if(this.rangeCount===0)return!0;if(!this.anchor.isEqual(e.anchor)||!this.focus.isEqual(e.focus))return!1;for(const t of this._ranges){let n=!1;for(const s of e._ranges)if(t.isEqual(s)){n=!0;break}if(!n)return!1}return!0}*getRanges(){for(const e of this._ranges)yield new E(e.start,e.end)}getFirstRange(){let e=null;for(const t of this._ranges)(!e||t.start.isBefore(e.start))&&(e=t);return e?new E(e.start,e.end):null}getLastRange(){let e=null;for(const t of this._ranges)(!e||t.end.isAfter(e.end))&&(e=t);return e?new E(e.start,e.end):null}getFirstPosition(){const e=this.getFirstRange();return e?e.start.clone():null}getLastPosition(){const e=this.getLastRange();return e?e.end.clone():null}setTo(e,t,n){if(e===null)this._setRanges([]);else if(e instanceof xt)this._setRanges(e.getRanges(),e.isBackward);else if(e&&typeof e.getRanges=="function")this._setRanges(e.getRanges(),e.isBackward);else if(e instanceof E)this._setRanges([e],!!t&&!!t.backward);else if(e instanceof x)this._setRanges([new E(e)]);else if(e instanceof nn){const s=!!n&&!!n.backward;let o;if(t=="in")o=E._createIn(e);else if(t=="on")o=E._createOn(e);else if(t!==void 0)o=new E(x._createAt(e,t));else throw new p("model-selection-setto-required-second-parameter",[this,e]);this._setRanges([o],s)}else if(Ke(e))this._setRanges(e,t&&!!t.backward);else throw new p("model-selection-setto-not-selectable",[this,e])}_setRanges(e,t=!1){e=Array.from(e);const n=e.some(s=>{if(!(s instanceof E))throw new p("model-selection-set-ranges-not-range",[this,e]);return this._ranges.every(o=>!o.isEqual(s))});if(!(e.length===this._ranges.length&&!n)){this._removeAllRanges();for(const s of e)this._pushRange(s);this._lastRangeBackward=!!t,this.fire("change:range",{directChange:!0})}}setFocus(e,t){if(this.anchor===null)throw new p("model-selection-setfocus-no-ranges",[this,e]);const n=x._createAt(e,t);if(n.compareWith(this.focus)=="same")return;const s=this.anchor;this._ranges.length&&this._popRange(),n.compareWith(s)=="before"?(this._pushRange(new E(n,s)),this._lastRangeBackward=!0):(this._pushRange(new E(s,n)),this._lastRangeBackward=!1),this.fire("change:range",{directChange:!0})}getAttribute(e){return this._attrs.get(e)}getAttributes(){return this._attrs.entries()}getAttributeKeys(){return this._attrs.keys()}hasAttribute(e){return this._attrs.has(e)}removeAttribute(e){this.hasAttribute(e)&&(this._attrs.delete(e),this.fire("change:attribute",{attributeKeys:[e],directChange:!0}))}setAttribute(e,t){this.getAttribute(e)!==t&&(this._attrs.set(e,t),this.fire("change:attribute",{attributeKeys:[e],directChange:!0}))}getSelectedElement(){return this.rangeCount!==1?null:this.getFirstRange().getContainedElement()}is(e){return e==="selection"||e==="model:selection"}*getSelectedBlocks(){const e=new WeakSet;for(const t of this.getRanges()){const n=Yc(t.start,e);n&&Oo(n,t)&&(yield n);for(const o of t.getWalker()){const r=o.item;o.type=="elementEnd"&&K0(r,e,t)&&(yield r)}const s=Yc(t.end,e);s&&!t.end.isTouching(x._createAt(s,0))&&Oo(s,t)&&(yield s)}}containsEntireContent(e=this.anchor.root){const t=x._createAt(e,0),n=x._createAt(e,"end");return t.isTouching(this.getFirstPosition())&&n.isTouching(this.getLastPosition())}_pushRange(e){this._checkRange(e),this._ranges.push(new E(e.start,e.end))}_checkRange(e){for(let t=0;t<this._ranges.length;t++)if(e.isIntersecting(this._ranges[t]))throw new p("model-selection-range-intersects",[this,e],{addedRange:e,intersectingRange:this._ranges[t]})}_removeAllRanges(){for(;this._ranges.length>0;)this._popRange()}_popRange(){this._ranges.pop()}}F(xt,oe);function Qc(i,e){return e.has(i)?!1:(e.add(i),i.root.document.model.schema.isBlock(i)&&i.parent)}function K0(i,e,t){return Qc(i,e)&&Oo(i,t)}function Yc(i,e){const n=i.parent.root.document.model.schema,s=i.parent.getAncestors({parentFirst:!0,includeSelf:!0});let o=!1;const r=s.find(a=>o?!1:(o=n.isLimit(a),!o&&Qc(a,e)));return s.forEach(a=>e.add(a)),r}function Oo(i,e){const t=G0(i);return t?!e.containsRange(E._createOn(t),!0):!0}function G0(i){const e=i.root.document.model.schema;let t=i.parent;for(;t;){if(e.isBlock(t))return t;t=t.parent}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class mt extends E{constructor(e,t){super(e,t);J0.call(this)}detach(){this.stopListening()}is(e){return e==="liveRange"||e==="model:liveRange"||e=="range"||e==="model:range"}toRange(){return new E(this.start,this.end)}static fromRange(e){return new mt(e.start,e.end)}}function J0(){this.listenTo(this.root.document.model,"applyOperation",(i,e)=>{const t=e[0];!t.isDocumentOperation||Q0.call(this,t)},{priority:"low"})}function Q0(i){const e=this.getTransformedByOperation(i),t=E._createFromRanges(e),n=!t.isEqual(this),s=Y0(this,i);let o=null;if(n){t.root.rootName=="$graveyard"&&(i.type=="remove"?o=i.sourcePosition:o=i.deletionPosition);const r=this.toRange();this.start=t.start,this.end=t.end,this.fire("change:range",r,{deletionPosition:o})}else s&&this.fire("change:content",this.toRange(),{deletionPosition:o})}function Y0(i,e){switch(e.type){case"insert":return i.containsPosition(e.position);case"move":case"remove":case"reinsert":case"merge":return i.containsPosition(e.sourcePosition)||i.start.isEqual(e.sourcePosition)||i.containsPosition(e.targetPosition);case"split":return i.containsPosition(e.splitPosition)||i.containsPosition(e.insertionPosition)}return!1}F(mt,oe);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const ci="selection:";class tt{constructor(e){this._selection=new X0(e),this._selection.delegate("change:range").to(this),this._selection.delegate("change:attribute").to(this),this._selection.delegate("change:marker").to(this)}get isCollapsed(){return this._selection.isCollapsed}get anchor(){return this._selection.anchor}get focus(){return this._selection.focus}get rangeCount(){return this._selection.rangeCount}get hasOwnRange(){return this._selection.hasOwnRange}get isBackward(){return this._selection.isBackward}get isGravityOverridden(){return this._selection.isGravityOverridden}get markers(){return this._selection.markers}get _ranges(){return this._selection._ranges}getRanges(){return this._selection.getRanges()}getFirstPosition(){return this._selection.getFirstPosition()}getLastPosition(){return this._selection.getLastPosition()}getFirstRange(){return this._selection.getFirstRange()}getLastRange(){return this._selection.getLastRange()}getSelectedBlocks(){return this._selection.getSelectedBlocks()}getSelectedElement(){return this._selection.getSelectedElement()}containsEntireContent(e){return this._selection.containsEntireContent(e)}destroy(){this._selection.destroy()}getAttributeKeys(){return this._selection.getAttributeKeys()}getAttributes(){return this._selection.getAttributes()}getAttribute(e){return this._selection.getAttribute(e)}hasAttribute(e){return this._selection.hasAttribute(e)}refresh(){this._selection._updateMarkers(),this._selection._updateAttributes(!1)}observeMarkers(e){this._selection.observeMarkers(e)}is(e){return e==="selection"||e=="model:selection"||e=="documentSelection"||e=="model:documentSelection"}_setFocus(e,t){this._selection.setFocus(e,t)}_setTo(e,t,n){this._selection.setTo(e,t,n)}_setAttribute(e,t){this._selection.setAttribute(e,t)}_removeAttribute(e){this._selection.removeAttribute(e)}_getStoredAttributes(){return this._selection._getStoredAttributes()}_overrideGravity(){return this._selection.overrideGravity()}_restoreGravity(e){this._selection.restoreGravity(e)}static _getStoreAttributeKey(e){return ci+e}static _isStoreAttributeKey(e){return e.startsWith(ci)}}F(tt,oe);class X0 extends xt{constructor(e){super();this.markers=new $e({idProperty:"name"}),this._model=e.model,this._document=e,this._attributePriority=new Map,this._selectionRestorePosition=null,this._hasChangedRange=!1,this._overriddenGravityRegister=new Set,this._observedMarkers=new Set,this.listenTo(this._model,"applyOperation",(t,n)=>{const s=n[0];!s.isDocumentOperation||s.type=="marker"||s.type=="rename"||s.type=="noop"||(this._ranges.length==0&&this._selectionRestorePosition&&this._fixGraveyardSelection(this._selectionRestorePosition),this._selectionRestorePosition=null,this._hasChangedRange&&(this._hasChangedRange=!1,this.fire("change:range",{directChange:!1})))},{priority:"lowest"}),this.on("change:range",()=>{for(const t of this.getRanges())if(!this._document._validateSelectionRange(t))throw new p("document-selection-wrong-position",this,{range:t})}),this.listenTo(this._model.markers,"update",(t,n,s,o)=>{this._updateMarker(n,o)}),this.listenTo(this._document,"change",(t,n)=>{Z0(this._model,n)})}get isCollapsed(){return this._ranges.length===0?this._document._getDefaultRange().isCollapsed:super.isCollapsed}get anchor(){return super.anchor||this._document._getDefaultRange().start}get focus(){return super.focus||this._document._getDefaultRange().end}get rangeCount(){return this._ranges.length?this._ranges.length:1}get hasOwnRange(){return this._ranges.length>0}get isGravityOverridden(){return!!this._overriddenGravityRegister.size}destroy(){for(let e=0;e<this._ranges.length;e++)this._ranges[e].detach();this.stopListening()}*getRanges(){this._ranges.length?yield*super.getRanges():yield this._document._getDefaultRange()}getFirstRange(){return super.getFirstRange()||this._document._getDefaultRange()}getLastRange(){return super.getLastRange()||this._document._getDefaultRange()}setTo(e,t,n){super.setTo(e,t,n),this._updateAttributes(!0),this._updateMarkers()}setFocus(e,t){super.setFocus(e,t),this._updateAttributes(!0),this._updateMarkers()}setAttribute(e,t){if(this._setAttribute(e,t)){const n=[e];this.fire("change:attribute",{attributeKeys:n,directChange:!0})}}removeAttribute(e){if(this._removeAttribute(e)){const t=[e];this.fire("change:attribute",{attributeKeys:t,directChange:!0})}}overrideGravity(){const e=rt();return this._overriddenGravityRegister.add(e),this._overriddenGravityRegister.size===1&&this._updateAttributes(!0),e}restoreGravity(e){if(!this._overriddenGravityRegister.has(e))throw new p("document-selection-gravity-wrong-restore",this,{uid:e});this._overriddenGravityRegister.delete(e),this.isGravityOverridden||this._updateAttributes(!0)}observeMarkers(e){this._observedMarkers.add(e),this._updateMarkers()}_popRange(){this._ranges.pop().detach()}_pushRange(e){const t=this._prepareRange(e);t&&this._ranges.push(t)}_prepareRange(e){if(this._checkRange(e),e.root==this._document.graveyard)return;const t=mt.fromRange(e);return t.on("change:range",(n,s,o)=>{if(this._hasChangedRange=!0,t.root==this._document.graveyard){this._selectionRestorePosition=o.deletionPosition;const r=this._ranges.indexOf(t);this._ranges.splice(r,1),t.detach()}}),t}_updateMarkers(){if(!this._observedMarkers.size)return;const e=[];let t=!1;for(const s of this._model.markers){const o=s.name.split(":",1)[0];if(!this._observedMarkers.has(o))continue;const r=s.getRange();for(const a of this.getRanges())r.containsRange(a,!a.isCollapsed)&&e.push(s)}const n=Array.from(this.markers);for(const s of e)this.markers.has(s)||(this.markers.add(s),t=!0);for(const s of Array.from(this.markers))e.includes(s)||(this.markers.remove(s),t=!0);t&&this.fire("change:marker",{oldMarkers:n,directChange:!1})}_updateMarker(e,t){const n=e.name.split(":",1)[0];if(!this._observedMarkers.has(n))return;let s=!1;const o=Array.from(this.markers),r=this.markers.has(e);if(!t)r&&(this.markers.remove(e),s=!0);else{let a=!1;for(const l of this.getRanges())if(t.containsRange(l,!l.isCollapsed)){a=!0;break}a&&!r?(this.markers.add(e),s=!0):!a&&r&&(this.markers.remove(e),s=!0)}s&&this.fire("change:marker",{oldMarkers:o,directChange:!1})}_updateAttributes(e){const t=Tt(this._getSurroundingAttributes()),n=Tt(this.getAttributes());if(e)this._attributePriority=new Map,this._attrs=new Map;else for(const[o,r]of this._attributePriority)r=="low"&&(this._attrs.delete(o),this._attributePriority.delete(o));this._setAttributesTo(t);const s=[];for(const[o,r]of this.getAttributes())(!n.has(o)||n.get(o)!==r)&&s.push(o);for(const[o]of n)this.hasAttribute(o)||s.push(o);s.length>0&&this.fire("change:attribute",{attributeKeys:s,directChange:!1})}_setAttribute(e,t,n=!0){const s=n?"normal":"low";return s=="low"&&this._attributePriority.get(e)=="normal"||super.getAttribute(e)===t?!1:(this._attrs.set(e,t),this._attributePriority.set(e,s),!0)}_removeAttribute(e,t=!0){const n=t?"normal":"low";return n=="low"&&this._attributePriority.get(e)=="normal"||(this._attributePriority.set(e,n),!super.hasAttribute(e))?!1:(this._attrs.delete(e),!0)}_setAttributesTo(e){const t=new Set;for(const[n,s]of this.getAttributes())e.get(n)!==s&&this._removeAttribute(n,!1);for(const[n,s]of e)this._setAttribute(n,s,!1)&&t.add(n);return t}*_getStoredAttributes(){const e=this.getFirstPosition().parent;if(this.isCollapsed&&e.isEmpty)for(const t of e.getAttributeKeys())t.startsWith(ci)&&(yield[t.substr(ci.length),e.getAttribute(t)])}_getSurroundingAttributes(){const e=this.getFirstPosition(),t=this._model.schema;let n=null;if(this.isCollapsed){const s=e.textNode?e.textNode:e.nodeBefore,o=e.textNode?e.textNode:e.nodeAfter;if(this.isGravityOverridden||(n=Yi(s)),n||(n=Yi(o)),!this.isGravityOverridden&&!n){let r=s;for(;r&&!t.isInline(r)&&!n;)r=r.previousSibling,n=Yi(r)}if(!n){let r=o;for(;r&&!t.isInline(r)&&!n;)r=r.nextSibling,n=Yi(r)}n||(n=this._getStoredAttributes())}else{const s=this.getFirstRange();for(const o of s){if(o.item.is("element")&&t.isObject(o.item))break;if(o.type=="text"){n=o.item.getAttributes();break}}}return n}_fixGraveyardSelection(e){const t=this._model.schema.getNearestSelectionRange(e);t&&this._pushRange(t)}}function Yi(i){return i instanceof ft||i instanceof ue?i.getAttributes():null}function Z0(i,e){const t=i.document.differ;for(const n of t.getChanges()){if(n.type!="insert")continue;const s=n.position.parent;n.length===s.maxOffset&&i.enqueueChange(e,r=>{const a=Array.from(s.getAttributeKeys()).filter(l=>l.startsWith(ci));for(const l of a)r.removeAttribute(l,s)})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Xc{constructor(e){this._dispatchers=e}add(e){for(const t of this._dispatchers)e(t);return this}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ey extends Xc{elementToElement(e){return this.add(wy(e))}attributeToElement(e){return this.add(by(e))}attributeToAttribute(e){return this.add(_y(e))}markerToElement(e){return this.add(vy(e))}markerToHighlight(e){return this.add(Cy(e))}markerToData(e){return this.add(yy(e))}}function Zc(){return(i,e,t)=>{if(!t.consumable.consume(e.item,"insert"))return;const n=t.writer,s=t.mapper.toViewPosition(e.range.start),o=n.createText(e.item.data);n.insert(s,o)}}function ty(){return(i,e,t)=>{const n=t.mapper.toViewPosition(e.position),s=e.position.getShiftedBy(e.length),o=t.mapper.toViewPosition(s,{isPhantom:!0}),r=t.writer.createRange(n,o),a=t.writer.remove(r.getTrimmed());for(const l of t.writer.createRangeIn(a).getItems())t.mapper.unbindViewElement(l)}}function eu(i,e){const t=i.createAttributeElement("span",e.attributes);return e.classes&&t._addClass(e.classes),typeof e.priority=="number"&&(t._priority=e.priority),t._id=e.id,t}function ny(){return(i,e,t)=>{const n=e.selection;if(n.isCollapsed||!t.consumable.consume(n,"selection"))return;const s=[];for(const o of n.getRanges()){const r=t.mapper.toViewRange(o);s.push(r)}t.writer.setSelection(s,{backward:n.isBackward})}}function iy(){return(i,e,t)=>{const n=e.selection;if(!n.isCollapsed||!t.consumable.consume(n,"selection"))return;const s=t.writer,o=n.getFirstPosition(),r=t.mapper.toViewPosition(o),a=s.breakAttributes(r);s.setSelection(a)}}function sy(){return(i,e,t)=>{const n=t.writer,s=n.document.selection;for(const o of s.getRanges())o.isCollapsed&&o.end.parent.isAttached()&&t.writer.mergeAttributes(o.start);n.setSelection(null)}}function oy(i){return(e,t,n)=>{const s=i(t.attributeOldValue,n),o=i(t.attributeNewValue,n);if(!s&&!o||!n.consumable.consume(t.item,e.name))return;const r=n.writer,a=r.document.selection;if(t.item instanceof xt||t.item instanceof tt)r.wrap(a.getFirstRange(),o);else{let l=n.mapper.toViewRange(t.range);t.attributeOldValue!==null&&s&&(l=r.unwrap(l,s)),t.attributeNewValue!==null&&o&&r.wrap(l,o)}}}function ry(i){return(e,t,n)=>{const s=i(t.item,n);if(!s||!n.consumable.consume(t.item,"insert"))return;const o=n.mapper.toViewPosition(t.range.start);n.mapper.bindElements(t.item,s),n.writer.insert(o,s)}}function ay(i){return(e,t,n)=>{t.isOpening=!0;const s=i(t,n);t.isOpening=!1;const o=i(t,n);if(!s||!o)return;const r=t.markerRange;if(r.isCollapsed&&!n.consumable.consume(r,e.name))return;for(const c of r)if(!n.consumable.consume(c.item,e.name))return;const a=n.mapper,l=n.writer;l.insert(a.toViewPosition(r.start),s),n.mapper.bindElementToMarker(s,t.markerName),r.isCollapsed||(l.insert(a.toViewPosition(r.end),o),n.mapper.bindElementToMarker(o,t.markerName)),e.stop()}}function ly(){return(i,e,t)=>{const n=t.mapper.markerNameToElements(e.markerName);if(!!n){for(const s of n)t.mapper.unbindElementFromMarkerName(s,e.markerName),t.writer.clear(t.writer.createRangeOn(s),s);t.writer.clearClonedElementsGroup(e.markerName),i.stop()}}}function cy(i){return(e,t,n)=>{const s=i(t.markerName,n);if(!s)return;const o=t.markerRange;!n.consumable.consume(o,e.name)||(tu(o,!1,n,t,s),tu(o,!0,n,t,s),e.stop())}}function tu(i,e,t,n,s){const o=e?i.start:i.end,r=o.nodeAfter&&o.nodeAfter.is("element")?o.nodeAfter:null,a=o.nodeBefore&&o.nodeBefore.is("element")?o.nodeBefore:null;if(r||a){let c,u;e&&r||!e&&!a?(c=r,u=!0):(c=a,u=!1);const d=t.mapper.toViewElement(c);if(d){uy(d,e,u,t,n,s);return}}const l=t.mapper.toViewPosition(o);dy(l,e,t,n,s)}function uy(i,e,t,n,s,o){const r=`data-${o.group}-${e?"start":"end"}-${t?"before":"after"}`,a=i.hasAttribute(r)?i.getAttribute(r).split(","):[];a.unshift(o.name),n.writer.setAttribute(r,a.join(","),i),n.mapper.bindElementToMarker(i,s.markerName)}function dy(i,e,t,n,s){const o=`${s.group}-${e?"start":"end"}`,r=s.name?{name:s.name}:null,a=t.writer.createUIElement(o,r);t.writer.insert(i,a),t.mapper.bindElementToMarker(a,n.markerName)}function hy(i){return(e,t,n)=>{const s=i(t.markerName,n);if(!s)return;const o=n.mapper.markerNameToElements(t.markerName);if(!o)return;for(const a of o)n.mapper.unbindElementFromMarkerName(a,t.markerName),a.is("containerElement")?(r(`data-${s.group}-start-before`,a),r(`data-${s.group}-start-after`,a),r(`data-${s.group}-end-before`,a),r(`data-${s.group}-end-after`,a)):n.writer.clear(n.writer.createRangeOn(a),a);n.writer.clearClonedElementsGroup(t.markerName),e.stop();function r(a,l){if(l.hasAttribute(a)){const c=new Set(l.getAttribute(a).split(","));c.delete(s.name),c.size==0?n.writer.removeAttribute(a,l):n.writer.setAttribute(a,Array.from(c).join(","),l)}}}}function fy(i){return(e,t,n)=>{const s=i(t.attributeOldValue,n),o=i(t.attributeNewValue,n);if(!s&&!o||!n.consumable.consume(t.item,e.name))return;const r=n.mapper.toViewElement(t.item),a=n.writer;if(!r)throw new p("conversion-attribute-to-attribute-on-text",[t,n]);if(t.attributeOldValue!==null&&s)if(s.key=="class"){const l=Ee(s.value);for(const c of l)a.removeClass(c,r)}else if(s.key=="style"){const l=Object.keys(s.value);for(const c of l)a.removeStyle(c,r)}else a.removeAttribute(s.key,r);if(t.attributeNewValue!==null&&o)if(o.key=="class"){const l=Ee(o.value);for(const c of l)a.addClass(c,r)}else if(o.key=="style"){const l=Object.keys(o.value);for(const c of l)a.setStyle(c,o.value[c],r)}else a.setAttribute(o.key,o.value,r)}}function my(i){return(e,t,n)=>{if(!t.item||!(t.item instanceof xt||t.item instanceof tt)&&!t.item.is("$textProxy"))return;const s=No(i,t,n);if(!s||!n.consumable.consume(t.item,e.name))return;const o=n.writer,r=eu(o,s),a=o.document.selection;if(t.item instanceof xt||t.item instanceof tt)o.wrap(a.getFirstRange(),r,a);else{const l=n.mapper.toViewRange(t.range),c=o.wrap(l,r);for(const u of c.getItems())if(u.is("attributeElement")&&u.isSimilar(r)){n.mapper.bindElementToMarker(u,t.markerName);break}}}}function gy(i){return(e,t,n)=>{if(!t.item||!(t.item instanceof ne))return;const s=No(i,t,n);if(!s||!n.consumable.test(t.item,e.name))return;const o=n.mapper.toViewElement(t.item);if(o&&o.getCustomProperty("addHighlight")){n.consumable.consume(t.item,e.name);for(const r of E._createIn(t.item))n.consumable.consume(r.item,e.name);o.getCustomProperty("addHighlight")(o,s,n.writer),n.mapper.bindElementToMarker(o,t.markerName)}}}function py(i){return(e,t,n)=>{if(t.markerRange.isCollapsed)return;const s=No(i,t,n);if(!s)return;const o=eu(n.writer,s),r=n.mapper.markerNameToElements(t.markerName);if(!!r){for(const a of r)n.mapper.unbindElementFromMarkerName(a,t.markerName),a.is("attributeElement")?n.writer.unwrap(n.writer.createRangeOn(a),o):a.getCustomProperty("removeHighlight")(a,s.id,n.writer);n.writer.clearClonedElementsGroup(t.markerName),e.stop()}}}function wy(i){return i=ct(i),i.view=Xi(i.view,"container"),e=>{if(e.on("insert:"+i.model,ry(i.view),{priority:i.converterPriority||"normal"}),i.triggerBy){if(i.triggerBy.attributes)for(const t of i.triggerBy.attributes)e._mapReconversionTriggerEvent(i.model,`attribute:${t}:${i.model}`);if(i.triggerBy.children)for(const t of i.triggerBy.children)e._mapReconversionTriggerEvent(i.model,`insert:${t}`),e._mapReconversionTriggerEvent(i.model,`remove:${t}`)}}}function by(i){i=ct(i);const e=i.model.key?i.model.key:i.model;let t="attribute:"+e;if(i.model.name&&(t+=":"+i.model.name),i.model.values)for(const s of i.model.values)i.view[s]=Xi(i.view[s],"attribute");else i.view=Xi(i.view,"attribute");const n=nu(i);return s=>{s.on(t,oy(n),{priority:i.converterPriority||"normal"})}}function _y(i){i=ct(i);const e=i.model.key?i.model.key:i.model;let t="attribute:"+e;if(i.model.name&&(t+=":"+i.model.name),i.model.values)for(const s of i.model.values)i.view[s]=iu(i.view[s]);else i.view=iu(i.view);const n=nu(i);return s=>{s.on(t,fy(n),{priority:i.converterPriority||"normal"})}}function vy(i){return i=ct(i),i.view=Xi(i.view,"ui"),e=>{e.on("addMarker:"+i.model,ay(i.view),{priority:i.converterPriority||"normal"}),e.on("removeMarker:"+i.model,ly(i.view),{priority:i.converterPriority||"normal"})}}function yy(i){i=ct(i);const e=i.model;return i.view||(i.view=t=>({group:e,name:t.substr(i.model.length+1)})),t=>{t.on("addMarker:"+e,cy(i.view),{priority:i.converterPriority||"normal"}),t.on("removeMarker:"+e,hy(i.view),{priority:i.converterPriority||"normal"})}}function Cy(i){return e=>{e.on("addMarker:"+i.model,my(i.view),{priority:i.converterPriority||"normal"}),e.on("addMarker:"+i.model,gy(i.view),{priority:i.converterPriority||"normal"}),e.on("removeMarker:"+i.model,py(i.view),{priority:i.converterPriority||"normal"})}}function Xi(i,e){return typeof i=="function"?i:(t,n)=>ky(i,n,e)}function ky(i,e,t){typeof i=="string"&&(i={name:i});let n;const s=e.writer,o=Object.assign({},i.attributes);if(t=="container")n=s.createContainerElement(i.name,o);else if(t=="attribute"){const r={priority:i.priority||vn.DEFAULT_PRIORITY};n=s.createAttributeElement(i.name,o,r)}else n=s.createUIElement(i.name,o);if(i.styles){const r=Object.keys(i.styles);for(const a of r)s.setStyle(a,i.styles[a],n)}if(i.classes){const r=i.classes;if(typeof r=="string")s.addClass(r,n);else for(const a of r)s.addClass(a,n)}return n}function nu(i){return i.model.values?(e,t)=>{const n=i.view[e];return n?n(e,t):null}:i.view}function iu(i){return typeof i=="string"?e=>({key:i,value:e}):typeof i=="object"?i.value?()=>i:e=>({key:i.key,value:e}):i}function No(i,e,t){const n=typeof i=="function"?i(e,t):i;return n?(n.priority||(n.priority=10),n.id||(n.id=e.markerName),n):null}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function su(i){const{schema:e,document:t}=i.model;for(const n of t.getRootNames()){const s=t.getRoot(n);if(s.isEmpty&&!e.checkChild(s,"$text")&&e.checkChild(s,"paragraph"))return i.insertElement("paragraph",s),!0}return!1}function ou(i,e,t){const n=t.createContext(i);return!(!t.checkChild(n,"paragraph")||!t.checkChild(n.push("paragraph"),e))}function ru(i,e){const t=e.createElement("paragraph");return e.insert(t,i),e.createPositionAt(t,0)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ty extends Xc{elementToElement(e){return this.add(lu(e))}elementToAttribute(e){return this.add(Sy(e))}attributeToAttribute(e){return this.add(xy(e))}elementToMarker(e){return this.add(Py(e))}dataToMarker(e){return this.add(Iy(e))}}function au(){return(i,e,t)=>{if(!e.modelRange&&t.consumable.consume(e.viewItem,{name:!0})){const{modelRange:n,modelCursor:s}=t.convertChildren(e.viewItem,e.modelCursor);e.modelRange=n,e.modelCursor=s}}}function Ey(){return(i,e,{schema:t,consumable:n,writer:s})=>{let o=e.modelCursor;if(!n.test(e.viewItem))return;if(!t.checkChild(o,"$text")){if(!ou(o,"$text",t))return;o=ru(o,s)}n.consume(e.viewItem);const r=s.createText(e.viewItem.data);s.insert(r,o),e.modelRange=s.createRange(o,o.getShiftedBy(r.offsetSize)),e.modelCursor=e.modelRange.end}}function Ay(i,e){return(t,n)=>{const s=n.newSelection,o=[];for(const a of s.getRanges())o.push(e.toModelRange(a));const r=i.createSelection(o,{backward:s.isBackward});r.isEqual(i.document.selection)||i.change(a=>{a.setSelection(r)})}}function lu(i){i=ct(i);const e=Bo(i),t=Do(i.view),n=t?"element:"+t:"element";return s=>{s.on(n,e,{priority:i.converterPriority||"normal"})}}function Sy(i){i=ct(i),cu(i);const e=uu(i,!1),t=Do(i.view),n=t?"element:"+t:"element";return s=>{s.on(n,e,{priority:i.converterPriority||"low"})}}function xy(i){i=ct(i);let e=null;(typeof i.view=="string"||i.view.key)&&(e=Vy(i)),cu(i,e);const t=uu(i,!0);return n=>{n.on("element",t,{priority:i.converterPriority||"low"})}}function Py(i){return i=ct(i),Dy(i),lu(i)}function Iy(i){i=ct(i),i.model||(i.model=n=>n?i.view+":"+n:i.view);const e=Bo(du(i,"start")),t=Bo(du(i,"end"));return n=>{n.on("element:"+i.view+"-start",e,{priority:i.converterPriority||"normal"}),n.on("element:"+i.view+"-end",t,{priority:i.converterPriority||"normal"});const s=Jn.get("low"),o=Jn.get("highest"),r=Jn.get(i.converterPriority)/o;n.on("element",Ry(i),{priority:s+r})}}function Ry(i){return(e,t,n)=>{const s=`data-${i.view}`;if(!n.consumable.test(t.viewItem,{attributes:s+"-end-after"})&&!n.consumable.test(t.viewItem,{attributes:s+"-start-after"})&&!n.consumable.test(t.viewItem,{attributes:s+"-end-before"})&&!n.consumable.test(t.viewItem,{attributes:s+"-start-before"}))return;t.modelRange||Object.assign(t,n.convertChildren(t.viewItem,t.modelCursor)),n.consumable.consume(t.viewItem,{attributes:s+"-end-after"})&&o(t.modelRange.end,t.viewItem.getAttribute(s+"-end-after").split(",")),n.consumable.consume(t.viewItem,{attributes:s+"-start-after"})&&o(t.modelRange.end,t.viewItem.getAttribute(s+"-start-after").split(",")),n.consumable.consume(t.viewItem,{attributes:s+"-end-before"})&&o(t.modelRange.start,t.viewItem.getAttribute(s+"-end-before").split(",")),n.consumable.consume(t.viewItem,{attributes:s+"-start-before"})&&o(t.modelRange.start,t.viewItem.getAttribute(s+"-start-before").split(","));function o(r,a){for(const l of a){const c=i.model(l,n),u=n.writer.createElement("$marker",{"data-name":c});n.writer.insert(u,r),t.modelCursor.isEqual(r)?t.modelCursor=t.modelCursor.getShiftedBy(1):t.modelCursor=t.modelCursor._getTransformedByInsertion(r,1),t.modelRange=t.modelRange._getTransformedByInsertion(r,1)[0]}}}}function Do(i){return typeof i=="string"?i:typeof i=="object"&&typeof i.name=="string"?i.name:null}function Bo(i){const e=new ut(i.view);return(t,n,s)=>{const o=e.match(n.viewItem);if(!o)return;const r=o.match;if(r.name=!0,!s.consumable.test(n.viewItem,r))return;const a=My(i.model,n.viewItem,s);!a||!s.safeInsert(a,n.modelCursor)||(s.consumable.consume(n.viewItem,r),s.convertChildren(n.viewItem,a),s.updateConversionResult(a,n))}}function My(i,e,t){return i instanceof Function?i(e,t):t.writer.createElement(i)}function Vy(i){typeof i.view=="string"&&(i.view={key:i.view});const e=i.view.key;let t;if(e=="class"||e=="style")t={[e=="class"?"classes":"styles"]:i.view.value};else{const n=typeof i.view.value=="undefined"?/[\s\S]*/:i.view.value;t={attributes:{[e]:n}}}return i.view.name&&(t.name=i.view.name),i.view=t,e}function cu(i,e=null){const t=e===null?!0:o=>o.getAttribute(e),n=typeof i.model!="object"?i.model:i.model.key,s=typeof i.model!="object"||typeof i.model.value=="undefined"?t:i.model.value;i.model={key:n,value:s}}function uu(i,e){const t=new ut(i.view);return(n,s,o)=>{const r=t.match(s.viewItem);if(!r||(Oy(i.view,s.viewItem)?r.match.name=!0:delete r.match.name,!o.consumable.test(s.viewItem,r.match)))return;const a=i.model.key,l=typeof i.model.value=="function"?i.model.value(s.viewItem,o):i.model.value;if(l===null)return;s.modelRange||Object.assign(s,o.convertChildren(s.viewItem,s.modelCursor)),Ny(s.modelRange,{key:a,value:l},e,o)&&o.consumable.consume(s.viewItem,r.match)}}function Oy(i,e){const t=typeof i=="function"?i(e):i;return typeof t=="object"&&!Do(t)?!1:!t.classes&&!t.attributes&&!t.styles}function Ny(i,e,t,n){let s=!1;for(const o of Array.from(i.getItems({shallow:t})))!n.schema.checkAttribute(o,e.key)||(s=!0,!o.hasAttribute(e.key)&&n.writer.setAttribute(e.key,e.value,o));return s}function Dy(i){const e=i.model;i.model=(t,n)=>{const s=typeof e=="string"?e:e(t,n);return n.writer.createElement("$marker",{"data-name":s})}}function du(i,e){const t={};return t.view=i.view+"-"+e,t.model=(n,s)=>{const o=n.getAttribute("name"),r=i.model(o,s);return s.writer.createElement("$marker",{"data-name":r})},t}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class hu{constructor(e,t){this.model=e,this.view=new Kc(t),this.mapper=new Mo,this.downcastDispatcher=new Vo({mapper:this.mapper,schema:e.schema});const n=this.model.document,s=n.selection,o=this.model.markers;this.listenTo(this.model,"_beforeChanges",()=>{this.view._disableRendering(!0)},{priority:"highest"}),this.listenTo(this.model,"_afterChanges",()=>{this.view._disableRendering(!1)},{priority:"lowest"}),this.listenTo(n,"change",()=>{this.view.change(r=>{this.downcastDispatcher.convertChanges(n.differ,o,r),this.downcastDispatcher.convertSelection(s,o,r)})},{priority:"low"}),this.listenTo(this.view.document,"selectionChange",Ay(this.model,this.mapper)),this.downcastDispatcher.on("insert:$text",Zc(),{priority:"lowest"}),this.downcastDispatcher.on("remove",ty(),{priority:"low"}),this.downcastDispatcher.on("selection",sy(),{priority:"high"}),this.downcastDispatcher.on("selection",ny(),{priority:"low"}),this.downcastDispatcher.on("selection",iy(),{priority:"low"}),this.view.document.roots.bindTo(this.model.document.roots).using(r=>{if(r.rootName=="$graveyard")return null;const a=new z1(this.view.document,r.name);return a.rootName=r.rootName,this.mapper.bindElements(r,a),a})}destroy(){this.view.destroy(),this.stopListening()}}F(hu,re);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class By{constructor(){this._commands=new Map}add(e,t){this._commands.set(e,t)}get(e){return this._commands.get(e)}execute(e,...t){const n=this.get(e);if(!n)throw new p("commandcollection-command-not-found",this,{commandName:e});return n.execute(...t)}*names(){yield*this._commands.keys()}*commands(){yield*this._commands.values()}[Symbol.iterator](){return this._commands[Symbol.iterator]()}destroy(){for(const e of this.commands())e.destroy()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ui{constructor(){this._consumables=new Map}add(e,t){let n;if(e.is("$text")||e.is("documentFragment")){this._consumables.set(e,!0);return}this._consumables.has(e)?n=this._consumables.get(e):(n=new Fy(e),this._consumables.set(e,n)),n.add(t)}test(e,t){const n=this._consumables.get(e);return n===void 0?null:e.is("$text")||e.is("documentFragment")?n:n.test(t)}consume(e,t){return this.test(e,t)?(e.is("$text")||e.is("documentFragment")?this._consumables.set(e,!1):this._consumables.get(e).consume(t),!0):!1}revert(e,t){const n=this._consumables.get(e);n!==void 0&&(e.is("$text")||e.is("documentFragment")?this._consumables.set(e,!0):n.revert(t))}static consumablesFromElement(e){const t={element:e,name:!0,attributes:[],classes:[],styles:[]},n=e.getAttributeKeys();for(const r of n)r=="style"||r=="class"||t.attributes.push(r);const s=e.getClassNames();for(const r of s)t.classes.push(r);const o=e.getStyleNames();for(const r of o)t.styles.push(r);return t}static createFrom(e,t){if(t||(t=new ui(e)),e.is("$text"))return t.add(e),t;e.is("element")&&t.add(e,ui.consumablesFromElement(e)),e.is("documentFragment")&&t.add(e);for(const n of e.getChildren())t=ui.createFrom(n,t);return t}}class Fy{constructor(e){this.element=e,this._canConsumeName=null,this._consumables={attributes:new Map,styles:new Map,classes:new Map}}add(e){e.name&&(this._canConsumeName=!0);for(const t in this._consumables)t in e&&this._add(t,e[t])}test(e){if(e.name&&!this._canConsumeName)return this._canConsumeName;for(const t in this._consumables)if(t in e){const n=this._test(t,e[t]);if(n!==!0)return n}return!0}consume(e){e.name&&(this._canConsumeName=!1);for(const t in this._consumables)t in e&&this._consume(t,e[t])}revert(e){e.name&&(this._canConsumeName=!0);for(const t in this._consumables)t in e&&this._revert(t,e[t])}_add(e,t){const n=Ne(t)?t:[t],s=this._consumables[e];for(const o of n){if(e==="attributes"&&(o==="class"||o==="style"))throw new p("viewconsumable-invalid-attribute",this);if(s.set(o,!0),e==="styles")for(const r of this.element.document.stylesProcessor.getRelatedStyles(o))s.set(r,!0)}}_test(e,t){const n=Ne(t)?t:[t],s=this._consumables[e];for(const o of n)if(e==="attributes"&&(o==="class"||o==="style")){const r=o=="class"?"classes":"styles",a=this._test(r,[...this._consumables[r].keys()]);if(a!==!0)return a}else{const r=s.get(o);if(r===void 0)return null;if(!r)return!1}return!0}_consume(e,t){const n=Ne(t)?t:[t],s=this._consumables[e];for(const o of n)if(e==="attributes"&&(o==="class"||o==="style")){const r=o=="class"?"classes":"styles";this._consume(r,[...this._consumables[r].keys()])}else if(s.set(o,!1),e=="styles")for(const r of this.element.document.stylesProcessor.getRelatedStyles(o))s.set(r,!1)}_revert(e,t){const n=Ne(t)?t:[t],s=this._consumables[e];for(const o of n)if(e==="attributes"&&(o==="class"||o==="style")){const r=o=="class"?"classes":"styles";this._revert(r,[...this._consumables[r].keys()])}else s.get(o)===!1&&s.set(o,!0)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class fu{constructor(){this._sourceDefinitions={},this._attributeProperties={},this.decorate("checkChild"),this.decorate("checkAttribute"),this.on("checkAttribute",(e,t)=>{t[0]=new on(t[0])},{priority:"highest"}),this.on("checkChild",(e,t)=>{t[0]=new on(t[0]),t[1]=this.getDefinition(t[1])},{priority:"highest"})}register(e,t){if(this._sourceDefinitions[e])throw new p("schema-cannot-register-item-twice",this,{itemName:e});this._sourceDefinitions[e]=[Object.assign({},t)],this._clearCache()}extend(e,t){if(!this._sourceDefinitions[e])throw new p("schema-cannot-extend-missing-item",this,{itemName:e});this._sourceDefinitions[e].push(Object.assign({},t)),this._clearCache()}getDefinitions(){return this._compiledDefinitions||this._compile(),this._compiledDefinitions}getDefinition(e){let t;return typeof e=="string"?t=e:e.is&&(e.is("$text")||e.is("$textProxy"))?t="$text":t=e.name,this.getDefinitions()[t]}isRegistered(e){return!!this.getDefinition(e)}isBlock(e){const t=this.getDefinition(e);return!!(t&&t.isBlock)}isLimit(e){const t=this.getDefinition(e);return t?!!(t.isLimit||t.isObject):!1}isObject(e){const t=this.getDefinition(e);return t?!!(t.isObject||t.isLimit&&t.isSelectable&&t.isContent):!1}isInline(e){const t=this.getDefinition(e);return!!(t&&t.isInline)}isSelectable(e){const t=this.getDefinition(e);return t?!!(t.isSelectable||t.isObject):!1}isContent(e){const t=this.getDefinition(e);return t?!!(t.isContent||t.isObject):!1}checkChild(e,t){return t?this._checkContextMatch(t,e):!1}checkAttribute(e,t){const n=this.getDefinition(e.last);return n?n.allowAttributes.includes(t):!1}checkMerge(e,t=null){if(e instanceof x){const n=e.nodeBefore,s=e.nodeAfter;if(!(n instanceof ne))throw new p("schema-check-merge-no-element-before",this);if(!(s instanceof ne))throw new p("schema-check-merge-no-element-after",this);return this.checkMerge(n,s)}for(const n of t.getChildren())if(!this.checkChild(e,n))return!1;return!0}addChildCheck(e){this.on("checkChild",(t,[n,s])=>{if(!s)return;const o=e(n,s);typeof o=="boolean"&&(t.stop(),t.return=o)},{priority:"high"})}addAttributeCheck(e){this.on("checkAttribute",(t,[n,s])=>{const o=e(n,s);typeof o=="boolean"&&(t.stop(),t.return=o)},{priority:"high"})}setAttributeProperties(e,t){this._attributeProperties[e]=Object.assign(this.getAttributeProperties(e),t)}getAttributeProperties(e){return this._attributeProperties[e]||{}}getLimitElement(e){let t;for(e instanceof x?t=e.parent:t=(e instanceof E?[e]:Array.from(e.getRanges())).reduce((s,o)=>{const r=o.getCommonAncestor();return s?s.getCommonAncestor(r,{includeSelf:!0}):r},null);!this.isLimit(t)&&t.parent;)t=t.parent;return t}checkAttributeInSelection(e,t){if(e.isCollapsed){const s=[...e.getFirstPosition().getAncestors(),new ue("",e.getAttributes())];return this.checkAttribute(s,t)}else{const n=e.getRanges();for(const s of n)for(const o of s)if(this.checkAttribute(o.item,t))return!0}return!1}*getValidRanges(e,t){e=eC(e);for(const n of e)yield*this._getValidRangesForRange(n,t)}getNearestSelectionRange(e,t="both"){if(this.checkChild(e,"$text"))return new E(e);let n,s;const o=e.getAncestors().reverse().find(r=>this.isLimit(r))||e.root;(t=="both"||t=="backward")&&(n=new St({boundaries:E._createIn(o),startPosition:e,direction:"backward"})),(t=="both"||t=="forward")&&(s=new St({boundaries:E._createIn(o),startPosition:e}));for(const r of Zy(n,s)){const a=r.walker==n?"elementEnd":"elementStart",l=r.value;if(l.type==a&&this.isObject(l.item))return E._createOn(l.item);if(this.checkChild(l.nextPosition,"$text"))return new E(l.nextPosition)}return null}findAllowedParent(e,t){let n=e.parent;for(;n;){if(this.checkChild(n,t))return n;if(this.isLimit(n))return null;n=n.parent}return null}removeDisallowedAttributes(e,t){for(const n of e)if(n.is("$text"))mu(this,n,t);else{const o=E._createIn(n).getPositions();for(const r of o){const a=r.nodeBefore||r.parent;mu(this,a,t)}}}createContext(e){return new on(e)}_clearCache(){this._compiledDefinitions=null}_compile(){const e={},t=this._sourceDefinitions,n=Object.keys(t);for(const s of n)e[s]=Ly(t[s],s);for(const s of n)zy(e,s);for(const s of n)$y(e,s);for(const s of n)Hy(e,s);for(const s of n)Uy(e,s),Wy(e,s);for(const s of n)qy(e,s),jy(e,s),Ky(e,s);this._compiledDefinitions=e}_checkContextMatch(e,t,n=t.length-1){const s=t.getItem(n);if(e.allowIn.includes(s.name)){if(n==0)return!0;{const o=this.getDefinition(s);return this._checkContextMatch(o,t,n-1)}}else return!1}*_getValidRangesForRange(e,t){let n=e.start,s=e.start;for(const o of e.getItems({shallow:!0}))o.is("element")&&(yield*this._getValidRangesForRange(E._createIn(o),t)),this.checkAttribute(o,t)||(n.isEqual(s)||(yield new E(n,s)),n=x._createAfter(o)),s=x._createAfter(o);n.isEqual(s)||(yield new E(n,s))}}F(fu,re);class on{constructor(e){if(e instanceof on)return e;typeof e=="string"?e=[e]:Array.isArray(e)||(e=e.getAncestors({includeSelf:!0})),this._items=e.map(Xy)}get length(){return this._items.length}get last(){return this._items[this._items.length-1]}[Symbol.iterator](){return this._items[Symbol.iterator]()}push(e){const t=new on([e]);return t._items=[...this._items,...t._items],t}getItem(e){return this._items[e]}*getNames(){yield*this._items.map(e=>e.name)}endsWith(e){return Array.from(this.getNames()).join(" ").endsWith(e)}startsWith(e){return Array.from(this.getNames()).join(" ").startsWith(e)}}function Ly(i,e){const t={name:e,allowIn:[],allowContentOf:[],allowWhere:[],allowAttributes:[],allowAttributesOf:[],allowChildren:[],inheritTypesFrom:[]};return Gy(i,t),rn(i,t,"allowIn"),rn(i,t,"allowContentOf"),rn(i,t,"allowWhere"),rn(i,t,"allowAttributes"),rn(i,t,"allowAttributesOf"),rn(i,t,"allowChildren"),rn(i,t,"inheritTypesFrom"),Jy(i,t),t}function zy(i,e){const t=i[e];for(const n of t.allowChildren){const s=i[n];!s||s.allowIn.push(e)}t.allowChildren.length=0}function $y(i,e){for(const t of i[e].allowContentOf)i[t]&&Qy(i,t).forEach(s=>{s.allowIn.push(e)});delete i[e].allowContentOf}function Hy(i,e){for(const t of i[e].allowWhere){const n=i[t];if(n){const s=n.allowIn;i[e].allowIn.push(...s)}}delete i[e].allowWhere}function Uy(i,e){for(const t of i[e].allowAttributesOf){const n=i[t];if(n){const s=n.allowAttributes;i[e].allowAttributes.push(...s)}}delete i[e].allowAttributesOf}function Wy(i,e){const t=i[e];for(const n of t.inheritTypesFrom){const s=i[n];if(s){const o=Object.keys(s).filter(r=>r.startsWith("is"));for(const r of o)r in t||(t[r]=s[r])}}delete t.inheritTypesFrom}function qy(i,e){const t=i[e],n=t.allowIn.filter(s=>i[s]);t.allowIn=Array.from(new Set(n))}function jy(i,e){const t=i[e];for(const n of t.allowIn)i[n].allowChildren.push(e)}function Ky(i,e){const t=i[e];t.allowAttributes=Array.from(new Set(t.allowAttributes))}function Gy(i,e){for(const t of i){const n=Object.keys(t).filter(s=>s.startsWith("is"));for(const s of n)e[s]=t[s]}}function rn(i,e,t){for(const n of i)typeof n[t]=="string"?e[t].push(n[t]):Array.isArray(n[t])&&e[t].push(...n[t])}function Jy(i,e){for(const t of i){const n=t.inheritAllFrom;n&&(e.allowContentOf.push(n),e.allowWhere.push(n),e.allowAttributesOf.push(n),e.inheritTypesFrom.push(n))}}function Qy(i,e){const t=i[e];return Yy(i).filter(n=>n.allowIn.includes(t.name))}function Yy(i){return Object.keys(i).map(e=>i[e])}function Xy(i){return typeof i=="string"||i.is("documentFragment")?{name:typeof i=="string"?i:"$documentFragment",*getAttributeKeys(){},getAttribute(){}}:{name:i.is("element")?i.name:"$text",*getAttributeKeys(){yield*i.getAttributeKeys()},getAttribute(e){return i.getAttribute(e)}}}function*Zy(i,e){let t=!1;for(;!t;){if(t=!0,i){const n=i.next();n.done||(t=!1,yield{walker:i,value:n.value})}if(e){const n=e.next();n.done||(t=!1,yield{walker:e,value:n.value})}}}function*eC(i){for(const e of i)yield*e.getMinimalFlatRanges()}function mu(i,e,t){for(const n of e.getAttributeKeys())i.checkAttribute(e,n)||t.removeAttribute(n,e)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class gu{constructor(e={}){this._splitParts=new Map,this._cursorParents=new Map,this._modelCursor=null,this.conversionApi=Object.assign({},e),this.conversionApi.convertItem=this._convertItem.bind(this),this.conversionApi.convertChildren=this._convertChildren.bind(this),this.conversionApi.safeInsert=this._safeInsert.bind(this),this.conversionApi.updateConversionResult=this._updateConversionResult.bind(this),this.conversionApi.splitToAllowedParent=this._splitToAllowedParent.bind(this),this.conversionApi.getSplitParts=this._getSplitParts.bind(this)}convert(e,t,n=["$root"]){this.fire("viewCleanup",e),this._modelCursor=nC(n,t),this.conversionApi.writer=t,this.conversionApi.consumable=ui.createFrom(e),this.conversionApi.store={};const{modelRange:s}=this._convertItem(e,this._modelCursor),o=t.createDocumentFragment();if(s){this._removeEmptyElements();for(const r of Array.from(this._modelCursor.parent.getChildren()))t.append(r,o);o.markers=tC(o,t)}return this._modelCursor=null,this._splitParts.clear(),this._cursorParents.clear(),this.conversionApi.writer=null,this.conversionApi.store=null,o}_convertItem(e,t){const n=Object.assign({viewItem:e,modelCursor:t,modelRange:null});if(e.is("element")?this.fire("element:"+e.name,n,this.conversionApi):e.is("$text")?this.fire("text",n,this.conversionApi):this.fire("documentFragment",n,this.conversionApi),n.modelRange&&!(n.modelRange instanceof E))throw new p("view-conversion-dispatcher-incorrect-result",this);return{modelRange:n.modelRange,modelCursor:n.modelCursor}}_convertChildren(e,t){let n=t.is("position")?t:x._createAt(t,0);const s=new E(n);for(const o of Array.from(e.getChildren())){const r=this._convertItem(o,n);r.modelRange instanceof E&&(s.end=r.modelRange.end,n=r.modelCursor)}return{modelRange:s,modelCursor:n}}_safeInsert(e,t){const n=this._splitToAllowedParent(e,t);return n?(this.conversionApi.writer.insert(e,n.position),!0):!1}_updateConversionResult(e,t){const n=this._getSplitParts(e),s=this.conversionApi.writer;t.modelRange||(t.modelRange=s.createRange(s.createPositionBefore(e),s.createPositionAfter(n[n.length-1])));const o=this._cursorParents.get(e);o?t.modelCursor=s.createPositionAt(o,0):t.modelCursor=t.modelRange.end}_splitToAllowedParent(e,t){const{schema:n,writer:s}=this.conversionApi;let o=n.findAllowedParent(t,e);if(o){if(o===t.parent)return{position:t};this._modelCursor.parent.getAncestors().includes(o)&&(o=null)}if(!o)return ou(t,e,n)?{position:ru(t,s)}:null;const r=this.conversionApi.writer.split(t,o),a=[];for(const c of r.range.getWalker())if(c.type=="elementEnd")a.push(c.item);else{const u=a.pop(),d=c.item;this._registerSplitPair(u,d)}const l=r.range.end.parent;return this._cursorParents.set(e,l),{position:r.position,cursorParent:l}}_registerSplitPair(e,t){this._splitParts.has(e)||this._splitParts.set(e,[e]);const n=this._splitParts.get(e);this._splitParts.set(t,n),n.push(t)}_getSplitParts(e){let t;return this._splitParts.has(e)?t=this._splitParts.get(e):t=[e],t}_removeEmptyElements(){let e=!1;for(const t of this._splitParts.keys())t.isEmpty&&(this.conversionApi.writer.remove(t),this._splitParts.delete(t),e=!0);e&&this._removeEmptyElements()}}F(gu,oe);function tC(i,e){const t=new Set,n=new Map,s=E._createIn(i).getItems();for(const o of s)o.name=="$marker"&&t.add(o);for(const o of t){const r=o.getAttribute("data-name"),a=e.createPositionBefore(o);n.has(r)?n.get(r).end=a.clone():n.set(r,new E(a.clone())),e.remove(o)}return n}function nC(i,e){let t;for(const n of new on(i)){const s={};for(const r of n.getAttributeKeys())s[r]=n.getAttribute(r);const o=e.createElement(n.name,s);t&&e.append(o,t),t=x._createAt(o,0)}return t}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class iC{getHtml(e){const n=document.implementation.createHTMLDocument("").createElement("div");return n.appendChild(e),n.innerHTML}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class pu{constructor(e){this.domParser=new DOMParser,this.domConverter=new qi(e,{renderingMode:"data"}),this.htmlWriter=new iC}toData(e){const t=this.domConverter.viewToDom(e,document);return this.htmlWriter.getHtml(t)}toView(e){const t=this._toDom(e);return this.domConverter.domToView(t)}registerRawContentMatcher(e){this.domConverter.registerRawContentMatcher(e)}useFillerType(e){this.domConverter.blockFillerMode=e=="marked"?"markedNbsp":"nbsp"}_toDom(e){const t=this.domParser.parseFromString(e,"text/html"),n=t.createDocumentFragment();let s=t.firstChild;for(;!s.isSameNode(t.documentElement);){const r=s;s=s.nextSibling,r.nodeType==Node.COMMENT_NODE&&n.appendChild(r)}const o=t.body.childNodes;for(;o.length>0;)n.appendChild(o[0]);return n}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class wu{constructor(e,t){this.model=e,this.mapper=new Mo,this.downcastDispatcher=new Vo({mapper:this.mapper,schema:e.schema}),this.downcastDispatcher.on("insert:$text",Zc(),{priority:"lowest"}),this.upcastDispatcher=new gu({schema:e.schema}),this.viewDocument=new ai(t),this.stylesProcessor=t,this.htmlProcessor=new pu(this.viewDocument),this.processor=this.htmlProcessor,this._viewWriter=new dc(this.viewDocument),this.upcastDispatcher.on("text",Ey(),{priority:"lowest"}),this.upcastDispatcher.on("element",au(),{priority:"lowest"}),this.upcastDispatcher.on("documentFragment",au(),{priority:"lowest"}),this.decorate("init"),this.decorate("set"),this.decorate("get"),this.on("init",()=>{this.fire("ready")},{priority:"lowest"}),this.on("ready",()=>{this.model.enqueueChange("transparent",su)},{priority:"lowest"})}get(e={}){const{rootName:t="main",trim:n="empty"}=e;if(!this._checkIfRootsExists([t]))throw new p("datacontroller-get-non-existent-root",this);const s=this.model.document.getRoot(t);return n==="empty"&&!this.model.hasContent(s,{ignoreWhitespaces:!0})?"":this.stringify(s,e)}stringify(e,t={}){const n=this.toView(e,t);return this.processor.toData(n)}toView(e,t={}){const n=this.viewDocument,s=this._viewWriter;this.mapper.clearBindings();const o=E._createIn(e),r=new tn(n);this.mapper.bindElements(e,r),this.downcastDispatcher.conversionApi.options=t,this.downcastDispatcher.convertInsert(o,s);const a=e.is("documentFragment")?Array.from(e.markers):sC(e);for(const[l,c]of a)this.downcastDispatcher.convertMarkerAdd(l,c,s);return delete this.downcastDispatcher.conversionApi.options,r}init(e){if(this.model.document.version)throw new p("datacontroller-init-document-not-empty",this);let t={};if(typeof e=="string"?t.main=e:t=e,!this._checkIfRootsExists(Object.keys(t)))throw new p("datacontroller-init-non-existent-root",this);return this.model.enqueueChange("transparent",n=>{for(const s of Object.keys(t)){const o=this.model.document.getRoot(s);n.insert(this.parse(t[s],o),o,0)}}),Promise.resolve()}set(e,t={}){let n={};if(typeof e=="string"?n.main=e:n=e,!this._checkIfRootsExists(Object.keys(n)))throw new p("datacontroller-set-non-existent-root",this);const s=t.batchType||"default";this.model.enqueueChange(s,o=>{o.setSelection(null),o.removeSelectionAttribute(this.model.document.selection.getAttributeKeys());for(const r of Object.keys(n)){const a=this.model.document.getRoot(r);o.remove(o.createRangeIn(a)),o.insert(this.parse(n[r],a),a,0)}})}parse(e,t="$root"){const n=this.processor.toView(e);return this.toModel(n,t)}toModel(e,t="$root"){return this.model.change(n=>this.upcastDispatcher.convert(e,n,t))}addStyleProcessorRules(e){e(this.stylesProcessor)}registerRawContentMatcher(e){this.processor&&this.processor!==this.htmlProcessor&&this.processor.registerRawContentMatcher(e),this.htmlProcessor.registerRawContentMatcher(e)}destroy(){this.stopListening()}_checkIfRootsExists(e){for(const t of e)if(!this.model.document.getRootNames().includes(t))return!1;return!0}}F(wu,re);function sC(i){const e=[],t=i.root.document;if(!t)return[];const n=E._createIn(i);for(const s of t.model.markers){const o=s.getRange(),r=o.isCollapsed,a=o.start.isEqual(n.start)||o.end.isEqual(n.end);if(r&&a)e.push([s.name,o]);else{const l=n.getIntersection(o);l&&e.push([s.name,l])}}return e.sort(([s,o],[r,a])=>{if(o.end.compareWith(a.start)!=="after")return 1;if(o.start.compareWith(a.end)!=="before")return-1;switch(o.start.compareWith(a.start)){case"before":return 1;case"after":return-1;default:switch(o.end.compareWith(a.end)){case"before":return 1;case"after":return-1;default:return r.localeCompare(s)}}})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class oC{constructor(e,t){this._helpers=new Map,this._downcast=Ee(e),this._createConversionHelpers({name:"downcast",dispatchers:this._downcast,isDowncast:!0}),this._upcast=Ee(t),this._createConversionHelpers({name:"upcast",dispatchers:this._upcast,isDowncast:!1})}addAlias(e,t){const n=this._downcast.includes(t);if(!this._upcast.includes(t)&&!n)throw new p("conversion-add-alias-dispatcher-not-registered",this);this._createConversionHelpers({name:e,dispatchers:[t],isDowncast:n})}for(e){if(!this._helpers.has(e))throw new p("conversion-for-unknown-group",this);return this._helpers.get(e)}elementToElement(e){this.for("downcast").elementToElement(e);for(const{model:t,view:n}of Fo(e))this.for("upcast").elementToElement({model:t,view:n,converterPriority:e.converterPriority})}attributeToElement(e){this.for("downcast").attributeToElement(e);for(const{model:t,view:n}of Fo(e))this.for("upcast").elementToAttribute({view:n,model:t,converterPriority:e.converterPriority})}attributeToAttribute(e){this.for("downcast").attributeToAttribute(e);for(const{model:t,view:n}of Fo(e))this.for("upcast").attributeToAttribute({view:n,model:t})}_createConversionHelpers({name:e,dispatchers:t,isDowncast:n}){if(this._helpers.has(e))throw new p("conversion-group-exists",this);const s=n?new ey(t):new Ty(t);this._helpers.set(e,s)}}function*Fo(i){if(i.model.values)for(const e of i.model.values){const t={key:i.model.key,value:e},n=i.view[e],s=i.upcastAlso?i.upcastAlso[e]:void 0;yield*bu(t,n,s)}else yield*bu(i.model,i.view,i.upcastAlso)}function*bu(i,e,t){if(yield{model:i,view:e},t)for(const n of Ee(t))yield{model:i,view:n}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Zi{constructor(e="default"){this.operations=[],this.type=e}get baseVersion(){for(const e of this.operations)if(e.baseVersion!==null)return e.baseVersion;return null}addOperation(e){return e.batch=this,this.operations.push(e),e}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Qe{constructor(e){this.baseVersion=e,this.isDocumentOperation=this.baseVersion!==null,this.batch=null}_validate(){}toJSON(){const e=Object.assign({},this);return e.__className=this.constructor.className,delete e.batch,delete e.isDocumentOperation,e}static get className(){return"Operation"}static fromJSON(e){return new this(e.baseVersion)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Pt{constructor(e){this.markers=new Map,this._children=new kn,e&&this._insertChild(0,e)}[Symbol.iterator](){return this.getChildren()}get childCount(){return this._children.length}get maxOffset(){return this._children.maxOffset}get isEmpty(){return this.childCount===0}get root(){return this}get parent(){return null}is(e){return e==="documentFragment"||e==="model:documentFragment"}getChild(e){return this._children.getNode(e)}getChildren(){return this._children[Symbol.iterator]()}getChildIndex(e){return this._children.getNodeIndex(e)}getChildStartOffset(e){return this._children.getNodeStartOffset(e)}getPath(){return[]}getNodeByPath(e){let t=this;for(const n of e)t=t.getChild(t.offsetToIndex(n));return t}offsetToIndex(e){return this._children.offsetToIndex(e)}toJSON(){const e=[];for(const t of this._children)e.push(t.toJSON());return e}static fromJSON(e){const t=[];for(const n of e)n.name?t.push(ne.fromJSON(n)):t.push(ue.fromJSON(n));return new Pt(t)}_appendChild(e){this._insertChild(this.childCount,e)}_insertChild(e,t){const n=rC(t);for(const s of n)s.parent!==null&&s._remove(),s.parent=this;this._children._insertNodes(e,n)}_removeChildren(e,t=1){const n=this._children._removeNodes(e,t);for(const s of n)s.parent=null;return n}}function rC(i){return typeof i=="string"?[new ue(i)]:(Ke(i)||(i=[i]),Array.from(i).map(e=>typeof e=="string"?new ue(e):e instanceof ft?new ue(e.data,e.getAttributes()):e))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Lo(i,e){e=vu(e);const t=e.reduce((o,r)=>o+r.offsetSize,0),n=i.parent;fi(i);const s=i.index;return n._insertChild(s,e),hi(n,s+e.length),hi(n,s),new E(i,i.getShiftedBy(t))}function _u(i){if(!i.isFlat)throw new p("operation-utils-remove-range-not-flat",this);const e=i.start.parent;fi(i.start),fi(i.end);const t=e._removeChildren(i.start.index,i.end.index-i.start.index);return hi(e,i.start.index),t}function di(i,e){if(!i.isFlat)throw new p("operation-utils-move-range-not-flat",this);const t=_u(i);return e=e._getTransformedByDeletion(i.start,i.end.offset-i.start.offset),Lo(e,t)}function aC(i,e,t){fi(i.start),fi(i.end);for(const n of i.getItems({shallow:!0})){const s=n.is("$textProxy")?n.textNode:n;t!==null?s._setAttribute(e,t):s._removeAttribute(e),hi(s.parent,s.index)}hi(i.end.parent,i.end.index)}function vu(i){const e=[];i instanceof Array||(i=[i]);for(let t=0;t<i.length;t++)if(typeof i[t]=="string")e.push(new ue(i[t]));else if(i[t]instanceof ft)e.push(new ue(i[t].data,i[t].getAttributes()));else if(i[t]instanceof Pt||i[t]instanceof kn)for(const n of i[t])e.push(n);else i[t]instanceof nn&&e.push(i[t]);for(let t=1;t<e.length;t++){const n=e[t],s=e[t-1];n instanceof ue&&s instanceof ue&&yu(n,s)&&(e.splice(t-1,2,new ue(s.data+n.data,s.getAttributes())),t--)}return e}function hi(i,e){const t=i.getChild(e-1),n=i.getChild(e);if(t&&n&&t.is("$text")&&n.is("$text")&&yu(t,n)){const s=new ue(t.data+n.data,t.getAttributes());i._removeChildren(e-1,2),i._insertChild(e-1,s)}}function fi(i){const e=i.textNode,t=i.parent;if(e){const n=i.offset-e.startOffset,s=e.index;t._removeChildren(s,1);const o=new ue(e.data.substr(0,n),e.getAttributes()),r=new ue(e.data.substr(n),e.getAttributes());t._insertChild(s,[o,r])}}function yu(i,e){const t=i.getAttributes(),n=e.getAttributes();for(const s of t){if(s[1]!==e.getAttribute(s[0]))return!1;n.next()}return n.next().done}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ye extends Qe{constructor(e,t,n,s,o){super(o);this.range=e.clone(),this.key=t,this.oldValue=n===void 0?null:n,this.newValue=s===void 0?null:s}get type(){return this.oldValue===null?"addAttribute":this.newValue===null?"removeAttribute":"changeAttribute"}clone(){return new ye(this.range,this.key,this.oldValue,this.newValue,this.baseVersion)}getReversed(){return new ye(this.range,this.key,this.newValue,this.oldValue,this.baseVersion+1)}toJSON(){const e=super.toJSON();return e.range=this.range.toJSON(),e}_validate(){if(!this.range.isFlat)throw new p("attribute-operation-range-not-flat",this);for(const e of this.range.getItems({shallow:!0})){if(this.oldValue!==null&&!Hl(e.getAttribute(this.key),this.oldValue))throw new p("attribute-operation-wrong-old-value",this,{item:e,key:this.key,value:this.oldValue});if(this.oldValue===null&&this.newValue!==null&&e.hasAttribute(this.key))throw new p("attribute-operation-attribute-exists",this,{node:e,key:this.key})}}_execute(){Hl(this.oldValue,this.newValue)||aC(this.range,this.key,this.newValue)}static get className(){return"AttributeOperation"}static fromJSON(e,t){return new ye(E.fromJSON(e.range,t),e.key,e.oldValue,e.newValue,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class lC extends Qe{constructor(e,t){super(null);this.sourcePosition=e.clone(),this.howMany=t}get type(){return"detach"}toJSON(){const e=super.toJSON();return e.sourcePosition=this.sourcePosition.toJSON(),e}_validate(){if(this.sourcePosition.root.document)throw new p("detach-operation-on-document-node",this)}_execute(){_u(E._createFromPositionAndShift(this.sourcePosition,this.howMany))}static get className(){return"DetachOperation"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ie extends Qe{constructor(e,t,n,s){super(s);this.sourcePosition=e.clone(),this.sourcePosition.stickiness="toNext",this.howMany=t,this.targetPosition=n.clone(),this.targetPosition.stickiness="toNone"}get type(){return this.targetPosition.root.rootName=="$graveyard"?"remove":this.sourcePosition.root.rootName=="$graveyard"?"reinsert":"move"}clone(){return new this.constructor(this.sourcePosition,this.howMany,this.targetPosition,this.baseVersion)}getMovedRangeStart(){return this.targetPosition._getTransformedByDeletion(this.sourcePosition,this.howMany)}getReversed(){const e=this.sourcePosition._getTransformedByInsertion(this.targetPosition,this.howMany);return new this.constructor(this.getMovedRangeStart(),this.howMany,e,this.baseVersion+1)}_validate(){const e=this.sourcePosition.parent,t=this.targetPosition.parent,n=this.sourcePosition.offset,s=this.targetPosition.offset;if(n+this.howMany>e.maxOffset)throw new p("move-operation-nodes-do-not-exist",this);if(e===t&&n<s&&s<n+this.howMany)throw new p("move-operation-range-into-itself",this);if(this.sourcePosition.root==this.targetPosition.root&&Me(this.sourcePosition.getParentPath(),this.targetPosition.getParentPath())=="prefix"){const o=this.sourcePosition.path.length-1;if(this.targetPosition.path[o]>=n&&this.targetPosition.path[o]<n+this.howMany)throw new p("move-operation-node-into-itself",this)}}_execute(){di(E._createFromPositionAndShift(this.sourcePosition,this.howMany),this.targetPosition)}toJSON(){const e=super.toJSON();return e.sourcePosition=this.sourcePosition.toJSON(),e.targetPosition=this.targetPosition.toJSON(),e}static get className(){return"MoveOperation"}static fromJSON(e,t){const n=x.fromJSON(e.sourcePosition,t),s=x.fromJSON(e.targetPosition,t);return new this(n,e.howMany,s,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ae extends Qe{constructor(e,t,n){super(n);this.position=e.clone(),this.position.stickiness="toNone",this.nodes=new kn(vu(t)),this.shouldReceiveAttributes=!1}get type(){return"insert"}get howMany(){return this.nodes.maxOffset}clone(){const e=new kn([...this.nodes].map(n=>n._clone(!0))),t=new Ae(this.position,e,this.baseVersion);return t.shouldReceiveAttributes=this.shouldReceiveAttributes,t}getReversed(){const e=this.position.root.document.graveyard,t=new x(e,[0]);return new ie(this.position,this.nodes.maxOffset,t,this.baseVersion+1)}_validate(){const e=this.position.parent;if(!e||e.maxOffset<this.position.offset)throw new p("insert-operation-position-invalid",this)}_execute(){const e=this.nodes;this.nodes=new kn([...e].map(t=>t._clone(!0))),Lo(this.position,e)}toJSON(){const e=super.toJSON();return e.position=this.position.toJSON(),e.nodes=this.nodes.toJSON(),e}static get className(){return"InsertOperation"}static fromJSON(e,t){const n=[];for(const o of e.nodes)o.name?n.push(ne.fromJSON(o)):n.push(ue.fromJSON(o));const s=new Ae(x.fromJSON(e.position,t),n,e.baseVersion);return s.shouldReceiveAttributes=e.shouldReceiveAttributes,s}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Be extends Qe{constructor(e,t,n,s,o,r){super(r);this.name=e,this.oldRange=t?t.clone():null,this.newRange=n?n.clone():null,this.affectsData=o,this._markers=s}get type(){return"marker"}clone(){return new Be(this.name,this.oldRange,this.newRange,this._markers,this.affectsData,this.baseVersion)}getReversed(){return new Be(this.name,this.newRange,this.oldRange,this._markers,this.affectsData,this.baseVersion+1)}_execute(){const e=this.newRange?"_set":"_remove";this._markers[e](this.name,this.newRange,!0,this.affectsData)}toJSON(){const e=super.toJSON();return this.oldRange&&(e.oldRange=this.oldRange.toJSON()),this.newRange&&(e.newRange=this.newRange.toJSON()),delete e._markers,e}static get className(){return"MarkerOperation"}static fromJSON(e,t){return new Be(e.name,e.oldRange?E.fromJSON(e.oldRange,t):null,e.newRange?E.fromJSON(e.newRange,t):null,t.model.markers,e.affectsData,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Fe extends Qe{constructor(e,t,n,s){super(s);this.position=e,this.position.stickiness="toNext",this.oldName=t,this.newName=n}get type(){return"rename"}clone(){return new Fe(this.position.clone(),this.oldName,this.newName,this.baseVersion)}getReversed(){return new Fe(this.position.clone(),this.newName,this.oldName,this.baseVersion+1)}_validate(){const e=this.position.nodeAfter;if(e instanceof ne){if(e.name!==this.oldName)throw new p("rename-operation-wrong-name",this)}else throw new p("rename-operation-wrong-position",this)}_execute(){const e=this.position.nodeAfter;e.name=this.newName}toJSON(){const e=super.toJSON();return e.position=this.position.toJSON(),e}static get className(){return"RenameOperation"}static fromJSON(e,t){return new Fe(x.fromJSON(e.position,t),e.oldName,e.newName,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class It extends Qe{constructor(e,t,n,s,o){super(o);this.root=e,this.key=t,this.oldValue=n,this.newValue=s}get type(){return this.oldValue===null?"addRootAttribute":this.newValue===null?"removeRootAttribute":"changeRootAttribute"}clone(){return new It(this.root,this.key,this.oldValue,this.newValue,this.baseVersion)}getReversed(){return new It(this.root,this.key,this.newValue,this.oldValue,this.baseVersion+1)}_validate(){if(this.root!=this.root.root||this.root.is("documentFragment"))throw new p("rootattribute-operation-not-a-root",this,{root:this.root,key:this.key});if(this.oldValue!==null&&this.root.getAttribute(this.key)!==this.oldValue)throw new p("rootattribute-operation-wrong-old-value",this,{root:this.root,key:this.key});if(this.oldValue===null&&this.newValue!==null&&this.root.hasAttribute(this.key))throw new p("rootattribute-operation-attribute-exists",this,{root:this.root,key:this.key})}_execute(){this.newValue!==null?this.root._setAttribute(this.key,this.newValue):this.root._removeAttribute(this.key)}toJSON(){const e=super.toJSON();return e.root=this.root.toJSON(),e}static get className(){return"RootAttributeOperation"}static fromJSON(e,t){if(!t.getRoot(e.root))throw new p("rootattribute-operation-fromjson-no-root",this,{rootName:e.root});return new It(t.getRoot(e.root),e.key,e.oldValue,e.newValue,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ce extends Qe{constructor(e,t,n,s,o){super(o);this.sourcePosition=e.clone(),this.sourcePosition.stickiness="toPrevious",this.howMany=t,this.targetPosition=n.clone(),this.targetPosition.stickiness="toNext",this.graveyardPosition=s.clone()}get type(){return"merge"}get deletionPosition(){return new x(this.sourcePosition.root,this.sourcePosition.path.slice(0,-1))}get movedRange(){const e=this.sourcePosition.getShiftedBy(Number.POSITIVE_INFINITY);return new E(this.sourcePosition,e)}clone(){return new this.constructor(this.sourcePosition,this.howMany,this.targetPosition,this.graveyardPosition,this.baseVersion)}getReversed(){const e=this.targetPosition._getTransformedByMergeOperation(this),t=this.sourcePosition.path.slice(0,-1),n=new x(this.sourcePosition.root,t)._getTransformedByMergeOperation(this);return new fe(e,this.howMany,n,this.graveyardPosition,this.baseVersion+1)}_validate(){const e=this.sourcePosition.parent,t=this.targetPosition.parent;if(e.parent)if(t.parent){if(this.howMany!=e.maxOffset)throw new p("merge-operation-how-many-invalid",this)}else throw new p("merge-operation-target-position-invalid",this);else throw new p("merge-operation-source-position-invalid",this)}_execute(){const e=this.sourcePosition.parent,t=E._createIn(e);di(t,this.targetPosition),di(E._createOn(e),this.graveyardPosition)}toJSON(){const e=super.toJSON();return e.sourcePosition=e.sourcePosition.toJSON(),e.targetPosition=e.targetPosition.toJSON(),e.graveyardPosition=e.graveyardPosition.toJSON(),e}static get className(){return"MergeOperation"}static fromJSON(e,t){const n=x.fromJSON(e.sourcePosition,t),s=x.fromJSON(e.targetPosition,t),o=x.fromJSON(e.graveyardPosition,t);return new this(n,e.howMany,s,o,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class fe extends Qe{constructor(e,t,n,s,o){super(o);this.splitPosition=e.clone(),this.splitPosition.stickiness="toNext",this.howMany=t,this.insertionPosition=n,this.graveyardPosition=s?s.clone():null,this.graveyardPosition&&(this.graveyardPosition.stickiness="toNext")}get type(){return"split"}get moveTargetPosition(){const e=this.insertionPosition.path.slice();return e.push(0),new x(this.insertionPosition.root,e)}get movedRange(){const e=this.splitPosition.getShiftedBy(Number.POSITIVE_INFINITY);return new E(this.splitPosition,e)}clone(){return new this.constructor(this.splitPosition,this.howMany,this.insertionPosition,this.graveyardPosition,this.baseVersion)}getReversed(){const e=this.splitPosition.root.document.graveyard,t=new x(e,[0]);return new Ce(this.moveTargetPosition,this.howMany,this.splitPosition,t,this.baseVersion+1)}_validate(){const e=this.splitPosition.parent,t=this.splitPosition.offset;if(!e||e.maxOffset<t)throw new p("split-operation-position-invalid",this);if(e.parent){if(this.howMany!=e.maxOffset-this.splitPosition.offset)throw new p("split-operation-how-many-invalid",this);if(this.graveyardPosition&&!this.graveyardPosition.nodeAfter)throw new p("split-operation-graveyard-position-invalid",this)}else throw new p("split-operation-split-in-root",this)}_execute(){const e=this.splitPosition.parent;if(this.graveyardPosition)di(E._createFromPositionAndShift(this.graveyardPosition,1),this.insertionPosition);else{const n=e._clone();Lo(this.insertionPosition,n)}const t=new E(x._createAt(e,this.splitPosition.offset),x._createAt(e,e.maxOffset));di(t,this.moveTargetPosition)}toJSON(){const e=super.toJSON();return e.splitPosition=this.splitPosition.toJSON(),e.insertionPosition=this.insertionPosition.toJSON(),this.graveyardPosition&&(e.graveyardPosition=this.graveyardPosition.toJSON()),e}static get className(){return"SplitOperation"}static getInsertionPosition(e){const t=e.path.slice(0,-1);return t[t.length-1]++,new x(e.root,t,"toPrevious")}static fromJSON(e,t){const n=x.fromJSON(e.splitPosition,t),s=x.fromJSON(e.insertionPosition,t),o=e.graveyardPosition?x.fromJSON(e.graveyardPosition,t):null;return new this(n,e.howMany,s,o,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class zo extends ne{constructor(e,t,n="main"){super(t);this._document=e,this.rootName=n}get document(){return this._document}is(e,t){return t?t===this.name&&(e==="rootElement"||e==="model:rootElement"||e==="element"||e==="model:element"):e==="rootElement"||e==="model:rootElement"||e==="element"||e==="model:element"||e==="node"||e==="model:node"}toJSON(){return this.rootName}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class cC{constructor(e,t){this.model=e,this.batch=t}createText(e,t){return new ue(e,t)}createElement(e,t){return new ne(e,t)}createDocumentFragment(){return new Pt}cloneElement(e,t=!0){return e._clone(t)}insert(e,t,n=0){if(this._assertWriterUsedCorrectly(),e instanceof ue&&e.data=="")return;const s=x._createAt(t,n);if(e.parent)if(Tu(e.root,s.root)){this.move(E._createOn(e),s);return}else{if(e.root.document)throw new p("model-writer-insert-forbidden-move",this);this.remove(e)}const o=s.root.document?s.root.document.version:null,r=new Ae(s,e,o);if(e instanceof ue&&(r.shouldReceiveAttributes=!0),this.batch.addOperation(r),this.model.applyOperation(r),e instanceof Pt)for(const[a,l]of e.markers){const c=x._createAt(l.root,0),d={range:new E(l.start._getCombined(c,s),l.end._getCombined(c,s)),usingOperation:!0,affectsData:!0};this.model.markers.has(a)?this.updateMarker(a,d):this.addMarker(a,d)}}insertText(e,t,n,s){t instanceof Pt||t instanceof ne||t instanceof x?this.insert(this.createText(e),t,n):this.insert(this.createText(e,t),n,s)}insertElement(e,t,n,s){t instanceof Pt||t instanceof ne||t instanceof x?this.insert(this.createElement(e),t,n):this.insert(this.createElement(e,t),n,s)}append(e,t){this.insert(e,t,"end")}appendText(e,t,n){t instanceof Pt||t instanceof ne?this.insert(this.createText(e),t,"end"):this.insert(this.createText(e,t),n,"end")}appendElement(e,t,n){t instanceof Pt||t instanceof ne?this.insert(this.createElement(e),t,"end"):this.insert(this.createElement(e,t),n,"end")}setAttribute(e,t,n){if(this._assertWriterUsedCorrectly(),n instanceof E){const s=n.getMinimalFlatRanges();for(const o of s)Cu(this,e,t,o)}else ku(this,e,t,n)}setAttributes(e,t){for(const[n,s]of Tt(e))this.setAttribute(n,s,t)}removeAttribute(e,t){if(this._assertWriterUsedCorrectly(),t instanceof E){const n=t.getMinimalFlatRanges();for(const s of n)Cu(this,e,null,s)}else ku(this,e,null,t)}clearAttributes(e){this._assertWriterUsedCorrectly();const t=n=>{for(const s of n.getAttributeKeys())this.removeAttribute(s,n)};if(!(e instanceof E))t(e);else for(const n of e.getItems())t(n)}move(e,t,n){if(this._assertWriterUsedCorrectly(),!(e instanceof E))throw new p("writer-move-invalid-range",this);if(!e.isFlat)throw new p("writer-move-range-not-flat",this);const s=x._createAt(t,n);if(s.isEqual(e.start))return;if(this._addOperationForAffectedMarkers("move",e),!Tu(e.root,s.root))throw new p("writer-move-different-document",this);const o=e.root.document?e.root.document.version:null,r=new ie(e.start,e.end.offset-e.start.offset,s,o);this.batch.addOperation(r),this.model.applyOperation(r)}remove(e){this._assertWriterUsedCorrectly();const n=(e instanceof E?e:E._createOn(e)).getMinimalFlatRanges().reverse();for(const s of n)this._addOperationForAffectedMarkers("move",s),uC(s.start,s.end.offset-s.start.offset,this.batch,this.model)}merge(e){this._assertWriterUsedCorrectly();const t=e.nodeBefore,n=e.nodeAfter;if(this._addOperationForAffectedMarkers("merge",e),!(t instanceof ne))throw new p("writer-merge-no-element-before",this);if(!(n instanceof ne))throw new p("writer-merge-no-element-after",this);e.root.document?this._merge(e):this._mergeDetached(e)}createPositionFromPath(e,t,n){return this.model.createPositionFromPath(e,t,n)}createPositionAt(e,t){return this.model.createPositionAt(e,t)}createPositionAfter(e){return this.model.createPositionAfter(e)}createPositionBefore(e){return this.model.createPositionBefore(e)}createRange(e,t){return this.model.createRange(e,t)}createRangeIn(e){return this.model.createRangeIn(e)}createRangeOn(e){return this.model.createRangeOn(e)}createSelection(e,t,n){return this.model.createSelection(e,t,n)}_mergeDetached(e){const t=e.nodeBefore,n=e.nodeAfter;this.move(E._createIn(n),x._createAt(t,"end")),this.remove(n)}_merge(e){const t=x._createAt(e.nodeBefore,"end"),n=x._createAt(e.nodeAfter,0),s=e.root.document.graveyard,o=new x(s,[0]),r=e.root.document.version,a=new Ce(n,e.nodeAfter.maxOffset,t,o,r);this.batch.addOperation(a),this.model.applyOperation(a)}rename(e,t){if(this._assertWriterUsedCorrectly(),!(e instanceof ne))throw new p("writer-rename-not-element-instance",this);const n=e.root.document?e.root.document.version:null,s=new Fe(x._createBefore(e),e.name,t,n);this.batch.addOperation(s),this.model.applyOperation(s)}split(e,t){this._assertWriterUsedCorrectly();let n=e.parent;if(!n.parent)throw new p("writer-split-element-no-parent",this);if(t||(t=n.parent),!e.parent.getAncestors({includeSelf:!0}).includes(t))throw new p("writer-split-invalid-limit-element",this);let s,o;do{const r=n.root.document?n.root.document.version:null,a=n.maxOffset-e.offset,l=fe.getInsertionPosition(e),c=new fe(e,a,l,null,r);this.batch.addOperation(c),this.model.applyOperation(c),!s&&!o&&(s=n,o=e.parent.nextSibling),e=this.createPositionAfter(e.parent),n=e.parent}while(n!==t);return{position:e,range:new E(x._createAt(s,"end"),x._createAt(o,0))}}wrap(e,t){if(this._assertWriterUsedCorrectly(),!e.isFlat)throw new p("writer-wrap-range-not-flat",this);const n=t instanceof ne?t:new ne(t);if(n.childCount>0)throw new p("writer-wrap-element-not-empty",this);if(n.parent!==null)throw new p("writer-wrap-element-attached",this);this.insert(n,e.start);const s=new E(e.start.getShiftedBy(1),e.end.getShiftedBy(1));this.move(s,x._createAt(n,0))}unwrap(e){if(this._assertWriterUsedCorrectly(),e.parent===null)throw new p("writer-unwrap-element-no-parent",this);this.move(E._createIn(e),this.createPositionAfter(e)),this.remove(e)}addMarker(e,t){if(this._assertWriterUsedCorrectly(),!t||typeof t.usingOperation!="boolean")throw new p("writer-addmarker-no-usingoperation",this);const n=t.usingOperation,s=t.range,o=t.affectsData===void 0?!1:t.affectsData;if(this.model.markers.has(e))throw new p("writer-addmarker-marker-exists",this);if(!s)throw new p("writer-addmarker-no-range",this);return n?(mi(this,e,null,s,o),this.model.markers.get(e)):this.model.markers._set(e,s,n,o)}updateMarker(e,t){this._assertWriterUsedCorrectly();const n=typeof e=="string"?e:e.name,s=this.model.markers.get(n);if(!s)throw new p("writer-updatemarker-marker-not-exists",this);if(!t){this.model.markers._refresh(s);return}const o=typeof t.usingOperation=="boolean",r=typeof t.affectsData=="boolean",a=r?t.affectsData:s.affectsData;if(!o&&!t.range&&!r)throw new p("writer-updatemarker-wrong-options",this);const l=s.getRange(),c=t.range?t.range:l;if(o&&t.usingOperation!==s.managedUsingOperations){t.usingOperation?mi(this,n,null,c,a):(mi(this,n,l,null,a),this.model.markers._set(n,c,void 0,a));return}s.managedUsingOperations?mi(this,n,l,c,a):this.model.markers._set(n,c,void 0,a)}removeMarker(e){this._assertWriterUsedCorrectly();const t=typeof e=="string"?e:e.name;if(!this.model.markers.has(t))throw new p("writer-removemarker-no-marker",this);const n=this.model.markers.get(t);if(!n.managedUsingOperations){this.model.markers._remove(t);return}const s=n.getRange();mi(this,t,s,null,n.affectsData)}setSelection(e,t,n){this._assertWriterUsedCorrectly(),this.model.document.selection._setTo(e,t,n)}setSelectionFocus(e,t){this._assertWriterUsedCorrectly(),this.model.document.selection._setFocus(e,t)}setSelectionAttribute(e,t){if(this._assertWriterUsedCorrectly(),typeof e=="string")this._setSelectionAttribute(e,t);else for(const[n,s]of Tt(e))this._setSelectionAttribute(n,s)}removeSelectionAttribute(e){if(this._assertWriterUsedCorrectly(),typeof e=="string")this._removeSelectionAttribute(e);else for(const t of e)this._removeSelectionAttribute(t)}overrideSelectionGravity(){return this.model.document.selection._overrideGravity()}restoreSelectionGravity(e){this.model.document.selection._restoreGravity(e)}_setSelectionAttribute(e,t){const n=this.model.document.selection;if(n.isCollapsed&&n.anchor.parent.isEmpty){const s=tt._getStoreAttributeKey(e);this.setAttribute(s,t,n.anchor.parent)}n._setAttribute(e,t)}_removeSelectionAttribute(e){const t=this.model.document.selection;if(t.isCollapsed&&t.anchor.parent.isEmpty){const n=tt._getStoreAttributeKey(e);this.removeAttribute(n,t.anchor.parent)}t._removeAttribute(e)}_assertWriterUsedCorrectly(){if(this.model._currentWriter!==this)throw new p("writer-incorrect-use",this)}_addOperationForAffectedMarkers(e,t){for(const n of this.model.markers){if(!n.managedUsingOperations)continue;const s=n.getRange();let o=!1;if(e==="move")o=t.containsPosition(s.start)||t.start.isEqual(s.start)||t.containsPosition(s.end)||t.end.isEqual(s.end);else{const r=t.nodeBefore,a=t.nodeAfter,l=s.start.parent==r&&s.start.isAtEnd,c=s.end.parent==a&&s.end.offset==0,u=s.end.nodeAfter==a,d=s.start.nodeAfter==a;o=l||c||u||d}o&&this.updateMarker(n.name,{range:s})}}}function Cu(i,e,t,n){const s=i.model,o=s.document;let r=n.start,a,l,c;for(const d of n.getWalker({shallow:!0}))c=d.item.getAttribute(e),a&&l!=c&&(l!=t&&u(),r=a),a=d.nextPosition,l=c;a instanceof x&&a!=r&&l!=t&&u();function u(){const d=new E(r,a),f=d.root.document?o.version:null,b=new ye(d,e,l,t,f);i.batch.addOperation(b),s.applyOperation(b)}}function ku(i,e,t,n){const s=i.model,o=s.document,r=n.getAttribute(e);let a,l;if(r!=t){if(n.root===n){const u=n.document?o.version:null;l=new It(n,e,r,t,u)}else{a=new E(x._createBefore(n),i.createPositionAfter(n));const u=a.root.document?o.version:null;l=new ye(a,e,r,t,u)}i.batch.addOperation(l),s.applyOperation(l)}}function mi(i,e,t,n,s){const o=i.model,r=o.document,a=new Be(e,t,n,o.markers,s,r.version);i.batch.addOperation(a),o.applyOperation(a)}function uC(i,e,t,n){let s;if(i.root.document){const o=n.document,r=new x(o.graveyard,[0]);s=new ie(i,e,r,o.version)}else s=new lC(i,e);t.addOperation(s),n.applyOperation(s)}function Tu(i,e){return i===e||i instanceof zo&&e instanceof zo}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class dC{constructor(e){this._markerCollection=e,this._changesInElement=new Map,this._elementSnapshots=new Map,this._changedMarkers=new Map,this._changeCount=0,this._cachedChanges=null,this._cachedChangesWithGraveyard=null}get isEmpty(){return this._changesInElement.size==0&&this._changedMarkers.size==0}refreshItem(e){if(this._isInInsertedElement(e.parent))return;this._markRemove(e.parent,e.startOffset,e.offsetSize),this._markInsert(e.parent,e.startOffset,e.offsetSize);const t=E._createOn(e);for(const n of this._markerCollection.getMarkersIntersectingRange(t)){const s=n.getRange();this.bufferMarkerChange(n.name,s,s,n.affectsData)}this._cachedChanges=null}bufferOperation(e){switch(e.type){case"insert":{if(this._isInInsertedElement(e.position.parent))return;this._markInsert(e.position.parent,e.position.offset,e.nodes.maxOffset);break}case"addAttribute":case"removeAttribute":case"changeAttribute":{for(const t of e.range.getItems({shallow:!0}))this._isInInsertedElement(t.parent)||this._markAttribute(t);break}case"remove":case"move":case"reinsert":{if(e.sourcePosition.isEqual(e.targetPosition)||e.sourcePosition.getShiftedBy(e.howMany).isEqual(e.targetPosition))return;const t=this._isInInsertedElement(e.sourcePosition.parent),n=this._isInInsertedElement(e.targetPosition.parent);t||this._markRemove(e.sourcePosition.parent,e.sourcePosition.offset,e.howMany),n||this._markInsert(e.targetPosition.parent,e.getMovedRangeStart().offset,e.howMany);break}case"rename":{if(this._isInInsertedElement(e.position.parent))return;this._markRemove(e.position.parent,e.position.offset,1),this._markInsert(e.position.parent,e.position.offset,1);const t=E._createFromPositionAndShift(e.position,1);for(const n of this._markerCollection.getMarkersIntersectingRange(t)){const s=n.getRange();this.bufferMarkerChange(n.name,s,s,n.affectsData)}break}case"split":{const t=e.splitPosition.parent;this._isInInsertedElement(t)||this._markRemove(t,e.splitPosition.offset,e.howMany),this._isInInsertedElement(e.insertionPosition.parent)||this._markInsert(e.insertionPosition.parent,e.insertionPosition.offset,1),e.graveyardPosition&&this._markRemove(e.graveyardPosition.parent,e.graveyardPosition.offset,1);break}case"merge":{const t=e.sourcePosition.parent;this._isInInsertedElement(t.parent)||this._markRemove(t.parent,t.startOffset,1);const n=e.graveyardPosition.parent;this._markInsert(n,e.graveyardPosition.offset,1);const s=e.targetPosition.parent;this._isInInsertedElement(s)||this._markInsert(s,e.targetPosition.offset,t.maxOffset);break}}this._cachedChanges=null}bufferMarkerChange(e,t,n,s){const o=this._changedMarkers.get(e);o?(o.newRange=n,o.affectsData=s,o.oldRange==null&&o.newRange==null&&this._changedMarkers.delete(e)):this._changedMarkers.set(e,{oldRange:t,newRange:n,affectsData:s})}getMarkersToRemove(){const e=[];for(const[t,n]of this._changedMarkers)n.oldRange!=null&&e.push({name:t,range:n.oldRange});return e}getMarkersToAdd(){const e=[];for(const[t,n]of this._changedMarkers)n.newRange!=null&&e.push({name:t,range:n.newRange});return e}getChangedMarkers(){return Array.from(this._changedMarkers).map(e=>({name:e[0],data:{oldRange:e[1].oldRange,newRange:e[1].newRange}}))}hasDataChanges(){for(const[,e]of this._changedMarkers)if(e.affectsData)return!0;return this._changesInElement.size>0}getChanges(e={includeChangesInGraveyard:!1}){if(this._cachedChanges)return e.includeChangesInGraveyard?this._cachedChangesWithGraveyard.slice():this._cachedChanges.slice();let t=[];for(const n of this._changesInElement.keys()){const s=this._changesInElement.get(n).sort((u,d)=>u.offset===d.offset?u.type!=d.type?u.type=="remove"?-1:1:0:u.offset<d.offset?-1:1),o=this._elementSnapshots.get(n),r=Eu(n.getChildren()),a=hC(o.length,s);let l=0,c=0;for(const u of a)if(u==="i")t.push(this._getInsertDiff(n,l,r[l].name)),l++;else if(u==="r")t.push(this._getRemoveDiff(n,l,o[c].name)),c++;else if(u==="a"){const d=r[l].attributes,f=o[c].attributes;let b;if(r[l].name=="$text")b=new E(x._createAt(n,l),x._createAt(n,l+1));else{const _=n.offsetToIndex(l);b=new E(x._createAt(n,l),x._createAt(n.getChild(_),0))}t.push(...this._getAttributesDiff(b,f,d)),l++,c++}else l++,c++}t.sort((n,s)=>n.position.root!=s.position.root?n.position.root.rootName<s.position.root.rootName?-1:1:n.position.isEqual(s.position)?n.changeCount-s.changeCount:n.position.isBefore(s.position)?-1:1);for(let n=1,s=0;n<t.length;n++){const o=t[s],r=t[n],a=o.type=="remove"&&r.type=="remove"&&o.name=="$text"&&r.name=="$text"&&o.position.isEqual(r.position),l=o.type=="insert"&&r.type=="insert"&&o.name=="$text"&&r.name=="$text"&&o.position.parent==r.position.parent&&o.position.offset+o.length==r.position.offset,c=o.type=="attribute"&&r.type=="attribute"&&o.position.parent==r.position.parent&&o.range.isFlat&&r.range.isFlat&&o.position.offset+o.length==r.position.offset&&o.attributeKey==r.attributeKey&&o.attributeOldValue==r.attributeOldValue&&o.attributeNewValue==r.attributeNewValue;a||l||c?(o.length++,c&&(o.range.end=o.range.end.getShiftedBy(1)),t[n]=null):s=n}t=t.filter(n=>n);for(const n of t)delete n.changeCount,n.type=="attribute"&&(delete n.position,delete n.length);return this._changeCount=0,this._cachedChangesWithGraveyard=t.slice(),this._cachedChanges=t.filter(fC),e.includeChangesInGraveyard?this._cachedChangesWithGraveyard:this._cachedChanges}reset(){this._changesInElement.clear(),this._elementSnapshots.clear(),this._changedMarkers.clear(),this._cachedChanges=null}_markInsert(e,t,n){const s={type:"insert",offset:t,howMany:n,count:this._changeCount++};this._markChange(e,s)}_markRemove(e,t,n){const s={type:"remove",offset:t,howMany:n,count:this._changeCount++};this._markChange(e,s),this._removeAllNestedChanges(e,t,n)}_markAttribute(e){const t={type:"attribute",offset:e.startOffset,howMany:e.offsetSize,count:this._changeCount++};this._markChange(e.parent,t)}_markChange(e,t){this._makeSnapshot(e);const n=this._getChangesForElement(e);this._handleChange(t,n),n.push(t);for(let s=0;s<n.length;s++)n[s].howMany<1&&(n.splice(s,1),s--)}_getChangesForElement(e){let t;return this._changesInElement.has(e)?t=this._changesInElement.get(e):(t=[],this._changesInElement.set(e,t)),t}_makeSnapshot(e){this._elementSnapshots.has(e)||this._elementSnapshots.set(e,Eu(e.getChildren()))}_handleChange(e,t){e.nodesToHandle=e.howMany;for(const n of t){const s=e.offset+e.howMany,o=n.offset+n.howMany;if(e.type=="insert"&&(n.type=="insert"&&(e.offset<=n.offset?n.offset+=e.howMany:e.offset<o&&(n.howMany+=e.nodesToHandle,e.nodesToHandle=0)),n.type=="remove"&&e.offset<n.offset&&(n.offset+=e.howMany),n.type=="attribute")){if(e.offset<=n.offset)n.offset+=e.howMany;else if(e.offset<o){const r=n.howMany;n.howMany=e.offset-n.offset,t.unshift({type:"attribute",offset:s,howMany:r-n.howMany,count:this._changeCount++})}}if(e.type=="remove"){if(n.type=="insert"){if(s<=n.offset)n.offset-=e.howMany;else if(s<=o)if(e.offset<n.offset){const r=s-n.offset;n.offset=e.offset,n.howMany-=r,e.nodesToHandle-=r}else n.howMany-=e.nodesToHandle,e.nodesToHandle=0;else if(e.offset<=n.offset)e.nodesToHandle-=n.howMany,n.howMany=0;else if(e.offset<o){const r=o-e.offset;n.howMany-=r,e.nodesToHandle-=r}}if(n.type=="remove"&&(s<=n.offset?n.offset-=e.howMany:e.offset<n.offset&&(e.nodesToHandle+=n.howMany,n.howMany=0)),n.type=="attribute"){if(s<=n.offset)n.offset-=e.howMany;else if(e.offset<n.offset){const r=s-n.offset;n.offset=e.offset,n.howMany-=r}else if(e.offset<o)if(s<=o){const r=n.howMany;n.howMany=e.offset-n.offset;const a=r-n.howMany-e.nodesToHandle;t.unshift({type:"attribute",offset:e.offset,howMany:a,count:this._changeCount++})}else n.howMany-=o-e.offset}}if(e.type=="attribute"){if(n.type=="insert")if(e.offset<n.offset&&s>n.offset){if(s>o){const r={type:"attribute",offset:o,howMany:s-o,count:this._changeCount++};this._handleChange(r,t),t.push(r)}e.nodesToHandle=n.offset-e.offset,e.howMany=e.nodesToHandle}else e.offset>=n.offset&&e.offset<o&&(s>o?(e.nodesToHandle=s-o,e.offset=o):e.nodesToHandle=0);if(n.type=="remove"&&e.offset<n.offset&&s>n.offset){const r={type:"attribute",offset:n.offset,howMany:s-n.offset,count:this._changeCount++};this._handleChange(r,t),t.push(r),e.nodesToHandle=n.offset-e.offset,e.howMany=e.nodesToHandle}n.type=="attribute"&&(e.offset>=n.offset&&s<=o?(e.nodesToHandle=0,e.howMany=0,e.offset=0):e.offset<=n.offset&&s>=o&&(n.howMany=0))}}e.howMany=e.nodesToHandle,delete e.nodesToHandle}_getInsertDiff(e,t,n){return{type:"insert",position:x._createAt(e,t),name:n,length:1,changeCount:this._changeCount++}}_getRemoveDiff(e,t,n){return{type:"remove",position:x._createAt(e,t),name:n,length:1,changeCount:this._changeCount++}}_getAttributesDiff(e,t,n){const s=[];n=new Map(n);for(const[o,r]of t){const a=n.has(o)?n.get(o):null;a!==r&&s.push({type:"attribute",position:e.start,range:e.clone(),length:1,attributeKey:o,attributeOldValue:r,attributeNewValue:a,changeCount:this._changeCount++}),n.delete(o)}for(const[o,r]of n)s.push({type:"attribute",position:e.start,range:e.clone(),length:1,attributeKey:o,attributeOldValue:null,attributeNewValue:r,changeCount:this._changeCount++});return s}_isInInsertedElement(e){const t=e.parent;if(!t)return!1;const n=this._changesInElement.get(t),s=e.startOffset;if(n){for(const o of n)if(o.type=="insert"&&s>=o.offset&&s<o.offset+o.howMany)return!0}return this._isInInsertedElement(t)}_removeAllNestedChanges(e,t,n){const s=new E(x._createAt(e,t),x._createAt(e,t+n));for(const o of s.getItems({shallow:!0}))o.is("element")&&(this._elementSnapshots.delete(o),this._changesInElement.delete(o),this._removeAllNestedChanges(o,0,o.maxOffset))}}function Eu(i){const e=[];for(const t of i)if(t.is("$text"))for(let n=0;n<t.data.length;n++)e.push({name:"$text",attributes:new Map(t.getAttributes())});else e.push({name:t.name,attributes:new Map(t.getAttributes())});return e}function hC(i,e){const t=[];let n=0,s=0;for(const o of e){if(o.offset>n){for(let r=0;r<o.offset-n;r++)t.push("e");s+=o.offset-n}if(o.type=="insert"){for(let r=0;r<o.howMany;r++)t.push("i");n=o.offset+o.howMany}else if(o.type=="remove"){for(let r=0;r<o.howMany;r++)t.push("r");n=o.offset,s+=o.howMany}else t.push(..."a".repeat(o.howMany).split("")),n=o.offset+o.howMany,s+=o.howMany}if(s<i)for(let o=0;o<i-s-n;o++)t.push("e");return t}function fC(i){const e=i.position&&i.position.root.rootName=="$graveyard",t=i.range&&i.range.root.rootName=="$graveyard";return!e&&!t}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class mC{constructor(){this._operations=[],this._undoPairs=new Map,this._undoneOperations=new Set}addOperation(e){this._operations.includes(e)||this._operations.push(e)}getOperations(e=Number.NEGATIVE_INFINITY,t=Number.POSITIVE_INFINITY){const n=[];for(const s of this._operations)s.baseVersion>=e&&s.baseVersion<t&&n.push(s);return n}getOperation(e){for(const t of this._operations)if(t.baseVersion==e)return t}setOperationAsUndone(e,t){this._undoPairs.set(t,e),this._undoneOperations.add(e)}isUndoingOperation(e){return this._undoPairs.has(e)}isUndoneOperation(e){return this._undoneOperations.has(e)}getUndoneOperation(e){return this._undoPairs.get(e)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function gC(i){return!!i&&i.length==1&&/[\u0300-\u036f\u1ab0-\u1aff\u1dc0-\u1dff\u20d0-\u20ff\ufe20-\ufe2f]/.test(i)}function pC(i){return!!i&&i.length==1&&/[\ud800-\udbff]/.test(i)}function wC(i){return!!i&&i.length==1&&/[\udc00-\udfff]/.test(i)}function Au(i,e){return pC(i.charAt(e-1))&&wC(i.charAt(e))}function Su(i,e){return gC(i.charAt(e))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const $o="$graveyard";class xu{constructor(e){this.model=e,this.version=0,this.history=new mC(this),this.selection=new tt(this),this.roots=new $e({idProperty:"rootName"}),this.differ=new dC(e.markers),this._postFixers=new Set,this._hasSelectionChangedFromTheLastChangeBlock=!1,this.createRoot("$root",$o),this.listenTo(e,"applyOperation",(t,n)=>{const s=n[0];if(s.isDocumentOperation&&s.baseVersion!==this.version)throw new p("model-document-applyoperation-wrong-version",this,{operation:s})},{priority:"highest"}),this.listenTo(e,"applyOperation",(t,n)=>{const s=n[0];s.isDocumentOperation&&this.differ.bufferOperation(s)},{priority:"high"}),this.listenTo(e,"applyOperation",(t,n)=>{const s=n[0];s.isDocumentOperation&&(this.version++,this.history.addOperation(s))},{priority:"low"}),this.listenTo(this.selection,"change",()=>{this._hasSelectionChangedFromTheLastChangeBlock=!0}),this.listenTo(e.markers,"update",(t,n,s,o)=>{this.differ.bufferMarkerChange(n.name,s,o,n.affectsData),s===null&&n.on("change",(r,a)=>{this.differ.bufferMarkerChange(n.name,a,n.getRange(),n.affectsData)})})}get graveyard(){return this.getRoot($o)}createRoot(e="$root",t="main"){if(this.roots.get(t))throw new p("model-document-createroot-name-exists",this,{name:t});const n=new zo(this,e,t);return this.roots.add(n),n}destroy(){this.selection.destroy(),this.stopListening()}getRoot(e="main"){return this.roots.get(e)}getRootNames(){return Array.from(this.roots,e=>e.rootName).filter(e=>e!=$o)}registerPostFixer(e){this._postFixers.add(e)}toJSON(){const e=Ml(this);return e.selection="[engine.model.DocumentSelection]",e.model="[engine.model.Model]",e}_handleChangeBlock(e){this._hasDocumentChangedFromTheLastChangeBlock()&&(this._callPostFixers(e),this.selection.refresh(),this.differ.hasDataChanges()?this.fire("change:data",e.batch):this.fire("change",e.batch),this.selection.refresh(),this.differ.reset()),this._hasSelectionChangedFromTheLastChangeBlock=!1}_hasDocumentChangedFromTheLastChangeBlock(){return!this.differ.isEmpty||this._hasSelectionChangedFromTheLastChangeBlock}_getDefaultRoot(){for(const e of this.roots)if(e!==this.graveyard)return e;return this.graveyard}_getDefaultRange(){const e=this._getDefaultRoot(),t=this.model,n=t.schema,s=t.createPositionFromPath(e,[0]);return n.getNearestSelectionRange(s)||t.createRange(s)}_validateSelectionRange(e){return Pu(e.start)&&Pu(e.end)}_callPostFixers(e){let t=!1;do for(const n of this._postFixers)if(this.selection.refresh(),t=n(e),t)break;while(t)}}F(xu,oe);function Pu(i){const e=i.textNode;if(e){const t=e.data,n=i.offset-e.startOffset;return!Au(t,n)&&!Su(t,n)}return!0}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Iu{constructor(){this._markers=new Map}[Symbol.iterator](){return this._markers.values()}has(e){const t=e instanceof En?e.name:e;return this._markers.has(t)}get(e){return this._markers.get(e)||null}_set(e,t,n=!1,s=!1){const o=e instanceof En?e.name:e;if(o.includes(","))throw new p("markercollection-incorrect-marker-name",this);const r=this._markers.get(o);if(r){const c=r.getRange();let u=!1;return c.isEqual(t)||(r._attachLiveRange(mt.fromRange(t)),u=!0),n!=r.managedUsingOperations&&(r._managedUsingOperations=n,u=!0),typeof s=="boolean"&&s!=r.affectsData&&(r._affectsData=s,u=!0),u&&this.fire("update:"+o,r,c,t),r}const a=mt.fromRange(t),l=new En(o,a,n,s);return this._markers.set(o,l),this.fire("update:"+o,l,null,t),l}_remove(e){const t=e instanceof En?e.name:e,n=this._markers.get(t);return n?(this._markers.delete(t),this.fire("update:"+t,n,n.getRange(),null),this._destroyMarker(n),!0):!1}_refresh(e){const t=e instanceof En?e.name:e,n=this._markers.get(t);if(!n)throw new p("markercollection-refresh-marker-not-exists",this);const s=n.getRange();this.fire("update:"+t,n,s,s,n.managedUsingOperations,n.affectsData)}*getMarkersAtPosition(e){for(const t of this)t.getRange().containsPosition(e)&&(yield t)}*getMarkersIntersectingRange(e){for(const t of this)t.getRange().getIntersection(e)!==null&&(yield t)}destroy(){for(const e of this._markers.values())this._destroyMarker(e);this._markers=null,this.stopListening()}*getMarkersGroup(e){for(const t of this._markers.values())t.name.startsWith(e+":")&&(yield t)}_destroyMarker(e){e.stopListening(),e._detachLiveRange()}}F(Iu,oe);class En{constructor(e,t,n,s){this.name=e,this._liveRange=this._attachLiveRange(t),this._managedUsingOperations=n,this._affectsData=s}get managedUsingOperations(){if(!this._liveRange)throw new p("marker-destroyed",this);return this._managedUsingOperations}get affectsData(){if(!this._liveRange)throw new p("marker-destroyed",this);return this._affectsData}getStart(){if(!this._liveRange)throw new p("marker-destroyed",this);return this._liveRange.start.clone()}getEnd(){if(!this._liveRange)throw new p("marker-destroyed",this);return this._liveRange.end.clone()}getRange(){if(!this._liveRange)throw new p("marker-destroyed",this);return this._liveRange.toRange()}is(e){return e==="marker"||e==="model:marker"}_attachLiveRange(e){return this._liveRange&&this._detachLiveRange(),e.delegate("change:range").to(this),e.delegate("change:content").to(this),this._liveRange=e,e}_detachLiveRange(){this._liveRange.stopDelegating("change:range",this),this._liveRange.stopDelegating("change:content",this),this._liveRange.detach(),this._liveRange=null}}F(En,oe);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Se extends Qe{get type(){return"noop"}clone(){return new Se(this.baseVersion)}getReversed(){return new Se(this.baseVersion+1)}_execute(){}static get className(){return"NoOperation"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const nt={};nt[ye.className]=ye;nt[Ae.className]=Ae;nt[Be.className]=Be;nt[ie.className]=ie;nt[Se.className]=Se;nt[Qe.className]=Qe;nt[Fe.className]=Fe;nt[It.className]=It;nt[fe.className]=fe;nt[Ce.className]=Ce;class bC{static fromJSON(e,t){return nt[e.__className].fromJSON(e,t)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Pe extends x{constructor(e,t,n="toNone"){super(e,t,n);if(!this.root.is("rootElement"))throw new p("model-liveposition-root-not-rootelement",e);_C.call(this)}detach(){this.stopListening()}is(e){return e==="livePosition"||e==="model:livePosition"||e=="position"||e==="model:position"}toPosition(){return new x(this.root,this.path.slice(),this.stickiness)}static fromPosition(e,t){return new this(e.root,e.path.slice(),t||e.stickiness)}}function _C(){this.listenTo(this.root.document.model,"applyOperation",(i,e)=>{const t=e[0];!t.isDocumentOperation||vC.call(this,t)},{priority:"low"})}function vC(i){const e=this.getTransformedByOperation(i);if(!this.isEqual(e)){const t=this.toPosition();this.path=e.path,this.root=e.root,this.fire("change",t)}}F(Pe,oe);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function yC(i,e,t,n){return i.change(s=>{let o;t?t instanceof xt||t instanceof tt?o=t:o=s.createSelection(t,n):o=i.document.selection,o.isCollapsed||i.deleteContent(o,{doNotAutoparagraph:!0});const r=new CC(i,s,o.anchor);let a;e.is("documentFragment")?a=e.getChildren():a=[e],r.handleNodes(a);const l=r.getSelectionRange();l&&(o instanceof tt?s.setSelection(l):o.setTo(l));const c=r.getAffectedRange()||i.createRange(o.anchor);return r.destroy(),c})}class CC{constructor(e,t,n){this.model=e,this.writer=t,this.position=n,this.canMergeWith=new Set([this.position.parent]),this.schema=e.schema,this._documentFragment=t.createDocumentFragment(),this._documentFragmentPosition=t.createPositionAt(this._documentFragment,0),this._firstNode=null,this._lastNode=null,this._lastAutoParagraph=null,this._filterAttributesOf=[],this._affectedStart=null,this._affectedEnd=null}handleNodes(e){for(const t of Array.from(e))this._handleNode(t);this._insertPartialFragment(),this._lastAutoParagraph&&this._updateLastNodeFromAutoParagraph(this._lastAutoParagraph),this._mergeOnRight(),this.schema.removeDisallowedAttributes(this._filterAttributesOf,this.writer),this._filterAttributesOf=[]}_updateLastNodeFromAutoParagraph(e){const t=this.writer.createPositionAfter(this._lastNode),n=this.writer.createPositionAfter(e);if(n.isAfter(t)){if(this._lastNode=e,this.position.parent!=e||!this.position.isAtEnd)throw new p("insertcontent-invalid-insertion-position",this);this.position=n,this._setAffectedBoundaries(this.position)}}getSelectionRange(){return this.nodeToSelect?E._createOn(this.nodeToSelect):this.model.schema.getNearestSelectionRange(this.position)}getAffectedRange(){return this._affectedStart?new E(this._affectedStart,this._affectedEnd):null}destroy(){this._affectedStart&&this._affectedStart.detach(),this._affectedEnd&&this._affectedEnd.detach()}_handleNode(e){if(this.schema.isObject(e)){this._handleObject(e);return}let t=this._checkAndAutoParagraphToAllowedPosition(e);if(!t&&(t=this._checkAndSplitToAllowedPosition(e),!t)){this._handleDisallowedNode(e);return}this._appendToFragment(e),this._firstNode||(this._firstNode=e),this._lastNode=e}_insertPartialFragment(){if(this._documentFragment.isEmpty)return;const e=Pe.fromPosition(this.position,"toNext");this._setAffectedBoundaries(this.position),this._documentFragment.getChild(0)==this._firstNode&&(this.writer.insert(this._firstNode,this.position),this._mergeOnLeft(),this.position=e.toPosition()),this._documentFragment.isEmpty||this.writer.insert(this._documentFragment,this.position),this._documentFragmentPosition=this.writer.createPositionAt(this._documentFragment,0),this.position=e.toPosition(),e.detach()}_handleObject(e){this._checkAndSplitToAllowedPosition(e)?this._appendToFragment(e):this._tryAutoparagraphing(e)}_handleDisallowedNode(e){e.is("element")?this.handleNodes(e.getChildren()):this._tryAutoparagraphing(e)}_appendToFragment(e){if(!this.schema.checkChild(this.position,e))throw new p("insertcontent-wrong-position",this,{node:e,position:this.position});this.writer.insert(e,this._documentFragmentPosition),this._documentFragmentPosition=this._documentFragmentPosition.getShiftedBy(e.offsetSize),this.schema.isObject(e)&&!this.schema.checkChild(this.position,"$text")?this.nodeToSelect=e:this.nodeToSelect=null,this._filterAttributesOf.push(e)}_setAffectedBoundaries(e){this._affectedStart||(this._affectedStart=Pe.fromPosition(e,"toPrevious")),(!this._affectedEnd||this._affectedEnd.isBefore(e))&&(this._affectedEnd&&this._affectedEnd.detach(),this._affectedEnd=Pe.fromPosition(e,"toNext"))}_mergeOnLeft(){const e=this._firstNode;if(!(e instanceof ne)||!this._canMergeLeft(e))return;const t=Pe._createBefore(e);t.stickiness="toNext";const n=Pe.fromPosition(this.position,"toNext");this._affectedStart.isEqual(t)&&(this._affectedStart.detach(),this._affectedStart=Pe._createAt(t.nodeBefore,"end","toPrevious")),this._firstNode===this._lastNode&&(this._firstNode=t.nodeBefore,this._lastNode=t.nodeBefore),this.writer.merge(t),t.isEqual(this._affectedEnd)&&this._firstNode===this._lastNode&&(this._affectedEnd.detach(),this._affectedEnd=Pe._createAt(t.nodeBefore,"end","toNext")),this.position=n.toPosition(),n.detach(),this._filterAttributesOf.push(this.position.parent),t.detach()}_mergeOnRight(){const e=this._lastNode;if(!(e instanceof ne)||!this._canMergeRight(e))return;const t=Pe._createAfter(e);if(t.stickiness="toNext",!this.position.isEqual(t))throw new p("insertcontent-invalid-insertion-position",this);this.position=x._createAt(t.nodeBefore,"end");const n=Pe.fromPosition(this.position,"toPrevious");this._affectedEnd.isEqual(t)&&(this._affectedEnd.detach(),this._affectedEnd=Pe._createAt(t.nodeBefore,"end","toNext")),this._firstNode===this._lastNode&&(this._firstNode=t.nodeBefore,this._lastNode=t.nodeBefore),this.writer.merge(t),t.getShiftedBy(-1).isEqual(this._affectedStart)&&this._firstNode===this._lastNode&&(this._affectedStart.detach(),this._affectedStart=Pe._createAt(t.nodeBefore,0,"toPrevious")),this.position=n.toPosition(),n.detach(),this._filterAttributesOf.push(this.position.parent),t.detach()}_canMergeLeft(e){const t=e.previousSibling;return t instanceof ne&&this.canMergeWith.has(t)&&this.model.schema.checkMerge(t,e)}_canMergeRight(e){const t=e.nextSibling;return t instanceof ne&&this.canMergeWith.has(t)&&this.model.schema.checkMerge(e,t)}_tryAutoparagraphing(e){const t=this.writer.createElement("paragraph");this._getAllowedIn(this.position.parent,t)&&this.schema.checkChild(t,e)&&(t._appendChild(e),this._handleNode(t))}_checkAndAutoParagraphToAllowedPosition(e){if(this.schema.checkChild(this.position.parent,e))return!0;if(!this.schema.checkChild(this.position.parent,"paragraph")||!this.schema.checkChild("paragraph",e))return!1;this._insertPartialFragment();const t=this.writer.createElement("paragraph");return this.writer.insert(t,this.position),this._setAffectedBoundaries(this.position),this._lastAutoParagraph=t,this.position=this.writer.createPositionAt(t,0),!0}_checkAndSplitToAllowedPosition(e){const t=this._getAllowedIn(this.position.parent,e);if(!t)return!1;for(t!=this.position.parent&&this._insertPartialFragment();t!=this.position.parent;)if(this.position.isAtStart){const n=this.position.parent;this.position=this.writer.createPositionBefore(n),n.isEmpty&&n.parent===t&&this.writer.remove(n)}else if(this.position.isAtEnd)this.position=this.writer.createPositionAfter(this.position.parent);else{const n=this.writer.createPositionAfter(this.position.parent);this._setAffectedBoundaries(this.position),this.writer.split(this.position),this.position=n,this.canMergeWith.add(this.position.nodeAfter)}return!0}_getAllowedIn(e,t){return this.schema.checkChild(e,t)?e:this.schema.isLimit(e)?null:this._getAllowedIn(e.parent,t)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function kC(i,e,t={}){if(e.isCollapsed)return;const n=e.getFirstRange();if(n.root.rootName=="$graveyard")return;const s=i.schema;i.change(o=>{if(!t.doNotResetEntireContent&&MC(s,e)){RC(o,e);return}const[r,a]=TC(n);r.isTouching(a)||o.remove(o.createRange(r,a)),t.leaveUnmerged||(AC(o,r,a),s.removeDisallowedAttributes(r.parent.getChildren(),o)),Ou(o,e,r),!t.doNotAutoparagraph&&PC(s,r)&&Vu(o,r,e),r.detach(),a.detach()})}function TC(i){const e=i.root.document.model,t=i.start;let n=i.end;if(e.hasContent(i,{ignoreMarkers:!0})){const s=EC(n);if(s&&n.isTouching(e.createPositionAt(s,0))){const o=e.createSelection(i);e.modifySelection(o,{direction:"backward"});const r=o.getLastPosition(),a=e.createRange(r,n);e.hasContent(a,{ignoreMarkers:!0})||(n=r)}}return[Pe.fromPosition(t,"toPrevious"),Pe.fromPosition(n,"toNext")]}function EC(i){const e=i.parent,t=e.root.document.model.schema,n=e.getAncestors({parentFirst:!0,includeSelf:!0});for(const s of n){if(t.isLimit(s))return null;if(t.isBlock(s))return s}}function AC(i,e,t){const n=i.model;if(!Ho(i.model.schema,e,t))return;const[s,o]=xC(e,t);!s||!o||(!n.hasContent(s,{ignoreMarkers:!0})&&n.hasContent(o,{ignoreMarkers:!0})?Mu(i,e,t,s.parent):Ru(i,e,t,s.parent))}function Ru(i,e,t,n){const s=e.parent,o=t.parent;if(!(s==n||o==n)){for(e=i.createPositionAfter(s),t=i.createPositionBefore(o),t.isEqual(e)||i.insert(o,e),i.merge(e);t.parent.isEmpty;){const r=t.parent;t=i.createPositionBefore(r),i.remove(r)}!Ho(i.model.schema,e,t)||Ru(i,e,t,n)}}function Mu(i,e,t,n){const s=e.parent,o=t.parent;if(!(s==n||o==n)){for(e=i.createPositionAfter(s),t=i.createPositionBefore(o),t.isEqual(e)||i.insert(s,t);e.parent.isEmpty;){const r=e.parent;e=i.createPositionBefore(r),i.remove(r)}t=i.createPositionBefore(o),SC(i,t),!!Ho(i.model.schema,e,t)&&Mu(i,e,t,n)}}function SC(i,e){const t=e.nodeBefore,n=e.nodeAfter;t.name!=n.name&&i.rename(t,n.name),i.clearAttributes(t),i.setAttributes(Object.fromEntries(n.getAttributes()),t),i.merge(e)}function Ho(i,e,t){const n=e.parent,s=t.parent;return n==s||i.isLimit(n)||i.isLimit(s)?!1:IC(e,t,i)}function xC(i,e){const t=i.getAncestors(),n=e.getAncestors();let s=0;for(;t[s]&&t[s]==n[s];)s++;return[t[s],n[s]]}function PC(i,e){const t=i.checkChild(e,"$text"),n=i.checkChild(e,"paragraph");return!t&&n}function IC(i,e,t){const n=new E(i,e);for(const s of n.getWalker())if(t.isLimit(s.item))return!1;return!0}function Vu(i,e,t){const n=i.createElement("paragraph");i.insert(n,e),Ou(i,t,i.createPositionAt(n,0))}function RC(i,e){const t=i.model.schema.getLimitElement(e);i.remove(i.createRangeIn(t)),Vu(i,i.createPositionAt(t,0),e)}function MC(i,e){const t=i.getLimitElement(e);if(!e.containsEntireContent(t))return!1;const n=e.getFirstRange();return n.start.parent==n.end.parent?!1:i.checkChild(t,"paragraph")}function Ou(i,e,t){e instanceof tt?i.setSelection(t):e.setTo(t)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Nu=' ,.?!:;"-()';function VC(i,e,t={}){const n=i.schema,s=t.direction!="backward",o=t.unit?t.unit:"character",r=e.focus,a=new St({boundaries:BC(r,s),singleCharacters:!0,direction:s?"forward":"backward"}),l={walker:a,schema:n,isForward:s,unit:o};let c;for(;c=a.next();){if(c.done)return;const u=OC(l,c.value);if(u){e instanceof tt?i.change(d=>{d.setSelectionFocus(u)}):e.setFocus(u);return}}}function OC(i,e){const{isForward:t,walker:n,unit:s,schema:o}=i,{type:r,item:a,nextPosition:l}=e;if(r=="text")return i.unit==="word"?DC(n,t):NC(n,s);if(r==(t?"elementStart":"elementEnd")){if(o.isSelectable(a))return x._createAt(a,t?"after":"before");if(o.checkChild(l,"$text"))return l}else{if(o.isLimit(a)){n.skip(()=>!0);return}if(o.checkChild(l,"$text"))return l}}function NC(i,e){const t=i.position.textNode;if(t){const n=t.data;let s=i.position.offset-t.startOffset;for(;Au(n,s)||e=="character"&&Su(n,s);)i.next(),s=i.position.offset-t.startOffset}return i.position}function DC(i,e){let t=i.position.textNode;if(t){let n=i.position.offset-t.startOffset;for(;!FC(t.data,n,e)&&!LC(t,n,e);){i.next();const s=e?i.position.nodeAfter:i.position.nodeBefore;if(s&&s.is("$text")){const o=s.data.charAt(e?0:s.data.length-1);Nu.includes(o)||(i.next(),t=i.position.textNode)}n=i.position.offset-t.startOffset}}return i.position}function BC(i,e){const t=i.root,n=x._createAt(t,e?"end":0);return e?new E(i,n):new E(n,i)}function FC(i,e,t){const n=e+(t?0:-1);return Nu.includes(i.charAt(n))}function LC(i,e,t){return e===(t?i.endOffset:0)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function zC(i,e){return i.change(t=>{const n=t.createDocumentFragment(),s=e.getFirstRange();if(!s||s.isCollapsed)return n;const o=s.start.root,r=s.start.getCommonPath(s.end),a=o.getNodeByPath(r);let l;s.start.parent==s.end.parent?l=s:l=t.createRange(t.createPositionAt(a,s.start.path[r.length]),t.createPositionAt(a,s.end.path[r.length]+1));const c=l.end.offset-l.start.offset;for(const u of l.getItems({shallow:!0}))u.is("$textProxy")?t.appendText(u.data,u.getAttributes(),n):t.append(t.cloneElement(u,!0),n);if(l!=s){const u=s._getTransformedByMove(l.start,t.createPositionAt(n,0),c)[0],d=t.createRange(t.createPositionAt(n,0),u.start),f=t.createRange(u.end,t.createPositionAt(n,"end"));Du(f,t),Du(d,t)}return n})}function Du(i,e){const t=[];Array.from(i.getItems({direction:"backward"})).map(n=>e.createRangeOn(n)).filter(n=>(n.start.isAfter(i.start)||n.start.isEqual(i.start))&&(n.end.isBefore(i.end)||n.end.isEqual(i.end))).forEach(n=>{t.push(n.start.parent),e.remove(n)}),t.forEach(n=>{let s=n;for(;s.parent&&s.isEmpty;){const o=e.createRangeOn(s);s=s.parent,e.remove(o)}})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function $C(i){i.document.registerPostFixer(e=>HC(e,i))}function HC(i,e){const t=e.document.selection,n=e.schema,s=[];let o=!1;for(const r of t.getRanges()){const a=UC(r,n);a&&!a.isEqual(r)?(s.push(a),o=!0):s.push(r)}o&&i.setSelection(KC(s),{backward:t.isBackward})}function UC(i,e){return i.isCollapsed?WC(i,e):qC(i,e)}function WC(i,e){const t=i.start,n=e.getNearestSelectionRange(t);if(!n){const o=t.getAncestors().reverse().find(r=>e.isObject(r));return o?E._createOn(o):null}if(!n.isCollapsed)return n;const s=n.start;return t.isEqual(s)?null:new E(s)}function qC(i,e){const{start:t,end:n}=i,s=e.checkChild(t,"$text"),o=e.checkChild(n,"$text"),r=e.getLimitElement(t),a=e.getLimitElement(n);if(r===a){if(s&&o)return null;if(jC(t,n,e)){const d=t.nodeAfter&&e.isSelectable(t.nodeAfter)?null:e.getNearestSelectionRange(t,"forward"),b=n.nodeBefore&&e.isSelectable(n.nodeBefore)?null:e.getNearestSelectionRange(n,"backward"),_=d?d.start:t,C=b?b.end:n;return new E(_,C)}}const l=r&&!r.is("rootElement"),c=a&&!a.is("rootElement");if(l||c){const u=t.nodeAfter&&n.nodeBefore&&t.nodeAfter.parent===n.nodeBefore.parent,d=l&&(!u||!Fu(t.nodeAfter,e)),f=c&&(!u||!Fu(n.nodeBefore,e));let b=t,_=n;return d&&(b=x._createBefore(Bu(r,e))),f&&(_=x._createAfter(Bu(a,e))),new E(b,_)}return null}function Bu(i,e){let t=i,n=t;for(;e.isLimit(n)&&n.parent;)t=n,n=n.parent;return t}function jC(i,e,t){const n=i.nodeAfter&&!t.isLimit(i.nodeAfter)||t.checkChild(i,"$text"),s=e.nodeBefore&&!t.isLimit(e.nodeBefore)||t.checkChild(e,"$text");return n||s}function KC(i){const e=[...i],t=new Set;let n=1;for(;n<e.length;){const o=e[n],r=e.slice(0,n);for(const[a,l]of r.entries())if(!t.has(a)){if(o.isEqual(l))t.add(a);else if(o.isIntersecting(l)){t.add(a),t.add(n);const c=o.getJoined(l);e.push(c)}}n++}return e.filter((o,r)=>!t.has(r))}function Fu(i,e){return i&&e.isSelectable(i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Lu{constructor(){this.markers=new Iu,this.document=new xu(this),this.schema=new fu,this._pendingChanges=[],this._currentWriter=null,["insertContent","deleteContent","modifySelection","getSelectedContent","applyOperation"].forEach(e=>this.decorate(e)),this.on("applyOperation",(e,t)=>{t[0]._validate()},{priority:"highest"}),this.schema.register("$root",{isLimit:!0}),this.schema.register("$block",{allowIn:"$root",isBlock:!0}),this.schema.register("$text",{allowIn:"$block",isInline:!0,isContent:!0}),this.schema.register("$clipboardHolder",{allowContentOf:"$root",allowChildren:"$text",isLimit:!0}),this.schema.register("$documentFragment",{allowContentOf:"$root",allowChildren:"$text",isLimit:!0}),this.schema.register("$marker"),this.schema.addChildCheck((e,t)=>{if(t.name==="$marker")return!0}),$C(this),this.document.registerPostFixer(su)}change(e){try{return this._pendingChanges.length===0?(this._pendingChanges.push({batch:new Zi,callback:e}),this._runPendingChanges()[0]):e(this._currentWriter)}catch(t){p.rethrowUnexpectedError(t,this)}}enqueueChange(e,t){try{typeof e=="string"?e=new Zi(e):typeof e=="function"&&(t=e,e=new Zi),this._pendingChanges.push({batch:e,callback:t}),this._pendingChanges.length==1&&this._runPendingChanges()}catch(n){p.rethrowUnexpectedError(n,this)}}applyOperation(e){e._execute()}insertContent(e,t,n){return yC(this,e,t,n)}deleteContent(e,t){kC(this,e,t)}modifySelection(e,t){VC(this,e,t)}getSelectedContent(e){return zC(this,e)}hasContent(e,t={}){const n=e instanceof ne?E._createIn(e):e;if(n.isCollapsed)return!1;const{ignoreWhitespaces:s=!1,ignoreMarkers:o=!1}=t;if(!o){for(const r of this.markers.getMarkersIntersectingRange(n))if(r.affectsData)return!0}for(const r of n.getItems())if(this.schema.isContent(r))if(r.is("$textProxy"))if(s){if(r.data.search(/\S/)!==-1)return!0}else return!0;else return!0;return!1}createPositionFromPath(e,t,n){return new x(e,t,n)}createPositionAt(e,t){return x._createAt(e,t)}createPositionAfter(e){return x._createAfter(e)}createPositionBefore(e){return x._createBefore(e)}createRange(e,t){return new E(e,t)}createRangeIn(e){return E._createIn(e)}createRangeOn(e){return E._createOn(e)}createSelection(e,t,n){return new xt(e,t,n)}createBatch(e){return new Zi(e)}createOperationFromJSON(e){return bC.fromJSON(e,this.document)}destroy(){this.document.destroy(),this.stopListening()}_runPendingChanges(){const e=[];for(this.fire("_beforeChanges");this._pendingChanges.length;){const t=this._pendingChanges[0].batch;this._currentWriter=new cC(this,t);const n=this._pendingChanges[0].callback(this._currentWriter);e.push(n),this.document._handleChangeBlock(this._currentWriter),this._pendingChanges.shift(),this._currentWriter=null}return this.fire("_afterChanges"),e}}F(Lu,re);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class GC extends At{constructor(e){super();this.editor=e}set(e,t,n={}){if(typeof t=="string"){const s=t;t=(o,r)=>{this.editor.execute(s),r()}}super.set(e,t,n)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class zu{constructor(e={}){const t=e.language||this.constructor.defaultConfig&&this.constructor.defaultConfig.language;this._context=e.context||new A1({language:t}),this._context._addEditor(this,!e.context);const n=Array.from(this.constructor.builtinPlugins||[]);this.config=new Xl(e,this.constructor.defaultConfig),this.config.define("plugins",n),this.config.define(this._context._getEditorConfig()),this.plugins=new co(this,n,this._context.plugins),this.locale=this._context.locale,this.t=this.locale.t,this.commands=new By,this.set("state","initializing"),this.once("ready",()=>this.state="ready",{priority:"high"}),this.once("destroy",()=>this.state="destroyed",{priority:"high"}),this.set("isReadOnly",!1),this.model=new Lu;const s=new D1;this.data=new wu(this.model,s),this.editing=new hu(this.model,s),this.editing.view.document.bind("isReadOnly").to(this),this.conversion=new oC([this.editing.downcastDispatcher,this.data.downcastDispatcher],this.data.upcastDispatcher),this.conversion.addAlias("dataDowncast",this.data.downcastDispatcher),this.conversion.addAlias("editingDowncast",this.editing.downcastDispatcher),this.keystrokes=new GC(this),this.keystrokes.listenTo(this.editing.view.document)}initPlugins(){const e=this.config,t=e.get("plugins"),n=e.get("removePlugins")||[],s=e.get("extraPlugins")||[],o=e.get("substitutePlugins")||[];return this.plugins.init(t.concat(s),n,o)}destroy(){let e=Promise.resolve();return this.state=="initializing"&&(e=new Promise(t=>this.once("ready",t))),e.then(()=>{this.fire("destroy"),this.stopListening(),this.commands.destroy()}).then(()=>this.plugins.destroy()).then(()=>{this.model.destroy(),this.data.destroy(),this.editing.destroy(),this.keystrokes.destroy()}).then(()=>this._context._removeEditor(this))}execute(...e){try{return this.commands.execute(...e)}catch(t){p.rethrowUnexpectedError(t,this)}}focus(){this.editing.view.focus()}}F(zu,re);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class JC{constructor(e){this.editor=e,this._components=new Map}*names(){for(const e of this._components.values())yield e.originalName}add(e,t){this._components.set(Uo(e),{callback:t,originalName:e})}create(e){if(!this.has(e))throw new p("componentfactory-item-missing",this,{name:e});return this._components.get(Uo(e)).callback(this.editor.locale)}has(e){return this._components.has(Uo(e))}}function Uo(i){return String(i).toLowerCase()}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class $u{constructor(e){this.editor=e,this.componentFactory=new JC(e),this.focusTracker=new Je,this.set("viewportOffset",this._readViewportOffsetFromConfig()),this._editableElementsMap=new Map,this.listenTo(e.editing.view.document,"layoutChanged",()=>this.update())}get element(){return null}update(){this.fire("update")}destroy(){this.stopListening(),this.focusTracker.destroy();for(const e of this._editableElementsMap.values())e.ckeditorInstance=null;this._editableElementsMap=new Map}setEditableElement(e,t){this._editableElementsMap.set(e,t),t.ckeditorInstance||(t.ckeditorInstance=this.editor)}getEditableElement(e="main"){return this._editableElementsMap.get(e)}getEditableElementsNames(){return this._editableElementsMap.keys()}get _editableElements(){return console.warn("editor-ui-deprecated-editable-elements: The EditorUI#_editableElements property has been deprecated and will be removed in the near future.",{editorUI:this}),this._editableElementsMap}_readViewportOffsetFromConfig(){const e=this.editor,t=e.config.get("ui.viewportOffset");if(t)return t;const n=e.config.get("toolbar.viewportTopOffset");return n?(console.warn("editor-ui-deprecated-viewport-offset-config: The `toolbar.vieportTopOffset` configuration option is deprecated. It will be removed from future CKEditor versions. Use `ui.viewportOffset.top` instead."),{top:n}):{top:0}}}F($u,re);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const QC={setData(i){this.data.set(i)},getData(i){return this.data.get(i)}};/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function YC(i){const e=i.sourceElement;if(!!e){if(e.ckeditorInstance)throw new p("editor-source-element-already-used",i);e.ckeditorInstance=i,i.once("destroy",()=>{delete e.ckeditorInstance})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class es extends oi{static get pluginName(){return"PendingActions"}init(){this.set("hasAny",!1),this._actions=new $e({idProperty:"_id"}),this._actions.delegate("add","remove").to(this)}add(e){if(typeof e!="string")throw new p("pendingactions-add-invalid-message",this);const t=Object.create(re);return t.set("message",e),this._actions.add(t),this.hasAny=!0,t}remove(e){this._actions.remove(e),this.hasAny=!!this._actions.length}get first(){return this._actions.get(0)}[Symbol.iterator](){return this._actions[Symbol.iterator]()}}var XC='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.591 10.177 4.243 4.242a1 1 0 0 1-1.415 1.415l-4.242-4.243-4.243 4.243a1 1 0 0 1-1.414-1.415l4.243-4.242L4.52 5.934A1 1 0 0 1 5.934 4.52l4.243 4.243 4.242-4.243a1 1 0 1 1 1.415 1.414l-4.243 4.243z"/></svg>',ZC='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 16h9a1 1 0 0 1 0 2H2a1 1 0 0 1 0-2z"/><path d="M17 1a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h14zm0 1.5H3a.5.5 0 0 0-.492.41L2.5 3v9a.5.5 0 0 0 .41.492L3 12.5h14a.5.5 0 0 0 .492-.41L17.5 12V3a.5.5 0 0 0-.41-.492L17 2.5z" fill-opacity=".6"/></svg>',ek='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6.972 16.615a.997.997 0 0 1-.744-.292l-4.596-4.596a1 1 0 1 1 1.414-1.414l3.926 3.926 9.937-9.937a1 1 0 0 1 1.414 1.415L7.717 16.323a.997.997 0 0 1-.745.292z"/></svg>',tk='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.333 2 .19 2.263a5.899 5.899 0 0 1 1.458.604L14.714 3.4 16.6 5.286l-1.467 1.733c.263.452.468.942.605 1.46L18 8.666v2.666l-2.263.19a5.899 5.899 0 0 1-.604 1.458l1.467 1.733-1.886 1.886-1.733-1.467a5.899 5.899 0 0 1-1.46.605L11.334 18H8.667l-.19-2.263a5.899 5.899 0 0 1-1.458-.604L5.286 16.6 3.4 14.714l1.467-1.733a5.899 5.899 0 0 1-.604-1.458L2 11.333V8.667l2.262-.189a5.899 5.899 0 0 1 .605-1.459L3.4 5.286 5.286 3.4l1.733 1.467a5.899 5.899 0 0 1 1.46-.605L8.666 2h2.666zM10 6.267a3.733 3.733 0 1 0 0 7.466 3.733 3.733 0 0 0 0-7.466z"/></svg>',nk='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m8.636 9.531-2.758 3.94a.5.5 0 0 0 .122.696l3.224 2.284h1.314l2.636-3.736L8.636 9.53zm.288 8.451L5.14 15.396a2 2 0 0 1-.491-2.786l6.673-9.53a2 2 0 0 1 2.785-.49l3.742 2.62a2 2 0 0 1 .491 2.785l-7.269 10.053-2.147-.066z"/><path d="M4 18h5.523v-1H4zm-2 0h1v-1H2z"/></svg>',ik='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M5.085 6.22 2.943 4.078a.75.75 0 1 1 1.06-1.06l2.592 2.59A11.094 11.094 0 0 1 10 5.068c4.738 0 8.578 3.101 8.578 5.083 0 1.197-1.401 2.803-3.555 3.887l1.714 1.713a.75.75 0 0 1-.09 1.138.488.488 0 0 1-.15.084.75.75 0 0 1-.821-.16L6.17 7.304c-.258.11-.51.233-.757.365l6.239 6.24-.006.005.78.78c-.388.094-.78.166-1.174.215l-1.11-1.11h.011L4.55 8.197a7.2 7.2 0 0 0-.665.514l-.112.098 4.897 4.897-.005.006 1.276 1.276a10.164 10.164 0 0 1-1.477-.117l-.479-.479-.009.009-4.863-4.863-.022.031a2.563 2.563 0 0 0-.124.2c-.043.077-.08.158-.108.241a.534.534 0 0 0-.028.133.29.29 0 0 0 .008.072.927.927 0 0 0 .082.226c.067.133.145.26.234.379l3.242 3.365.025.01.59.623c-3.265-.918-5.59-3.155-5.59-4.668 0-1.194 1.448-2.838 3.663-3.93zm7.07.531a4.632 4.632 0 0 1 1.108 5.992l.345.344.046-.018a9.313 9.313 0 0 0 2-1.112c.256-.187.5-.392.727-.613.137-.134.27-.277.392-.431.072-.091.141-.185.203-.286.057-.093.107-.19.148-.292a.72.72 0 0 0 .036-.12.29.29 0 0 0 .008-.072.492.492 0 0 0-.028-.133.999.999 0 0 0-.036-.096 2.165 2.165 0 0 0-.071-.145 2.917 2.917 0 0 0-.125-.2 3.592 3.592 0 0 0-.263-.335 5.444 5.444 0 0 0-.53-.523 7.955 7.955 0 0 0-1.054-.768 9.766 9.766 0 0 0-1.879-.891c-.337-.118-.68-.219-1.027-.301zm-2.85.21-.069.002a.508.508 0 0 0-.254.097.496.496 0 0 0-.104.679.498.498 0 0 0 .326.199l.045.005c.091.003.181.003.272.012a2.45 2.45 0 0 1 2.017 1.513c.024.061.043.125.069.185a.494.494 0 0 0 .45.287h.008a.496.496 0 0 0 .35-.158.482.482 0 0 0 .13-.335.638.638 0 0 0-.048-.219 3.379 3.379 0 0 0-.36-.723 3.438 3.438 0 0 0-2.791-1.543l-.028-.001h-.013z"/></svg>',sk='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6.91 10.54c.26-.23.64-.21.88.03l3.36 3.14 2.23-2.06a.64.64 0 0 1 .87 0l2.52 2.97V4.5H3.2v10.12l3.71-4.08zm10.27-7.51c.6 0 1.09.47 1.09 1.05v11.84c0 .59-.49 1.06-1.09 1.06H2.79c-.6 0-1.09-.47-1.09-1.06V4.08c0-.58.49-1.05 1.1-1.05h14.38zm-5.22 5.56a1.96 1.96 0 1 1 3.4-1.96 1.96 1.96 0 0 1-3.4 1.96z"/></svg>',ok='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m9.239 13.938-2.88-1.663a.75.75 0 0 1 .75-1.3L9 12.067V4.75a.75.75 0 1 1 1.5 0v7.318l1.89-1.093a.75.75 0 0 1 .75 1.3l-2.879 1.663a.752.752 0 0 1-.511.187.752.752 0 0 1-.511-.187zM4.25 17a.75.75 0 1 1 0-1.5h10.5a.75.75 0 0 1 0 1.5H4.25z"/></svg>',rk='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.75 11.875a.752.752 0 0 1 .508.184l2.883 1.666a.75.75 0 0 1-.659 1.344l-.091-.044-1.892-1.093.001 4.318a.75.75 0 1 1-1.5 0v-4.317l-1.89 1.092a.75.75 0 0 1-.75-1.3l2.879-1.663a.752.752 0 0 1 .51-.187zM15.25 9a.75.75 0 1 1 0 1.5H4.75a.75.75 0 1 1 0-1.5h10.5zM9.75.375a.75.75 0 0 1 .75.75v4.318l1.89-1.093.092-.045a.75.75 0 0 1 .659 1.344l-2.883 1.667a.752.752 0 0 1-.508.184.752.752 0 0 1-.511-.187L6.359 5.65a.75.75 0 0 1 .75-1.299L9 5.442V1.125a.75.75 0 0 1 .75-.75z"/></svg>',ak='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m10.261 7.062 2.88 1.663a.75.75 0 0 1-.75 1.3L10.5 8.933v7.317a.75.75 0 1 1-1.5 0V8.932l-1.89 1.093a.75.75 0 0 1-.75-1.3l2.879-1.663a.752.752 0 0 1 .511-.187.752.752 0 0 1 .511.187zM15.25 4a.75.75 0 1 1 0 1.5H4.75a.75.75 0 0 1 0-1.5h10.5z"/></svg>',lk='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 4c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0-8c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75z"/></svg>',ck='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm2.286 4c0 .414.336.75.75.75h9.928a.75.75 0 1 0 0-1.5H5.036a.75.75 0 0 0-.75.75zm0-8c0 .414.336.75.75.75h9.928a.75.75 0 1 0 0-1.5H5.036a.75.75 0 0 0-.75.75z"/></svg>',uk='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M18 3.75a.75.75 0 0 1-.75.75H2.75a.75.75 0 1 1 0-1.5h14.5a.75.75 0 0 1 .75.75zm0 8a.75.75 0 0 1-.75.75H2.75a.75.75 0 1 1 0-1.5h14.5a.75.75 0 0 1 .75.75zm0 4a.75.75 0 0 1-.75.75H7.321a.75.75 0 1 1 0-1.5h9.929a.75.75 0 0 1 .75.75zm0-8a.75.75 0 0 1-.75.75H7.321a.75.75 0 1 1 0-1.5h9.929a.75.75 0 0 1 .75.75z"/></svg>',dk='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0 4c0 .414.336.75.75.75h9.929a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm0-8c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75z"/></svg>',hk='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm0 12h16v1.5H2z"/><path d="M12.003 7v5.5a1 1 0 0 1-1 1H2.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H3.5V12h6.997V7.5z"/></svg>',fk='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm0 12h16v1.5H2z"/><path d="M15.003 7v5.5a1 1 0 0 1-1 1H5.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H6.5V12h6.997V7.5z"/></svg>',mk='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm0 12h16v1.5H2z"/><path d="M18.003 7v5.5a1 1 0 0 1-1 1H8.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H9.5V12h6.997V7.5z"/></svg>',gk='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm0 12h16v1.5H2z"/><path d="M18 7v5.5a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1zm-1.505.5H3.504V12h12.991V7.5z"/></svg>',pk='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm11.5 9H18v1.5h-4.5zM2 15h16v1.5H2z"/><path d="M12.003 7v5.5a1 1 0 0 1-1 1H2.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H3.5V12h6.997V7.5z"/></svg>',wk='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm11.5 9H18v1.5h-4.5zm0-3H18v1.5h-4.5zm0-3H18v1.5h-4.5zM2 15h16v1.5H2z"/><path d="M12.003 7v5.5a1 1 0 0 1-1 1H2.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H3.5V12h6.997V7.5z"/></svg>',bk='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path opacity=".5" d="M2 3h16v1.5H2zm0 12h16v1.5H2zm0-9h5v1.5H2zm0 3h5v1.5H2zm0 3h5v1.5H2z"/><path d="M18.003 7v5.5a1 1 0 0 1-1 1H8.996a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h8.007a1 1 0 0 1 1 1zm-1.506.5H9.5V12h6.997V7.5z"/></svg>',_k='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M2.5 17v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zM1 15.5v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm0-2v1h-1v-1h1zm-19 0v1H0v-1h1zM14.5 2v1h-1V2h1zm2 0v1h-1V2h1zm2 0v1h-1V2h1zm-8 0v1h-1V2h1zm-2 0v1h-1V2h1zm-2 0v1h-1V2h1zm-2 0v1h-1V2h1zm8 0v1h-1V2h1zm-10 0v1h-1V2h1z"/><path d="M18.095 2H1.905C.853 2 0 2.895 0 4v12c0 1.105.853 2 1.905 2h16.19C19.147 18 20 17.105 20 16V4c0-1.105-.853-2-1.905-2zm0 1.5c.263 0 .476.224.476.5v12c0 .276-.213.5-.476.5H1.905a.489.489 0 0 1-.476-.5V4c0-.276.213-.5.476-.5h16.19z"/></svg>',vk='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M2.5 17v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zM1 15.5v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm0-2v1h-1v-1h1zm-19 0v1H0v-1h1zM14.5 2v1h-1V2h1zm2 0v1h-1V2h1zm2 0v1h-1V2h1zm-8 0v1h-1V2h1zm-2 0v1h-1V2h1zm-2 0v1h-1V2h1zm-2 0v1h-1V2h1zm8 0v1h-1V2h1zm-10 0v1h-1V2h1z"/><path d="M13 6H2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2zm0 1.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5V8a.5.5 0 0 1 .5-.5h11z"/></svg>',yk='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M2.5 17v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zM1 15.5v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm0-2v1h-1v-1h1zm-19 0v1H0v-1h1zM14.5 2v1h-1V2h1zm2 0v1h-1V2h1zm2 0v1h-1V2h1zm-8 0v1h-1V2h1zm-2 0v1h-1V2h1zm-2 0v1h-1V2h1zm-2 0v1h-1V2h1zm8 0v1h-1V2h1zm-10 0v1h-1V2h1z"/><path d="M7 10H2a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h5a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2zm0 1.5a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5v-4a.5.5 0 0 1 .5-.5h5z"/></svg>',Ck='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M2.5 17v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zm2 0v1h-1v-1h1zM1 15.5v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm-19-2v1H0v-1h1zm19 0v1h-1v-1h1zm0-2v1h-1v-1h1zm-19 0v1H0v-1h1zM14.5 2v1h-1V2h1zm2 0v1h-1V2h1zm2 0v1h-1V2h1zm-8 0v1h-1V2h1zm-2 0v1h-1V2h1zm-2 0v1h-1V2h1zm-2 0v1h-1V2h1zm8 0v1h-1V2h1zm-10 0v1h-1V2h1z"/><path d="M10 8H2a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-6a2 2 0 0 0-2-2zm0 1.5a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5v-6a.5.5 0 0 1 .5-.5h8z"/></svg>',kk='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m7.3 17.37-.061.088a1.518 1.518 0 0 1-.934.535l-4.178.663-.806-4.153a1.495 1.495 0 0 1 .187-1.058l.056-.086L8.77 2.639c.958-1.351 2.803-1.076 4.296-.03 1.497 1.047 2.387 2.693 1.433 4.055L7.3 17.37zM9.14 4.728l-5.545 8.346 3.277 2.294 5.544-8.346L9.14 4.728zM6.07 16.512l-3.276-2.295.53 2.73 2.746-.435zM9.994 3.506 13.271 5.8c.316-.452-.16-1.333-1.065-1.966-.905-.634-1.895-.78-2.212-.328zM8 18.5 9.375 17H19v1.5H8z"/></svg>',Tk='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6.999 2H15a1 1 0 0 1 0 2h-1.004v13a1 1 0 1 1-2 0V4H8.999v13a1 1 0 1 1-2 0v-7A4 4 0 0 1 3 6a4 4 0 0 1 3.999-4z"/></svg>',Ek='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 10.423a6.5 6.5 0 0 1 6.056-6.408l.038.67C6.448 5.423 5.354 7.663 5.22 10H9c.552 0 .5.432.5.986v4.511c0 .554-.448.503-1 .503h-5c-.552 0-.5-.449-.5-1.003v-4.574zm8 0a6.5 6.5 0 0 1 6.056-6.408l.038.67c-2.646.739-3.74 2.979-3.873 5.315H17c.552 0 .5.432.5.986v4.511c0 .554-.448.503-1 .503h-5c-.552 0-.5-.449-.5-1.003v-4.574z"/></svg>',Hu='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><circle cx="9.5" cy="4.5" r="1.5"/><circle cx="9.5" cy="10.5" r="1.5"/><circle cx="9.5" cy="16.5" r="1.5"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Ve={cancel:XC,caption:ZC,check:ek,cog:tk,eraser:nk,lowVision:ik,image:sk,alignBottom:ok,alignMiddle:rk,alignTop:ak,alignLeft:lk,alignCenter:ck,alignRight:uk,alignJustify:dk,objectLeft:wk,objectCenter:fk,objectRight:bk,objectFullWidth:gk,objectInline:pk,objectBlockLeft:hk,objectBlockRight:mk,objectSizeFull:_k,objectSizeLarge:vk,objectSizeSmall:yk,objectSizeMedium:Ck,pencil:kk,pilcrow:Tk,quote:Ek,threeVerticalDots:Hu};/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Wo({emitter:i,activator:e,callback:t,contextElements:n}){i.listenTo(document,"mousedown",(s,o)=>{if(!e())return;const r=typeof o.composedPath=="function"?o.composedPath():[];for(const a of n)if(a.contains(o.target)||r.includes(a))return;t()})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function qo(i){i.set("_isCssTransitionsDisabled",!1),i.disableCssTransitions=()=>{i._isCssTransitionsDisabled=!0},i.enableCssTransitions=()=>{i._isCssTransitionsDisabled=!1},i.extendTemplate({attributes:{class:[i.bindTemplate.if("_isCssTransitionsDisabled","ck-transitions-disabled")]}})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function jo({view:i}){i.listenTo(i.element,"submit",(e,t)=>{t.preventDefault(),i.fire("submit")},{useCapture:!0})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class an extends $e{constructor(e=[]){super(e,{idProperty:"viewUid"});this.on("add",(t,n,s)=>{this._renderViewIntoCollectionParent(n,s)}),this.on("remove",(t,n)=>{n.element&&this._parentElement&&n.element.remove()}),this._parentElement=null}destroy(){this.map(e=>e.destroy())}setParent(e){this._parentElement=e;for(const t of this)this._renderViewIntoCollectionParent(t)}delegate(...e){if(!e.length||!Ak(e))throw new p("ui-viewcollection-delegate-wrong-events",this);return{to:t=>{for(const n of this)for(const s of e)n.delegate(s).to(t);this.on("add",(n,s)=>{for(const o of e)s.delegate(o).to(t)}),this.on("remove",(n,s)=>{for(const o of e)s.stopDelegating(o,t)})}}}_renderViewIntoCollectionParent(e,t){e.isRendered||e.render(),e.element&&this._parentElement&&this._parentElement.insertBefore(e.element,this._parentElement.children[t])}}function Ak(i){return i.every(e=>typeof e=="string")}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class j{constructor(e){this.element=null,this.isRendered=!1,this.locale=e,this.t=e&&e.t,this._viewCollections=new $e,this._unboundChildren=this.createCollection(),this._viewCollections.on("add",(t,n)=>{n.locale=e}),this.decorate("render")}get bindTemplate(){return this._bindTemplate?this._bindTemplate:this._bindTemplate=it.bind(this,this)}createCollection(e){const t=new an(e);return this._viewCollections.add(t),t}registerChild(e){Ke(e)||(e=[e]);for(const t of e)this._unboundChildren.add(t)}deregisterChild(e){Ke(e)||(e=[e]);for(const t of e)this._unboundChildren.remove(t)}setTemplate(e){this.template=new it(e)}extendTemplate(e){it.extend(this.template,e)}render(){if(this.isRendered)throw new p("ui-view-render-already-rendered",this);this.template&&(this.element=this.template.render(),this.registerChild(this.template.getViews())),this.isRendered=!0}destroy(){this.stopListening(),this._viewCollections.map(e=>e.destroy()),this.template&&this.template._revertData&&this.template.revert(this.element)}}F(j,Cn);F(j,re);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Sk="http://www.w3.org/1999/xhtml";class it{constructor(e){Object.assign(this,ju(qu(e))),this._isRendered=!1,this._revertData=null}render(){const e=this._renderNode({intoFragment:!0});return this._isRendered=!0,e}apply(e){return this._revertData=Yu(),this._renderNode({node:e,isApplying:!0,revertData:this._revertData}),e}revert(e){if(!this._revertData)throw new p("ui-template-revert-not-applied",[this,e]);this._revertTemplateFromNode(e,this._revertData)}*getViews(){function*e(t){if(t.children)for(const n of t.children)ns(n)?yield n:Ko(n)&&(yield*e(n))}yield*e(this)}static bind(e,t){return{to(n,s){return new xk({eventNameOrFunction:n,attribute:n,observable:e,emitter:t,callback:s})},if(n,s,o){return new Uu({observable:e,emitter:t,attribute:n,valueIfTrue:s,callback:o})}}}static extend(e,t){if(e._isRendered)throw new p("template-extend-render",[this,e]);Qu(e,ju(qu(t)))}_renderNode(e){let t;if(e.node?t=this.tag&&this.text:t=this.tag?this.text:!this.text,t)throw new p("ui-template-wrong-syntax",this);return this.text?this._renderText(e):this._renderElement(e)}_renderElement(e){let t=e.node;return t||(t=e.node=document.createElementNS(this.ns||Sk,this.tag)),this._renderAttributes(e),this._renderElementChildren(e),this._setUpListeners(e),t}_renderText(e){let t=e.node;return t?e.revertData.text=t.textContent:t=e.node=document.createTextNode(""),ts(this.text)?this._bindToObservable({schema:this.text,updater:Ik(t),data:e}):t.textContent=this.text.join(""),t}_renderAttributes(e){let t,n,s,o;if(!this.attributes)return;const r=e.node,a=e.revertData;for(t in this.attributes)if(s=r.getAttribute(t),n=this.attributes[t],a&&(a.attributes[t]=s),o=be(n[0])&&n[0].ns?n[0].ns:null,ts(n)){const l=o?n[0].value:n;a&&Xu(t)&&l.unshift(s),this._bindToObservable({schema:l,updater:Rk(r,t,o),data:e})}else t=="style"&&typeof n[0]!="string"?this._renderStyleAttribute(n[0],e):(a&&s&&Xu(t)&&n.unshift(s),n=n.map(l=>l&&(l.value||l)).reduce((l,c)=>l.concat(c),[]).reduce(Gu,""),An(n)||r.setAttributeNS(o,t,n))}_renderStyleAttribute(e,t){const n=t.node;for(const s in e){const o=e[s];ts(o)?this._bindToObservable({schema:[o],updater:Mk(n,s),data:t}):n.style[s]=o}}_renderElementChildren(e){const t=e.node,n=e.intoFragment?document.createDocumentFragment():t,s=e.isApplying;let o=0;for(const r of this.children)if(Go(r)){if(!s){r.setParent(t);for(const a of r)n.appendChild(a.element)}}else if(ns(r))s||(r.isRendered||r.render(),n.appendChild(r.element));else if(yn(r))n.appendChild(r);else if(s){const a=e.revertData,l=Yu();a.children.push(l),r._renderNode({node:n.childNodes[o++],isApplying:!0,revertData:l})}else n.appendChild(r.render());e.intoFragment&&t.appendChild(n)}_setUpListeners(e){if(!!this.eventListeners)for(const t in this.eventListeners){const n=this.eventListeners[t].map(s=>{const[o,r]=t.split("@");return s.activateDomEventListener(o,r,e)});e.revertData&&e.revertData.bindings.push(n)}}_bindToObservable({schema:e,updater:t,data:n}){const s=n.revertData;Wu(e,t,n);const o=e.filter(r=>!An(r)).filter(r=>r.observable).map(r=>r.activateAttributeListener(e,t,n));s&&s.bindings.push(o)}_revertTemplateFromNode(e,t){for(const n of t.bindings)for(const s of n)s();if(t.text){e.textContent=t.text;return}for(const n in t.attributes){const s=t.attributes[n];s===null?e.removeAttribute(n):e.setAttribute(n,s)}for(let n=0;n<t.children.length;++n)this._revertTemplateFromNode(e.childNodes[n],t.children[n])}}F(it,oe);class gi{constructor(e){Object.assign(this,e)}getValue(e){const t=this.observable[this.attribute];return this.callback?this.callback(t,e):t}activateAttributeListener(e,t,n){const s=()=>Wu(e,t,n);return this.emitter.listenTo(this.observable,"change:"+this.attribute,s),()=>{this.emitter.stopListening(this.observable,"change:"+this.attribute,s)}}}class xk extends gi{activateDomEventListener(e,t,n){const s=(o,r)=>{(!t||r.target.matches(t))&&(typeof this.eventNameOrFunction=="function"?this.eventNameOrFunction(r):this.observable.fire(this.eventNameOrFunction,r))};return this.emitter.listenTo(n.node,e,s),()=>{this.emitter.stopListening(n.node,e,s)}}}class Uu extends gi{getValue(e){const t=super.getValue(e);return An(t)?!1:this.valueIfTrue||!0}}function ts(i){return i?(i.value&&(i=i.value),Array.isArray(i)?i.some(ts):i instanceof gi):!1}function Pk(i,e){return i.map(t=>t instanceof gi?t.getValue(e):t)}function Wu(i,e,{node:t}){let n=Pk(i,t);i.length==1&&i[0]instanceof Uu?n=n[0]:n=n.reduce(Gu,""),An(n)?e.remove():e.set(n)}function Ik(i){return{set(e){i.textContent=e},remove(){i.textContent=""}}}function Rk(i,e,t){return{set(n){i.setAttributeNS(t,e,n)},remove(){i.removeAttributeNS(t,e)}}}function Mk(i,e){return{set(t){i.style[e]=t},remove(){i.style[e]=null}}}function qu(i){return Vl(i,t=>{if(t&&(t instanceof gi||Ko(t)||ns(t)||Go(t)))return t})}function ju(i){if(typeof i=="string"?i=Nk(i):i.text&&Dk(i),i.on&&(i.eventListeners=Ok(i.on),delete i.on),!i.text){i.attributes&&Vk(i.attributes);const e=[];if(i.children)if(Go(i.children))e.push(i.children);else for(const t of i.children)Ko(t)||ns(t)||yn(t)?e.push(t):e.push(new it(t));i.children=e}return i}function Vk(i){for(const e in i)i[e].value&&(i[e].value=Ee(i[e].value)),Ku(i,e)}function Ok(i){for(const e in i)Ku(i,e);return i}function Nk(i){return{text:[i]}}function Dk(i){i.text=Ee(i.text)}function Ku(i,e){i[e]=Ee(i[e])}function Gu(i,e){return An(e)?i:An(i)?e:`${i} ${e}`}function Ju(i,e){for(const t in e)i[t]?i[t].push(...e[t]):i[t]=e[t]}function Qu(i,e){if(e.attributes&&(i.attributes||(i.attributes={}),Ju(i.attributes,e.attributes)),e.eventListeners&&(i.eventListeners||(i.eventListeners={}),Ju(i.eventListeners,e.eventListeners)),e.text&&i.text.push(...e.text),e.children&&e.children.length){if(i.children.length!=e.children.length)throw new p("ui-template-extend-children-mismatch",i);let t=0;for(const n of e.children)Qu(i.children[t++],n)}}function An(i){return!i&&i!==0}function ns(i){return i instanceof j}function Ko(i){return i instanceof it}function Go(i){return i instanceof an}function Yu(){return{children:[],bindings:[],attributes:{}}}function Xu(i){return i=="class"||i=="style"}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Bk extends an{constructor(e,t=[]){super(t);this.locale=e}attachToDom(){this._bodyCollectionContainer=new it({tag:"div",attributes:{class:["ck","ck-reset_all","ck-body","ck-rounded-corners"],dir:this.locale.uiLanguageDirection},children:this}).render();let e=document.querySelector(".ck-body-wrapper");e||(e=xo(document,"div",{class:"ck-body-wrapper"}),document.body.appendChild(e)),e.appendChild(this._bodyCollectionContainer)}detachFromDom(){super.destroy(),this._bodyCollectionContainer&&this._bodyCollectionContainer.remove();const e=document.querySelector(".ck-body-wrapper");e&&e.childElementCount==0&&e.remove()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class is extends j{constructor(){super();const e=this.bindTemplate;this.set("content",""),this.set("viewBox","0 0 20 20"),this.set("fillColor",""),this.setTemplate({tag:"svg",ns:"http://www.w3.org/2000/svg",attributes:{class:["ck","ck-icon"],viewBox:e.to("viewBox")}})}render(){super.render(),this._updateXMLContent(),this._colorFillPaths(),this.on("change:content",()=>{this._updateXMLContent(),this._colorFillPaths()}),this.on("change:fillColor",()=>{this._colorFillPaths()})}_updateXMLContent(){if(this.content){const t=new DOMParser().parseFromString(this.content.trim(),"image/svg+xml").querySelector("svg"),n=t.getAttribute("viewBox");for(n&&(this.viewBox=n),this.element.innerHTML="";t.childNodes.length>0;)this.element.appendChild(t.childNodes[0])}}_colorFillPaths(){this.fillColor&&this.element.querySelectorAll(".ck-icon__fill").forEach(e=>{e.style.fill=this.fillColor})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Zu extends j{constructor(e){super(e);this.set("text",""),this.set("position","s");const t=this.bindTemplate;this.setTemplate({tag:"span",attributes:{class:["ck","ck-tooltip",t.to("position",n=>"ck-tooltip_"+n),t.if("text","ck-hidden",n=>!n.trim())]},children:[{tag:"span",attributes:{class:["ck","ck-tooltip__text"]},children:[{text:t.to("text")}]}]})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class le extends j{constructor(e){super(e);const t=this.bindTemplate,n=rt();this.set("class"),this.set("labelStyle"),this.set("icon"),this.set("isEnabled",!0),this.set("isOn",!1),this.set("isVisible",!0),this.set("isToggleable",!1),this.set("keystroke"),this.set("label"),this.set("tabindex",-1),this.set("tooltip"),this.set("tooltipPosition","s"),this.set("type","button"),this.set("withText",!1),this.set("withKeystroke",!1),this.children=this.createCollection(),this.tooltipView=this._createTooltipView(),this.labelView=this._createLabelView(n),this.iconView=new is,this.iconView.extendTemplate({attributes:{class:"ck-button__icon"}}),this.keystrokeView=this._createKeystrokeView(),this.bind("_tooltipString").to(this,"tooltip",this,"label",this,"keystroke",this._getTooltipString.bind(this)),this.setTemplate({tag:"button",attributes:{class:["ck","ck-button",t.to("class"),t.if("isEnabled","ck-disabled",s=>!s),t.if("isVisible","ck-hidden",s=>!s),t.to("isOn",s=>s?"ck-on":"ck-off"),t.if("withText","ck-button_with-text"),t.if("withKeystroke","ck-button_with-keystroke")],type:t.to("type",s=>s||"button"),tabindex:t.to("tabindex"),"aria-labelledby":`ck-editor__aria-label_${n}`,"aria-disabled":t.if("isEnabled",!0,s=>!s),"aria-pressed":t.to("isOn",s=>this.isToggleable?String(s):!1)},children:this.children,on:{mousedown:t.to(s=>{s.preventDefault()}),click:t.to(s=>{this.isEnabled?this.fire("execute"):s.preventDefault()})}})}render(){super.render(),this.icon&&(this.iconView.bind("content").to(this,"icon"),this.children.add(this.iconView)),this.children.add(this.tooltipView),this.children.add(this.labelView),this.withKeystroke&&this.keystroke&&this.children.add(this.keystrokeView)}focus(){this.element.focus()}_createTooltipView(){const e=new Zu;return e.bind("text").to(this,"_tooltipString"),e.bind("position").to(this,"tooltipPosition"),e}_createLabelView(e){const t=new j,n=this.bindTemplate;return t.setTemplate({tag:"span",attributes:{class:["ck","ck-button__label"],style:n.to("labelStyle"),id:`ck-editor__aria-label_${e}`},children:[{text:this.bindTemplate.to("label")}]}),t}_createKeystrokeView(){const e=new j;return e.setTemplate({tag:"span",attributes:{class:["ck","ck-button__keystroke"]},children:[{text:this.bindTemplate.to("keystroke",t=>cc(t))}]}),e}_getTooltipString(e,t,n){return e?typeof e=="string"?e:(n&&(n=cc(n)),e instanceof Function?e(t,n):`${t}${n?` (${n})`:""}`):""}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Jo extends le{constructor(e){super(e);this.isToggleable=!0,this.toggleSwitchView=this._createToggleView(),this.extendTemplate({attributes:{class:"ck-switchbutton"}})}render(){super.render(),this.children.add(this.toggleSwitchView)}_createToggleView(){const e=new j;return e.setTemplate({tag:"span",attributes:{class:["ck","ck-button__toggle"]},children:[{tag:"span",attributes:{class:["ck","ck-button__toggle__inner"]}}]}),e}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Sn{constructor(e){if(Object.assign(this,e),e.actions&&e.keystrokeHandler)for(const t in e.actions){let n=e.actions[t];typeof n=="string"&&(n=[n]);for(const s of n)e.keystrokeHandler.set(s,(o,r)=>{this[t](),r()})}}get first(){return this.focusables.find(Qo)||null}get last(){return this.focusables.filter(Qo).slice(-1)[0]||null}get next(){return this._getFocusableItem(1)}get previous(){return this._getFocusableItem(-1)}get current(){let e=null;return this.focusTracker.focusedElement===null?null:(this.focusables.find((t,n)=>{const s=t.element===this.focusTracker.focusedElement;return s&&(e=n),s}),e)}focusFirst(){this._focus(this.first)}focusLast(){this._focus(this.last)}focusNext(){this._focus(this.next)}focusPrevious(){this._focus(this.previous)}_focus(e){e&&e.focus()}_getFocusableItem(e){const t=this.current,n=this.focusables.length;if(!n)return null;if(t===null)return this[e===1?"first":"last"];let s=(t+n+e)%n;do{const o=this.focusables.get(s);if(Qo(o))return o;s=(s+n+e)%n}while(s!==t);return null}}function Qo(i){return!!(i.focus&&_e.window.getComputedStyle(i.element).display!="none")}var ed='<svg viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M.941 4.523a.75.75 0 1 1 1.06-1.06l3.006 3.005 3.005-3.005a.75.75 0 1 1 1.06 1.06l-3.549 3.55a.75.75 0 0 1-1.168-.136L.941 4.523z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Yo extends le{constructor(e){super(e);this.arrowView=this._createArrowView(),this.extendTemplate({attributes:{"aria-haspopup":!0}}),this.delegate("execute").to(this,"open")}render(){super.render(),this.children.add(this.arrowView)}_createArrowView(){const e=new is;return e.content=ed,e.extendTemplate({attributes:{class:"ck-dropdown__arrow"}}),e}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class td extends j{constructor(e){super(e);const t=this.bindTemplate;this.set("class"),this.set("icon"),this.set("isEnabled",!0),this.set("isOn",!1),this.set("isToggleable",!1),this.set("isVisible",!0),this.set("keystroke"),this.set("label"),this.set("tabindex",-1),this.set("tooltip"),this.set("tooltipPosition","s"),this.set("type","button"),this.set("withText",!1),this.children=this.createCollection(),this.actionView=this._createActionView(),this.arrowView=this._createArrowView(),this.keystrokes=new At,this.focusTracker=new Je,this.setTemplate({tag:"div",attributes:{class:["ck","ck-splitbutton",t.to("class"),t.if("isVisible","ck-hidden",n=>!n),this.arrowView.bindTemplate.if("isOn","ck-splitbutton_open")]},children:this.children})}render(){super.render(),this.children.add(this.actionView),this.children.add(this.arrowView),this.focusTracker.add(this.actionView.element),this.focusTracker.add(this.arrowView.element),this.keystrokes.listenTo(this.element),this.keystrokes.set("arrowright",(e,t)=>{this.focusTracker.focusedElement===this.actionView.element&&(this.arrowView.focus(),t())}),this.keystrokes.set("arrowleft",(e,t)=>{this.focusTracker.focusedElement===this.arrowView.element&&(this.actionView.focus(),t())})}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this.actionView.focus()}_createActionView(){const e=new le;return e.bind("icon","isEnabled","isOn","isToggleable","keystroke","label","tabindex","tooltip","tooltipPosition","type","withText").to(this),e.extendTemplate({attributes:{class:"ck-splitbutton__action"}}),e.delegate("execute").to(this),e}_createArrowView(){const e=new le,t=e.bindTemplate;return e.icon=ed,e.extendTemplate({attributes:{class:"ck-splitbutton__arrow","aria-haspopup":!0,"aria-expanded":t.to("isOn",n=>String(n))}}),e.bind("isEnabled").to(this),e.delegate("execute").to(this,"open"),e}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Fk extends j{constructor(e){super(e);const t=this.bindTemplate;this.set("isVisible",!1),this.set("position","se"),this.children=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-dropdown__panel",t.to("position",n=>`ck-dropdown__panel_${n}`),t.if("isVisible","ck-dropdown__panel-visible")]},children:this.children,on:{selectstart:t.to(n=>n.preventDefault())}})}focus(){this.children.length&&this.children.first.focus()}focusLast(){if(this.children.length){const e=this.children.last;typeof e.focusLast=="function"?e.focusLast():e.focus()}}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Lk(i){return!i||!i.parentNode||i.offsetParent===_e.document.body?null:i.offsetParent}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function nd({element:i,target:e,positions:t,limiter:n,fitInViewport:s,viewportOffsetConfig:o}){Yn(e)&&(e=e()),Yn(n)&&(n=n());const r=Lk(i),a=new te(i),l=new te(e);let c;const u={targetRect:l,elementRect:a,positionedElementAncestor:r};if(!n&&!s)c=new Xo(t[0],u);else{const d=n&&new te(n).getVisible(),f=s&&zk(o);Object.assign(u,{limiterRect:d,viewportRect:f}),c=$k(t,u)||new Xo(t[0],u)}return c}function zk(i){i=Object.assign({top:0,bottom:0,left:0,right:0},i);const e=new te(_e.window);return e.top+=i.top,e.height-=i.top,e.bottom-=i.bottom,e.height-=i.bottom,e}function $k(i,e){const{elementRect:t}=e,n=t.getArea(),s=i.map(a=>new Xo(a,e)).filter(a=>!!a.name);let o=0,r=null;for(const a of s){const{_limiterIntersectionArea:l,_viewportIntersectionArea:c}=a;if(l===n)return a;const u=c**2+l**2;u>o&&(o=u,r=a)}return r}function Hk(i,e){const t=id(new te(e)),n=Oc(e);let s=0,o=0;s-=t.left,o-=t.top,s+=e.scrollLeft,o+=e.scrollTop,s-=n.left,o-=n.top,i.moveBy(s,o)}function id(i){const{scrollX:e,scrollY:t}=_e.window;return i.clone().moveBy(e,t)}class Xo{constructor(e,t){const n=e(t.targetRect,t.elementRect,t.viewportRect);if(!n)return;const{left:s,top:o,name:r,config:a}=n;Object.assign(this,{name:r,config:a}),this._positioningFunctionCorrdinates={left:s,top:o},this._options=t}get left(){return this._absoluteRect.left}get top(){return this._absoluteRect.top}get _limiterIntersectionArea(){const e=this._options.limiterRect;if(e){const t=this._options.viewportRect;if(t){const n=e.getIntersection(t);if(n)return n.getIntersectionArea(this._rect)}else return e.getIntersectionArea(this._rect)}return 0}get _viewportIntersectionArea(){const e=this._options.viewportRect;return e?e.getIntersectionArea(this._rect):0}get _rect(){return this._cachedRect?this._cachedRect:(this._cachedRect=this._options.elementRect.clone().moveTo(this._positioningFunctionCorrdinates.left,this._positioningFunctionCorrdinates.top),this._cachedRect)}get _absoluteRect(){return this._cachedAbsoluteRect?this._cachedAbsoluteRect:(this._cachedAbsoluteRect=id(this._rect),this._options.positionedElementAncestor&&Hk(this._cachedAbsoluteRect,this._options.positionedElementAncestor),this._cachedAbsoluteRect)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class xn extends j{constructor(e,t,n){super(e);const s=this.bindTemplate;this.buttonView=t,this.panelView=n,this.set("isOpen",!1),this.set("isEnabled",!0),this.set("class"),this.set("id"),this.set("panelPosition","auto"),this.keystrokes=new At,this.setTemplate({tag:"div",attributes:{class:["ck","ck-dropdown",s.to("class"),s.if("isEnabled","ck-disabled",o=>!o)],id:s.to("id"),"aria-describedby":s.to("ariaDescribedById")},children:[t,n]}),t.extendTemplate({attributes:{class:["ck-dropdown__button"]}})}render(){super.render(),this.listenTo(this.buttonView,"open",()=>{this.isOpen=!this.isOpen}),this.panelView.bind("isVisible").to(this,"isOpen"),this.on("change:isOpen",()=>{!this.isOpen||(this.panelPosition==="auto"?this.panelView.position=xn._getOptimalPosition({element:this.panelView.element,target:this.buttonView.element,fitInViewport:!0,positions:this._panelPositions}).name:this.panelView.position=this.panelPosition)}),this.keystrokes.listenTo(this.element);const e=(t,n)=>{this.isOpen&&(this.buttonView.focus(),this.isOpen=!1,n())};this.keystrokes.set("arrowdown",(t,n)=>{this.buttonView.isEnabled&&!this.isOpen&&(this.isOpen=!0,n())}),this.keystrokes.set("arrowright",(t,n)=>{this.isOpen&&n()}),this.keystrokes.set("arrowleft",e),this.keystrokes.set("esc",e)}focus(){this.buttonView.focus()}get _panelPositions(){const{south:e,north:t,southEast:n,southWest:s,northEast:o,northWest:r,southMiddleEast:a,southMiddleWest:l,northMiddleEast:c,northMiddleWest:u}=xn.defaultPanelPositions;return this.locale.uiLanguageDirection!=="rtl"?[n,s,a,l,e,o,r,c,u,t]:[s,n,l,a,e,r,o,u,c,t]}}xn.defaultPanelPositions={south:(i,e)=>({top:i.bottom,left:i.left-(e.width-i.width)/2,name:"s"}),southEast:i=>({top:i.bottom,left:i.left,name:"se"}),southWest:(i,e)=>({top:i.bottom,left:i.left-e.width+i.width,name:"sw"}),southMiddleEast:(i,e)=>({top:i.bottom,left:i.left-(e.width-i.width)/4,name:"sme"}),southMiddleWest:(i,e)=>({top:i.bottom,left:i.left-(e.width-i.width)*3/4,name:"smw"}),north:(i,e)=>({top:i.top-e.height,left:i.left-(e.width-i.width)/2,name:"n"}),northEast:(i,e)=>({top:i.top-e.height,left:i.left,name:"ne"}),northWest:(i,e)=>({top:i.top-e.height,left:i.left-e.width+i.width,name:"nw"}),northMiddleEast:(i,e)=>({top:i.top-e.height,left:i.left-(e.width-i.width)/4,name:"nme"}),northMiddleWest:(i,e)=>({top:i.top-e.height,left:i.left-(e.width-i.width)*3/4,name:"nmw"})};xn._getOptimalPosition=nd;/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class sd extends j{constructor(e){super(e);this.setTemplate({tag:"span",attributes:{class:["ck","ck-toolbar__separator"]}})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Uk extends j{constructor(e){super(e);this.setTemplate({tag:"span",attributes:{class:["ck","ck-toolbar__line-break"]}})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Wk(i){return i.bindTemplate.to(e=>{e.target===i.element&&e.preventDefault()})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function qk(i){return Array.isArray(i)?{items:i,removeItems:[]}:i?Object.assign({items:[],removeItems:[]},i):{items:[],removeItems:[]}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Zo extends j{constructor(e,t){super(e);const n=this.bindTemplate,s=this.t;this.options=t||{},this.set("ariaLabel",s("Editor toolbar")),this.set("maxWidth","auto"),this.items=this.createCollection(),this.focusTracker=new Je,this.keystrokes=new At,this.set("class"),this.set("isCompact",!1),this.itemsView=new jk(e),this.children=this.createCollection(),this.children.add(this.itemsView),this.focusables=this.createCollection();const o=e.uiLanguageDirection==="rtl";this._focusCycler=new Sn({focusables:this.focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:[o?"arrowright":"arrowleft","arrowup"],focusNext:[o?"arrowleft":"arrowright","arrowdown"]}});const r=["ck","ck-toolbar",n.to("class"),n.if("isCompact","ck-toolbar_compact")];this.options.shouldGroupWhenFull&&this.options.isFloating&&r.push("ck-toolbar_floating"),this.setTemplate({tag:"div",attributes:{class:r,role:"toolbar","aria-label":n.to("ariaLabel"),style:{maxWidth:n.to("maxWidth")}},children:this.children,on:{mousedown:Wk(this)}}),this._behavior=this.options.shouldGroupWhenFull?new Gk(this):new Kk(this)}render(){super.render();for(const e of this.items)this.focusTracker.add(e.element);this.items.on("add",(e,t)=>{this.focusTracker.add(t.element)}),this.items.on("remove",(e,t)=>{this.focusTracker.remove(t.element)}),this.keystrokes.listenTo(this.element),this._behavior.render(this)}destroy(){return this._behavior.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy(),super.destroy()}focus(){this._focusCycler.focusFirst()}focusLast(){this._focusCycler.focusLast()}fillFromConfig(e,t){const n=qk(e),s=n.items.filter((r,a,l)=>r==="|"?!0:n.removeItems.indexOf(r)!==-1?!1:r==="-"?this.options.shouldGroupWhenFull?(Re("toolbarview-line-break-ignored-when-grouping-items",l),!1):!0:t.has(r)?!0:(Re("toolbarview-item-unavailable",{name:r}),!1)),o=this._cleanSeparators(s).map(r=>r==="|"?new sd:r==="-"?new Uk:t.create(r));this.items.addMany(o)}_cleanSeparators(e){const t=r=>r!=="-"&&r!=="|",n=e.length,s=e.findIndex(t),o=n-e.slice().reverse().findIndex(t);return e.slice(s,o).filter((r,a,l)=>t(r)?!0:!(a>0&&l[a-1]===r))}}class jk extends j{constructor(e){super(e);this.children=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-toolbar__items"]},children:this.children})}}class Kk{constructor(e){const t=e.bindTemplate;e.set("isVertical",!1),e.itemsView.children.bindTo(e.items).using(n=>n),e.focusables.bindTo(e.items).using(n=>n),e.extendTemplate({attributes:{class:[t.if("isVertical","ck-toolbar_vertical")]}})}render(){}destroy(){}}class Gk{constructor(e){this.view=e,this.viewChildren=e.children,this.viewFocusables=e.focusables,this.viewItemsView=e.itemsView,this.viewFocusTracker=e.focusTracker,this.viewLocale=e.locale,this.ungroupedItems=e.createCollection(),this.groupedItems=e.createCollection(),this.groupedItemsDropdown=this._createGroupedItemsDropdown(),this.resizeObserver=null,this.cachedPadding=null,this.shouldUpdateGroupingOnNextResize=!1,e.itemsView.children.bindTo(this.ungroupedItems).using(t=>t),this.ungroupedItems.on("add",this._updateFocusCycleableItems.bind(this)),this.ungroupedItems.on("remove",this._updateFocusCycleableItems.bind(this)),e.children.on("add",this._updateFocusCycleableItems.bind(this)),e.children.on("remove",this._updateFocusCycleableItems.bind(this)),e.items.on("change",(t,n)=>{const s=n.index;for(const o of n.removed)s>=this.ungroupedItems.length?this.groupedItems.remove(o):this.ungroupedItems.remove(o);for(let o=s;o<s+n.added.length;o++){const r=n.added[o-s];o>this.ungroupedItems.length?this.groupedItems.add(r,o-this.ungroupedItems.length):this.ungroupedItems.add(r,o)}this._updateGrouping()}),e.extendTemplate({attributes:{class:["ck-toolbar_grouping"]}})}render(e){this.viewElement=e.element,this._enableGroupingOnResize(),this._enableGroupingOnMaxWidthChange(e)}destroy(){this.groupedItemsDropdown.destroy(),this.resizeObserver.destroy()}_updateGrouping(){if(!this.viewElement.ownerDocument.body.contains(this.viewElement))return;if(!this.viewElement.offsetParent){this.shouldUpdateGroupingOnNextResize=!0;return}const e=this.groupedItems.length;let t;for(;this._areItemsOverflowing;)this._groupLastItem(),t=!0;if(!t&&this.groupedItems.length){for(;this.groupedItems.length&&!this._areItemsOverflowing;)this._ungroupFirstItem();this._areItemsOverflowing&&this._groupLastItem()}this.groupedItems.length!==e&&this.view.fire("groupedItemsUpdate")}get _areItemsOverflowing(){if(!this.ungroupedItems.length)return!1;const e=this.viewElement,t=this.viewLocale.uiLanguageDirection,n=new te(e.lastChild),s=new te(e);if(!this.cachedPadding){const o=_e.window.getComputedStyle(e),r=t==="ltr"?"paddingRight":"paddingLeft";this.cachedPadding=Number.parseInt(o[r])}return t==="ltr"?n.right>s.right-this.cachedPadding:n.left<s.left+this.cachedPadding}_enableGroupingOnResize(){let e;this.resizeObserver=new pe(this.viewElement,t=>{(!e||e!==t.contentRect.width||this.shouldUpdateGroupingOnNextResize)&&(this.shouldUpdateGroupingOnNextResize=!1,this._updateGrouping(),e=t.contentRect.width)}),this._updateGrouping()}_enableGroupingOnMaxWidthChange(e){e.on("change:maxWidth",()=>{this._updateGrouping()})}_groupLastItem(){this.groupedItems.length||(this.viewChildren.add(new sd),this.viewChildren.add(this.groupedItemsDropdown),this.viewFocusTracker.add(this.groupedItemsDropdown.element)),this.groupedItems.add(this.ungroupedItems.remove(this.ungroupedItems.last),0)}_ungroupFirstItem(){this.ungroupedItems.add(this.groupedItems.remove(this.groupedItems.first)),this.groupedItems.length||(this.viewChildren.remove(this.groupedItemsDropdown),this.viewChildren.remove(this.viewChildren.last),this.viewFocusTracker.remove(this.groupedItemsDropdown.element))}_createGroupedItemsDropdown(){const e=this.viewLocale,t=e.t,n=Lt(e);return n.class="ck-toolbar__grouped-dropdown",n.panelPosition=e.uiLanguageDirection==="ltr"?"sw":"se",od(n,[]),n.buttonView.set({label:t("Show more items"),tooltip:!0,tooltipPosition:e.uiLanguageDirection==="rtl"?"se":"sw",icon:Hu}),n.toolbarView.items.bindTo(this.groupedItems).using(s=>s),n}_updateFocusCycleableItems(){this.viewFocusables.clear(),this.ungroupedItems.map(e=>{this.viewFocusables.add(e)}),this.groupedItems.length&&this.viewFocusables.add(this.groupedItemsDropdown)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Jk extends j{constructor(){super();this.items=this.createCollection(),this.focusTracker=new Je,this.keystrokes=new At,this._focusCycler=new Sn({focusables:this.items,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"arrowup",focusNext:"arrowdown"}}),this.setTemplate({tag:"ul",attributes:{class:["ck","ck-reset","ck-list"]},children:this.items})}render(){super.render();for(const e of this.items)this.focusTracker.add(e.element);this.items.on("add",(e,t)=>{this.focusTracker.add(t.element)}),this.items.on("remove",(e,t)=>{this.focusTracker.remove(t.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}focusLast(){this._focusCycler.focusLast()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Qk extends j{constructor(e){super(e);this.children=this.createCollection(),this.setTemplate({tag:"li",attributes:{class:["ck","ck-list__item"]},children:this.children})}focus(){this.children.first.focus()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Yk extends j{constructor(e){super(e);this.setTemplate({tag:"li",attributes:{class:["ck","ck-list__separator"]}})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Lt(i,e=Yo){const t=new e(i),n=new Fk(i),s=new xn(i,t,n);return t.bind("isEnabled").to(s),t instanceof Yo?t.bind("isOn").to(s,"isOpen"):t.arrowView.bind("isOn").to(s,"isOpen"),Xk(s),s}function od(i,e){const t=i.locale,n=t.t,s=i.toolbarView=new Zo(t);s.set("ariaLabel",n("Dropdown toolbar")),i.extendTemplate({attributes:{class:["ck-toolbar-dropdown"]}}),e.map(o=>s.items.add(o)),i.panelView.children.add(s),s.items.delegate("execute").to(i)}function er(i,e){const t=i.locale,n=i.listView=new Jk(t);n.items.bindTo(e).using(({type:s,model:o})=>{if(s==="separator")return new Yk(t);if(s==="button"||s==="switchbutton"){const r=new Qk(t);let a;return s==="button"?a=new le(t):a=new Jo(t),a.bind(...Object.keys(o)).to(o),a.delegate("execute").to(r),r.children.add(a),r}}),i.panelView.children.add(n),n.items.delegate("execute").to(i)}function Xk(i){Zk(i),eT(i),tT(i)}function Zk(i){i.on("render",()=>{Wo({emitter:i,activator:()=>i.isOpen,callback:()=>{i.isOpen=!1},contextElements:[i.element]})})}function eT(i){i.on("execute",e=>{e.source instanceof Jo||(i.isOpen=!1)})}function tT(i){i.keystrokes.set("arrowdown",(e,t)=>{i.isOpen&&(i.panelView.focus(),t())}),i.keystrokes.set("arrowup",(e,t)=>{i.isOpen&&(i.panelView.focusLast(),t())})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class nT extends j{constructor(e){super(e);this.body=new Bk(e)}render(){super.render(),this.body.attachToDom()}destroy(){return this.body.detachFromDom(),super.destroy()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class iT extends j{constructor(e){super(e);this.set("text"),this.set("for"),this.id=`ck-editor__label_${rt()}`;const t=this.bindTemplate;this.setTemplate({tag:"label",attributes:{class:["ck","ck-label"],id:this.id,for:t.to("for")},children:[{text:t.to("text")}]})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class sT extends j{constructor(e,t,n){super(e);this.setTemplate({tag:"div",attributes:{class:["ck","ck-content","ck-editor__editable","ck-rounded-corners"],lang:e.contentLanguage,dir:e.contentLanguageDirection}}),this.name=null,this.set("isFocused",!1),this._editableElement=n,this._hasExternalElement=!!this._editableElement,this._editingView=t}render(){super.render(),this._hasExternalElement?this.template.apply(this.element=this._editableElement):this._editableElement=this.element,this.on("change:isFocused",()=>this._updateIsFocusedClasses()),this._updateIsFocusedClasses()}destroy(){this._hasExternalElement&&this.template.revert(this._editableElement),super.destroy()}_updateIsFocusedClasses(){const e=this._editingView;e.isRenderingInProgress?n(this):t(this);function t(s){e.change(o=>{const r=e.document.getRoot(s.name);o.addClass(s.isFocused?"ck-focused":"ck-blurred",r),o.removeClass(s.isFocused?"ck-blurred":"ck-focused",r)})}function n(s){e.once("change:isRenderingInProgress",(o,r,a)=>{a?n(s):t(s)})}}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class oT extends sT{constructor(e,t,n){super(e,t,n);this.extendTemplate({attributes:{role:"textbox",class:"ck-editor__editable_inline"}})}render(){super.render();const e=this._editingView,t=this.t;e.change(n=>{const s=e.document.getRoot(this.name);n.setAttribute("aria-label",t("Rich Text Editor, %0",this.name),s)})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class rT extends j{constructor(e){super(e);this.set("value"),this.set("id"),this.set("placeholder"),this.set("isReadOnly",!1),this.set("hasError",!1),this.set("ariaDescribedById"),this.focusTracker=new Je,this.bind("isFocused").to(this.focusTracker),this.set("isEmpty",!0);const t=this.bindTemplate;this.setTemplate({tag:"input",attributes:{type:"text",class:["ck","ck-input","ck-input-text",t.if("isFocused","ck-input_focused"),t.if("isEmpty","ck-input-text_empty"),t.if("hasError","ck-error")],id:t.to("id"),placeholder:t.to("placeholder"),readonly:t.to("isReadOnly"),"aria-invalid":t.if("hasError",!0),"aria-describedby":t.to("ariaDescribedById")},on:{input:t.to((...n)=>{this.fire("input",...n),this._updateIsEmpty()}),change:t.to(this._updateIsEmpty.bind(this))}})}render(){super.render(),this.focusTracker.add(this.element),this._setDomElementValue(this.value),this._updateIsEmpty(),this.on("change:value",(e,t,n)=>{this._setDomElementValue(n),this._updateIsEmpty()})}destroy(){super.destroy(),this.focusTracker.destroy()}select(){this.element.select()}focus(){this.element.focus()}_updateIsEmpty(){this.isEmpty=aT(this.element)}_setDomElementValue(e){this.element.value=!e&&e!==0?"":e}}function aT(i){return!i.value}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class tr extends j{constructor(e,t){super(e);const n=`ck-labeled-field-view-${rt()}`,s=`ck-labeled-field-view-status-${rt()}`;this.fieldView=t(this,n,s),this.set("label"),this.set("isEnabled",!0),this.set("isEmpty",!0),this.set("isFocused",!1),this.set("errorText",null),this.set("infoText",null),this.set("class"),this.set("placeholder"),this.labelView=this._createLabelView(n),this.statusView=this._createStatusView(s),this.bind("_statusText").to(this,"errorText",this,"infoText",(r,a)=>r||a);const o=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck","ck-labeled-field-view",o.to("class"),o.if("isEnabled","ck-disabled",r=>!r),o.if("isEmpty","ck-labeled-field-view_empty"),o.if("isFocused","ck-labeled-field-view_focused"),o.if("placeholder","ck-labeled-field-view_placeholder"),o.if("errorText","ck-error")]},children:[{tag:"div",attributes:{class:["ck","ck-labeled-field-view__input-wrapper"]},children:[this.fieldView,this.labelView]},this.statusView]})}_createLabelView(e){const t=new iT(this.locale);return t.for=e,t.bind("text").to(this,"label"),t}_createStatusView(e){const t=new j(this.locale),n=this.bindTemplate;return t.setTemplate({tag:"div",attributes:{class:["ck","ck-labeled-field-view__status",n.if("errorText","ck-labeled-field-view__status_error"),n.if("_statusText","ck-hidden",s=>!s)],id:e,role:n.if("errorText","alert")},children:[{text:n.to("_statusText")}]}),t}focus(){this.fieldView.focus()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function nr(i,e,t){const n=new rT(i.locale);return n.set({id:e,ariaDescribedById:t}),n.bind("isReadOnly").to(i,"isEnabled",s=>!s),n.bind("hasError").to(i,"errorText",s=>!!s),n.on("input",()=>{i.errorText=null}),i.bind("isEmpty","isFocused","placeholder").to(n),n}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ir extends oi{static get pluginName(){return"Notification"}init(){this.on("show:warning",(e,t)=>{window.alert(t.message)},{priority:"lowest"})}showSuccess(e,t={}){this._showNotification({message:e,type:"success",namespace:t.namespace,title:t.title})}showInfo(e,t={}){this._showNotification({message:e,type:"info",namespace:t.namespace,title:t.title})}showWarning(e,t={}){this._showNotification({message:e,type:"warning",namespace:t.namespace,title:t.title})}_showNotification(e){const t=`show:${e.type}`+(e.namespace?`:${e.namespace}`:"");this.fire(t,{message:e.message,type:e.type,title:e.title||""})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ss{constructor(e,t){t&&ti(this,t),e&&this.set(e)}}F(ss,re);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md.
 */const rd=Lc("px"),ad=_e.document.body;class Le extends j{constructor(e){super(e);const t=this.bindTemplate;this.set("top",0),this.set("left",0),this.set("position","arrow_nw"),this.set("isVisible",!1),this.set("withArrow",!0),this.set("class"),this.content=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-balloon-panel",t.to("position",n=>`ck-balloon-panel_${n}`),t.if("isVisible","ck-balloon-panel_visible"),t.if("withArrow","ck-balloon-panel_with-arrow"),t.to("class")],style:{top:t.to("top",rd),left:t.to("left",rd)}},children:this.content})}show(){this.isVisible=!0}hide(){this.isVisible=!1}attachTo(e){this.show();const t=Le.defaultPositions,n=Object.assign({},{element:this.element,positions:[t.southArrowNorth,t.southArrowNorthMiddleWest,t.southArrowNorthMiddleEast,t.southArrowNorthWest,t.southArrowNorthEast,t.northArrowSouth,t.northArrowSouthMiddleWest,t.northArrowSouthMiddleEast,t.northArrowSouthWest,t.northArrowSouthEast,t.viewportStickyNorth],limiter:ad,fitInViewport:!0},e),s=Le._getOptimalPosition(n),o=parseInt(s.left),r=parseInt(s.top),{name:a,config:l={}}=s,{withArrow:c=!0}=l;Object.assign(this,{top:r,left:o,position:a,withArrow:c})}pin(e){this.unpin(),this._pinWhenIsVisibleCallback=()=>{this.isVisible?this._startPinning(e):this._stopPinning()},this._startPinning(e),this.listenTo(this,"change:isVisible",this._pinWhenIsVisibleCallback)}unpin(){this._pinWhenIsVisibleCallback&&(this._stopPinning(),this.stopListening(this,"change:isVisible",this._pinWhenIsVisibleCallback),this._pinWhenIsVisibleCallback=null,this.hide())}_startPinning(e){this.attachTo(e);const t=sr(e.target),n=e.limiter?sr(e.limiter):ad;this.listenTo(_e.document,"scroll",(s,o)=>{const r=o.target,a=t&&r.contains(t),l=n&&r.contains(n);(a||l||!t||!n)&&this.attachTo(e)},{useCapture:!0}),this.listenTo(_e.window,"resize",()=>{this.attachTo(e)})}_stopPinning(){this.stopListening(_e.document,"scroll"),this.stopListening(_e.window,"resize")}}function sr(i){return Yt(i)?i:Ki(i)?i.commonAncestorContainer:typeof i=="function"?sr(i()):null}Le.arrowHorizontalOffset=25;Le.arrowVerticalOffset=10;Le.stickyVerticalOffset=20;Le._getOptimalPosition=nd;Le.defaultPositions=lT();function lT({horizontalOffset:i=Le.arrowHorizontalOffset,verticalOffset:e=Le.arrowVerticalOffset,stickyVerticalOffset:t=Le.stickyVerticalOffset,config:n}={}){return{northWestArrowSouthWest:(r,a)=>$({top:s(r,a),left:r.left-i,name:"arrow_sw"},n&&{config:n}),northWestArrowSouthMiddleWest:(r,a)=>$({top:s(r,a),left:r.left-a.width*.25-i,name:"arrow_smw"},n&&{config:n}),northWestArrowSouth:(r,a)=>$({top:s(r,a),left:r.left-a.width/2,name:"arrow_s"},n&&{config:n}),northWestArrowSouthMiddleEast:(r,a)=>$({top:s(r,a),left:r.left-a.width*.75+i,name:"arrow_sme"},n&&{config:n}),northWestArrowSouthEast:(r,a)=>$({top:s(r,a),left:r.left-a.width+i,name:"arrow_se"},n&&{config:n}),northArrowSouthWest:(r,a)=>$({top:s(r,a),left:r.left+r.width/2-i,name:"arrow_sw"},n&&{config:n}),northArrowSouthMiddleWest:(r,a)=>$({top:s(r,a),left:r.left+r.width/2-a.width*.25-i,name:"arrow_smw"},n&&{config:n}),northArrowSouth:(r,a)=>$({top:s(r,a),left:r.left+r.width/2-a.width/2,name:"arrow_s"},n&&{config:n}),northArrowSouthMiddleEast:(r,a)=>$({top:s(r,a),left:r.left+r.width/2-a.width*.75+i,name:"arrow_sme"},n&&{config:n}),northArrowSouthEast:(r,a)=>$({top:s(r,a),left:r.left+r.width/2-a.width+i,name:"arrow_se"},n&&{config:n}),northEastArrowSouthWest:(r,a)=>$({top:s(r,a),left:r.right-i,name:"arrow_sw"},n&&{config:n}),northEastArrowSouthMiddleWest:(r,a)=>$({top:s(r,a),left:r.right-a.width*.25-i,name:"arrow_smw"},n&&{config:n}),northEastArrowSouth:(r,a)=>$({top:s(r,a),left:r.right-a.width/2,name:"arrow_s"},n&&{config:n}),northEastArrowSouthMiddleEast:(r,a)=>$({top:s(r,a),left:r.right-a.width*.75+i,name:"arrow_sme"},n&&{config:n}),northEastArrowSouthEast:(r,a)=>$({top:s(r,a),left:r.right-a.width+i,name:"arrow_se"},n&&{config:n}),southWestArrowNorthWest:(r,a)=>$({top:o(r),left:r.left-i,name:"arrow_nw"},n&&{config:n}),southWestArrowNorthMiddleWest:(r,a)=>$({top:o(r),left:r.left-a.width*.25-i,name:"arrow_nmw"},n&&{config:n}),southWestArrowNorth:(r,a)=>$({top:o(r),left:r.left-a.width/2,name:"arrow_n"},n&&{config:n}),southWestArrowNorthMiddleEast:(r,a)=>$({top:o(r),left:r.left-a.width*.75+i,name:"arrow_nme"},n&&{config:n}),southWestArrowNorthEast:(r,a)=>$({top:o(r),left:r.left-a.width+i,name:"arrow_ne"},n&&{config:n}),southArrowNorthWest:(r,a)=>$({top:o(r),left:r.left+r.width/2-i,name:"arrow_nw"},n&&{config:n}),southArrowNorthMiddleWest:(r,a)=>$({top:o(r),left:r.left+r.width/2-a.width*.25-i,name:"arrow_nmw"},n&&{config:n}),southArrowNorth:(r,a)=>$({top:o(r),left:r.left+r.width/2-a.width/2,name:"arrow_n"},n&&{config:n}),southArrowNorthMiddleEast:(r,a)=>$({top:o(r),left:r.left+r.width/2-a.width*.75+i,name:"arrow_nme"},n&&{config:n}),southArrowNorthEast:(r,a)=>$({top:o(r),left:r.left+r.width/2-a.width+i,name:"arrow_ne"},n&&{config:n}),southEastArrowNorthWest:(r,a)=>$({top:o(r),left:r.right-i,name:"arrow_nw"},n&&{config:n}),southEastArrowNorthMiddleWest:(r,a)=>$({top:o(r),left:r.right-a.width*.25-i,name:"arrow_nmw"},n&&{config:n}),southEastArrowNorth:(r,a)=>$({top:o(r),left:r.right-a.width/2,name:"arrow_n"},n&&{config:n}),southEastArrowNorthMiddleEast:(r,a)=>$({top:o(r),left:r.right-a.width*.75+i,name:"arrow_nme"},n&&{config:n}),southEastArrowNorthEast:(r,a)=>$({top:o(r),left:r.right-a.width+i,name:"arrow_ne"},n&&{config:n}),viewportStickyNorth:(r,a,l)=>r.getIntersection(l)?{top:l.top+t,left:r.left+r.width/2-a.width/2,name:"arrowless",config:$({withArrow:!1},n)}:null};function s(r,a){return r.top-a.height-e}function o(r){return r.bottom+e}}var cT='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M11.463 5.187a.888.888 0 1 1 1.254 1.255L9.16 10l3.557 3.557a.888.888 0 1 1-1.254 1.255L7.26 10.61a.888.888 0 0 1 .16-1.382l4.043-4.042z"/></svg>',uT='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M8.537 14.813a.888.888 0 1 1-1.254-1.255L10.84 10 7.283 6.442a.888.888 0 1 1 1.254-1.255L12.74 9.39a.888.888 0 0 1-.16 1.382l-4.043 4.042z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const os=Lc("px");class rs extends P{static get pluginName(){return"ContextualBalloon"}constructor(e){super(e);this.positionLimiter=()=>{const t=this.editor.editing.view,s=t.document.selection.editableElement;return s?t.domConverter.mapViewToDom(s.root):null},this.set("visibleView",null),this.view=new Le(e.locale),e.ui.view.body.add(this.view),e.ui.focusTracker.add(this.view.element),this._viewToStack=new Map,this._idToStack=new Map,this.set("_numberOfStacks",0),this.set("_singleViewMode",!1),this._rotatorView=this._createRotatorView(),this._fakePanelsView=this._createFakePanelsView()}destroy(){super.destroy(),this.view.destroy(),this._rotatorView.destroy(),this._fakePanelsView.destroy()}hasView(e){return Array.from(this._viewToStack.keys()).includes(e)}add(e){if(this.hasView(e.view))throw new p("contextualballoon-add-view-exist",[this,e]);const t=e.stackId||"main";if(!this._idToStack.has(t)){this._idToStack.set(t,new Map([[e.view,e]])),this._viewToStack.set(e.view,this._idToStack.get(t)),this._numberOfStacks=this._idToStack.size,(!this._visibleStack||e.singleViewMode)&&this.showStack(t);return}const n=this._idToStack.get(t);e.singleViewMode&&this.showStack(t),n.set(e.view,e),this._viewToStack.set(e.view,n),n===this._visibleStack&&this._showView(e)}remove(e){if(!this.hasView(e))throw new p("contextualballoon-remove-view-not-exist",[this,e]);const t=this._viewToStack.get(e);this._singleViewMode&&this.visibleView===e&&(this._singleViewMode=!1),this.visibleView===e&&(t.size===1?this._idToStack.size>1?this._showNextStack():(this.view.hide(),this.visibleView=null,this._rotatorView.hideView()):this._showView(Array.from(t.values())[t.size-2])),t.size===1?(this._idToStack.delete(this._getStackId(t)),this._numberOfStacks=this._idToStack.size):t.delete(e),this._viewToStack.delete(e)}updatePosition(e){e&&(this._visibleStack.get(this.visibleView).position=e),this.view.pin(this._getBalloonPosition()),this._fakePanelsView.updatePosition()}showStack(e){this.visibleStack=e;const t=this._idToStack.get(e);if(!t)throw new p("contextualballoon-showstack-stack-not-exist",this);this._visibleStack!==t&&this._showView(Array.from(t.values()).pop())}get _visibleStack(){return this._viewToStack.get(this.visibleView)}_getStackId(e){return Array.from(this._idToStack.entries()).find(n=>n[1]===e)[0]}_showNextStack(){const e=Array.from(this._idToStack.values());let t=e.indexOf(this._visibleStack)+1;e[t]||(t=0),this.showStack(this._getStackId(e[t]))}_showPrevStack(){const e=Array.from(this._idToStack.values());let t=e.indexOf(this._visibleStack)-1;e[t]||(t=e.length-1),this.showStack(this._getStackId(e[t]))}_createRotatorView(){const e=new dT(this.editor.locale),t=this.editor.locale.t;return this.view.content.add(e),e.bind("isNavigationVisible").to(this,"_numberOfStacks",this,"_singleViewMode",(n,s)=>!s&&n>1),e.on("change:isNavigationVisible",()=>this.updatePosition(),{priority:"low"}),e.bind("counter").to(this,"visibleView",this,"_numberOfStacks",(n,s)=>{if(s<2)return"";const o=Array.from(this._idToStack.values()).indexOf(this._visibleStack)+1;return t("%0 of %1",[o,s])}),e.buttonNextView.on("execute",()=>{e.focusTracker.isFocused&&this.editor.editing.view.focus(),this._showNextStack()}),e.buttonPrevView.on("execute",()=>{e.focusTracker.isFocused&&this.editor.editing.view.focus(),this._showPrevStack()}),e}_createFakePanelsView(){const e=new hT(this.editor.locale,this.view);return e.bind("numberOfPanels").to(this,"_numberOfStacks",this,"_singleViewMode",(t,n)=>!n&&t>=2?Math.min(t-1,2):0),e.listenTo(this.view,"change:top",()=>e.updatePosition()),e.listenTo(this.view,"change:left",()=>e.updatePosition()),this.editor.ui.view.body.add(e),e}_showView({view:e,balloonClassName:t="",withArrow:n=!0,singleViewMode:s=!1}){this.view.class=t,this.view.withArrow=n,this._rotatorView.showView(e),this.visibleView=e,this.view.pin(this._getBalloonPosition()),this._fakePanelsView.updatePosition(),s&&(this._singleViewMode=!0)}_getBalloonPosition(){let e=Array.from(this._visibleStack.values()).pop().position;return e&&(e.limiter||(e=Object.assign({},e,{limiter:this.positionLimiter})),e=Object.assign({},e,{viewportOffsetConfig:this.editor.ui.viewportOffset})),e}}class dT extends j{constructor(e){super(e);const t=e.t,n=this.bindTemplate;this.set("isNavigationVisible",!0),this.focusTracker=new Je,this.buttonPrevView=this._createButtonView(t("Previous"),cT),this.buttonNextView=this._createButtonView(t("Next"),uT),this.content=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-balloon-rotator"],"z-index":"-1"},children:[{tag:"div",attributes:{class:["ck-balloon-rotator__navigation",n.to("isNavigationVisible",s=>s?"":"ck-hidden")]},children:[this.buttonPrevView,{tag:"span",attributes:{class:["ck-balloon-rotator__counter"]},children:[{text:n.to("counter")}]},this.buttonNextView]},{tag:"div",attributes:{class:"ck-balloon-rotator__content"},children:this.content}]})}render(){super.render(),this.focusTracker.add(this.element)}destroy(){super.destroy(),this.focusTracker.destroy()}showView(e){this.hideView(),this.content.add(e)}hideView(){this.content.clear()}_createButtonView(e,t){const n=new le(this.locale);return n.set({label:e,icon:t,tooltip:!0}),n}}class hT extends j{constructor(e,t){super(e);const n=this.bindTemplate;this.set("top",0),this.set("left",0),this.set("height",0),this.set("width",0),this.set("numberOfPanels",0),this.content=this.createCollection(),this._balloonPanelView=t,this.setTemplate({tag:"div",attributes:{class:["ck-fake-panel",n.to("numberOfPanels",s=>s?"":"ck-hidden")],style:{top:n.to("top",os),left:n.to("left",os),width:n.to("width",os),height:n.to("height",os)}},children:this.content}),this.on("change:numberOfPanels",(s,o,r,a)=>{r>a?this._addPanels(r-a):this._removePanels(a-r),this.updatePosition()})}_addPanels(e){for(;e--;){const t=new j;t.setTemplate({tag:"div"}),this.content.add(t),this.registerChild(t)}}_removePanels(e){for(;e--;){const t=this.content.last;this.content.remove(t),this.deregisterChild(t),t.destroy()}}updatePosition(){if(this.numberOfPanels){const{top:e,left:t}=this._balloonPanelView,{width:n,height:s}=new te(this._balloonPanelView.element);Object.assign(this,{top:e,left:t,width:n,height:s})}}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function fT({origin:i,originKeystrokeHandler:e,originFocusTracker:t,toolbar:n,beforeFocus:s,afterBlur:o}){t.add(n.element),e.set("Alt+F10",(r,a)=>{t.isFocused&&!n.focusTracker.isFocused&&(s&&s(),n.focus(),a())}),n.keystrokes.set("Esc",(r,a)=>{n.focusTracker.isFocused&&(i.focus(),o&&o(),a())})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const as=new WeakMap;function ld(i){const{view:e,element:t,text:n,isDirectHost:s=!0,keepOnFocus:o=!1}=i,r=e.document;as.has(r)||(as.set(r,new Map),r.registerPostFixer(a=>cd(r,a))),as.get(r).set(t,{text:n,isDirectHost:s,keepOnFocus:o,hostElement:s?t:null}),e.change(a=>cd(r,a))}function mT(i,e){return e.hasClass("ck-placeholder")?!1:(i.addClass("ck-placeholder",e),!0)}function gT(i,e){return e.hasClass("ck-placeholder")?(i.removeClass("ck-placeholder",e),!0):!1}function pT(i,e){if(!i.isAttached()||Array.from(i.getChildren()).some(r=>!r.is("uiElement")))return!1;if(e)return!0;const n=i.document;if(!n.isFocused)return!0;const o=n.selection.anchor;return o&&o.parent!==i}function cd(i,e){const t=as.get(i),n=[];let s=!1;for(const[o,r]of t)r.isDirectHost&&(n.push(o),ud(e,o,r)&&(s=!0));for(const[o,r]of t){if(r.isDirectHost)continue;const a=wT(o);!a||n.includes(a)||(r.hostElement=a,ud(e,o,r)&&(s=!0))}return s}function ud(i,e,t){const{text:n,isDirectHost:s,hostElement:o}=t;let r=!1;return o.getAttribute("data-placeholder")!==n&&(i.setAttribute("data-placeholder",n,o),r=!0),(s||e.childCount==1)&&pT(o,t.keepOnFocus)?mT(i,o)&&(r=!0):gT(i,o)&&(r=!0),r}function wT(i){if(i.childCount){const e=i.getChild(0);if(e.is("element")&&!e.is("uiElement"))return e}return null}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const or=new Map;function J(i,e,t){let n=or.get(i);n||(n=new Map,or.set(i,n)),n.set(e,t)}function bT(i,e){const t=or.get(i);return t&&t.has(e)?t.get(e):_T}function _T(i){return[i]}function dd(i,e,t={}){const n=bT(i.constructor,e.constructor);try{return i=i.clone(),n(i,e,t)}catch(s){throw s}}function vT(i,e,t){i=i.slice(),e=e.slice();const n=new yT(t.document,t.useRelations,t.forceWeakRemove);n.setOriginalOperations(i),n.setOriginalOperations(e);const s=n.originalOperations;if(i.length==0||e.length==0)return{operationsA:i,operationsB:e,originalOperations:s};const o=new WeakMap;for(const l of i)o.set(l,0);const r={nextBaseVersionA:i[i.length-1].baseVersion+1,nextBaseVersionB:e[e.length-1].baseVersion+1,originalOperationsACount:i.length,originalOperationsBCount:e.length};let a=0;for(;a<i.length;){const l=i[a],c=o.get(l);if(c==e.length){a++;continue}const u=e[c],d=dd(l,u,n.getContext(l,u,!0)),f=dd(u,l,n.getContext(u,l,!1));n.updateRelation(l,u),n.setOriginalOperations(d,l),n.setOriginalOperations(f,u);for(const b of d)o.set(b,c+f.length);i.splice(a,1,...d),e.splice(c,1,...f)}if(t.padWithNoOps){const l=i.length-r.originalOperationsACount,c=e.length-r.originalOperationsBCount;fd(i,c-l),fd(e,l-c)}return hd(i,r.nextBaseVersionB),hd(e,r.nextBaseVersionA),{operationsA:i,operationsB:e,originalOperations:s}}class yT{constructor(e,t,n=!1){this.originalOperations=new Map,this._history=e.history,this._useRelations=t,this._forceWeakRemove=!!n,this._relations=new Map}setOriginalOperations(e,t=null){const n=t?this.originalOperations.get(t):null;for(const s of e)this.originalOperations.set(s,n||s)}updateRelation(e,t){switch(e.constructor){case ie:{switch(t.constructor){case Ce:{e.targetPosition.isEqual(t.sourcePosition)||t.movedRange.containsPosition(e.targetPosition)?this._setRelation(e,t,"insertAtSource"):e.targetPosition.isEqual(t.deletionPosition)?this._setRelation(e,t,"insertBetween"):e.targetPosition.isAfter(t.sourcePosition)&&this._setRelation(e,t,"moveTargetAfter");break}case ie:{e.targetPosition.isEqual(t.sourcePosition)||e.targetPosition.isBefore(t.sourcePosition)?this._setRelation(e,t,"insertBefore"):this._setRelation(e,t,"insertAfter");break}}break}case fe:{switch(t.constructor){case Ce:{e.splitPosition.isBefore(t.sourcePosition)&&this._setRelation(e,t,"splitBefore");break}case ie:if(e.splitPosition.isEqual(t.sourcePosition)||e.splitPosition.isBefore(t.sourcePosition))this._setRelation(e,t,"splitBefore");else{const n=E._createFromPositionAndShift(t.sourcePosition,t.howMany);if(e.splitPosition.hasSameParentAs(t.sourcePosition)&&n.containsPosition(e.splitPosition)){const s=n.end.offset-e.splitPosition.offset,o=e.splitPosition.offset-n.start.offset;this._setRelation(e,t,{howMany:s,offset:o})}}}break}case Ce:{switch(t.constructor){case Ce:{e.targetPosition.isEqual(t.sourcePosition)||this._setRelation(e,t,"mergeTargetNotMoved"),e.sourcePosition.isEqual(t.targetPosition)&&this._setRelation(e,t,"mergeSourceNotMoved"),e.sourcePosition.isEqual(t.sourcePosition)&&this._setRelation(e,t,"mergeSameElement");break}case fe:e.sourcePosition.isEqual(t.splitPosition)&&this._setRelation(e,t,"splitAtSource")}break}case Be:{const n=e.newRange;if(!n)return;switch(t.constructor){case ie:{const s=E._createFromPositionAndShift(t.sourcePosition,t.howMany),o=s.containsPosition(n.start)||s.start.isEqual(n.start),r=s.containsPosition(n.end)||s.end.isEqual(n.end);(o||r)&&!s.containsRange(n)&&this._setRelation(e,t,{side:o?"left":"right",path:o?n.start.path.slice():n.end.path.slice()});break}case Ce:{const s=n.start.isEqual(t.targetPosition),o=n.start.isEqual(t.deletionPosition),r=n.end.isEqual(t.deletionPosition),a=n.end.isEqual(t.sourcePosition);(s||o||r||a)&&this._setRelation(e,t,{wasInLeftElement:s,wasStartBeforeMergedElement:o,wasEndBeforeMergedElement:r,wasInRightElement:a});break}}break}}}getContext(e,t,n){return{aIsStrong:n,aWasUndone:this._wasUndone(e),bWasUndone:this._wasUndone(t),abRelation:this._useRelations?this._getRelation(e,t):null,baRelation:this._useRelations?this._getRelation(t,e):null,forceWeakRemove:this._forceWeakRemove}}_wasUndone(e){const t=this.originalOperations.get(e);return t.wasUndone||this._history.isUndoneOperation(t)}_getRelation(e,t){const n=this.originalOperations.get(t),s=this._history.getUndoneOperation(n);if(!s)return null;const o=this.originalOperations.get(e),r=this._relations.get(o);return r&&r.get(s)||null}_setRelation(e,t,n){const s=this.originalOperations.get(e),o=this.originalOperations.get(t);let r=this._relations.get(s);r||(r=new Map,this._relations.set(s,r)),r.set(o,n)}}function hd(i,e){for(const t of i)t.baseVersion=e++}function fd(i,e){for(let t=0;t<e;t++)i.push(new Se(0))}J(ye,ye,(i,e,t)=>{if(i.key===e.key&&i.range.start.hasSameParentAs(e.range.start)){const n=i.range.getDifference(e.range).map(o=>new ye(o,i.key,i.oldValue,i.newValue,0)),s=i.range.getIntersection(e.range);return s&&t.aIsStrong&&n.push(new ye(s,e.key,e.newValue,i.newValue,0)),n.length==0?[new Se(0)]:n}else return[i]});J(ye,Ae,(i,e)=>{if(i.range.start.hasSameParentAs(e.position)&&i.range.containsPosition(e.position)){const n=i.range._getTransformedByInsertion(e.position,e.howMany,!e.shouldReceiveAttributes).map(s=>new ye(s,i.key,i.oldValue,i.newValue,i.baseVersion));if(e.shouldReceiveAttributes){const s=md(e,i.key,i.oldValue);s&&n.unshift(s)}return n}return i.range=i.range._getTransformedByInsertion(e.position,e.howMany,!1)[0],[i]});function md(i,e,t){const s=i.nodes.getNode(0).getAttribute(e);if(s==t)return null;const o=new E(i.position,i.position.getShiftedBy(i.howMany));return new ye(o,e,s,t,0)}J(ye,Ce,(i,e)=>{const t=[];i.range.start.hasSameParentAs(e.deletionPosition)&&(i.range.containsPosition(e.deletionPosition)||i.range.start.isEqual(e.deletionPosition))&&t.push(E._createFromPositionAndShift(e.graveyardPosition,1));const n=i.range._getTransformedByMergeOperation(e);return n.isCollapsed||t.push(n),t.map(s=>new ye(s,i.key,i.oldValue,i.newValue,i.baseVersion))});J(ye,ie,(i,e)=>CT(i.range,e).map(n=>new ye(n,i.key,i.oldValue,i.newValue,i.baseVersion)));function CT(i,e){const t=E._createFromPositionAndShift(e.sourcePosition,e.howMany);let n=null,s=[];t.containsRange(i,!0)?n=i:i.start.hasSameParentAs(t.start)?(s=i.getDifference(t),n=i.getIntersection(t)):s=[i];const o=[];for(let r of s){r=r._getTransformedByDeletion(e.sourcePosition,e.howMany);const a=e.getMovedRangeStart(),l=r.start.hasSameParentAs(a);r=r._getTransformedByInsertion(a,e.howMany,l),o.push(...r)}return n&&o.push(n._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany,!1)[0]),o}J(ye,fe,(i,e)=>{if(i.range.end.isEqual(e.insertionPosition))return e.graveyardPosition||i.range.end.offset++,[i];if(i.range.start.hasSameParentAs(e.splitPosition)&&i.range.containsPosition(e.splitPosition)){const t=i.clone();return t.range=new E(e.moveTargetPosition.clone(),i.range.end._getCombined(e.splitPosition,e.moveTargetPosition)),i.range.end=e.splitPosition.clone(),i.range.end.stickiness="toPrevious",[i,t]}return i.range=i.range._getTransformedBySplitOperation(e),[i]});J(Ae,ye,(i,e)=>{const t=[i];if(i.shouldReceiveAttributes&&i.position.hasSameParentAs(e.range.start)&&e.range.containsPosition(i.position)){const n=md(i,e.key,e.newValue);n&&t.push(n)}return t});J(Ae,Ae,(i,e,t)=>i.position.isEqual(e.position)&&t.aIsStrong?[i]:(i.position=i.position._getTransformedByInsertOperation(e),[i]));J(Ae,ie,(i,e)=>(i.position=i.position._getTransformedByMoveOperation(e),[i]));J(Ae,fe,(i,e)=>(i.position=i.position._getTransformedBySplitOperation(e),[i]));J(Ae,Ce,(i,e)=>(i.position=i.position._getTransformedByMergeOperation(e),[i]));J(Be,Ae,(i,e)=>(i.oldRange&&(i.oldRange=i.oldRange._getTransformedByInsertOperation(e)[0]),i.newRange&&(i.newRange=i.newRange._getTransformedByInsertOperation(e)[0]),[i]));J(Be,Be,(i,e,t)=>{if(i.name==e.name)if(t.aIsStrong)i.oldRange=e.newRange?e.newRange.clone():null;else return[new Se(0)];return[i]});J(Be,Ce,(i,e)=>(i.oldRange&&(i.oldRange=i.oldRange._getTransformedByMergeOperation(e)),i.newRange&&(i.newRange=i.newRange._getTransformedByMergeOperation(e)),[i]));J(Be,ie,(i,e,t)=>{if(i.oldRange&&(i.oldRange=E._createFromRanges(i.oldRange._getTransformedByMoveOperation(e))),i.newRange){if(t.abRelation){const n=E._createFromRanges(i.newRange._getTransformedByMoveOperation(e));if(t.abRelation.side=="left"&&e.targetPosition.isEqual(i.newRange.start))return i.newRange.start.path=t.abRelation.path,i.newRange.end=n.end,[i];if(t.abRelation.side=="right"&&e.targetPosition.isEqual(i.newRange.end))return i.newRange.start=n.start,i.newRange.end.path=t.abRelation.path,[i]}i.newRange=E._createFromRanges(i.newRange._getTransformedByMoveOperation(e))}return[i]});J(Be,fe,(i,e,t)=>{if(i.oldRange&&(i.oldRange=i.oldRange._getTransformedBySplitOperation(e)),i.newRange){if(t.abRelation){const n=i.newRange._getTransformedBySplitOperation(e);return i.newRange.start.isEqual(e.splitPosition)&&t.abRelation.wasStartBeforeMergedElement?i.newRange.start=x._createAt(e.insertionPosition):i.newRange.start.isEqual(e.splitPosition)&&!t.abRelation.wasInLeftElement&&(i.newRange.start=x._createAt(e.moveTargetPosition)),i.newRange.end.isEqual(e.splitPosition)&&t.abRelation.wasInRightElement?i.newRange.end=x._createAt(e.moveTargetPosition):i.newRange.end.isEqual(e.splitPosition)&&t.abRelation.wasEndBeforeMergedElement?i.newRange.end=x._createAt(e.insertionPosition):i.newRange.end=n.end,[i]}i.newRange=i.newRange._getTransformedBySplitOperation(e)}return[i]});J(Ce,Ae,(i,e)=>(i.sourcePosition.hasSameParentAs(e.position)&&(i.howMany+=e.howMany),i.sourcePosition=i.sourcePosition._getTransformedByInsertOperation(e),i.targetPosition=i.targetPosition._getTransformedByInsertOperation(e),[i]));J(Ce,Ce,(i,e,t)=>{if(i.sourcePosition.isEqual(e.sourcePosition)&&i.targetPosition.isEqual(e.targetPosition))if(t.bWasUndone){const n=e.graveyardPosition.path.slice();return n.push(0),i.sourcePosition=new x(e.graveyardPosition.root,n),i.howMany=0,[i]}else return[new Se(0)];if(i.sourcePosition.isEqual(e.sourcePosition)&&!i.targetPosition.isEqual(e.targetPosition)&&!t.bWasUndone&&t.abRelation!="splitAtSource"){const n=i.targetPosition.root.rootName=="$graveyard",s=e.targetPosition.root.rootName=="$graveyard";if(s&&!n||!(n&&!s)&&t.aIsStrong){const l=e.targetPosition._getTransformedByMergeOperation(e),c=i.targetPosition._getTransformedByMergeOperation(e);return[new ie(l,i.howMany,c,0)]}else return[new Se(0)]}return i.sourcePosition.hasSameParentAs(e.targetPosition)&&(i.howMany+=e.howMany),i.sourcePosition=i.sourcePosition._getTransformedByMergeOperation(e),i.targetPosition=i.targetPosition._getTransformedByMergeOperation(e),(!i.graveyardPosition.isEqual(e.graveyardPosition)||!t.aIsStrong)&&(i.graveyardPosition=i.graveyardPosition._getTransformedByMergeOperation(e)),[i]});J(Ce,ie,(i,e,t)=>{const n=E._createFromPositionAndShift(e.sourcePosition,e.howMany);return e.type=="remove"&&!t.bWasUndone&&!t.forceWeakRemove&&i.deletionPosition.hasSameParentAs(e.sourcePosition)&&n.containsPosition(i.sourcePosition)?[new Se(0)]:(i.sourcePosition.hasSameParentAs(e.targetPosition)&&(i.howMany+=e.howMany),i.sourcePosition.hasSameParentAs(e.sourcePosition)&&(i.howMany-=e.howMany),i.sourcePosition=i.sourcePosition._getTransformedByMoveOperation(e),i.targetPosition=i.targetPosition._getTransformedByMoveOperation(e),i.graveyardPosition.isEqual(e.targetPosition)||(i.graveyardPosition=i.graveyardPosition._getTransformedByMoveOperation(e)),[i])});J(Ce,fe,(i,e,t)=>{if(e.graveyardPosition&&(i.graveyardPosition=i.graveyardPosition._getTransformedByDeletion(e.graveyardPosition,1),i.deletionPosition.isEqual(e.graveyardPosition)&&(i.howMany=e.howMany)),i.targetPosition.isEqual(e.splitPosition)){const n=e.howMany!=0,s=e.graveyardPosition&&i.deletionPosition.isEqual(e.graveyardPosition);if(n||s||t.abRelation=="mergeTargetNotMoved")return i.sourcePosition=i.sourcePosition._getTransformedBySplitOperation(e),[i]}if(i.sourcePosition.isEqual(e.splitPosition)){if(t.abRelation=="mergeSourceNotMoved")return i.howMany=0,i.targetPosition=i.targetPosition._getTransformedBySplitOperation(e),[i];if(t.abRelation=="mergeSameElement"||i.sourcePosition.offset>0)return i.sourcePosition=e.moveTargetPosition.clone(),i.targetPosition=i.targetPosition._getTransformedBySplitOperation(e),[i]}return i.sourcePosition.hasSameParentAs(e.splitPosition)&&(i.howMany=e.splitPosition.offset),i.sourcePosition=i.sourcePosition._getTransformedBySplitOperation(e),i.targetPosition=i.targetPosition._getTransformedBySplitOperation(e),[i]});J(ie,Ae,(i,e)=>{const n=E._createFromPositionAndShift(i.sourcePosition,i.howMany)._getTransformedByInsertOperation(e,!1)[0];return i.sourcePosition=n.start,i.howMany=n.end.offset-n.start.offset,i.targetPosition.isEqual(e.position)||(i.targetPosition=i.targetPosition._getTransformedByInsertOperation(e)),[i]});J(ie,ie,(i,e,t)=>{const n=E._createFromPositionAndShift(i.sourcePosition,i.howMany),s=E._createFromPositionAndShift(e.sourcePosition,e.howMany);let o=t.aIsStrong,r=!t.aIsStrong;t.abRelation=="insertBefore"||t.baRelation=="insertAfter"?r=!0:(t.abRelation=="insertAfter"||t.baRelation=="insertBefore")&&(r=!1);let a;if(i.targetPosition.isEqual(e.targetPosition)&&r?a=i.targetPosition._getTransformedByDeletion(e.sourcePosition,e.howMany):a=i.targetPosition._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany),gd(i,e)&&gd(e,i))return[e.getReversed()];if(n.containsPosition(e.targetPosition)&&n.containsRange(s,!0))return n.start=n.start._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany),n.end=n.end._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany),Pn([n],a);if(s.containsPosition(i.targetPosition)&&s.containsRange(n,!0))return n.start=n.start._getCombined(e.sourcePosition,e.getMovedRangeStart()),n.end=n.end._getCombined(e.sourcePosition,e.getMovedRangeStart()),Pn([n],a);const u=Me(i.sourcePosition.getParentPath(),e.sourcePosition.getParentPath());if(u=="prefix"||u=="extension")return n.start=n.start._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany),n.end=n.end._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany),Pn([n],a);i.type=="remove"&&e.type!="remove"&&!t.aWasUndone&&!t.forceWeakRemove?o=!0:i.type!="remove"&&e.type=="remove"&&!t.bWasUndone&&!t.forceWeakRemove&&(o=!1);const d=[],f=n.getDifference(s);for(const _ of f){_.start=_.start._getTransformedByDeletion(e.sourcePosition,e.howMany),_.end=_.end._getTransformedByDeletion(e.sourcePosition,e.howMany);const C=Me(_.start.getParentPath(),e.getMovedRangeStart().getParentPath())=="same",A=_._getTransformedByInsertion(e.getMovedRangeStart(),e.howMany,C);d.push(...A)}const b=n.getIntersection(s);return b!==null&&o&&(b.start=b.start._getCombined(e.sourcePosition,e.getMovedRangeStart()),b.end=b.end._getCombined(e.sourcePosition,e.getMovedRangeStart()),d.length===0?d.push(b):d.length==1?s.start.isBefore(n.start)||s.start.isEqual(n.start)?d.unshift(b):d.push(b):d.splice(1,0,b)),d.length===0?[new Se(i.baseVersion)]:Pn(d,a)});J(ie,fe,(i,e,t)=>{let n=i.targetPosition.clone();(!i.targetPosition.isEqual(e.insertionPosition)||!e.graveyardPosition||t.abRelation=="moveTargetAfter")&&(n=i.targetPosition._getTransformedBySplitOperation(e));const s=E._createFromPositionAndShift(i.sourcePosition,i.howMany);if(s.end.isEqual(e.insertionPosition))return e.graveyardPosition||i.howMany++,i.targetPosition=n,[i];if(s.start.hasSameParentAs(e.splitPosition)&&s.containsPosition(e.splitPosition)){let a=new E(e.splitPosition,s.end);a=a._getTransformedBySplitOperation(e);const l=[new E(s.start,e.splitPosition),a];return Pn(l,n)}i.targetPosition.isEqual(e.splitPosition)&&t.abRelation=="insertAtSource"&&(n=e.moveTargetPosition),i.targetPosition.isEqual(e.insertionPosition)&&t.abRelation=="insertBetween"&&(n=i.targetPosition);const r=[s._getTransformedBySplitOperation(e)];if(e.graveyardPosition){const a=s.start.isEqual(e.graveyardPosition)||s.containsPosition(e.graveyardPosition);i.howMany>1&&a&&!t.aWasUndone&&r.push(E._createFromPositionAndShift(e.insertionPosition,1))}return Pn(r,n)});J(ie,Ce,(i,e,t)=>{const n=E._createFromPositionAndShift(i.sourcePosition,i.howMany);if(e.deletionPosition.hasSameParentAs(i.sourcePosition)&&n.containsPosition(e.sourcePosition)){if(i.type=="remove"&&!t.forceWeakRemove){if(!t.aWasUndone){const r=[];let a=e.graveyardPosition.clone(),l=e.targetPosition._getTransformedByMergeOperation(e);i.howMany>1&&(r.push(new ie(i.sourcePosition,i.howMany-1,i.targetPosition,0)),a=a._getTransformedByMove(i.sourcePosition,i.targetPosition,i.howMany-1),l=l._getTransformedByMove(i.sourcePosition,i.targetPosition,i.howMany-1));const c=e.deletionPosition._getCombined(i.sourcePosition,i.targetPosition),u=new ie(a,1,c,0),d=u.getMovedRangeStart().path.slice();d.push(0);const f=new x(u.targetPosition.root,d);l=l._getTransformedByMove(a,c,1);const b=new ie(l,e.howMany,f,0);return r.push(u),r.push(b),r}}else if(i.howMany==1)return t.bWasUndone?(i.sourcePosition=e.graveyardPosition.clone(),i.targetPosition=i.targetPosition._getTransformedByMergeOperation(e),[i]):[new Se(0)]}const o=E._createFromPositionAndShift(i.sourcePosition,i.howMany)._getTransformedByMergeOperation(e);return i.sourcePosition=o.start,i.howMany=o.end.offset-o.start.offset,i.targetPosition=i.targetPosition._getTransformedByMergeOperation(e),[i]});J(Fe,Ae,(i,e)=>(i.position=i.position._getTransformedByInsertOperation(e),[i]));J(Fe,Ce,(i,e)=>i.position.isEqual(e.deletionPosition)?(i.position=e.graveyardPosition.clone(),i.position.stickiness="toNext",[i]):(i.position=i.position._getTransformedByMergeOperation(e),[i]));J(Fe,ie,(i,e)=>(i.position=i.position._getTransformedByMoveOperation(e),[i]));J(Fe,Fe,(i,e,t)=>{if(i.position.isEqual(e.position))if(t.aIsStrong)i.oldName=e.newName;else return[new Se(0)];return[i]});J(Fe,fe,(i,e)=>{const t=i.position.path,n=e.splitPosition.getParentPath();if(Me(t,n)=="same"&&!e.graveyardPosition){const s=new Fe(i.position.getShiftedBy(1),i.oldName,i.newName,0);return[i,s]}return i.position=i.position._getTransformedBySplitOperation(e),[i]});J(It,It,(i,e,t)=>{if(i.root===e.root&&i.key===e.key){if(!t.aIsStrong||i.newValue===e.newValue)return[new Se(0)];i.oldValue=e.newValue}return[i]});J(fe,Ae,(i,e)=>(i.splitPosition.hasSameParentAs(e.position)&&i.splitPosition.offset<e.position.offset&&(i.howMany+=e.howMany),i.splitPosition=i.splitPosition._getTransformedByInsertOperation(e),i.insertionPosition=i.insertionPosition._getTransformedByInsertOperation(e),[i]));J(fe,Ce,(i,e,t)=>{if(!i.graveyardPosition&&!t.bWasUndone&&i.splitPosition.hasSameParentAs(e.sourcePosition)){const n=e.graveyardPosition.path.slice();n.push(0);const s=new x(e.graveyardPosition.root,n),o=fe.getInsertionPosition(new x(e.graveyardPosition.root,n)),r=new fe(s,0,o,null,0);return i.splitPosition=i.splitPosition._getTransformedByMergeOperation(e),i.insertionPosition=fe.getInsertionPosition(i.splitPosition),i.graveyardPosition=r.insertionPosition.clone(),i.graveyardPosition.stickiness="toNext",[r,i]}return i.splitPosition.hasSameParentAs(e.deletionPosition)&&!i.splitPosition.isAfter(e.deletionPosition)&&i.howMany--,i.splitPosition.hasSameParentAs(e.targetPosition)&&(i.howMany+=e.howMany),i.splitPosition=i.splitPosition._getTransformedByMergeOperation(e),i.insertionPosition=fe.getInsertionPosition(i.splitPosition),i.graveyardPosition&&(i.graveyardPosition=i.graveyardPosition._getTransformedByMergeOperation(e)),[i]});J(fe,ie,(i,e,t)=>{const n=E._createFromPositionAndShift(e.sourcePosition,e.howMany);if(i.graveyardPosition){const o=n.start.isEqual(i.graveyardPosition)||n.containsPosition(i.graveyardPosition);if(!t.bWasUndone&&o){const r=i.splitPosition._getTransformedByMoveOperation(e),a=i.graveyardPosition._getTransformedByMoveOperation(e),l=a.path.slice();l.push(0);const c=new x(a.root,l);return[new ie(r,i.howMany,c,0)]}i.graveyardPosition=i.graveyardPosition._getTransformedByMoveOperation(e)}const s=i.splitPosition.isEqual(e.targetPosition);if(s&&(t.baRelation=="insertAtSource"||t.abRelation=="splitBefore"))return i.howMany+=e.howMany,i.splitPosition=i.splitPosition._getTransformedByDeletion(e.sourcePosition,e.howMany),i.insertionPosition=fe.getInsertionPosition(i.splitPosition),[i];if(s&&t.abRelation&&t.abRelation.howMany){const{howMany:o,offset:r}=t.abRelation;return i.howMany+=o,i.splitPosition=i.splitPosition.getShiftedBy(r),[i]}if(i.splitPosition.hasSameParentAs(e.sourcePosition)&&n.containsPosition(i.splitPosition)){const o=e.howMany-(i.splitPosition.offset-e.sourcePosition.offset);return i.howMany-=o,i.splitPosition.hasSameParentAs(e.targetPosition)&&i.splitPosition.offset<e.targetPosition.offset&&(i.howMany+=e.howMany),i.splitPosition=e.sourcePosition.clone(),i.insertionPosition=fe.getInsertionPosition(i.splitPosition),[i]}return e.sourcePosition.isEqual(e.targetPosition)||(i.splitPosition.hasSameParentAs(e.sourcePosition)&&i.splitPosition.offset<=e.sourcePosition.offset&&(i.howMany-=e.howMany),i.splitPosition.hasSameParentAs(e.targetPosition)&&i.splitPosition.offset<e.targetPosition.offset&&(i.howMany+=e.howMany)),i.splitPosition.stickiness="toNone",i.splitPosition=i.splitPosition._getTransformedByMoveOperation(e),i.splitPosition.stickiness="toNext",i.graveyardPosition?i.insertionPosition=i.insertionPosition._getTransformedByMoveOperation(e):i.insertionPosition=fe.getInsertionPosition(i.splitPosition),[i]});J(fe,fe,(i,e,t)=>{if(i.splitPosition.isEqual(e.splitPosition)){if(!i.graveyardPosition&&!e.graveyardPosition)return[new Se(0)];if(i.graveyardPosition&&e.graveyardPosition&&i.graveyardPosition.isEqual(e.graveyardPosition))return[new Se(0)];if(t.abRelation=="splitBefore")return i.howMany=0,i.graveyardPosition=i.graveyardPosition._getTransformedBySplitOperation(e),[i]}if(i.graveyardPosition&&e.graveyardPosition&&i.graveyardPosition.isEqual(e.graveyardPosition)){const n=i.splitPosition.root.rootName=="$graveyard",s=e.splitPosition.root.rootName=="$graveyard";if(s&&!n||!(n&&!s)&&t.aIsStrong){const l=[];return e.howMany&&l.push(new ie(e.moveTargetPosition,e.howMany,e.splitPosition,0)),i.howMany&&l.push(new ie(i.splitPosition,i.howMany,i.moveTargetPosition,0)),l}else return[new Se(0)]}if(i.graveyardPosition&&(i.graveyardPosition=i.graveyardPosition._getTransformedBySplitOperation(e)),i.splitPosition.isEqual(e.insertionPosition)&&t.abRelation=="splitBefore")return i.howMany++,[i];if(e.splitPosition.isEqual(i.insertionPosition)&&t.baRelation=="splitBefore"){const n=e.insertionPosition.path.slice();n.push(0);const s=new x(e.insertionPosition.root,n),o=new ie(i.insertionPosition,1,s,0);return[i,o]}return i.splitPosition.hasSameParentAs(e.splitPosition)&&i.splitPosition.offset<e.splitPosition.offset&&(i.howMany-=e.howMany),i.splitPosition=i.splitPosition._getTransformedBySplitOperation(e),i.insertionPosition=fe.getInsertionPosition(i.splitPosition),[i]});function gd(i,e){return i.targetPosition._getTransformedByDeletion(e.sourcePosition,e.howMany)===null}function Pn(i,e){const t=[];for(let n=0;n<i.length;n++){const s=i[n],o=new ie(s.start,s.end.offset-s.start.offset,e,0);t.push(o);for(let r=n+1;r<i.length;r++)i[r]=i[r]._getTransformedByMove(o.sourcePosition,o.targetPosition,o.howMany)[0];e=e._getTransformedByMove(o.sourcePosition,o.targetPosition,o.howMany)}return t}class kT extends Ft{constructor(e){super(e);this.domEventType="click"}onDomEvent(e){this.fire(e.type,e)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ls extends Ft{constructor(e){super(e);this.domEventType=["mousedown","mouseup","mouseover","mouseout"]}onDomEvent(e){this.fire(e.type,e)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class In{constructor(e){this.document=e}createDocumentFragment(e){return new tn(this.document,e)}createElement(e,t,n){return new Ge(this.document,e,t,n)}createText(e){return new ce(this.document,e)}clone(e,t=!1){return e._clone(t)}appendChild(e,t){return t._appendChild(e)}insertChild(e,t,n){return n._insertChild(e,t)}removeChildren(e,t,n){return n._removeChildren(e,t)}remove(e){const t=e.parent;return t?this.removeChildren(t.getChildIndex(e),1,t):[]}replace(e,t){const n=e.parent;if(n){const s=n.getChildIndex(e);return this.removeChildren(s,1,n),this.insertChild(s,t,n),!0}return!1}unwrapElement(e){const t=e.parent;if(t){const n=t.getChildIndex(e);this.remove(e),this.insertChild(n,e.getChildren(),t)}}rename(e,t){const n=new Ge(this.document,e,t.getAttributes(),t.getChildren());return this.replace(t,n)?n:null}setAttribute(e,t,n){n._setAttribute(e,t)}removeAttribute(e,t){t._removeAttribute(e)}addClass(e,t){t._addClass(e)}removeClass(e,t){t._removeClass(e)}setStyle(e,t,n){je(e)&&n===void 0&&(n=t),n._setStyle(e,t)}removeStyle(e,t){t._removeStyle(e)}setCustomProperty(e,t,n){n._setCustomProperty(e,t)}removeCustomProperty(e,t){return t._removeCustomProperty(e)}createPositionAt(e,t){return I._createAt(e,t)}createPositionAfter(e){return I._createAfter(e)}createPositionBefore(e){return I._createBefore(e)}createRange(e,t){return new z(e,t)}createRangeOn(e){return z._createOn(e)}createRangeIn(e){return z._createIn(e)}createSelection(e,t,n){return new et(e,t,n)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class TT extends $u{constructor(e,t){super(e);this.view=t}init(){const e=this.editor,t=this.view,n=e.editing.view,s=t.editable,o=n.document.getRoot();t.editable.name=o.rootName,t.render();const r=s.element;this.setEditableElement(s.name,r),this.focusTracker.add(r),t.editable.bind("isFocused").to(this.focusTracker),n.attachDomRoot(r),this._initPlaceholder(),this._initToolbar(),this.fire("ready")}destroy(){const e=this.view;this.editor.editing.view.detachDomRoot(e.editable.name),e.destroy(),super.destroy()}_initToolbar(){const e=this.editor,n=this.view.toolbar;n.fillFromConfig(e.config.get("toolbar"),this.componentFactory),fT({origin:e.editing.view,originFocusTracker:this.focusTracker,originKeystrokeHandler:e.keystrokes,toolbar:n})}_initPlaceholder(){const e=this.editor,t=e.editing.view,n=t.document.getRoot(),s=e.sourceElement,o=e.config.get("placeholder")||s&&s.tagName.toLowerCase()==="textarea"&&s.getAttribute("placeholder");o&&ld({view:t,element:n,text:o,isDirectHost:!1,keepOnFocus:!0})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ET extends nT{constructor(e,t,n={}){super(e);this.toolbar=new Zo(e,{shouldGroupWhenFull:n.shouldToolbarGroupWhenFull}),this.editable=new oT(e,t,n.editableElement),this.toolbar.extendTemplate({attributes:{class:["ck-reset_all","ck-rounded-corners"],dir:e.uiLanguageDirection}})}render(){super.render(),this.registerChild([this.toolbar,this.editable])}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class pd extends zu{constructor(e,t){super(t);Yt(e)&&(this.sourceElement=e,YC(this)),this.model.document.createRoot();const n=!this.config.get("toolbar.shouldNotGroupWhenFull"),s=new ET(this.locale,this.editing.view,{editableElement:this.sourceElement,shouldToolbarGroupWhenFull:n});this.ui=new TT(this,s)}destroy(){const e=this.getData();return this.ui.destroy(),super.destroy().then(()=>{this.sourceElement&&F0(this.sourceElement,e)})}static create(e,t={}){return new Promise(n=>{const s=Yt(e);if(s&&e.tagName==="TEXTAREA")throw new p("editor-wrong-element",null);const o=new this(e,t);n(o.initPlugins().then(()=>{o.ui.init()}).then(()=>{if(!s&&t.initialData)throw new p("editor-create-initial-data",null);const r=t.initialData!==void 0?t.initialData:AT(e);return o.data.init(r)}).then(()=>o.fire("ready")).then(()=>o))})}}F(pd,QC);function AT(i){return Yt(i)?B0(i):i}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ST{constructor(e){this.files=xT(e),this._native=e}get types(){return this._native.types}getData(e){return this._native.getData(e)}setData(e,t){this._native.setData(e,t)}set effectAllowed(e){this._native.effectAllowed=e}get effectAllowed(){return this._native.effectAllowed}set dropEffect(e){this._native.dropEffect=e}get dropEffect(){return this._native.dropEffect}get isCanceled(){return this._native.dropEffect=="none"||!!this._native.mozUserCancelled}}function xT(i){const e=Array.from(i.files||[]),t=Array.from(i.items||[]);return e.length?e:t.filter(n=>n.kind==="file").map(n=>n.getAsFile())}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class rr extends Ft{constructor(e){super(e);const t=this.document;this.domEventType=["paste","copy","cut","drop","dragover","dragstart","dragend","dragenter","dragleave"],this.listenTo(t,"paste",n("clipboardInput"),{priority:"low"}),this.listenTo(t,"drop",n("clipboardInput"),{priority:"low"}),this.listenTo(t,"dragover",n("dragging"),{priority:"low"});function n(s){return(o,r)=>{r.preventDefault();const a=r.dropRange?[r.dropRange]:null,l=new Ot(t,s);t.fire(l,{dataTransfer:r.dataTransfer,method:o.name,targetRanges:a,target:r.target}),l.stop.called&&r.stopPropagation()}}}onDomEvent(e){const t={dataTransfer:new ST(e.clipboardData?e.clipboardData:e.dataTransfer)};(e.type=="drop"||e.type=="dragover")&&(t.dropRange=PT(this.view,e)),this.fire(e.type,e,t)}}function PT(i,e){const t=e.target.ownerDocument,n=e.clientX,s=e.clientY;let o;return t.caretRangeFromPoint&&t.caretRangeFromPoint(n,s)?o=t.caretRangeFromPoint(n,s):e.rangeParent&&(o=t.createRange(),o.setStart(e.rangeParent,e.rangeOffset),o.collapse(!0)),o?i.domConverter.domRangeToView(o):null}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function IT(i){return i=i.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r?\n\r?\n/g,"</p><p>").replace(/\r?\n/g,"<br>").replace(/^\s/,"&nbsp;").replace(/\s$/,"&nbsp;").replace(/\s\s/g," &nbsp;"),(i.includes("</p><p>")||i.includes("<br>"))&&(i=`<p>${i}</p>`),i}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function RT(i){return i.replace(/<span(?: class="Apple-converted-space"|)>(\s+)<\/span>/g,(e,t)=>t.length==1?" ":t).replace(/<!--[\s\S]*?-->/g,"")}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const wd=["figcaption","li"];function bd(i){let e="";if(i.is("$text")||i.is("$textProxy"))e=i.data;else if(i.is("element","img")&&i.hasAttribute("alt"))e=i.getAttribute("alt");else if(i.is("element","br"))e=`
`;else{let t=null;for(const n of i.getChildren()){const s=bd(n);t&&(t.is("containerElement")||n.is("containerElement"))&&(wd.includes(t.name)||wd.includes(n.name)?e+=`
`:e+=`

`),e+=s,t=n}}return e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class gt extends P{static get pluginName(){return"ClipboardPipeline"}init(){this.editor.editing.view.addObserver(rr),this._setupPasteDrop(),this._setupCopyCut()}_setupPasteDrop(){const e=this.editor,t=e.model,n=e.editing.view,s=n.document;this.listenTo(s,"clipboardInput",o=>{e.isReadOnly&&o.stop()},{priority:"highest"}),this.listenTo(s,"clipboardInput",(o,r)=>{const a=r.dataTransfer;let l=r.content||"";l||(a.getData("text/html")?l=RT(a.getData("text/html")):a.getData("text/plain")&&(l=IT(a.getData("text/plain"))),l=this.editor.data.htmlProcessor.toView(l));const c=new Ot(this,"inputTransformation");this.fire(c,{content:l,dataTransfer:a,targetRanges:r.targetRanges,method:r.method}),c.stop.called&&o.stop(),n.scrollToTheSelection()},{priority:"low"}),this.listenTo(this,"inputTransformation",(o,r)=>{if(r.content.isEmpty)return;const l=this.editor.data.toModel(r.content,"$clipboardHolder");l.childCount!=0&&(o.stop(),t.change(()=>{this.fire("contentInsertion",{content:l,method:r.method,dataTransfer:r.dataTransfer,targetRanges:r.targetRanges})}))},{priority:"low"}),this.listenTo(this,"contentInsertion",(o,r)=>{r.resultRange=t.insertContent(r.content)},{priority:"low"})}_setupCopyCut(){const e=this.editor,t=e.model.document,s=e.editing.view.document;function o(r,a){const l=a.dataTransfer;a.preventDefault();const c=e.data.toView(e.model.getSelectedContent(t.selection));s.fire("clipboardOutput",{dataTransfer:l,content:c,method:r.name})}this.listenTo(s,"copy",o,{priority:"low"}),this.listenTo(s,"cut",(r,a)=>{e.isReadOnly?a.preventDefault():o(r,a)},{priority:"low"}),this.listenTo(s,"clipboardOutput",(r,a)=>{a.content.isEmpty||(a.dataTransfer.setData("text/html",this.editor.data.htmlProcessor.toData(a.content)),a.dataTransfer.setData("text/plain",bd(a.content))),a.method=="cut"&&e.model.deleteContent(t.selection)},{priority:"low"})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function*_d(i,e){for(const t of e)t&&i.getAttributeProperties(t[0]).copyOnEnter&&(yield t)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class MT extends q{execute(){const e=this.editor.model,t=e.document;e.change(n=>{VT(this.editor.model,n,t.selection,e.schema),this.fire("afterExecute",{writer:n})})}}function VT(i,e,t,n){const s=t.isCollapsed,o=t.getFirstRange(),r=o.start.parent,a=o.end.parent;if(n.isLimit(r)||n.isLimit(a)){!s&&r==a&&i.deleteContent(t);return}if(s){const l=_d(e.model.schema,t.getAttributes());vd(e,o.start),e.setSelectionAttribute(l)}else{const l=!(o.start.isAtStart&&o.end.isAtEnd),c=r==a;i.deleteContent(t,{leaveUnmerged:l}),l&&(c?vd(e,t.focus):e.setSelection(a,0))}}function vd(i,e){i.split(e),i.setSelection(e.parent.nextSibling,0)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class yd extends Et{constructor(e){super(e);const t=this.document;t.on("keydown",(n,s)=>{if(this.isEnabled&&s.keyCode==K.enter){const o=new $i(t,"enter",t.selection.getFirstRange());t.fire(o,new So(t,s.domEvent,{isSoft:s.shiftKey})),o.stop.called&&n.stop()}})}observe(){}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class cs extends P{static get pluginName(){return"Enter"}init(){const e=this.editor,t=e.editing.view,n=t.document;t.addObserver(yd),e.commands.add("enter",new MT(e)),this.listenTo(n,"enter",(s,o)=>{o.preventDefault(),!o.isSoft&&(e.execute("enter"),t.scrollToTheSelection())},{priority:"low"})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Cd{constructor(e,t=20){this.model=e,this.size=0,this.limit=t,this.isLocked=!1,this._changeCallback=(n,s)=>{s.type!="transparent"&&s!==this._batch&&this._reset(!0)},this._selectionChangeCallback=()=>{this._reset()},this.model.document.on("change",this._changeCallback),this.model.document.selection.on("change:range",this._selectionChangeCallback),this.model.document.selection.on("change:attribute",this._selectionChangeCallback)}get batch(){return this._batch||(this._batch=this.model.createBatch()),this._batch}input(e){this.size+=e,this.size>=this.limit&&this._reset(!0)}lock(){this.isLocked=!0}unlock(){this.isLocked=!1}destroy(){this.model.document.off("change",this._changeCallback),this.model.document.selection.off("change:range",this._selectionChangeCallback),this.model.document.selection.off("change:attribute",this._selectionChangeCallback)}_reset(e){(!this.isLocked||e)&&(this._batch=null,this.size=0)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class kd extends q{constructor(e,t){super(e);this.direction=t,this._buffer=new Cd(e.model,e.config.get("typing.undoStep"))}get buffer(){return this._buffer}execute(e={}){const t=this.editor.model,n=t.document;t.enqueueChange(this._buffer.batch,s=>{this._buffer.lock();const o=s.createSelection(e.selection||n.selection),r=e.sequence||1,a=o.isCollapsed;if(o.isCollapsed&&t.modifySelection(o,{direction:this.direction,unit:e.unit}),this._shouldEntireContentBeReplacedWithParagraph(r)){this._replaceEntireContentWithParagraph(s);return}if(this._shouldReplaceFirstBlockWithParagraph(o,r)){this.editor.execute("paragraph",{selection:o});return}if(o.isCollapsed)return;let l=0;o.getFirstRange().getMinimalFlatRanges().forEach(c=>{l+=mo(c.getWalker({singleCharacters:!0,ignoreElementEnd:!0,shallow:!0}))}),t.deleteContent(o,{doNotResetEntireContent:a,direction:this.direction}),this._buffer.input(l),s.setSelection(o),this._buffer.unlock()})}_shouldEntireContentBeReplacedWithParagraph(e){if(e>1)return!1;const t=this.editor.model,s=t.document.selection,o=t.schema.getLimitElement(s);if(!(s.isCollapsed&&s.containsEntireContent(o))||!t.schema.checkChild(o,"paragraph"))return!1;const a=o.getChild(0);return!(a&&a.name==="paragraph")}_replaceEntireContentWithParagraph(e){const t=this.editor.model,s=t.document.selection,o=t.schema.getLimitElement(s),r=e.createElement("paragraph");e.remove(e.createRangeIn(o)),e.insert(r,o),e.setSelection(r,0)}_shouldReplaceFirstBlockWithParagraph(e,t){const n=this.editor.model;if(t>1||this.direction!="backward"||!e.isCollapsed)return!1;const s=e.getFirstPosition(),o=n.schema.getLimitElement(s),r=o.getChild(0);return!(s.parent!=r||!e.containsEntireContent(r)||!n.schema.checkChild(o,"paragraph")||r.name=="paragraph")}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function OT(i,e){const t=[];let n=0,s;return i.forEach(a=>{a=="equal"?(o(),n++):a=="insert"?(r("insert")?s.values.push(e[n]):(o(),s={type:"insert",index:n,values:[e[n]]}),n++):r("delete")?s.howMany++:(o(),s={type:"delete",index:n,howMany:1})}),o(),t;function o(){s&&(t.push(s),s=null)}function r(a){return s&&s.type==a}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function NT(i){if(i.length==0)return!1;for(const e of i)if(e.type==="children"&&!Td(e))return!0;return!1}function Td(i){if(i.newChildren.length-i.oldChildren.length!=1)return;const e=Bt(i.oldChildren,i.newChildren,DT),t=OT(e,i.newChildren);if(t.length>1)return;const n=t[0];if(!!(!!n.values[0]&&n.values[0].is("$text")))return n}function DT(i,e){return!!i&&i.is("$text")&&!!e&&e.is("$text")?i.data===e.data:i===e}function Ed(i,e){const t=e.selection,n=i.shiftKey&&i.keyCode===K.delete,s=!t.isCollapsed;return n&&s}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class BT extends Et{constructor(e){super(e);const t=e.document;let n=0;t.on("keyup",(o,r)=>{(r.keyCode==K.delete||r.keyCode==K.backspace)&&(n=0)}),t.on("keydown",(o,r)=>{if(ae.isWindows&&Ed(r,t))return;const a={};if(r.keyCode==K.delete)a.direction="forward",a.unit="character";else if(r.keyCode==K.backspace)a.direction="backward",a.unit="codePoint";else return;const l=ae.isMac?r.altKey:r.ctrlKey;a.unit=l?"word":a.unit,a.sequence=++n,s(o,r.domEvent,a)}),ae.isAndroid&&t.on("beforeinput",(o,r)=>{if(r.domEvent.inputType!="deleteContentBackward")return;const a={unit:"codepoint",direction:"backward",sequence:1},l=r.domTarget.ownerDocument.defaultView.getSelection();l.anchorNode==l.focusNode&&l.anchorOffset+1!=l.focusOffset&&(a.selectionToRemove=e.domConverter.domSelectionToView(l)),s(o,r.domEvent,a)});function s(o,r,a){const l=new $i(t,"delete",t.selection.getFirstRange());t.fire(l,new So(t,r,a)),l.stop.called&&o.stop()}}observe(){}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class zt extends P{static get pluginName(){return"Delete"}init(){const e=this.editor,t=e.editing.view,n=t.document,s=e.model.document;t.addObserver(BT),this._undoOnBackspace=!1;const o=new kd(e,"forward");if(e.commands.add("deleteForward",o),e.commands.add("forwardDelete",o),e.commands.add("delete",new kd(e,"backward")),this.listenTo(n,"delete",(r,a)=>{const l={unit:a.unit,sequence:a.sequence};if(a.selectionToRemove){const c=e.model.createSelection(),u=[];for(const d of a.selectionToRemove.getRanges())u.push(e.editing.mapper.toModelRange(d));c.setTo(u),l.selection=c}e.execute(a.direction=="forward"?"deleteForward":"delete",l),a.preventDefault(),t.scrollToTheSelection()},{priority:"low"}),ae.isAndroid){let r=null;this.listenTo(n,"delete",(a,l)=>{const c=l.domTarget.ownerDocument.defaultView.getSelection();r={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}},{priority:"lowest"}),this.listenTo(n,"keyup",(a,l)=>{if(r){const c=l.domTarget.ownerDocument.defaultView.getSelection();c.collapse(r.anchorNode,r.anchorOffset),c.extend(r.focusNode,r.focusOffset),r=null}})}this.editor.plugins.has("UndoEditing")&&(this.listenTo(n,"delete",(r,a)=>{this._undoOnBackspace&&a.direction=="backward"&&a.sequence==1&&a.unit=="codePoint"&&(this._undoOnBackspace=!1,e.execute("undo"),a.preventDefault(),r.stop())},{context:"$capture"}),this.listenTo(s,"change",()=>{this._undoOnBackspace=!1}))}requestUndoOnBackspace(){this.editor.plugins.has("UndoEditing")&&(this._undoOnBackspace=!0)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ad{constructor(){this._stack=[]}add(e,t){const n=this._stack,s=n[0];this._insertDescriptor(e);const o=n[0];s!==o&&!ar(s,o)&&this.fire("change:top",{oldDescriptor:s,newDescriptor:o,writer:t})}remove(e,t){const n=this._stack,s=n[0];this._removeDescriptor(e);const o=n[0];s!==o&&!ar(s,o)&&this.fire("change:top",{oldDescriptor:s,newDescriptor:o,writer:t})}_insertDescriptor(e){const t=this._stack,n=t.findIndex(o=>o.id===e.id);if(ar(e,t[n]))return;n>-1&&t.splice(n,1);let s=0;for(;t[s]&&FT(t[s],e);)s++;t.splice(s,0,e)}_removeDescriptor(e){const t=this._stack,n=t.findIndex(s=>s.id===e);n>-1&&t.splice(n,1)}}F(Ad,oe);function ar(i,e){return i&&e&&i.priority==e.priority&&us(i.classes)==us(e.classes)}function FT(i,e){return i.priority>e.priority?!0:i.priority<e.priority?!1:us(i.classes)>us(e.classes)}function us(i){return Array.isArray(i)?i.sort().join(","):i}var LT='<svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M4 0v1H1v3H0V.5A.5.5 0 0 1 .5 0H4zm8 0h3.5a.5.5 0 0 1 .5.5V4h-1V1h-3V0zM4 16H.5a.5.5 0 0 1-.5-.5V12h1v3h3v1zm8 0v-1h3v-3h1v3.5a.5.5 0 0 1-.5.5H12z"/><path fill-opacity=".256" d="M1 1h14v14H1z"/><g class="ck-icon__selected-indicator"><path d="M7 0h2v1H7V0zM0 7h1v2H0V7zm15 0h1v2h-1V7zm-8 8h2v1H7v-1z"/><path fill-opacity=".254" d="M1 1h14v14H1z"/></g></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const zT="ck-widget",Sd="ck-widget_selected";function we(i){return i.is("element")?!!i.getCustomProperty("widget"):!1}function lr(i,e,t={}){if(!i.is("containerElement"))throw new p("widget-to-widget-wrong-element-type",null,{element:i});return e.setAttribute("contenteditable","false",i),e.addClass(zT,i),e.setCustomProperty("widget",!0,i),i.getFillerOffset=qT,t.label&&UT(i,t.label,e),t.hasSelectionHandle&&jT(i,e),xd(i,e),i}function $T(i,e,t){if(e.classes&&t.addClass(Ee(e.classes),i),e.attributes)for(const n in e.attributes)t.setAttribute(n,e.attributes[n],i)}function HT(i,e,t){if(e.classes&&t.removeClass(Ee(e.classes),i),e.attributes)for(const n in e.attributes)t.removeAttribute(n,i)}function xd(i,e,t=$T,n=HT){const s=new Ad;s.on("change:top",(o,r)=>{r.oldDescriptor&&n(i,r.oldDescriptor,r.writer),r.newDescriptor&&t(i,r.newDescriptor,r.writer)}),e.setCustomProperty("addHighlight",(o,r,a)=>s.add(r,a),i),e.setCustomProperty("removeHighlight",(o,r,a)=>s.remove(r,a),i)}function UT(i,e,t){t.setCustomProperty("widgetLabel",e,i)}function WT(i){const e=i.getCustomProperty("widgetLabel");return e?typeof e=="function"?e():e:""}function cr(i,e){return e.addClass(["ck-editor__editable","ck-editor__nested-editable"],i),e.setAttribute("contenteditable",i.isReadOnly?"false":"true",i),i.on("change:isReadOnly",(t,n,s)=>{e.setAttribute("contenteditable",s?"false":"true",i)}),i.on("change:isFocused",(t,n,s)=>{s?e.addClass("ck-editor__nested-editable_focused",i):e.removeClass("ck-editor__nested-editable_focused",i)}),xd(i,e),i}function Rn(i,e){const t=i.getSelectedElement();if(t){const s=cn(i);if(s)return e.createRange(e.createPositionAt(t,s));if(e.schema.isObject(t)&&!e.schema.isInline(t))return e.createRangeOn(t)}const n=i.getSelectedBlocks().next().value;if(n){if(n.isEmpty)return e.createRange(e.createPositionAt(n,0));const s=e.createPositionAfter(n);return i.focus.isTouching(s)?e.createRange(s):e.createRange(e.createPositionBefore(n))}return e.createRange(i.focus)}function qT(){return null}function jT(i,e){const t=e.createUIElement("div",{class:"ck ck-widget__selection-handle"},function(n){const s=this.toDomElement(n),o=new is;return o.set("content",LT),o.render(),s.appendChild(o.element),s});e.insert(e.createPositionAt(i,0),t),e.addClass(["ck-widget_with-selection-handle"],i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Rt="widget-type-around";function ln(i,e,t){return i&&we(i)&&!t.isInline(e)}function KT(i){return i.closest(".ck-widget__type-around__button")}function GT(i){return i.classList.contains("ck-widget__type-around__button_before")?"before":"after"}function JT(i,e){const t=i.closest(".ck-widget");return e.mapDomToView(t)}function cn(i){return i.getAttribute(Rt)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function QT(i){let e=null;const t=i.model,n=i.editing.view,s=i.commands.get("input");ae.isAndroid?n.document.on("beforeinput",(l,c)=>o(c),{priority:"lowest"}):n.document.on("keydown",(l,c)=>o(c),{priority:"lowest"}),n.document.on("compositionstart",r,{priority:"lowest"}),n.document.on("compositionend",()=>{e=t.createSelection(t.document.selection)},{priority:"lowest"});function o(l){if(ae.isWindows&&Ed(l,n.document))return;const c=t.document,u=n.document.isComposing,d=e&&e.isEqual(c.selection);e=null,!!s.isEnabled&&(Id(l)||c.selection.isCollapsed||u&&l.keyCode===229||!u&&l.keyCode===229&&d||a())}function r(){const l=t.document,c=l.selection.rangeCount===1?l.selection.getFirstRange().isFlat:!0;l.selection.isCollapsed||c||a()}function a(){const l=s.buffer;l.lock();const c=l.batch;s._batches.add(c),t.enqueueChange(c,()=>{t.deleteContent(t.document.selection)}),l.unlock()}}const Pd=[dt("arrowUp"),dt("arrowRight"),dt("arrowDown"),dt("arrowLeft"),9,16,17,18,19,20,27,33,34,35,36,45,91,93,144,145,173,174,175,176,177,178,179,255];for(let i=112;i<=135;i++)Pd.push(i);function Id(i){return i.ctrlKey||i.metaKey?!0:Pd.includes(i.keyCode)}var YT='<svg viewBox="0 0 10 8" xmlns="http://www.w3.org/2000/svg"><path d="M9.055.263v3.972h-6.77M1 4.216l2-2.038m-2 2 2 2.038"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Rd=["before","after"],XT=new DOMParser().parseFromString(YT,"image/svg+xml").firstChild,Md="ck-widget__type-around_disabled";class ZT extends P{static get pluginName(){return"WidgetTypeAround"}static get requires(){return[cs,zt]}constructor(e){super(e);this._currentFakeCaretModelElement=null}init(){const e=this.editor,t=e.editing.view;this.on("change:isEnabled",(n,s,o)=>{t.change(r=>{for(const a of t.document.roots)o?r.removeClass(Md,a):r.addClass(Md,a)}),o||e.model.change(r=>{r.removeSelectionAttribute(Rt)})}),this._enableTypeAroundUIInjection(),this._enableInsertingParagraphsOnButtonClick(),this._enableInsertingParagraphsOnEnterKeypress(),this._enableInsertingParagraphsOnTypingKeystroke(),this._enableTypeAroundFakeCaretActivationUsingKeyboardArrows(),this._enableDeleteIntegration(),this._enableInsertContentIntegration(),this._enableDeleteContentIntegration()}destroy(){this._currentFakeCaretModelElement=null}_insertParagraph(e,t){const n=this.editor,s=n.editing.view;n.execute("insertParagraph",{position:n.model.createPositionAt(e,t)}),s.focus(),s.scrollToTheSelection()}_listenToIfEnabled(e,t,n,s){this.listenTo(e,t,(...o)=>{this.isEnabled&&n(...o)},s)}_insertParagraphAccordingToFakeCaretPosition(){const n=this.editor.model.document.selection,s=cn(n);if(!s)return!1;const o=n.getSelectedElement();return this._insertParagraph(o,s),!0}_enableTypeAroundUIInjection(){const e=this.editor,t=e.model.schema,n=e.locale.t,s={before:n("Insert paragraph before block"),after:n("Insert paragraph after block")};e.editing.downcastDispatcher.on("insert",(o,r,a)=>{const l=a.mapper.toViewElement(r.item);ln(l,r.item,t)&&eE(a.writer,s,l)},{priority:"low"})}_enableTypeAroundFakeCaretActivationUsingKeyboardArrows(){const e=this.editor,t=e.model,n=t.document.selection,s=t.schema,o=e.editing.view;this._listenToIfEnabled(o.document,"arrowKey",(a,l)=>{this._handleArrowKeyPress(a,l)},{context:[we,"$text"],priority:"high"}),this._listenToIfEnabled(n,"change:range",(a,l)=>{!l.directChange||e.model.change(c=>{c.removeSelectionAttribute(Rt)})}),this._listenToIfEnabled(t.document,"change:data",()=>{const a=n.getSelectedElement();if(a){const l=e.editing.mapper.toViewElement(a);if(ln(l,a,s))return}e.model.change(l=>{l.removeSelectionAttribute(Rt)})}),this._listenToIfEnabled(e.editing.downcastDispatcher,"selection",(a,l,c)=>{const u=c.writer;if(this._currentFakeCaretModelElement){const _=c.mapper.toViewElement(this._currentFakeCaretModelElement);_&&(u.removeClass(Rd.map(r),_),this._currentFakeCaretModelElement=null)}const d=l.selection.getSelectedElement();if(!d)return;const f=c.mapper.toViewElement(d);if(!ln(f,d,s))return;const b=cn(l.selection);!b||(u.addClass(r(b),f),this._currentFakeCaretModelElement=d)}),this._listenToIfEnabled(e.ui.focusTracker,"change:isFocused",(a,l,c)=>{c||e.model.change(u=>{u.removeSelectionAttribute(Rt)})});function r(a){return`ck-widget_type-around_show-fake-caret_${a}`}}_handleArrowKeyPress(e,t){const n=this.editor,s=n.model,o=s.document.selection,r=s.schema,a=n.editing.view,l=t.keyCode,c=i0(l,n.locale.contentLanguageDirection),u=a.document.selection.getSelectedElement(),d=n.editing.mapper.toModelElement(u);let f;ln(u,d,r)?f=this._handleArrowKeyPressOnSelectedWidget(c):o.isCollapsed?f=this._handleArrowKeyPressWhenSelectionNextToAWidget(c):t.shiftKey||(f=this._handleArrowKeyPressWhenNonCollapsedSelection(c)),f&&(t.preventDefault(),e.stop())}_handleArrowKeyPressOnSelectedWidget(e){const n=this.editor.model,s=n.document.selection,o=cn(s);return n.change(r=>{if(o){if(!(o===(e?"after":"before")))return r.removeSelectionAttribute(Rt),!0}else return r.setSelectionAttribute(Rt,e?"after":"before"),!0;return!1})}_handleArrowKeyPressWhenSelectionNextToAWidget(e){const t=this.editor,n=t.model,s=n.schema,o=t.plugins.get("Widget"),r=o._getObjectElementNextToSelection(e),a=t.editing.mapper.toViewElement(r);return ln(a,r,s)?(n.change(l=>{o._setSelectionOverElement(r),l.setSelectionAttribute(Rt,e?"before":"after")}),!0):!1}_handleArrowKeyPressWhenNonCollapsedSelection(e){const t=this.editor,n=t.model,s=n.schema,o=t.editing.mapper,r=n.document.selection,a=e?r.getLastPosition().nodeBefore:r.getFirstPosition().nodeAfter,l=o.toViewElement(a);return ln(l,a,s)?(n.change(c=>{c.setSelection(a,"on"),c.setSelectionAttribute(Rt,e?"after":"before")}),!0):!1}_enableInsertingParagraphsOnButtonClick(){const e=this.editor,t=e.editing.view;this._listenToIfEnabled(t.document,"mousedown",(n,s)=>{const o=KT(s.domTarget);if(!o)return;const r=GT(o),a=JT(o,t.domConverter),l=e.editing.mapper.toModelElement(a);this._insertParagraph(l,r),s.preventDefault(),n.stop()})}_enableInsertingParagraphsOnEnterKeypress(){const e=this.editor,t=e.model.document.selection,n=e.editing.view;this._listenToIfEnabled(n.document,"enter",(s,o)=>{if(s.eventPhase!="atTarget")return;const r=t.getSelectedElement(),a=e.editing.mapper.toViewElement(r),l=e.model.schema;let c;this._insertParagraphAccordingToFakeCaretPosition()?c=!0:ln(a,r,l)&&(this._insertParagraph(r,o.isSoft?"before":"after"),c=!0),c&&(o.preventDefault(),s.stop())},{context:we})}_enableInsertingParagraphsOnTypingKeystroke(){const t=this.editor.editing.view,n=[K.enter,K.delete,K.backspace];this._listenToIfEnabled(t.document,"keydown",(s,o)=>{!n.includes(o.keyCode)&&!Id(o)&&this._insertParagraphAccordingToFakeCaretPosition()},{priority:"high"})}_enableDeleteIntegration(){const e=this.editor,t=e.editing.view,n=e.model,s=n.schema;this._listenToIfEnabled(t.document,"delete",(o,r)=>{if(o.eventPhase!="atTarget")return;const a=cn(n.document.selection);if(!a)return;const l=r.direction,c=n.document.selection.getSelectedElement(),u=a==="before",d=l=="forward";if(u===d)e.execute("delete",{selection:n.createSelection(c,"on")});else{const b=s.getNearestSelectionRange(n.createPositionAt(c,a),l);if(b)if(!b.isCollapsed)n.change(_=>{_.setSelection(b),e.execute(d?"deleteForward":"delete")});else{const _=n.createSelection(b.start);if(n.modifySelection(_,{direction:l}),!_.focus.isEqual(b.start))n.change(C=>{C.setSelection(b),e.execute(d?"deleteForward":"delete")});else{const C=iE(s,b.start.parent);n.deleteContent(n.createSelection(C,"on"),{doNotAutoparagraph:!0})}}}r.preventDefault(),o.stop()},{context:we})}_enableInsertContentIntegration(){const e=this.editor,t=this.editor.model,n=t.document.selection;this._listenToIfEnabled(e.model,"insertContent",(s,[o,r])=>{if(r&&!r.is("documentSelection"))return;const a=cn(n);if(!!a)return s.stop(),t.change(l=>{const c=n.getSelectedElement(),u=t.createPositionAt(c,a),d=l.createSelection(u),f=t.insertContent(o,d);return l.setSelection(d),f})},{priority:"high"})}_enableDeleteContentIntegration(){const e=this.editor,n=this.editor.model.document.selection;this._listenToIfEnabled(e.model,"deleteContent",(s,[o])=>{if(o&&!o.is("documentSelection"))return;cn(n)&&s.stop()},{priority:"high"})}}function eE(i,e,t){const n=i.createUIElement("div",{class:"ck ck-reset_all ck-widget__type-around"},function(s){const o=this.toDomElement(s);return tE(o,e),nE(o),o});i.insert(i.createPositionAt(t,"end"),n)}function tE(i,e){for(const t of Rd){const n=new it({tag:"div",attributes:{class:["ck","ck-widget__type-around__button",`ck-widget__type-around__button_${t}`],title:e[t]},children:[i.ownerDocument.importNode(XT,!0)]});i.appendChild(n.render())}}function nE(i){const e=new it({tag:"div",attributes:{class:["ck","ck-widget__type-around__fake-caret"]}});i.appendChild(e.render())}function iE(i,e){let t=e;for(const n of e.getAncestors({parentFirst:!0})){if(n.childCount>1||i.isLimit(n))break;t=n}return t}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function sE(i){const e=i.model;return(t,n)=>{const s=n.keyCode==K.arrowup,o=n.keyCode==K.arrowdown,r=n.shiftKey,a=e.document.selection;if(!s&&!o)return;const l=o;if(r&&aE(a,l))return;const c=oE(i,a,l);if(!!c){if(c.isCollapsed){if(a.isCollapsed)return;if(r)return}(c.isCollapsed||rE(i,c,l))&&(e.change(u=>{const d=l?c.end:c.start;if(r){const f=e.createSelection(a.anchor);f.setFocus(d),u.setSelection(f)}else u.setSelection(d)}),t.stop(),n.preventDefault(),n.stopPropagation())}}}function oE(i,e,t){const n=i.model;if(t){const s=e.isCollapsed?e.focus:e.getLastPosition(),o=Vd(n,s,"forward");if(!o)return null;const r=n.createRange(s,o),a=Od(n.schema,r,"backward");return a?n.createRange(s,a):null}else{const s=e.isCollapsed?e.focus:e.getFirstPosition(),o=Vd(n,s,"backward");if(!o)return null;const r=n.createRange(o,s),a=Od(n.schema,r,"forward");return a?n.createRange(a,s):null}}function Vd(i,e,t){const n=i.schema,s=i.createRangeIn(e.root),o=t=="forward"?"elementStart":"elementEnd";for(const{previousPosition:r,item:a,type:l}of s.getWalker({startPosition:e,direction:t})){if(n.isLimit(a)&&!n.isInline(a))return r;if(l==o&&n.isBlock(a))return null}return null}function Od(i,e,t){const n=t=="backward"?e.end:e.start;if(i.checkChild(n,"$text"))return n;for(const{nextPosition:s}of e.getWalker({direction:t}))if(i.checkChild(s,"$text"))return s;return null}function rE(i,e,t){const n=i.model,s=i.view.domConverter;if(t){const c=n.createSelection(e.start);n.modifySelection(c),!c.focus.isAtEnd&&!e.start.isEqual(c.focus)&&(e=n.createRange(c.focus,e.end))}const o=i.mapper.toViewRange(e),r=s.viewRangeToDom(o),a=te.getDomRangeRects(r);let l;for(const c of a){if(l===void 0){l=Math.round(c.bottom);continue}if(Math.round(c.top)>=l)return!1;l=Math.max(l,Math.round(c.bottom))}return!0}function aE(i,e){return!i.isCollapsed&&i.isBackward==e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Mn extends P{static get pluginName(){return"Widget"}static get requires(){return[ZT,zt]}init(){const e=this.editor,t=e.editing.view,n=t.document;this._previouslySelected=new Set,this.editor.editing.downcastDispatcher.on("selection",(s,o,r)=>{const a=r.writer,l=o.selection;if(l.isCollapsed)return;const c=l.getSelectedElement();if(!c)return;const u=e.editing.mapper.toViewElement(c);!we(u)||!r.consumable.consume(l,"selection")||a.setSelection(a.createRangeOn(u),{fake:!0,label:WT(u)})}),this.editor.editing.downcastDispatcher.on("selection",(s,o,r)=>{this._clearPreviouslySelectedWidgets(r.writer);const a=r.writer,l=a.document.selection;let c=null;for(const u of l.getRanges())for(const d of u){const f=d.item;we(f)&&!cE(f,c)&&(a.addClass(Sd,f),this._previouslySelected.add(f),c=f)}},{priority:"low"}),t.addObserver(ls),this.listenTo(n,"mousedown",(...s)=>this._onMousedown(...s)),this.listenTo(n,"arrowKey",(...s)=>{this._handleSelectionChangeOnArrowKeyPress(...s)},{context:[we,"$text"]}),this.listenTo(n,"arrowKey",(...s)=>{this._preventDefaultOnArrowKeyPress(...s)},{context:"$root"}),this.listenTo(n,"arrowKey",sE(this.editor.editing),{context:"$text"}),this.listenTo(n,"delete",(s,o)=>{this._handleDelete(o.direction=="forward")&&(o.preventDefault(),s.stop())},{context:"$root"})}_onMousedown(e,t){const n=this.editor,s=n.editing.view,o=s.document;let r=t.target;if(lE(r)){if((ae.isSafari||ae.isGecko)&&t.domEvent.detail>=3){const l=n.editing.mapper,c=r.is("attributeElement")?r.findAncestor(d=>!d.is("attributeElement")):r,u=l.toModelElement(c);t.preventDefault(),this.editor.model.change(d=>{d.setSelection(u,"in")})}return}if(!we(r)&&(r=r.findAncestor(we),!r))return;ae.isAndroid&&t.preventDefault(),o.isFocused||s.focus();const a=n.editing.mapper.toModelElement(r);this._setSelectionOverElement(a)}_handleSelectionChangeOnArrowKeyPress(e,t){const n=t.keyCode,s=this.editor.model,o=s.schema,r=s.document.selection,a=r.getSelectedElement(),l=vo(n,this.editor.locale.contentLanguageDirection),c=l=="down"||l=="right",u=l=="up"||l=="down";if(a&&o.isObject(a)){const f=c?r.getLastPosition():r.getFirstPosition(),b=o.getNearestSelectionRange(f,c?"forward":"backward");b&&(s.change(_=>{_.setSelection(b)}),t.preventDefault(),e.stop());return}if(!r.isCollapsed&&!t.shiftKey){const f=r.getFirstPosition(),b=r.getLastPosition(),_=f.nodeAfter,C=b.nodeBefore;(_&&o.isObject(_)||C&&o.isObject(C))&&(s.change(A=>{A.setSelection(c?b:f)}),t.preventDefault(),e.stop());return}if(!r.isCollapsed)return;const d=this._getObjectElementNextToSelection(c);if(d&&o.isObject(d)){if(o.isInline(d)&&u)return;this._setSelectionOverElement(d),t.preventDefault(),e.stop()}}_preventDefaultOnArrowKeyPress(e,t){const n=this.editor.model,s=n.schema,o=n.document.selection.getSelectedElement();o&&s.isObject(o)&&(t.preventDefault(),e.stop())}_handleDelete(e){if(this.editor.isReadOnly)return;const n=this.editor.model.document.selection;if(!n.isCollapsed)return;const s=this._getObjectElementNextToSelection(e);if(s)return this.editor.model.change(o=>{let r=n.anchor.parent;for(;r.isEmpty;){const a=r;r=a.parent,o.remove(a)}this._setSelectionOverElement(s)}),!0}_setSelectionOverElement(e){this.editor.model.change(t=>{t.setSelection(t.createRangeOn(e))})}_getObjectElementNextToSelection(e){const t=this.editor.model,n=t.schema,s=t.document.selection,o=t.createSelection(s);if(t.modifySelection(o,{direction:e?"forward":"backward"}),o.isEqual(s))return null;const r=e?o.focus.nodeBefore:o.focus.nodeAfter;return!!r&&n.isObject(r)?r:null}_clearPreviouslySelectedWidgets(e){for(const t of this._previouslySelected)e.removeClass(Sd,t);this._previouslySelected.clear()}}function lE(i){for(;i;){if(i.is("editableElement")&&!i.is("rootElement"))return!0;if(we(i))return!1;i=i.parent}return!1}function cE(i,e){return e?Array.from(i.getAncestors()).includes(e):!1}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class uE extends P{static get pluginName(){return"DragDrop"}static get requires(){return[gt,Mn]}init(){const e=this.editor,t=e.editing.view;this._draggedRange=null,this._draggingUid="",this._draggableElement=null,this._updateDropMarkerThrottled=Wl(n=>this._updateDropMarker(n),40),this._removeDropMarkerDelayed=Bd(()=>this._removeDropMarker(),40),this._clearDraggableAttributesDelayed=Bd(()=>this._clearDraggableAttributes(),40),t.addObserver(rr),t.addObserver(ls),this._setupDragging(),this._setupContentInsertionIntegration(),this._setupClipboardInputIntegration(),this._setupDropMarker(),this._setupDraggableAttributeHandling(),this.listenTo(e,"change:isReadOnly",(n,s,o)=>{o?this.forceDisabled("readOnlyMode"):this.clearForceDisabled("readOnlyMode")}),this.on("change:isEnabled",(n,s,o)=>{o||this._finalizeDragging(!1)}),ae.isAndroid&&this.forceDisabled("noAndroidSupport")}destroy(){return this._draggedRange&&(this._draggedRange.detach(),this._draggedRange=null),this._updateDropMarkerThrottled.cancel(),this._removeDropMarkerDelayed.cancel(),this._clearDraggableAttributesDelayed.cancel(),super.destroy()}_setupDragging(){const e=this.editor,t=e.model,n=t.document,s=e.editing.view,o=s.document;this.listenTo(o,"dragstart",(r,a)=>{const l=n.selection;if(a.target&&a.target.is("editableElement")){a.preventDefault();return}const c=a.target?Fd(a.target):null;if(c){const f=e.editing.mapper.toModelElement(c);this._draggedRange=mt.fromRange(t.createRangeOn(f)),e.plugins.has("WidgetToolbarRepository")&&e.plugins.get("WidgetToolbarRepository").forceDisabled("dragDrop")}else if(!o.selection.isCollapsed){const f=o.selection.getSelectedElement();(!f||!we(f))&&(this._draggedRange=mt.fromRange(l.getFirstRange()))}if(!this._draggedRange){a.preventDefault();return}this._draggingUid=rt(),a.dataTransfer.effectAllowed=this.isEnabled?"copyMove":"copy",a.dataTransfer.setData("application/ckeditor5-dragging-uid",this._draggingUid);const u=t.createSelection(this._draggedRange.toRange()),d=e.data.toView(t.getSelectedContent(u));o.fire("clipboardOutput",{dataTransfer:a.dataTransfer,content:d,method:r.name}),this.isEnabled||(this._draggedRange.detach(),this._draggedRange=null,this._draggingUid="")},{priority:"low"}),this.listenTo(o,"dragend",(r,a)=>{this._finalizeDragging(!a.dataTransfer.isCanceled&&a.dataTransfer.dropEffect=="move")},{priority:"low"}),this.listenTo(o,"dragenter",()=>{!this.isEnabled||s.focus()}),this.listenTo(o,"dragleave",()=>{this._removeDropMarkerDelayed()}),this.listenTo(o,"dragging",(r,a)=>{if(!this.isEnabled){a.dataTransfer.dropEffect="none";return}this._removeDropMarkerDelayed.cancel();const l=Nd(e,a.targetRanges,a.target);this._draggedRange||(a.dataTransfer.dropEffect="copy"),ae.isGecko||(a.dataTransfer.effectAllowed=="copy"?a.dataTransfer.dropEffect="copy":["all","copyMove"].includes(a.dataTransfer.effectAllowed)&&(a.dataTransfer.dropEffect="move")),l&&this._updateDropMarkerThrottled(l)},{priority:"low"})}_setupClipboardInputIntegration(){const e=this.editor,n=e.editing.view.document;this.listenTo(n,"clipboardInput",(s,o)=>{if(o.method!="drop")return;const r=Nd(e,o.targetRanges,o.target);if(this._removeDropMarker(),!r){this._finalizeDragging(!1),s.stop();return}if(this._draggedRange&&this._draggingUid!=o.dataTransfer.getData("application/ckeditor5-dragging-uid")&&(this._draggedRange.detach(),this._draggedRange=null,this._draggingUid=""),Dd(o.dataTransfer)=="move"&&this._draggedRange&&this._draggedRange.containsRange(r,!0)){this._finalizeDragging(!1),s.stop();return}o.targetRanges=[e.editing.mapper.toViewRange(r)]},{priority:"high"})}_setupContentInsertionIntegration(){const e=this.editor.plugins.get(gt);e.on("contentInsertion",(t,n)=>{if(!this.isEnabled||n.method!=="drop")return;const s=n.targetRanges.map(o=>this.editor.editing.mapper.toModelRange(o));this.editor.model.change(o=>o.setSelection(s))},{priority:"high"}),e.on("contentInsertion",(t,n)=>{if(!this.isEnabled||n.method!=="drop")return;const s=Dd(n.dataTransfer)=="move",o=!n.resultRange||!n.resultRange.isCollapsed;this._finalizeDragging(o&&s)},{priority:"lowest"})}_setupDraggableAttributeHandling(){const e=this.editor,t=e.editing.view,n=t.document;this.listenTo(n,"mousedown",(s,o)=>{if(ae.isAndroid||!o)return;this._clearDraggableAttributesDelayed.cancel();let r=Fd(o.target);if(ae.isBlink&&!e.isReadOnly&&!r&&!n.selection.isCollapsed){const a=n.selection.getSelectedElement();(!a||!we(a))&&(r=n.selection.editableElement)}r&&(t.change(a=>{a.setAttribute("draggable","true",r)}),this._draggableElement=e.editing.mapper.toModelElement(r))}),this.listenTo(n,"mouseup",()=>{ae.isAndroid||this._clearDraggableAttributesDelayed()})}_clearDraggableAttributes(){const e=this.editor.editing;e.view.change(t=>{this._draggableElement&&this._draggableElement.root.rootName!="$graveyard"&&t.removeAttribute("draggable",e.mapper.toViewElement(this._draggableElement)),this._draggableElement=null})}_setupDropMarker(){const e=this.editor;e.conversion.for("editingDowncast").markerToHighlight({model:"drop-target",view:{classes:["ck-clipboard-drop-target-range"]}}),e.conversion.for("editingDowncast").markerToElement({model:"drop-target",view:(t,{writer:n})=>{if(!!e.model.schema.checkChild(t.markerRange.start,"$text"))return n.createUIElement("span",{class:"ck ck-clipboard-drop-target-position"},function(o){const r=this.toDomElement(o);return r.innerHTML="&NoBreak;<span></span>&NoBreak;",r})}})}_updateDropMarker(e){const t=this.editor,n=t.model.markers;t.model.change(s=>{n.has("drop-target")?n.get("drop-target").getRange().isEqual(e)||s.updateMarker("drop-target",{range:e}):s.addMarker("drop-target",{range:e,usingOperation:!1,affectsData:!1})})}_removeDropMarker(){const e=this.editor.model;this._removeDropMarkerDelayed.cancel(),this._updateDropMarkerThrottled.cancel(),e.markers.has("drop-target")&&e.change(t=>{t.removeMarker("drop-target")})}_finalizeDragging(e){const t=this.editor,n=t.model;this._removeDropMarker(),this._clearDraggableAttributes(),t.plugins.has("WidgetToolbarRepository")&&t.plugins.get("WidgetToolbarRepository").clearForceDisabled("dragDrop"),this._draggingUid="",!!this._draggedRange&&(e&&this.isEnabled&&n.deleteContent(n.createSelection(this._draggedRange),{doNotAutoparagraph:!0}),this._draggedRange.detach(),this._draggedRange=null)}}function Nd(i,e,t){const n=i.model,s=i.editing.mapper;let o=null;const r=e?e[0].start:null;if(t.is("uiElement")&&(t=t.parent),o=dE(i,t),o)return o;const a=gE(i,t),l=r?s.toModelPosition(r):null;return l?(o=fE(i,l,a),o||(o=n.schema.getNearestSelectionRange(l,ae.isGecko?"forward":"backward"),o)?o:mE(i,l.parent)):hE(i,a)}function dE(i,e){const t=i.model,n=i.editing.mapper;if(we(e))return t.createRangeOn(n.toModelElement(e));if(!e.is("editableElement")){const s=e.findAncestor(o=>we(o)||o.is("editableElement"));if(we(s))return t.createRangeOn(n.toModelElement(s))}return null}function hE(i,e){const t=i.model,n=t.schema,s=t.createPositionAt(e,0);return n.getNearestSelectionRange(s,"forward")}function fE(i,e,t){const n=i.model;if(!n.schema.checkChild(t,"$block"))return null;const s=n.createPositionAt(t,0),o=e.path.slice(0,s.path.length),a=n.createPositionFromPath(e.root,o).nodeAfter;return a&&n.schema.isObject(a)?n.createRangeOn(a):null}function mE(i,e){const t=i.model;for(;e;){if(t.schema.isObject(e))return t.createRangeOn(e);e=e.parent}}function gE(i,e){const t=i.editing.mapper,n=i.editing.view,s=t.toModelElement(e);if(s)return s;const o=n.createPositionBefore(e),r=t.findMappedViewAncestor(o);return t.toModelElement(r)}function Dd(i){return ae.isGecko?i.dropEffect:["all","copyMove"].includes(i.effectAllowed)?"move":"copy"}function Bd(i,e){let t;function n(...s){n.cancel(),t=setTimeout(()=>i(...s),e)}return n.cancel=()=>{clearTimeout(t)},n}function Fd(i){if(i.is("editableElement"))return null;if(i.hasClass("ck-widget__selection-handle"))return i.findAncestor(we);if(we(i))return i;const e=i.findAncestor(t=>we(t)||t.is("editableElement"));return we(e)?e:null}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class pE extends P{static get pluginName(){return"PastePlainText"}static get requires(){return[gt]}init(){const e=this.editor,t=e.model,n=e.editing.view,s=n.document,o=t.document.selection;let r=!1;n.addObserver(rr),this.listenTo(s,"keydown",(a,l)=>{r=l.shiftKey}),e.plugins.get(gt).on("contentInsertion",(a,l)=>{!r&&!wE(l.content,t.schema)||t.change(c=>{const u=Array.from(o.getAttributes()).filter(([f])=>t.schema.getAttributeProperties(f).isFormatting);o.isCollapsed||t.deleteContent(o,{doNotAutoparagraph:!0}),u.push(...o.getAttributes());const d=c.createRangeIn(l.content);for(const f of d.getItems())f.is("$textProxy")&&c.setAttributes(u,f)})})}}function wE(i,e){if(i.childCount>1)return!1;const t=i.getChild(0);return e.isObject(t)?!1:[...t.getAttributeKeys()].length==0}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ld extends P{static get pluginName(){return"Clipboard"}static get requires(){return[gt,uE,pE]}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class bE extends q{execute(){const e=this.editor.model,t=e.document;e.change(n=>{vE(e,n,t.selection),this.fire("afterExecute",{writer:n})})}refresh(){const e=this.editor.model,t=e.document;this.isEnabled=_E(e.schema,t.selection)}}function _E(i,e){if(e.rangeCount>1)return!1;const t=e.anchor;if(!t||!i.checkChild(t,"softBreak"))return!1;const n=e.getFirstRange(),s=n.start.parent,o=n.end.parent;return!((ur(s,i)||ur(o,i))&&s!==o)}function vE(i,e,t){const n=t.isCollapsed,s=t.getFirstRange(),o=s.start.parent,r=s.end.parent,a=o==r;if(n){const l=_d(i.schema,t.getAttributes());zd(i,e,s.end),e.removeSelectionAttribute(t.getAttributeKeys()),e.setSelectionAttribute(l)}else{const l=!(s.start.isAtStart&&s.end.isAtEnd);i.deleteContent(t,{leaveUnmerged:l}),a?zd(i,e,t.focus):l&&e.setSelection(r,0)}}function zd(i,e,t){const n=e.createElement("softBreak");i.insertContent(n,t),e.setSelection(n,"after")}function ur(i,e){return i.is("rootElement")?!1:e.isLimit(i)||ur(i.parent,e)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class yE extends P{static get pluginName(){return"ShiftEnter"}init(){const e=this.editor,t=e.model.schema,n=e.conversion,s=e.editing.view,o=s.document;t.register("softBreak",{allowWhere:"$text",isInline:!0}),n.for("upcast").elementToElement({model:"softBreak",view:"br"}),n.for("downcast").elementToElement({model:"softBreak",view:(r,{writer:a})=>a.createEmptyElement("br")}),s.addObserver(yd),e.commands.add("shiftEnter",new bE(e)),this.listenTo(o,"enter",(r,a)=>{a.preventDefault(),!!a.isSoft&&(e.execute("shiftEnter"),s.scrollToTheSelection())},{priority:"low"})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class CE extends q{constructor(e){super(e);this.affectsData=!1}execute(){const e=this.editor.model,t=e.document.selection;let n=e.schema.getLimitElement(t);if(t.containsEntireContent(n)||!$d(e.schema,n))do if(n=n.parent,!n)return;while(!$d(e.schema,n));e.change(s=>{s.setSelection(n,"in")})}}function $d(i,e){return i.isLimit(e)&&(i.checkChild(e,"$text")||i.checkChild(e,"paragraph"))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const kE=_o("Ctrl+A");class TE extends P{static get pluginName(){return"SelectAllEditing"}init(){const e=this.editor,n=e.editing.view.document;e.commands.add("selectAll",new CE(e)),this.listenTo(n,"keydown",(s,o)=>{dt(o)===kE&&(e.execute("selectAll"),o.preventDefault())})}}var EE='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M.75 15.5a.75.75 0 0 1 .75.75V18l.008.09A.5.5 0 0 0 2 18.5h1.75a.75.75 0 1 1 0 1.5H1.5l-.144-.007a1.5 1.5 0 0 1-1.35-1.349L0 18.5v-2.25a.75.75 0 0 1 .75-.75zm18.5 0a.75.75 0 0 1 .75.75v2.25l-.007.144a1.5 1.5 0 0 1-1.349 1.35L18.5 20h-2.25a.75.75 0 1 1 0-1.5H18a.5.5 0 0 0 .492-.41L18.5 18v-1.75a.75.75 0 0 1 .75-.75zm-10.45 3c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2H7.2a.2.2 0 0 1-.2-.2v-1.1c0-.11.09-.2.2-.2h1.6zm4 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2h-1.6a.2.2 0 0 1-.2-.2v-1.1c0-.11.09-.2.2-.2h1.6zm.45-5.5a.75.75 0 1 1 0 1.5h-8.5a.75.75 0 1 1 0-1.5h8.5zM1.3 11c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2H.2a.2.2 0 0 1-.2-.2v-1.6c0-.11.09-.2.2-.2h1.1zm18.5 0c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2h-1.1a.2.2 0 0 1-.2-.2v-1.6c0-.11.09-.2.2-.2h1.1zm-4.55-2a.75.75 0 1 1 0 1.5H4.75a.75.75 0 1 1 0-1.5h10.5zM1.3 7c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2H.2a.2.2 0 0 1-.2-.2V7.2c0-.11.09-.2.2-.2h1.1zm18.5 0c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2h-1.1a.2.2 0 0 1-.2-.2V7.2c0-.11.09-.2.2-.2h1.1zm-4.55-2a.75.75 0 1 1 0 1.5h-2.5a.75.75 0 1 1 0-1.5h2.5zm-5 0a.75.75 0 1 1 0 1.5h-5.5a.75.75 0 0 1 0-1.5h5.5zm-6.5-5a.75.75 0 0 1 0 1.5H2a.5.5 0 0 0-.492.41L1.5 2v1.75a.75.75 0 0 1-1.5 0V1.5l.007-.144A1.5 1.5 0 0 1 1.356.006L1.5 0h2.25zM18.5 0l.144.007a1.5 1.5 0 0 1 1.35 1.349L20 1.5v2.25a.75.75 0 1 1-1.5 0V2l-.008-.09A.5.5 0 0 0 18 1.5h-1.75a.75.75 0 1 1 0-1.5h2.25zM8.8 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2H7.2a.2.2 0 0 1-.2-.2V.2c0-.11.09-.2.2-.2h1.6zm4 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2h-1.6a.2.2 0 0 1-.2-.2V.2c0-.11.09-.2.2-.2h1.6z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class AE extends P{static get pluginName(){return"SelectAllUI"}init(){const e=this.editor;e.ui.componentFactory.add("selectAll",t=>{const n=e.commands.get("selectAll"),s=new le(t),o=t.t;return s.set({label:o("Select all"),icon:EE,keystroke:"Ctrl+A",tooltip:!0}),s.bind("isOn","isEnabled").to(n,"value","isEnabled"),this.listenTo(s,"execute",()=>{e.execute("selectAll"),e.editing.view.focus()}),s})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class SE extends P{static get requires(){return[TE,AE]}static get pluginName(){return"SelectAll"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class xE extends q{constructor(e,t){super(e);this._buffer=new Cd(e.model,t),this._batches=new WeakSet}get buffer(){return this._buffer}destroy(){super.destroy(),this._buffer.destroy()}execute(e={}){const t=this.editor.model,n=t.document,s=e.text||"",o=s.length,r=e.range?t.createSelection(e.range):n.selection,a=e.resultRange;t.enqueueChange(this._buffer.batch,l=>{this._buffer.lock(),this._batches.add(this._buffer.batch),t.deleteContent(r),s&&t.insertContent(l.createText(s,n.selection.getAttributes()),r),a?l.setSelection(a):r.is("documentSelection")||l.setSelection(r),this._buffer.unlock(),this._buffer.input(o)})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function PE(i){i.editing.view.document.on("mutations",(e,t,n)=>{new IE(i).handle(t,n)})}class IE{constructor(e){this.editor=e,this.editing=this.editor.editing}handle(e,t){if(NT(e))this._handleContainerChildrenMutations(e,t);else for(const n of e)this._handleTextMutation(n,t),this._handleTextNodeInsertion(n)}_handleContainerChildrenMutations(e,t){const n=RE(e);if(!n)return;const o=this.editor.editing.view.domConverter.mapViewToDom(n),r=new qi(this.editor.editing.view.document),a=this.editor.data.toModel(r.domToView(o)).getChild(0),l=this.editor.editing.mapper.toModelElement(n);if(!l)return;const c=Array.from(a.getChildren()),u=Array.from(l.getChildren()),d=c[c.length-1],f=u[u.length-1],b=d&&d.is("element","softBreak"),_=f&&!f.is("element","softBreak");b&&_&&c.pop();const C=this.editor.model.schema;if(!Hd(c,C)||!Hd(u,C))return;const A=c.map(X=>X.is("$text")?X.data:"@").join("").replace(/\u00A0/g," "),R=u.map(X=>X.is("$text")?X.data:"@").join("").replace(/\u00A0/g," ");if(R===A)return;const O=Bt(R,A),{firstChangeAt:U,insertions:Q,deletions:se}=Ud(O);let N=null;t&&(N=this.editing.mapper.toModelRange(t.getFirstRange()));const B=A.substr(U,Q),D=this.editor.model.createRange(this.editor.model.createPositionAt(l,U),this.editor.model.createPositionAt(l,U+se));this.editor.execute("input",{text:B,range:D,resultRange:N})}_handleTextMutation(e,t){if(e.type!="text")return;const n=e.newText.replace(/\u00A0/g," "),s=e.oldText.replace(/\u00A0/g," ");if(s===n)return;const o=Bt(s,n),{firstChangeAt:r,insertions:a,deletions:l}=Ud(o);let c=null;t&&(c=this.editing.mapper.toModelRange(t.getFirstRange()));const u=this.editing.view.createPositionAt(e.node,r),d=this.editing.mapper.toModelPosition(u),f=this.editor.model.createRange(d,d.getShiftedBy(l)),b=n.substr(r,a);this.editor.execute("input",{text:b,range:f,resultRange:c})}_handleTextNodeInsertion(e){if(e.type!="children")return;const t=Td(e),n=this.editing.view.createPositionAt(e.node,t.index),s=this.editing.mapper.toModelPosition(n),o=t.values[0].data;this.editor.execute("input",{text:o.replace(/\u00A0/g," "),range:this.editor.model.createRange(s)})}}function RE(i){const e=i.map(t=>t.node).reduce((t,n)=>t.getCommonAncestor(n,{includeSelf:!0}));if(!!e)return e.getAncestors({includeSelf:!0,parentFirst:!0}).find(t=>t.is("containerElement")||t.is("rootElement"))}function Hd(i,e){return i.every(t=>e.isInline(t))}function Ud(i){let e=null,t=null;for(let o=0;o<i.length;o++)i[o]!="equal"&&(e=e===null?o:e,t=o);let n=0,s=0;for(let o=e;o<=t;o++)i[o]!="insert"&&n++,i[o]!="delete"&&s++;return{insertions:s,deletions:n,firstChangeAt:e}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Wd extends P{static get pluginName(){return"Input"}init(){const e=this.editor,t=new xE(e,e.config.get("typing.undoStep")||20);e.commands.add("input",t),QT(e),PE(e)}isInput(e){return this.editor.commands.get("input")._batches.has(e)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ME extends P{static get requires(){return[Wd,zt]}static get pluginName(){return"Typing"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function qd(i,e){let t=i.start;return{text:Array.from(i.getItems()).reduce((s,o)=>o.is("$text")||o.is("$textProxy")?s+o.data:(t=e.createPositionAfter(o),""),""),range:e.createRange(t,i.end)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class dr{constructor(e,t){this.model=e,this.testCallback=t,this.hasMatch=!1,this.set("isEnabled",!0),this.on("change:isEnabled",()=>{this.isEnabled?this._startListening():(this.stopListening(e.document.selection),this.stopListening(e.document))}),this._startListening()}_startListening(){const t=this.model.document;this.listenTo(t.selection,"change:range",(n,{directChange:s})=>{if(!!s){if(!t.selection.isCollapsed){this.hasMatch&&(this.fire("unmatched"),this.hasMatch=!1);return}this._evaluateTextBeforeSelection("selection")}}),this.listenTo(t,"change:data",(n,s)=>{s.type!="transparent"&&this._evaluateTextBeforeSelection("data",{batch:s})})}_evaluateTextBeforeSelection(e,t={}){const n=this.model,o=n.document.selection,r=n.createRange(n.createPositionAt(o.focus.parent,0),o.focus),{text:a,range:l}=qd(r,n),c=this.testCallback(a);if(!c&&this.hasMatch&&this.fire("unmatched"),this.hasMatch=!!c,c){const u=Object.assign(t,{text:a,range:l});typeof c=="object"&&Object.assign(u,c),this.fire(`matched:${e}`,u)}}}F(dr,re);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ds extends P{static get pluginName(){return"TwoStepCaretMovement"}constructor(e){super(e);this.attributes=new Set,this._overrideUid=null}init(){const e=this.editor,t=e.model,n=e.editing.view,s=e.locale,o=t.document.selection;this.listenTo(n.document,"arrowKey",(r,a)=>{if(!o.isCollapsed||a.shiftKey||a.altKey||a.ctrlKey)return;const l=a.keyCode==K.arrowright,c=a.keyCode==K.arrowleft;if(!l&&!c)return;const u=s.contentLanguageDirection;let d=!1;u==="ltr"&&l||u==="rtl"&&c?d=this._handleForwardMovement(a):d=this._handleBackwardMovement(a),d===!0&&r.stop()},{context:"$text",priority:"highest"}),this._isNextGravityRestorationSkipped=!1,this.listenTo(o,"change:range",(r,a)=>{if(this._isNextGravityRestorationSkipped){this._isNextGravityRestorationSkipped=!1;return}!this._isGravityOverridden||!a.directChange&&fs(o.getFirstPosition(),this.attributes)||this._restoreGravity()})}registerAttribute(e){this.attributes.add(e)}_handleForwardMovement(e){const t=this.attributes,s=this.editor.model.document.selection,o=s.getFirstPosition();if(this._isGravityOverridden||o.isAtStart&&hr(s,t))return!1;if(fs(o,t))return hs(e),this._overrideGravity(),!0}_handleBackwardMovement(e){const t=this.attributes,n=this.editor.model,s=n.document.selection,o=s.getFirstPosition();if(this._isGravityOverridden)return hs(e),this._restoreGravity(),fr(n,t,o),!0;if(o.isAtStart)return hr(s,t)?(hs(e),fr(n,t,o),!0):!1;if(VE(o,t))return o.isAtEnd&&!hr(s,t)&&fs(o,t)?(hs(e),fr(n,t,o),!0):(this._isNextGravityRestorationSkipped=!0,this._overrideGravity(),!1)}get _isGravityOverridden(){return!!this._overrideUid}_overrideGravity(){this._overrideUid=this.editor.model.change(e=>e.overrideSelectionGravity())}_restoreGravity(){this.editor.model.change(e=>{e.restoreSelectionGravity(this._overrideUid),this._overrideUid=null})}}function hr(i,e){for(const t of e)if(i.hasAttribute(t))return!0;return!1}function fr(i,e,t){const n=t.nodeBefore;i.change(s=>{n?s.setSelectionAttribute(n.getAttributes()):s.removeSelectionAttribute(e)})}function hs(i){i.preventDefault()}function VE(i,e){const t=i.getShiftedBy(-1);return fs(t,e)}function fs(i,e){const{nodeBefore:t,nodeAfter:n}=i;for(const s of e){const o=t?t.getAttribute(s):void 0;if((n?n.getAttribute(s):void 0)!==o)return!0}return!1}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const OE={copyright:{from:"(c)",to:"\xA9"},registeredTrademark:{from:"(r)",to:"\xAE"},trademark:{from:"(tm)",to:"\u2122"},oneHalf:{from:/(^|[^/a-z0-9])(1\/2)([^/a-z0-9])$/i,to:[null,"\xBD",null]},oneThird:{from:/(^|[^/a-z0-9])(1\/3)([^/a-z0-9])$/i,to:[null,"\u2153",null]},twoThirds:{from:/(^|[^/a-z0-9])(2\/3)([^/a-z0-9])$/i,to:[null,"\u2154",null]},oneForth:{from:/(^|[^/a-z0-9])(1\/4)([^/a-z0-9])$/i,to:[null,"\xBC",null]},threeQuarters:{from:/(^|[^/a-z0-9])(3\/4)([^/a-z0-9])$/i,to:[null,"\xBE",null]},lessThanOrEqual:{from:"<=",to:"\u2264"},greaterThanOrEqual:{from:">=",to:"\u2265"},notEqual:{from:"!=",to:"\u2260"},arrowLeft:{from:"<-",to:"\u2190"},arrowRight:{from:"->",to:"\u2192"},horizontalEllipsis:{from:"...",to:"\u2026"},enDash:{from:/(^| )(--)( )$/,to:[null,"\u2013",null]},emDash:{from:/(^| )(---)( )$/,to:[null,"\u2014",null]},quotesPrimary:{from:Vn('"'),to:[null,"\u201C",null,"\u201D"]},quotesSecondary:{from:Vn("'"),to:[null,"\u2018",null,"\u2019"]},quotesPrimaryEnGb:{from:Vn("'"),to:[null,"\u2018",null,"\u2019"]},quotesSecondaryEnGb:{from:Vn('"'),to:[null,"\u201C",null,"\u201D"]},quotesPrimaryPl:{from:Vn('"'),to:[null,"\u201E",null,"\u201D"]},quotesSecondaryPl:{from:Vn("'"),to:[null,"\u201A",null,"\u2019"]}},jd={symbols:["copyright","registeredTrademark","trademark"],mathematical:["oneHalf","oneThird","twoThirds","oneForth","threeQuarters","lessThanOrEqual","greaterThanOrEqual","notEqual","arrowLeft","arrowRight"],typography:["horizontalEllipsis","enDash","emDash"],quotes:["quotesPrimary","quotesSecondary"]},NE=["symbols","mathematical","typography","quotes"];class DE extends P{static get requires(){return["Delete","Input"]}static get pluginName(){return"TextTransformation"}constructor(e){super(e);e.config.define("typing",{transformations:{include:NE}})}init(){const t=this.editor.model.document.selection;t.on("change:range",()=>{this.isEnabled=!t.anchor.parent.is("element","codeBlock")}),this._enableTransformationWatchers()}_enableTransformationWatchers(){const e=this.editor,t=e.model,n=e.plugins.get("Input"),s=e.plugins.get("Delete"),o=zE(e.config.get("typing.transformations")),r=c=>{for(const u of o)if(u.from.test(c))return{normalizedTransformation:u}},a=(c,u)=>{if(!n.isInput(u.batch))return;const{from:d,to:f}=u.normalizedTransformation,b=d.exec(u.text),_=f(b.slice(1)),C=u.range;let A=b.index;t.enqueueChange(R=>{for(let O=1;O<b.length;O++){const U=b[O],Q=_[O-1];if(Q==null){A+=U.length;continue}const se=C.start.getShiftedBy(A),N=t.createRange(se,se.getShiftedBy(U.length)),B=LE(se);t.insertContent(R.createText(Q,B),N),A+=Q.length}t.enqueueChange(()=>{s.requestUndoOnBackspace()})})},l=new dr(e.model,r);l.on("matched:data",a),l.bind("isEnabled").to(this)}}function BE(i){return typeof i=="string"?new RegExp(`(${n1(i)})$`):i}function FE(i){return typeof i=="string"?()=>[i]:i instanceof Array?()=>i:i}function LE(i){return(i.textNode?i.textNode:i.nodeAfter).getAttributes()}function Vn(i){return new RegExp(`(^|\\s)(${i})([^${i}]*)(${i})$`)}function zE(i){const e=i.extra||[],t=i.remove||[],n=o=>!t.includes(o),s=i.include.concat(e).filter(n);return $E(s).filter(n).map(o=>OE[o]||o).map(o=>({from:BE(o.from),to:FE(o.to)}))}function $E(i){const e=new Set;for(const t of i)if(jd[t])for(const n of jd[t])e.add(n);else e.add(t);return Array.from(e)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function On(i,e,t,n){return n.createRange(Kd(i,e,t,!0,n),Kd(i,e,t,!1,n))}function Kd(i,e,t,n,s){let o=i.textNode||(n?i.nodeBefore:i.nodeAfter),r=null;for(;o&&o.getAttribute(e)==t;)r=o,o=n?o.previousSibling:o.nextSibling;return r?s.createPositionAt(r,n?"before":"after"):i}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Gd(i,e,t,n){const s=i.editing.view,o=new Set;s.document.registerPostFixer(r=>{const a=i.model.document.selection;let l=!1;if(a.hasAttribute(e)){const c=On(a.getFirstPosition(),e,a.getAttribute(e),i.model),u=i.editing.mapper.toViewRange(c);for(const d of u.getItems())d.is("element",t)&&!d.hasClass(n)&&(r.addClass(n,d),o.add(d),l=!0)}return l}),i.conversion.for("editingDowncast").add(r=>{r.on("insert",a,{priority:"highest"}),r.on("remove",a,{priority:"highest"}),r.on("attribute",a,{priority:"highest"}),r.on("selection",a,{priority:"highest"});function a(){s.change(l=>{for(const c of o.values())l.removeClass(n,c),o.delete(c)})}})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Jd extends q{constructor(e){super(e);this._stack=[],this._createdBatches=new WeakSet,this.refresh(),this.listenTo(e.data,"set",(t,n)=>{n[1]=$({},n[1]);const s=n[1];s.batchType||(s.batchType="transparent")},{priority:"high"}),this.listenTo(e.data,"set",(t,n)=>{n[1].batchType==="transparent"&&this.clearStack()})}refresh(){this.isEnabled=this._stack.length>0}addBatch(e){const t=this.editor.model.document.selection,n={ranges:t.hasOwnRange?Array.from(t.getRanges()):[],isBackward:t.isBackward};this._stack.push({batch:e,selection:n}),this.refresh()}clearStack(){this._stack=[],this.refresh()}_restoreSelection(e,t,n){const s=this.editor.model,o=s.document,r=[],a=e.map(c=>c.getTransformedByOperations(n)),l=a.flat();for(const c of a){const u=c.filter(d=>d.root!=o.graveyard).filter(d=>!UE(d,l));!u.length||(HE(u),r.push(u[0]))}r.length&&s.change(c=>{c.setSelection(r,{backward:t})})}_undo(e,t){const n=this.editor.model,s=n.document;this._createdBatches.add(t);const o=e.operations.slice().filter(r=>r.isDocumentOperation);o.reverse();for(const r of o){const a=r.baseVersion+1,l=Array.from(s.history.getOperations(a)),u=vT([r.getReversed()],l,{useRelations:!0,document:this.editor.model.document,padWithNoOps:!1,forceWeakRemove:!0}).operationsA;for(const d of u)t.addOperation(d),n.applyOperation(d),s.history.setOperationAsUndone(r,d)}}}function HE(i){i.sort((e,t)=>e.start.isBefore(t.start)?-1:1);for(let e=1;e<i.length;e++){const n=i[e-1].getJoined(i[e],!0);n&&(e--,i.splice(e,2,n))}}function UE(i,e){return e.some(t=>t!==i&&t.containsRange(i,!0))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class WE extends Jd{execute(e=null){const t=e?this._stack.findIndex(o=>o.batch==e):this._stack.length-1,n=this._stack.splice(t,1)[0],s=this.editor.model.createBatch("transparent");this.editor.model.enqueueChange(s,()=>{this._undo(n.batch,s);const o=this.editor.model.document.history.getOperations(n.batch.baseVersion);this._restoreSelection(n.selection.ranges,n.selection.isBackward,o),this.fire("revert",n.batch,s)}),this.refresh()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class qE extends Jd{execute(){const e=this._stack.pop(),t=this.editor.model.createBatch("transparent");this.editor.model.enqueueChange(t,()=>{const s=e.batch.operations[e.batch.operations.length-1].baseVersion+1,o=this.editor.model.document.history.getOperations(s);this._restoreSelection(e.selection.ranges,e.selection.isBackward,o),this._undo(e.batch,t)}),this.refresh()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class jE extends P{static get pluginName(){return"UndoEditing"}constructor(e){super(e);this._batchRegistry=new WeakSet}init(){const e=this.editor;this._undoCommand=new WE(e),this._redoCommand=new qE(e),e.commands.add("undo",this._undoCommand),e.commands.add("redo",this._redoCommand),this.listenTo(e.model,"applyOperation",(t,n)=>{const s=n[0];if(!s.isDocumentOperation)return;const o=s.batch,r=this._redoCommand._createdBatches.has(o),a=this._undoCommand._createdBatches.has(o);this._batchRegistry.has(o)||o.type=="transparent"&&!r&&!a||(r?this._undoCommand.addBatch(o):a||(this._undoCommand.addBatch(o),this._redoCommand.clearStack()),this._batchRegistry.add(o))},{priority:"highest"}),this.listenTo(this._undoCommand,"revert",(t,n,s)=>{this._redoCommand.addBatch(s)}),e.keystrokes.set("CTRL+Z","undo"),e.keystrokes.set("CTRL+Y","redo"),e.keystrokes.set("CTRL+SHIFT+Z","redo")}}var Qd='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m5.042 9.367 2.189 1.837a.75.75 0 0 1-.965 1.149l-3.788-3.18a.747.747 0 0 1-.21-.284.75.75 0 0 1 .17-.945L6.23 4.762a.75.75 0 1 1 .964 1.15L4.863 7.866h8.917A.75.75 0 0 1 14 7.9a4 4 0 1 1-1.477 7.718l.344-1.489a2.5 2.5 0 1 0 1.094-4.73l.008-.032H5.042z"/></svg>',Yd='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m14.958 9.367-2.189 1.837a.75.75 0 0 0 .965 1.149l3.788-3.18a.747.747 0 0 0 .21-.284.75.75 0 0 0-.17-.945L13.77 4.762a.75.75 0 1 0-.964 1.15l2.331 1.955H6.22A.75.75 0 0 0 6 7.9a4 4 0 1 0 1.477 7.718l-.344-1.489A2.5 2.5 0 1 1 6.039 9.4l-.008-.032h8.927z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class KE extends P{static get pluginName(){return"UndoUI"}init(){const e=this.editor,t=e.locale,n=e.t,s=t.uiLanguageDirection=="ltr"?Qd:Yd,o=t.uiLanguageDirection=="ltr"?Yd:Qd;this._addButton("undo",n("Undo"),"CTRL+Z",s),this._addButton("redo",n("Redo"),"CTRL+Y",o)}_addButton(e,t,n,s){const o=this.editor;o.ui.componentFactory.add(e,r=>{const a=o.commands.get(e),l=new le(r);return l.set({label:t,icon:s,keystroke:n,tooltip:!0}),l.bind("isEnabled").to(a,"isEnabled"),this.listenTo(l,"execute",()=>{o.execute(e),o.editing.view.focus()}),l})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Xd extends P{static get requires(){return[jE,KE]}static get pluginName(){return"Undo"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class GE extends P{static get requires(){return[Ld,cs,SE,yE,ME,Xd]}static get pluginName(){return"Essentials"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Zd{constructor(){const e=new window.FileReader;this._reader=e,this._data=void 0,this.set("loaded",0),e.onprogress=t=>{this.loaded=t.loaded}}get error(){return this._reader.error}get data(){return this._data}read(e){const t=this._reader;return this.total=e.size,new Promise((n,s)=>{t.onload=()=>{const o=t.result;this._data=o,n(o)},t.onerror=()=>{s("error")},t.onabort=()=>{s("aborted")},this._reader.readAsDataURL(e)})}abort(){this._reader.abort()}}F(Zd,re);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class pt extends P{static get pluginName(){return"FileRepository"}static get requires(){return[es]}init(){this.loaders=new $e,this.loaders.on("add",()=>this._updatePendingAction()),this.loaders.on("remove",()=>this._updatePendingAction()),this._loadersMap=new Map,this._pendingAction=null,this.set("uploaded",0),this.set("uploadTotal",null),this.bind("uploadedPercent").to(this,"uploaded",this,"uploadTotal",(e,t)=>t?e/t*100:0)}getLoader(e){return this._loadersMap.get(e)||null}createLoader(e){if(!this.createUploadAdapter)return Re("filerepository-no-upload-adapter"),null;const t=new mr(Promise.resolve(e),this.createUploadAdapter);return this.loaders.add(t),this._loadersMap.set(e,t),e instanceof Promise&&t.file.then(n=>{this._loadersMap.set(n,t)}).catch(()=>{}),t.on("change:uploaded",()=>{let n=0;for(const s of this.loaders)n+=s.uploaded;this.uploaded=n}),t.on("change:uploadTotal",()=>{let n=0;for(const s of this.loaders)s.uploadTotal&&(n+=s.uploadTotal);this.uploadTotal=n}),t}destroyLoader(e){const t=e instanceof mr?e:this.getLoader(e);t._destroy(),this.loaders.remove(t),this._loadersMap.forEach((n,s)=>{n===t&&this._loadersMap.delete(s)})}_updatePendingAction(){const e=this.editor.plugins.get(es);if(this.loaders.length){if(!this._pendingAction){const t=this.editor.t,n=s=>`${t("Upload in progress")} ${parseInt(s)}%.`;this._pendingAction=e.add(n(this.uploadedPercent)),this._pendingAction.bind("message").to(this,"uploadedPercent",n)}}else e.remove(this._pendingAction),this._pendingAction=null}}F(pt,re);class mr{constructor(e,t){this.id=rt(),this._filePromiseWrapper=this._createFilePromiseWrapper(e),this._adapter=t(this),this._reader=new Zd,this.set("status","idle"),this.set("uploaded",0),this.set("uploadTotal",null),this.bind("uploadedPercent").to(this,"uploaded",this,"uploadTotal",(n,s)=>s?n/s*100:0),this.set("uploadResponse",null)}get file(){return this._filePromiseWrapper?this._filePromiseWrapper.promise.then(e=>this._filePromiseWrapper?e:null):Promise.resolve(null)}get data(){return this._reader.data}read(){if(this.status!="idle")throw new p("filerepository-read-wrong-status",this);return this.status="reading",this.file.then(e=>this._reader.read(e)).then(e=>{if(this.status!=="reading")throw this.status;return this.status="idle",e}).catch(e=>{throw e==="aborted"?(this.status="aborted","aborted"):(this.status="error",this._reader.error?this._reader.error:e)})}upload(){if(this.status!="idle")throw new p("filerepository-upload-wrong-status",this);return this.status="uploading",this.file.then(()=>this._adapter.upload()).then(e=>(this.uploadResponse=e,this.status="idle",e)).catch(e=>{throw this.status==="aborted"?"aborted":(this.status="error",e)})}abort(){const e=this.status;this.status="aborted",this._filePromiseWrapper.isFulfilled?e=="reading"?this._reader.abort():e=="uploading"&&this._adapter.abort&&this._adapter.abort():(this._filePromiseWrapper.promise.catch(()=>{}),this._filePromiseWrapper.rejecter("aborted")),this._destroy()}_destroy(){this._filePromiseWrapper=void 0,this._reader=void 0,this._adapter=void 0,this.uploadResponse=void 0}_createFilePromiseWrapper(e){const t={};return t.promise=new Promise((n,s)=>{t.rejecter=s,t.isFulfilled=!1,e.then(o=>{t.isFulfilled=!0,n(o)}).catch(o=>{t.isFulfilled=!0,s(o)})}),t}}F(mr,re);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class JE extends j{constructor(e){super(e);this.buttonView=new le(e),this._fileInputView=new QE(e),this._fileInputView.bind("acceptedType").to(this),this._fileInputView.bind("allowMultipleFiles").to(this),this._fileInputView.delegate("done").to(this),this.setTemplate({tag:"span",attributes:{class:"ck-file-dialog-button"},children:[this.buttonView,this._fileInputView]}),this.buttonView.on("execute",()=>{this._fileInputView.open()})}focus(){this.buttonView.focus()}}class QE extends j{constructor(e){super(e);this.set("acceptedType"),this.set("allowMultipleFiles",!1);const t=this.bindTemplate;this.setTemplate({tag:"input",attributes:{class:["ck-hidden"],type:"file",tabindex:"-1",accept:t.to("acceptedType"),multiple:t.to("allowMultipleFiles")},on:{change:t.to(()=>{this.element&&this.element.files&&this.element.files.length&&this.fire("done",this.element.files),this.element.value=""})}})}open(){this.element.click()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const eh="ckCsrfToken",th=40,nh="abcdefghijklmnopqrstuvwxyz0123456789";function YE(){let i=XE(eh);return(!i||i.length!=th)&&(i=eA(th),ZE(eh,i)),i}function XE(i){i=i.toLowerCase();const e=document.cookie.split(";");for(const t of e){const n=t.split("=");if(decodeURIComponent(n[0].trim().toLowerCase())===i)return decodeURIComponent(n[1])}return null}function ZE(i,e){document.cookie=encodeURIComponent(i)+"="+encodeURIComponent(e)+";path=/"}function eA(i){let e="";const t=new Uint8Array(i);window.crypto.getRandomValues(t);for(let n=0;n<t.length;n++){const s=nh.charAt(t[n]%nh.length);e+=Math.random()>.5?s.toUpperCase():s}return e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class tA extends P{static get requires(){return[pt]}static get pluginName(){return"CKFinderUploadAdapter"}init(){const e=this.editor.config.get("ckfinder.uploadUrl");!e||(this.editor.plugins.get(pt).createUploadAdapter=t=>new nA(t,e,this.editor.t))}}class nA{constructor(e,t,n){this.loader=e,this.url=t,this.t=n}upload(){return this.loader.file.then(e=>new Promise((t,n)=>{this._initRequest(),this._initListeners(t,n,e),this._sendRequest(e)}))}abort(){this.xhr&&this.xhr.abort()}_initRequest(){const e=this.xhr=new XMLHttpRequest;e.open("POST",this.url,!0),e.responseType="json"}_initListeners(e,t,n){const s=this.xhr,o=this.loader,a=this.t("Cannot upload file:")+` ${n.name}.`;s.addEventListener("error",()=>t(a)),s.addEventListener("abort",()=>t()),s.addEventListener("load",()=>{const l=s.response;if(!l||!l.uploaded)return t(l&&l.error&&l.error.message?l.error.message:a);e({default:l.url})}),s.upload&&s.upload.addEventListener("progress",l=>{l.lengthComputable&&(o.uploadTotal=l.total,o.uploaded=l.loaded)})}_sendRequest(e){const t=new FormData;t.append("upload",e),t.append("ckCsrfToken",YE()),this.xhr.send(t)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function $t(i,e,t,n){let s,o=null;typeof n=="function"?s=n:(o=i.commands.get(n),s=()=>{i.execute(n)}),i.model.document.on("change:data",(r,a)=>{if(o&&!o.isEnabled||!e.isEnabled)return;const l=De(i.model.document.selection.getRanges());if(!l.isCollapsed||a.type=="transparent")return;const c=Array.from(i.model.document.differ.getChanges()),u=c[0];if(c.length!=1||u.type!=="insert"||u.name!="$text"||u.length!=1)return;const d=u.position.parent;if(d.is("element","codeBlock")||d.is("element","listItem")&&typeof n!="function"&&!["numberedList","bulletedList","todoList"].includes(n)||o&&o.value===!0)return;const f=d.getChild(0),b=i.model.createRangeOn(f);if(!b.containsRange(l)&&!l.end.isEqual(b.end))return;const _=t.exec(f.data.substr(0,l.end.offset));!_||i.model.enqueueChange(C=>{const A=C.createPositionAt(d,0),R=C.createPositionAt(d,_[0].length),O=new mt(A,R);if(s({match:_})!==!1){C.remove(O);const Q=i.model.document.selection.getFirstRange(),se=C.createRangeIn(d);d.isEmpty&&!se.isEqual(Q)&&!se.containsRange(Q,!0)&&C.remove(d)}O.detach(),i.model.enqueueChange(()=>{i.plugins.get("Delete").requestUndoOnBackspace()})})})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Nn(i,e,t,n){let s,o;t instanceof RegExp?s=t:o=t,o=o||(r=>{let a;const l=[],c=[];for(;(a=s.exec(r))!==null&&!(a&&a.length<4);){let{index:u,"1":d,"2":f,"3":b}=a;const _=d+f+b;u+=a[0].length-_.length;const C=[u,u+d.length],A=[u+d.length+f.length,u+d.length+f.length+b.length];l.push(C),l.push(A),c.push([u+d.length,u+d.length+f.length])}return{remove:l,format:c}}),i.model.document.on("change:data",(r,a)=>{if(a.type=="transparent"||!e.isEnabled)return;const l=i.model,c=l.document.selection;if(!c.isCollapsed)return;const u=Array.from(l.document.differ.getChanges()),d=u[0];if(u.length!=1||d.type!=="insert"||d.name!="$text"||d.length!=1)return;const f=c.focus,b=f.parent,{text:_,range:C}=iA(l.createRange(l.createPositionAt(b,0),f),l),A=o(_),R=ih(C.start,A.format,l),O=ih(C.start,A.remove,l);!(R.length&&O.length)||l.enqueueChange(U=>{if(n(U,R)!==!1){for(const se of O.reverse())U.remove(se);l.enqueueChange(()=>{i.plugins.get("Delete").requestUndoOnBackspace()})}})})}function ih(i,e,t){return e.filter(n=>n[0]!==void 0&&n[1]!==void 0).map(n=>t.createRange(i.getShiftedBy(n[0]),i.getShiftedBy(n[1])))}function iA(i,e){let t=i.start;return{text:Array.from(i.getItems()).reduce((s,o)=>!(o.is("$text")||o.is("$textProxy"))||o.getAttribute("code")?(t=e.createPositionAfter(o),""):s+o.data,""),range:e.createRange(t,i.end)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class sA extends P{static get requires(){return[zt]}static get pluginName(){return"Autoformat"}afterInit(){this._addListAutoformats(),this._addBasicStylesAutoformats(),this._addHeadingAutoformats(),this._addBlockQuoteAutoformats(),this._addCodeBlockAutoformats(),this._addHorizontalLineAutoformats()}_addListAutoformats(){const e=this.editor.commands;e.get("bulletedList")&&$t(this.editor,this,/^[*-]\s$/,"bulletedList"),e.get("numberedList")&&$t(this.editor,this,/^1[.|)]\s$/,"numberedList"),e.get("todoList")&&$t(this.editor,this,/^\[\s?\]\s$/,"todoList"),e.get("checkTodoList")&&$t(this.editor,this,/^\[\s?x\s?\]\s$/,()=>{this.editor.execute("todoList"),this.editor.execute("checkTodoList")})}_addBasicStylesAutoformats(){const e=this.editor.commands;if(e.get("bold")){const t=ms(this.editor,"bold");Nn(this.editor,this,/(?:^|\s)(\*\*)([^*]+)(\*\*)$/g,t),Nn(this.editor,this,/(?:^|\s)(__)([^_]+)(__)$/g,t)}if(e.get("italic")){const t=ms(this.editor,"italic");Nn(this.editor,this,/(?:^|\s)(\*)([^*_]+)(\*)$/g,t),Nn(this.editor,this,/(?:^|\s)(_)([^_]+)(_)$/g,t)}if(e.get("code")){const t=ms(this.editor,"code");Nn(this.editor,this,/(`)([^`]+)(`)$/g,t)}if(e.get("strikethrough")){const t=ms(this.editor,"strikethrough");Nn(this.editor,this,/(~~)([^~]+)(~~)$/g,t)}}_addHeadingAutoformats(){const e=this.editor.commands.get("heading");e&&e.modelElements.filter(t=>t.match(/^heading[1-6]$/)).forEach(t=>{const n=t[7],s=new RegExp(`^(#{${n}})\\s$`);$t(this.editor,this,s,()=>{if(!e.isEnabled||e.value===t)return!1;this.editor.execute("heading",{value:t})})})}_addBlockQuoteAutoformats(){this.editor.commands.get("blockQuote")&&$t(this.editor,this,/^>\s$/,"blockQuote")}_addCodeBlockAutoformats(){const e=this.editor,t=e.model.document.selection;e.commands.get("codeBlock")&&$t(e,this,/^```$/,()=>{if(t.getFirstPosition().parent.is("element","listItem"))return!1;this.editor.execute("codeBlock",{usePreviousLanguageChoice:!0})})}_addHorizontalLineAutoformats(){this.editor.commands.get("horizontalLine")&&$t(this.editor,this,/^---$/,"horizontalLine")}}function ms(i,e){return(t,n)=>{if(!i.commands.get(e).isEnabled)return!1;const o=i.model.schema.getValidRanges(n,e);for(const r of o)t.setAttribute(e,!0,r);t.removeSelectionAttribute(e)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class gr extends q{constructor(e,t){super(e);this.attributeKey=t}refresh(){const e=this.editor.model,t=e.document;this.value=this._getValueFromFirstAllowedNode(),this.isEnabled=e.schema.checkAttributeInSelection(t.selection,this.attributeKey)}execute(e={}){const t=this.editor.model,s=t.document.selection,o=e.forceValue===void 0?!this.value:e.forceValue;t.change(r=>{if(s.isCollapsed)o?r.setSelectionAttribute(this.attributeKey,!0):r.removeSelectionAttribute(this.attributeKey);else{const a=t.schema.getValidRanges(s.getRanges(),this.attributeKey);for(const l of a)o?r.setAttribute(this.attributeKey,o,l):r.removeAttribute(this.attributeKey,l)}})}_getValueFromFirstAllowedNode(){const e=this.editor.model,t=e.schema,n=e.document.selection;if(n.isCollapsed)return n.hasAttribute(this.attributeKey);for(const s of n.getRanges())for(const o of s.getItems())if(t.checkAttribute(o,this.attributeKey))return o.hasAttribute(this.attributeKey);return!1}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Dn="bold";class oA extends P{static get pluginName(){return"BoldEditing"}init(){const e=this.editor;e.model.schema.extend("$text",{allowAttributes:Dn}),e.model.schema.setAttributeProperties(Dn,{isFormatting:!0,copyOnEnter:!0}),e.conversion.attributeToElement({model:Dn,view:"strong",upcastAlso:["b",t=>{const n=t.getStyle("font-weight");if(!n)return null;if(n=="bold"||Number(n)>=600)return{name:!0,styles:["font-weight"]}}]}),e.commands.add(Dn,new gr(e,Dn)),e.keystrokes.set("CTRL+B",Dn)}}var rA='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.187 17H5.773c-.637 0-1.092-.138-1.364-.415-.273-.277-.409-.718-.409-1.323V4.738c0-.617.14-1.062.419-1.332.279-.27.73-.406 1.354-.406h4.68c.69 0 1.288.041 1.793.124.506.083.96.242 1.36.478.341.197.644.447.906.75a3.262 3.262 0 0 1 .808 2.162c0 1.401-.722 2.426-2.167 3.075C15.05 10.175 16 11.315 16 13.01a3.756 3.756 0 0 1-2.296 3.504 6.1 6.1 0 0 1-1.517.377c-.571.073-1.238.11-2 .11zm-.217-6.217H7v4.087h3.069c1.977 0 2.965-.69 2.965-2.072 0-.707-.256-1.22-.768-1.537-.512-.319-1.277-.478-2.296-.478zM7 5.13v3.619h2.606c.729 0 1.292-.067 1.69-.2a1.6 1.6 0 0 0 .91-.765c.165-.267.247-.566.247-.897 0-.707-.26-1.176-.778-1.409-.519-.232-1.31-.348-2.375-.348H7z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const pr="bold";class aA extends P{static get pluginName(){return"BoldUI"}init(){const e=this.editor,t=e.t;e.ui.componentFactory.add(pr,n=>{const s=e.commands.get(pr),o=new le(n);return o.set({label:t("Bold"),icon:rA,keystroke:"CTRL+B",tooltip:!0,isToggleable:!0}),o.bind("isOn","isEnabled").to(s,"value","isEnabled"),this.listenTo(o,"execute",()=>{e.execute(pr),e.editing.view.focus()}),o})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class lA extends P{static get requires(){return[oA,aA]}static get pluginName(){return"Bold"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const un="code",cA="ck-code_selected";class uA extends P{static get pluginName(){return"CodeEditing"}static get requires(){return[ds]}init(){const e=this.editor;e.model.schema.extend("$text",{allowAttributes:un}),e.model.schema.setAttributeProperties(un,{isFormatting:!0,copyOnEnter:!1}),e.conversion.attributeToElement({model:un,view:"code",upcastAlso:{styles:{"word-wrap":"break-word"}}}),e.commands.add(un,new gr(e,un)),e.plugins.get(ds).registerAttribute(un),Gd(e,un,"code",cA)}}var dA='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m12.5 5.7 5.2 3.9v1.3l-5.6 4c-.1.2-.3.2-.5.2-.3-.1-.6-.7-.6-1l.3-.4 4.7-3.5L11.5 7l-.2-.2c-.1-.3-.1-.6 0-.8.2-.2.5-.4.8-.4a.8.8 0 0 1 .4.1zm-5.2 0L2 9.6v1.3l5.6 4c.1.2.3.2.5.2.3-.1.7-.7.6-1 0-.1 0-.3-.2-.4l-5-3.5L8.2 7l.2-.2c.1-.3.1-.6 0-.8-.2-.2-.5-.4-.8-.4a.8.8 0 0 0-.3.1z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const wr="code";class hA extends P{static get pluginName(){return"CodeUI"}init(){const e=this.editor,t=e.t;e.ui.componentFactory.add(wr,n=>{const s=e.commands.get(wr),o=new le(n);return o.set({label:t("Code"),icon:dA,tooltip:!0,isToggleable:!0}),o.bind("isOn","isEnabled").to(s,"value","isEnabled"),this.listenTo(o,"execute",()=>{e.execute(wr),e.editing.view.focus()}),o})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class fA extends P{static get requires(){return[uA,hA]}static get pluginName(){return"Code"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Bn="italic";class mA extends P{static get pluginName(){return"ItalicEditing"}init(){const e=this.editor;e.model.schema.extend("$text",{allowAttributes:Bn}),e.model.schema.setAttributeProperties(Bn,{isFormatting:!0,copyOnEnter:!0}),e.conversion.attributeToElement({model:Bn,view:"i",upcastAlso:["em",{styles:{"font-style":"italic"}}]}),e.commands.add(Bn,new gr(e,Bn)),e.keystrokes.set("CTRL+I",Bn)}}var gA='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m9.586 14.633.021.004c-.036.335.095.655.393.962.082.083.173.15.274.201h1.474a.6.6 0 1 1 0 1.2H5.304a.6.6 0 0 1 0-1.2h1.15c.474-.07.809-.182 1.005-.334.157-.122.291-.32.404-.597l2.416-9.55a1.053 1.053 0 0 0-.281-.823 1.12 1.12 0 0 0-.442-.296H8.15a.6.6 0 0 1 0-1.2h6.443a.6.6 0 1 1 0 1.2h-1.195c-.376.056-.65.155-.823.296-.215.175-.423.439-.623.79l-2.366 9.347z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const br="italic";class pA extends P{static get pluginName(){return"ItalicUI"}init(){const e=this.editor,t=e.t;e.ui.componentFactory.add(br,n=>{const s=e.commands.get(br),o=new le(n);return o.set({label:t("Italic"),icon:gA,keystroke:"CTRL+I",tooltip:!0,isToggleable:!0}),o.bind("isOn","isEnabled").to(s,"value","isEnabled"),this.listenTo(o,"execute",()=>{e.execute(br),e.editing.view.focus()}),o})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class wA extends P{static get requires(){return[mA,pA]}static get pluginName(){return"Italic"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class bA extends q{refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(e={}){const t=this.editor.model,n=t.schema,s=t.document.selection,o=Array.from(s.getSelectedBlocks()),r=e.forceValue===void 0?!this.value:e.forceValue;t.change(a=>{if(!r)this._removeQuote(a,o.filter(gs));else{const l=o.filter(c=>gs(c)||oh(n,c));this._applyQuote(a,l)}})}_getValue(){const e=this.editor.model.document.selection,t=De(e.getSelectedBlocks());return!!(t&&gs(t))}_checkEnabled(){if(this.value)return!0;const e=this.editor.model.document.selection,t=this.editor.model.schema,n=De(e.getSelectedBlocks());return n?oh(t,n):!1}_removeQuote(e,t){sh(e,t).reverse().forEach(n=>{if(n.start.isAtStart&&n.end.isAtEnd){e.unwrap(n.start.parent);return}if(n.start.isAtStart){const o=e.createPositionBefore(n.start.parent);e.move(n,o);return}n.end.isAtEnd||e.split(n.end);const s=e.createPositionAfter(n.end.parent);e.move(n,s)})}_applyQuote(e,t){const n=[];sh(e,t).reverse().forEach(s=>{let o=gs(s.start);o||(o=e.createElement("blockQuote"),e.wrap(s,o)),n.push(o)}),n.reverse().reduce((s,o)=>s.nextSibling==o?(e.merge(e.createPositionAfter(s)),s):o)}}function gs(i){return i.parent.name=="blockQuote"?i.parent:null}function sh(i,e){let t,n=0;const s=[];for(;n<e.length;){const o=e[n],r=e[n+1];t||(t=i.createPositionBefore(o)),(!r||o.nextSibling!=r)&&(s.push(i.createRange(t,i.createPositionAfter(o))),t=null),n++}return s}function oh(i,e){const t=i.checkChild(e.parent,"blockQuote"),n=i.checkChild(["$root","blockQuote"],e);return t&&n}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class _A extends P{static get pluginName(){return"BlockQuoteEditing"}static get requires(){return[cs,zt]}init(){const e=this.editor,t=e.model.schema;e.commands.add("blockQuote",new bA(e)),t.register("blockQuote",{allowWhere:"$block",allowContentOf:"$root"}),e.conversion.elementToElement({model:"blockQuote",view:"blockquote"}),e.model.document.registerPostFixer(r=>{const a=e.model.document.differ.getChanges();for(const l of a)if(l.type=="insert"){const c=l.position.nodeAfter;if(!c)continue;if(c.is("element","blockQuote")&&c.isEmpty)return r.remove(c),!0;if(c.is("element","blockQuote")&&!t.checkChild(l.position,c))return r.unwrap(c),!0;if(c.is("element")){const u=r.createRangeIn(c);for(const d of u.getItems())if(d.is("element","blockQuote")&&!t.checkChild(r.createPositionBefore(d),d))return r.unwrap(d),!0}}else if(l.type=="remove"){const c=l.position.parent;if(c.is("element","blockQuote")&&c.isEmpty)return r.remove(c),!0}return!1});const n=this.editor.editing.view.document,s=e.model.document.selection,o=e.commands.get("blockQuote");this.listenTo(n,"enter",(r,a)=>{if(!s.isCollapsed||!o.value)return;s.getLastPosition().parent.isEmpty&&(e.execute("blockQuote"),e.editing.view.scrollToTheSelection(),a.preventDefault(),r.stop())},{context:"blockquote"}),this.listenTo(n,"delete",(r,a)=>{if(a.direction!="backward"||!s.isCollapsed||!o.value)return;const l=s.getLastPosition().parent;l.isEmpty&&!l.previousSibling&&(e.execute("blockQuote"),e.editing.view.scrollToTheSelection(),a.preventDefault(),r.stop())},{context:"blockquote"})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class vA extends P{static get pluginName(){return"BlockQuoteUI"}init(){const e=this.editor,t=e.t;e.ui.componentFactory.add("blockQuote",n=>{const s=e.commands.get("blockQuote"),o=new le(n);return o.set({label:t("Block quote"),icon:Ve.quote,tooltip:!0,isToggleable:!0}),o.bind("isOn","isEnabled").to(s,"value","isEnabled"),this.listenTo(o,"execute",()=>{e.execute("blockQuote"),e.editing.view.focus()}),o})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class yA extends P{static get requires(){return[_A,vA]}static get pluginName(){return"BlockQuote"}}var CA='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M11.627 16.5zm5.873-.196zm0-7.001V8h-13v8.5h4.341c.191.54.457 1.044.785 1.5H2a1.5 1.5 0 0 1-1.5-1.5v-13A1.5 1.5 0 0 1 2 2h4.5a1.5 1.5 0 0 1 1.06.44L9.122 4H16a1.5 1.5 0 0 1 1.5 1.5v1A1.5 1.5 0 0 1 19 8v2.531a6.027 6.027 0 0 0-1.5-1.228zM16 6.5v-1H8.5l-2-2H2v13h1V8a1.5 1.5 0 0 1 1.5-1.5H16z"/><path d="M14.5 19.5a5 5 0 1 1 0-10 5 5 0 0 1 0 10zM15 14v-2h-1v2h-2v1h2v2h1v-2h2v-1h-2z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class kA extends P{static get pluginName(){return"CKFinderUI"}init(){const e=this.editor,t=e.ui.componentFactory,n=e.t;t.add("ckfinder",s=>{const o=e.commands.get("ckfinder"),r=new le(s);return r.set({label:n("Insert image or file"),icon:CA,tooltip:!0}),r.bind("isEnabled").to(o),r.on("execute",()=>{e.execute("ckfinder"),e.editing.view.focus()}),r})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class TA extends q{constructor(e){super(e);this.stopListening(this.editor.model.document,"change"),this.listenTo(this.editor.model.document,"change",()=>this.refresh(),{priority:"low"})}refresh(){const e=this.editor.commands.get("insertImage"),t=this.editor.commands.get("link");this.isEnabled=e.isEnabled||t.isEnabled}execute(){const e=this.editor,t=this.editor.config.get("ckfinder.openerMethod")||"modal";if(t!="popup"&&t!="modal")throw new p("ckfinder-unknown-openermethod",e);const n=this.editor.config.get("ckfinder.options")||{};n.chooseFiles=!0;const s=n.onInit;n.language||(n.language=e.locale.uiLanguage),n.onInit=o=>{s&&s(o),o.on("files:choose",r=>{const a=r.data.files.toArray(),l=a.filter(d=>!d.isImage()),c=a.filter(d=>d.isImage());for(const d of l)e.execute("link",d.getUrl());const u=[];for(const d of c){const f=d.getUrl();u.push(f||o.request("file:getProxyUrl",{file:d}))}u.length&&rh(e,u)}),o.on("file:choose:resizedImage",r=>{const a=r.data.resizedUrl;if(!a){const l=e.plugins.get("Notification"),c=e.locale.t;l.showWarning(c("Could not obtain resized image URL."),{title:c("Selecting resized image failed"),namespace:"ckfinder"});return}rh(e,[a])})},window.CKFinder[t](n)}}function rh(i,e){if(!i.commands.get("insertImage").isEnabled){const n=i.plugins.get("Notification"),s=i.locale.t;n.showWarning(s("Could not insert image at the current position."),{title:s("Inserting image failed"),namespace:"ckfinder"});return}i.execute("insertImage",{source:e})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class EA extends P{static get pluginName(){return"CKFinderEditing"}static get requires(){return[ir,"LinkEditing"]}init(){const e=this.editor;if(!e.plugins.has("ImageBlockEditing")&&!e.plugins.has("ImageInlineEditing"))throw new p("ckfinder-missing-image-plugin",e);e.commands.add("ckfinder",new TA(e))}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class AA extends P{static get pluginName(){return"CKFinder"}static get requires(){return["Link","CKFinderUploadAdapter",EA,kA]}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class SA extends P{static get pluginName(){return"CloudServicesUploadAdapter"}static get requires(){return["CloudServices",pt]}init(){const e=this.editor,t=e.plugins.get("CloudServices"),n=t.token,s=t.uploadUrl;!n||(this._uploadGateway=e.plugins.get("CloudServicesCore").createUploadGateway(n,s),e.plugins.get(pt).createUploadAdapter=o=>new xA(this._uploadGateway,o))}}class xA{constructor(e,t){this.uploadGateway=e,this.loader=t}upload(){return this.loader.file.then(e=>(this.fileUploader=this.uploadGateway.upload(e),this.fileUploader.on("progress",(t,n)=>{this.loader.uploadTotal=n.total,this.loader.uploaded=n.uploaded}),this.fileUploader.send()))}abort(){this.fileUploader.abort()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class PA extends P{static get requires(){return[SA,"ImageUpload"]}init(){const e=this.editor;!e.plugins.has("ImageBlockEditing")&&!e.plugins.has("ImageInlineEditing")&&Re("easy-image-image-feature-missing",e)}static get pluginName(){return"EasyImage"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class IA extends q{refresh(){const e=this.editor.model,t=e.document,n=De(t.selection.getSelectedBlocks());this.value=!!n&&n.is("element","paragraph"),this.isEnabled=!!n&&ah(n,e.schema)}execute(e={}){const t=this.editor.model,n=t.document;t.change(s=>{const o=(e.selection||n.selection).getSelectedBlocks();for(const r of o)!r.is("element","paragraph")&&ah(r,t.schema)&&s.rename(r,"paragraph")})}}function ah(i,e){return e.checkChild(i.parent,"paragraph")&&!e.isObject(i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class RA extends q{execute(e){const t=this.editor.model;let n=e.position;t.change(s=>{const o=s.createElement("paragraph");if(!t.schema.checkChild(n.parent,o)){const r=t.schema.findAllowedParent(n,o);if(!r)return;n=s.split(n,r).position}t.insertContent(o,n),s.setSelection(o,"in")})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class pi extends P{static get pluginName(){return"Paragraph"}init(){const e=this.editor,t=e.model;e.commands.add("paragraph",new IA(e)),e.commands.add("insertParagraph",new RA(e)),t.schema.register("paragraph",{inheritAllFrom:"$block"}),e.conversion.elementToElement({model:"paragraph",view:"p"}),e.conversion.for("upcast").elementToElement({model:(n,{writer:s})=>!pi.paragraphLikeElements.has(n.name)||n.isEmpty?null:s.createElement("paragraph"),view:/.+/,converterPriority:"low"})}}pi.paragraphLikeElements=new Set(["blockquote","dd","div","dt","h1","h2","h3","h4","h5","h6","li","p","td","th"]);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class MA extends q{constructor(e,t){super(e);this.modelElements=t}refresh(){const e=De(this.editor.model.document.selection.getSelectedBlocks());this.value=!!e&&this.modelElements.includes(e.name)&&e.name,this.isEnabled=!!e&&this.modelElements.some(t=>lh(e,t,this.editor.model.schema))}execute(e){const t=this.editor.model,n=t.document,s=e.value;t.change(o=>{const r=Array.from(n.selection.getSelectedBlocks()).filter(a=>lh(a,s,t.schema));for(const a of r)a.is("element",s)||o.rename(a,s)})}}function lh(i,e,t){return t.checkChild(i.parent,e)&&!t.isObject(i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const _r="paragraph";class VA extends P{static get pluginName(){return"HeadingEditing"}constructor(e){super(e);e.config.define("heading",{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h2",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h3",title:"Heading 2",class:"ck-heading_heading2"},{model:"heading3",view:"h4",title:"Heading 3",class:"ck-heading_heading3"}]})}static get requires(){return[pi]}init(){const e=this.editor,t=e.config.get("heading.options"),n=[];for(const s of t)s.model!==_r&&(e.model.schema.register(s.model,{inheritAllFrom:"$block"}),e.conversion.elementToElement(s),n.push(s.model));this._addDefaultH1Conversion(e),e.commands.add("heading",new MA(e,n))}afterInit(){const e=this.editor,t=e.commands.get("enter"),n=e.config.get("heading.options");t&&this.listenTo(t,"afterExecute",(s,o)=>{const r=e.model.document.selection.getFirstPosition().parent;n.some(l=>r.is("element",l.model))&&!r.is("element",_r)&&r.childCount===0&&o.writer.rename(r,_r)})}_addDefaultH1Conversion(e){e.conversion.for("upcast").elementToElement({model:"heading1",view:"h1",converterPriority:Jn.get("low")+1})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function OA(i){const e=i.t,t={Paragraph:e("Paragraph"),"Heading 1":e("Heading 1"),"Heading 2":e("Heading 2"),"Heading 3":e("Heading 3"),"Heading 4":e("Heading 4"),"Heading 5":e("Heading 5"),"Heading 6":e("Heading 6")};return i.config.get("heading.options").map(n=>{const s=t[n.title];return s&&s!=n.title&&(n.title=s),n})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class NA extends P{static get pluginName(){return"HeadingUI"}init(){const e=this.editor,t=e.t,n=OA(e),s=t("Choose heading"),o=t("Heading");e.ui.componentFactory.add("heading",r=>{const a={},l=new $e,c=e.commands.get("heading"),u=e.commands.get("paragraph"),d=[c];for(const b of n){const _={type:"button",model:new ss({label:b.title,class:b.class,withText:!0})};b.model==="paragraph"?(_.model.bind("isOn").to(u,"value"),_.model.set("commandName","paragraph"),d.push(u)):(_.model.bind("isOn").to(c,"value",C=>C===b.model),_.model.set({commandName:"heading",commandValue:b.model})),l.add(_),a[b.model]=b.title}const f=Lt(r);return er(f,l),f.buttonView.set({isOn:!1,withText:!0,tooltip:o}),f.extendTemplate({attributes:{class:["ck-heading-dropdown"]}}),f.bind("isEnabled").toMany(d,"isEnabled",(...b)=>b.some(_=>_)),f.buttonView.bind("label").to(c,"value",u,"value",(b,_)=>{const C=b||_&&"paragraph";return a[C]?a[C]:s}),this.listenTo(f,"execute",b=>{e.execute(b.source.commandName,b.source.commandValue?{value:b.source.commandValue}:void 0),e.editing.view.focus()}),f})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class DA extends P{static get requires(){return[VA,NA]}static get pluginName(){return"Heading"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ps extends P{static get requires(){return[rs]}static get pluginName(){return"WidgetToolbarRepository"}init(){const e=this.editor;if(e.plugins.has("BalloonToolbar")){const t=e.plugins.get("BalloonToolbar");this.listenTo(t,"show",n=>{BA(e.editing.view.document.selection)&&n.stop()},{priority:"high"})}this._toolbarDefinitions=new Map,this._balloon=this.editor.plugins.get("ContextualBalloon"),this.on("change:isEnabled",()=>{this._updateToolbarsVisibility()}),this.listenTo(e.ui,"update",()=>{this._updateToolbarsVisibility()}),this.listenTo(e.ui.focusTracker,"change:isFocused",()=>{this._updateToolbarsVisibility()},{priority:"low"})}destroy(){super.destroy();for(const e of this._toolbarDefinitions.values())e.view.destroy()}register(e,{ariaLabel:t,items:n,getRelatedElement:s,balloonClassName:o="ck-toolbar-container"}){if(!n.length){Re("widget-toolbar-no-items",{toolbarId:e});return}const r=this.editor,a=r.t,l=new Zo(r.locale);if(l.ariaLabel=t||a("Widget toolbar"),this._toolbarDefinitions.has(e))throw new p("widget-toolbar-duplicated",this,{toolbarId:e});l.fillFromConfig(n,r.ui.componentFactory),this._toolbarDefinitions.set(e,{view:l,getRelatedElement:s,balloonClassName:o})}_updateToolbarsVisibility(){let e=0,t=null,n=null;for(const s of this._toolbarDefinitions.values()){const o=s.getRelatedElement(this.editor.editing.view.document.selection);if(!this.isEnabled||!o)this._isToolbarInBalloon(s)&&this._hideToolbar(s);else if(!this.editor.ui.focusTracker.isFocused)this._isToolbarVisible(s)&&this._hideToolbar(s);else{const r=o.getAncestors().length;r>e&&(e=r,t=o,n=s)}}n&&this._showToolbar(n,t)}_hideToolbar(e){this._balloon.remove(e.view),this.stopListening(this._balloon,"change:visibleView")}_showToolbar(e,t){this._isToolbarVisible(e)?ch(this.editor,t):this._isToolbarInBalloon(e)||(this._balloon.add({view:e.view,position:uh(this.editor,t),balloonClassName:e.balloonClassName}),this.listenTo(this._balloon,"change:visibleView",()=>{for(const n of this._toolbarDefinitions.values())if(this._isToolbarVisible(n)){const s=n.getRelatedElement(this.editor.editing.view.document.selection);ch(this.editor,s)}}))}_isToolbarVisible(e){return this._balloon.visibleView===e.view}_isToolbarInBalloon(e){return this._balloon.hasView(e.view)}}function ch(i,e){const t=i.plugins.get("ContextualBalloon"),n=uh(i,e);t.updatePosition(n)}function uh(i,e){const t=i.editing.view,n=Le.defaultPositions;return{target:t.domConverter.mapViewToDom(e),positions:[n.northArrowSouth,n.northArrowSouthWest,n.northArrowSouthEast,n.southArrowNorth,n.southArrowNorthWest,n.southArrowNorthEast,n.viewportStickyNorth]}}function BA(i){const e=i.getSelectedElement();return!!(e&&we(e))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class dh{constructor(e){this.set("activeHandlePosition",null),this.set("proposedWidthPercents",null),this.set("proposedWidth",null),this.set("proposedHeight",null),this.set("proposedHandleHostWidth",null),this.set("proposedHandleHostHeight",null),this._options=e,this._referenceCoordinates=null}begin(e,t,n){const s=new te(t);this.activeHandlePosition=$A(e),this._referenceCoordinates=LA(t,HA(this.activeHandlePosition)),this.originalWidth=s.width,this.originalHeight=s.height,this.aspectRatio=s.width/s.height;const o=n.style.width;o&&o.match(/^\d+(\.\d*)?%$/)?this.originalWidthPercents=parseFloat(o):this.originalWidthPercents=FA(n,s)}update(e){this.proposedWidth=e.width,this.proposedHeight=e.height,this.proposedWidthPercents=e.widthPercents,this.proposedHandleHostWidth=e.handleHostWidth,this.proposedHandleHostHeight=e.handleHostHeight}}F(dh,re);function FA(i,e){const t=i.parentElement,n=parseFloat(t.ownerDocument.defaultView.getComputedStyle(t).width);return e.width/n*100}function LA(i,e){const t=new te(i),n=e.split("-"),s={x:n[1]=="right"?t.right:t.left,y:n[0]=="bottom"?t.bottom:t.top};return s.x+=i.ownerDocument.defaultView.scrollX,s.y+=i.ownerDocument.defaultView.scrollY,s}function zA(i){return`ck-widget__resizer__handle-${i}`}function $A(i){const e=["top-left","top-right","bottom-right","bottom-left"];for(const t of e)if(i.classList.contains(zA(t)))return t}function HA(i){const e=i.split("-"),t={top:"bottom",bottom:"top",left:"right",right:"left"};return`${t[e[0]]}-${t[e[1]]}`}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class UA extends j{constructor(){super();const e=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck","ck-size-view",e.to("_viewPosition",t=>t?`ck-orientation-${t}`:"")],style:{display:e.if("_isVisible","none",t=>!t)}},children:[{text:e.to("_label")}]})}_bindToState(e,t){this.bind("_isVisible").to(t,"proposedWidth",t,"proposedHeight",(n,s)=>n!==null&&s!==null),this.bind("_label").to(t,"proposedHandleHostWidth",t,"proposedHandleHostHeight",t,"proposedWidthPercents",(n,s,o)=>e.unit==="px"?`${n}\xD7${s}`:`${o}%`),this.bind("_viewPosition").to(t,"activeHandlePosition",t,"proposedHandleHostWidth",t,"proposedHandleHostHeight",(n,s,o)=>s<50||o<50?"above-center":n)}_dismiss(){this.unbind(),this._isVisible=!1}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class vr{constructor(e){this._options=e,this._viewResizerWrapper=null,this.set("isEnabled",!0),this.decorate("begin"),this.decorate("cancel"),this.decorate("commit"),this.decorate("updateSize"),this.on("commit",t=>{!this.state.proposedWidth&&!this.state.proposedWidthPercents&&(this._cleanup(),t.stop())},{priority:"high"}),this.on("change:isEnabled",()=>{this.isEnabled&&this.redraw()})}attach(){const e=this,t=this._options.viewElement;this._options.editor.editing.view.change(s=>{const o=s.createUIElement("div",{class:"ck ck-reset_all ck-widget__resizer"},function(r){const a=this.toDomElement(r);return e._appendHandles(a),e._appendSizeUI(a),e.on("change:isEnabled",(l,c,u)=>{a.style.display=u?"":"none"}),a.style.display=e.isEnabled?"":"none",a});s.insert(s.createPositionAt(t,"end"),o),s.addClass("ck-widget_with-resizer",t),this._viewResizerWrapper=o})}begin(e){this.state=new dh(this._options),this._sizeView._bindToState(this._options,this.state),this._initialViewWidth=this._options.viewElement.getStyle("width"),this.state.begin(e,this._getHandleHost(),this._getResizeHost())}updateSize(e){const t=this._proposeNewSize(e);this._options.editor.editing.view.change(a=>{const l=this._options.unit||"%",c=(l==="%"?t.widthPercents:t.width)+l;a.setStyle("width",c,this._options.viewElement)});const s=this._getHandleHost(),o=new te(s);t.handleHostWidth=Math.round(o.width),t.handleHostHeight=Math.round(o.height);const r=new te(s);t.width=Math.round(r.width),t.height=Math.round(r.height),this.redraw(o),this.state.update(t)}commit(){const e=this._options.unit||"%",t=(e==="%"?this.state.proposedWidthPercents:this.state.proposedWidth)+e;this._options.editor.editing.view.change(()=>{this._cleanup(),this._options.onCommit(t)})}cancel(){this._cleanup()}destroy(){this.cancel()}redraw(e){const t=this._domResizerWrapper;if(!jA(t))return;const n=t.parentElement,s=this._getHandleHost(),o=this._viewResizerWrapper,r=[o.getStyle("width"),o.getStyle("height"),o.getStyle("left"),o.getStyle("top")];let a;if(n.isSameNode(s)){const l=e||new te(s);a=[l.width+"px",l.height+"px",void 0,void 0]}else a=[s.offsetWidth+"px",s.offsetHeight+"px",s.offsetLeft+"px",s.offsetTop+"px"];Me(r,a)!=="same"&&this._options.editor.editing.view.change(l=>{l.setStyle({width:a[0],height:a[1],left:a[2],top:a[3]},o)})}containsHandle(e){return this._domResizerWrapper.contains(e)}static isResizeHandle(e){return e.classList.contains("ck-widget__resizer__handle")}_cleanup(){this._sizeView._dismiss(),this._options.editor.editing.view.change(t=>{t.setStyle("width",this._initialViewWidth,this._options.viewElement)})}_proposeNewSize(e){const t=this.state,n=qA(e),s=this._options.isCentered?this._options.isCentered(this):!0,o={x:t._referenceCoordinates.x-(n.x+t.originalWidth),y:n.y-t.originalHeight-t._referenceCoordinates.y};s&&t.activeHandlePosition.endsWith("-right")&&(o.x=n.x-(t._referenceCoordinates.x+t.originalWidth)),s&&(o.x*=2);const r={width:Math.abs(t.originalWidth+o.x),height:Math.abs(t.originalHeight+o.y)};r.dominant=r.width/t.aspectRatio>r.height?"width":"height",r.max=r[r.dominant];const a={width:r.width,height:r.height};return r.dominant=="width"?a.height=a.width/t.aspectRatio:a.width=a.height*t.aspectRatio,{width:Math.round(a.width),height:Math.round(a.height),widthPercents:Math.min(Math.round(t.originalWidthPercents/t.originalWidth*a.width*100)/100,100)}}_getResizeHost(){const e=this._domResizerWrapper.parentElement;return this._options.getResizeHost(e)}_getHandleHost(){const e=this._domResizerWrapper.parentElement;return this._options.getHandleHost(e)}get _domResizerWrapper(){return this._options.editor.editing.view.domConverter.mapViewToDom(this._viewResizerWrapper)}_appendHandles(e){const t=["top-left","top-right","bottom-right","bottom-left"];for(const n of t)e.appendChild(new it({tag:"div",attributes:{class:`ck-widget__resizer__handle ${WA(n)}`}}).render())}_appendSizeUI(e){this._sizeView=new UA,this._sizeView.render(),e.appendChild(this._sizeView.element)}}F(vr,re);function WA(i){return`ck-widget__resizer__handle-${i}`}function qA(i){return{x:i.pageX,y:i.pageY}}function jA(i){return i&&i.ownerDocument&&i.ownerDocument.contains(i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ws extends P{static get pluginName(){return"WidgetResize"}init(){const e=this.editor.editing,t=_e.window.document;this.set("visibleResizer",null),this.set("_activeResizer",null),this._resizers=new Map,e.view.addObserver(ls),this._observer=Object.create(Cn),this.listenTo(e.view.document,"mousedown",this._mouseDownListener.bind(this),{priority:"high"}),this._observer.listenTo(t,"mousemove",this._mouseMoveListener.bind(this)),this._observer.listenTo(t,"mouseup",this._mouseUpListener.bind(this));const n=()=>{this.visibleResizer&&this.visibleResizer.redraw()};this._redrawFocusedResizerThrottled=Wl(n,200),this.on("change:visibleResizer",n),this.editor.ui.on("update",this._redrawFocusedResizerThrottled),this.editor.model.document.on("change",()=>{for(const[o,r]of this._resizers)o.isAttached()||(this._resizers.delete(o),r.destroy())},{priority:"lowest"}),this._observer.listenTo(_e.window,"resize",this._redrawFocusedResizerThrottled);const s=this.editor.editing.view.document.selection;s.on("change",()=>{const o=s.getSelectedElement();this.visibleResizer=this.getResizerByViewElement(o)||null})}destroy(){this._observer.stopListening();for(const e of this._resizers.values())e.destroy();this._redrawFocusedResizerThrottled.cancel()}attachTo(e){const t=new vr(e),n=this.editor.plugins;if(t.attach(),n.has("WidgetToolbarRepository")){const r=n.get("WidgetToolbarRepository");t.on("begin",()=>{r.forceDisabled("resize")},{priority:"lowest"}),t.on("cancel",()=>{r.clearForceDisabled("resize")},{priority:"highest"}),t.on("commit",()=>{r.clearForceDisabled("resize")},{priority:"highest"})}this._resizers.set(e.viewElement,t);const o=this.editor.editing.view.document.selection.getSelectedElement();return this.getResizerByViewElement(o)==t&&(this.visibleResizer=t),t}getResizerByViewElement(e){return this._resizers.get(e)}_getResizerByHandle(e){for(const t of this._resizers.values())if(t.containsHandle(e))return t}_mouseDownListener(e,t){const n=t.domTarget;!vr.isResizeHandle(n)||(this._activeResizer=this._getResizerByHandle(n),this._activeResizer&&(this._activeResizer.begin(n),e.stop(),t.preventDefault()))}_mouseMoveListener(e,t){this._activeResizer&&this._activeResizer.updateSize(t)}_mouseUpListener(){this._activeResizer&&(this._activeResizer.commit(),this._activeResizer=null)}}F(ws,re);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class KA extends q{refresh(){const n=this.editor.plugins.get("ImageUtils").getClosestSelectedImageElement(this.editor.model.document.selection);this.isEnabled=!!n,this.isEnabled&&n.hasAttribute("alt")?this.value=n.getAttribute("alt"):this.value=!1}execute(e){const t=this.editor,n=t.plugins.get("ImageUtils"),s=t.model,o=n.getClosestSelectedImageElement(s.document.selection);s.change(r=>{r.setAttribute("alt",e.newValue,o)})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function yr(i,e){const t=i.createEmptyElement("img"),n=e==="imageBlock"?i.createContainerElement("figure",{class:"image"}):i.createContainerElement("span",{class:"image-inline"},{isAllowedInsideAttributeElement:!0});return i.insert(i.createPositionAt(n,0),t),n}function hh(i,e){if(i.plugins.has("ImageInlineEditing")!==i.plugins.has("ImageBlockEditing"))return{name:"img"};const t=i.plugins.get("ImageUtils");return n=>!t.isInlineImageView(n)||(n.findAncestor(t.isBlockImageView)?"imageBlock":"imageInline")!==e?null:{name:!0}}function Cr(i,e){const t=De(e.getSelectedBlocks());return!t||i.isObject(t)||t.isEmpty&&t.name!="listItem"?"imageBlock":"imageInline"}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class st extends P{static get pluginName(){return"ImageUtils"}isImage(e){return this.isInlineImage(e)||this.isBlockImage(e)}isInlineImageView(e){return!!e&&e.is("element","img")}isBlockImageView(e){return!!e&&e.is("element","figure")&&e.hasClass("image")}insertImage(e={},t=null,n=null){const s=this.editor,o=s.model,r=o.document.selection;n=fh(s,t||r,n),e=$($({},Object.fromEntries(r.getAttributes())),e);for(const a in e)o.schema.checkAttribute(n,a)||delete e[a];return o.change(a=>{const l=a.createElement(n,e);return!t&&n!="imageInline"&&(t=Rn(r,o)),o.insertContent(l,t),l.parent?(a.setSelection(l,"on"),l):null})}getClosestSelectedImageWidget(e){const t=e.getSelectedElement();if(t&&this.isImageWidget(t))return t;let n=e.getFirstPosition().parent;for(;n;){if(n.is("element")&&this.isImageWidget(n))return n;n=n.parent}return null}getClosestSelectedImageElement(e){const t=e.getSelectedElement();return this.isImage(t)?t:e.getFirstPosition().findAncestor("imageBlock")}isImageAllowed(){const t=this.editor.model.document.selection;return GA(this.editor,t)&&JA(t)}toImageWidget(e,t,n){return t.setCustomProperty("image",!0,e),lr(e,t,{label:()=>{const r=this.findViewImgElement(e).getAttribute("alt");return r?`${r} ${n}`:n}})}isImageWidget(e){return!!e.getCustomProperty("image")&&we(e)}isBlockImage(e){return!!e&&e.is("element","imageBlock")}isInlineImage(e){return!!e&&e.is("element","imageInline")}findViewImgElement(e){if(this.isInlineImageView(e))return e;const t=this.editor.editing.view;for(const{item:n}of t.createRangeIn(e))if(this.isInlineImageView(n))return n}}function GA(i,e){if(fh(i,e)=="imageBlock"){const n=QA(e,i.model);if(i.model.schema.checkChild(n,"imageBlock"))return!0}else if(i.model.schema.checkChild(e.focus,"imageInline"))return!0;return!1}function JA(i){return[...i.focus.getAncestors()].every(e=>!e.is("element","imageBlock"))}function QA(i,e){const n=Rn(i,e).start.parent;return n.isEmpty&&!n.is("element","$root")?n.parent:n}function fh(i,e,t){const n=i.model.schema,s=i.config.get("image.insert.type");return i.plugins.has("ImageBlockEditing")?i.plugins.has("ImageInlineEditing")?t||(s==="inline"?"imageInline":s==="block"?"imageBlock":e.is("selection")?Cr(n,e):n.checkChild(e,"imageInline")?"imageInline":"imageBlock"):"imageBlock":"imageInline"}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class YA extends P{static get requires(){return[st]}static get pluginName(){return"ImageTextAlternativeEditing"}init(){this.editor.commands.add("imageTextAlternative",new KA(this.editor))}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class XA extends j{constructor(e){super(e);const t=this.locale.t;this.focusTracker=new Je,this.keystrokes=new At,this.labeledInput=this._createLabeledInputView(),this.saveButtonView=this._createButton(t("Save"),Ve.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(t("Cancel"),Ve.cancel,"ck-button-cancel","cancel"),this._focusables=new an,this._focusCycler=new Sn({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"form",attributes:{class:["ck","ck-text-alternative-form","ck-responsive-form"],tabindex:"-1"},children:[this.labeledInput,this.saveButtonView,this.cancelButtonView]}),qo(this)}render(){super.render(),this.keystrokes.listenTo(this.element),jo({view:this}),[this.labeledInput,this.saveButtonView,this.cancelButtonView].forEach(e=>{this._focusables.add(e),this.focusTracker.add(e.element)})}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createButton(e,t,n,s){const o=new le(this.locale);return o.set({label:e,icon:t,tooltip:!0}),o.extendTemplate({attributes:{class:n}}),s&&o.delegate("execute").to(this,s),o}_createLabeledInputView(){const e=this.locale.t,t=new tr(this.locale,nr);return t.label=e("Text alternative"),t}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function ZA(i){const e=i.plugins.get("ContextualBalloon");if(i.plugins.get("ImageUtils").getClosestSelectedImageWidget(i.editing.view.document.selection)){const t=mh(i);e.updatePosition(t)}}function mh(i){const e=i.editing.view,t=Le.defaultPositions,n=i.plugins.get("ImageUtils");return{target:e.domConverter.viewToDom(n.getClosestSelectedImageWidget(e.document.selection)),positions:[t.northArrowSouth,t.northArrowSouthWest,t.northArrowSouthEast,t.southArrowNorth,t.southArrowNorthWest,t.southArrowNorthEast,t.viewportStickyNorth]}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class eS extends P{static get requires(){return[rs]}static get pluginName(){return"ImageTextAlternativeUI"}init(){this._createButton(),this._createForm()}destroy(){super.destroy(),this._form.destroy()}_createButton(){const e=this.editor,t=e.t;e.ui.componentFactory.add("imageTextAlternative",n=>{const s=e.commands.get("imageTextAlternative"),o=new le(n);return o.set({label:t("Change image text alternative"),icon:Ve.lowVision,tooltip:!0}),o.bind("isEnabled").to(s,"isEnabled"),this.listenTo(o,"execute",()=>{this._showForm()}),o})}_createForm(){const e=this.editor,n=e.editing.view.document,s=e.plugins.get("ImageUtils");this._balloon=this.editor.plugins.get("ContextualBalloon"),this._form=new XA(e.locale),this._form.render(),this.listenTo(this._form,"submit",()=>{e.execute("imageTextAlternative",{newValue:this._form.labeledInput.fieldView.element.value}),this._hideForm(!0)}),this.listenTo(this._form,"cancel",()=>{this._hideForm(!0)}),this._form.keystrokes.set("Esc",(o,r)=>{this._hideForm(!0),r()}),this.listenTo(e.ui,"update",()=>{s.getClosestSelectedImageWidget(n.selection)?this._isVisible&&ZA(e):this._hideForm(!0)}),Wo({emitter:this._form,activator:()=>this._isVisible,contextElements:[this._balloon.view.element],callback:()=>this._hideForm()})}_showForm(){if(this._isVisible)return;const e=this.editor,t=e.commands.get("imageTextAlternative"),n=this._form.labeledInput;this._form.disableCssTransitions(),this._isInBalloon||this._balloon.add({view:this._form,position:mh(e)}),n.fieldView.value=n.fieldView.element.value=t.value||"",this._form.labeledInput.fieldView.select(),this._form.enableCssTransitions()}_hideForm(e){!this._isInBalloon||(this._form.focusTracker.isFocused&&this._form.saveButtonView.focus(),this._balloon.remove(this._form),e&&this.editor.editing.view.focus())}get _isVisible(){return this._balloon.visibleView===this._form}get _isInBalloon(){return this._balloon.hasView(this._form)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class gh extends P{static get requires(){return[YA,eS]}static get pluginName(){return"ImageTextAlternative"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function tS(i){return t=>{t.on("element:figure",e)};function e(t,n,s){if(!s.consumable.test(n.viewItem,{name:!0,classes:"image"}))return;const o=i.findViewImgElement(n.viewItem);if(!o||!s.consumable.test(o,{name:!0}))return;s.consumable.consume(n.viewItem,{name:!0,classes:"image"});const r=s.convertItem(o,n.modelCursor),a=De(r.modelRange.getItems());if(!a){s.consumable.revert(n.viewItem,{name:!0,classes:"image"});return}s.convertChildren(n.viewItem,a),s.updateConversionResult(a,n)}}function ph(i,e){return n=>{n.on(`attribute:srcset:${e}`,t)};function t(n,s,o){if(!o.consumable.consume(s.item,n.name))return;const r=o.writer,a=o.mapper.toViewElement(s.item),l=i.findViewImgElement(a);if(s.attributeNewValue===null){const c=s.attributeOldValue;c.data&&(r.removeAttribute("srcset",l),r.removeAttribute("sizes",l),c.width&&r.removeAttribute("width",l))}else{const c=s.attributeNewValue;c.data&&(r.setAttribute("srcset",c.data,l),r.setAttribute("sizes","100vw",l),c.width&&r.setAttribute("width",c.width,l))}}}function bs(i,e,t){return s=>{s.on(`attribute:${t}:${e}`,n)};function n(s,o,r){if(!r.consumable.consume(o.item,s.name))return;const a=r.writer,l=r.mapper.toViewElement(o.item),c=i.findViewImgElement(l);a.setAttribute(o.attributeKey,o.attributeNewValue||"",c)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class wh extends Et{observe(e){this.listenTo(e,"load",(t,n)=>{const s=n.target;this.checkShouldIgnoreEventFromTarget(s)||s.tagName=="IMG"&&this._fireEvents(n)},{useCapture:!0})}_fireEvents(e){this.isEnabled&&(this.document.fire("layoutChanged"),this.document.fire("imageLoaded",e))}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class nS extends q{constructor(e){super(e);const t=e.config.get("image.insert.type");e.plugins.has("ImageBlockEditing")||t==="block"&&Re("image-block-plugin-required"),e.plugins.has("ImageInlineEditing")||t==="inline"&&Re("image-inline-plugin-required")}refresh(){this.isEnabled=this.editor.plugins.get("ImageUtils").isImageAllowed()}execute(e){const t=Ee(e.source),n=this.editor.model.document.selection,s=this.editor.plugins.get("ImageUtils"),o=Object.fromEntries(n.getAttributes());t.forEach((r,a)=>{const l=n.getSelectedElement();if(typeof r=="string"&&(r={src:r}),a&&l&&s.isImage(l)){const c=this.editor.model.createPositionAfter(l);s.insertImage($($({},r),o),c)}else s.insertImage($($({},r),o))})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class bh extends P{static get requires(){return[st]}static get pluginName(){return"ImageEditing"}init(){const e=this.editor,t=e.conversion;e.editing.view.addObserver(wh),t.for("upcast").attributeToAttribute({view:{name:"img",key:"alt"},model:"alt"}).attributeToAttribute({view:{name:"img",key:"srcset"},model:{key:"srcset",value:s=>{const o={data:s.getAttribute("srcset")};return s.hasAttribute("width")&&(o.width=s.getAttribute("width")),o}}});const n=new nS(e);e.commands.add("insertImage",n),e.commands.add("imageInsert",n)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class _h extends q{constructor(e,t){super(e);this._modelElementName=t}refresh(){const t=this.editor.plugins.get("ImageUtils"),n=t.getClosestSelectedImageElement(this.editor.model.document.selection);this._modelElementName==="imageBlock"?this.isEnabled=t.isInlineImage(n):this.isEnabled=t.isBlockImage(n)}execute(){const e=this.editor,t=this.editor.model,n=e.plugins.get("ImageUtils"),s=n.getClosestSelectedImageElement(t.document.selection),o=Object.fromEntries(s.getAttributes());return!o.src&&!o.uploadId?null:t.change(r=>{const a=Array.from(t.markers).filter(u=>u.getRange().containsItem(s)),l=n.insertImage(o,t.createSelection(s,"on"),this._modelElementName);if(!l)return null;const c=r.createRangeOn(l);for(const u of a){const d=u.getRange(),f=d.root.rootName!="$graveyard"?d.getJoined(c,!0):c;r.updateMarker(u,{range:f})}return{oldElement:s,newElement:l}})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class vh extends P{static get requires(){return[bh,st,gt]}static get pluginName(){return"ImageBlockEditing"}init(){const e=this.editor;e.model.schema.register("imageBlock",{isObject:!0,isBlock:!0,allowWhere:"$block",allowAttributes:["alt","src","srcset"]}),this._setupConversion(),e.plugins.has("ImageInlineEditing")&&(e.commands.add("imageTypeBlock",new _h(this.editor,"imageBlock")),this._setupClipboardIntegration())}_setupConversion(){const e=this.editor,t=e.t,n=e.conversion,s=e.plugins.get("ImageUtils");n.for("dataDowncast").elementToElement({model:"imageBlock",view:(o,{writer:r})=>yr(r,"imageBlock")}),n.for("editingDowncast").elementToElement({model:"imageBlock",view:(o,{writer:r})=>s.toImageWidget(yr(r,"imageBlock"),r,t("image widget"))}),n.for("downcast").add(bs(s,"imageBlock","src")).add(bs(s,"imageBlock","alt")).add(ph(s,"imageBlock")),n.for("upcast").elementToElement({view:hh(e,"imageBlock"),model:(o,{writer:r})=>r.createElement("imageBlock",o.hasAttribute("src")?{src:o.getAttribute("src")}:null)}).add(tS(s))}_setupClipboardIntegration(){const e=this.editor,t=e.model,n=e.editing.view,s=e.plugins.get("ImageUtils");this.listenTo(e.plugins.get("ClipboardPipeline"),"inputTransformation",(o,r)=>{const a=Array.from(r.content.getChildren());let l;if(!a.every(s.isInlineImageView))return;r.targetRanges?l=e.editing.mapper.toModelRange(r.targetRanges[0]):l=t.document.selection.getFirstRange();const c=t.createSelection(l);if(Cr(t.schema,c)==="imageBlock"){const u=new In(n.document),d=a.map(f=>u.createElement("figure",{class:"image"},f));r.content=u.createDocumentFragment(d)}})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class iS extends P{static get requires(){return[vh,Mn,gh]}static get pluginName(){return"ImageBlock"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class sS extends P{static get requires(){return[bh,st,gt]}static get pluginName(){return"ImageInlineEditing"}init(){const e=this.editor,t=e.model.schema;t.register("imageInline",{isObject:!0,isInline:!0,allowWhere:"$text",allowAttributesOf:"$text",allowAttributes:["alt","src","srcset"]}),t.addChildCheck((n,s)=>{if(n.endsWith("caption")&&s.name==="imageInline")return!1}),this._setupConversion(),e.plugins.has("ImageBlockEditing")&&(e.commands.add("imageTypeInline",new _h(this.editor,"imageInline")),this._setupClipboardIntegration())}_setupConversion(){const e=this.editor,t=e.t,n=e.conversion,s=e.plugins.get("ImageUtils");n.for("dataDowncast").elementToElement({model:"imageInline",view:(o,{writer:r})=>r.createEmptyElement("img")}),n.for("editingDowncast").elementToElement({model:"imageInline",view:(o,{writer:r})=>s.toImageWidget(yr(r,"imageInline"),r,t("image widget"))}),n.for("downcast").add(bs(s,"imageInline","src")).add(bs(s,"imageInline","alt")).add(ph(s,"imageInline")),n.for("upcast").elementToElement({view:hh(e,"imageInline"),model:(o,{writer:r})=>r.createElement("imageInline",o.hasAttribute("src")?{src:o.getAttribute("src")}:null)})}_setupClipboardIntegration(){const e=this.editor,t=e.model,n=e.editing.view,s=e.plugins.get("ImageUtils");this.listenTo(e.plugins.get("ClipboardPipeline"),"inputTransformation",(o,r)=>{const a=Array.from(r.content.getChildren());let l;if(!a.every(s.isBlockImageView))return;r.targetRanges?l=e.editing.mapper.toModelRange(r.targetRanges[0]):l=t.document.selection.getFirstRange();const c=t.createSelection(l);if(Cr(t.schema,c)==="imageInline"){const u=new In(n.document),d=a.map(f=>f.childCount===1?(Array.from(f.getAttributes()).forEach(b=>u.setAttribute(...b,s.findViewImgElement(f))),f.getChild(0)):f);r.content=u.createDocumentFragment(d)}})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class oS extends P{static get requires(){return[sS,Mn,gh]}static get pluginName(){return"ImageInline"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class rS extends P{static get requires(){return[iS,oS]}static get pluginName(){return"Image"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function kr(i){for(const e of i.getChildren())if(!!e&&e.is("element","caption"))return e;return null}function Tr(i,e){const t=e.getFirstPosition().findAncestor("caption");return t&&i.isBlockImage(t.parent)?t:null}function aS(i,e){return e.name=="figcaption"&&i.isBlockImageView(e.parent)?{name:!0}:null}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class lS extends q{refresh(){const e=this.editor,t=e.plugins.get("ImageUtils");if(!e.plugins.has(vh)){this.isEnabled=!1,this.value=!1;return}const n=e.model.document.selection,s=n.getSelectedElement();if(!s){const o=Tr(t,n);this.isEnabled=!!o,this.value=!!o;return}this.isEnabled=this.editor.plugins.get("ImageUtils").isImage(s),this.isEnabled?this.value=!!kr(s):this.value=!1}execute(e={}){const{focusCaptionOnShow:t}=e;this.editor.model.change(n=>{this.value?this._hideImageCaption(n):this._showImageCaption(n,t)})}_showImageCaption(e,t){const s=this.editor.model.document.selection,o=this.editor.plugins.get("ImageCaptionEditing");let r=s.getSelectedElement();const a=o._getSavedCaption(r);this.editor.plugins.get("ImageUtils").isInlineImage(r)&&(this.editor.execute("imageTypeBlock"),r=s.getSelectedElement());const l=a||e.createElement("caption");e.append(l,r),t&&e.setSelection(l,"in")}_hideImageCaption(e){const t=this.editor,n=t.model.document.selection,s=t.plugins.get("ImageCaptionEditing"),o=t.plugins.get("ImageUtils");let r=n.getSelectedElement(),a;r?a=kr(r):(a=Tr(o,n),r=a.parent),s._saveCaption(r,a),e.setSelection(r,"on"),e.remove(a)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class cS extends P{static get requires(){return[st]}static get pluginName(){return"ImageCaptionEditing"}constructor(e){super(e);this._savedCaptionsMap=new WeakMap}init(){const e=this.editor,t=e.model.schema;t.isRegistered("caption")?t.extend("caption",{allowIn:"imageBlock"}):t.register("caption",{allowIn:"imageBlock",allowContentOf:"$block",isLimit:!0}),e.commands.add("toggleImageCaption",new lS(this.editor)),this._setupConversion(),this._setupImageTypeCommandsIntegration()}_setupConversion(){const e=this.editor,t=e.editing.view,n=e.plugins.get("ImageUtils"),s=e.t;e.conversion.for("upcast").elementToElement({view:o=>aS(n,o),model:"caption"}),e.conversion.for("dataDowncast").elementToElement({model:"caption",view:(o,{writer:r})=>n.isBlockImage(o.parent)?r.createContainerElement("figcaption"):null}),e.conversion.for("editingDowncast").elementToElement({model:"caption",view:(o,{writer:r})=>{if(!n.isBlockImage(o.parent))return null;const a=r.createEditableElement("figcaption");return r.setCustomProperty("imageCaption",!0,a),ld({view:t,element:a,text:s("Enter image caption"),keepOnFocus:!0}),cr(a,r)}}),e.editing.mapper.on("modelToViewPosition",yh(t)),e.data.mapper.on("modelToViewPosition",yh(t))}_setupImageTypeCommandsIntegration(){const e=this.editor,t=e.plugins.get("ImageUtils"),n=e.commands.get("imageTypeInline"),s=e.commands.get("imageTypeBlock"),o=r=>{if(!r.return)return;const{oldElement:a,newElement:l}=r.return;if(!a)return;if(t.isBlockImage(a)){const u=kr(a);if(u){this._saveCaption(l,u);return}}const c=this._getSavedCaption(a);c&&this._saveCaption(l,c)};n&&this.listenTo(n,"execute",o,{priority:"low"}),s&&this.listenTo(s,"execute",o,{priority:"low"})}_getSavedCaption(e){const t=this._savedCaptionsMap.get(e);return t?ne.fromJSON(t):null}_saveCaption(e,t){this._savedCaptionsMap.set(e,t.toJSON())}}function yh(i){return(e,t)=>{const n=t.modelPosition,s=n.parent;if(!s.is("element","imageBlock"))return;const o=t.mapper.toViewElement(s);t.viewPosition=i.createPositionAt(o,n.offset+1)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class uS extends P{static get requires(){return[st]}static get pluginName(){return"ImageCaptionUI"}init(){const e=this.editor,t=e.editing.view,n=e.plugins.get("ImageUtils"),s=e.t;e.ui.componentFactory.add("toggleImageCaption",o=>{const r=e.commands.get("toggleImageCaption"),a=new le(o);return a.set({icon:Ve.caption,tooltip:!0,isToggleable:!0}),a.bind("isOn","isEnabled").to(r,"value","isEnabled"),a.bind("label").to(r,"value",l=>s(l?"Toggle caption off":"Toggle caption on")),this.listenTo(a,"execute",()=>{e.execute("toggleImageCaption",{focusCaptionOnShow:!0});const l=Tr(n,e.model.document.selection);if(l){const c=e.editing.mapper.toViewElement(l);t.scrollToTheSelection(),t.change(u=>{u.addClass("image__caption_highlighted",c)})}}),a})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class dS extends P{static get requires(){return[cS,uS]}static get pluginName(){return"ImageCaption"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class hS extends q{constructor(e,t){super(e);this._defaultStyles={imageBlock:!1,imageInline:!1},this._styles=new Map(t.map(n=>{if(n.isDefault)for(const s of n.modelElements)this._defaultStyles[s]=n.name;return[n.name,n]}))}refresh(){const n=this.editor.plugins.get("ImageUtils").getClosestSelectedImageElement(this.editor.model.document.selection);this.isEnabled=!!n,this.isEnabled?n.hasAttribute("imageStyle")?this.value=n.getAttribute("imageStyle"):this.value=this._defaultStyles[n.name]:this.value=!1}execute(e={}){const t=this.editor,n=t.model,s=t.plugins.get("ImageUtils");n.change(o=>{const r=e.value;let a=s.getClosestSelectedImageElement(n.document.selection);r&&this.shouldConvertImageType(r,a)&&(this.editor.execute(s.isBlockImage(a)?"imageTypeInline":"imageTypeBlock"),a=s.getClosestSelectedImageElement(n.document.selection)),!r||this._styles.get(r).isDefault?o.removeAttribute("imageStyle",a):o.setAttribute("imageStyle",r,a)})}shouldConvertImageType(e,t){return!this._styles.get(e).modelElements.includes(t.name)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const{objectFullWidth:fS,objectInline:Ch,objectLeft:kh,objectRight:Er,objectCenter:Ar,objectBlockLeft:Th,objectBlockRight:Eh}=Ve,_s={inline:{name:"inline",title:"In line",icon:Ch,modelElements:["imageInline"],isDefault:!0},alignLeft:{name:"alignLeft",title:"Left aligned image",icon:kh,modelElements:["imageBlock","imageInline"],className:"image-style-align-left"},alignBlockLeft:{name:"alignBlockLeft",title:"Left aligned image",icon:Th,modelElements:["imageBlock"],className:"image-style-block-align-left"},alignCenter:{name:"alignCenter",title:"Centered image",icon:Ar,modelElements:["imageBlock"],className:"image-style-align-center"},alignRight:{name:"alignRight",title:"Right aligned image",icon:Er,modelElements:["imageBlock","imageInline"],className:"image-style-align-right"},alignBlockRight:{name:"alignBlockRight",title:"Right aligned image",icon:Eh,modelElements:["imageBlock"],className:"image-style-block-align-right"},block:{name:"block",title:"Centered image",icon:Ar,modelElements:["imageBlock"],isDefault:!0},side:{name:"side",title:"Side image",icon:Er,modelElements:["imageBlock"],className:"image-style-side"}},Ah={full:fS,left:Th,right:Eh,center:Ar,inlineLeft:kh,inlineRight:Er,inline:Ch},Sh=[{name:"imageStyle:wrapText",title:"Wrap text",defaultItem:"imageStyle:alignLeft",items:["imageStyle:alignLeft","imageStyle:alignRight"]},{name:"imageStyle:breakText",title:"Break text",defaultItem:"imageStyle:block",items:["imageStyle:alignBlockLeft","imageStyle:block","imageStyle:alignBlockRight"]}];function mS(i){return(i.configuredStyles.options||[]).map(n=>wS(n)).filter(n=>bS(n,i))}function gS(i,e){return i&&e?{options:["inline","alignLeft","alignRight","alignCenter","alignBlockLeft","alignBlockRight","block","side"]}:i?{options:["block","side"]}:e?{options:["inline","alignLeft","alignRight"]}:{}}function pS(i){return i.has("ImageBlockEditing")&&i.has("ImageInlineEditing")?[...Sh]:[]}function wS(i){return typeof i=="string"?_s[i]?i=$({},_s[i]):i={name:i}:i=_S(_s[i.name],i),typeof i.icon=="string"&&(i.icon=Ah[i.icon]||i.icon),i}function bS(i,{isBlockPluginLoaded:e,isInlinePluginLoaded:t}){const{modelElements:n,name:s}=i;if(!n||!n.length||!s)return xh({style:i}),!1;{const o=[e?"imageBlock":null,t?"imageInline":null];if(!n.some(r=>o.includes(r)))return Re("image-style-missing-dependency",{style:i,missingPlugins:n.map(r=>r==="imageBlock"?"ImageBlockEditing":"ImageInlineEditing")}),!1}return!0}function _S(i,e){const t=$({},e);for(const n in i)Object.prototype.hasOwnProperty.call(e,n)||(t[n]=i[n]);return t}function xh(i){Re("image-style-configuration-definition-invalid",i)}var Sr={normalizeStyles:mS,getDefaultStylesConfiguration:gS,getDefaultDropdownDefinitions:pS,warnInvalidStyle:xh,DEFAULT_OPTIONS:_s,DEFAULT_ICONS:Ah,DEFAULT_DROPDOWN_DEFINITIONS:Sh};/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function vS(i){return(e,t,n)=>{if(!n.consumable.consume(t.item,e.name))return;const s=Ph(t.attributeNewValue,i),o=Ph(t.attributeOldValue,i),r=n.mapper.toViewElement(t.item),a=n.writer;o&&a.removeClass(o.className,r),s&&a.addClass(s.className,r)}}function yS(i){const e={imageInline:i.filter(t=>!t.isDefault&&t.modelElements.includes("imageInline")),imageBlock:i.filter(t=>!t.isDefault&&t.modelElements.includes("imageBlock"))};return(t,n,s)=>{if(!n.modelRange)return;const o=n.viewItem,r=De(n.modelRange.getItems());if(!!r&&!!s.schema.checkAttribute(r,"imageStyle"))for(const a of e[r.name])s.consumable.consume(o,{classes:a.className})&&s.writer.setAttribute("imageStyle",a.name,r)}}function Ph(i,e){for(const t of e)if(t.name===i)return t}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ih extends P{static get pluginName(){return"ImageStyleEditing"}static get requires(){return[st]}init(){const{normalizeStyles:e,getDefaultStylesConfiguration:t}=Sr,n=this.editor,s=n.plugins.has("ImageBlockEditing"),o=n.plugins.has("ImageInlineEditing");n.config.define("image.styles",t(s,o)),this.normalizedStyles=e({configuredStyles:n.config.get("image.styles"),isBlockPluginLoaded:s,isInlinePluginLoaded:o}),this._setupConversion(s,o),this._setupPostFixer(),n.commands.add("imageStyle",new hS(n,this.normalizedStyles))}_setupConversion(e,t){const n=this.editor,s=n.model.schema,o=vS(this.normalizedStyles),r=yS(this.normalizedStyles);n.editing.downcastDispatcher.on("attribute:imageStyle",o),n.data.downcastDispatcher.on("attribute:imageStyle",o),e&&(s.extend("imageBlock",{allowAttributes:"imageStyle"}),n.data.upcastDispatcher.on("element:figure",r,{priority:"low"})),t&&(s.extend("imageInline",{allowAttributes:"imageStyle"}),n.data.upcastDispatcher.on("element:img",r,{priority:"low"}))}_setupPostFixer(){const e=this.editor,t=e.model.document,n=e.plugins.get(st),s=new Map(this.normalizedStyles.map(o=>[o.name,o]));t.registerPostFixer(o=>{let r=!1;for(const a of t.differ.getChanges())if(a.type=="insert"||a.type=="attribute"&&a.attributeKey=="imageStyle"){let l=a.type=="insert"?a.position.nodeAfter:a.range.start.nodeAfter;if(l&&l.is("element","paragraph")&&l.childCount>0&&(l=l.getChild(0)),!n.isImage(l))continue;const c=l.getAttribute("imageStyle");if(!c)continue;const u=s.get(c);(!u||!u.modelElements.includes(l.name))&&(o.removeAttribute("imageStyle",l),r=!0)}return r})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class CS extends P{static get requires(){return[Ih]}static get pluginName(){return"ImageStyleUI"}get localizedDefaultStylesTitles(){const e=this.editor.t;return{"Wrap text":e("Wrap text"),"Break text":e("Break text"),"In line":e("In line"),"Full size image":e("Full size image"),"Side image":e("Side image"),"Left aligned image":e("Left aligned image"),"Centered image":e("Centered image"),"Right aligned image":e("Right aligned image")}}init(){const e=this.editor.plugins,t=this.editor.config.get("image.toolbar")||[],n=Rh(e.get("ImageStyleEditing").normalizedStyles,this.localizedDefaultStylesTitles);for(const o of n)this._createButton(o);const s=Rh([...t.filter(be),...Sr.getDefaultDropdownDefinitions(e)],this.localizedDefaultStylesTitles);for(const o of s)this._createDropdown(o,n)}_createDropdown(e,t){const n=this.editor.ui.componentFactory;n.add(e.name,s=>{let o;const{defaultItem:r,items:a,title:l}=e,c=a.filter(f=>t.find(({name:b})=>Mh(b)===f)).map(f=>{const b=n.create(f);return f===r&&(o=b),b});a.length!==c.length&&Sr.warnInvalidStyle({dropdown:e});const u=Lt(s,td),d=u.buttonView;return od(u,c),d.set({label:Vh(l,o.label),class:null,tooltip:!0}),d.bind("icon").toMany(c,"isOn",(...f)=>{const b=f.findIndex(jt);return b<0?o.icon:c[b].icon}),d.bind("label").toMany(c,"isOn",(...f)=>{const b=f.findIndex(jt);return Vh(l,b<0?o.label:c[b].label)}),d.bind("isOn").toMany(c,"isOn",(...f)=>f.some(jt)),d.bind("class").toMany(c,"isOn",(...f)=>f.some(jt)?"ck-splitbutton_flatten":null),d.on("execute",()=>{c.some(({isOn:f})=>f)?u.isOpen=!u.isOpen:o.fire("execute")}),u.bind("isEnabled").toMany(c,"isEnabled",(...f)=>f.some(jt)),u})}_createButton(e){const t=e.name;this.editor.ui.componentFactory.add(Mh(t),n=>{const s=this.editor.commands.get("imageStyle"),o=new le(n);return o.set({label:e.title,icon:e.icon,tooltip:!0,isToggleable:!0}),o.bind("isEnabled").to(s,"isEnabled"),o.bind("isOn").to(s,"value",r=>r===t),o.on("execute",this._executeCommand.bind(this,t)),o})}_executeCommand(e){this.editor.execute("imageStyle",{value:e}),this.editor.editing.view.focus()}}function Rh(i,e){for(const t of i)e[t.title]&&(t.title=e[t.title]);return i}function Mh(i){return`imageStyle:${i}`}function Vh(i,e){return(i?i+": ":"")+e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class kS extends P{static get requires(){return[Ih,CS]}static get pluginName(){return"ImageStyle"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class TS extends P{static get requires(){return[ps,st]}static get pluginName(){return"ImageToolbar"}afterInit(){const e=this.editor,t=e.t,n=e.plugins.get(ps),s=e.plugins.get("ImageUtils");n.register("image",{ariaLabel:t("Image toolbar"),items:ES(e.config.get("image.toolbar")||[]),getRelatedElement:o=>s.getClosestSelectedImageWidget(o)})}}function ES(i){return i.map(e=>be(e)?e.name:e)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Oh(i){const e=i.map(t=>t.replace("+","\\+"));return new RegExp(`^image\\/(${e.join("|")})$`)}function AS(i){return new Promise((e,t)=>{const n=i.getAttribute("src");fetch(n).then(s=>s.blob()).then(s=>{const o=Nh(s,n),a=`image.${o.replace("image/","")}`,l=new File([s],a,{type:o});e(l)}).catch(s=>s&&s.name==="TypeError"?xS(n).then(e).catch(t):t(s))})}function SS(i,e){return!i.isInlineImageView(e)||!e.getAttribute("src")?!1:e.getAttribute("src").match(/^data:image\/\w+;base64,/g)||e.getAttribute("src").match(/^blob:/g)}function Nh(i,e){return i.type?i.type:e.match(/data:(image\/\w+);base64/)?e.match(/data:(image\/\w+);base64/)[1].toLowerCase():"image/jpeg"}function xS(i){return PS(i).then(e=>{const t=Nh(e,i),s=`image.${t.replace("image/","")}`;return new File([e],s,{type:t})})}function PS(i){return new Promise((e,t)=>{const n=_e.document.createElement("img");n.addEventListener("load",()=>{const s=_e.document.createElement("canvas");s.width=n.width,s.height=n.height,s.getContext("2d").drawImage(n,0,0),s.toBlob(r=>r?e(r):t())}),n.addEventListener("error",()=>t()),n.src=i})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class IS extends P{static get pluginName(){return"ImageUploadUI"}init(){const e=this.editor,t=e.t,n=s=>{const o=new JE(s),r=e.commands.get("uploadImage"),a=e.config.get("image.upload.types"),l=Oh(a);return o.set({acceptedType:a.map(c=>`image/${c}`).join(","),allowMultipleFiles:!0}),o.buttonView.set({label:t("Insert image"),icon:Ve.image,tooltip:!0}),o.buttonView.bind("isEnabled").to(r),o.on("done",(c,u)=>{const d=Array.from(u).filter(f=>l.test(f.type));d.length&&e.execute("uploadImage",{file:d})}),o};e.ui.componentFactory.add("uploadImage",n),e.ui.componentFactory.add("imageUpload",n)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class RS extends P{static get pluginName(){return"ImageUploadProgress"}constructor(e){super(e);this.placeholder="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}init(){const e=this.editor;e.plugins.has("ImageBlockEditing")&&e.editing.downcastDispatcher.on("attribute:uploadStatus:imageBlock",(...t)=>this.uploadStatusChange(...t)),e.plugins.has("ImageInlineEditing")&&e.editing.downcastDispatcher.on("attribute:uploadStatus:imageInline",(...t)=>this.uploadStatusChange(...t))}uploadStatusChange(e,t,n){const s=this.editor,o=t.item,r=o.getAttribute("uploadId");if(!n.consumable.consume(t.item,e.name))return;const a=s.plugins.get("ImageUtils"),l=s.plugins.get(pt),c=r?t.attributeNewValue:null,u=this.placeholder,d=s.editing.mapper.toViewElement(o),f=n.writer;if(c=="reading"){Dh(d,f),Bh(a,u,d,f);return}if(c=="uploading"){const b=l.loaders.get(r);Dh(d,f),b?(Fh(d,f),VS(d,f,b,s.editing.view),FS(a,d,f,b)):Bh(a,u,d,f);return}c=="complete"&&l.loaders.get(r)&&NS(d,f,s.editing.view),OS(d,f),Fh(d,f),MS(d,f)}}function Dh(i,e){i.hasClass("ck-appear")||e.addClass("ck-appear",i)}function MS(i,e){e.removeClass("ck-appear",i)}function Bh(i,e,t,n){t.hasClass("ck-image-upload-placeholder")||n.addClass("ck-image-upload-placeholder",t);const s=i.findViewImgElement(t);s.getAttribute("src")!==e&&n.setAttribute("src",e,s),Lh(t,"placeholder")||n.insert(n.createPositionAfter(s),BS(n))}function Fh(i,e){i.hasClass("ck-image-upload-placeholder")&&e.removeClass("ck-image-upload-placeholder",i),zh(i,e,"placeholder")}function VS(i,e,t,n){const s=DS(e);e.insert(e.createPositionAt(i,"end"),s),t.on("change:uploadedPercent",(o,r,a)=>{n.change(l=>{l.setStyle("width",a+"%",s)})})}function OS(i,e){zh(i,e,"progressBar")}function NS(i,e,t){const n=e.createUIElement("div",{class:"ck-image-upload-complete-icon"});e.insert(e.createPositionAt(i,"end"),n),setTimeout(()=>{t.change(s=>s.remove(s.createRangeOn(n)))},3e3)}function DS(i){const e=i.createUIElement("div",{class:"ck-progress-bar"});return i.setCustomProperty("progressBar",!0,e),e}function BS(i){const e=i.createUIElement("div",{class:"ck-upload-placeholder-loader"});return i.setCustomProperty("placeholder",!0,e),e}function Lh(i,e){for(const t of i.getChildren())if(t.getCustomProperty(e))return t}function zh(i,e,t){const n=Lh(i,t);n&&e.remove(e.createRangeOn(n))}function FS(i,e,t,n){if(n.data){const s=i.findViewImgElement(e);t.setAttribute("src",n.data,s)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class LS extends q{refresh(){const e=this.editor,t=e.plugins.get("ImageUtils"),n=e.model.document.selection.getSelectedElement();this.isEnabled=t.isImageAllowed()||t.isImage(n)}execute(e){const t=Ee(e.file),n=this.editor.model.document.selection,s=this.editor.plugins.get("ImageUtils"),o=Object.fromEntries(n.getAttributes());t.forEach((r,a)=>{const l=n.getSelectedElement();if(a&&l&&s.isImage(l)){const c=this.editor.model.createPositionAfter(l);this._uploadImage(r,o,c)}else this._uploadImage(r,o)})}_uploadImage(e,t,n){const s=this.editor,r=s.plugins.get(pt).createLoader(e),a=s.plugins.get("ImageUtils");!r||a.insertImage(pa($({},t),{uploadId:r.id}),n)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class zS extends P{static get requires(){return[pt,ir,gt,st]}static get pluginName(){return"ImageUploadEditing"}constructor(e){super(e);e.config.define("image",{upload:{types:["jpeg","png","gif","bmp","webp","tiff"]}}),this._uploadImageElements=new Map}init(){const e=this.editor,t=e.model.document,n=e.conversion,s=e.plugins.get(pt),o=e.plugins.get("ImageUtils"),r=Oh(e.config.get("image.upload.types")),a=new LS(e);e.commands.add("uploadImage",a),e.commands.add("imageUpload",a),n.for("upcast").attributeToAttribute({view:{name:"img",key:"uploadId"},model:"uploadId"}),this.listenTo(e.editing.view.document,"clipboardInput",(l,c)=>{if($S(c.dataTransfer))return;const u=Array.from(c.dataTransfer.files).filter(d=>d?r.test(d.type):!1);!u.length||(l.stop(),e.model.change(d=>{c.targetRanges&&d.setSelection(c.targetRanges.map(f=>e.editing.mapper.toModelRange(f))),e.model.enqueueChange("default",()=>{e.execute("uploadImage",{file:u})})}))}),this.listenTo(e.plugins.get("ClipboardPipeline"),"inputTransformation",(l,c)=>{const u=Array.from(e.editing.view.createRangeIn(c.content)).filter(f=>SS(o,f.item)&&!f.item.getAttribute("uploadProcessed")).map(f=>({promise:AS(f.item),imageElement:f.item}));if(!u.length)return;const d=new In(e.editing.view.document);for(const f of u){d.setAttribute("uploadProcessed",!0,f.imageElement);const b=s.createLoader(f.promise);b&&(d.setAttribute("src","",f.imageElement),d.setAttribute("uploadId",b.id,f.imageElement))}}),e.editing.view.document.on("dragover",(l,c)=>{c.preventDefault()}),t.on("change",()=>{const l=t.differ.getChanges({includeChangesInGraveyard:!0}).reverse(),c=new Set;for(const u of l)if(u.type=="insert"&&u.name!="$text"){const d=u.position.nodeAfter,f=u.position.root.rootName=="$graveyard";for(const b of HS(e,d)){const _=b.getAttribute("uploadId");if(!_)continue;const C=s.loaders.get(_);!C||(f?c.has(_)||C.abort():(c.add(_),this._uploadImageElements.set(_,b),C.status=="idle"&&this._readAndUpload(C)))}}}),this.on("uploadComplete",(l,{imageElement:c,data:u})=>{const d=u.urls?u.urls:u;this.editor.model.change(f=>{f.setAttribute("src",d.default,c),this._parseAndSetSrcsetAttributeOnImage(d,c,f)})},{priority:"low"})}afterInit(){const e=this.editor.model.schema;this.editor.plugins.has("ImageBlockEditing")&&e.extend("imageBlock",{allowAttributes:["uploadId","uploadStatus"]}),this.editor.plugins.has("ImageInlineEditing")&&e.extend("imageInline",{allowAttributes:["uploadId","uploadStatus"]})}_readAndUpload(e){const t=this.editor,n=t.model,s=t.locale.t,o=t.plugins.get(pt),r=t.plugins.get(ir),a=t.plugins.get("ImageUtils"),l=this._uploadImageElements;return n.enqueueChange("transparent",u=>{u.setAttribute("uploadStatus","reading",l.get(e.id))}),e.read().then(()=>{const u=e.upload(),d=l.get(e.id);if(ae.isSafari){const f=t.editing.mapper.toViewElement(d),b=a.findViewImgElement(f);t.editing.view.once("render",()=>{if(!b.parent)return;const _=t.editing.view.domConverter.mapViewToDom(b.parent);if(!_)return;const C=_.style.display;_.style.display="none",_._ckHack=_.offsetHeight,_.style.display=C})}return n.enqueueChange("transparent",f=>{f.setAttribute("uploadStatus","uploading",d)}),u}).then(u=>{n.enqueueChange("transparent",d=>{const f=l.get(e.id);d.setAttribute("uploadStatus","complete",f),this.fire("uploadComplete",{data:u,imageElement:f})}),c()}).catch(u=>{if(e.status!=="error"&&e.status!=="aborted")throw u;e.status=="error"&&u&&r.showWarning(u,{title:s("Upload failed"),namespace:"upload"}),n.enqueueChange("transparent",d=>{d.remove(l.get(e.id))}),c()});function c(){n.enqueueChange("transparent",u=>{const d=l.get(e.id);u.removeAttribute("uploadId",d),u.removeAttribute("uploadStatus",d),l.delete(e.id)}),o.destroyLoader(e)}}_parseAndSetSrcsetAttributeOnImage(e,t,n){let s=0;const o=Object.keys(e).filter(r=>{const a=parseInt(r,10);if(!isNaN(a))return s=Math.max(s,a),!0}).map(r=>`${e[r]} ${r}w`).join(", ");o!=""&&n.setAttribute("srcset",{data:o,width:s},t)}}function $S(i){return Array.from(i.types).includes("text/html")&&i.getData("text/html")!==""}function HS(i,e){const t=i.plugins.get("ImageUtils");return Array.from(i.model.createRangeOn(e)).filter(n=>t.isImage(n.item)).map(n=>n.item)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class US extends P{static get pluginName(){return"ImageUpload"}static get requires(){return[zS,IS,RS]}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class WS extends q{refresh(){const e=this.editor,n=e.plugins.get("ImageUtils").getClosestSelectedImageElement(e.model.document.selection);this.isEnabled=!!n,!n||!n.hasAttribute("width")?this.value=null:this.value={width:n.getAttribute("width"),height:null}}execute(e){const t=this.editor,n=t.model,o=t.plugins.get("ImageUtils").getClosestSelectedImageElement(n.document.selection);this.value={width:e.width,height:null},o&&n.change(r=>{r.setAttribute("width",e.width,o)})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class xr extends P{static get requires(){return[st]}static get pluginName(){return"ImageResizeEditing"}constructor(e){super(e);e.config.define("image",{resizeUnit:"%",resizeOptions:[{name:"resizeImage:original",value:null,icon:"original"},{name:"resizeImage:25",value:"25",icon:"small"},{name:"resizeImage:50",value:"50",icon:"medium"},{name:"resizeImage:75",value:"75",icon:"large"}]})}init(){const e=this.editor,t=new WS(e);this._registerSchema(),this._registerConverters("imageBlock"),this._registerConverters("imageInline"),e.commands.add("resizeImage",t),e.commands.add("imageResize",t)}_registerSchema(){this.editor.plugins.has("ImageBlockEditing")&&this.editor.model.schema.extend("imageBlock",{allowAttributes:"width"}),this.editor.plugins.has("ImageInlineEditing")&&this.editor.model.schema.extend("imageInline",{allowAttributes:"width"})}_registerConverters(e){const t=this.editor;t.conversion.for("downcast").add(n=>n.on(`attribute:width:${e}`,(s,o,r)=>{if(!r.consumable.consume(o.item,s.name))return;const a=r.writer,l=r.mapper.toViewElement(o.item);o.attributeNewValue!==null?(a.setStyle("width",o.attributeNewValue,l),a.addClass("image_resized",l)):(a.removeStyle("width",l),a.removeClass("image_resized",l))})),t.conversion.for("upcast").attributeToAttribute({view:{name:e==="imageBlock"?"figure":"img",styles:{width:/.+/}},model:{key:"width",value:n=>n.getStyle("width")}})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Pr={small:Ve.objectSizeSmall,medium:Ve.objectSizeMedium,large:Ve.objectSizeLarge,original:Ve.objectSizeFull};class qS extends P{static get requires(){return[xr]}static get pluginName(){return"ImageResizeButtons"}constructor(e){super(e);this._resizeUnit=e.config.get("image.resizeUnit")}init(){const e=this.editor,t=e.config.get("image.resizeOptions"),n=e.commands.get("resizeImage");this.bind("isEnabled").to(n);for(const s of t)this._registerImageResizeButton(s);this._registerImageResizeDropdown(t)}_registerImageResizeButton(e){const t=this.editor,{name:n,value:s,icon:o}=e,r=s?s+this._resizeUnit:null;t.ui.componentFactory.add(n,a=>{const l=new le(a),c=t.commands.get("resizeImage"),u=this._getOptionLabelValue(e,!0);if(!Pr[o])throw new p("imageresizebuttons-missing-icon",t,e);return l.set({label:u,icon:Pr[o],tooltip:u,isToggleable:!0}),l.bind("isEnabled").to(this),l.bind("isOn").to(c,"value",$h(r)),this.listenTo(l,"execute",()=>{t.execute("resizeImage",{width:r})}),l})}_registerImageResizeDropdown(e){const t=this.editor,n=t.t,s=e.find(r=>!r.value),o=r=>{const a=t.commands.get("resizeImage"),l=Lt(r,Yo),c=l.buttonView;return c.set({tooltip:n("Resize image"),commandValue:s.value,icon:Pr.medium,isToggleable:!0,label:this._getOptionLabelValue(s),withText:!0,class:"ck-resize-image-button"}),c.bind("label").to(a,"value",u=>u&&u.width?u.width:this._getOptionLabelValue(s)),l.bind("isOn").to(a),l.bind("isEnabled").to(this),er(l,this._getResizeDropdownListItemDefinitions(e,a)),l.listView.ariaLabel=n("Image resize list"),this.listenTo(l,"execute",u=>{t.execute(u.source.commandName,{width:u.source.commandValue}),t.editing.view.focus()}),l};t.ui.componentFactory.add("resizeImage",o),t.ui.componentFactory.add("imageResize",o)}_getOptionLabelValue(e,t){const n=this.editor.t;return e.label?e.label:t?e.value?n("Resize image to %0",e.value+this._resizeUnit):n("Resize image to the original size"):e.value?e.value+this._resizeUnit:n("Original")}_getResizeDropdownListItemDefinitions(e,t){const n=new $e;return e.map(s=>{const o=s.value?s.value+this._resizeUnit:null,r={type:"button",model:new ss({commandName:"resizeImage",commandValue:o,label:this._getOptionLabelValue(s),withText:!0,icon:null})};r.model.bind("isOn").to(t,"value",$h(o)),n.add(r)}),n}}function $h(i){return e=>i===null&&e===i?!0:e&&e.width===i}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const jS="figure.image.ck-widget > img,figure.image.ck-widget > picture > img,figure.image.ck-widget > a > img,figure.image.ck-widget > a > picture > img,span.image-inline.ck-widget > img,span.image-inline.ck-widget > picture > img",KS=/(image|image-inline)/,Ir="image_resized";class Hh extends P{static get requires(){return[ws]}static get pluginName(){return"ImageResizeHandles"}init(){const e=this.editor.commands.get("resizeImage");this.bind("isEnabled").to(e),this._setupResizerCreator()}_setupResizerCreator(){const e=this.editor,t=e.editing.view;t.addObserver(wh),this.listenTo(t.document,"imageLoaded",(n,s)=>{if(!s.target.matches(jS))return;const o=e.editing.view.domConverter,a=o.domToView(s.target).findAncestor({classes:KS});let l=this.editor.plugins.get(ws).getResizerByViewElement(a);if(l){l.redraw();return}const c=e.editing.mapper,u=c.toModelElement(a);l=e.plugins.get(ws).attachTo({unit:e.config.get("image.resizeUnit"),modelElement:u,viewElement:a,editor:e,getHandleHost(d){return d.querySelector("img")},getResizeHost(){return o.viewToDom(c.toViewElement(u.parent))},isCentered(){const d=u.getAttribute("imageStyle");return!d||d=="block"||d=="alignCenter"},onCommit(d){t.change(f=>{f.removeClass(Ir,a)}),e.execute("resizeImage",{width:d})}}),l.on("updateSize",()=>{a.hasClass(Ir)||t.change(d=>{d.addClass(Ir,a)})}),l.bind("isEnabled").to(this)})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class GS extends P{static get requires(){return[xr,Hh,qS]}static get pluginName(){return"ImageResize"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class JS extends P{static get pluginName(){return"IndentEditing"}init(){const e=this.editor;e.commands.add("indent",new Yl(e)),e.commands.add("outdent",new Yl(e))}}var Uh='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm5 6c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zM2.75 16.5h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 1 0 0 1.5zM1.632 6.95 5.02 9.358a.4.4 0 0 1-.013.661l-3.39 2.207A.4.4 0 0 1 1 11.892V7.275a.4.4 0 0 1 .632-.326z"/></svg>',Wh='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 3.75c0 .414.336.75.75.75h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 0 0-.75.75zm5 6c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zM2.75 16.5h14.5a.75.75 0 1 0 0-1.5H2.75a.75.75 0 1 0 0 1.5zm1.618-9.55L.98 9.358a.4.4 0 0 0 .013.661l3.39 2.207A.4.4 0 0 0 5 11.892V7.275a.4.4 0 0 0-.632-.326z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class QS extends P{static get pluginName(){return"IndentUI"}init(){const e=this.editor,t=e.locale,n=e.t,s=t.uiLanguageDirection=="ltr"?Uh:Wh,o=t.uiLanguageDirection=="ltr"?Wh:Uh;this._defineButton("indent",n("Increase indent"),s),this._defineButton("outdent",n("Decrease indent"),o)}_defineButton(e,t,n){const s=this.editor;s.ui.componentFactory.add(e,o=>{const r=s.commands.get(e),a=new le(o);return a.set({label:t,icon:n,tooltip:!0}),a.bind("isOn","isEnabled").to(r,"value","isEnabled"),this.listenTo(a,"execute",()=>{s.execute(e),s.editing.view.focus()}),a})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class YS extends P{static get pluginName(){return"Indent"}static get requires(){return[JS,QS]}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md.
 */class XS{constructor(){this._definitions=new Set}get length(){return this._definitions.size}add(e){Array.isArray(e)?e.forEach(t=>this._definitions.add(t)):this._definitions.add(e)}getDispatcher(){return e=>{e.on("attribute:linkHref",(t,n,s)=>{if(!s.consumable.test(n.item,"attribute:linkHref"))return;const o=s.writer,r=o.document.selection;for(const a of this._definitions){const l=o.createAttributeElement("a",a.attributes,{priority:5});a.classes&&o.addClass(a.classes,l);for(const c in a.styles)o.setStyle(c,a.styles[c],l);o.setCustomProperty("link",!0,l),a.callback(n.attributeNewValue)?n.item.is("selection")?o.wrap(r.getFirstRange(),l):o.wrap(s.mapper.toViewRange(n.range),l):o.unwrap(s.mapper.toViewRange(n.range),l)}},{priority:"high"})}}getDispatcherForLinkedImage(){return e=>{e.on("attribute:linkHref:imageBlock",(t,n,{writer:s,mapper:o})=>{const r=o.toViewElement(n.item),a=Array.from(r.getChildren()).find(l=>l.name==="a");for(const l of this._definitions){const c=Tt(l.attributes);if(l.callback(n.attributeNewValue)){for(const[u,d]of c)u==="class"?s.addClass(d,a):s.setAttribute(u,d,a);l.classes&&s.addClass(l.classes,a);for(const u in l.styles)s.setStyle(u,l.styles[u],a)}else{for(const[u,d]of c)u==="class"?s.removeClass(d,a):s.removeAttribute(u,a);l.classes&&s.removeClass(l.classes,a);for(const u in l.styles)s.removeStyle(u,a)}}})}}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const ZS=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,ex=/^(?:(?:https?|ftps?|mailto):|[^a-z]|[a-z+.-]+(?:[^a-z+.:-]|$))/i,tx=/^[\S]+@((?![-_])(?:[-\w\u00a1-\uffff]{0,63}[^-_]\.))+(?:[a-z\u00a1-\uffff]{2,})$/i,nx=/^((\w+:(\/{2,})?)|(\W))/i,Rr="Ctrl+K";function ix(i){return i.is("attributeElement")&&!!i.getCustomProperty("link")}function qh(i,{writer:e}){const t=e.createAttributeElement("a",{href:i},{priority:5});return e.setCustomProperty("link",!0,t),t}function jh(i){return i=String(i),sx(i)?i:"#"}function sx(i){return i.replace(ZS,"").match(ex)}function ox(i,e){const t={"Open in a new tab":i("Open in a new tab"),Downloadable:i("Downloadable")};return e.forEach(n=>(n.label&&t[n.label]&&(n.label=t[n.label]),n)),e}function rx(i){const e=[];if(i)for(const[t,n]of Object.entries(i)){const s=Object.assign({},n,{id:`link${Sb(t)}`});e.push(s)}return e}function Mr(i,e){return i?e.checkAttribute(i.name,"linkHref"):!1}function ax(i){return tx.test(i)}function Kh(i,e){const t=ax(i)?"mailto:":e,n=!!t&&!nx.test(i);return i&&n?t+i:i}function Gh(i){window.open(i,"_blank","noopener")}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class lx extends q{constructor(e){super(e);this.manualDecorators=new $e,this.automaticDecorators=new XS}restoreManualDecoratorStates(){for(const e of this.manualDecorators)e.value=this._getDecoratorStateFromModel(e.id)}refresh(){const e=this.editor.model,t=e.document.selection,n=t.getSelectedElement()||De(t.getSelectedBlocks());Mr(n,e.schema)?(this.value=n.getAttribute("linkHref"),this.isEnabled=e.schema.checkAttribute(n,"linkHref")):(this.value=t.getAttribute("linkHref"),this.isEnabled=e.schema.checkAttributeInSelection(t,"linkHref"));for(const s of this.manualDecorators)s.value=this._getDecoratorStateFromModel(s.id)}execute(e,t={}){const n=this.editor.model,s=n.document.selection,o=[],r=[];for(const a in t)t[a]?o.push(a):r.push(a);n.change(a=>{if(s.isCollapsed){const l=s.getFirstPosition();if(s.hasAttribute("linkHref")){const c=On(l,"linkHref",s.getAttribute("linkHref"),n);a.setAttribute("linkHref",e,c),o.forEach(u=>{a.setAttribute(u,!0,c)}),r.forEach(u=>{a.removeAttribute(u,c)}),a.setSelection(a.createPositionAfter(c.end.nodeBefore))}else if(e!==""){const c=Tt(s.getAttributes());c.set("linkHref",e),o.forEach(d=>{c.set(d,!0)});const{end:u}=n.insertContent(a.createText(e,c),l);a.setSelection(u)}["linkHref",...o,...r].forEach(c=>{a.removeSelectionAttribute(c)})}else{const l=n.schema.getValidRanges(s.getRanges(),"linkHref"),c=[];for(const d of s.getSelectedBlocks())n.schema.checkAttribute(d,"linkHref")&&c.push(a.createRangeOn(d));const u=c.slice();for(const d of l)this._isRangeToUpdate(d,c)&&u.push(d);for(const d of u)a.setAttribute("linkHref",e,d),o.forEach(f=>{a.setAttribute(f,!0,d)}),r.forEach(f=>{a.removeAttribute(f,d)})}})}_getDecoratorStateFromModel(e){const t=this.editor.model,n=t.document.selection,s=n.getSelectedElement();return Mr(s,t.schema)?s.getAttribute(e):n.getAttribute(e)}_isRangeToUpdate(e,t){for(const n of t)if(n.containsRange(e))return!1;return!0}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class cx extends q{refresh(){const e=this.editor.model,t=e.document.selection,n=t.getSelectedElement();Mr(n,e.schema)?this.isEnabled=e.schema.checkAttribute(n,"linkHref"):this.isEnabled=e.schema.checkAttributeInSelection(t,"linkHref")}execute(){const e=this.editor,t=this.editor.model,n=t.document.selection,s=e.commands.get("link");t.change(o=>{const r=n.isCollapsed?[On(n.getFirstPosition(),"linkHref",n.getAttribute("linkHref"),t)]:t.schema.getValidRanges(n.getRanges(),"linkHref");for(const a of r)if(o.removeAttribute("linkHref",a),s)for(const l of s.manualDecorators)o.removeAttribute(l.id,a)})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Jh{constructor({id:e,label:t,attributes:n,classes:s,styles:o,defaultValue:r}){this.id=e,this.set("value"),this.defaultValue=r,this.label=t,this.attributes=n,this.classes=s,this.styles=o}_createPattern(){return{attributes:this.attributes,classes:this.classes,styles:this.styles}}}F(Jh,re);/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const ux="ck-link_selected",Qh="automatic",dx="manual",hx=/^(https?:)?\/\//;class fx extends P{static get pluginName(){return"LinkEditing"}static get requires(){return[ds,Wd,gt]}constructor(e){super(e);e.config.define("link",{addTargetToExternalLinks:!1})}init(){const e=this.editor;e.model.schema.extend("$text",{allowAttributes:"linkHref"}),e.conversion.for("dataDowncast").attributeToElement({model:"linkHref",view:qh}),e.conversion.for("editingDowncast").attributeToElement({model:"linkHref",view:(s,o)=>qh(jh(s),o)}),e.conversion.for("upcast").elementToAttribute({view:{name:"a",attributes:{href:!0}},model:{key:"linkHref",value:s=>s.getAttribute("href")}}),e.commands.add("link",new lx(e)),e.commands.add("unlink",new cx(e));const t=ox(e.t,rx(e.config.get("link.decorators")));this._enableAutomaticDecorators(t.filter(s=>s.mode===Qh)),this._enableManualDecorators(t.filter(s=>s.mode===dx)),e.plugins.get(ds).registerAttribute("linkHref"),Gd(e,"linkHref","a",ux),this._enableLinkOpen(),this._enableInsertContentSelectionAttributesFixer(),this._enableClickingAfterLink(),this._enableTypingOverLink(),this._handleDeleteContentAfterLink()}_enableAutomaticDecorators(e){const t=this.editor,s=t.commands.get("link").automaticDecorators;t.config.get("link.addTargetToExternalLinks")&&s.add({id:"linkIsExternal",mode:Qh,callback:o=>hx.test(o),attributes:{target:"_blank",rel:"noopener noreferrer"}}),s.add(e),s.length&&t.conversion.for("downcast").add(s.getDispatcher())}_enableManualDecorators(e){if(!e.length)return;const t=this.editor,s=t.commands.get("link").manualDecorators;e.forEach(o=>{t.model.schema.extend("$text",{allowAttributes:o.id}),o=new Jh(o),s.add(o),t.conversion.for("downcast").attributeToElement({model:o.id,view:(r,{writer:a})=>{if(r){const l=a.createAttributeElement("a",o.attributes,{priority:5});o.classes&&a.addClass(o.classes,l);for(const c in o.styles)a.setStyle(c,o.styles[c],l);return a.setCustomProperty("link",!0,l),l}}}),t.conversion.for("upcast").elementToAttribute({view:$({name:"a"},o._createPattern()),model:{key:o.id}})})}_enableLinkOpen(){const e=this.editor,n=e.editing.view.document,s=e.model.document;this.listenTo(n,"click",(o,r)=>{if(!(ae.isMac?r.domEvent.metaKey:r.domEvent.ctrlKey))return;let l=r.domTarget;if(l.tagName.toLowerCase()!="a"&&(l=l.closest("a")),!l)return;const c=l.getAttribute("href");!c||(o.stop(),r.preventDefault(),Gh(c))},{context:"$capture"}),this.listenTo(n,"enter",(o,r)=>{const a=s.selection,l=a.getSelectedElement(),c=l?l.getAttribute("linkHref"):a.getAttribute("linkHref");!(c&&r.domEvent.altKey)||(o.stop(),Gh(c))},{context:"a"})}_enableInsertContentSelectionAttributesFixer(){const t=this.editor.model,n=t.document.selection;this.listenTo(t,"insertContent",()=>{const s=n.anchor.nodeBefore,o=n.anchor.nodeAfter;!n.hasAttribute("linkHref")||!s||!s.hasAttribute("linkHref")||o&&o.hasAttribute("linkHref")||t.change(r=>{Vr(r,Or(t.schema))})},{priority:"low"})}_enableClickingAfterLink(){const e=this.editor,t=e.model;e.editing.view.addObserver(ls);let n=!1;this.listenTo(e.editing.view.document,"mousedown",()=>{n=!0}),this.listenTo(e.editing.view.document,"selectionChange",()=>{if(!n)return;n=!1;const s=t.document.selection;if(!s.isCollapsed||!s.hasAttribute("linkHref"))return;const o=s.getFirstPosition(),r=On(o,"linkHref",s.getAttribute("linkHref"),t);(o.isTouching(r.start)||o.isTouching(r.end))&&t.change(a=>{Vr(a,Or(t.schema))})})}_enableTypingOverLink(){const e=this.editor,t=e.editing.view;let n,s;this.listenTo(t.document,"delete",()=>{s=!0},{priority:"high"}),this.listenTo(e.model,"deleteContent",()=>{const o=e.model.document.selection;if(!o.isCollapsed){if(s){s=!1;return}!Yh(e)||mx(e.model)&&(n=o.getAttributes())}},{priority:"high"}),this.listenTo(e.model,"insertContent",(o,[r])=>{s=!1,!!Yh(e)&&(!n||(e.model.change(a=>{for(const[l,c]of n)a.setAttribute(l,c,r)}),n=null))},{priority:"high"})}_handleDeleteContentAfterLink(){const e=this.editor,t=e.model,n=t.document.selection,s=e.editing.view;let o=!1,r=!1;this.listenTo(s.document,"delete",(a,l)=>{r=l.domEvent.keyCode===K.backspace},{priority:"high"}),this.listenTo(t,"deleteContent",()=>{o=!1;const a=n.getFirstPosition(),l=n.getAttribute("linkHref");if(!l)return;const c=On(a,"linkHref",l,t);o=c.containsPosition(a)||c.end.isEqual(a)},{priority:"high"}),this.listenTo(t,"deleteContent",()=>{!r||(r=!1,!o&&e.model.enqueueChange(a=>{Vr(a,Or(t.schema))}))},{priority:"low"})}}function Vr(i,e){i.removeSelectionAttribute("linkHref");for(const t of e)i.removeSelectionAttribute(t)}function mx(i){const e=i.document.selection,t=e.getFirstPosition(),n=e.getLastPosition(),s=t.nodeAfter;if(!s||!s.is("$text")||!s.hasAttribute("linkHref"))return!1;const o=n.textNode||n.nodeBefore;return s===o?!0:On(t,"linkHref",s.getAttribute("linkHref"),i).containsRange(i.createRange(t,n),!0)}function Yh(i){return i.plugins.get("Input").isInput(i.model.change(t=>t.batch))}function Or(i){return i.getDefinition("$text").allowAttributes.filter(t=>t.startsWith("link"))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class gx extends j{constructor(e,t){super(e);const n=e.t;this.focusTracker=new Je,this.keystrokes=new At,this.urlInputView=this._createUrlInput(),this.saveButtonView=this._createButton(n("Save"),Ve.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(n("Cancel"),Ve.cancel,"ck-button-cancel","cancel"),this._manualDecoratorSwitches=this._createManualDecoratorSwitches(t),this.children=this._createFormChildren(t.manualDecorators),this._focusables=new an,this._focusCycler=new Sn({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}});const s=["ck","ck-link-form","ck-responsive-form"];t.manualDecorators.length&&s.push("ck-link-form_layout-vertical","ck-vertical-form"),this.setTemplate({tag:"form",attributes:{class:s,tabindex:"-1"},children:this.children}),qo(this)}getDecoratorSwitchesState(){return Array.from(this._manualDecoratorSwitches).reduce((e,t)=>(e[t.name]=t.isOn,e),{})}render(){super.render(),jo({view:this}),[this.urlInputView,...this._manualDecoratorSwitches,this.saveButtonView,this.cancelButtonView].forEach(t=>{this._focusables.add(t),this.focusTracker.add(t.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createUrlInput(){const e=this.locale.t,t=new tr(this.locale,nr);return t.label=e("Link URL"),t}_createButton(e,t,n,s){const o=new le(this.locale);return o.set({label:e,icon:t,tooltip:!0}),o.extendTemplate({attributes:{class:n}}),s&&o.delegate("execute").to(this,s),o}_createManualDecoratorSwitches(e){const t=this.createCollection();for(const n of e.manualDecorators){const s=new Jo(this.locale);s.set({name:n.id,label:n.label,withText:!0}),s.bind("isOn").toMany([n,e],"value",(o,r)=>r===void 0&&o===void 0?n.defaultValue:o),s.on("execute",()=>{n.set("value",!s.isOn)}),t.add(s)}return t}_createFormChildren(e){const t=this.createCollection();if(t.add(this.urlInputView),e.length){const n=new j;n.setTemplate({tag:"ul",children:this._manualDecoratorSwitches.map(s=>({tag:"li",children:[s],attributes:{class:["ck","ck-list__item"]}})),attributes:{class:["ck","ck-reset","ck-list"]}}),t.add(n)}return t.add(this.saveButtonView),t.add(this.cancelButtonView),t}}var px='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.077 15 .991-1.416a.75.75 0 1 1 1.229.86l-1.148 1.64a.748.748 0 0 1-.217.206 5.251 5.251 0 0 1-8.503-5.955.741.741 0 0 1 .12-.274l1.147-1.639a.75.75 0 1 1 1.228.86L4.933 10.7l.006.003a3.75 3.75 0 0 0 6.132 4.294l.006.004zm5.494-5.335a.748.748 0 0 1-.12.274l-1.147 1.639a.75.75 0 1 1-1.228-.86l.86-1.23a3.75 3.75 0 0 0-6.144-4.301l-.86 1.229a.75.75 0 0 1-1.229-.86l1.148-1.64a.748.748 0 0 1 .217-.206 5.251 5.251 0 0 1 8.503 5.955zm-4.563-2.532a.75.75 0 0 1 .184 1.045l-3.155 4.505a.75.75 0 1 1-1.229-.86l3.155-4.506a.75.75 0 0 1 1.045-.184zm4.919 10.562-1.414 1.414a.75.75 0 1 1-1.06-1.06l1.414-1.415-1.415-1.414a.75.75 0 0 1 1.061-1.06l1.414 1.414 1.414-1.415a.75.75 0 0 1 1.061 1.061l-1.414 1.414 1.414 1.415a.75.75 0 0 1-1.06 1.06l-1.415-1.414z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class wx extends j{constructor(e){super(e);const t=e.t;this.focusTracker=new Je,this.keystrokes=new At,this.previewButtonView=this._createPreviewButton(),this.unlinkButtonView=this._createButton(t("Unlink"),px,"unlink"),this.editButtonView=this._createButton(t("Edit link"),Ve.pencil,"edit"),this.set("href"),this._focusables=new an,this._focusCycler=new Sn({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-link-actions","ck-responsive-form"],tabindex:"-1"},children:[this.previewButtonView,this.editButtonView,this.unlinkButtonView]})}render(){super.render(),[this.previewButtonView,this.editButtonView,this.unlinkButtonView].forEach(t=>{this._focusables.add(t),this.focusTracker.add(t.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createButton(e,t,n){const s=new le(this.locale);return s.set({label:e,icon:t,tooltip:!0}),s.delegate("execute").to(this,n),s}_createPreviewButton(){const e=new le(this.locale),t=this.bindTemplate,n=this.t;return e.set({withText:!0,tooltip:n("Open link in new tab")}),e.extendTemplate({attributes:{class:["ck","ck-link-actions__preview"],href:t.to("href",s=>s&&jh(s)),target:"_blank",rel:"noopener noreferrer"}}),e.bind("label").to(this,"href",s=>s||n("This link has no URL")),e.bind("isEnabled").to(this,"href",s=>!!s),e.template.tag="a",e.template.eventListeners={},e}}var bx='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.077 15 .991-1.416a.75.75 0 1 1 1.229.86l-1.148 1.64a.748.748 0 0 1-.217.206 5.251 5.251 0 0 1-8.503-5.955.741.741 0 0 1 .12-.274l1.147-1.639a.75.75 0 1 1 1.228.86L4.933 10.7l.006.003a3.75 3.75 0 0 0 6.132 4.294l.006.004zm5.494-5.335a.748.748 0 0 1-.12.274l-1.147 1.639a.75.75 0 1 1-1.228-.86l.86-1.23a3.75 3.75 0 0 0-6.144-4.301l-.86 1.229a.75.75 0 0 1-1.229-.86l1.148-1.64a.748.748 0 0 1 .217-.206 5.251 5.251 0 0 1 8.503 5.955zm-4.563-2.532a.75.75 0 0 1 .184 1.045l-3.155 4.505a.75.75 0 1 1-1.229-.86l3.155-4.506a.75.75 0 0 1 1.045-.184z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const wt="link-ui";class _x extends P{static get requires(){return[rs]}static get pluginName(){return"LinkUI"}init(){const e=this.editor;e.editing.view.addObserver(kT),this.actionsView=this._createActionsView(),this.formView=this._createFormView(),this._balloon=e.plugins.get(rs),this._createToolbarLinkButton(),this._enableUserBalloonInteractions(),e.conversion.for("editingDowncast").markerToHighlight({model:wt,view:{classes:["ck-fake-link-selection"]}}),e.conversion.for("editingDowncast").markerToElement({model:wt,view:{name:"span",classes:["ck-fake-link-selection","ck-fake-link-selection_collapsed"]}})}destroy(){super.destroy(),this.formView.destroy()}_createActionsView(){const e=this.editor,t=new wx(e.locale),n=e.commands.get("link"),s=e.commands.get("unlink");return t.bind("href").to(n,"value"),t.editButtonView.bind("isEnabled").to(n),t.unlinkButtonView.bind("isEnabled").to(s),this.listenTo(t,"edit",()=>{this._addFormView()}),this.listenTo(t,"unlink",()=>{e.execute("unlink"),this._hideUI()}),t.keystrokes.set("Esc",(o,r)=>{this._hideUI(),r()}),t.keystrokes.set(Rr,(o,r)=>{this._addFormView(),r()}),t}_createFormView(){const e=this.editor,t=e.commands.get("link"),n=e.config.get("link.defaultProtocol"),s=new gx(e.locale,t);return s.urlInputView.fieldView.bind("value").to(t,"value"),s.urlInputView.bind("isReadOnly").to(t,"isEnabled",o=>!o),s.saveButtonView.bind("isEnabled").to(t),this.listenTo(s,"submit",()=>{const{value:o}=s.urlInputView.fieldView.element,r=Kh(o,n);e.execute("link",r,s.getDecoratorSwitchesState()),this._closeFormView()}),this.listenTo(s,"cancel",()=>{this._closeFormView()}),s.keystrokes.set("Esc",(o,r)=>{this._closeFormView(),r()}),s}_createToolbarLinkButton(){const e=this.editor,t=e.commands.get("link"),n=e.t;e.keystrokes.set(Rr,(s,o)=>{o(),t.isEnabled&&this._showUI(!0)}),e.ui.componentFactory.add("link",s=>{const o=new le(s);return o.isEnabled=!0,o.label=n("Link"),o.icon=bx,o.keystroke=Rr,o.tooltip=!0,o.isToggleable=!0,o.bind("isEnabled").to(t,"isEnabled"),o.bind("isOn").to(t,"value",r=>!!r),this.listenTo(o,"execute",()=>this._showUI(!0)),o})}_enableUserBalloonInteractions(){const e=this.editor.editing.view.document;this.listenTo(e,"click",()=>{this._getSelectedLinkElement()&&this._showUI()}),this.editor.keystrokes.set("Tab",(t,n)=>{this._areActionsVisible&&!this.actionsView.focusTracker.isFocused&&(this.actionsView.focus(),n())},{priority:"high"}),this.editor.keystrokes.set("Esc",(t,n)=>{this._isUIVisible&&(this._hideUI(),n())}),Wo({emitter:this.formView,activator:()=>this._isUIInPanel,contextElements:[this._balloon.view.element],callback:()=>this._hideUI()})}_addActionsView(){this._areActionsInPanel||this._balloon.add({view:this.actionsView,position:this._getBalloonPositionData()})}_addFormView(){if(this._isFormInPanel)return;const t=this.editor.commands.get("link");this.formView.disableCssTransitions(),this._balloon.add({view:this.formView,position:this._getBalloonPositionData()}),this._balloon.visibleView===this.formView&&this.formView.urlInputView.fieldView.select(),this.formView.enableCssTransitions(),this.formView.urlInputView.fieldView.element.value=t.value||""}_closeFormView(){const e=this.editor.commands.get("link");e.restoreManualDecoratorStates(),e.value!==void 0?this._removeFormView():this._hideUI()}_removeFormView(){this._isFormInPanel&&(this.formView.saveButtonView.focus(),this._balloon.remove(this.formView),this.editor.editing.view.focus(),this._hideFakeVisualSelection())}_showUI(e=!1){this._getSelectedLinkElement()?(this._areActionsVisible?this._addFormView():this._addActionsView(),e&&this._balloon.showStack("main")):(this._showFakeVisualSelection(),this._addActionsView(),e&&this._balloon.showStack("main"),this._addFormView()),this._startUpdatingUI()}_hideUI(){if(!this._isUIInPanel)return;const e=this.editor;this.stopListening(e.ui,"update"),this.stopListening(this._balloon,"change:visibleView"),e.editing.view.focus(),this._removeFormView(),this._balloon.remove(this.actionsView),this._hideFakeVisualSelection()}_startUpdatingUI(){const e=this.editor,t=e.editing.view.document;let n=this._getSelectedLinkElement(),s=r();const o=()=>{const a=this._getSelectedLinkElement(),l=r();n&&!a||!n&&l!==s?this._hideUI():this._isUIVisible&&this._balloon.updatePosition(this._getBalloonPositionData()),n=a,s=l};function r(){return t.selection.focus.getAncestors().reverse().find(a=>a.is("element"))}this.listenTo(e.ui,"update",o),this.listenTo(this._balloon,"change:visibleView",o)}get _isFormInPanel(){return this._balloon.hasView(this.formView)}get _areActionsInPanel(){return this._balloon.hasView(this.actionsView)}get _areActionsVisible(){return this._balloon.visibleView===this.actionsView}get _isUIInPanel(){return this._isFormInPanel||this._areActionsInPanel}get _isUIVisible(){return this._balloon.visibleView==this.formView||this._areActionsVisible}_getBalloonPositionData(){const e=this.editor.editing.view,t=this.editor.model,n=e.document;let s=null;if(t.markers.has(wt)){const o=Array.from(this.editor.editing.mapper.markerNameToElements(wt)),r=e.createRange(e.createPositionBefore(o[0]),e.createPositionAfter(o[o.length-1]));s=e.domConverter.viewRangeToDom(r)}else s=()=>{const o=this._getSelectedLinkElement();return o?e.domConverter.mapViewToDom(o):e.domConverter.viewRangeToDom(n.selection.getFirstRange())};return{target:s}}_getSelectedLinkElement(){const e=this.editor.editing.view,t=e.document.selection,n=t.getSelectedElement();if(t.isCollapsed||n&&we(n))return Nr(t.getFirstPosition());{const s=t.getFirstRange().getTrimmed(),o=Nr(s.start),r=Nr(s.end);return!o||o!=r?null:e.createRangeIn(o).getTrimmed().isEqual(s)?o:null}}_showFakeVisualSelection(){const e=this.editor.model;e.change(t=>{const n=e.document.selection.getFirstRange();if(e.markers.has(wt))t.updateMarker(wt,{range:n});else if(n.start.isAtEnd){const s=n.start.getLastMatchingPosition(({item:o})=>!e.schema.isContent(o),{boundaries:n});t.addMarker(wt,{usingOperation:!1,affectsData:!1,range:t.createRange(s,n.end)})}else t.addMarker(wt,{usingOperation:!1,affectsData:!1,range:n})})}_hideFakeVisualSelection(){const e=this.editor.model;e.markers.has(wt)&&e.change(t=>{t.removeMarker(wt)})}}function Nr(i){return i.getAncestors().find(e=>ix(e))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const vx=4,yx=new RegExp("(^|\\s)(((?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(((?!www\\.)|(www\\.))(?![-_])(?:[-_a-z0-9\\u00a1-\\uffff]{1,63}\\.)+(?:[a-z\\u00a1-\\uffff]{2,63})))(?::\\d{2,5})?(?:[/?#]\\S*)?)|((www.|(\\S+@))((?![-_])(?:[-_a-z0-9\\u00a1-\\uffff]{1,63}\\.))+(?:[a-z\\u00a1-\\uffff]{2,63})))$","i"),Cx=2;class kx extends P{static get requires(){return[zt]}static get pluginName(){return"AutoLink"}init(){const t=this.editor.model.document.selection;t.on("change:range",()=>{this.isEnabled=!t.anchor.parent.is("element","codeBlock")}),this._enableTypingHandling()}afterInit(){this._enableEnterHandling(),this._enableShiftEnterHandling()}_enableTypingHandling(){const e=this.editor,t=new dr(e.model,s=>{if(!Tx(s))return;const o=Xh(s.substr(0,s.length-1));if(o)return{url:o}}),n=e.plugins.get("Input");t.on("matched:data",(s,o)=>{const{batch:r,range:a,url:l}=o;if(!n.isInput(r))return;const c=a.end.getShiftedBy(-1),u=c.getShiftedBy(-l.length),d=e.model.createRange(u,c);this._applyAutoLink(l,d)}),t.bind("isEnabled").to(this)}_enableEnterHandling(){const e=this.editor,t=e.model,n=e.commands.get("enter");!n||n.on("execute",()=>{const s=t.document.selection.getFirstPosition();if(!s.parent.previousSibling)return;const o=t.createRangeIn(s.parent.previousSibling);this._checkAndApplyAutoLinkOnRange(o)})}_enableShiftEnterHandling(){const e=this.editor,t=e.model,n=e.commands.get("shiftEnter");!n||n.on("execute",()=>{const s=t.document.selection.getFirstPosition(),o=t.createRange(t.createPositionAt(s.parent,0),s.getShiftedBy(-1));this._checkAndApplyAutoLinkOnRange(o)})}_checkAndApplyAutoLinkOnRange(e){const t=this.editor.model,{text:n,range:s}=qd(e,t),o=Xh(n);if(o){const r=t.createRange(s.end.getShiftedBy(-o.length),s.end);this._applyAutoLink(o,r)}}_applyAutoLink(e,t){const n=this.editor.model,s=this.editor.plugins.get("Delete");!this.isEnabled||!Ex(t,n)||n.enqueueChange(o=>{const r=this.editor.config.get("link.defaultProtocol"),a=Kh(e,r);o.setAttribute("linkHref",a,t),n.enqueueChange(()=>{s.requestUndoOnBackspace()})})}}function Tx(i){return i.length>vx&&i[i.length-1]===" "&&i[i.length-2]!==" "}function Xh(i){const e=yx.exec(i);return e?e[Cx]:null}function Ex(i,e){return e.schema.checkAttributeInSelection(e.createSelection(i),"linkHref")}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ax extends P{static get requires(){return[fx,_x,kx]}static get pluginName(){return"Link"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Zh extends q{constructor(e,t){super(e);this.type=t}refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(e={}){const t=this.editor.model,n=t.document,s=Array.from(n.selection.getSelectedBlocks()).filter(r=>tf(r,t.schema)),o=e.forceValue!==void 0?!e.forceValue:this.value;t.change(r=>{if(o){let a=s[s.length-1].nextSibling,l=Number.POSITIVE_INFINITY,c=[];for(;a&&a.name=="listItem"&&a.getAttribute("listIndent")!==0;){const u=a.getAttribute("listIndent");u<l&&(l=u);const d=u-l;c.push({element:a,listIndent:d}),a=a.nextSibling}c=c.reverse();for(const u of c)r.setAttribute("listIndent",u.listIndent,u.element)}if(!o){let a=Number.POSITIVE_INFINITY;for(const l of s)l.is("element","listItem")&&l.getAttribute("listIndent")<a&&(a=l.getAttribute("listIndent"));a=a===0?1:a,ef(s,!0,a),ef(s,!1,a)}for(const a of s.reverse())o&&a.name=="listItem"?r.rename(a,"paragraph"):!o&&a.name!="listItem"?(r.setAttributes({listType:this.type,listIndent:0},a),r.rename(a,"listItem")):!o&&a.name=="listItem"&&a.getAttribute("listType")!=this.type&&r.setAttribute("listType",this.type,a);this.fire("_executeCleanup",s)})}_getValue(){const e=De(this.editor.model.document.selection.getSelectedBlocks());return!!e&&e.is("element","listItem")&&e.getAttribute("listType")==this.type}_checkEnabled(){if(this.value)return!0;const e=this.editor.model.document.selection,t=this.editor.model.schema,n=De(e.getSelectedBlocks());return n?tf(n,t):!1}}function ef(i,e,t){const n=e?i[0]:i[i.length-1];if(n.is("element","listItem")){let s=n[e?"previousSibling":"nextSibling"],o=n.getAttribute("listIndent");for(;s&&s.is("element","listItem")&&s.getAttribute("listIndent")>=t;)o>s.getAttribute("listIndent")&&(o=s.getAttribute("listIndent")),s.getAttribute("listIndent")==o&&i[e?"unshift":"push"](s),s=s[e?"previousSibling":"nextSibling"]}}function tf(i,e){return e.checkChild(i.parent,"listItem")&&!e.isObject(i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class nf extends q{constructor(e,t){super(e);this._indentBy=t=="forward"?1:-1}refresh(){this.isEnabled=this._checkEnabled()}execute(){const e=this.editor.model,t=e.document;let n=Array.from(t.selection.getSelectedBlocks());e.change(s=>{const o=n[n.length-1];let r=o.nextSibling;for(;r&&r.name=="listItem"&&r.getAttribute("listIndent")>o.getAttribute("listIndent");)n.push(r),r=r.nextSibling;this._indentBy<0&&(n=n.reverse());for(const a of n){const l=a.getAttribute("listIndent")+this._indentBy;l<0?s.rename(a,"paragraph"):s.setAttribute("listIndent",l,a)}this.fire("_executeCleanup",n)})}_checkEnabled(){const e=De(this.editor.model.document.selection.getSelectedBlocks());if(!e||!e.is("element","listItem"))return!1;if(this._indentBy>0){const t=e.getAttribute("listIndent"),n=e.getAttribute("listType");let s=e.previousSibling;for(;s&&s.is("element","listItem")&&s.getAttribute("listIndent")>=t;){if(s.getAttribute("listIndent")==t)return s.getAttribute("listType")==n;s=s.previousSibling}return!1}return!0}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Sx(i){const e=i.createContainerElement("li");return e.getFillerOffset=Ix,e}function xx(i,e){const t=e.mapper,n=e.writer,s=i.getAttribute("listType")=="numbered"?"ol":"ul",o=Sx(n),r=n.createContainerElement(s,null);return n.insert(n.createPositionAt(r,0),o),t.bindElements(i,o),o}function sf(i,e,t,n){const s=e.parent,o=t.mapper,r=t.writer;let a=o.toViewPosition(n.createPositionBefore(i));const l=rf(i.previousSibling,{sameIndent:!0,smallerIndent:!0,listIndent:i.getAttribute("listIndent")}),c=i.previousSibling;if(l&&l.getAttribute("listIndent")==i.getAttribute("listIndent")){const u=o.toViewElement(l);a=r.breakContainer(r.createPositionAfter(u))}else if(c&&c.name=="listItem"){a=o.toViewPosition(n.createPositionAt(c,"end"));const u=o.findMappedViewAncestor(a),d=Px(u);d?a=r.createPositionBefore(d):a=r.createPositionAt(u,"end")}else a=o.toViewPosition(n.createPositionBefore(i));if(a=of(a),r.insert(a,s),c&&c.name=="listItem"){const u=o.toViewElement(c),f=r.createRange(r.createPositionAt(u,0),a).getWalker({ignoreElementEnd:!0});for(const b of f)if(b.item.is("element","li")){const _=r.breakContainer(r.createPositionBefore(b.item)),C=b.item.parent,A=r.createPositionAt(e,"end");Ye(r,A.nodeBefore,A.nodeAfter),r.move(r.createRangeOn(C),A),f.position=_}}else{const u=s.nextSibling;if(u&&(u.is("element","ul")||u.is("element","ol"))){let d=null;for(const f of u.getChildren()){const b=o.toModelElement(f);if(b&&b.getAttribute("listIndent")>i.getAttribute("listIndent"))d=f;else break}d&&(r.breakContainer(r.createPositionAfter(d)),r.move(r.createRangeOn(d.parent),r.createPositionAt(e,"end")))}}Ye(r,s,s.nextSibling),Ye(r,s.previousSibling,s)}function Ye(i,e,t){return!e||!t||e.name!="ul"&&e.name!="ol"||e.name!=t.name||e.getAttribute("class")!==t.getAttribute("class")?null:i.mergeContainers(i.createPositionAfter(e))}function of(i){return i.getLastMatchingPosition(e=>e.item.is("uiElement"))}function rf(i,e){const t=!!e.sameIndent,n=!!e.smallerIndent,s=e.listIndent;let o=i;for(;o&&o.name=="listItem";){const r=o.getAttribute("listIndent");if(t&&s==r||n&&s>r)return o;e.direction==="forward"?o=o.nextSibling:o=o.previousSibling}return null}function af(i,e,t,n){i.ui.componentFactory.add(e,s=>{const o=i.commands.get(e),r=new le(s);return r.set({label:t,icon:n,tooltip:!0,isToggleable:!0}),r.bind("isOn","isEnabled").to(o,"value","isEnabled"),r.on("execute",()=>{i.execute(e),i.editing.view.focus()}),r})}function Px(i){for(const e of i.getChildren())if(e.name=="ul"||e.name=="ol")return e;return null}function Ix(){const i=!this.isEmpty&&(this.getChild(0).name=="ul"||this.getChild(0).name=="ol");return this.isEmpty||i?0:ic.call(this)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function lf(i){return(e,t,n)=>{const s=n.consumable;if(!s.test(t.item,"insert")||!s.test(t.item,"attribute:listType")||!s.test(t.item,"attribute:listIndent"))return;s.consume(t.item,"insert"),s.consume(t.item,"attribute:listType"),s.consume(t.item,"attribute:listIndent");const o=t.item,r=xx(o,n);sf(o,r,n,i)}}function Rx(i){return(e,t,n)=>{const r=n.mapper.toViewPosition(t.position).getLastMatchingPosition(b=>!b.item.is("element","li")).nodeAfter,a=n.writer;a.breakContainer(a.createPositionBefore(r)),a.breakContainer(a.createPositionAfter(r));const l=r.parent,c=l.previousSibling,u=a.createRangeOn(l),d=a.remove(u);c&&c.nextSibling&&Ye(a,c,c.nextSibling);const f=n.mapper.toModelElement(r);hf(f.getAttribute("listIndent")+1,t.position,u.start,r,n,i);for(const b of a.createRangeIn(d).getItems())n.mapper.unbindViewElement(b);e.stop()}}function Mx(i,e,t){if(!t.consumable.consume(e.item,"attribute:listType"))return;const n=t.mapper.toViewElement(e.item),s=t.writer;s.breakContainer(s.createPositionBefore(n)),s.breakContainer(s.createPositionAfter(n));const o=n.parent,r=e.attributeNewValue=="numbered"?"ol":"ul";s.rename(r,o)}function Vx(i,e,t){const s=t.mapper.toViewElement(e.item).parent,o=t.writer;Ye(o,s,s.nextSibling),Ye(o,s.previousSibling,s);for(const r of e.item.getChildren())t.consumable.consume(r,"insert")}function Ox(i){return(e,t,n)=>{if(!n.consumable.consume(t.item,"attribute:listIndent"))return;const s=n.mapper.toViewElement(t.item),o=n.writer;o.breakContainer(o.createPositionBefore(s)),o.breakContainer(o.createPositionAfter(s));const r=s.parent,a=r.previousSibling,l=o.createRangeOn(r);o.remove(l),a&&a.nextSibling&&Ye(o,a,a.nextSibling),hf(t.attributeOldValue+1,t.range.start,l.start,s,n,i),sf(t.item,s,n,i);for(const c of t.item.getChildren())n.consumable.consume(c,"insert")}}function cf(i,e,t){if(e.item.name!="listItem"){let n=t.mapper.toViewPosition(e.range.start);const s=t.writer,o=[];for(;(n.parent.name=="ul"||n.parent.name=="ol")&&(n=s.breakContainer(n),n.parent.name=="li");){const r=n,a=s.createPositionAt(n.parent,"end");if(!r.isEqual(a)){const l=s.remove(s.createRange(r,a));o.push(l)}n=s.createPositionAfter(n.parent)}if(o.length>0){for(let r=0;r<o.length;r++){const a=n.nodeBefore;if(n=s.insert(n,o[r]).end,r>0){const c=Ye(s,a,a.nextSibling);c&&c.parent==a&&n.offset--}}Ye(s,n.nodeBefore,n.nodeAfter)}}}function Nx(i,e,t){const n=t.mapper.toViewPosition(e.position),s=n.nodeBefore,o=n.nodeAfter;Ye(t.writer,s,o)}function Dx(i,e,t){if(t.consumable.consume(e.viewItem,{name:!0})){const n=t.writer,s=n.createElement("listItem"),o=Ux(e.viewItem);n.setAttribute("listIndent",o,s);const r=e.viewItem.parent&&e.viewItem.parent.name=="ol"?"numbered":"bulleted";if(n.setAttribute("listType",r,s),!t.safeInsert(s,e.modelCursor))return;const a=$x(s,e.viewItem.getChildren(),t);e.modelRange=n.createRange(e.modelCursor,a),t.updateConversionResult(s,e)}}function uf(i,e,t){if(t.consumable.test(e.viewItem,{name:!0})){const n=Array.from(e.viewItem.getChildren());for(const s of n)!(s.is("element","li")||Fn(s))&&s._remove()}}function Bx(i,e,t){if(t.consumable.test(e.viewItem,{name:!0})){if(e.viewItem.childCount===0)return;const n=[...e.viewItem.getChildren()];let s=!1;for(const o of n)s&&!Fn(o)&&o._remove(),Fn(o)&&(s=!0)}}function df(i){return(e,t)=>{if(t.isPhantom)return;const n=t.modelPosition.nodeBefore;if(n&&n.is("element","listItem")){const s=t.mapper.toViewElement(n),o=s.getAncestors().find(Fn),r=i.createPositionAt(s,0).getWalker();for(const a of r)if(a.type=="elementStart"&&a.item.is("element","li")){t.viewPosition=a.previousPosition;break}else if(a.type=="elementEnd"&&a.item==o){t.viewPosition=a.nextPosition;break}}}}function Fx(i){return(e,t)=>{const n=t.viewPosition,s=n.parent,o=t.mapper;if(s.name=="ul"||s.name=="ol"){if(n.isAtEnd){const r=o.toModelElement(n.nodeBefore),a=o.getModelLength(n.nodeBefore);t.modelPosition=i.createPositionBefore(r).getShiftedBy(a)}else{const r=o.toModelElement(n.nodeAfter);t.modelPosition=i.createPositionBefore(r)}e.stop()}else if(s.name=="li"&&n.nodeBefore&&(n.nodeBefore.name=="ul"||n.nodeBefore.name=="ol")){const r=o.toModelElement(s);let a=1,l=n.nodeBefore;for(;l&&Fn(l);)a+=o.getModelLength(l),l=l.previousSibling;t.modelPosition=i.createPositionBefore(r).getShiftedBy(a),e.stop()}}}function Lx(i,e){const t=i.document.differ.getChanges(),n=new Map;let s=!1;for(const l of t)if(l.type=="insert"&&l.name=="listItem")o(l.position);else if(l.type=="insert"&&l.name!="listItem"){if(l.name!="$text"){const u=l.position.nodeAfter;u.hasAttribute("listIndent")&&(e.removeAttribute("listIndent",u),s=!0),u.hasAttribute("listType")&&(e.removeAttribute("listType",u),s=!0),u.hasAttribute("listStyle")&&(e.removeAttribute("listStyle",u),s=!0);for(const d of Array.from(i.createRangeIn(u)).filter(f=>f.item.is("element","listItem")))o(d.previousPosition)}const c=l.position.getShiftedBy(l.length);o(c)}else l.type=="remove"&&l.name=="listItem"?o(l.position):(l.type=="attribute"&&l.attributeKey=="listIndent"||l.type=="attribute"&&l.attributeKey=="listType")&&o(l.range.start);for(const l of n.values())r(l),a(l);return s;function o(l){const c=l.nodeBefore;if(!c||!c.is("element","listItem")){const u=l.nodeAfter;u&&u.is("element","listItem")&&n.set(u,u)}else{let u=c;if(n.has(u))return;for(let d=u.previousSibling;d&&d.is("element","listItem");d=u.previousSibling)if(u=d,n.has(u))return;n.set(c,u)}}function r(l){let c=0,u=null;for(;l&&l.is("element","listItem");){const d=l.getAttribute("listIndent");if(d>c){let f;u===null?(u=d-c,f=c):(u>d&&(u=d),f=d-u),e.setAttribute("listIndent",f,l),s=!0}else u=null,c=l.getAttribute("listIndent")+1;l=l.nextSibling}}function a(l){let c=[],u=null;for(;l&&l.is("element","listItem");){const d=l.getAttribute("listIndent");if(u&&u.getAttribute("listIndent")>d&&(c=c.slice(0,d+1)),d!=0)if(c[d]){const f=c[d];l.getAttribute("listType")!=f&&(e.setAttribute("listType",f,l),s=!0)}else c[d]=l.getAttribute("listType");u=l,l=l.nextSibling}}}function zx(i,[e,t]){let n=e.is("documentFragment")?e.getChild(0):e,s;if(t?s=this.createSelection(t):s=this.document.selection,n&&n.is("element","listItem")){const o=s.getFirstPosition();let r=null;if(o.parent.is("element","listItem")?r=o.parent:o.nodeBefore&&o.nodeBefore.is("element","listItem")&&(r=o.nodeBefore),r){const a=r.getAttribute("listIndent");if(a>0)for(;n&&n.is("element","listItem");)n._setAttribute("listIndent",n.getAttribute("listIndent")+a),n=n.nextSibling}}}function $x(i,e,t){const{writer:n,schema:s}=t;let o=n.createPositionAfter(i);for(const r of e)if(r.name=="ul"||r.name=="ol")o=t.convertItem(r,o).modelCursor;else{const a=t.convertItem(r,n.createPositionAt(i,"end")),l=a.modelRange.start.nodeAfter;l&&l.is("element")&&!s.checkChild(i,l.name)&&(a.modelCursor.parent.is("element","listItem")?i=a.modelCursor.parent:i=Hx(a.modelCursor),o=n.createPositionAfter(i))}return o}function Hx(i){const e=new St({startPosition:i});let t;do t=e.next();while(!t.value.item.is("element","listItem"));return t.value.item}function hf(i,e,t,n,s,o){const r=rf(e.nodeBefore,{sameIndent:!0,smallerIndent:!0,listIndent:i,foo:"b"}),a=s.mapper,l=s.writer,c=r?r.getAttribute("listIndent"):null;let u;if(!r)u=t;else if(c==i){const d=a.toViewElement(r).parent;u=l.createPositionAfter(d)}else{const d=o.createPositionAt(r,"end");u=a.toViewPosition(d)}u=of(u);for(const d of[...n.getChildren()])Fn(d)&&(u=l.move(l.createRangeOn(d),u).end,Ye(l,d,d.nextSibling),Ye(l,d.previousSibling,d))}function Fn(i){return i.is("element","ol")||i.is("element","ul")}function Ux(i){let e=0,t=i.parent;for(;t;){if(t.is("element","li"))e++;else{const n=t.previousSibling;n&&n.is("element","li")&&e++}t=t.parent}return e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Wx extends P{static get pluginName(){return"ListEditing"}static get requires(){return[cs,zt]}init(){const e=this.editor;e.model.schema.register("listItem",{inheritAllFrom:"$block",allowAttributes:["listType","listIndent"]});const t=e.data,n=e.editing;e.model.document.registerPostFixer(r=>Lx(e.model,r)),n.mapper.registerViewToModelLength("li",Dr),t.mapper.registerViewToModelLength("li",Dr),n.mapper.on("modelToViewPosition",df(n.view)),n.mapper.on("viewToModelPosition",Fx(e.model)),t.mapper.on("modelToViewPosition",df(n.view)),e.conversion.for("editingDowncast").add(r=>{r.on("insert",cf,{priority:"high"}),r.on("insert:listItem",lf(e.model)),r.on("attribute:listType:listItem",Mx,{priority:"high"}),r.on("attribute:listType:listItem",Vx,{priority:"low"}),r.on("attribute:listIndent:listItem",Ox(e.model)),r.on("remove:listItem",Rx(e.model)),r.on("remove",Nx,{priority:"low"})}),e.conversion.for("dataDowncast").add(r=>{r.on("insert",cf,{priority:"high"}),r.on("insert:listItem",lf(e.model))}),e.conversion.for("upcast").add(r=>{r.on("element:ul",uf,{priority:"high"}),r.on("element:ol",uf,{priority:"high"}),r.on("element:li",Bx,{priority:"high"}),r.on("element:li",Dx)}),e.model.on("insertContent",zx,{priority:"high"}),e.commands.add("numberedList",new Zh(e,"numbered")),e.commands.add("bulletedList",new Zh(e,"bulleted")),e.commands.add("indentList",new nf(e,"forward")),e.commands.add("outdentList",new nf(e,"backward"));const s=n.view.document;this.listenTo(s,"enter",(r,a)=>{const l=this.editor.model.document,c=l.selection.getLastPosition().parent;l.selection.isCollapsed&&c.name=="listItem"&&c.isEmpty&&(this.editor.execute("outdentList"),a.preventDefault(),r.stop())},{context:"li"}),this.listenTo(s,"delete",(r,a)=>{if(a.direction!=="backward")return;const l=this.editor.model.document.selection;if(!l.isCollapsed)return;const c=l.getFirstPosition();if(!c.isAtStart)return;const u=c.parent;u.name!=="listItem"||u.previousSibling&&u.previousSibling.name==="listItem"||(this.editor.execute("outdentList"),a.preventDefault(),r.stop())},{context:"li"});const o=r=>(a,l)=>{this.editor.commands.get(r).isEnabled&&(this.editor.execute(r),l())};e.keystrokes.set("Tab",o("indentList")),e.keystrokes.set("Shift+Tab",o("outdentList"))}afterInit(){const e=this.editor.commands,t=e.get("indent"),n=e.get("outdent");t&&t.registerChildCommand(e.get("indentList")),n&&n.registerChildCommand(e.get("outdentList"))}}function Dr(i){let e=1;for(const t of i.getChildren())if(t.name=="ul"||t.name=="ol")for(const n of t.getChildren())e+=Dr(n);return e}var qx='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M7 5.75c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zM3.5 3v5H2V3.7H1v-1h2.5V3zM.343 17.857l2.59-3.257H2.92a.6.6 0 1 0-1.04 0H.302a2 2 0 1 1 3.995 0h-.001c-.048.405-.16.734-.333.988-.175.254-.59.692-1.244 1.312H4.3v1h-4l.043-.043zM7 14.75a.75.75 0 0 1 .75-.75h9.5a.75.75 0 1 1 0 1.5h-9.5a.75.75 0 0 1-.75-.75z"/></svg>',jx='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M7 5.75c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zm-6 0C1 4.784 1.777 4 2.75 4c.966 0 1.75.777 1.75 1.75 0 .966-.777 1.75-1.75 1.75C1.784 7.5 1 6.723 1 5.75zm6 9c0 .414.336.75.75.75h9.5a.75.75 0 1 0 0-1.5h-9.5a.75.75 0 0 0-.75.75zm-6 0c0-.966.777-1.75 1.75-1.75.966 0 1.75.777 1.75 1.75 0 .966-.777 1.75-1.75 1.75-.966 0-1.75-.777-1.75-1.75z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Kx extends P{static get pluginName(){return"ListUI"}init(){const e=this.editor.t;af(this.editor,"numberedList",e("Numbered List"),qx),af(this.editor,"bulletedList",e("Bulleted List"),jx)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Gx extends P{static get requires(){return[Wx,Kx]}static get pluginName(){return"List"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function ff(i,e){return n=>{n.on("attribute:url:media",t)};function t(n,s,o){if(!o.consumable.consume(s.item,n.name))return;const r=s.attributeNewValue,a=o.writer,l=o.mapper.toViewElement(s.item),c=[...l.getChildren()].find(d=>d.getCustomProperty("media-content"));a.remove(c);const u=i.getMediaViewElement(a,r,e);a.insert(a.createPositionAt(l,0),u)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Jx(i,e,t){return e.setCustomProperty("media",!0,i),lr(i,e,{label:t})}function mf(i,e,t,n){const s=i.createContainerElement("figure",{class:"media"});return i.insert(i.createPositionAt(s,0),e.getMediaViewElement(i,t,n)),s}function gf(i){const e=i.getSelectedElement();return e&&e.is("element","media")?e:null}function pf(i,e,t){i.change(n=>{const s=n.createElement("media",{url:e});i.insertContent(s,t),n.setSelection(s,"on")})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Qx extends q{refresh(){const e=this.editor.model,t=e.document.selection,n=gf(t);this.value=n?n.getAttribute("url"):null,this.isEnabled=Xx(t)||Yx(t,e)}execute(e){const t=this.editor.model,n=t.document.selection,s=gf(n);s?t.change(o=>{o.setAttribute("url",e,s)}):pf(t,e,Rn(n,t))}}function Yx(i,e){let n=Rn(i,e).start.parent;return n.isEmpty&&!e.schema.isLimit(n)&&(n=n.parent),e.schema.checkChild(n,"media")}function Xx(i){const e=i.getSelectedElement();return!!e&&e.name==="media"}var Zx='<svg viewBox="0 0 64 42" xmlns="http://www.w3.org/2000/svg"><path d="M47.426 17V3.713L63.102 0v19.389h-.001l.001.272c0 1.595-2.032 3.43-4.538 4.098-2.506.668-4.538-.083-4.538-1.678 0-1.594 2.032-3.43 4.538-4.098.914-.244 2.032-.565 2.888-.603V4.516L49.076 7.447v9.556A1.014 1.014 0 0 0 49 17h-1.574zM29.5 17h-8.343a7.073 7.073 0 1 0-4.657 4.06v3.781H3.3a2.803 2.803 0 0 1-2.8-2.804V8.63a2.803 2.803 0 0 1 2.8-2.805h4.082L8.58 2.768A1.994 1.994 0 0 1 10.435 1.5h8.985c.773 0 1.477.448 1.805 1.149l1.488 3.177H26.7c1.546 0 2.8 1.256 2.8 2.805V17zm-11.637 0H17.5a1 1 0 0 0-1 1v.05A4.244 4.244 0 1 1 17.863 17zm29.684 2c.97 0 .953-.048.953.889v20.743c0 .953.016.905-.953.905H19.453c-.97 0-.953.048-.953-.905V19.89c0-.937-.016-.889.97-.889h28.077zm-4.701 19.338V22.183H24.154v16.155h18.692zM20.6 21.375v1.616h1.616v-1.616H20.6zm0 3.231v1.616h1.616v-1.616H20.6zm0 3.231v1.616h1.616v-1.616H20.6zm0 3.231v1.616h1.616v-1.616H20.6zm0 3.231v1.616h1.616v-1.616H20.6zm0 3.231v1.616h1.616V37.53H20.6zm24.233-16.155v1.616h1.615v-1.616h-1.615zm0 3.231v1.616h1.615v-1.616h-1.615zm0 3.231v1.616h1.615v-1.616h-1.615zm0 3.231v1.616h1.615v-1.616h-1.615zm0 3.231v1.616h1.615v-1.616h-1.615zm0 3.231v1.616h1.615V37.53h-1.615zM29.485 25.283a.4.4 0 0 1 .593-.35l9.05 4.977a.4.4 0 0 1 0 .701l-9.05 4.978a.4.4 0 0 1-.593-.35v-9.956z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const eP="0 0 64 42";class tP{constructor(e,t){const n=t.providers,s=t.extraProviders||[],o=new Set(t.removeProviders),r=n.concat(s).filter(a=>{const l=a.name;return l?!o.has(l):(Re("media-embed-no-provider-name",{provider:a}),!1)});this.locale=e,this.providerDefinitions=r}hasMedia(e){return!!this._getMedia(e)}getMediaViewElement(e,t,n){return this._getMedia(t).getViewElement(e,n)}_getMedia(e){if(!e)return new wf(this.locale);e=e.trim();for(const t of this.providerDefinitions){const n=t.html,s=Ee(t.url);for(const o of s){const r=this._getUrlMatches(e,o);if(r)return new wf(this.locale,e,r,n)}}return null}_getUrlMatches(e,t){let n=e.match(t);if(n)return n;let s=e.replace(/^https?:\/\//,"");return n=s.match(t),n||(s=s.replace(/^www\./,""),n=s.match(t),n)?n:null}}class wf{constructor(e,t,n,s){this.url=this._getValidUrl(t),this._t=e.t,this._match=n,this._previewRenderer=s}getViewElement(e,t){const n={};let s;if(t.renderForEditingView||t.renderMediaPreview&&this.url&&this._previewRenderer){this.url&&(n["data-oembed-url"]=this.url),t.renderForEditingView&&(n.class="ck-media__wrapper");const o=this._getPreviewHtml(t);s=e.createRawElement("div",n,(r,a)=>{a.setContentOf(r,o)})}else this.url&&(n.url=this.url),s=e.createEmptyElement(t.elementName,n);return e.setCustomProperty("media-content",!0,s),s}_getPreviewHtml(e){return this._previewRenderer?this._previewRenderer(this._match):this.url&&e.renderForEditingView?this._getPlaceholderHtml():""}_getPlaceholderHtml(){const e=new Zu,t=new is;return e.text=this._t("Open media in new tab"),t.content=Zx,t.viewBox=eP,new it({tag:"div",attributes:{class:"ck ck-reset_all ck-media__placeholder"},children:[{tag:"div",attributes:{class:"ck-media__placeholder__icon"},children:[t]},{tag:"a",attributes:{class:"ck-media__placeholder__url",target:"_blank",rel:"noopener noreferrer",href:this.url},children:[{tag:"span",attributes:{class:"ck-media__placeholder__url__text"},children:[this.url]},e]}]}).render().outerHTML}_getValidUrl(e){return e?e.match(/^https?/)?e:"https://"+e:null}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class vs extends P{static get pluginName(){return"MediaEmbedEditing"}constructor(e){super(e);e.config.define("mediaEmbed",{elementName:"oembed",providers:[{name:"dailymotion",url:/^dailymotion\.com\/video\/(\w+)/,html:t=>`<div style="position: relative; padding-bottom: 100%; height: 0; "><iframe src="https://www.dailymotion.com/embed/video/${t[1]}" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0;" frameborder="0" width="480" height="270" allowfullscreen allow="autoplay"></iframe></div>`},{name:"spotify",url:[/^open\.spotify\.com\/(artist\/\w+)/,/^open\.spotify\.com\/(album\/\w+)/,/^open\.spotify\.com\/(track\/\w+)/],html:t=>`<div style="position: relative; padding-bottom: 100%; height: 0; padding-bottom: 126%;"><iframe src="https://open.spotify.com/embed/${t[1]}" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0;" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe></div>`},{name:"youtube",url:[/^(?:m\.)?youtube\.com\/watch\?v=([\w-]+)/,/^(?:m\.)?youtube\.com\/v\/([\w-]+)/,/^youtube\.com\/embed\/([\w-]+)/,/^youtu\.be\/([\w-]+)/],html:t=>`<div style="position: relative; padding-bottom: 100%; height: 0; padding-bottom: 56.2493%;"><iframe src="https://www.youtube.com/embed/${t[1]}" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0;" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div>`},{name:"vimeo",url:[/^vimeo\.com\/(\d+)/,/^vimeo\.com\/[^/]+\/[^/]+\/video\/(\d+)/,/^vimeo\.com\/album\/[^/]+\/video\/(\d+)/,/^vimeo\.com\/channels\/[^/]+\/(\d+)/,/^vimeo\.com\/groups\/[^/]+\/videos\/(\d+)/,/^vimeo\.com\/ondemand\/[^/]+\/(\d+)/,/^player\.vimeo\.com\/video\/(\d+)/],html:t=>`<div style="position: relative; padding-bottom: 100%; height: 0; padding-bottom: 56.2493%;"><iframe src="https://player.vimeo.com/video/${t[1]}" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0;" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>`},{name:"instagram",url:/^instagram\.com\/p\/(\w+)/},{name:"twitter",url:/^twitter\.com/},{name:"googleMaps",url:[/^google\.com\/maps/,/^goo\.gl\/maps/,/^maps\.google\.com/,/^maps\.app\.goo\.gl/]},{name:"flickr",url:/^flickr\.com/},{name:"facebook",url:/^facebook\.com/}]}),this.registry=new tP(e.locale,e.config.get("mediaEmbed"))}init(){const e=this.editor,t=e.model.schema,n=e.t,s=e.conversion,o=e.config.get("mediaEmbed.previewsInData"),r=e.config.get("mediaEmbed.elementName"),a=this.registry;e.commands.add("mediaEmbed",new Qx(e)),t.register("media",{isObject:!0,isBlock:!0,allowWhere:"$block",allowAttributes:["url"]}),s.for("dataDowncast").elementToElement({model:"media",view:(l,{writer:c})=>{const u=l.getAttribute("url");return mf(c,a,u,{elementName:r,renderMediaPreview:u&&o})}}),s.for("dataDowncast").add(ff(a,{elementName:r,renderMediaPreview:o})),s.for("editingDowncast").elementToElement({model:"media",view:(l,{writer:c})=>{const u=l.getAttribute("url"),d=mf(c,a,u,{elementName:r,renderForEditingView:!0});return Jx(d,c,n("media widget"))}}),s.for("editingDowncast").add(ff(a,{elementName:r,renderForEditingView:!0})),s.for("upcast").elementToElement({view:l=>["oembed",r].includes(l.name)&&l.getAttribute("url")?{name:!0}:null,model:(l,{writer:c})=>{const u=l.getAttribute("url");if(a.hasMedia(u))return c.createElement("media",{url:u})}}).elementToElement({view:{name:"div",attributes:{"data-oembed-url":!0}},model:(l,{writer:c})=>{const u=l.getAttribute("data-oembed-url");if(a.hasMedia(u))return c.createElement("media",{url:u})}}).add(l=>{l.on("element:figure",c);function c(u,d,f){if(!f.consumable.consume(d.viewItem,{name:!0,classes:"media"}))return;const{modelRange:b,modelCursor:_}=f.convertChildren(d.viewItem,d.modelCursor);d.modelRange=b,d.modelCursor=_,De(b.getItems())||f.consumable.revert(d.viewItem,{name:!0,classes:"media"})}})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const nP=/^(?:http(s)?:\/\/)?[\w-]+\.[\w-.~:/?#[\]@!$&'()*+,;=%]+$/;class iP extends P{static get requires(){return[Ld,zt,Xd]}static get pluginName(){return"AutoMediaEmbed"}constructor(e){super(e);this._timeoutId=null,this._positionToInsert=null}init(){const e=this.editor,t=e.model.document;this.listenTo(e.plugins.get("ClipboardPipeline"),"inputTransformation",()=>{const n=t.selection.getFirstRange(),s=Pe.fromPosition(n.start);s.stickiness="toPrevious";const o=Pe.fromPosition(n.end);o.stickiness="toNext",t.once("change:data",()=>{this._embedMediaBetweenPositions(s,o),s.detach(),o.detach()},{priority:"high"})}),e.commands.get("undo").on("execute",()=>{this._timeoutId&&(_e.window.clearTimeout(this._timeoutId),this._positionToInsert.detach(),this._timeoutId=null,this._positionToInsert=null)},{priority:"high"})}_embedMediaBetweenPositions(e,t){const n=this.editor,s=n.plugins.get(vs).registry,o=new mt(e,t),r=o.getWalker({ignoreElementEnd:!0});let a="";for(const c of r)c.item.is("$textProxy")&&(a+=c.item.data);if(a=a.trim(),!a.match(nP)){o.detach();return}if(!s.hasMedia(a)){o.detach();return}if(!n.commands.get("mediaEmbed").isEnabled){o.detach();return}this._positionToInsert=Pe.fromPosition(e),this._timeoutId=_e.window.setTimeout(()=>{n.model.change(c=>{this._timeoutId=null,c.remove(o),o.detach();let u;this._positionToInsert.root.rootName!=="$graveyard"&&(u=this._positionToInsert),pf(n.model,a,u),this._positionToInsert.detach(),this._positionToInsert=null}),n.plugins.get("Delete").requestUndoOnBackspace()},100)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class sP extends j{constructor(e,t){super(t);const n=t.t;this.focusTracker=new Je,this.keystrokes=new At,this.set("mediaURLInputValue",""),this.urlInputView=this._createUrlInput(),this.saveButtonView=this._createButton(n("Save"),Ve.check,"ck-button-save"),this.saveButtonView.type="submit",this.saveButtonView.bind("isEnabled").to(this,"mediaURLInputValue",s=>!!s),this.cancelButtonView=this._createButton(n("Cancel"),Ve.cancel,"ck-button-cancel","cancel"),this._focusables=new an,this._focusCycler=new Sn({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this._validators=e,this.setTemplate({tag:"form",attributes:{class:["ck","ck-media-form","ck-responsive-form"],tabindex:"-1"},children:[this.urlInputView,this.saveButtonView,this.cancelButtonView]}),qo(this)}render(){super.render(),jo({view:this}),[this.urlInputView,this.saveButtonView,this.cancelButtonView].forEach(n=>{this._focusables.add(n),this.focusTracker.add(n.element)}),this.keystrokes.listenTo(this.element);const t=n=>n.stopPropagation();this.keystrokes.set("arrowright",t),this.keystrokes.set("arrowleft",t),this.keystrokes.set("arrowup",t),this.keystrokes.set("arrowdown",t),this.listenTo(this.urlInputView.element,"selectstart",(n,s)=>{s.stopPropagation()},{priority:"high"})}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}get url(){return this.urlInputView.fieldView.element.value.trim()}set url(e){this.urlInputView.fieldView.element.value=e.trim()}isValid(){this.resetFormStatus();for(const e of this._validators){const t=e(this);if(t)return this.urlInputView.errorText=t,!1}return!0}resetFormStatus(){this.urlInputView.errorText=null,this.urlInputView.infoText=this._urlInputViewInfoDefault}_createUrlInput(){const e=this.locale.t,t=new tr(this.locale,nr),n=t.fieldView;return this._urlInputViewInfoDefault=e("Paste the media URL in the input."),this._urlInputViewInfoTip=e("Tip: Paste the URL into the content to embed faster."),t.label=e("Media URL"),t.infoText=this._urlInputViewInfoDefault,n.on("input",()=>{t.infoText=n.element.value?this._urlInputViewInfoTip:this._urlInputViewInfoDefault,this.mediaURLInputValue=n.element.value.trim()}),t}_createButton(e,t,n,s){const o=new le(this.locale);return o.set({label:e,icon:t,tooltip:!0}),o.extendTemplate({attributes:{class:n}}),s&&o.delegate("execute").to(this,s),o}}var oP='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M18.68 3.03c.6 0 .59-.03.59.55v12.84c0 .59.01.56-.59.56H1.29c-.6 0-.59.03-.59-.56V3.58c0-.58-.01-.55.6-.55h17.38zM15.77 15V5H4.2v10h11.57zM2 4v1h1V4H2zm0 2v1h1V6H2zm0 2v1h1V8H2zm0 2v1h1v-1H2zm0 2v1h1v-1H2zm0 2v1h1v-1H2zM17 4v1h1V4h-1zm0 2v1h1V6h-1zm0 2v1h1V8h-1zm0 2v1h1v-1h-1zm0 2v1h1v-1h-1zm0 2v1h1v-1h-1zM7.5 7.177a.4.4 0 0 1 .593-.351l5.133 2.824a.4.4 0 0 1 0 .7l-5.133 2.824a.4.4 0 0 1-.593-.35V7.176v.001z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class rP extends P{static get requires(){return[vs]}static get pluginName(){return"MediaEmbedUI"}init(){const e=this.editor,t=e.commands.get("mediaEmbed"),n=e.plugins.get(vs).registry;e.ui.componentFactory.add("mediaEmbed",s=>{const o=Lt(s),r=new sP(aP(e.t,n),e.locale);return this._setUpDropdown(o,r,t,e),this._setUpForm(o,r,t),o})}_setUpDropdown(e,t,n){const s=this.editor,o=s.t,r=e.buttonView;e.bind("isEnabled").to(n),e.panelView.children.add(t),r.set({label:o("Insert media"),icon:oP,tooltip:!0}),r.on("open",()=>{t.disableCssTransitions(),t.url=n.value||"",t.urlInputView.fieldView.select(),t.focus(),t.enableCssTransitions()},{priority:"low"}),e.on("submit",()=>{t.isValid()&&(s.execute("mediaEmbed",t.url),a())}),e.on("change:isOpen",()=>t.resetFormStatus()),e.on("cancel",()=>a());function a(){s.editing.view.focus(),e.isOpen=!1}}_setUpForm(e,t,n){t.delegate("submit","cancel").to(e),t.urlInputView.bind("value").to(n,"value"),t.urlInputView.bind("isReadOnly").to(n,"isEnabled",s=>!s)}}function aP(i,e){return[t=>{if(!t.url.length)return i("The URL must not be empty.")},t=>{if(!e.hasMedia(t.url))return i("This media URL is not supported.")}]}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class lP extends P{static get requires(){return[vs,rP,iP,Mn]}static get pluginName(){return"MediaEmbed"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function cP(i,e){for(const t of i.getChildren())if(t.is("element","b")&&t.getStyle("font-weight")==="normal"){const n=i.getChildIndex(t);e.remove(t),e.insertChild(n,t.getChildren(),i)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function uP(i,e){if(!i.childCount)return;const t=new In(i.document),n=hP(i,t);if(!n.length)return;let s=null,o=1;n.forEach((r,a)=>{const l=vP(n[a-1],r),c=l?null:n[a-1],u=CP(c,r);if(l&&(s=null,o=1),!s||u!==0){const f=fP(r,e);if(!s)s=bf(f,r.element,t);else if(r.indent>o){const b=s.getChild(s.childCount-1),_=b.getChild(b.childCount-1);s=bf(f,_,t),o+=1}else if(r.indent<o){const b=o-r.indent;s=kP(s,b),o=parseInt(r.indent)}r.indent<=o&&(s.is("element",f.type)||(s=t.rename(f.type,s)))}const d=wP(r.element,t);t.appendChild(d,s)})}function dP(i,e){for(const t of e.createRangeIn(i)){const n=t.item;if(n.is("element","li")){const s=n.getChild(0);s&&s.is("element","p")&&e.unwrapElement(s)}}}function hP(i,e){const t=e.createRangeIn(i),n=new ut({name:/^p|h\d+$/,styles:{"mso-list":/.*/}}),s=[];for(const o of t)if(o.type==="elementStart"&&n.match(o.item)){const r=bP(o.item);s.push({element:o.item,id:r.id,order:r.order,indent:r.indent})}return s}function fP(i,e){const t=new RegExp(`@list l${i.id}:level${i.indent}\\s*({[^}]*)`,"gi"),n=/mso-level-number-format:([^;]{0,100});/gi,s=t.exec(e);let o="decimal",r="ol";if(s&&s[1]){const a=n.exec(s[1]);if(a&&a[1]&&(o=a[1].trim(),r=o!=="bullet"&&o!=="image"?"ol":"ul"),o==="bullet"){const l=mP(i.element);l&&(o=l)}}return{type:r,style:pP(o)}}function mP(i){const e=gP(i);if(!e)return null;const t=e._data;return t==="o"?"circle":t==="\xB7"?"disc":t==="\xA7"?"square":null}function gP(i){if(i.getChild(0).is("$text"))return null;for(const e of i.getChildren()){if(!e.is("element","span"))continue;const t=e.getChild(0);return t.is("$text")?t:t.getChild(0)}}function pP(i){switch(i){case"arabic-leading-zero":return"decimal-leading-zero";case"alpha-upper":return"upper-alpha";case"alpha-lower":return"lower-alpha";case"roman-upper":return"upper-roman";case"roman-lower":return"lower-roman";case"circle":case"disc":case"square":return i;default:return null}}function bf(i,e,t){const n=e.parent,s=t.createElement(i.type),o=n.getChildIndex(e)+1;return t.insertChild(o,s,n),i.style&&t.setStyle("list-style-type",i.style,s),s}function wP(i,e){return _P(i,e),e.rename("li",i)}function bP(i){const e={},t=i.getStyle("mso-list");if(t){const n=t.match(/(^|\s{1,100})l(\d+)/i),s=t.match(/\s{0,100}lfo(\d+)/i),o=t.match(/\s{0,100}level(\d+)/i);n&&s&&o&&(e.id=n[2],e.order=s[1],e.indent=o[1])}return e}function _P(i,e){const t=new ut({name:"span",styles:{"mso-list":"Ignore"}}),n=e.createRangeIn(i);for(const s of n)s.type==="elementStart"&&t.match(s.item)&&e.remove(s.item)}function vP(i,e){if(!i)return!0;if(i.id!==e.id)return e.indent-i.indent!=1;const t=e.element.previousSibling;return t?!yP(t):!0}function yP(i){return i.is("element","ol")||i.is("element","ul")}function CP(i,e){return i?e.indent-i.indent:e.indent-1}function kP(i,e){const t=i.getAncestors({parentFirst:!0});let n=null,s=0;for(const o of t)if((o.name==="ul"||o.name==="ol")&&s++,s===e){n=o;break}return n}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const TP=/id=("|')docs-internal-guid-[-0-9a-f]+("|')/i;class EP{constructor(e){this.document=e}isActive(e){return TP.test(e)}execute(e){const t=new In(this.document),{body:n}=e._parsedData;cP(n,t),dP(n,t),e.content=n}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function AP(i,e){if(!i.childCount)return;const t=new In,n=xP(i,t);PP(n,i,t),IP(i,t);const s=RP(i,t);s.length&&VP(s,MP(e),t)}function SP(i){return btoa(i.match(/\w{2}/g).map(e=>String.fromCharCode(parseInt(e,16))).join(""))}function xP(i,e){const t=e.createRangeIn(i),n=new ut({name:/v:(.+)/}),s=[];for(const o of t){if(o.type!="elementStart")continue;const r=o.item,a=r.previousSibling&&r.previousSibling.name||null;n.match(r)&&r.getAttribute("o:gfxdata")&&a!=="v:shapetype"&&s.push(o.item.getAttribute("id"))}return s}function PP(i,e,t){const n=t.createRangeIn(e),s=new ut({name:"img"}),o=[];for(const r of n)if(s.match(r.item)){const a=r.item,l=a.getAttribute("v:shapes")?a.getAttribute("v:shapes").split(" "):[];l.length&&l.every(c=>i.indexOf(c)>-1)?o.push(a):a.getAttribute("src")||o.push(a)}for(const r of o)t.remove(r)}function IP(i,e){const t=e.createRangeIn(i),n=new ut({name:/v:(.+)/}),s=[];for(const o of t)o.type=="elementStart"&&n.match(o.item)&&s.push(o.item);for(const o of s)e.remove(o)}function RP(i,e){const t=e.createRangeIn(i),n=new ut({name:"img"}),s=[];for(const o of t)n.match(o.item)&&o.item.getAttribute("src").startsWith("file://")&&s.push(o.item);return s}function MP(i){if(!i)return[];const e=/{\\pict[\s\S]+?\\bliptag-?\d+(\\blipupi-?\d+)?({\\\*\\blipuid\s?[\da-fA-F]+)?[\s}]*?/,t=new RegExp("(?:("+e.source+"))([\\da-fA-F\\s]+)\\}","g"),n=i.match(t),s=[];if(n)for(const o of n){let r=!1;o.includes("\\pngblip")?r="image/png":o.includes("\\jpegblip")&&(r="image/jpeg"),r&&s.push({hex:o.replace(e,"").replace(/[^\da-fA-F]/g,""),type:r})}return s}function VP(i,e,t){if(i.length===e.length)for(let n=0;n<i.length;n++){const s=`data:${e[n].type};base64,${SP(e[n].hex)}`;t.setAttribute("src",s,i[n])}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const OP=/<meta\s*name="?generator"?\s*content="?microsoft\s*word\s*\d+"?\/?>/i,NP=/xmlns:o="urn:schemas-microsoft-com/i;class DP{constructor(e){this.document=e}isActive(e){return OP.test(e)||NP.test(e)}execute(e){const{body:t,stylesString:n}=e._parsedData;uP(t,n),AP(t,e.dataTransfer.getData("text/rtf")),e.content=t}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function BP(i){return _f(_f(i)).replace(/(<span\s+style=['"]mso-spacerun:yes['"]>[^\S\r\n]*?)[\r\n]+([^\S\r\n]*<\/span>)/g,"$1$2").replace(/<span\s+style=['"]mso-spacerun:yes['"]><\/span>/g,"").replace(/ <\//g,"\xA0</").replace(/ <o:p><\/o:p>/g,"\xA0<o:p></o:p>").replace(/<o:p>(&nbsp;|\u00A0)<\/o:p>/g,"").replace(/>([^\S\r\n]*[\r\n]\s*)</g,"><")}function FP(i){i.querySelectorAll("span[style*=spacerun]").forEach(e=>{const t=e.innerText.length||0;e.innerHTML=Array(t+1).join("\xA0 ").substr(0,t)})}function _f(i){return i.replace(/<span(?: class="Apple-converted-space"|)>(\s+)<\/span>/g,(e,t)=>t.length===1?" ":Array(t.length+1).join("\xA0 ").substr(0,t.length))}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function LP(i,e){const t=new DOMParser;i=i.replace(/<!--\[if gte vml 1]>/g,"");const n=BP(HP(i)),s=t.parseFromString(n,"text/html");FP(s);const o=s.body.innerHTML,r=zP(s,e),a=$P(s);return{body:r,bodyString:o,styles:a.styles,stylesString:a.stylesString}}function zP(i,e){const t=new ai(e),n=new qi(t,{renderingMode:"data"}),s=i.createDocumentFragment(),o=i.body.childNodes;for(;o.length>0;)s.appendChild(o[0]);return n.domToView(s,{skipComments:!0})}function $P(i){const e=[],t=[],n=Array.from(i.getElementsByTagName("style"));for(const s of n)s.sheet&&s.sheet.cssRules&&s.sheet.cssRules.length&&(e.push(s.sheet),t.push(s.innerHTML));return{styles:e,stylesString:t.join(" ")}}function HP(i){const e="</body>",t="</html>",n=i.indexOf(e);if(n<0)return i;const s=i.indexOf(t,n+e.length);return i.substring(0,n+e.length)+(s>=0?i.substring(s):"")}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class UP extends P{static get pluginName(){return"PasteFromOffice"}static get requires(){return[gt]}init(){const e=this.editor,t=e.editing.view.document,n=[];n.push(new DP(t)),n.push(new EP(t)),e.plugins.get("ClipboardPipeline").on("inputTransformation",(s,o)=>{if(o._isTransformedWithPasteFromOffice)return;const r=o.dataTransfer.getData("text/html"),a=n.find(l=>l.isActive(r));a&&(o._parsedData=LP(r,t.stylesProcessor),a.execute(o),o._isTransformedWithPasteFromOffice=!0)},{priority:"high"})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function ve(i,e,t,n,s=1){e>s?n.setAttribute(i,e,t):n.removeAttribute(i,t)}function dn(i,e,t={}){const n=i.createElement("tableCell",t);return i.insertElement("paragraph",n),i.insert(n,e),n}function Br(i,e){const t=e.parent.parent,n=parseInt(t.getAttribute("headingColumns")||0),{column:s}=i.getCellLocation(e);return!!n&&s<n}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function WP(){return i=>{i.on("element:figure",(e,t,n)=>{if(!n.consumable.test(t.viewItem,{name:!0,classes:"table"}))return;const s=KP(t.viewItem);if(!s||!n.consumable.test(s,{name:!0}))return;n.consumable.consume(t.viewItem,{name:!0,classes:"table"});const o=n.convertItem(s,t.modelCursor),r=De(o.modelRange.getItems());if(!r){n.consumable.revert(t.viewItem,{name:!0,classes:"table"});return}n.convertChildren(t.viewItem,n.writer.createPositionAt(r,"end")),n.updateConversionResult(r,t)})}}function qP(){return i=>{i.on("element:table",(e,t,n)=>{const s=t.viewItem;if(!n.consumable.test(s,{name:!0}))return;const{rows:o,headingRows:r,headingColumns:a}=GP(s),l={};a&&(l.headingColumns=a),r&&(l.headingRows=r);const c=n.writer.createElement("table",l);if(!!n.safeInsert(c,t.modelCursor)){if(n.consumable.consume(s,{name:!0}),o.forEach(u=>n.convertItem(u,n.writer.createPositionAt(c,"end"))),n.convertChildren(s,n.writer.createPositionAt(c,"end")),c.isEmpty){const u=n.writer.createElement("tableRow");n.writer.insert(u,n.writer.createPositionAt(c,"end")),dn(n.writer,n.writer.createPositionAt(u,"end"))}n.updateConversionResult(c,t)}})}}function jP(){return i=>{i.on("element:tr",(e,t)=>{t.viewItem.isEmpty&&t.modelCursor.index==0&&e.stop()},{priority:"high"})}}function vf(i){return e=>{e.on(`element:${i}`,(t,n,s)=>{if(!!n.modelRange&&n.viewItem.isEmpty){const o=n.modelRange.start.nodeAfter,r=s.writer.createPositionAt(o,0);s.writer.insertElement("paragraph",r)}},{priority:"low"})}}function KP(i){for(const e of i.getChildren())if(e.is("element","table"))return e}function GP(i){const e={headingRows:0,headingColumns:0},t=[],n=[];let s;for(const o of Array.from(i.getChildren()))if(o.name==="tbody"||o.name==="thead"||o.name==="tfoot"){o.name==="thead"&&!s&&(s=o);const r=Array.from(o.getChildren()).filter(a=>a.is("element","tr"));for(const a of r)if(a.parent.name==="thead"&&a.parent===s)e.headingRows++,t.push(a);else{n.push(a);const l=JP(a);l>e.headingColumns&&(e.headingColumns=l)}}return e.rows=[...t,...n],e}function JP(i){let e=0,t=0;const n=Array.from(i.getChildren()).filter(s=>s.name==="th"||s.name==="td");for(;t<n.length&&n[t].name==="th";){const s=n[t],o=parseInt(s.getAttribute("colspan")||1);e=e+o,t++}return e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ee{constructor(e,t={}){this._table=e,this._startRow=t.row!==void 0?t.row:t.startRow||0,this._endRow=t.row!==void 0?t.row:t.endRow,this._startColumn=t.column!==void 0?t.column:t.startColumn||0,this._endColumn=t.column!==void 0?t.column:t.endColumn,this._includeAllSlots=!!t.includeAllSlots,this._skipRows=new Set,this._row=0,this._rowIndex=0,this._column=0,this._cellIndex=0,this._spannedCells=new Map,this._nextCellAtColumn=-1}[Symbol.iterator](){return this}next(){const e=this._table.getChild(this._rowIndex);if(!e||this._isOverEndRow())return{done:!0};if(!e.is("element","tableRow"))return this._rowIndex++,this.next();if(this._isOverEndColumn())return this._advanceToNextRow();let t=null;const n=this._getSpanned();if(n)this._includeAllSlots&&!this._shouldSkipSlot()&&(t=this._formatOutValue(n.cell,n.row,n.column));else{const s=e.getChild(this._cellIndex);if(!s)return this._advanceToNextRow();const o=parseInt(s.getAttribute("colspan")||1),r=parseInt(s.getAttribute("rowspan")||1);(o>1||r>1)&&this._recordSpans(s,r,o),this._shouldSkipSlot()||(t=this._formatOutValue(s)),this._nextCellAtColumn=this._column+o}return this._column++,this._column==this._nextCellAtColumn&&this._cellIndex++,t||this.next()}skipRow(e){this._skipRows.add(e)}_advanceToNextRow(){return this._row++,this._rowIndex++,this._column=0,this._cellIndex=0,this._nextCellAtColumn=-1,this.next()}_isOverEndRow(){return this._endRow!==void 0&&this._row>this._endRow}_isOverEndColumn(){return this._endColumn!==void 0&&this._column>this._endColumn}_formatOutValue(e,t=this._row,n=this._column){return{done:!1,value:new QP(this,e,t,n)}}_shouldSkipSlot(){const e=this._skipRows.has(this._row),t=this._row<this._startRow,n=this._column<this._startColumn,s=this._endColumn!==void 0&&this._column>this._endColumn;return e||t||n||s}_getSpanned(){const e=this._spannedCells.get(this._row);return e&&e.get(this._column)||null}_recordSpans(e,t,n){const s={cell:e,row:this._row,column:this._column};for(let o=this._row;o<this._row+t;o++)for(let r=this._column;r<this._column+n;r++)(o!=this._row||r!=this._column)&&this._markSpannedCell(o,r,s)}_markSpannedCell(e,t,n){this._spannedCells.has(e)||this._spannedCells.set(e,new Map),this._spannedCells.get(e).set(t,n)}}class QP{constructor(e,t,n,s){this.cell=t,this.row=e._row,this.column=e._column,this.cellAnchorRow=n,this.cellAnchorColumn=s,this._cellIndex=e._cellIndex,this._rowIndex=e._rowIndex,this._table=e._table}get isAnchor(){return this.row===this.cellAnchorRow&&this.column===this.cellAnchorColumn}get cellWidth(){return parseInt(this.cell.getAttribute("colspan")||1)}get cellHeight(){return parseInt(this.cell.getAttribute("rowspan")||1)}get rowIndex(){return this._rowIndex}getPositionBefore(){return this._table.root.document.model.createPositionAt(this._table.getChild(this.row),this._cellIndex)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function yf(i={}){return e=>e.on("insert:table",(t,n,s)=>{const o=n.item;if(!s.consumable.consume(o,"insert"))return;s.consumable.consume(o,"attribute:headingRows:table"),s.consumable.consume(o,"attribute:headingColumns:table");const r=i&&i.asWidget,a=s.writer.createContainerElement("figure",{class:"table"}),l=s.writer.createContainerElement("table");s.writer.insert(s.writer.createPositionAt(a,0),l);let c;r&&(c=nI(a,s.writer));const u=new ee(o),d={headingRows:o.getAttribute("headingRows")||0,headingColumns:o.getAttribute("headingColumns")||0},f=new Map;for(const _ of u){const{row:C,cell:A}=_,R=o.getChild(C),O=f.get(C)||Lr(l,R,C,d,s);f.set(C,O),s.consumable.consume(A,"insert");const U=s.writer.createPositionAt(O,"end");Fr(_,d,U,s,i)}for(const _ of o.getChildren()){const C=_.index;_.is("element","tableRow")&&!f.has(C)&&f.set(C,Lr(l,_,C,d,s))}const b=s.mapper.toViewPosition(n.range.start);s.mapper.bindElements(o,r?c:a),s.writer.insert(b,r?c:a)})}function YP(){return i=>i.on("insert:tableRow",(e,t,n)=>{const s=t.item;if(!n.consumable.consume(s,"insert"))return;const o=s.parent,r=n.mapper.toViewElement(o),a=lI(r),l=o.getChildIndex(s),c=new ee(o,{row:l}),u={headingRows:o.getAttribute("headingRows")||0,headingColumns:o.getAttribute("headingColumns")||0},d=new Map;for(const f of c){const b=d.get(l)||Lr(a,s,l,u,n);d.set(l,b),n.consumable.consume(f.cell,"insert");const _=n.writer.createPositionAt(b,"end");Fr(f,u,_,n,{asWidget:!0})}})}function XP(){return i=>i.on("insert:tableCell",(e,t,n)=>{const s=t.item;if(!n.consumable.consume(s,"insert"))return;const o=s.parent,r=o.parent,a=r.getChildIndex(o),l=new ee(r,{row:a}),c={headingRows:r.getAttribute("headingRows")||0,headingColumns:r.getAttribute("headingColumns")||0};for(const u of l)if(u.cell===s){const d=n.mapper.toViewElement(o),f=n.writer.createPositionAt(d,o.getChildIndex(s));Fr(u,c,f,n,{asWidget:!0});return}})}function ZP(){return i=>i.on("attribute:headingColumns:table",(e,t,n)=>{const s=t.item;if(!n.consumable.consume(t.item,e.name))return;const o={headingRows:s.getAttribute("headingRows")||0,headingColumns:s.getAttribute("headingColumns")||0},r=t.attributeOldValue,a=t.attributeNewValue,l=(r>a?r:a)-1;for(const c of new ee(s,{endColumn:l}))sI(c,o,n)})}function eI(){return i=>i.on("remove:tableRow",(e,t,n)=>{e.stop();const s=n.writer,o=n.mapper,a=o.toViewPosition(t.position).getLastMatchingPosition(f=>!f.item.is("element","tr")).nodeAfter,c=a.parent.parent,u=s.createRangeOn(a),d=s.remove(u);for(const f of s.createRangeIn(d).getItems())o.unbindViewElement(f);Ef("thead",c,n),Ef("tbody",c,n)},{priority:"higher"})}function tI(i,e){const{writer:t}=e;if(!!i.parent.is("element","tableCell"))return Cf(i)?t.createContainerElement("span",{class:"ck-table-bogus-paragraph"}):t.createContainerElement("p")}function Cf(i){return i.parent.childCount===1&&!Af(i)}function nI(i,e){return e.setCustomProperty("table",!0,i),lr(i,e,{hasSelectionHandle:!0})}function iI(i,e,t){const n=t.writer,s=t.mapper.toViewElement(i),o=n.createEditableElement(e,s.getAttributes()),r=cr(o,n);n.insert(n.createPositionAfter(s),r),n.move(n.createRangeIn(s),n.createPositionAt(r,0)),n.remove(n.createRangeOn(s)),t.mapper.unbindViewElement(s),t.mapper.bindElements(i,r)}function sI(i,e,t){const{cell:n}=i,s=kf(i,e),o=t.mapper.toViewElement(n);o&&o.name!==s&&iI(n,s,t)}function Fr(i,e,t,n,s){const o=s&&s.asWidget,r=kf(i,e),a=o?cr(n.writer.createEditableElement(r),n.writer):n.writer.createContainerElement(r),l=i.cell,c=l.getChild(0),u=l.childCount===1&&c.name==="paragraph";if(n.writer.insert(t,a),n.mapper.bindElements(l,a),!o&&u&&!Af(c)){const d=l.getChild(0);n.consumable.consume(d,"insert"),n.mapper.bindElements(d,a)}}function Lr(i,e,t,n,s){s.consumable.consume(e,"insert");const o=e.isEmpty?s.writer.createEmptyElement("tr"):s.writer.createContainerElement("tr");s.mapper.bindElements(e,o);const r=n.headingRows,a=rI(oI(t,n),i,s),l=r>0&&t>=r?t-r:t,c=s.writer.createPositionAt(a,l);return s.writer.insert(c,o),o}function kf(i,e){const{row:t,column:n}=i,{headingColumns:s,headingRows:o}=e;return o&&o>t||s&&s>n?"th":"td"}function oI(i,e){return i<e.headingRows?"thead":"tbody"}function rI(i,e,t){const n=Tf(i,e);return n||aI(i,e,t)}function Tf(i,e){for(const t of e.getChildren())if(t.name==i)return t}function aI(i,e,t){const n=t.writer.createContainerElement(i),s=t.writer.createPositionAt(e,i=="tbody"?"end":0);return t.writer.insert(s,n),n}function Ef(i,e,t){const n=Tf(i,e);n&&n.childCount===0&&t.writer.remove(t.writer.createRangeOn(n))}function lI(i){for(const e of i.getChildren())if(e.name==="table")return e}function Af(i){return!![...i.getAttributeKeys()].length}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class cI extends q{refresh(){const e=this.editor.model,t=e.document.selection,n=e.schema;this.isEnabled=uI(t,n)}execute(e={}){const t=this.editor.model,n=t.document.selection,s=this.editor.plugins.get("TableUtils"),o=this.editor.config.get("table"),r=Rn(n,t),a=o.defaultHeadings.rows,l=o.defaultHeadings.columns;e.headingRows===void 0&&a&&(e.headingRows=a),e.headingColumns===void 0&&l&&(e.headingColumns=l),t.change(c=>{const u=s.createTable(c,e);t.insertContent(u,r),c.setSelection(c.createPositionAt(u.getNodeByPath([0,0,0]),0))})}}function uI(i,e){const t=i.getFirstPosition().parent,n=t===t.root?t:t.parent;return e.checkChild(n,"table")}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Ln(i){const e=[];for(const t of Sf(i.getRanges())){const n=t.getContainedElement();n&&n.is("element","tableCell")&&e.push(n)}return e}function wi(i){const e=[];for(const t of i.getRanges()){const n=t.start.findAncestor("tableCell");n&&e.push(n)}return e}function Te(i){const e=Ln(i);return e.length?e:wi(i)}function Ht(i){const e=i.map(t=>t.parent.index);return xf(e)}function zn(i){const e=i[0].findAncestor("table"),n=[...new ee(e)].filter(s=>i.includes(s.cell)).map(s=>s.column);return xf(n)}function zr(i,e){if(i.length<2||!fI(i))return!1;const t=new Set,n=new Set;let s=0;for(const r of i){const{row:a,column:l}=e.getCellLocation(r),c=parseInt(r.getAttribute("rowspan")||1),u=parseInt(r.getAttribute("colspan")||1);t.add(a),n.add(l),c>1&&t.add(a+c-1),u>1&&n.add(l+u-1),s+=c*u}return hI(t,n)==s}function Sf(i){return Array.from(i).sort(dI)}function xf(i){const e=i.sort((s,o)=>s-o),t=e[0],n=e[e.length-1];return{first:t,last:n}}function dI(i,e){const t=i.start,n=e.start;return t.isBefore(n)?-1:1}function hI(i,e){const t=Array.from(i.values()),n=Array.from(e.values()),s=Math.max(...t),o=Math.min(...t),r=Math.max(...n),a=Math.min(...n);return(s-o+1)*(r-a+1)}function fI(i){const e=i[0].findAncestor("table"),t=Ht(i),n=parseInt(e.getAttribute("headingRows")||0);if(!Pf(t,n))return!1;const s=parseInt(e.getAttribute("headingColumns")||0),o=zn(i);return Pf(o,s)}function Pf({first:i,last:e},t){const n=i<t,s=e<t;return n===s}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class If extends q{constructor(e,t={}){super(e);this.order=t.order||"below"}refresh(){const e=this.editor.model.document.selection,t=!!Te(e).length;this.isEnabled=t}execute(){const e=this.editor,t=e.model.document.selection,n=e.plugins.get("TableUtils"),s=this.order==="above",o=Te(t),r=Ht(o),a=s?r.first:r.last,l=o[0].findAncestor("table");n.insertRows(l,{at:s?a:a+1,copyStructureFromAbove:!s})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Rf extends q{constructor(e,t={}){super(e);this.order=t.order||"right"}refresh(){const e=this.editor.model.document.selection,t=!!Te(e).length;this.isEnabled=t}execute(){const e=this.editor,t=e.model.document.selection,n=e.plugins.get("TableUtils"),s=this.order==="left",o=Te(t),r=zn(o),a=s?r.first:r.last,l=o[0].findAncestor("table");n.insertColumns(l,{columns:1,at:s?a:a+1})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Mf extends q{constructor(e,t={}){super(e);this.direction=t.direction||"horizontally"}refresh(){const e=Te(this.editor.model.document.selection);this.isEnabled=e.length===1}execute(){const e=Te(this.editor.model.document.selection)[0],t=this.direction==="horizontally",n=this.editor.plugins.get("TableUtils");t?n.splitCellHorizontally(e,2):n.splitCellVertically(e,2)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Vf(i,e,t){const{startRow:n,startColumn:s,endRow:o,endColumn:r}=e,a=t.createElement("table"),l=o-n+1;for(let u=0;u<l;u++)t.insertElement("tableRow",a,"end");const c=[...new ee(i,{startRow:n,endRow:o,startColumn:s,endColumn:r,includeAllSlots:!0})];for(const{row:u,column:d,cell:f,isAnchor:b,cellAnchorRow:_,cellAnchorColumn:C}of c){const A=u-n,R=a.getChild(A);if(!b)(_<n||C<s)&&dn(t,t.createPositionAt(R,"end"));else{const O=t.cloneElement(f);t.append(O,R),Ff(O,u,d,o,r,t)}}return mI(a,i,n,s,t),a}function Of(i,e,t=0){const n=[],s=new ee(i,{startRow:t,endRow:e-1});for(const o of s){const{row:r,cellHeight:a}=o,l=r+a-1;r<e&&e<=l&&n.push(o)}return n}function Nf(i,e,t){const n=i.parent,s=n.parent,o=n.index,r=parseInt(i.getAttribute("rowspan")),a=e-o,l={},c=r-a;c>1&&(l.rowspan=c);const u=parseInt(i.getAttribute("colspan")||1);u>1&&(l.colspan=u);const d=o,f=d+a,b=[...new ee(s,{startRow:d,endRow:f,includeAllSlots:!0})];let _=null,C;for(const A of b){const{row:R,column:O,cell:U}=A;U===i&&C===void 0&&(C=O),C!==void 0&&C===O&&R===f&&(_=dn(t,A.getPositionBefore(),l))}return ve("rowspan",a,i,t),_}function Df(i,e){const t=[],n=new ee(i);for(const s of n){const{column:o,cellWidth:r}=s,a=o+r-1;o<e&&e<=a&&t.push(s)}return t}function Bf(i,e,t,n){const s=parseInt(i.getAttribute("colspan")),o=t-e,r={},a=s-o;a>1&&(r.colspan=a);const l=parseInt(i.getAttribute("rowspan")||1);l>1&&(r.rowspan=l);const c=dn(n,n.createPositionAfter(i),r);return ve("colspan",o,i,n),c}function Ff(i,e,t,n,s,o){const r=parseInt(i.getAttribute("colspan")||1),a=parseInt(i.getAttribute("rowspan")||1);if(t+r-1>s){const u=s-t+1;ve("colspan",u,i,o,1)}if(e+a-1>n){const u=n-e+1;ve("rowspan",u,i,o,1)}}function mI(i,e,t,n,s){const o=parseInt(e.getAttribute("headingRows")||0);if(o>0){const a=o-t;ve("headingRows",a,i,s,0)}const r=parseInt(e.getAttribute("headingColumns")||0);if(r>0){const a=r-n;ve("headingColumns",a,i,s,0)}}function $r(i,e){const t=e.getColumns(i),n=new Array(t).fill(0);for(const{column:o}of new ee(i))n[o]++;const s=n.reduce((o,r,a)=>r?o:[...o,a],[]);if(s.length>0){const o=s[s.length-1];return e.removeColumns(i,{at:o}),!0}return!1}function Hr(i,e){const t=[],n=e.getRows(i);for(let s=0;s<n;s++)i.getChild(s).isEmpty&&t.push(s);if(t.length>0){const s=t[t.length-1];return e.removeRows(i,{at:s}),!0}return!1}function Ur(i,e){$r(i,e)||Hr(i,e)}function Lf(i,e){const t=Array.from(new ee(i,{startColumn:e.firstColumn,endColumn:e.lastColumn,row:e.lastRow}));if(t.every(({cellHeight:o})=>o===1))return e.lastRow;const s=t[0].cellHeight-1;return e.lastRow+s}function zf(i,e){const t=Array.from(new ee(i,{startRow:e.firstRow,endRow:e.lastRow,column:e.lastColumn}));if(t.every(({cellWidth:o})=>o===1))return e.lastColumn;const s=t[0].cellWidth-1;return e.lastColumn+s}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ys extends q{constructor(e,t){super(e);this.direction=t.direction,this.isHorizontal=this.direction=="right"||this.direction=="left"}refresh(){const e=this._getMergeableCell();this.value=e,this.isEnabled=!!e}execute(){const e=this.editor.model,t=e.document,n=wi(t.selection)[0],s=this.value,o=this.direction;e.change(r=>{const a=o=="right"||o=="down",l=a?n:s,c=a?s:n,u=c.parent;wI(c,l,r);const d=this.isHorizontal?"colspan":"rowspan",f=parseInt(n.getAttribute(d)||1),b=parseInt(s.getAttribute(d)||1);r.setAttribute(d,f+b,l),r.setSelection(r.createRangeIn(l));const _=this.editor.plugins.get("TableUtils"),C=u.findAncestor("table");Ur(C,_)})}_getMergeableCell(){const t=this.editor.model.document,n=wi(t.selection)[0];if(!n)return;const s=this.editor.plugins.get("TableUtils"),o=this.isHorizontal?gI(n,this.direction,s):pI(n,this.direction,s);if(!o)return;const r=this.isHorizontal?"rowspan":"colspan",a=parseInt(n.getAttribute(r)||1);if(parseInt(o.getAttribute(r)||1)===a)return o}}function gI(i,e,t){const s=i.parent.parent,o=e=="right"?i.nextSibling:i.previousSibling,r=(s.getAttribute("headingColumns")||0)>0;if(!o)return;const a=e=="right"?i:o,l=e=="right"?o:i,{column:c}=t.getCellLocation(a),{column:u}=t.getCellLocation(l),d=parseInt(a.getAttribute("colspan")||1),f=Br(t,a),b=Br(t,l);return r&&f!=b?void 0:c+d===u?o:void 0}function pI(i,e,t){const n=i.parent,s=n.parent,o=s.getChildIndex(n);if(e=="down"&&o===t.getRows(s)-1||e=="up"&&o===0)return;const r=parseInt(i.getAttribute("rowspan")||1),a=s.getAttribute("headingRows")||0,l=e=="down"&&o+r===a,c=e=="up"&&o===a;if(a&&(l||c))return;const u=parseInt(i.getAttribute("rowspan")||1),d=e=="down"?o+u:o,f=[...new ee(s,{endRow:d})],_=f.find(A=>A.cell===i).column,C=f.find(({row:A,cellHeight:R,column:O})=>O!==_?!1:e=="down"?A===d:d===A+R);return C&&C.cell}function wI(i,e,t){$f(i)||($f(e)&&t.remove(t.createRangeIn(e)),t.move(t.createRangeIn(i),t.createPositionAt(e,"end"))),t.remove(i)}function $f(i){return i.childCount==1&&i.getChild(0).is("element","paragraph")&&i.getChild(0).isEmpty}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class bI extends q{refresh(){const e=Te(this.editor.model.document.selection),t=e[0];if(t){const n=t.findAncestor("table"),o=this.editor.plugins.get("TableUtils").getRows(n)-1,r=Ht(e),a=r.first===0&&r.last===o;this.isEnabled=!a}else this.isEnabled=!1}execute(){const e=this.editor.model,t=this.editor.plugins.get("TableUtils"),n=Te(e.document.selection),s=Ht(n),o=n[0],r=o.findAncestor("table"),a=t.getCellLocation(o).column;e.change(l=>{const c=s.last-s.first+1;t.removeRows(r,{at:s.first,rows:c});const u=_I(r,s.first,a,t.getRows(r));l.setSelection(l.createPositionAt(u,0))})}}function _I(i,e,t,n){const s=i.getChild(Math.min(e,n-1));let o=s.getChild(0),r=0;for(const a of s.getChildren()){if(r>t)return o;o=a,r+=parseInt(a.getAttribute("colspan")||1)}return o}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class vI extends q{refresh(){const e=Te(this.editor.model.document.selection),t=e[0];if(t){const n=t.findAncestor("table"),s=this.editor.plugins.get("TableUtils").getColumns(n),{first:o,last:r}=zn(e);this.isEnabled=r-o<s-1}else this.isEnabled=!1}execute(){const[e,t]=CI(this.editor.model.document.selection),n=e.parent.parent,s=[...new ee(n)],o={first:s.find(a=>a.cell===e).column,last:s.find(a=>a.cell===t).column},r=yI(s,e,t,o);this.editor.model.change(a=>{const l=o.last-o.first+1;this.editor.plugins.get("TableUtils").removeColumns(n,{at:o.first,columns:l}),a.setSelection(a.createPositionAt(r,0))})}}function yI(i,e,t,n){return parseInt(t.getAttribute("colspan")||1)>1?t:e.previousSibling||t.nextSibling?t.nextSibling||e.previousSibling:n.first?i.reverse().find(({column:o})=>o<n.first).cell:i.reverse().find(({column:o})=>o>n.last).cell}function CI(i){const e=Te(i),t=e[0],n=e.pop(),s=[t,n];return t.isBefore(n)?s:s.reverse()}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class kI extends q{refresh(){const e=this.editor.model,t=Te(e.document.selection),n=t.length>0;this.isEnabled=n,this.value=n&&t.every(s=>this._isInHeading(s,s.parent.parent))}execute(e={}){if(e.forceValue===this.value)return;const t=this.editor.model,n=Te(t.document.selection),s=n[0].findAncestor("table"),{first:o,last:r}=Ht(n),a=this.value?o:r+1,l=s.getAttribute("headingRows")||0;t.change(c=>{if(a){const u=a>l?l:0,d=Of(s,a,u);for(const{cell:f}of d)Nf(f,a,c)}ve("headingRows",a,s,c,0)})}_isInHeading(e,t){const n=parseInt(t.getAttribute("headingRows")||0);return!!n&&e.parent.index<n}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class TI extends q{refresh(){const e=this.editor.model,t=Te(e.document.selection),n=this.editor.plugins.get("TableUtils"),s=t.length>0;this.isEnabled=s,this.value=s&&t.every(o=>Br(n,o))}execute(e={}){if(e.forceValue===this.value)return;const t=this.editor.model,n=Te(t.document.selection),s=n[0].findAncestor("table"),{first:o,last:r}=zn(n),a=this.value?o:r+1;t.change(l=>{if(a){const c=Df(s,a);for(const{cell:u,column:d}of c)Bf(u,d,a,l)}ve("headingColumns",a,s,l,0)})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class $n extends P{static get pluginName(){return"TableUtils"}init(){this.decorate("insertColumns"),this.decorate("insertRows")}getCellLocation(e){const t=e.parent,n=t.parent,s=n.getChildIndex(t),o=new ee(n,{row:s});for(const{cell:r,row:a,column:l}of o)if(r===e)return{row:a,column:l}}createTable(e,t){const n=e.createElement("table"),s=parseInt(t.rows)||2,o=parseInt(t.columns)||2;return Wr(e,n,0,s,o),t.headingRows&&ve("headingRows",Math.min(t.headingRows,s),n,e,0),t.headingColumns&&ve("headingColumns",Math.min(t.headingColumns,o),n,e,0),n}insertRows(e,t={}){const n=this.editor.model,s=t.at||0,o=t.rows||1,r=t.copyStructureFromAbove!==void 0,a=t.copyStructureFromAbove?s-1:s,l=this.getRows(e),c=this.getColumns(e);if(s>l)throw new p("tableutils-insertrows-insert-out-of-range",this,{options:t});n.change(u=>{const d=e.getAttribute("headingRows")||0;if(d>s&&ve("headingRows",d+o,e,u,0),!r&&(s===0||s===l)){Wr(u,e,s,o,c);return}const f=r?Math.max(s,a):s,b=new ee(e,{endRow:f}),_=new Array(c).fill(1);for(const{row:C,column:A,cellHeight:R,cellWidth:O,cell:U}of b){const Q=C+R-1,se=C<s&&s<=Q,N=C<=a&&a<=Q;se?(u.setAttribute("rowspan",R+o,U),_[A]=-O):r&&N&&(_[A]=O)}for(let C=0;C<o;C++){const A=u.createElement("tableRow");u.insert(A,e,s);for(let R=0;R<_.length;R++){const O=_[R],U=u.createPositionAt(A,"end");O>0&&dn(u,U,O>1?{colspan:O}:null),R+=Math.abs(O)-1}}})}insertColumns(e,t={}){const n=this.editor.model,s=t.at||0,o=t.columns||1;n.change(r=>{const a=e.getAttribute("headingColumns");s<a&&r.setAttribute("headingColumns",a+o,e);const l=this.getColumns(e);if(s===0||l===s){for(const u of e.getChildren())!u.is("element","tableRow")||Hn(o,r,r.createPositionAt(u,s?"end":0));return}const c=new ee(e,{column:s,includeAllSlots:!0});for(const u of c){const{row:d,cell:f,cellAnchorColumn:b,cellAnchorRow:_,cellWidth:C,cellHeight:A}=u;if(b<s){r.setAttribute("colspan",C+o,f);const R=_+A-1;for(let O=d;O<=R;O++)c.skipRow(O)}else Hn(o,r,u.getPositionBefore())}})}removeRows(e,t){const n=this.editor.model,s=t.rows||1,o=this.getRows(e),r=t.at,a=r+s-1;if(a>o-1)throw new p("tableutils-removerows-row-index-out-of-range",this,{table:e,options:t});n.change(l=>{const{cellsToMove:c,cellsToTrim:u}=SI(e,r,a);if(c.size){const d=a+1;xI(e,d,c,l)}for(let d=a;d>=r;d--)l.remove(e.getChild(d));for(const{rowspan:d,cell:f}of u)ve("rowspan",d,f,l);AI(e,r,a,l),$r(e,this)||Hr(e,this)})}removeColumns(e,t){const n=this.editor.model,s=t.at,o=t.columns||1,r=t.at+o-1;n.change(a=>{EI(e,{first:s,last:r},a);for(let l=r;l>=s;l--)for(const{cell:c,column:u,cellWidth:d}of[...new ee(e)])u<=l&&d>1&&u+d>l?ve("colspan",d-1,c,a):u===l&&a.remove(c);Hr(e,this)||$r(e,this)})}splitCellVertically(e,t=2){const n=this.editor.model,o=e.parent.parent,r=parseInt(e.getAttribute("rowspan")||1),a=parseInt(e.getAttribute("colspan")||1);n.change(l=>{if(a>1){const{newCellsSpan:c,updatedSpan:u}=Hf(a,t);ve("colspan",u,e,l);const d={};c>1&&(d.colspan=c),r>1&&(d.rowspan=r);const f=a>t?t-1:a-1;Hn(f,l,l.createPositionAfter(e),d)}if(a<t){const c=t-a,u=[...new ee(o)],{column:d}=u.find(({cell:C})=>C===e),f=u.filter(({cell:C,cellWidth:A,column:R})=>{const O=C!==e&&R===d,U=R<d&&R+A>d;return O||U});for(const{cell:C,cellWidth:A}of f)l.setAttribute("colspan",A+c,C);const b={};r>1&&(b.rowspan=r),Hn(c,l,l.createPositionAfter(e),b);const _=o.getAttribute("headingColumns")||0;_>d&&ve("headingColumns",_+c,o,l)}})}splitCellHorizontally(e,t=2){const n=this.editor.model,s=e.parent,o=s.parent,r=o.getChildIndex(s),a=parseInt(e.getAttribute("rowspan")||1),l=parseInt(e.getAttribute("colspan")||1);n.change(c=>{if(a>1){const u=[...new ee(o,{startRow:r,endRow:r+a-1,includeAllSlots:!0})],{newCellsSpan:d,updatedSpan:f}=Hf(a,t);ve("rowspan",f,e,c);const{column:b}=u.find(({cell:C})=>C===e),_={};d>1&&(_.rowspan=d),l>1&&(_.colspan=l);for(const C of u){const{column:A,row:R}=C,O=R>=r+f,U=A===b,Q=(R+r+f)%d==0;O&&U&&Q&&Hn(1,c,C.getPositionBefore(),_)}}if(a<t){const u=t-a,d=[...new ee(o,{startRow:0,endRow:r})];for(const{cell:_,cellHeight:C,row:A}of d)if(_!==e&&A+C>r){const R=C+u;c.setAttribute("rowspan",R,_)}const f={};l>1&&(f.colspan=l),Wr(c,o,r+1,u,1,f);const b=o.getAttribute("headingRows")||0;b>r&&ve("headingRows",b+u,o,c)}})}getColumns(e){return[...e.getChild(0).getChildren()].reduce((n,s)=>{const o=parseInt(s.getAttribute("colspan")||1);return n+o},0)}getRows(e){return Array.from(e.getChildren()).reduce((t,n)=>n.is("element","tableRow")?t+1:t,0)}}function Wr(i,e,t,n,s,o={}){for(let r=0;r<n;r++){const a=i.createElement("tableRow");i.insert(a,e,t),Hn(s,i,i.createPositionAt(a,"end"),o)}}function Hn(i,e,t,n={}){for(let s=0;s<i;s++)dn(e,t,n)}function Hf(i,e){if(i<e)return{newCellsSpan:1,updatedSpan:1};const t=Math.floor(i/e),n=i-t*e+t;return{newCellsSpan:t,updatedSpan:n}}function EI(i,e,t){const n=i.getAttribute("headingColumns")||0;if(n&&e.first<n){const s=Math.min(n-1,e.last)-e.first+1;t.setAttribute("headingColumns",n-s,i)}}function AI(i,e,t,n){const s=i.getAttribute("headingRows")||0;if(e<s){const o=t<s?s-(t-e+1):e;ve("headingRows",o,i,n,0)}}function SI(i,e,t){const n=new Map,s=[];for(const{row:o,column:r,cellHeight:a,cell:l}of new ee(i,{endRow:t})){const c=o+a-1;if(o>=e&&o<=t&&c>t){const f=t-o+1,b=a-f;n.set(r,{cell:l,rowspan:b})}if(o<e&&c>=e){let f;c>=t?f=t-e+1:f=c-e+1,s.push({cell:l,rowspan:a-f})}}return{cellsToMove:n,cellsToTrim:s}}function xI(i,e,t,n){const o=[...new ee(i,{includeAllSlots:!0,row:e})],r=i.getChild(e);let a;for(const{column:l,cell:c,isAnchor:u}of o)if(t.has(l)){const{cell:d,rowspan:f}=t.get(l),b=a?n.createPositionAfter(a):n.createPositionAt(r,0);n.move(n.createRangeOn(d),b),ve("rowspan",f,d,n),a=d}else u&&(a=c)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class PI extends q{refresh(){const e=Ln(this.editor.model.document.selection);this.isEnabled=zr(e,this.editor.plugins.get($n))}execute(){const e=this.editor.model,t=this.editor.plugins.get($n);e.change(n=>{const s=Ln(e.document.selection),o=s.shift(),{mergeWidth:r,mergeHeight:a}=RI(o,s,t);ve("colspan",r,o,n),ve("rowspan",a,o,n);for(const c of s)II(c,o,n);const l=o.findAncestor("table");Ur(l,t),n.setSelection(o,"in")})}}function II(i,e,t){Uf(i)||(Uf(e)&&t.remove(t.createRangeIn(e)),t.move(t.createRangeIn(i),t.createPositionAt(e,"end"))),t.remove(i)}function Uf(i){return i.childCount==1&&i.getChild(0).is("element","paragraph")&&i.getChild(0).isEmpty}function RI(i,e,t){let n=0,s=0;for(const c of e){const{row:u,column:d}=t.getCellLocation(c);n=Wf(c,d,n,"colspan"),s=Wf(c,u,s,"rowspan")}const{row:o,column:r}=t.getCellLocation(i),a=n-r,l=s-o;return{mergeWidth:a,mergeHeight:l}}function Wf(i,e,t,n){const s=parseInt(i.getAttribute(n)||1);return Math.max(t,e+s)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class MI extends q{constructor(e){super(e);this.affectsData=!1}refresh(){const e=Te(this.editor.model.document.selection);this.isEnabled=e.length>0}execute(){const e=this.editor.model,t=Te(e.document.selection),n=Ht(t),s=t[0].findAncestor("table"),o=[];for(let r=n.first;r<=n.last;r++)for(const a of s.getChild(r).getChildren())o.push(e.createRangeOn(a));e.change(r=>{r.setSelection(o)})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class VI extends q{constructor(e){super(e);this.affectsData=!1}refresh(){const e=Te(this.editor.model.document.selection);this.isEnabled=e.length>0}execute(){const e=this.editor.model,t=Te(e.document.selection),n=t[0],s=t.pop(),o=n.findAncestor("table"),r=this.editor.plugins.get("TableUtils"),a=r.getCellLocation(n),l=r.getCellLocation(s),c=Math.min(a.column,l.column),u=Math.max(a.column,l.column),d=[];for(const f of new ee(o,{startColumn:c,endColumn:u}))d.push(e.createRangeOn(f.cell));e.change(f=>{f.setSelection(d)})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function OI(i){i.document.registerPostFixer(e=>NI(e,i))}function NI(i,e){const t=e.document.differ.getChanges();let n=!1;const s=new Set;for(const o of t){let r;o.name=="table"&&o.type=="insert"&&(r=o.position.nodeAfter),(o.name=="tableRow"||o.name=="tableCell")&&(r=o.position.findAncestor("table")),zI(o)&&(r=o.range.start.findAncestor("table")),r&&!s.has(r)&&(n=DI(r,i)||n,n=BI(r,i)||n,s.add(r))}return n}function DI(i,e){let t=!1;const n=FI(i);if(n.length){t=!0;for(const s of n)ve("rowspan",s.rowspan,s.cell,e,1)}return t}function BI(i,e){let t=!1;const n=LI(i),s=[];for(const[l,c]of n.entries())!c&&i.getChild(l).is("element","tableRow")&&s.push(l);if(s.length){t=!0;for(const l of s.reverse())e.remove(i.getChild(l)),n.splice(l,1)}const o=n.filter((l,c)=>i.getChild(c).is("element","tableRow")),r=o[0];if(!o.every(l=>l===r)){const l=o.reduce((c,u)=>u>c?u:c,0);for(const[c,u]of o.entries()){const d=l-u;if(d){for(let f=0;f<d;f++)dn(e,e.createPositionAt(i.getChild(c),"end"));t=!0}}}return t}function FI(i){const e=parseInt(i.getAttribute("headingRows")||0),t=Array.from(i.getChildren()).reduce((s,o)=>o.is("element","tableRow")?s+1:s,0),n=[];for(const{row:s,cell:o,cellHeight:r}of new ee(i)){if(r<2)continue;const l=s<e?e:t;if(s+r>l){const c=l-s;n.push({cell:o,rowspan:c})}}return n}function LI(i){const e=new Array(i.childCount).fill(0);for(const{rowIndex:t}of new ee(i,{includeAllSlots:!0}))e[t]++;return e}function zI(i){const e=i.type==="attribute",t=i.attributeKey;return e&&(t==="headingRows"||t==="colspan"||t==="rowspan")}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function $I(i){i.document.registerPostFixer(e=>HI(e,i))}function HI(i,e){const t=e.document.differ.getChanges();let n=!1;for(const s of t)s.type=="insert"&&s.name=="table"&&(n=UI(s.position.nodeAfter,i)||n),s.type=="insert"&&s.name=="tableRow"&&(n=qf(s.position.nodeAfter,i)||n),s.type=="insert"&&s.name=="tableCell"&&(n=qr(s.position.nodeAfter,i)||n),WI(s)&&(n=qr(s.position.parent,i)||n);return n}function UI(i,e){let t=!1;for(const n of i.getChildren())n.is("element","tableRow")&&(t=qf(n,e)||t);return t}function qf(i,e){let t=!1;for(const n of i.getChildren())t=qr(n,e)||t;return t}function qr(i,e){if(i.childCount==0)return e.insertElement("paragraph",i),!0;const t=Array.from(i.getChildren()).filter(n=>n.is("$text"));for(const n of t)e.wrap(e.createRangeOn(n),"paragraph");return!!t.length}function WI(i){return!i.position||!i.position.parent.is("element","tableCell")?!1:i.type=="insert"&&i.name=="$text"||i.type=="remove"}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function qI(i,e){i.document.registerPostFixer(()=>jI(i.document.differ,e))}function jI(i,e){const t=new Set;for(const n of i.getChanges()){const s=n.type=="attribute"?n.range.start.parent:n.position.parent;s.is("element","tableCell")&&t.add(s)}for(const n of t.values())for(const s of[...n.getChildren()].filter(o=>KI(o,e)))i.refreshItem(s);return!1}function KI(i,e){if(!i.is("element","paragraph"))return!1;const t=e.toViewElement(i);return t?Cf(i)!==t.is("element","span"):!1}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function GI(i){i.document.registerPostFixer(()=>JI(i))}function JI(i){const e=i.document.differ,t=new Set;for(const n of e.getChanges())if(n.type==="attribute"){const s=n.range.start.nodeAfter;s&&s.is("element","table")&&n.attributeKey==="headingRows"&&t.add(s)}else if(n.type==="insert"||n.type==="remove"){if(n.name==="tableRow"){const s=n.position.findAncestor("table"),o=s.getAttribute("headingRows")||0;n.position.offset<o&&t.add(s)}else if(n.name==="tableCell"){const s=n.position.findAncestor("table"),o=s.getAttribute("headingColumns")||0;n.position.offset<o&&t.add(s)}}if(t.size){for(const n of t.values())e.refreshItem(n);return!0}return!1}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class QI extends P{static get pluginName(){return"TableEditing"}init(){const e=this.editor,t=e.model,n=t.schema,s=e.conversion;n.register("table",{allowWhere:"$block",allowAttributes:["headingRows","headingColumns"],isObject:!0,isBlock:!0}),n.register("tableRow",{allowIn:"table",isLimit:!0}),n.register("tableCell",{allowIn:"tableRow",allowChildren:"$block",allowAttributes:["colspan","rowspan"],isLimit:!0,isSelectable:!0}),s.for("upcast").add(WP()),s.for("upcast").add(qP()),s.for("editingDowncast").add(yf({asWidget:!0})),s.for("dataDowncast").add(yf()),s.for("upcast").elementToElement({model:"tableRow",view:"tr"}),s.for("upcast").add(jP()),s.for("editingDowncast").add(YP()),s.for("editingDowncast").add(eI()),s.for("upcast").elementToElement({model:"tableCell",view:"td"}),s.for("upcast").elementToElement({model:"tableCell",view:"th"}),s.for("upcast").add(vf("td")),s.for("upcast").add(vf("th")),s.for("editingDowncast").add(XP()),s.for("editingDowncast").elementToElement({model:"paragraph",view:tI,converterPriority:"high"}),s.for("downcast").attributeToAttribute({model:"colspan",view:"colspan"}),s.for("upcast").attributeToAttribute({model:{key:"colspan",value:jf("colspan")},view:"colspan"}),s.for("downcast").attributeToAttribute({model:"rowspan",view:"rowspan"}),s.for("upcast").attributeToAttribute({model:{key:"rowspan",value:jf("rowspan")},view:"rowspan"}),s.for("editingDowncast").add(ZP()),e.data.mapper.on("modelToViewPosition",YI()),e.config.define("table.defaultHeadings.rows",0),e.config.define("table.defaultHeadings.columns",0),e.commands.add("insertTable",new cI(e)),e.commands.add("insertTableRowAbove",new If(e,{order:"above"})),e.commands.add("insertTableRowBelow",new If(e,{order:"below"})),e.commands.add("insertTableColumnLeft",new Rf(e,{order:"left"})),e.commands.add("insertTableColumnRight",new Rf(e,{order:"right"})),e.commands.add("removeTableRow",new bI(e)),e.commands.add("removeTableColumn",new vI(e)),e.commands.add("splitTableCellVertically",new Mf(e,{direction:"vertically"})),e.commands.add("splitTableCellHorizontally",new Mf(e,{direction:"horizontally"})),e.commands.add("mergeTableCells",new PI(e)),e.commands.add("mergeTableCellRight",new ys(e,{direction:"right"})),e.commands.add("mergeTableCellLeft",new ys(e,{direction:"left"})),e.commands.add("mergeTableCellDown",new ys(e,{direction:"down"})),e.commands.add("mergeTableCellUp",new ys(e,{direction:"up"})),e.commands.add("setTableColumnHeader",new TI(e)),e.commands.add("setTableRowHeader",new kI(e)),e.commands.add("selectTableRow",new MI(e)),e.commands.add("selectTableColumn",new VI(e)),GI(t),OI(t),qI(t,e.editing.mapper),$I(t)}static get requires(){return[$n]}}function YI(){return(i,e)=>{const t=e.modelPosition.parent,n=e.modelPosition.nodeBefore;if(!t.is("element","tableCell")||!n||!n.is("element","paragraph"))return;const s=e.mapper.toViewElement(n),o=e.mapper.toViewElement(t);s===o&&(e.viewPosition=e.mapper.findPositionIn(o,n.maxOffset))}}function jf(i){return e=>{const t=parseInt(e.getAttribute(i));return Number.isNaN(t)||t<=0?null:t}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class XI extends j{constructor(e){super(e);const t=this.bindTemplate;this.items=this._createGridCollection(),this.set("rows",0),this.set("columns",0),this.bind("label").to(this,"columns",this,"rows",(n,s)=>`${s} \xD7 ${n}`),this.setTemplate({tag:"div",attributes:{class:["ck"]},children:[{tag:"div",attributes:{class:["ck-insert-table-dropdown__grid"]},on:{"mouseover@.ck-insert-table-dropdown-grid-box":t.to("boxover")},children:this.items},{tag:"div",attributes:{class:["ck-insert-table-dropdown__label"]},children:[{text:t.to("label")}]}],on:{mousedown:t.to(n=>{n.preventDefault()}),click:t.to(()=>{this.fire("execute")})}}),this.on("boxover",(n,s)=>{const{row:o,column:r}=s.target.dataset;this.set({rows:parseInt(o),columns:parseInt(r)})}),this.on("change:columns",()=>{this._highlightGridBoxes()}),this.on("change:rows",()=>{this._highlightGridBoxes()})}focus(){}focusLast(){}_highlightGridBoxes(){const e=this.rows,t=this.columns;this.items.map((n,s)=>{const o=Math.floor(s/10),r=s%10,a=o<e&&r<t;n.set("isOn",a)})}_createGridCollection(){const e=[];for(let t=0;t<100;t++){const n=Math.floor(t/10),s=t%10;e.push(new ZI(this.locale,n+1,s+1))}return this.createCollection(e)}}class ZI extends j{constructor(e,t,n){super(e);const s=this.bindTemplate;this.set("isOn",!1),this.setTemplate({tag:"div",attributes:{class:["ck-insert-table-dropdown-grid-box",s.if("isOn","ck-on")],"data-row":t,"data-column":n}})}}var eR='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 6v3h4V6H3zm0 4v3h4v-3H3zm0 4v3h4v-3H3zm5 3h4v-3H8v3zm5 0h4v-3h-4v3zm4-4v-3h-4v3h4zm0-4V6h-4v3h4zm1.5 8a1.5 1.5 0 0 1-1.5 1.5H3A1.5 1.5 0 0 1 1.5 17V4c.222-.863 1.068-1.5 2-1.5h13c.932 0 1.778.637 2 1.5v13zM12 13v-3H8v3h4zm0-4V6H8v3h4z"/></svg>',tR='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M18 7v1H2V7h16zm0 5v1H2v-1h16z" opacity=".6"/><path d="M14 1v18a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V1a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1zm-2 1H8v4h4V2zm0 6H8v4h4V8zm0 6H8v4h4v-4z"/></svg>',nR='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v16h-1V2z" opacity=".6"/><path d="M1 6h18a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1zm1 2v4h4V8H2zm6 0v4h4V8H8zm6 0v4h4V8h-4z"/></svg>',iR='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v7h-1V2zm6 5v1H2V7h16zM8 12v1H2v-1h6z" opacity=".6"/><path d="M7 7h12a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1zm1 2v9h10V9H8z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class sR extends P{static get pluginName(){return"TableUI"}init(){const e=this.editor,t=this.editor.t,s=e.locale.contentLanguageDirection==="ltr";e.ui.componentFactory.add("insertTable",o=>{const r=e.commands.get("insertTable"),a=Lt(o);a.bind("isEnabled").to(r),a.buttonView.set({icon:eR,label:t("Insert table"),tooltip:!0});let l;return a.on("change:isOpen",()=>{l||(l=new XI(o),a.panelView.children.add(l),l.delegate("execute").to(a),a.buttonView.on("open",()=>{l.rows=0,l.columns=0}),a.on("execute",()=>{e.execute("insertTable",{rows:l.rows,columns:l.columns}),e.editing.view.focus()}))}),a}),e.ui.componentFactory.add("tableColumn",o=>{const r=[{type:"switchbutton",model:{commandName:"setTableColumnHeader",label:t("Header column"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:s?"insertTableColumnLeft":"insertTableColumnRight",label:t("Insert column left")}},{type:"button",model:{commandName:s?"insertTableColumnRight":"insertTableColumnLeft",label:t("Insert column right")}},{type:"button",model:{commandName:"removeTableColumn",label:t("Delete column")}},{type:"button",model:{commandName:"selectTableColumn",label:t("Select column")}}];return this._prepareDropdown(t("Column"),tR,r,o)}),e.ui.componentFactory.add("tableRow",o=>{const r=[{type:"switchbutton",model:{commandName:"setTableRowHeader",label:t("Header row"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:"insertTableRowAbove",label:t("Insert row above")}},{type:"button",model:{commandName:"insertTableRowBelow",label:t("Insert row below")}},{type:"button",model:{commandName:"removeTableRow",label:t("Delete row")}},{type:"button",model:{commandName:"selectTableRow",label:t("Select row")}}];return this._prepareDropdown(t("Row"),nR,r,o)}),e.ui.componentFactory.add("mergeTableCells",o=>{const r=[{type:"button",model:{commandName:"mergeTableCellUp",label:t("Merge cell up")}},{type:"button",model:{commandName:s?"mergeTableCellRight":"mergeTableCellLeft",label:t("Merge cell right")}},{type:"button",model:{commandName:"mergeTableCellDown",label:t("Merge cell down")}},{type:"button",model:{commandName:s?"mergeTableCellLeft":"mergeTableCellRight",label:t("Merge cell left")}},{type:"separator"},{type:"button",model:{commandName:"splitTableCellVertically",label:t("Split cell vertically")}},{type:"button",model:{commandName:"splitTableCellHorizontally",label:t("Split cell horizontally")}}];return this._prepareMergeSplitButtonDropdown(t("Merge cells"),iR,r,o)})}_prepareDropdown(e,t,n,s){const o=this.editor,r=Lt(s),a=this._fillDropdownWithListOptions(r,n);return r.buttonView.set({label:e,icon:t,tooltip:!0}),r.bind("isEnabled").toMany(a,"isEnabled",(...l)=>l.some(c=>c)),this.listenTo(r,"execute",l=>{o.execute(l.source.commandName),o.editing.view.focus()}),r}_prepareMergeSplitButtonDropdown(e,t,n,s){const o=this.editor,r=Lt(s,td),a="mergeTableCells",l=o.commands.get(a),c=this._fillDropdownWithListOptions(r,n);return r.buttonView.set({label:e,icon:t,tooltip:!0,isEnabled:!0}),r.bind("isEnabled").toMany([l,...c],"isEnabled",(...u)=>u.some(d=>d)),this.listenTo(r.buttonView,"execute",()=>{o.execute(a),o.editing.view.focus()}),this.listenTo(r,"execute",u=>{o.execute(u.source.commandName),o.editing.view.focus()}),r}_fillDropdownWithListOptions(e,t){const n=this.editor,s=[],o=new $e;for(const r of t)oR(r,n,s,o);return er(e,o,n.ui.componentFactory),s}}function oR(i,e,t,n){const s=i.model=new ss(i.model),{commandName:o,bindIsOn:r}=i.model;if(i.type==="button"||i.type==="switchbutton"){const a=e.commands.get(o);t.push(a),s.set({commandName:o}),s.bind("isEnabled").to(a),r&&s.bind("isOn").to(a,"value")}s.set({withText:!0}),n.add(i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class hn extends P{static get pluginName(){return"TableSelection"}static get requires(){return[$n]}init(){const t=this.editor.model;this.listenTo(t,"deleteContent",(n,s)=>this._handleDeleteContent(n,s),{priority:"high"}),this._defineSelectionConverter(),this._enablePluginDisabling()}getSelectedTableCells(){const e=this.editor.model.document.selection,t=Ln(e);return t.length==0?null:t}getSelectionAsFragment(){const e=this.getSelectedTableCells();return e?this.editor.model.change(t=>{const n=t.createDocumentFragment(),s=this.editor.plugins.get("TableUtils"),{first:o,last:r}=zn(e),{first:a,last:l}=Ht(e),c=e[0].findAncestor("table");let u=l,d=r;if(zr(e,s)){const _={firstColumn:o,lastColumn:r,firstRow:a,lastRow:l};u=Lf(c,_),d=zf(c,_)}const b=Vf(c,{startRow:a,startColumn:o,endRow:u,endColumn:d},t);return t.insert(b,n,0),n}):null}setCellSelection(e,t){const n=this._getCellsToSelect(e,t);this.editor.model.change(s=>{s.setSelection(n.cells.map(o=>s.createRangeOn(o)),{backward:n.backward})})}getFocusCell(){const n=[...this.editor.model.document.selection.getRanges()].pop().getContainedElement();return n&&n.is("element","tableCell")?n:null}getAnchorCell(){const e=this.editor.model.document.selection,n=De(e.getRanges()).getContainedElement();return n&&n.is("element","tableCell")?n:null}_defineSelectionConverter(){const e=this.editor,t=new Set;e.conversion.for("editingDowncast").add(s=>s.on("selection",(o,r,a)=>{const l=a.writer;n(l);const c=this.getSelectedTableCells();if(!c)return;for(const d of c){const f=a.mapper.toViewElement(d);l.addClass("ck-editor__editable_selected",f),t.add(f)}const u=a.mapper.toViewElement(c[c.length-1]);l.setSelection(u,0)},{priority:"lowest"}));function n(s){for(const o of t)s.removeClass("ck-editor__editable_selected",o);t.clear()}}_enablePluginDisabling(){const e=this.editor;this.on("change:isEnabled",()=>{if(!this.isEnabled){const t=this.getSelectedTableCells();if(!t)return;e.model.change(n=>{const s=n.createPositionAt(t[0],0),o=e.model.schema.getNearestSelectionRange(s);n.setSelection(o)})}})}_handleDeleteContent(e,t){const[n,s]=t,o=this.editor.model,r=!s||s.direction=="backward",a=Ln(n);!a.length||(e.stop(),o.change(l=>{const c=a[r?a.length-1:0];o.change(d=>{for(const f of a)o.deleteContent(d.createSelection(f,"in"))});const u=o.schema.getNearestSelectionRange(l.createPositionAt(c,0));n.is("documentSelection")?l.setSelection(u):n.setTo(u)}))}_getCellsToSelect(e,t){const n=this.editor.plugins.get("TableUtils"),s=n.getCellLocation(e),o=n.getCellLocation(t),r=Math.min(s.row,o.row),a=Math.max(s.row,o.row),l=Math.min(s.column,o.column),c=Math.max(s.column,o.column),u=new Array(a-r+1).fill(null).map(()=>[]),d={startRow:r,endRow:a,startColumn:l,endColumn:c};for(const{row:_,cell:C}of new ee(e.findAncestor("table"),d))u[_-r].push(C);const f=o.row<s.row,b=o.column<s.column;return f&&u.reverse(),b&&u.forEach(_=>_.reverse()),{cells:u.flat(),backward:f||b}}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class rR extends P{static get pluginName(){return"TableClipboard"}static get requires(){return[hn,$n]}init(){const e=this.editor,t=e.editing.view.document;this.listenTo(t,"copy",(n,s)=>this._onCopyCut(n,s)),this.listenTo(t,"cut",(n,s)=>this._onCopyCut(n,s)),this.listenTo(e.model,"insertContent",(n,s)=>this._onInsertContent(n,...s),{priority:"high"}),this.decorate("_replaceTableSlotCell")}_onCopyCut(e,t){const n=this.editor.plugins.get(hn);if(!n.getSelectedTableCells()||e.name=="cut"&&this.editor.isReadOnly)return;t.preventDefault(),e.stop();const s=this.editor.data,o=this.editor.editing.view.document,r=s.toView(n.getSelectionAsFragment());o.fire("clipboardOutput",{dataTransfer:t.dataTransfer,content:r,method:e.name})}_onInsertContent(e,t,n){if(n&&!n.is("documentSelection"))return;const s=this.editor.model,o=this.editor.plugins.get($n);let r=aR(t,s);if(!r)return;const a=Te(s.document.selection);if(!a.length){Ur(r,o);return}e.stop(),s.change(l=>{const c={width:o.getColumns(r),height:o.getRows(r)},u=lR(a,c,l,o),d=u.lastRow-u.firstRow+1,f=u.lastColumn-u.firstColumn+1,b={startRow:0,startColumn:0,endRow:Math.min(d,c.height)-1,endColumn:Math.min(f,c.width)-1};r=Vf(r,b,l);const _=a[0].findAncestor("table"),C=this._replaceSelectedCellsWithPasted(r,c,_,u,l);if(this.editor.plugins.get("TableSelection").isEnabled){const A=Sf(C.map(R=>l.createRangeOn(R)));l.setSelection(A)}else l.setSelection(C[0],0)})}_replaceSelectedCellsWithPasted(e,t,n,s,o){const{width:r,height:a}=t,l=uR(e,r,a),c=[...new ee(n,{startRow:s.firstRow,endRow:s.lastRow,startColumn:s.firstColumn,endColumn:s.lastColumn,includeAllSlots:!0})],u=[];let d;for(const A of c){const{row:R,column:O}=A;O===s.firstColumn&&(d=A.getPositionBefore());const U=R-s.firstRow,Q=O-s.firstColumn,se=l[U%a][Q%r],N=se?o.cloneElement(se):null,B=this._replaceTableSlotCell(A,N,d,o);!B||(Ff(B,R,O,s.lastRow,s.lastColumn,o),u.push(B),d=o.createPositionAfter(B))}const f=parseInt(n.getAttribute("headingRows")||0),b=parseInt(n.getAttribute("headingColumns")||0),_=s.firstRow<f&&f<=s.lastRow,C=s.firstColumn<b&&b<=s.lastColumn;if(_){const A={first:s.firstColumn,last:s.lastColumn},R=jr(n,f,A,o,s.firstRow);u.push(...R)}if(C){const A={first:s.firstRow,last:s.lastRow},R=Kr(n,b,A,o);u.push(...R)}return u}_replaceTableSlotCell(e,t,n,s){const{cell:o,isAnchor:r}=e;return r&&s.remove(o),t?(s.insert(t,n),t):null}}function aR(i,e){if(!i.is("documentFragment")&&!i.is("element"))return null;if(i.is("element","table"))return i;if(i.childCount==1&&i.getChild(0).is("element","table"))return i.getChild(0);const t=e.createRangeIn(i);for(const n of t.getItems())if(n.is("element","table")){const s=e.createRange(t.start,e.createPositionBefore(n));if(e.hasContent(s,{ignoreWhitespaces:!0}))return null;const o=e.createRange(e.createPositionAfter(n),t.end);return e.hasContent(o,{ignoreWhitespaces:!0})?null:n}return null}function lR(i,e,t,n){const s=i[0].findAncestor("table"),o=zn(i),r=Ht(i),a={firstColumn:o.first,lastColumn:o.last,firstRow:r.first,lastRow:r.last},l=i.length===1;return l&&(a.lastRow+=e.height-1,a.lastColumn+=e.width-1,cR(s,a.lastRow+1,a.lastColumn+1,n)),l||!zr(i,n)?dR(s,a,t):(a.lastRow=Lf(s,a),a.lastColumn=zf(s,a)),a}function cR(i,e,t,n){const s=n.getColumns(i),o=n.getRows(i);t>s&&n.insertColumns(i,{at:s,columns:t-s}),e>o&&n.insertRows(i,{at:o,rows:e-o})}function uR(i,e,t){const n=new Array(t).fill(null).map(()=>new Array(e).fill(null));for(const{column:s,row:o,cell:r}of new ee(i))n[o][s]=r;return n}function dR(i,e,t){const{firstRow:n,lastRow:s,firstColumn:o,lastColumn:r}=e,a={first:n,last:s},l={first:o,last:r};Kr(i,o,a,t),Kr(i,r+1,a,t),jr(i,n,l,t),jr(i,s+1,l,t,n)}function jr(i,e,t,n,s=0){return e<1?void 0:Of(i,e,s).filter(({column:a,cellWidth:l})=>Kf(a,l,t)).map(({cell:a})=>Nf(a,e,n))}function Kr(i,e,t,n){return e<1?void 0:Df(i,e).filter(({row:r,cellHeight:a})=>Kf(r,a,t)).map(({cell:r,column:a})=>Bf(r,a,e,n))}function Kf(i,e,t){const n=i+e-1,{first:s,last:o}=t,r=i>=s&&i<=o,a=i<s&&n>=s;return r||a}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class hR extends P{static get pluginName(){return"TableKeyboard"}static get requires(){return[hn]}init(){const t=this.editor.editing.view.document;this.editor.keystrokes.set("Tab",(...n)=>this._handleTabOnSelectedTable(...n),{priority:"low"}),this.editor.keystrokes.set("Tab",this._getTabHandler(!0),{priority:"low"}),this.editor.keystrokes.set("Shift+Tab",this._getTabHandler(!1),{priority:"low"}),this.listenTo(t,"arrowKey",(...n)=>this._onArrowKey(...n),{context:"table"})}_handleTabOnSelectedTable(e,t){const n=this.editor,o=n.model.document.selection.getSelectedElement();!o||!o.is("element","table")||(t(),n.model.change(r=>{r.setSelection(r.createRangeIn(o.getChild(0).getChild(0)))}))}_getTabHandler(e){const t=this.editor;return(n,s)=>{const o=t.model.document.selection;let r=wi(o)[0];if(r||(r=this.editor.plugins.get("TableSelection").getFocusCell()),!r)return;s();const a=r.parent,l=a.parent,c=l.getChildIndex(a),u=a.getChildIndex(r),d=u===0;if(!e&&d&&c===0){t.model.change(A=>{A.setSelection(A.createRangeOn(l))});return}const f=this.editor.plugins.get("TableUtils"),b=u===a.childCount-1,_=c===f.getRows(l)-1;if(e&&_&&b&&(t.execute("insertTableRowBelow"),c===f.getRows(l)-1)){t.model.change(A=>{A.setSelection(A.createRangeOn(l))});return}let C;if(e&&b)C=l.getChild(c+1).getChild(0);else if(!e&&d){const A=l.getChild(c-1);C=A.getChild(A.childCount-1)}else C=a.getChild(u+(e?1:-1));t.model.change(A=>{A.setSelection(A.createRangeIn(C))})}}_onArrowKey(e,t){const n=this.editor,s=t.keyCode,o=vo(s,n.locale.contentLanguageDirection);this._handleArrowKeys(o,t.shiftKey)&&(t.preventDefault(),t.stopPropagation(),e.stop())}_handleArrowKeys(e,t){const n=this.editor.model,s=n.document.selection,o=["right","down"].includes(e),r=Ln(s);if(r.length){let l;return t?l=this.editor.plugins.get("TableSelection").getFocusCell():l=o?r[r.length-1]:r[0],this._navigateFromCellInDirection(l,e,t),!0}const a=s.focus.findAncestor("tableCell");if(!a)return!1;if(!s.isCollapsed)if(t){if(s.isBackward==o&&!s.containsEntireContent(a))return!1}else{const l=s.getSelectedElement();if(!l||!n.schema.isObject(l))return!1}return this._isSelectionAtCellEdge(s,a,o)?(this._navigateFromCellInDirection(a,e,t),!0):!1}_isSelectionAtCellEdge(e,t,n){const s=this.editor.model,o=this.editor.model.schema,r=n?e.getLastPosition():e.getFirstPosition();if(!o.getLimitElement(r).is("element","tableCell"))return s.createPositionAt(t,n?"end":0).isTouching(r);const a=s.createSelection(r);return s.modifySelection(a,{direction:n?"forward":"backward"}),r.isEqual(a.focus)}_navigateFromCellInDirection(e,t,n=!1){const s=this.editor.model,o=e.findAncestor("table"),r=[...new ee(o,{includeAllSlots:!0})],{row:a,column:l}=r[r.length-1],c=r.find(({cell:O})=>O==e);let{row:u,column:d}=c;switch(t){case"left":d--;break;case"up":u--;break;case"right":d+=c.cellWidth;break;case"down":u+=c.cellHeight;break}const f=u<0||u>a,b=d<0&&u<=0,_=d>l&&u>=a;if(f||b||_){s.change(O=>{O.setSelection(O.createRangeOn(o))});return}d<0?(d=n?0:l,u--):d>l&&(d=n?l:0,u++);const C=r.find(O=>O.row==u&&O.column==d).cell,A=["right","down"].includes(t),R=this.editor.plugins.get("TableSelection");if(n&&R.isEnabled){const O=R.getAnchorCell()||e;R.setCellSelection(O,C)}else{const O=s.createPositionAt(C,A?0:"end");s.change(U=>{U.setSelection(O)})}}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class fR extends Ft{constructor(e){super(e);this.domEventType=["mousemove","mouseleave"]}onDomEvent(e){this.fire(e.type,e)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class mR extends P{static get pluginName(){return"TableMouse"}static get requires(){return[hn]}init(){this.editor.editing.view.addObserver(fR),this._enableShiftClickSelection(),this._enableMouseDragSelection()}_enableShiftClickSelection(){const e=this.editor;let t=!1;const n=e.plugins.get(hn);this.listenTo(e.editing.view.document,"mousedown",(s,o)=>{if(!this.isEnabled||!n.isEnabled||!o.domEvent.shiftKey)return;const r=n.getAnchorCell()||wi(e.model.document.selection)[0];if(!r)return;const a=this._getModelTableCellFromDomEvent(o);a&&Gf(r,a)&&(t=!0,n.setCellSelection(r,a),o.preventDefault())}),this.listenTo(e.editing.view.document,"mouseup",()=>{t=!1}),this.listenTo(e.editing.view.document,"selectionChange",s=>{t&&s.stop()},{priority:"highest"})}_enableMouseDragSelection(){const e=this.editor;let t,n,s=!1,o=!1;const r=e.plugins.get(hn);this.listenTo(e.editing.view.document,"mousedown",(a,l)=>{!this.isEnabled||!r.isEnabled||l.domEvent.shiftKey||l.domEvent.ctrlKey||l.domEvent.altKey||(t=this._getModelTableCellFromDomEvent(l))}),this.listenTo(e.editing.view.document,"mousemove",(a,l)=>{if(!l.domEvent.buttons||!t)return;const c=this._getModelTableCellFromDomEvent(l);c&&Gf(t,c)&&(n=c,!s&&n!=t&&(s=!0)),!!s&&(o=!0,r.setCellSelection(t,n),l.preventDefault())}),this.listenTo(e.editing.view.document,"mouseup",()=>{s=!1,o=!1,t=null,n=null}),this.listenTo(e.editing.view.document,"selectionChange",a=>{o&&a.stop()},{priority:"highest"})}_getModelTableCellFromDomEvent(e){const t=e.target,n=this.editor.editing.view.createPositionAt(t,0);return this.editor.editing.mapper.toModelPosition(n).parent.findAncestor("tableCell",{includeSelf:!0})}}function Gf(i,e){return i.parent.parent==e.parent.parent}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class gR extends P{static get requires(){return[QI,sR,hn,mR,hR,rR,Mn]}static get pluginName(){return"Table"}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function pR(i){const e=i.getSelectedElement();return e&&Jf(e)?e:null}function wR(i){let e=i.getFirstPosition().parent;for(;e;){if(e.is("element")&&Jf(e))return e;e=e.parent}return null}function Jf(i){return!!i.getCustomProperty("table")&&we(i)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class bR extends P{static get requires(){return[ps]}static get pluginName(){return"TableToolbar"}afterInit(){const e=this.editor,t=e.t,n=e.plugins.get(ps),s=e.config.get("table.contentToolbar"),o=e.config.get("table.tableToolbar");s&&n.register("tableContent",{ariaLabel:t("Table toolbar"),items:s,getRelatedElement:wR}),o&&n.register("table",{ariaLabel:t("Table toolbar"),items:o,getRelatedElement:pR})}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Gr={autoRefresh:!0},Qf=36e5;class Cs{constructor(e,t=Gr){if(!e)throw new p("token-missing-token-url",this);t.initValue&&this._validateTokenValue(t.initValue),this.set("value",t.initValue),typeof e=="function"?this._refresh=e:this._refresh=()=>_R(e),this._options=Object.assign({},Gr,t)}init(){return new Promise((e,t)=>{if(!this.value){this.refreshToken().then(e).catch(t);return}this._options.autoRefresh&&this._registerRefreshTokenTimeout(),e(this)})}refreshToken(){return this._refresh().then(e=>{this._validateTokenValue(e),this.set("value",e),this._options.autoRefresh&&this._registerRefreshTokenTimeout()}).then(()=>this)}destroy(){clearTimeout(this._tokenRefreshTimeout)}_validateTokenValue(e){const t=typeof e=="string",n=!/^".*"$/.test(e),s=t&&e.split(".").length===3;if(!(n&&s))throw new p("token-not-in-jwt-format",this)}_registerRefreshTokenTimeout(){const e=this._getTokenRefreshTimeoutTime();clearTimeout(this._tokenRefreshTimeout),this._tokenRefreshTimeout=setTimeout(()=>{this.refreshToken()},e)}_getTokenRefreshTimeoutTime(){try{const[,e]=this.value.split("."),{exp:t}=JSON.parse(atob(e));return t?Math.floor((t*1e3-Date.now())/2):Qf}catch{return Qf}}static create(e,t=Gr){return new Cs(e,t).init()}}F(Cs,re);function _R(i){return new Promise((e,t)=>{const n=new XMLHttpRequest;n.open("GET",i),n.addEventListener("load",()=>{const s=n.status,o=n.response;return s<200||s>299?t(new p("token-cannot-download-new-token",null)):e(o)}),n.addEventListener("error",()=>t(new Error("Network Error"))),n.addEventListener("abort",()=>t(new Error("Abort"))),n.send()})}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Jr=/^data:(\S*?);base64,/;class Yf{constructor(e,t,n){if(!e)throw new p("fileuploader-missing-file",null);if(!t)throw new p("fileuploader-missing-token",null);if(!n)throw new p("fileuploader-missing-api-address",null);this.file=yR(e)?vR(e):e,this._token=t,this._apiAddress=n}onProgress(e){return this.on("progress",(t,n)=>e(n)),this}onError(e){return this.once("error",(t,n)=>e(n)),this}abort(){this.xhr.abort()}send(){return this._prepareRequest(),this._attachXHRListeners(),this._sendRequest()}_prepareRequest(){const e=new XMLHttpRequest;e.open("POST",this._apiAddress),e.setRequestHeader("Authorization",this._token.value),e.responseType="json",this.xhr=e}_attachXHRListeners(){const e=this,t=this.xhr;t.addEventListener("error",n("Network Error")),t.addEventListener("abort",n("Abort")),t.upload&&t.upload.addEventListener("progress",s=>{s.lengthComputable&&this.fire("progress",{total:s.total,uploaded:s.loaded})}),t.addEventListener("load",()=>{const s=t.status,o=t.response;if(s<200||s>299)return this.fire("error",o.message||o.error)});function n(s){return()=>e.fire("error",s)}}_sendRequest(){const e=new FormData,t=this.xhr;return e.append("file",this.file),new Promise((n,s)=>{t.addEventListener("load",()=>{const o=t.status,r=t.response;return o<200||o>299?r.message?s(new p("fileuploader-uploading-data-failed",this,{message:r.message})):s(r.error):n(r)}),t.addEventListener("error",()=>s(new Error("Network Error"))),t.addEventListener("abort",()=>s(new Error("Abort"))),t.send(e)})}}F(Yf,oe);function vR(i,e=512){try{const t=i.match(Jr)[1],n=atob(i.replace(Jr,"")),s=[];for(let o=0;o<n.length;o+=e){const r=n.slice(o,o+e),a=new Array(r.length);for(let l=0;l<r.length;l++)a[l]=r.charCodeAt(l);s.push(new Uint8Array(a))}return new Blob(s,{type:t})}catch{throw new p("fileuploader-decoding-image-data-error",null)}}function yR(i){if(typeof i!="string")return!1;const e=i.match(Jr);return!!(e&&e.length)}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class CR{constructor(e,t){if(!e)throw new p("uploadgateway-missing-token",null);if(!t)throw new p("uploadgateway-missing-api-address",null);this._token=e,this._apiAddress=t}upload(e){return new Yf(e,this._token,this._apiAddress)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class kR extends oi{static get pluginName(){return"CloudServicesCore"}createToken(e,t){return new Cs(e,t)}createUploadGateway(e,t){return new CR(e,t)}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class TR extends oi{static get pluginName(){return"CloudServices"}static get requires(){return[kR]}init(){const t=this.context.config.get("cloudServices")||{};for(const n in t)this[n]=t[n];if(this._tokens=new Map,!this.tokenUrl){this.token=null;return}return this.token=this.context.plugins.get("CloudServicesCore").createToken(this.tokenUrl),this._tokens.set(this.tokenUrl,this.token),this.token.init()}registerTokenUrl(e){if(this._tokens.has(e))return Promise.resolve(this.getTokenFor(e));const t=this.context.plugins.get("CloudServicesCore").createToken(e);return this._tokens.set(e,t),t.init()}getTokenFor(e){const t=this._tokens.get(e);if(!t)throw new p("cloudservices-token-not-registered",this);return t}destroy(){super.destroy();for(const e of this._tokens.values())e.destroy()}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function ER(i){const e=[{name:"address",isVoid:!1},{name:"article",isVoid:!1},{name:"aside",isVoid:!1},{name:"blockquote",isVoid:!1},{name:"br",isVoid:!0},{name:"details",isVoid:!1},{name:"dialog",isVoid:!1},{name:"dd",isVoid:!1},{name:"div",isVoid:!1},{name:"dl",isVoid:!1},{name:"dt",isVoid:!1},{name:"fieldset",isVoid:!1},{name:"figcaption",isVoid:!1},{name:"figure",isVoid:!1},{name:"footer",isVoid:!1},{name:"form",isVoid:!1},{name:"h1",isVoid:!1},{name:"h2",isVoid:!1},{name:"h3",isVoid:!1},{name:"h4",isVoid:!1},{name:"h5",isVoid:!1},{name:"h6",isVoid:!1},{name:"header",isVoid:!1},{name:"hgroup",isVoid:!1},{name:"hr",isVoid:!0},{name:"input",isVoid:!0},{name:"li",isVoid:!1},{name:"main",isVoid:!1},{name:"nav",isVoid:!1},{name:"ol",isVoid:!1},{name:"p",isVoid:!1},{name:"pre",isVoid:!1},{name:"section",isVoid:!1},{name:"table",isVoid:!1},{name:"tbody",isVoid:!1},{name:"td",isVoid:!1},{name:"textarea",isVoid:!1},{name:"th",isVoid:!1},{name:"thead",isVoid:!1},{name:"tr",isVoid:!1},{name:"ul",isVoid:!1}],t=e.map(o=>o.name).join("|"),n=i.replace(new RegExp(`</?(${t})( .*?)?>`,"g"),`
$&
`).split(`
`);let s=0;return n.filter(o=>o.length).map(o=>AR(o,e)?Qr(o,s++):SR(o,e)?Qr(o,--s):Qr(o,s)).join(`
`)}function AR(i,e){return e.some(t=>!(t.isVoid||!new RegExp(`<${t.name}( .*?)?>`).test(i)))}function SR(i,e){return e.some(t=>new RegExp(`</${t.name}>`).test(i))}function Qr(i,e,t="    "){return`${t.repeat(e)}${i}`}var xR='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m12.5 0 5 4.5v15.003h-16V0h11zM3 1.5v3.25l-1.497 1-.003 8 1.5 1v3.254L7.685 18l-.001 1.504H17.5V8.002L16 9.428l-.004-4.22-4.222-3.692L3 1.5z"/><path d="M4.06 6.64a.75.75 0 0 1 .958 1.15l-.085.07L2.29 9.75l2.646 1.89c.302.216.4.62.232.951l-.058.095a.75.75 0 0 1-.951.232l-.095-.058-3.5-2.5V9.14l3.496-2.5zm4.194 6.22a.75.75 0 0 1-.958-1.149l.085-.07 2.643-1.89-2.646-1.89a.75.75 0 0 1-.232-.952l.058-.095a.75.75 0 0 1 .95-.232l.096.058 3.5 2.5v1.22l-3.496 2.5zm7.644-.836 2.122 2.122-5.825 5.809-2.125-.005.003-2.116zm2.539-1.847 1.414 1.414a.5.5 0 0 1 0 .707l-1.06 1.06-2.122-2.12 1.061-1.061a.5.5 0 0 1 .707 0z"/></svg>';/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Xf="SourceEditingMode";class PR extends P{static get pluginName(){return"SourceEditing"}static get requires(){return[es]}constructor(e){super(e);this.set("isSourceEditingMode",!1),this._elementReplacer=new D0,this._replacedRoots=new Map,this._dataFromRoots=new Map}init(){const e=this.editor,t=e.t;e.ui.componentFactory.add("sourceEditing",n=>{const s=new le(n);return s.set({label:t("Source"),icon:xR,tooltip:!0,withText:!0,class:"ck-source-editing-button"}),s.bind("isOn").to(this,"isSourceEditingMode"),s.bind("isEnabled").to(this,"isEnabled",e,"isReadOnly",e.plugins.get(es),"hasAny",(o,r,a)=>!(!o||r||a)),this.listenTo(s,"execute",()=>{this.isSourceEditingMode=!this.isSourceEditingMode}),s}),this._isAllowedToHandleSourceEditingMode()&&(this.on("change:isSourceEditingMode",(n,s,o)=>{o?(this._showSourceEditing(),this._disableCommands()):(this._hideSourceEditing(),this._enableCommands())}),this.on("change:isEnabled",(n,s,o)=>this._handleReadOnlyMode(!o)),this.listenTo(e,"change:isReadOnly",(n,s,o)=>this._handleReadOnlyMode(o))),e.data.on("get",()=>{this.isSourceEditingMode&&this._updateEditorData()},{priority:"high"})}afterInit(){const e=this.editor;["RealTimeCollaborativeEditing","CommentsEditing","TrackChangesEditing","RevisionHistory"].some(n=>e.plugins.has(n))&&console.warn("You initialized the editor with the source editing feature and at least one of the collaboration features. Please be advised that the source editing feature may not work, and be careful when editing document source that contains markers created by the collaboration features."),e.plugins.has("RestrictedEditingModeEditing")&&console.warn("You initialized the editor with the source editing feature and restricted editing feature. Please be advised that the source editing feature may not work, and be careful when editing document source that contains markers created by the restricted editing feature.")}_showSourceEditing(){const e=this.editor,t=e.editing.view,n=e.model;n.change(s=>{s.setSelection(null),s.removeSelectionAttribute(n.document.selection.getAttributeKeys())});for(const[s,o]of t.domRoots){const r=IR(e.data.get({rootName:s})),a=xo(o.ownerDocument,"textarea",{rows:"1"}),l=xo(o.ownerDocument,"div",{class:"ck-source-editing-area","data-value":r},[a]);a.value=r,a.setSelectionRange(0,0),a.addEventListener("input",()=>{l.dataset.value=a.value}),t.change(c=>{const u=t.document.getRoot(s);c.addClass("ck-hidden",u)}),this._replacedRoots.set(s,l),this._elementReplacer.replace(o,l),this._dataFromRoots.set(s,r)}this._focusSourceEditing()}_hideSourceEditing(){const t=this.editor.editing.view;this._updateEditorData(),t.change(n=>{for(const[s]of this._replacedRoots)n.removeClass("ck-hidden",t.document.getRoot(s))}),this._elementReplacer.restore(),this._replacedRoots.clear(),this._dataFromRoots.clear(),t.focus()}_updateEditorData(){const e=this.editor,t={};for(const[n,s]of this._replacedRoots){const o=this._dataFromRoots.get(n),r=s.dataset.value;o!==r&&(t[n]=r)}Object.keys(t).length&&e.data.set(t,{batchType:"default"})}_focusSourceEditing(){const[e]=this._replacedRoots.values();e.querySelector("textarea").focus()}_disableCommands(){const e=this.editor;for(const t of e.commands.commands())t.forceDisabled(Xf)}_enableCommands(){const e=this.editor;for(const t of e.commands.commands())t.clearForceDisabled(Xf)}_handleReadOnlyMode(e){if(!!this.isSourceEditingMode)for(const[,t]of this._replacedRoots)t.querySelector("textarea").readOnly=e}_isAllowedToHandleSourceEditingMode(){const t=this.editor.ui.view.editable;return t&&!t._hasExternalElement}}function IR(i){return RR(i)?ER(i):i}function RR(i){return i.startsWith("<")}var Zf={exports:{}};(function(i,e){(function(t,n){i.exports=n()})($m,function(){function t(k,v){for(var y=0;y<v.length;y++){var h=v[y];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(k,h.key,h)}}function n(k,v,y){return v&&t(k.prototype,v),y&&t(k,y),k}function s(k,v){if(!!k){if(typeof k=="string")return o(k,v);var y=Object.prototype.toString.call(k).slice(8,-1);if(y==="Object"&&k.constructor&&(y=k.constructor.name),y==="Map"||y==="Set")return Array.from(k);if(y==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(y))return o(k,v)}}function o(k,v){(v==null||v>k.length)&&(v=k.length);for(var y=0,h=new Array(v);y<v;y++)h[y]=k[y];return h}function r(k,v){var y;if(typeof Symbol=="undefined"||k[Symbol.iterator]==null){if(Array.isArray(k)||(y=s(k))||v&&k&&typeof k.length=="number"){y&&(k=y);var h=0;return function(){return h>=k.length?{done:!0}:{done:!1,value:k[h++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}return y=k[Symbol.iterator](),y.next.bind(y)}function a(k,v){return v={exports:{}},k(v,v.exports),v.exports}var l=a(function(k){function v(){return{baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}function y(h){k.exports.defaults=h}k.exports={defaults:v(),getDefaults:v,changeDefaults:y}});l.defaults,l.getDefaults,l.changeDefaults;var c=/[&<>"']/,u=/[&<>"']/g,d=/[<>"']|&(?!#?\w+;)/,f=/[<>"']|&(?!#?\w+;)/g,b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},_=function(v){return b[v]};function C(k,v){if(v){if(c.test(k))return k.replace(u,_)}else if(d.test(k))return k.replace(f,_);return k}var A=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function R(k){return k.replace(A,function(v,y){return y=y.toLowerCase(),y==="colon"?":":y.charAt(0)==="#"?y.charAt(1)==="x"?String.fromCharCode(parseInt(y.substring(2),16)):String.fromCharCode(+y.substring(1)):""})}var O=/(^|[^\[])\^/g;function U(k,v){k=k.source||k,v=v||"";var y={replace:function(m,g){return g=g.source||g,g=g.replace(O,"$1"),k=k.replace(m,g),y},getRegex:function(){return new RegExp(k,v)}};return y}var Q=/[^\w:]/g,se=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;function N(k,v,y){if(k){var h;try{h=decodeURIComponent(R(y)).replace(Q,"").toLowerCase()}catch{return null}if(h.indexOf("javascript:")===0||h.indexOf("vbscript:")===0||h.indexOf("data:")===0)return null}v&&!se.test(y)&&(y=qn(v,y));try{y=encodeURI(y).replace(/%25/g,"%")}catch{return null}return y}var B={},D=/^[^:]+:\/*[^/]*$/,X=/^([^:]+:)[\s\S]*$/,bt=/^([^:]+:\/*[^/]*)[\s\S]*$/;function qn(k,v){B[" "+k]||(D.test(k)?B[" "+k]=k+"/":B[" "+k]=sa(k,"/",!0)),k=B[" "+k];var y=k.indexOf(":")===-1;return v.substring(0,2)==="//"?y?v:k.replace(X,"$1")+v:v.charAt(0)==="/"?y?v:k.replace(bt,"$1")+v:k+v}var pm={exec:function(){}};function wm(k){for(var v=1,y,h;v<arguments.length;v++){y=arguments[v];for(h in y)Object.prototype.hasOwnProperty.call(y,h)&&(k[h]=y[h])}return k}function bm(k,v){var y=k.replace(/\|/g,function(g,w,T){for(var S=!1,M=w;--M>=0&&T[M]==="\\";)S=!S;return S?"|":" |"}),h=y.split(/ \|/),m=0;if(h.length>v)h.splice(v);else for(;h.length<v;)h.push("");for(;m<h.length;m++)h[m]=h[m].trim().replace(/\\\|/g,"|");return h}function sa(k,v,y){var h=k.length;if(h===0)return"";for(var m=0;m<h;){var g=k.charAt(h-m-1);if(g===v&&!y)m++;else if(g!==v&&y)m++;else break}return k.substr(0,h-m)}function _m(k,v){if(k.indexOf(v[1])===-1)return-1;for(var y=k.length,h=0,m=0;m<y;m++)if(k[m]==="\\")m++;else if(k[m]===v[0])h++;else if(k[m]===v[1]&&(h--,h<0))return m;return-1}function vm(k){k&&k.sanitize&&!k.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")}var ze={escape:C,unescape:R,edit:U,cleanUrl:N,resolveUrl:qn,noopTest:pm,merge:wm,splitCells:bm,rtrim:sa,findClosingBracket:_m,checkSanitizeDeprecation:vm},ym=l.defaults,Cm=ze.rtrim,bi=ze.splitCells,Ue=ze.escape,km=ze.findClosingBracket;function oa(k,v,y){var h=v.href,m=v.title?Ue(v.title):null,g=k[1].replace(/\\([\[\]])/g,"$1");return k[0].charAt(0)!=="!"?{type:"link",raw:y,href:h,title:m,text:g}:{type:"image",raw:y,href:h,title:m,text:Ue(g)}}function Tm(k,v){var y=k.match(/^(\s+)(?:```)/);if(y===null)return v;var h=y[1];return v.split(`
`).map(function(m){var g=m.match(/^\s+/);if(g===null)return m;var w=g[0];return w.length>=h.length?m.slice(h.length):m}).join(`
`)}var Ts=function(){function k(y){this.options=y||ym}var v=k.prototype;return v.space=function(h){var m=this.rules.block.newline.exec(h);if(m)return m[0].length>1?{type:"space",raw:m[0]}:{raw:`
`}},v.code=function(h,m){var g=this.rules.block.code.exec(h);if(g){var w=m[m.length-1];if(w&&w.type==="paragraph")return{raw:g[0],text:g[0].trimRight()};var T=g[0].replace(/^ {4}/gm,"");return{type:"code",raw:g[0],codeBlockStyle:"indented",text:this.options.pedantic?T:Cm(T,`
`)}}},v.fences=function(h){var m=this.rules.block.fences.exec(h);if(m){var g=m[0],w=Tm(g,m[3]||"");return{type:"code",raw:g,lang:m[2]?m[2].trim():m[2],text:w}}},v.heading=function(h){var m=this.rules.block.heading.exec(h);if(m)return{type:"heading",raw:m[0],depth:m[1].length,text:m[2]}},v.nptable=function(h){var m=this.rules.block.nptable.exec(h);if(m){var g={type:"table",header:bi(m[1].replace(/^ *| *\| *$/g,"")),align:m[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:m[3]?m[3].replace(/\n$/,"").split(`
`):[],raw:m[0]};if(g.header.length===g.align.length){var w=g.align.length,T;for(T=0;T<w;T++)/^ *-+: *$/.test(g.align[T])?g.align[T]="right":/^ *:-+: *$/.test(g.align[T])?g.align[T]="center":/^ *:-+ *$/.test(g.align[T])?g.align[T]="left":g.align[T]=null;for(w=g.cells.length,T=0;T<w;T++)g.cells[T]=bi(g.cells[T],g.header.length);return g}}},v.hr=function(h){var m=this.rules.block.hr.exec(h);if(m)return{type:"hr",raw:m[0]}},v.blockquote=function(h){var m=this.rules.block.blockquote.exec(h);if(m){var g=m[0].replace(/^ *> ?/gm,"");return{type:"blockquote",raw:m[0],text:g}}},v.list=function(h){var m=this.rules.block.list.exec(h);if(m){for(var g=m[0],w=m[2],T=w.length>1,S=w[w.length-1]===")",M={type:"list",raw:g,ordered:T,start:T?+w.slice(0,-1):"",loose:!1,items:[]},H=m[0].match(this.rules.block.item),de=!1,W,_t,ke,G,Mt,fn,Wt,vt=H.length,ge=0;ge<vt;ge++)W=H[ge],g=W,_t=W.length,W=W.replace(/^ *([*+-]|\d+[.)]) */,""),~W.indexOf(`
 `)&&(_t-=W.length,W=this.options.pedantic?W.replace(/^ {1,4}/gm,""):W.replace(new RegExp("^ {1,"+_t+"}","gm"),"")),ge!==vt-1&&(ke=this.rules.block.bullet.exec(H[ge+1])[0],(T?ke.length===1||!S&&ke[ke.length-1]===")":ke.length>1||this.options.smartLists&&ke!==w)&&(G=H.slice(ge+1).join(`
`),M.raw=M.raw.substring(0,M.raw.length-G.length),ge=vt-1)),Mt=de||/\n\n(?!\s*$)/.test(W),ge!==vt-1&&(de=W.charAt(W.length-1)===`
`,Mt||(Mt=de)),Mt&&(M.loose=!0),fn=/^\[[ xX]\] /.test(W),Wt=void 0,fn&&(Wt=W[1]!==" ",W=W.replace(/^\[[ xX]\] +/,"")),M.items.push({type:"list_item",raw:g,task:fn,checked:Wt,loose:Mt,text:W});return M}},v.html=function(h){var m=this.rules.block.html.exec(h);if(m)return{type:this.options.sanitize?"paragraph":"html",raw:m[0],pre:!this.options.sanitizer&&(m[1]==="pre"||m[1]==="script"||m[1]==="style"),text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(m[0]):Ue(m[0]):m[0]}},v.def=function(h){var m=this.rules.block.def.exec(h);if(m){m[3]&&(m[3]=m[3].substring(1,m[3].length-1));var g=m[1].toLowerCase().replace(/\s+/g," ");return{tag:g,raw:m[0],href:m[2],title:m[3]}}},v.table=function(h){var m=this.rules.block.table.exec(h);if(m){var g={type:"table",header:bi(m[1].replace(/^ *| *\| *$/g,"")),align:m[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:m[3]?m[3].replace(/\n$/,"").split(`
`):[]};if(g.header.length===g.align.length){g.raw=m[0];var w=g.align.length,T;for(T=0;T<w;T++)/^ *-+: *$/.test(g.align[T])?g.align[T]="right":/^ *:-+: *$/.test(g.align[T])?g.align[T]="center":/^ *:-+ *$/.test(g.align[T])?g.align[T]="left":g.align[T]=null;for(w=g.cells.length,T=0;T<w;T++)g.cells[T]=bi(g.cells[T].replace(/^ *\| *| *\| *$/g,""),g.header.length);return g}}},v.lheading=function(h){var m=this.rules.block.lheading.exec(h);if(m)return{type:"heading",raw:m[0],depth:m[2].charAt(0)==="="?1:2,text:m[1]}},v.paragraph=function(h){var m=this.rules.block.paragraph.exec(h);if(m)return{type:"paragraph",raw:m[0],text:m[1].charAt(m[1].length-1)===`
`?m[1].slice(0,-1):m[1]}},v.text=function(h,m){var g=this.rules.block.text.exec(h);if(g){var w=m[m.length-1];return w&&w.type==="text"?{raw:g[0],text:g[0]}:{type:"text",raw:g[0],text:g[0]}}},v.escape=function(h){var m=this.rules.inline.escape.exec(h);if(m)return{type:"escape",raw:m[0],text:Ue(m[1])}},v.tag=function(h,m,g){var w=this.rules.inline.tag.exec(h);if(w)return!m&&/^<a /i.test(w[0])?m=!0:m&&/^<\/a>/i.test(w[0])&&(m=!1),!g&&/^<(pre|code|kbd|script)(\s|>)/i.test(w[0])?g=!0:g&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(w[0])&&(g=!1),{type:this.options.sanitize?"text":"html",raw:w[0],inLink:m,inRawBlock:g,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(w[0]):Ue(w[0]):w[0]}},v.link=function(h){var m=this.rules.inline.link.exec(h);if(m){var g=km(m[2],"()");if(g>-1){var w=m[0].indexOf("!")===0?5:4,T=w+m[1].length+g;m[2]=m[2].substring(0,g),m[0]=m[0].substring(0,T).trim(),m[3]=""}var S=m[2],M="";if(this.options.pedantic){var H=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(S);H?(S=H[1],M=H[3]):M=""}else M=m[3]?m[3].slice(1,-1):"";S=S.trim().replace(/^<([\s\S]*)>$/,"$1");var de=oa(m,{href:S&&S.replace(this.rules.inline._escapes,"$1"),title:M&&M.replace(this.rules.inline._escapes,"$1")},m[0]);return de}},v.reflink=function(h,m){var g;if((g=this.rules.inline.reflink.exec(h))||(g=this.rules.inline.nolink.exec(h))){var w=(g[2]||g[1]).replace(/\s+/g," ");if(w=m[w.toLowerCase()],!w||!w.href){var T=g[0].charAt(0);return{type:"text",raw:T,text:T}}var S=oa(g,w,g[0]);return S}},v.strong=function(h,m,g){g===void 0&&(g="");var w=this.rules.inline.strong.start.exec(h);if(w&&(!w[1]||w[1]&&(g===""||this.rules.inline.punctuation.exec(g)))){m=m.slice(-1*h.length);var T=w[0]==="**"?this.rules.inline.strong.endAst:this.rules.inline.strong.endUnd;T.lastIndex=0;for(var S;(w=T.exec(m))!=null;)if(S=this.rules.inline.strong.middle.exec(m.slice(0,w.index+3)),S)return{type:"strong",raw:h.slice(0,S[0].length),text:h.slice(2,S[0].length-2)}}},v.em=function(h,m,g){g===void 0&&(g="");var w=this.rules.inline.em.start.exec(h);if(w&&(!w[1]||w[1]&&(g===""||this.rules.inline.punctuation.exec(g)))){m=m.slice(-1*h.length);var T=w[0]==="*"?this.rules.inline.em.endAst:this.rules.inline.em.endUnd;T.lastIndex=0;for(var S;(w=T.exec(m))!=null;)if(S=this.rules.inline.em.middle.exec(m.slice(0,w.index+2)),S)return{type:"em",raw:h.slice(0,S[0].length),text:h.slice(1,S[0].length-1)}}},v.codespan=function(h){var m=this.rules.inline.code.exec(h);if(m){var g=m[2].replace(/\n/g," "),w=/[^ ]/.test(g),T=g.startsWith(" ")&&g.endsWith(" ");return w&&T&&(g=g.substring(1,g.length-1)),g=Ue(g,!0),{type:"codespan",raw:m[0],text:g}}},v.br=function(h){var m=this.rules.inline.br.exec(h);if(m)return{type:"br",raw:m[0]}},v.del=function(h){var m=this.rules.inline.del.exec(h);if(m)return{type:"del",raw:m[0],text:m[1]}},v.autolink=function(h,m){var g=this.rules.inline.autolink.exec(h);if(g){var w,T;return g[2]==="@"?(w=Ue(this.options.mangle?m(g[1]):g[1]),T="mailto:"+w):(w=Ue(g[1]),T=w),{type:"link",raw:g[0],text:w,href:T,tokens:[{type:"text",raw:w,text:w}]}}},v.url=function(h,m){var g;if(g=this.rules.inline.url.exec(h)){var w,T;if(g[2]==="@")w=Ue(this.options.mangle?m(g[0]):g[0]),T="mailto:"+w;else{var S;do S=g[0],g[0]=this.rules.inline._backpedal.exec(g[0])[0];while(S!==g[0]);w=Ue(g[0]),g[1]==="www."?T="http://"+w:T=w}return{type:"link",raw:g[0],text:w,href:T,tokens:[{type:"text",raw:w,text:w}]}}},v.inlineText=function(h,m,g){var w=this.rules.inline.text.exec(h);if(w){var T;return m?T=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(w[0]):Ue(w[0]):w[0]:T=Ue(this.options.smartypants?g(w[0]):w[0]),{type:"text",raw:w[0],text:T}}},k}(),jn=ze.noopTest,Y=ze.edit,Ut=ze.merge,L={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*\n)|~{3,})([^\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?:\n+|$)|$)/,hr:/^ {0,3}((?:- *){3,}|(?:_ *){3,}|(?:\* *){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6}) +([^\n]*?)(?: +#+)? *(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3})(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:"^ {0,3}(?:<(script|pre|style)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?\\?>\\n*|<![A-Z][\\s\\S]*?>\\n*|<!\\[CDATA\\[[\\s\\S]*?\\]\\]>\\n*|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:\\n{2,}|$)|<(?!script|pre|style)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:\\n{2,}|$)|</(?!script|pre|style)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:\\n{2,}|$))",def:/^ {0,3}\[(label)\]: *\n? *<?([^\s>]+)>?(?:(?: +\n? *| *\n *)(title))? *(?:\n+|$)/,nptable:jn,table:jn,lheading:/^([^\n]+)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html)[^\n]+)*)/,text:/^[^\n]+/};L._label=/(?!\s*\])(?:\\[\[\]]|[^\[\]])+/,L._title=/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/,L.def=Y(L.def).replace("label",L._label).replace("title",L._title).getRegex(),L.bullet=/(?:[*+-]|\d{1,9}[.)])/,L.item=/^( *)(bull) ?[^\n]*(?:\n(?!\1bull ?)[^\n]*)*/,L.item=Y(L.item,"gm").replace(/bull/g,L.bullet).getRegex(),L.list=Y(L.list).replace(/bull/g,L.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+L.def.source+")").getRegex(),L._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",L._comment=/<!--(?!-?>)[\s\S]*?-->/,L.html=Y(L.html,"i").replace("comment",L._comment).replace("tag",L._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),L.paragraph=Y(L._paragraph).replace("hr",L.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|!--)").replace("tag",L._tag).getRegex(),L.blockquote=Y(L.blockquote).replace("paragraph",L.paragraph).getRegex(),L.normal=Ut({},L),L.gfm=Ut({},L.normal,{nptable:"^ *([^|\\n ].*\\|.*)\\n *([-:]+ *\\|[-| :]*)(?:\\n((?:(?!\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)",table:"^ *\\|(.+)\\n *\\|?( *[-:]+[-| :]*)(?:\\n *((?:(?!\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"}),L.gfm.nptable=Y(L.gfm.nptable).replace("hr",L.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|!--)").replace("tag",L._tag).getRegex(),L.gfm.table=Y(L.gfm.table).replace("hr",L.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|!--)").replace("tag",L._tag).getRegex(),L.pedantic=Ut({},L.normal,{html:Y(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",L._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *(?:#+ *)?(?:\n+|$)/,fences:jn,paragraph:Y(L.normal._paragraph).replace("hr",L.hr).replace("heading",` *#{1,6} *[^
]`).replace("lheading",L.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()});var V={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:jn,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(?!\s*\])((?:\\[\[\]]?|[^\[\]\\])+)\]/,nolink:/^!?\[(?!\s*\])((?:\[[^\[\]]*\]|\\[\[\]]|[^\[\]])*)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",strong:{start:/^(?:(\*\*(?=[*punctuation]))|\*\*)(?![\s])|__/,middle:/^\*\*(?:(?:(?!overlapSkip)(?:[^*]|\\\*)|overlapSkip)|\*(?:(?!overlapSkip)(?:[^*]|\\\*)|overlapSkip)*?\*)+?\*\*$|^__(?![\s])((?:(?:(?!overlapSkip)(?:[^_]|\\_)|overlapSkip)|_(?:(?!overlapSkip)(?:[^_]|\\_)|overlapSkip)*?_)+?)__$/,endAst:/[^punctuation\s]\*\*(?!\*)|[punctuation]\*\*(?!\*)(?:(?=[punctuation\s]|$))/,endUnd:/[^\s]__(?!_)(?:(?=[punctuation\s])|$)/},em:{start:/^(?:(\*(?=[punctuation]))|\*)(?![*\s])|_/,middle:/^\*(?:(?:(?!overlapSkip)(?:[^*]|\\\*)|overlapSkip)|\*(?:(?!overlapSkip)(?:[^*]|\\\*)|overlapSkip)*?\*)+?\*$|^_(?![_\s])(?:(?:(?!overlapSkip)(?:[^_]|\\_)|overlapSkip)|_(?:(?!overlapSkip)(?:[^_]|\\_)|overlapSkip)*?_)+?_$/,endAst:/[^punctuation\s]\*(?!\*)|[punctuation]\*(?!\*)(?:(?=[punctuation\s]|$))/,endUnd:/[^\s]_(?!_)(?:(?=[punctuation\s])|$)/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:jn,text:/^(`+|[^`])(?:[\s\S]*?(?:(?=[\\<!\[`*]|\b_|$)|[^ ](?= {2,}\n))|(?= {2,}\n))/,punctuation:/^([\s*punctuation])/};V._punctuation="!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~",V.punctuation=Y(V.punctuation).replace(/punctuation/g,V._punctuation).getRegex(),V._blockSkip="\\[[^\\]]*?\\]\\([^\\)]*?\\)|`[^`]*?`|<[^>]*?>",V._overlapSkip="__[^_]*?__|\\*\\*\\[^\\*\\]*?\\*\\*",V.em.start=Y(V.em.start).replace(/punctuation/g,V._punctuation).getRegex(),V.em.middle=Y(V.em.middle).replace(/punctuation/g,V._punctuation).replace(/overlapSkip/g,V._overlapSkip).getRegex(),V.em.endAst=Y(V.em.endAst,"g").replace(/punctuation/g,V._punctuation).getRegex(),V.em.endUnd=Y(V.em.endUnd,"g").replace(/punctuation/g,V._punctuation).getRegex(),V.strong.start=Y(V.strong.start).replace(/punctuation/g,V._punctuation).getRegex(),V.strong.middle=Y(V.strong.middle).replace(/punctuation/g,V._punctuation).replace(/blockSkip/g,V._blockSkip).getRegex(),V.strong.endAst=Y(V.strong.endAst,"g").replace(/punctuation/g,V._punctuation).getRegex(),V.strong.endUnd=Y(V.strong.endUnd,"g").replace(/punctuation/g,V._punctuation).getRegex(),V.blockSkip=Y(V._blockSkip,"g").getRegex(),V.overlapSkip=Y(V._overlapSkip,"g").getRegex(),V._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g,V._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,V._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,V.autolink=Y(V.autolink).replace("scheme",V._scheme).replace("email",V._email).getRegex(),V._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/,V.tag=Y(V.tag).replace("comment",L._comment).replace("attribute",V._attribute).getRegex(),V._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,V._href=/<(?:\\[<>]?|[^\s<>\\])*>|[^\s\x00-\x1f]*/,V._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/,V.link=Y(V.link).replace("label",V._label).replace("href",V._href).replace("title",V._title).getRegex(),V.reflink=Y(V.reflink).replace("label",V._label).getRegex(),V.reflinkSearch=Y(V.reflinkSearch,"g").replace("reflink",V.reflink).replace("nolink",V.nolink).getRegex(),V.normal=Ut({},V),V.pedantic=Ut({},V.normal,{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:Y(/^!?\[(label)\]\((.*?)\)/).replace("label",V._label).getRegex(),reflink:Y(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",V._label).getRegex()}),V.gfm=Ut({},V.normal,{escape:Y(V.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^~+(?=\S)([\s\S]*?\S)~+/,text:/^(`+|[^`])(?:[\s\S]*?(?:(?=[\\<!\[`*~]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@))|(?= {2,}\n|[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@))/}),V.gfm.url=Y(V.gfm.url,"i").replace("email",V.gfm._extended_email).getRegex(),V.breaks=Ut({},V.gfm,{br:Y(V.br).replace("{2,}","*").getRegex(),text:Y(V.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()});var ra={block:L,inline:V},Em=l.defaults,_i=ra.block,Kn=ra.inline;function Am(k){return k.replace(/---/g,"\u2014").replace(/--/g,"\u2013").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1\u2018").replace(/'/g,"\u2019").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1\u201C").replace(/"/g,"\u201D").replace(/\.{3}/g,"\u2026")}function aa(k){var v="",y,h,m=k.length;for(y=0;y<m;y++)h=k.charCodeAt(y),Math.random()>.5&&(h="x"+h.toString(16)),v+="&#"+h+";";return v}var vi=function(){function k(y){this.tokens=[],this.tokens.links=Object.create(null),this.options=y||Em,this.options.tokenizer=this.options.tokenizer||new Ts,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options;var h={block:_i.normal,inline:Kn.normal};this.options.pedantic?(h.block=_i.pedantic,h.inline=Kn.pedantic):this.options.gfm&&(h.block=_i.gfm,this.options.breaks?h.inline=Kn.breaks:h.inline=Kn.gfm),this.tokenizer.rules=h}k.lex=function(h,m){var g=new k(m);return g.lex(h)};var v=k.prototype;return v.lex=function(h){return h=h.replace(/\r\n|\r/g,`
`).replace(/\t/g,"    "),this.blockTokens(h,this.tokens,!0),this.inline(this.tokens),this.tokens},v.blockTokens=function(h,m,g){m===void 0&&(m=[]),g===void 0&&(g=!0),h=h.replace(/^ +$/gm,"");for(var w,T,S,M;h;){if(w=this.tokenizer.space(h)){h=h.substring(w.raw.length),w.type&&m.push(w);continue}if(w=this.tokenizer.code(h,m)){h=h.substring(w.raw.length),w.type?m.push(w):(M=m[m.length-1],M.raw+=`
`+w.raw,M.text+=`
`+w.text);continue}if(w=this.tokenizer.fences(h)){h=h.substring(w.raw.length),m.push(w);continue}if(w=this.tokenizer.heading(h)){h=h.substring(w.raw.length),m.push(w);continue}if(w=this.tokenizer.nptable(h)){h=h.substring(w.raw.length),m.push(w);continue}if(w=this.tokenizer.hr(h)){h=h.substring(w.raw.length),m.push(w);continue}if(w=this.tokenizer.blockquote(h)){h=h.substring(w.raw.length),w.tokens=this.blockTokens(w.text,[],g),m.push(w);continue}if(w=this.tokenizer.list(h)){for(h=h.substring(w.raw.length),S=w.items.length,T=0;T<S;T++)w.items[T].tokens=this.blockTokens(w.items[T].text,[],!1);m.push(w);continue}if(w=this.tokenizer.html(h)){h=h.substring(w.raw.length),m.push(w);continue}if(g&&(w=this.tokenizer.def(h))){h=h.substring(w.raw.length),this.tokens.links[w.tag]||(this.tokens.links[w.tag]={href:w.href,title:w.title});continue}if(w=this.tokenizer.table(h)){h=h.substring(w.raw.length),m.push(w);continue}if(w=this.tokenizer.lheading(h)){h=h.substring(w.raw.length),m.push(w);continue}if(g&&(w=this.tokenizer.paragraph(h))){h=h.substring(w.raw.length),m.push(w);continue}if(w=this.tokenizer.text(h,m)){h=h.substring(w.raw.length),w.type?m.push(w):(M=m[m.length-1],M.raw+=`
`+w.raw,M.text+=`
`+w.text);continue}if(h){var H="Infinite loop on byte: "+h.charCodeAt(0);if(this.options.silent){console.error(H);break}else throw new Error(H)}}return m},v.inline=function(h){var m,g,w,T,S,M,H=h.length;for(m=0;m<H;m++)switch(M=h[m],M.type){case"paragraph":case"text":case"heading":{M.tokens=[],this.inlineTokens(M.text,M.tokens);break}case"table":{for(M.tokens={header:[],cells:[]},T=M.header.length,g=0;g<T;g++)M.tokens.header[g]=[],this.inlineTokens(M.header[g],M.tokens.header[g]);for(T=M.cells.length,g=0;g<T;g++)for(S=M.cells[g],M.tokens.cells[g]=[],w=0;w<S.length;w++)M.tokens.cells[g][w]=[],this.inlineTokens(S[w],M.tokens.cells[g][w]);break}case"blockquote":{this.inline(M.tokens);break}case"list":{for(T=M.items.length,g=0;g<T;g++)this.inline(M.items[g].tokens);break}}return h},v.inlineTokens=function(h,m,g,w,T){m===void 0&&(m=[]),g===void 0&&(g=!1),w===void 0&&(w=!1),T===void 0&&(T="");var S,M=h,H;if(this.tokens.links){var de=Object.keys(this.tokens.links);if(de.length>0)for(;(H=this.tokenizer.rules.inline.reflinkSearch.exec(M))!=null;)de.includes(H[0].slice(H[0].lastIndexOf("[")+1,-1))&&(M=M.slice(0,H.index)+"["+"a".repeat(H[0].length-2)+"]"+M.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(H=this.tokenizer.rules.inline.blockSkip.exec(M))!=null;)M=M.slice(0,H.index)+"["+"a".repeat(H[0].length-2)+"]"+M.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;h;){if(S=this.tokenizer.escape(h)){h=h.substring(S.raw.length),m.push(S);continue}if(S=this.tokenizer.tag(h,g,w)){h=h.substring(S.raw.length),g=S.inLink,w=S.inRawBlock,m.push(S);continue}if(S=this.tokenizer.link(h)){h=h.substring(S.raw.length),S.type==="link"&&(S.tokens=this.inlineTokens(S.text,[],!0,w)),m.push(S);continue}if(S=this.tokenizer.reflink(h,this.tokens.links)){h=h.substring(S.raw.length),S.type==="link"&&(S.tokens=this.inlineTokens(S.text,[],!0,w)),m.push(S);continue}if(S=this.tokenizer.strong(h,M,T)){h=h.substring(S.raw.length),S.tokens=this.inlineTokens(S.text,[],g,w),m.push(S);continue}if(S=this.tokenizer.em(h,M,T)){h=h.substring(S.raw.length),S.tokens=this.inlineTokens(S.text,[],g,w),m.push(S);continue}if(S=this.tokenizer.codespan(h)){h=h.substring(S.raw.length),m.push(S);continue}if(S=this.tokenizer.br(h)){h=h.substring(S.raw.length),m.push(S);continue}if(S=this.tokenizer.del(h)){h=h.substring(S.raw.length),S.tokens=this.inlineTokens(S.text,[],g,w),m.push(S);continue}if(S=this.tokenizer.autolink(h,aa)){h=h.substring(S.raw.length),m.push(S);continue}if(!g&&(S=this.tokenizer.url(h,aa))){h=h.substring(S.raw.length),m.push(S);continue}if(S=this.tokenizer.inlineText(h,w,Am)){h=h.substring(S.raw.length),T=S.raw.slice(-1),m.push(S);continue}if(h){var W="Infinite loop on byte: "+h.charCodeAt(0);if(this.options.silent){console.error(W);break}else throw new Error(W)}}return m},n(k,null,[{key:"rules",get:function(){return{block:_i,inline:Kn}}}]),k}(),Sm=l.defaults,la=ze.cleanUrl,yi=ze.escape,Es=function(){function k(y){this.options=y||Sm}var v=k.prototype;return v.code=function(h,m,g){var w=(m||"").match(/\S*/)[0];if(this.options.highlight){var T=this.options.highlight(h,w);T!=null&&T!==h&&(g=!0,h=T)}return w?'<pre><code class="'+this.options.langPrefix+yi(w,!0)+'">'+(g?h:yi(h,!0))+`</code></pre>
`:"<pre><code>"+(g?h:yi(h,!0))+`</code></pre>
`},v.blockquote=function(h){return`<blockquote>
`+h+`</blockquote>
`},v.html=function(h){return h},v.heading=function(h,m,g,w){return this.options.headerIds?"<h"+m+' id="'+this.options.headerPrefix+w.slug(g)+'">'+h+"</h"+m+`>
`:"<h"+m+">"+h+"</h"+m+`>
`},v.hr=function(){return this.options.xhtml?`<hr/>
`:`<hr>
`},v.list=function(h,m,g){var w=m?"ol":"ul",T=m&&g!==1?' start="'+g+'"':"";return"<"+w+T+`>
`+h+"</"+w+`>
`},v.listitem=function(h){return"<li>"+h+`</li>
`},v.checkbox=function(h){return"<input "+(h?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "},v.paragraph=function(h){return"<p>"+h+`</p>
`},v.table=function(h,m){return m&&(m="<tbody>"+m+"</tbody>"),`<table>
<thead>
`+h+`</thead>
`+m+`</table>
`},v.tablerow=function(h){return`<tr>
`+h+`</tr>
`},v.tablecell=function(h,m){var g=m.header?"th":"td",w=m.align?"<"+g+' align="'+m.align+'">':"<"+g+">";return w+h+"</"+g+`>
`},v.strong=function(h){return"<strong>"+h+"</strong>"},v.em=function(h){return"<em>"+h+"</em>"},v.codespan=function(h){return"<code>"+h+"</code>"},v.br=function(){return this.options.xhtml?"<br/>":"<br>"},v.del=function(h){return"<del>"+h+"</del>"},v.link=function(h,m,g){if(h=la(this.options.sanitize,this.options.baseUrl,h),h===null)return g;var w='<a href="'+yi(h)+'"';return m&&(w+=' title="'+m+'"'),w+=">"+g+"</a>",w},v.image=function(h,m,g){if(h=la(this.options.sanitize,this.options.baseUrl,h),h===null)return g;var w='<img src="'+h+'" alt="'+g+'"';return m&&(w+=' title="'+m+'"'),w+=this.options.xhtml?"/>":">",w},v.text=function(h){return h},k}(),ca=function(){function k(){}var v=k.prototype;return v.strong=function(h){return h},v.em=function(h){return h},v.codespan=function(h){return h},v.del=function(h){return h},v.html=function(h){return h},v.text=function(h){return h},v.link=function(h,m,g){return""+g},v.image=function(h,m,g){return""+g},v.br=function(){return""},k}(),ua=function(){function k(){this.seen={}}var v=k.prototype;return v.slug=function(h){var m=h.toLowerCase().trim().replace(/<[!\/a-z].*?>/ig,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-");if(this.seen.hasOwnProperty(m)){var g=m;do this.seen[g]++,m=g+"-"+this.seen[g];while(this.seen.hasOwnProperty(m))}return this.seen[m]=0,m},k}(),xm=l.defaults,Pm=ze.unescape,Ci=function(){function k(y){this.options=y||xm,this.options.renderer=this.options.renderer||new Es,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new ca,this.slugger=new ua}k.parse=function(h,m){var g=new k(m);return g.parse(h)};var v=k.prototype;return v.parse=function(h,m){m===void 0&&(m=!0);var g="",w,T,S,M,H,de,W,_t,ke,G,Mt,fn,Wt,vt,ge,Ss,da,Gn,ha=h.length;for(w=0;w<ha;w++)switch(G=h[w],G.type){case"space":continue;case"hr":{g+=this.renderer.hr();continue}case"heading":{g+=this.renderer.heading(this.parseInline(G.tokens),G.depth,Pm(this.parseInline(G.tokens,this.textRenderer)),this.slugger);continue}case"code":{g+=this.renderer.code(G.text,G.lang,G.escaped);continue}case"table":{for(_t="",W="",M=G.header.length,T=0;T<M;T++)W+=this.renderer.tablecell(this.parseInline(G.tokens.header[T]),{header:!0,align:G.align[T]});for(_t+=this.renderer.tablerow(W),ke="",M=G.cells.length,T=0;T<M;T++){for(de=G.tokens.cells[T],W="",H=de.length,S=0;S<H;S++)W+=this.renderer.tablecell(this.parseInline(de[S]),{header:!1,align:G.align[S]});ke+=this.renderer.tablerow(W)}g+=this.renderer.table(_t,ke);continue}case"blockquote":{ke=this.parse(G.tokens),g+=this.renderer.blockquote(ke);continue}case"list":{for(Mt=G.ordered,fn=G.start,Wt=G.loose,M=G.items.length,ke="",T=0;T<M;T++)ge=G.items[T],Ss=ge.checked,da=ge.task,vt="",ge.task&&(Gn=this.renderer.checkbox(Ss),Wt?ge.tokens.length>0&&ge.tokens[0].type==="text"?(ge.tokens[0].text=Gn+" "+ge.tokens[0].text,ge.tokens[0].tokens&&ge.tokens[0].tokens.length>0&&ge.tokens[0].tokens[0].type==="text"&&(ge.tokens[0].tokens[0].text=Gn+" "+ge.tokens[0].tokens[0].text)):ge.tokens.unshift({type:"text",text:Gn}):vt+=Gn),vt+=this.parse(ge.tokens,Wt),ke+=this.renderer.listitem(vt,da,Ss);g+=this.renderer.list(ke,Mt,fn);continue}case"html":{g+=this.renderer.html(G.text);continue}case"paragraph":{g+=this.renderer.paragraph(this.parseInline(G.tokens));continue}case"text":{for(ke=G.tokens?this.parseInline(G.tokens):G.text;w+1<ha&&h[w+1].type==="text";)G=h[++w],ke+=`
`+(G.tokens?this.parseInline(G.tokens):G.text);g+=m?this.renderer.paragraph(ke):ke;continue}default:{var fa='Token with "'+G.type+'" type was not found.';if(this.options.silent){console.error(fa);return}else throw new Error(fa)}}return g},v.parseInline=function(h,m){m=m||this.renderer;var g="",w,T,S=h.length;for(w=0;w<S;w++)switch(T=h[w],T.type){case"escape":{g+=m.text(T.text);break}case"html":{g+=m.html(T.text);break}case"link":{g+=m.link(T.href,T.title,this.parseInline(T.tokens,m));break}case"image":{g+=m.image(T.href,T.title,T.text);break}case"strong":{g+=m.strong(this.parseInline(T.tokens,m));break}case"em":{g+=m.em(this.parseInline(T.tokens,m));break}case"codespan":{g+=m.codespan(T.text);break}case"br":{g+=m.br();break}case"del":{g+=m.del(this.parseInline(T.tokens,m));break}case"text":{g+=m.text(T.text);break}default:{var M='Token with "'+T.type+'" type was not found.';if(this.options.silent){console.error(M);return}else throw new Error(M)}}return g},k}(),As=ze.merge,Im=ze.checkSanitizeDeprecation,Rm=ze.escape,Mm=l.getDefaults,Vm=l.changeDefaults,Om=l.defaults;function Z(k,v,y){if(typeof k=="undefined"||k===null)throw new Error("marked(): input parameter is undefined or null");if(typeof k!="string")throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(k)+", string expected");if(typeof v=="function"&&(y=v,v=null),v=As({},Z.defaults,v||{}),Im(v),y){var h=v.highlight,m;try{m=vi.lex(k,v)}catch(S){return y(S)}var g=function(M){var H;if(!M)try{H=Ci.parse(m,v)}catch(de){M=de}return v.highlight=h,M?y(M):y(null,H)};if(!h||h.length<3||(delete v.highlight,!m.length))return g();var w=0;Z.walkTokens(m,function(S){S.type==="code"&&(w++,setTimeout(function(){h(S.text,S.lang,function(M,H){if(M)return g(M);H!=null&&H!==S.text&&(S.text=H,S.escaped=!0),w--,w===0&&g()})},0))}),w===0&&g();return}try{var T=vi.lex(k,v);return v.walkTokens&&Z.walkTokens(T,v.walkTokens),Ci.parse(T,v)}catch(S){if(S.message+=`
Please report this to https://github.com/markedjs/marked.`,v.silent)return"<p>An error occurred:</p><pre>"+Rm(S.message+"",!0)+"</pre>";throw S}}Z.options=Z.setOptions=function(k){return As(Z.defaults,k),Vm(Z.defaults),Z},Z.getDefaults=Mm,Z.defaults=Om,Z.use=function(k){var v=As({},k);if(k.renderer&&function(){var h=Z.defaults.renderer||new Es,m=function(T){var S=h[T];h[T]=function(){for(var M=arguments.length,H=new Array(M),de=0;de<M;de++)H[de]=arguments[de];var W=k.renderer[T].apply(h,H);return W===!1&&(W=S.apply(h,H)),W}};for(var g in k.renderer)m(g);v.renderer=h}(),k.tokenizer&&function(){var h=Z.defaults.tokenizer||new Ts,m=function(T){var S=h[T];h[T]=function(){for(var M=arguments.length,H=new Array(M),de=0;de<M;de++)H[de]=arguments[de];var W=k.tokenizer[T].apply(h,H);return W===!1&&(W=S.apply(h,H)),W}};for(var g in k.tokenizer)m(g);v.tokenizer=h}(),k.walkTokens){var y=Z.defaults.walkTokens;v.walkTokens=function(h){k.walkTokens(h),y&&y(h)}}Z.setOptions(v)},Z.walkTokens=function(k,v){for(var y=r(k),h;!(h=y()).done;){var m=h.value;switch(v(m),m.type){case"table":{for(var g=r(m.tokens.header),w;!(w=g()).done;){var T=w.value;Z.walkTokens(T,v)}for(var S=r(m.tokens.cells),M;!(M=S()).done;)for(var H=M.value,de=r(H),W;!(W=de()).done;){var _t=W.value;Z.walkTokens(_t,v)}break}case"list":{Z.walkTokens(m.items,v);break}default:m.tokens&&Z.walkTokens(m.tokens,v)}}},Z.Parser=Ci,Z.parser=Ci.parse,Z.Renderer=Es,Z.TextRenderer=ca,Z.Lexer=vi,Z.lexer=vi.lex,Z.Tokenizer=Ts,Z.Slugger=ua,Z.parse=Z;var Nm=Z;return Nm})})(Zf);var em=Zf.exports;/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md.
 */em.use({tokenizer:{autolink:()=>null,url:()=>null},renderer:{checkbox(...i){return Object.getPrototypeOf(this).checkbox.call(this,...i).trimRight()}}});function MR(i){return em.parse(i,{gfm:!0,breaks:!0,tables:!0,xhtml:!0,headerIds:!1})}function VR(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)t.hasOwnProperty(n)&&(i[n]=t[n])}return i}function Yr(i,e){return Array(e+1).join(i)}var OR=["address","article","aside","audio","blockquote","body","canvas","center","dd","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frameset","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","isindex","li","main","menu","nav","noframes","noscript","ol","output","p","pre","section","table","tbody","td","tfoot","th","thead","tr","ul"];function Xr(i){return OR.indexOf(i.nodeName.toLowerCase())!==-1}var tm=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"];function nm(i){return tm.indexOf(i.nodeName.toLowerCase())!==-1}var NR=tm.join();function DR(i){return i.querySelector&&i.querySelector(NR)}var Oe={};Oe.paragraph={filter:"p",replacement:function(i){return`

`+i+`

`}};Oe.lineBreak={filter:"br",replacement:function(i,e,t){return t.br+`
`}};Oe.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(i,e,t){var n=Number(e.nodeName.charAt(1));if(t.headingStyle==="setext"&&n<3){var s=Yr(n===1?"=":"-",i.length);return`

`+i+`
`+s+`

`}else return`

`+Yr("#",n)+" "+i+`

`}};Oe.blockquote={filter:"blockquote",replacement:function(i){return i=i.replace(/^\n+|\n+$/g,""),i=i.replace(/^/gm,"> "),`

`+i+`

`}};Oe.list={filter:["ul","ol"],replacement:function(i,e){var t=e.parentNode;return t.nodeName==="LI"&&t.lastElementChild===e?`
`+i:`

`+i+`

`}};Oe.listItem={filter:"li",replacement:function(i,e,t){i=i.replace(/^\n+/,"").replace(/\n+$/,`
`).replace(/\n/gm,`
    `);var n=t.bulletListMarker+"   ",s=e.parentNode;if(s.nodeName==="OL"){var o=s.getAttribute("start"),r=Array.prototype.indexOf.call(s.children,e);n=(o?Number(o)+r:r+1)+".  "}return n+i+(e.nextSibling&&!/\n$/.test(i)?`
`:"")}};Oe.indentedCodeBlock={filter:function(i,e){return e.codeBlockStyle==="indented"&&i.nodeName==="PRE"&&i.firstChild&&i.firstChild.nodeName==="CODE"},replacement:function(i,e,t){return`

    `+e.firstChild.textContent.replace(/\n/g,`
    `)+`

`}};Oe.fencedCodeBlock={filter:function(i,e){return e.codeBlockStyle==="fenced"&&i.nodeName==="PRE"&&i.firstChild&&i.firstChild.nodeName==="CODE"},replacement:function(i,e,t){for(var n=e.firstChild.className||"",s=(n.match(/language-(\S+)/)||[null,""])[1],o=e.firstChild.textContent,r=t.fence.charAt(0),a=3,l=new RegExp("^"+r+"{3,}","gm"),c;c=l.exec(o);)c[0].length>=a&&(a=c[0].length+1);var u=Yr(r,a);return`

`+u+s+`
`+o.replace(/\n$/,"")+`
`+u+`

`}};Oe.horizontalRule={filter:"hr",replacement:function(i,e,t){return`

`+t.hr+`

`}};Oe.inlineLink={filter:function(i,e){return e.linkStyle==="inlined"&&i.nodeName==="A"&&i.getAttribute("href")},replacement:function(i,e){var t=e.getAttribute("href"),n=e.title?' "'+e.title+'"':"";return"["+i+"]("+t+n+")"}};Oe.referenceLink={filter:function(i,e){return e.linkStyle==="referenced"&&i.nodeName==="A"&&i.getAttribute("href")},replacement:function(i,e,t){var n=e.getAttribute("href"),s=e.title?' "'+e.title+'"':"",o,r;switch(t.linkReferenceStyle){case"collapsed":o="["+i+"][]",r="["+i+"]: "+n+s;break;case"shortcut":o="["+i+"]",r="["+i+"]: "+n+s;break;default:var a=this.references.length+1;o="["+i+"]["+a+"]",r="["+a+"]: "+n+s}return this.references.push(r),o},references:[],append:function(i){var e="";return this.references.length&&(e=`

`+this.references.join(`
`)+`

`,this.references=[]),e}};Oe.emphasis={filter:["em","i"],replacement:function(i,e,t){return i.trim()?t.emDelimiter+i+t.emDelimiter:""}};Oe.strong={filter:["strong","b"],replacement:function(i,e,t){return i.trim()?t.strongDelimiter+i+t.strongDelimiter:""}};Oe.code={filter:function(i){var e=i.previousSibling||i.nextSibling,t=i.parentNode.nodeName==="PRE"&&!e;return i.nodeName==="CODE"&&!t},replacement:function(i){if(!i.trim())return"";var e="`",t="",n="",s=i.match(/`+/gm);if(s)for(/^`/.test(i)&&(t=" "),/`$/.test(i)&&(n=" ");s.indexOf(e)!==-1;)e=e+"`";return e+t+i+n+e}};Oe.image={filter:"img",replacement:function(i,e){var t=e.alt||"",n=e.getAttribute("src")||"",s=e.title||"",o=s?' "'+s+'"':"";return n?"!["+t+"]("+n+o+")":""}};function im(i){this.options=i,this._keep=[],this._remove=[],this.blankRule={replacement:i.blankReplacement},this.keepReplacement=i.keepReplacement,this.defaultRule={replacement:i.defaultReplacement},this.array=[];for(var e in i.rules)this.array.push(i.rules[e])}im.prototype={add:function(i,e){this.array.unshift(e)},keep:function(i){this._keep.unshift({filter:i,replacement:this.keepReplacement})},remove:function(i){this._remove.unshift({filter:i,replacement:function(){return""}})},forNode:function(i){if(i.isBlank)return this.blankRule;var e;return(e=Zr(this.array,i,this.options))||(e=Zr(this._keep,i,this.options))||(e=Zr(this._remove,i,this.options))?e:this.defaultRule},forEach:function(i){for(var e=0;e<this.array.length;e++)i(this.array[e],e)}};function Zr(i,e,t){for(var n=0;n<i.length;n++){var s=i[n];if(BR(s,e,t))return s}}function BR(i,e,t){var n=i.filter;if(typeof n=="string"){if(n===e.nodeName.toLowerCase())return!0}else if(Array.isArray(n)){if(n.indexOf(e.nodeName.toLowerCase())>-1)return!0}else if(typeof n=="function"){if(n.call(i,e,t))return!0}else throw new TypeError("`filter` needs to be a string, array, or function")}function FR(i){var e=i.element,t=i.isBlock,n=i.isVoid,s=i.isPre||function(d){return d.nodeName==="PRE"};if(!(!e.firstChild||s(e))){for(var o=null,r=!1,a=null,l=sm(a,e,s);l!==e;){if(l.nodeType===3||l.nodeType===4){var c=l.data.replace(/[ \r\n\t]+/g," ");if((!o||/ $/.test(o.data))&&!r&&c[0]===" "&&(c=c.substr(1)),!c){l=ea(l);continue}l.data=c,o=l}else if(l.nodeType===1)t(l)||l.nodeName==="BR"?(o&&(o.data=o.data.replace(/ $/,"")),o=null,r=!1):n(l)&&(o=null,r=!0);else{l=ea(l);continue}var u=sm(a,l,s);a=l,l=u}o&&(o.data=o.data.replace(/ $/,""),o.data||ea(o))}}function ea(i){var e=i.nextSibling||i.parentNode;return i.parentNode.removeChild(i),e}function sm(i,e,t){return i&&i.parentNode===e||t(e)?e.nextSibling||e.parentNode:e.firstChild||e.nextSibling||e.parentNode}var om=typeof window!="undefined"?window:{};function LR(){var i=om.DOMParser,e=!1;try{new i().parseFromString("","text/html")&&(e=!0)}catch{}return e}function zR(){var i=function(){};{var e=require("jsdom").JSDOM;i.prototype.parseFromString=function(t){return new e(t).window.document}}return i}var $R=LR()?om.DOMParser:zR();function HR(i){var e;if(typeof i=="string"){var t=UR().parseFromString('<x-turndown id="turndown-root">'+i+"</x-turndown>","text/html");e=t.getElementById("turndown-root")}else e=i.cloneNode(!0);return FR({element:e,isBlock:Xr,isVoid:nm}),e}var ta;function UR(){return ta=ta||new $R,ta}function WR(i){return i.isBlock=Xr(i),i.isCode=i.nodeName.toLowerCase()==="code"||i.parentNode.isCode,i.isBlank=qR(i),i.flankingWhitespace=jR(i),i}function qR(i){return["A","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"].indexOf(i.nodeName)===-1&&/^\s*$/i.test(i.textContent)&&!nm(i)&&!DR(i)}function jR(i){var e="",t="";if(!i.isBlock){var n=/^\s/.test(i.textContent),s=/\s$/.test(i.textContent),o=i.isBlank&&n&&s;n&&!rm("left",i)&&(e=" "),!o&&s&&!rm("right",i)&&(t=" ")}return{leading:e,trailing:t}}function rm(i,e){var t,n,s;return i==="left"?(t=e.previousSibling,n=/ $/):(t=e.nextSibling,n=/^ /),t&&(t.nodeType===3?s=n.test(t.nodeValue):t.nodeType===1&&!Xr(t)&&(s=n.test(t.textContent))),s}var KR=Array.prototype.reduce,am=/^\n*/,lm=/\n*$/,GR=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function Un(i){if(!(this instanceof Un))return new Un(i);var e={rules:Oe,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",blankReplacement:function(t,n){return n.isBlock?`

`:""},keepReplacement:function(t,n){return n.isBlock?`

`+n.outerHTML+`

`:n.outerHTML},defaultReplacement:function(t,n){return n.isBlock?`

`+t+`

`:t}};this.options=VR({},e,i),this.rules=new im(this.options)}Un.prototype={turndown:function(i){if(!XR(i))throw new TypeError(i+" is not a string, or an element/document/fragment node.");if(i==="")return"";var e=cm.call(this,new HR(i));return JR.call(this,e)},use:function(i){if(Array.isArray(i))for(var e=0;e<i.length;e++)this.use(i[e]);else if(typeof i=="function")i(this);else throw new TypeError("plugin must be a Function or an Array of Functions");return this},addRule:function(i,e){return this.rules.add(i,e),this},keep:function(i){return this.rules.keep(i),this},remove:function(i){return this.rules.remove(i),this},escape:function(i){return GR.reduce(function(e,t){return e.replace(t[0],t[1])},i)}};function cm(i){var e=this;return KR.call(i.childNodes,function(t,n){n=new WR(n);var s="";return n.nodeType===3?s=n.isCode?n.nodeValue:e.escape(n.nodeValue):n.nodeType===1&&(s=QR.call(e,n)),um(t,s)},"")}function JR(i){var e=this;return this.rules.forEach(function(t){typeof t.append=="function"&&(i=um(i,t.append(e.options)))}),i.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function QR(i){var e=this.rules.forNode(i),t=cm.call(this,i),n=i.flankingWhitespace;return(n.leading||n.trailing)&&(t=t.trim()),n.leading+e.replacement(t,i,this.options)+n.trailing}function YR(i,e){var t=[i.match(lm)[0],e.match(am)[0]].sort(),n=t[t.length-1];return n.length<2?n:`

`}function um(i,e){var t=YR(i,e);return i=i.replace(lm,""),e=e.replace(am,""),i+t+e}function XR(i){return i!=null&&(typeof i=="string"||i.nodeType&&(i.nodeType===1||i.nodeType===9||i.nodeType===11))}var dm=/highlight-(?:text|source)-([a-z0-9]+)/;function ZR(i){i.addRule("highlightedCodeBlock",{filter:function(e){var t=e.firstChild;return e.nodeName==="DIV"&&dm.test(e.className)&&t&&t.nodeName==="PRE"},replacement:function(e,t,n){var s=t.className||"",o=(s.match(dm)||[null,""])[1];return`

`+n.fence+o+`
`+t.firstChild.textContent+`
`+n.fence+`

`}})}function e5(i){i.addRule("strikethrough",{filter:["del","s","strike"],replacement:function(e){return"~"+e+"~"}})}var t5=Array.prototype.indexOf,n5=Array.prototype.every,Wn={};Wn.tableCell={filter:["th","td"],replacement:function(i,e){return hm(i,e)}};Wn.tableRow={filter:"tr",replacement:function(i,e){var t="",n={left:":--",right:"--:",center:":-:"};if(na(e))for(var s=0;s<e.childNodes.length;s++){var o="---",r=(e.childNodes[s].getAttribute("align")||"").toLowerCase();r&&(o=n[r]||o),t+=hm(o,e.childNodes[s])}return`
`+i+(t?`
`+t:"")}};Wn.table={filter:function(i){return i.nodeName==="TABLE"&&na(i.rows[0])},replacement:function(i){return i=i.replace(`

`,`
`),`

`+i+`

`}};Wn.tableSection={filter:["thead","tbody","tfoot"],replacement:function(i){return i}};function na(i){var e=i.parentNode;return e.nodeName==="THEAD"||e.firstChild===i&&(e.nodeName==="TABLE"||i5(e))&&n5.call(i.childNodes,function(t){return t.nodeName==="TH"})}function i5(i){var e=i.previousSibling;return i.nodeName==="TBODY"&&(!e||e.nodeName==="THEAD"&&/^\s*$/i.test(e.textContent))}function hm(i,e){var t=t5.call(e.parentNode.childNodes,e),n=" ";return t===0&&(n="| "),n+i+" |"}function s5(i){i.keep(function(t){return t.nodeName==="TABLE"&&!na(t.rows[0])});for(var e in Wn)i.addRule(e,Wn[e])}function o5(i){i.addRule("taskListItems",{filter:function(e){return e.type==="checkbox"&&e.parentNode.nodeName==="LI"},replacement:function(e,t){return(t.checked?"[x]":"[ ]")+" "}})}function r5(i){i.use([ZR,e5,s5,o5])}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md.
 */const a5=Un.prototype.escape;function fm(i){return i=a5(i),i=i.replace(/</g,"\\<"),i}Un.prototype.escape=function(i){let e="",t=0;for(const n of d5(i)){const s=n.index;s>t&&(e+=fm(i.substring(t,s)));const o=n[0];e+=o,t=s+o.length}return t<i.length&&(e+=fm(i.substring(t,i.length))),e};const ia=new Un({codeBlockStyle:"fenced",hr:"---",headingStyle:"atx"});ia.use([r5,c5]);function l5(i){return ia.turndown(i)}function c5(i){i.addRule("taskListItems",{filter(e){return e.type==="checkbox"&&(e.parentNode.nodeName==="LI"||e.parentNode.parentNode.nodeName==="LI")},replacement(e,t){return(t.checked?"[x]":"[ ]")+" "}})}const u5=new RegExp(/\b(?:(?:https?|ftp):\/\/|www\.)/.source+/(?![-_])(?:[-_a-z0-9\u00a1-\uffff]{1,63}\.)+(?:[a-z\u00a1-\uffff]{2,63})/.source+/(?:[^\s<>]*)/.source,"gi");function*d5(i){for(const e of i.matchAll(u5)){const t=e[0],n=h5(t);yield Object.assign([t.substring(0,n)],{index:e.index})}}function h5(i){let e=i.length;for(;e>0;){const t=i[e-1];if(`?!.,:*_~'"`.includes(t))e--;else if(t==")"){let n=0;for(let s=0;s<e;s++)i[s]=="("?n++:i[s]==")"&&n--;if(n<0)e--;else break}else break}return e}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class f5{constructor(e){this._htmlDP=new pu(e)}keepHtml(e){ia.keep([e])}toView(e){const t=MR(e);return this._htmlDP.toView(t)}toData(e){const t=this._htmlDP.toData(e);return l5(t)}registerRawContentMatcher(e){this._htmlDP.registerRawContentMatcher(e)}useFillerType(){}}/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class m5 extends P{constructor(e){super(e);e.data.processor=new f5(e.data.viewDocument)}static get pluginName(){return"Markdown"}}var g5='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6.91 10.54c.26-.23.64-.21.88.03l3.36 3.14 2.23-2.06a.64.64 0 0 1 .87 0l2.52 2.97V4.5H3.2v10.12l3.71-4.08zm10.27-7.51c.6 0 1.09.47 1.09 1.05v11.84c0 .59-.49 1.06-1.09 1.06H2.79c-.6 0-1.09-.47-1.09-1.06V4.08c0-.58.49-1.05 1.1-1.05h14.38zm-5.22 5.56a1.96 1.96 0 1 1 3.4-1.96 1.96 1.96 0 0 1-3.4 1.96z"/></svg>';const ks="imgPlugin",p5="\u56FE\u7247",mm="image";class w5 extends P{init(){this.createToolbarButton()}createToolbarButton(){const e=this.editor;console.log(Array.from(e.ui.componentFactory.names()));const t=e.commands.get(ks);Ti.editorObj=e,window.dd=e.model,e.ui.componentFactory.add(ks,n=>{const s=new le(n);return s.set({label:p5,tooltip:!0,icon:g5,class:"toolbar_button_img_extend"}),s.bind("isOn","isEnabled").to(t,"value","isEnabled"),this.listenTo(s,"execute",()=>{console.log("======execute image view click"),Ti.dialogObj.openDialog(5)}),s})}}class b5 extends q{constructor(e){super(e);this.attributeKey=mm}refresh(){const e=this.editor.model,t=e.document.selection;this.isEnabled=e.schema.checkAttributeInSelection(t,this.attributeKey)}}class _5 extends P{static get requires(){return[Mn]}static get pluginName(){return"ImgEditing"}init(){const e=this.editor;this.defineSchema(),e.commands.add(ks,new b5(e))}defineSchema(){this.editor.model.schema.extend("$text",{allowAttributes:mm})}}class gm extends P{static get requires(){return[_5,w5]}static get pluginName(){return ks}}function v5(i,e={}){console.log(i),!(!e||!e.src)&&i.change(t=>{const n=t.createElement("imageInline",e),s=Rn(i.document.selection,i);i.insertContent(n,s)})}const y5={name:"ckeditorAttachDialog",props:{fileType:String,isClient:{type:Boolean,default:!1}},setup(i,e){let t="fastcms/api/admin/attachment/upload";i.isClient&&i.isClient==!0&&(t="fastcms/api/client/attachment/upload");const n=wa({isShowDialog:!1,queryParams:{},showSearch:!0,max:1,limit:3,uploadUrl:t,headers:{Authorization:Ym.get("token")},checkedObjs:[],tableData:{data:[],total:99,loading:!1,param:{pageNum:1,pageSize:10}}}),s=_=>{n.isShowDialog=!0,n.max=_},o=()=>{n.isShowDialog=!1,n.max=1},r=()=>{i.isClient&&i.isClient==!0?Qm(n.tableData.param).then(_=>{n.tableData.data=_.data.records,n.tableData.total=_.data.total}):Jm(n.tableData.param).then(_=>{n.tableData.data=_.data.records,n.tableData.total=_.data.total})},a=()=>{r()},l=()=>{_a.error("\u4E0A\u4F20\u6587\u4EF6\u6570\u91CF\u4E0D\u80FD\u8D85\u8FC7 "+n.limit+" \u4E2A!")},c=()=>{_a.error("\u4E0A\u4F20\u5931\u8D25")};return ba(()=>{r()}),$({openDialog:s,closeDialog:o,initTableData:r,onTableItemClick:_=>{console.log(_)},onHandleSizeChange:_=>{n.tableData.param.pageSize=_,r()},onHandleCurrentChange:_=>{n.tableData.param.pageNum=_,r()},onHandleExceed:l,onHandleUploadError:c,uploadSuccess:a,onSubmit:()=>{let _=[];n.checkedObjs.forEach(C=>_.push({src:C.path})),_.forEach(C=>v5(Ti.editorObj.model,C)),o()},confirm},Hm(n))}},C5=Ps("\u4E0A\u4F20\u9644\u4EF6"),k5={key:0},T5=["src"],E5={style:{padding:"14px"}},A5={class:"dialog-footer"},S5=Ps("\u53D6 \u6D88"),x5=Ps("\u786E \u5B9A");function P5(i,e,t,n,s,o){const r=Xe("el-button"),a=Xe("el-upload"),l=Xe("el-checkbox"),c=Xe("el-card"),u=Xe("el-col"),d=Xe("el-checkbox-group"),f=Xe("el-row"),b=Xe("el-empty"),_=Xe("el-pagination"),C=Xe("el-dialog");return qt(),ki(C,{title:"\u9009\u62E9\u9644\u4EF6",fullscreen:"",modelValue:i.isShowDialog,"onUpdate:modelValue":e[1]||(e[1]=A=>i.isShowDialog=A)},{footer:We(()=>[Vt("span",A5,[ot(r,{onClick:n.closeDialog,size:"small"},{default:We(()=>[S5]),_:1},8,["onClick"]),ot(r,{type:"primary",onClick:n.onSubmit,size:"small"},{default:We(()=>[x5]),_:1},8,["onClick"])])]),default:We(()=>[Vt("div",null,[ot(a,{class:"upload-btn",action:i.uploadUrl,name:"files",multiple:"",headers:i.headers,"show-file-list":!1,"on-success":n.uploadSuccess,"on-exceed":n.onHandleExceed,"on-error":n.onHandleUploadError,limit:i.limit},{default:We(()=>[ot(r,{size:"small",type:"primary"},{default:We(()=>[C5]),_:1})]),_:1},8,["action","headers","on-success","on-exceed","on-error","limit"]),ot(c,{shadow:"hover"},{default:We(()=>[i.tableData.data.length>0?(qt(),xs("div",k5,[ot(f,{gutter:15},{default:We(()=>[ot(d,{max:i.max,modelValue:i.checkedObjs,"onUpdate:modelValue":e[0]||(e[0]=A=>i.checkedObjs=A)},{default:We(()=>[(qt(!0),xs(Um,null,Wm(i.tableData.data,(A,R)=>(qt(),ki(u,{xs:24,sm:12,md:8,lg:6,xl:4,class:"mb15",key:R,onClick:O=>n.onTableItemClick(A)},{default:We(()=>[ot(c,{"body-style":{padding:"0px"}},{default:We(()=>[Vt("img",{src:A.path,class:"image"},null,8,T5),Vt("div",E5,[ot(l,{label:A},{default:We(()=>[Vt("span",null,qm(A.fileName),1)]),_:2},1032,["label"])])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1},8,["max","modelValue"])]),_:1})])):(qt(),ki(b,{key:1,description:"\u6682\u65E0\u6570\u636E"})),i.tableData.data.length>0?(qt(),ki(_,{key:2,style:{"text-align":"right"},background:"",onSizeChange:n.onHandleSizeChange,onCurrentChange:n.onHandleCurrentChange,"page-sizes":[10,20,30],"current-page":i.tableData.param.pageNum,"page-size":i.tableData.param.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:i.tableData.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])):jm("",!0)]),_:1})])]),_:1},8,["modelValue"])}var I5=ya(y5,[["render",P5],["__scopeId","data-v-751509a3"]]);const R5=Km({props:{isClient:{type:Boolean,default:!1},modelValue:{type:String}},components:{imgResWin:I5},setup(i,{emit:e}){let t=va(),n=va(),s=null,o=!1;const r=wa({isClient:i.isClient||!1});return ba(()=>{Ti.dialogObj=t.value;const a=n.value;pd.create(a.querySelector(".CKEditorContent"),{language:{ui:"zh-cn"},plugins:[PR,GE,tA,sA,lA,fA,wA,yA,AA,TR,PA,DA,rS,dS,kS,TS,US,GS,xr,Hh,YS,Ax,Gx,lP,pi,UP,gR,bR,DE,m5,gm],toolbar:["sourceEditing","|","heading","|","bold","italic","link","bulletedList","numberedList","|","outdent","indent","|",gm.pluginName,"blockQuote","insertTable","mediaEmbed","undo","redo"],image:{styles:["alignLeft","alignCenter","alignRight"],resizeOptions:[{name:"imageResize:original",label:"Original",value:null},{name:"imageResize:25",label:"25%",value:"25"},{name:"imageResize:50",label:"50%",value:"50"},{name:"imageResize:75",label:"75%",value:"75"}],toolbar:["imageStyle:inline","imageStyle:block","imageStyle:side","|","imageStyle:alignLeft","imageStyle:alignCenter","imageStyle:alignRight","|","imageResize","imageTextAlternative","toggleImageCaption"]},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]}}).then(l=>{const c=a.querySelector(".CKEditorToolbar");c&&(c.innerHTML=""),setTimeout(()=>c.appendChild(l.ui.view.toolbar.element),0),s=l,l.setData(i.modelValue),l.model.document.on("change",function(){o=!0,e("update:modelValue",l.getData())})}).catch(l=>{console.log(l)})}),Gm(()=>i.modelValue,a=>{if(o)return o=!1;s&&s.setData(a)}),{ckeditorDom:n,attachDialog:t,state:r}}}),M5={class:"CKEditor",ref:"ckeditorDom"},V5=Vt("div",{class:"CKEditorBox"},[Vt("div",{class:"CKEditorToolbar"}),Vt("div",{class:"CKEditorContent"})],-1);function O5(i,e,t,n,s,o){const r=Xe("imgResWin");return qt(),xs("div",M5,[V5,ot(r,{ref:"attachDialog",isClient:i.isClient},null,8,["isClient"])],512)}var z5=ya(R5,[["render",O5]]);export{z5 as C};
