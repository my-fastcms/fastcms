var v=Object.defineProperty;var w=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var y=(t,o,e)=>o in t?v(t,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[o]=e,S=(t,o)=>{for(var e in o||(o={}))E.call(o,e)&&y(t,e,o[e]);if(w)for(var e of w(o))P.call(o,e)&&y(t,e,o[e]);return t};import{a as B,b as L}from"./index.cfc32270.js";import{_ as R,H as x}from"./index.b48d3751.js";import{l as N}from"./index.34a00848.js";import{r as A,j as F,a8 as V,o as $,t as j,l as c,m as K,z as s,A as r,b as C,n as I,D as z,p as k,G as M,x as T}from"./vendor.07d41a1e.js";const U={name:"pagesTree",setup(){const{proxy:t}=M(),o=A();A();const e=F({row:null,isShowDialog:!1,treeCheckAll:!1,treeLoading:!1,defaultCheckedKeys:[],treeData:[],tableData:[],treeDefaultProps:{children:"children",label:"label"},treeSelArr:[],treeLength:0}),u=l=>{e.isShowDialog=!0,e.row=l},i=()=>{e.isShowDialog=!1},D=()=>{i()},_=l=>{let a=0;l.map(n=>{n.children&&(a+=n.children.length)}),e.treeLength=a+l.length},h=()=>{e.treeCheckAll?t.$refs.treeTable.setCheckedNodes(e.treeData):t.$refs.treeTable.setCheckedKeys([])},d=()=>{e.treeSelArr=[],e.treeSelArr=t.$refs.treeTable.getCheckedNodes(!1,!0),e.treeSelArr.length==e.treeLength?e.treeCheckAll=!0:e.treeCheckAll=!1},m=()=>{if(t.$refs.treeTable.getCheckedNodes(!1,!0).length<=0){C.warning("\u8BF7\u9009\u62E9\u5143\u7D20");return}else console.log(t.$refs.treeTable.getCheckedNodes(!1,!0))},f=()=>{e.row&&e.row.id&&(e.defaultCheckedKeys=[],B(e.row.id).then(l=>{e.treeData=l.data.permissions,g(e.treeData),_(e.treeData),e.tableData=l.data.roleResources,d(),p()}))},p=()=>{I(()=>{console.log(">>>data len:"+e.tableData.length),e.tableData.forEach(l=>{l.roleId!=null&&t.$refs.resourceTableRef.toggleRowSelection(l,!0)})})},b=l=>{o.value=l};V(()=>{console.log("===>onUpdated"),f()}),$(()=>{console.log("===>onMounted")});const g=l=>{l.forEach(a=>{a.label=x.global.t(a.label),a.checked&&a.children==null&&e.defaultCheckedKeys.push(a.id),a.children&&a.children.length>0&&g(a.children)})};return S({openDialog:u,closeDialog:i,onCancel:D,onSubmit:()=>{const l=new Array;e.treeSelArr.forEach(n=>{l.push(n.id)});const a=new Array;o.value&&o.value.length&&o.value.length>0&&o.value.forEach(n=>{a.push(n.resourcePath)}),L(e.row.id,N.stringify({permissionIdList:l,resourcePathList:a},{arrayFormat:"repeat"})).then(()=>{C.success("\u4FDD\u5B58\u6210\u529F"),i()}).catch(n=>{C.error(n.message)})},getTreeData:f,onCheckAllChange:h,onCheckTree:d,onSelect:m,handleSelectionChange:b},j(e))}},G={class:"system-menu-container"},H=k("span",null,"\u83DC\u5355\u6743\u9650",-1),q=k("span",null,"\u63A5\u53E3\u6743\u9650",-1),J={class:"dialog-footer"},O=T("\u53D6 \u6D88"),Q=T("\u4FDD \u5B58");function W(t,o,e,u,i,D){const _=c("el-tree"),h=c("el-col"),d=c("el-table-column"),m=c("el-table"),f=c("el-row"),p=c("el-button"),b=c("el-dialog");return z(),K("div",G,[s(b,{title:"\u6743\u9650\u8BBE\u7F6E",fullscreen:"",modelValue:t.isShowDialog,"onUpdate:modelValue":o[0]||(o[0]=g=>t.isShowDialog=g),width:"769px"},{footer:r(()=>[k("span",J,[s(p,{onClick:u.onCancel,size:"small"},{default:r(()=>[O]),_:1},8,["onClick"]),s(p,{type:"primary",onClick:u.onSubmit,size:"small"},{default:r(()=>[Q]),_:1},8,["onClick"])])]),default:r(()=>[s(f,null,{default:r(()=>[s(h,{span:6},{default:r(()=>[H,s(_,{data:t.treeData,"show-checkbox":"","node-key":"id","default-expand-all":!0,ref:"treeTable",props:t.treeDefaultProps,"default-checked-keys":t.defaultCheckedKeys,onCheck:u.onCheckTree},null,8,["data","props","default-checked-keys","onCheck"])]),_:1}),s(h,{span:8},{default:r(()=>[q,s(m,{ref:"resourceTableRef",data:t.tableData,style:{width:"100%"},onSelectionChange:u.handleSelectionChange},{default:r(()=>[s(d,{type:"selection",width:"55"}),s(d,{property:"resourceName",label:"\u63A5\u53E3\u540D\u79F0",width:"120"}),s(d,{property:"resourcePath",label:"\u6743\u9650\u6807\u8BC6","show-overflow-tooltip":""})]),_:1},8,["data","onSelectionChange"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var le=R(U,[["render",W]]);export{le as default};
