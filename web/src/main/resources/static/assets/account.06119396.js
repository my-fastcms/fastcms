var $=Object.defineProperty;var I=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var k=(e,s,t)=>s in e?$(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,S=(e,s)=>{for(var t in s||(s={}))v.call(s,t)&&k(e,t,s[t]);if(I)for(var t of I(s))V.call(s,t)&&k(e,t,s[t]);return e};import{i as q,H as P,M as T,a0 as j,j as D,J as E,o as U,t as A,l as c,Q as K,A as n,b as B,D as M,z as a,p as f,q as N,y as z,G as J}from"./vendor.63450691.js";import{_ as L,u as O,f as x,S as g,c as b,d as G}from"./index.55a8aeee.js";import{g as H,s as Q}from"./index.9a22769d.js";import{l as W}from"./index.1d1037f0.js";const X=q({name:"login",setup(){const{t:e}=P(),{proxy:s}=J(),t=O(),d=T(),h=j(),r=D({isShowPassword:!1,captcha:"",captchaKey:"",myForm:{username:"",password:"",code:""},rules:{username:{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"},password:{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"blur"},code:{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",trigger:"blur"}},loading:{signIn:!1}}),i=E(()=>x(new Date)),l=async()=>{H().then(o=>{r.captcha=o.data.image,r.captchaKey=o.data.codeUuid,g.set("ClientId",r.captchaKey)}).catch(()=>{})};U(()=>{l()});const p=async()=>{new Promise(o=>{s.$refs.myRefForm.validate(u=>{u&&(o(u),y())})})},y=async()=>{Q(W.stringify(r.myForm)).then(o=>{w(o)}).catch(o=>{l(),B({showClose:!0,message:o.message?o.message:"\u7CFB\u7EDF\u9519\u8BEF",type:"error"})})},w=async o=>{r.loading.signIn=!0;const u={username:o.data.username,photo:o.data.headImg===null?"/header.jpg":o.data.headImg,time:new Date().getTime(),hasRole:o.data.hasRole};g.set("token",o.data.token),g.set("tokenTtl",o.data.tokenTtl),g.set("userInfo",u),t.dispatch("userInfos/setUserInfos",u),t.state.themeConfig.themeConfig.isRequestRoutes?o.data.hasRole===!0?(await G(),m()):(await b(),m()):(await b(),m())},m=()=>{var u,C,_,F;let o=i.value;((u=d.query)==null?void 0:u.redirect)?h.push({path:(C=d.query)==null?void 0:C.redirect,query:Object.keys((_=d.query)==null?void 0:_.params).length>0?JSON.parse((F=d.query)==null?void 0:F.params):""}):h.push("/"),setTimeout(()=>{r.loading.signIn=!0;const R=e("message.signInText");B.success(`${o}\uFF0C${R}`),s.mittBus.emit("onSignInClick")},300)};return S({currentTime:i,onSignIn:p,refreshCode:l},A(r))}}),Y={class:"login-content-code"},Z=["src"];function ee(e,s,t,d,h,r){const i=c("el-input"),l=c("el-form-item"),p=c("el-col"),y=c("el-row"),w=c("el-button"),m=c("el-form");return M(),K(m,{class:"login-content-form",model:e.myForm,rules:e.rules,ref:"myRefForm"},{default:n(()=>[a(l,{prop:"username"},{default:n(()=>[a(i,{type:"text",placeholder:e.$t("message.account.accountPlaceholder1"),"prefix-icon":"el-icon-user",modelValue:e.myForm.username,"onUpdate:modelValue":s[0]||(s[0]=o=>e.myForm.username=o),clearable:"",autocomplete:"off"},null,8,["placeholder","modelValue"])]),_:1}),a(l,{prop:"password"},{default:n(()=>[a(i,{type:e.isShowPassword?"text":"password",placeholder:e.$t("message.account.accountPlaceholder2"),"prefix-icon":"el-icon-lock",modelValue:e.myForm.password,"onUpdate:modelValue":s[2]||(s[2]=o=>e.myForm.password=o),autocomplete:"off"},{suffix:n(()=>[f("i",{class:N(["iconfont el-input__icon login-content-password",e.isShowPassword?"icon-yincangmima":"icon-xianshimima"]),onClick:s[1]||(s[1]=o=>e.isShowPassword=!e.isShowPassword)},null,2)]),_:1},8,["type","placeholder","modelValue"])]),_:1}),a(l,{prop:"code"},{default:n(()=>[a(y,{gutter:15},{default:n(()=>[a(p,{span:14},{default:n(()=>[a(i,{type:"text",maxlength:"5",placeholder:e.$t("message.account.accountPlaceholder3"),"prefix-icon":"el-icon-position",modelValue:e.myForm.code,"onUpdate:modelValue":s[3]||(s[3]=o=>e.myForm.code=o),clearable:"",autocomplete:"off"},null,8,["placeholder","modelValue"])]),_:1}),a(p,{span:10},{default:n(()=>[f("div",Y,[f("img",{class:"login-content-code-img",alt:"fastcms",onClick:s[4]||(s[4]=(...o)=>e.refreshCode&&e.refreshCode(...o)),src:e.captcha},null,8,Z)])]),_:1})]),_:1})]),_:1}),a(l,null,{default:n(()=>[a(w,{type:"primary",class:"login-content-submit",round:"",onClick:e.onSignIn,loading:e.loading.signIn},{default:n(()=>[f("span",null,z(e.$t("message.account.accountBtnText")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules"])}var re=L(X,[["render",ee],["__scopeId","data-v-9b1dc8f8"]]);export{re as default};
