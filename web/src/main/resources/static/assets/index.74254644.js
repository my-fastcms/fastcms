var z=Object.defineProperty;var w=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var F=(e,o,n)=>o in e?z(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,E=(e,o)=>{for(var n in o||(o={}))S.call(o,n)&&F(e,n,o[n]);if(w)for(var n of w(o))U.call(o,n)&&F(e,n,o[n]);return e};import{s as b,_ as B,L as R,S as k}from"./index.3376ac2d.js";import{r as x,j as I,o as y,t as H,l as u,m as N,z as t,A as s,E as V,b as c,D as j,p as v,x as D}from"./vendor.3e632ab1.js";function M(e){return b({url:"/admin/plugin/list",method:"get",params:e})}function T(e){return b({url:"/admin/plugin/unInstall/"+e,method:"post"})}function A(e){return b({url:"/admin/plugin/config/url/"+e,method:"get"})}const O={name:"pluginManager",setup(){const e=x(null),o=I({dialogVisible:!1,pluginConfigUrl:"",limit:1,uploadUrl:"fastcms/api/admin/plugin/install",headers:{Authorization:R.get("token")},tableData:{data:[],total:0,loading:!1,param:{pageNum:1,pageSize:10}}}),n=()=>{M(o.tableData.param).then(a=>{o.tableData.data=a.data.records,o.tableData.total=a.data.total}).catch(()=>{})},l=a=>{V.confirm("\u6B64\u64CD\u4F5C\u5C06\u5378\u8F7D\u63D2\u4EF6, \u662F\u5426\u7EE7\u7EED?","\u63D0\u793A",{confirmButtonText:"\u5378\u8F7D",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{T(a.pluginId).then(()=>{c.success("\u5378\u8F7D\u6210\u529F"),n()}).catch(i=>{c.error(i.message)})}).catch(()=>{})};let p=null;const _=a=>{p=a,o.dialogVisible=!0},d=()=>{!p||A(p.pluginId).then(a=>{o.pluginConfigUrl=a.data+"?accessToken="+k.get("token");const i=e.value;i&&i.tagName.toUpperCase()==="IFRAME"}).catch(a=>{console.log(a),c.error("\u63D2\u4EF6\u4E0D\u652F\u6301\u914D\u7F6E")})},g=()=>{o.dialogVisible=!1},r=a=>{o.tableData.param.pageSize=a,n()},f=a=>{o.tableData.param.pageNum=a,n()},m=a=>{a.code==200?(c.success("\u5B89\u88C5\u6210\u529F"),n()):c.error(a.message)},h=a=>{c.error("\u5B89\u88C5\u5931\u8D25,"+a)},C=()=>{};return y(()=>{n()}),E({handleClose:g,beforeOnRowConfig:_,onRowConfig:d,onRowUnInstall:l,onHandleSizeChange:r,onHandleCurrentChange:f,initTableData:n,uploadSuccess:m,onHandleUploadError:h,onHandleExceed:C,iframeRef:e},H(o))}},L={class:"mb15"},P=D("\u5B89\u88C5\u63D2\u4EF6"),q=D("\u914D\u7F6E"),G=D("\u5378\u8F7D"),J=["src"];function K(e,o,n,l,p,_){const d=u("el-button"),g=u("el-upload"),r=u("el-table-column"),f=u("el-table"),m=u("el-pagination"),h=u("el-card"),C=u("el-dialog");return j(),N("div",null,[t(h,{shadow:"hover"},{default:s(()=>[v("div",L,[t(g,{action:e.uploadUrl,name:"file",headers:e.headers,"show-file-list":!1,"on-success":l.uploadSuccess,"on-error":l.onHandleUploadError,"on-exceed":l.onHandleExceed,accept:".jar,.zip"},{default:s(()=>[t(d,{class:"mt15",size:"small",type:"primary",icon:"iconfont icon-shuxingtu"},{default:s(()=>[P]),_:1})]),_:1},8,["action","headers","on-success","on-error","on-exceed"])]),t(f,{data:e.tableData.data,stripe:"",style:{width:"100%"}},{default:s(()=>[t(r,{prop:"pluginId",label:"ID","show-overflow-tooltip":""}),t(r,{prop:"pluginClass",label:"\u63D2\u4EF6\u540D\u79F0","show-overflow-tooltip":""}),t(r,{prop:"provider",label:"\u4F5C\u8005","show-overflow-tooltip":""}),t(r,{prop:"pluginState",label:"\u72B6\u6001","show-overflow-tooltip":""}),t(r,{prop:"description",label:"\u63CF\u8FF0","show-overflow-tooltip":""}),t(r,{prop:"path",label:"\u64CD\u4F5C",width:"90"},{default:s(a=>[t(d,{size:"mini",type:"text",onClick:i=>l.beforeOnRowConfig(a.row)},{default:s(()=>[q]),_:2},1032,["onClick"]),t(d,{size:"mini",type:"text",onClick:i=>l.onRowUnInstall(a.row)},{default:s(()=>[G]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),t(m,{onSizeChange:l.onHandleSizeChange,onCurrentChange:l.onHandleCurrentChange,class:"mt15","pager-count":5,"page-sizes":[10,20,30],"current-page":e.tableData.param.pageNum,"onUpdate:current-page":o[0]||(o[0]=a=>e.tableData.param.pageNum=a),background:"","page-size":e.tableData.param.pageSize,"onUpdate:page-size":o[1]||(o[1]=a=>e.tableData.param.pageSize=a),layout:"total, sizes, prev, pager, next, jumper",total:e.tableData.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])]),_:1}),t(C,{title:"\u63D2\u4EF6\u914D\u7F6E",fullscreen:"","model-value":e.dialogVisible,"before-close":l.handleClose,onOpened:l.onRowConfig},{default:s(()=>[v("iframe",{src:e.pluginConfigUrl,frameborder:"0",style:{width:"100%",height:"600px"},ref:"iframeRef"},null,8,J)]),_:1},8,["model-value","before-close","onOpened"])])}var Y=B(O,[["render",K]]);export{Y as default};
