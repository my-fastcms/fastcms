var q=Object.defineProperty;var f=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var _=(o,s,a)=>s in o?q(o,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[s]=a,h=(o,s)=>{for(var a in s||(s={}))T.call(s,a)&&_(o,a,s[a]);if(f)for(var a of f(s))C.call(s,a)&&_(o,a,s[a]);return o};import{_ as R,L as r,b as I,c as k,d as B}from"./index.663f3072.js";import{a as x,b as U}from"./index.aab7a504.js";import{i as j,j as w,o as $,t as b,l as E,m as F,z as L,b as c,D as S,G as A}from"./vendor.07d41a1e.js";const D=j({name:"login11",props:{domain:{type:String,default:()=>""}},setup(o){const{proxy:s}=A(),a=w({sceneId:null,qrcodeUrl:""}),u=async e=>{if(e.data.userType!=1&&e.data.userType!=2){c.error("\u672A\u77E5\u7528\u6237\u7C7B\u578B");return}e.data.userType===1&&e.data.hasRole==!1?c.error("\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458\u6388\u6743"):i(e)},i=async e=>{var d,l,p,g;const n={username:e.data.username,photo:e.data.headImg===null?"/header.jpg":e.data.headImg,time:new Date().getTime(),hasRole:e.data.hasRole,version:e.data.version,userType:e.data.userType};r.set("token",e.data.token),r.set("tokenTtl",e.data.tokenTtl),r.set("userInfo",n),store.dispatch("userInfos/setUserInfos",n),store.state.themeConfig.themeConfig.isRequestRoutes?e.data.userType===1?await k():e.data.userType===2&&await I():await I();let y=currentTime.value;if((d=route.query)==null?void 0:d.redirect)console.log(route.query),router.push({path:(l=route.query)==null?void 0:l.redirect,query:Object.keys((p=route.query)==null?void 0:p.params).length>0?JSON.parse((g=route.query)==null?void 0:g.params):""});else{const v=B[0].children[0].path||"/";router.push(v)}setTimeout(()=>{a.loading.signIn=!0;const m=t("message.signInText");c.success(`${y}\uFF0C${m}`),s.mittBus.emit("onSignInClick")},300)};return $(()=>{x().then(e=>{a.qrcodeUrl=e.data.qrcodeUrl||null,a.sceneId=e.data.sceneId||null,console.log("sceneId:"+a.sceneId),console.log("qrcodeUrl:"+a.qrcodeUrl),setInterval(()=>{U(a.sceneId).then(n=>{clearInterval(),u(n)}).catch(()=>{console.log("=====no login user find=====")})},1e3)})}),h({},b(a))}}),M={class:"login-scan-container"};function N(o,s,a,u,i,e){const n=E("el-image");return S(),F("div",M,[L(n,{class:"login-scan-qrcode",ref:"qrcodeRef",src:o.qrcodeUrl},null,8,["src"])])}var P=R(D,[["render",N],["__scopeId","data-v-569d5f3a"]]);export{P as default};
