var w=Object.defineProperty;var m=Object.getOwnPropertySymbols;var y=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var D=(t,e,s)=>e in t?w(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,b=(t,e)=>{for(var s in e||(e={}))y.call(e,s)&&D(t,s,e[s]);if(m)for(var s of m(e))A.call(e,s)&&D(t,s,e[s]);return t};import{a as S,b as T}from"./index.f0ac80f9.js";import{_ as x,I as B}from"./index.a3be5272.js";import{l as E}from"./index.6a67ebb2.js";import{j as L,a8 as N,t as v,l as u,m as F,z as c,A as d,b as f,D as K,p as P,G as V,x as _}from"./vendor.d2ed1f2c.js";const $={name:"pagesTree",setup(){const{proxy:t}=V(),e=L({row:null,isShowDialog:!1,treeCheckAll:!1,treeLoading:!1,defaultCheckedKeys:[],treeData:[],treeDefaultProps:{children:"children",label:"label"},treeSelArr:[],treeLength:0}),s=r=>{e.isShowDialog=!0,e.row=r},l=()=>{e.isShowDialog=!1},g=()=>{l()},p=r=>{let o=0;r.map(C=>{C.children&&(o+=C.children.length)}),e.treeLength=o+r.length},i=()=>{e.treeCheckAll?t.$refs.treeTable.setCheckedNodes(e.treeData):t.$refs.treeTable.setCheckedKeys([])},a=()=>{e.treeSelArr=[],e.treeSelArr=t.$refs.treeTable.getCheckedNodes(!1,!0),e.treeSelArr.length==e.treeLength?e.treeCheckAll=!0:e.treeCheckAll=!1},h=()=>{if(t.$refs.treeTable.getCheckedNodes(!1,!0).length<=0){f.warning("\u8BF7\u9009\u62E9\u5143\u7D20");return}else console.log(t.$refs.treeTable.getCheckedNodes(!1,!0))},n=()=>{e.row&&e.row.id&&(e.defaultCheckedKeys=[],S(e.row.id).then(r=>{e.treeData=r.data,k(e.treeData),p(e.treeData)}))};N(()=>{n()});const k=r=>{r.forEach(o=>{o.label=B.global.t(o.label),o.checked&&o.children==null&&e.defaultCheckedKeys.push(o.id),o.children&&o.children.length>0&&k(o.children)}),console.log("====length:"+e.defaultCheckedKeys.length)};return b({openDialog:s,closeDialog:l,onCancel:g,onSubmit:()=>{const r=new Array;e.treeSelArr.forEach(o=>{r.push(o.id)}),T(e.row.id,E.stringify({permissionIdList:r},{arrayFormat:"repeat"})).then(()=>{f.success("\u4FDD\u5B58\u6210\u529F"),l()}).catch(o=>{f.error(o.message)})},getTreeData:n,onCheckAllChange:i,onCheckTree:a,onSelect:h},v(e))}},j={class:"system-menu-container"},I={class:"dialog-footer"},z=_("\u53D6 \u6D88"),R=_("\u4FDD \u5B58");function U(t,e,s,l,g,p){const i=u("el-tree"),a=u("el-button"),h=u("el-dialog");return K(),F("div",j,[c(h,{title:"\u6743\u9650\u8BBE\u7F6E",fullscreen:"",modelValue:t.isShowDialog,"onUpdate:modelValue":e[0]||(e[0]=n=>t.isShowDialog=n),width:"769px"},{footer:d(()=>[P("span",I,[c(a,{onClick:l.onCancel,size:"small"},{default:d(()=>[z]),_:1},8,["onClick"]),c(a,{type:"primary",onClick:l.onSubmit,size:"small"},{default:d(()=>[R]),_:1},8,["onClick"])])]),default:d(()=>[c(i,{data:t.treeData,"show-checkbox":"","node-key":"id","default-expand-all":!0,ref:"treeTable",props:t.treeDefaultProps,"default-checked-keys":t.defaultCheckedKeys,onCheck:l.onCheckTree},null,8,["data","props","default-checked-keys","onCheck"])]),_:1},8,["modelValue"])])}var Q=x($,[["render",U]]);export{Q as default};
