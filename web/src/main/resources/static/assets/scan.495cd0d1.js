var C=Object.defineProperty;var h=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var y=(a,s,t)=>s in a?C(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t,I=(a,s)=>{for(var t in s||(s={}))k.call(s,t)&&y(a,t,s[t]);if(h)for(var t of h(s))x.call(s,t)&&y(a,t,s[t]);return a};import{i as B,H as U,M as b,a0 as w,j,J as $,o as E,t as F,l as L,m as S,z as A,b as l,D}from"./vendor.07d41a1e.js";import{_ as M,u as J,f as N,L as i,b as v,c as O,d as z}from"./index.1eab61cc.js";import{a as H,b as P}from"./index.e5bbe10c.js";const Q=B({name:"login11",props:{domain:{type:String,default:()=>""}},setup(a){const{t:s}=U(),t=J(),n=b(),u=w(),o=j({sceneId:null,qrcodeUrl:""}),r=$(()=>N(new Date)),q=async e=>{if(e.data.userType!=1&&e.data.userType!=2){l.error("\u672A\u77E5\u7528\u6237\u7C7B\u578B");return}e.data.userType===1&&e.data.hasRole==!1?l.error("\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458\u6388\u6743"):T(e)},T=async e=>{var p,m,f,g;const c={username:e.data.username,photo:e.data.headImg===null?"/header.jpg":e.data.headImg,time:new Date().getTime(),hasRole:e.data.hasRole,version:e.data.version,userType:e.data.userType};i.set("token",e.data.token),i.set("tokenTtl",e.data.tokenTtl),i.set("userInfo",c),t.dispatch("userInfos/setUserInfos",c),t.state.themeConfig.themeConfig.isRequestRoutes?e.data.userType===1?await O():e.data.userType===2&&await v():await v();let d=r.value;if((p=n.query)==null?void 0:p.redirect)console.log(n.query),u.push({path:(m=n.query)==null?void 0:m.redirect,query:Object.keys((f=n.query)==null?void 0:f.params).length>0?JSON.parse((g=n.query)==null?void 0:g.params):""});else{const R=z[0].children[0].path||"/";u.push(R)}setTimeout(()=>{const _=s("message.signInText");l.success(`${d}\uFF0C${_}`)},300)};return E(()=>{H().then(e=>{o.qrcodeUrl=e.data.qrcodeUrl||null,o.sceneId=e.data.sceneId||null,console.log("sceneId:"+o.sceneId),console.log("qrcodeUrl:"+o.qrcodeUrl);let c=setInterval(()=>{P(o.sceneId).then(d=>{clearInterval(c),q(d)}).catch(()=>{console.log("=====no login user find=====")})},1e3)})}),I({currentTime:r},F(o))}}),V={class:"login-scan-container"};function G(a,s,t,n,u,o){const r=L("el-image");return D(),S("div",V,[A(r,{class:"login-scan-qrcode",ref:"qrcodeRef",src:a.qrcodeUrl},null,8,["src"])])}var Z=M(Q,[["render",G],["__scopeId","data-v-280c44ea"]]);export{Z as default};
