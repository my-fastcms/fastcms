var k=Object.defineProperty;var I=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var h=(a,t,s)=>t in a?k(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s,y=(a,t)=>{for(var s in t||(t={}))x.call(t,s)&&h(a,s,t[s]);if(I)for(var s of I(t))B.call(t,s)&&h(a,s,t[s]);return a};import{i as U,H as w,M as b,a0 as j,j as S,J as $,o as E,t as F,l as L,m as A,z as D,b as i,D as M,G as J}from"./vendor.07d41a1e.js";import{_ as N,u as O,f as z,L as d,b as v,c as G,d as H}from"./index.99781e20.js";import{a as P,b as Q}from"./index.54fedebc.js";const V=U({name:"login11",props:{domain:{type:String,default:()=>""}},setup(a){const{t}=w(),{proxy:s}=J(),c=O(),o=b(),u=j(),n=S({sceneId:null,qrcodeUrl:""}),l=$(()=>z(new Date)),q=async e=>{if(e.data.userType!=1&&e.data.userType!=2){i.error("\u672A\u77E5\u7528\u6237\u7C7B\u578B");return}e.data.userType===1&&e.data.hasRole==!1?i.error("\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458\u6388\u6743"):T(e)},T=async e=>{var p,m,g,f;const r={username:e.data.username,photo:e.data.headImg===null?"/header.jpg":e.data.headImg,time:new Date().getTime(),hasRole:e.data.hasRole,version:e.data.version,userType:e.data.userType};d.set("token",e.data.token),d.set("tokenTtl",e.data.tokenTtl),d.set("userInfo",r),c.dispatch("userInfos/setUserInfos",r),c.state.themeConfig.themeConfig.isRequestRoutes?e.data.userType===1?await G():e.data.userType===2&&await v():await v();let R=l.value;if((p=o.query)==null?void 0:p.redirect)console.log(o.query),u.push({path:(m=o.query)==null?void 0:m.redirect,query:Object.keys((g=o.query)==null?void 0:g.params).length>0?JSON.parse((f=o.query)==null?void 0:f.params):""});else{const C=H[0].children[0].path||"/";u.push(C)}setTimeout(()=>{n.loading.signIn=!0;const _=t("message.signInText");i.success(`${R}\uFF0C${_}`),s.mittBus.emit("onSignInClick")},300)};return E(()=>{P().then(e=>{n.qrcodeUrl=e.data.qrcodeUrl||null,n.sceneId=e.data.sceneId||null,console.log("sceneId:"+n.sceneId),console.log("qrcodeUrl:"+n.qrcodeUrl),setInterval(()=>{Q(n.sceneId).then(r=>{clearInterval(),q(r)}).catch(()=>{console.log("=====no login user find=====")})},1e3)})}),y({currentTime:l},F(n))}}),K={class:"login-scan-container"};function W(a,t,s,c,o,u){const n=L("el-image");return M(),A("div",K,[D(n,{class:"login-scan-qrcode",ref:"qrcodeRef",src:a.qrcodeUrl},null,8,["src"])])}var te=N(V,[["render",W],["__scopeId","data-v-1b808e9e"]]);export{te as default};
